<!-- HTML header for doxygen 1.8.6-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.14"/>
<title>ROOT: The Dataset Stager</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/x-mathjax-config">
  MathJax.Hub.Config({
    extensions: ["tex2jax.js"],
    jax: ["input/TeX","output/HTML-CSS"],
});
</script><script type="text/javascript" async src="./mathjax/MathJax.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="ROOT.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table bgcolor="#346295" cellspacing="0" cellpadding="0">
  <tr>
    <td> <img style="height:90px" alt="Logo" src="rootlogo.gif"/> </td>
    <td valign="middle" style="color: #FFFFFF" nowrap="nowrap"><font size="6">ROOT</font> &#160; 6.18/03 <br> Reference Guide </td>
    <td style="width:100%"> </td>
  </tr>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.14 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

</div><!-- top -->
<div class="header">
  <div class="headertitle">
<div class="title">The Dataset Stager </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><h2>Overview </h2>
<p>The <a href="http://afdsmgrd.googlecode.com/">Dataset Stager (afdsmgrd)</a> is a daemon that coordinates the transfer of data from a remote storage to your local storage.</p>
<p>For each file to transfer, a script is called. The script can be customized to support your source and destination protocol.</p>
<p>Staging requests are issued from the <a class="el" href="namespaceROOT.html" title="Namespace for new ROOT classes and functions. ">ROOT</a> console, where you can also control the progress of your staging. How to request stagings and how to check current transfer progress from <a class="el" href="namespaceROOT.html" title="Namespace for new ROOT classes and functions. ">ROOT</a> is explained in the <a href="TDataSetManagerAliEn.html">PROOF interface to AliEn file catalog documentation</a>.</p>
<h2>Installation </h2>
<p>The Dataset Stager is distributed both on a repository on its own and as part of <a class="el" href="namespaceROOT.html" title="Namespace for new ROOT classes and functions. ">ROOT</a>. The easiest way to compile it is to do it inside <a class="el" href="namespaceROOT.html" title="Namespace for new ROOT classes and functions. ">ROOT</a>.</p>
<h2>Installing from <a class="el" href="namespaceROOT.html" title="Namespace for new ROOT classes and functions. ">ROOT</a> </h2>
<p>When configuring the <a class="el" href="namespaceROOT.html" title="Namespace for new ROOT classes and functions. ">ROOT</a> source, enable the Dataset Stager by adding <code>--enable-afdsmgrd</code>. Check in the list of enabled features if you have "afdsmgrd".</p>
<p>After running <code>make</code> (and, optionally, <code>make install</code>) you'll find the daemon in the same directory of <code>root.exe</code>.</p>
<p>The configuration file and init.d startup script will be in <code>$ROOTSYS/etc/proof</code>. The daemon can and <b>must</b> run as unprivileged user.</p>
<h2>Configuration </h2>
<p>The Dataset Stager can share its configuration file with PROOF, as some directives are the same and unknown directives are just ignored.</p>
<p>Directives are one per line and lines beginning with a pound sign (<code>#</code>) are used for comments.</p>
<blockquote class="doxtable">
<p>The configuration file is automatically checked at each loop: this means you can change configuration without restarting the daemon or stopping your current transfers. </p>
</blockquote>
<p>A detailed description of each directive follows.</p>
<p>set <em>VARIABLE=value</em> : This statement will substitute every occurrence of <code>$VARIABLE</code> with its <em>value</em> in the rest of the configuration file. You can have multiple <code>set</code> statements.</p>
<p>xpd.stagereqrepo [dir:]*directory* : This directive is shared with PROOF: <em>directory</em> is the full path to the dataset repository. <b>Defaults to empty:</b> without this directive the daemon is not operative.</p>
<p>The <code>dir:</code> prefix is optional.</p>
<p>dsmgrd.purgenoopds <em>true|false</em> : Set it to <em>true</em> **(default is false)** to remove a dataset when no file to stage is found. If no file to stage is found, but corrupted files exist, the dataset is kept to signal failures. Used in combination with <code>xpd.stagereqrepo</code> makes it "disposable": only the datasets effectively needed for signaling the staging status will be kept, improving scalability and stability.</p>
<p>dsmgrd.urlregex <em>regex</em> <em>subst</em> : Each source URL present in the datasets will be matched to <em>regex</em> and substituted to <em>subst</em>. <em>regex</em> supports grouping using parentheses, and groups can be referenced in order using the dollar sign with a number (<code>$1</code> for instance) in <em>subst</em>.</p>
<p>Matching and substitution for multiple URL schemas are supported by using in addition directives <code>dsmgrd.urlregex2</code> up to <code>dsmgrd.urlregex4</code> which have the same syntax of this one.</p>
<p>Example of URL translation via regexp:</p>
<p>&gt; - Configuration line: &gt; &gt; dsmgrd.urlregex alien://(.*)$ root://xrd.cern.ch/$1 &gt; &gt; - Source URL: &gt; &gt; alien:///alice/data/2012/LHC12b/000178209/ESDs/pass1/12000178209061.17/AliESDs.root &gt; &gt; - Resulting URL: &gt; &gt; root://xrd.cern.ch//alice/data/2012/LHC12b/000178209/ESDs/pass1/12000178209061.17/AliESDs.root &gt; dsmgrd.sleepsecs <em>secs</em> : Seconds to sleep between each loop. The dataset stager checks at each loop the status of the managed transfers. Defaults to <b>30 seconds</b>.</p>
<p>dsmgrd.scandseveryloops <em>n</em> : Every <code>n</code> loops, the dataset repository is checked for newly incoming staging requests. Defaults to <b>10</b>.</p>
<p>dsmgrd.parallelxfrs <em>n</em> : Number of concurrent transfers. Defaults to <b>8</b>.</p>
<p>dsmgrd.stagecmd <em>shell_command</em> : Command to run in order to stage each file. It might be whatever you want (executable, shell script...). If you add <code>$URLTOSTAGE</code> and/or <code>$TREENAME</code> in the <em>shell_command</em>, they'll be substituted respectively with the destination URL and the default <a class="el" href="namespaceROOT.html" title="Namespace for new ROOT classes and functions. ">ROOT</a> tree name in the file (as specified in the dataset staging request from <a class="el" href="namespaceROOT.html" title="Namespace for new ROOT classes and functions. ">ROOT</a>).</p>
<p>An example: </p><pre class="fragment">dsmgrd.stagecmd /path/to/afdsmgrd-xrd-stage-verify.sh "$URLTOSTAGE" "$TREENAME"
</pre><p>Return value of the command is ignored: standard output is considered, as explained here.</p>
<p>Defaults to <code>/bin/false</code>.</p>
<p>dsmgrd.cmdtimeoutsecs <em>secs</em> : Timeout on staging command, expressed in seconds: after this timeout, the command is considered failed and it is killed (in first place with <code>SIGSTOP</code>, then if it is unresponsive with <code>SIGKILL</code>). Defaults to <b>0 (no timeout)</b>.</p>
<p>dsmgrd.corruptafterfails <em>n</em> : Set this to a number above zero to tell the daemon to mark files as corrupted after a certain number of either download or verification failures. A value of <b>0 (default)</b> tells the daemon to retry forever.</p>
<h2>Configuring the MonALISA monitoring plugin </h2>
<p>The Dataset Stager supports generic monitoring plugins. The only plugin distributed with the stager is the MonALISA monitoring plugin.</p>
<p>dsmgrd.notifyplugin */path/to/libafdsmgrd_notify_apmon.so* : Set it to the path of the MonALISA plugin shared object. By default, notification plugin is disabled.</p>
<p>dsmgrd.apmonurl <em>apmon://apmon.cern.ch</em> : This variable tells the ApMon notification plugin how to contact one or more MonALISA server(s) to activate monitoring via ApMon. It supports two kinds of URLs:</p>
<ul>
<li><code>http[s]://host/path/configuration_file.conf</code> (a remote file where to fetch the list of servers from)</li>
<li><code>apmon://[:password@]monalisahost[:8884]</code> (a single server to contact directly)</li>
</ul>
<p>If the variable is not set, yet the plugin is loaded, MonALISA monitoring is inhibited until a valid configuration variable is provided.</p>
<p>dsmgrd.apmonprefix <em>MY::CLUSTER::PREFIX</em> : Since MonALISA organizes information in "clusters" and "hosts", here you can specify what to use as cluster prefix for monitoring datasets information and daemon status. If this variable is not set, MonALISA monitoring is inhibited. Please note that the suffix <code>_datasets</code> or <code>_status</code> is appended for each of the two types of monitoring.</p>
<h2>A sample configuration file </h2>
<pre class="fragment">xpd.stagereqrepo /opt/aaf/var/proof/datasets
dsmgrd.purgenoopds true
dsmgrd.urlregex alien://(.*)$ /storage$1
dsmgrd.sleepsecs 20
dsmgrd.scandseveryloops 30
dsmgrd.parallelxfrs 10
dsmgrd.stagecmd /opt/aaf/bin/af-xrddm-verify.sh "$URLTOSTAGE" "$TREENAME"
dsmgrd.cmdtimeoutsecs 3600
dsmgrd.corruptafterfails 0</pre> </div></div><!-- contents -->
<html>
<body>
<div id="footer" style="background-color:#E5EBF3;">
<small>
<img class="footer" src="rootlogo_s.gif" alt="root"/></a>
ROOT 6.18/03 - Reference Guide Generated on Thu Aug 29 2019 04:10:40 (GVA Time) using Doxygen 1.8.14.
</small>
</div>
</body>
</html>
