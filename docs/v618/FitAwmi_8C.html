<!-- HTML header for doxygen 1.8.6-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.14"/>
<title>ROOT: tutorials/spectrum/FitAwmi.C File Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/x-mathjax-config">
  MathJax.Hub.Config({
    extensions: ["tex2jax.js"],
    jax: ["input/TeX","output/HTML-CSS"],
});
</script><script type="text/javascript" async src="./mathjax/MathJax.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="ROOT.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table bgcolor="#346295" cellspacing="0" cellpadding="0">
  <tr>
    <td> <img style="height:90px" alt="Logo" src="rootlogo.gif"/> </td>
    <td valign="middle" style="color: #FFFFFF" nowrap="nowrap"><font size="6">ROOT</font> &#160; 6.18/03 <br> Reference Guide </td>
    <td style="width:100%"> </td>
  </tr>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.14 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div id="nav-path" class="navpath">
  <ul>
<li class="navelem"><a class="el" href="dir_0d353d24d0afa59909efab6593124f6d.html">tutorials</a></li><li class="navelem"><a class="el" href="dir_3cf4dea69847715e7a10fc9b08881f1d.html">spectrum</a></li>  </ul>
</div>
</div><!-- top -->
<div class="header">
  <div class="headertitle">
<div class="title">FitAwmi.C File Reference<div class="ingroups"><a class="el" href="group__Tutorials.html">Tutorials</a> &raquo; <a class="el" href="group__tutorial__spectrum.html">Spectrum tutorials</a></div></div>  </div>
</div><!--header-->
<div class="contents">
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<div class="textblock"><p> <a href="http://nbviewer.jupyter.org/url/root.cern.ch/doc/master/notebooks/FitAwmi.C.nbconvert.ipynb" target="_blank"><img src= notebook.gif alt="View in nbviewer" style="height:1em" ></a> <a href="https://cern.ch/swanserver/cgi-bin/go?projurl=https://root.cern.ch/doc/master/notebooks/FitAwmi.C.nbconvert.ipynb" target="_blank"><img src="http://swanserver.web.cern.ch/swanserver/images/badge_swan_white_150.png"  alt="Open in SWAN" style="height:1em" ></a>  </p>
<p>This macro fits the source spectrum using the AWMI algorithm from the "TSpectrumFit" class ("TSpectrum" class is used to find peaks).</p>
<p>To try this macro, in a <a class="el" href="namespaceROOT.html" title="Namespace for new ROOT classes and functions. ">ROOT</a> (5 or 6) prompt, do:</p>
<div class="fragment"><div class="line">root &gt; .x FitAwmi.C</div></div><!-- fragment --><p>or:</p>
<div class="fragment"><div class="line">root &gt; .x FitAwmi.C++</div><div class="line">root &gt; FitAwmi(); <span class="comment">// re-run with another random set of peaks</span></div></div><!-- fragment --><div class="image">
<img src="pict1_FitAwmi.C.png" alt="pict1_FitAwmi.C.png" width="1000"/>
</div>
 <div class="fragment"><div class="line"></div><div class="line">created -9.76 49.8678 10</div><div class="line">created -9.28 44.881 9</div><div class="line">created -8.8 19.9471 4</div><div class="line">created -8.32 44.881 9</div><div class="line">created -7.84 39.8942 8</div><div class="line">created -7.36 24.9339 5</div><div class="line">created -6.88 49.8678 10</div><div class="line">created -6.4 44.881 9</div><div class="line">created -5.92 24.9339 5</div><div class="line">created -5.44 24.9339 5</div><div class="line">created -4.96 24.9339 5</div><div class="line">created -4.48 29.9207 6</div><div class="line">created -4 14.9603 3</div><div class="line">created -3.52 24.9339 5</div><div class="line">created -3.04 34.9074 7</div><div class="line">created -2.56 19.9471 4</div><div class="line">created -2.08 39.8942 8</div><div class="line">created -1.6 29.9207 6</div><div class="line">created -1.12 34.9074 7</div><div class="line">created -0.64 24.9339 5</div><div class="line">created -0.16 34.9074 7</div><div class="line">created 0.32 29.9207 6</div><div class="line">created 0.8 49.8678 10</div><div class="line">created 1.28 4.98678 1</div><div class="line">created 1.76 44.881 9</div><div class="line">created 2.24 4.98678 1</div><div class="line">created 2.72 19.9471 4</div><div class="line">created 3.2 14.9603 3</div><div class="line">created 3.68 9.97356 2</div><div class="line">created 4.16 9.97356 2</div><div class="line">created 4.64 34.9074 7</div><div class="line">created 5.12 9.97356 2</div><div class="line">created 5.6 9.97356 2</div><div class="line">created 6.08 24.9339 5</div><div class="line">created 6.56 29.9207 6</div><div class="line">created 7.04 19.9471 4</div><div class="line">created 7.52 49.8678 10</div><div class="line">created 8 14.9603 3</div><div class="line">created 8.48 14.9603 3</div><div class="line">created 8.96 19.9471 4</div><div class="line">created 9.44 44.881 9</div><div class="line">the total number of created peaks = 41 with sigma = 0.08</div><div class="line">the total number of found peaks = 41 with sigma = 0.080001 (+-2.96657e-05)</div><div class="line">fit chi^2 = 5.06793e-06</div><div class="line">found -9.76 (+-0.000247978) 49.8676 (+-0.15228) 10.0001 (+-0.00100843)</div><div class="line">found -6.88 (+-0.000247956) 49.8678 (+-0.152291) 10.0001 (+-0.0010085)</div><div class="line">found 0.799999 (+-0.00024666) 49.8675 (+-0.152199) 10.0001 (+-0.00100789)</div><div class="line">found 7.52 (+-0.000246918) 49.8675 (+-0.152214) 10.0001 (+-0.00100799)</div><div class="line">found -9.28 (+-0.000261497) 44.8811 (+-0.144486) 9.00014 (+-0.000956811)</div><div class="line">found -8.32 (+-0.000261261) 44.881 (+-0.144469) 9.00012 (+-0.0009567)</div><div class="line">found -6.4 (+-0.000261681) 44.8812 (+-0.144498) 9.00015 (+-0.000956892)</div><div class="line">found 1.76 (+-0.000258973) 44.8805 (+-0.144323) 9.00002 (+-0.000955732)</div><div class="line">found 9.44 (+-0.000258844) 44.8811 (+-0.144327) 9.00013 (+-0.000955762)</div><div class="line">found -7.84 (+-0.000277679) 39.8944 (+-0.136242) 8.00014 (+-0.000902216)</div><div class="line">found -2.08 (+-0.000277033) 39.8942 (+-0.136202) 8.0001 (+-0.000901952)</div><div class="line">found -3.04 (+-0.000296236) 34.9074 (+-0.127409) 7.00009 (+-0.000843724)</div><div class="line">found -1.12 (+-0.000296665) 34.9076 (+-0.127432) 7.00011 (+-0.000843876)</div><div class="line">found -0.16 (+-0.000296665) 34.9076 (+-0.127432) 7.00011 (+-0.000843876)</div><div class="line">found 4.64 (+-0.000294818) 34.9072 (+-0.127336) 7.00004 (+-0.000843244)</div><div class="line">found -1.6 (+-0.000321648) 29.921 (+-0.118036) 6.00015 (+-0.000781655)</div><div class="line">found 0.320001 (+-0.000321984) 29.9211 (+-0.118052) 6.00017 (+-0.000781764)</div><div class="line">found -4.48 (+-0.000320015) 29.9207 (+-0.11796) 6.00008 (+-0.000781152)</div><div class="line">found 6.56 (+-0.000320322) 29.9207 (+-0.117974) 6.00009 (+-0.000781243)</div><div class="line">found -7.36 (+-0.000353549) 24.9345 (+-0.1078) 5.00018 (+-0.000713874)</div><div class="line">found -5.92 (+-0.000352621) 24.9343 (+-0.107763) 5.00014 (+-0.000713627)</div><div class="line">found -0.64 (+-0.000352712) 24.9343 (+-0.107766) 5.00014 (+-0.000713647)</div><div class="line">found -5.44 (+-0.000351686) 24.9341 (+-0.107725) 5.0001 (+-0.000713376)</div><div class="line">found -4.96 (+-0.000351956) 24.9341 (+-0.107736) 5.00011 (+-0.000713447)</div><div class="line">found -3.52 (+-0.000351528) 24.9341 (+-0.10772) 5.0001 (+-0.000713342)</div><div class="line">found 6.08 (+-0.00035084) 24.934 (+-0.107694) 5.00008 (+-0.000713169)</div><div class="line">found -8.8 (+-0.000396216) 19.9478 (+-0.0964508) 4.00018 (+-0.000638714)</div><div class="line">found -2.56 (+-0.000395453) 19.9476 (+-0.0964253) 4.00015 (+-0.000638546)</div><div class="line">found 7.04 (+-0.000395632) 19.9477 (+-0.0964317) 4.00016 (+-0.000638588)</div><div class="line">found 2.72 (+-0.000391031) 19.9471 (+-0.0962877) 4.00004 (+-0.000637634)</div><div class="line">found 8.96 (+-0.000394256) 19.9475 (+-0.096388) 4.00012 (+-0.000638299)</div><div class="line">found 8 (+-0.000456786) 14.9608 (+-0.083513) 3.00013 (+-0.000553038)</div><div class="line">found -4 (+-0.00045652) 14.9607 (+-0.0835041) 3.00011 (+-0.000552979)</div><div class="line">found 3.2 (+-0.000453886) 14.9604 (+-0.0834409) 3.00006 (+-0.000552561)</div><div class="line">found 8.48 (+-0.000454585) 14.9605 (+-0.083457) 3.00007 (+-0.000552667)</div><div class="line">found 3.68 (+-0.000557052) 9.97368 (+-0.0681473) 2.00005 (+-0.000451283)</div><div class="line">found 5.12 (+-0.000559614) 9.97389 (+-0.0681911) 2.00009 (+-0.000451573)</div><div class="line">found 4.16 (+-0.000559614) 9.97389 (+-0.0681911) 2.00009 (+-0.000451573)</div><div class="line">found 5.6 (+-0.000558509) 9.97379 (+-0.0681717) 2.00007 (+-0.000451445)</div><div class="line">found 1.28 (+-0.000808372) 4.98769 (+-0.0483692) 1.00019 (+-0.000320309)</div><div class="line">found 2.23999 (+-0.000802724) 4.98738 (+-0.0483173) 1.00013 (+-0.000319966)</div></div><!-- fragment --> <div class="fragment"><div class="line"></div><div class="line"><span class="preprocessor">#include &quot;<a class="code" href="TROOT_8h.html">TROOT.h</a>&quot;</span></div><div class="line"><span class="preprocessor">#include &quot;<a class="code" href="TMath_8h.html">TMath.h</a>&quot;</span></div><div class="line"><span class="preprocessor">#include &quot;<a class="code" href="TRandom_8h.html">TRandom.h</a>&quot;</span></div><div class="line"><span class="preprocessor">#include &quot;<a class="code" href="TH1_8h.html">TH1.h</a>&quot;</span></div><div class="line"><span class="preprocessor">#include &quot;<a class="code" href="TF1_8h.html">TF1.h</a>&quot;</span></div><div class="line"><span class="preprocessor">#include &quot;<a class="code" href="TCanvas_8h.html">TCanvas.h</a>&quot;</span></div><div class="line"><span class="preprocessor">#include &quot;<a class="code" href="TSpectrum_8h.html">TSpectrum.h</a>&quot;</span></div><div class="line"><span class="preprocessor">#include &quot;<a class="code" href="TSpectrumFit_8h.html">TSpectrumFit.h</a>&quot;</span></div><div class="line"><span class="preprocessor">#include &quot;<a class="code" href="TPolyMarker_8h.html">TPolyMarker.h</a>&quot;</span></div><div class="line"><span class="preprocessor">#include &quot;<a class="code" href="TList_8h.html">TList.h</a>&quot;</span></div><div class="line"></div><div class="line"><span class="preprocessor">#include &lt;iostream&gt;</span></div><div class="line"></div><div class="line"><a class="code" href="classTH1F.html">TH1F</a> *FitAwmi_Create_Spectrum(<span class="keywordtype">void</span>) {</div><div class="line">   <a class="code" href="RtypesCore_8h.html#a3885b911a54b47a4e61671f45dd45d0b">Int_t</a> nbins = 1000;</div><div class="line">   <a class="code" href="RtypesCore_8h.html#ab9b5334647b78ec4256db251e3ae1fc6">Double_t</a> <a class="code" href="THbookFile_8cxx.html#a058f249a5e6d20724cb0784b40a183e8">xmin</a> = -10., <a class="code" href="THbookFile_8cxx.html#a9c42f51718ed192ed1841a53d2b0e507">xmax</a> = 10.;</div><div class="line">   <span class="keyword">delete</span> <a class="code" href="TROOT_8h.html#a851dd11b3478372a25ba6eff6dcfa5b1">gROOT</a>-&gt;FindObject(<span class="stringliteral">&quot;h&quot;</span>); <span class="comment">// prevent &quot;memory leak&quot;</span></div><div class="line">   <a class="code" href="classTH1F.html">TH1F</a> *<a class="code" href="RSha256_8hxx.html#acf9942d15f0dd0ac4fc5ca66096a3f6d">h</a> = <span class="keyword">new</span> <a class="code" href="classTH1F.html">TH1F</a>(<span class="stringliteral">&quot;h&quot;</span>, <span class="stringliteral">&quot;simulated spectrum&quot;</span>, nbins, <a class="code" href="THbookFile_8cxx.html#a058f249a5e6d20724cb0784b40a183e8">xmin</a>, <a class="code" href="THbookFile_8cxx.html#a9c42f51718ed192ed1841a53d2b0e507">xmax</a>);</div><div class="line">   <a class="code" href="RSha256_8hxx.html#acf9942d15f0dd0ac4fc5ca66096a3f6d">h</a>-&gt;SetStats(<a class="code" href="RtypesCore_8h.html#a7e568baf910535e8ffd438acb843434d">kFALSE</a>);</div><div class="line">   <a class="code" href="classTF1.html">TF1</a> <a class="code" href="RSha256_8hxx.html#a357394e0f6f88c8a57bd893ab28dc8f8">f</a>(<span class="stringliteral">&quot;f&quot;</span>, <span class="stringliteral">&quot;TMath::Gaus(x, [0], [1], 1)&quot;</span>, <a class="code" href="THbookFile_8cxx.html#a058f249a5e6d20724cb0784b40a183e8">xmin</a>, <a class="code" href="THbookFile_8cxx.html#a9c42f51718ed192ed1841a53d2b0e507">xmax</a>);</div><div class="line">   <span class="comment">// f.SetParNames(&quot;mean&quot;, &quot;sigma&quot;);</span></div><div class="line">   <a class="code" href="TRandom_8h.html#a9ee275021031e1e27291bb36baa0e3e2">gRandom</a>-&gt;<a class="code" href="classTRandom.html#a2007ae15ce828266aecb783ed3410e8b">SetSeed</a>(0); <span class="comment">// make it really random</span></div><div class="line">   <span class="comment">// create well separated peaks with exactly known means and areas</span></div><div class="line">   <span class="comment">// note: TSpectrumFit assumes that all peaks have the same sigma</span></div><div class="line">   <a class="code" href="RtypesCore_8h.html#ab9b5334647b78ec4256db251e3ae1fc6">Double_t</a> <a class="code" href="h1analysisProxy_8h.html#a351c2b9335dfcbe83de6eb9629c2a0e3">sigma</a> = (<a class="code" href="THbookFile_8cxx.html#a9c42f51718ed192ed1841a53d2b0e507">xmax</a> - <a class="code" href="THbookFile_8cxx.html#a058f249a5e6d20724cb0784b40a183e8">xmin</a>) / <a class="code" href="RtypesCore_8h.html#ab9b5334647b78ec4256db251e3ae1fc6">Double_t</a>(nbins) * <a class="code" href="RtypesCore_8h.html#a3885b911a54b47a4e61671f45dd45d0b">Int_t</a>(<a class="code" href="TRandom_8h.html#a9ee275021031e1e27291bb36baa0e3e2">gRandom</a>-&gt;<a class="code" href="classTRandom.html#a86cf3a4ff3fdc44b26298f1984a9a9c7">Uniform</a>(2., 6.));</div><div class="line">   <a class="code" href="RtypesCore_8h.html#a3885b911a54b47a4e61671f45dd45d0b">Int_t</a> npeaks = 0;</div><div class="line">   <span class="keywordflow">while</span> (<a class="code" href="THbookFile_8cxx.html#a9c42f51718ed192ed1841a53d2b0e507">xmax</a> &gt; (<a class="code" href="THbookFile_8cxx.html#a058f249a5e6d20724cb0784b40a183e8">xmin</a> + 6. * <a class="code" href="h1analysisProxy_8h.html#a351c2b9335dfcbe83de6eb9629c2a0e3">sigma</a>)) {</div><div class="line">      npeaks++;</div><div class="line">      <a class="code" href="THbookFile_8cxx.html#a058f249a5e6d20724cb0784b40a183e8">xmin</a> += 3. * <a class="code" href="h1analysisProxy_8h.html#a351c2b9335dfcbe83de6eb9629c2a0e3">sigma</a>; <span class="comment">// &quot;mean&quot;</span></div><div class="line">      <a class="code" href="RSha256_8hxx.html#a357394e0f6f88c8a57bd893ab28dc8f8">f</a>.SetParameters(<a class="code" href="THbookFile_8cxx.html#a058f249a5e6d20724cb0784b40a183e8">xmin</a>, <a class="code" href="h1analysisProxy_8h.html#a351c2b9335dfcbe83de6eb9629c2a0e3">sigma</a>);</div><div class="line">      <a class="code" href="RtypesCore_8h.html#ab9b5334647b78ec4256db251e3ae1fc6">Double_t</a> area = 1. * <a class="code" href="RtypesCore_8h.html#a3885b911a54b47a4e61671f45dd45d0b">Int_t</a>(<a class="code" href="TRandom_8h.html#a9ee275021031e1e27291bb36baa0e3e2">gRandom</a>-&gt;<a class="code" href="classTRandom.html#a86cf3a4ff3fdc44b26298f1984a9a9c7">Uniform</a>(1., 11.));</div><div class="line">      <a class="code" href="RSha256_8hxx.html#acf9942d15f0dd0ac4fc5ca66096a3f6d">h</a>-&gt;Add(&amp;<a class="code" href="RSha256_8hxx.html#a357394e0f6f88c8a57bd893ab28dc8f8">f</a>, area, <span class="stringliteral">&quot;&quot;</span>); <span class="comment">// &quot;&quot; ... or ... &quot;I&quot;</span></div><div class="line">      std::cout &lt;&lt; <span class="stringliteral">&quot;created &quot;</span></div><div class="line">                &lt;&lt; <a class="code" href="THbookFile_8cxx.html#a058f249a5e6d20724cb0784b40a183e8">xmin</a> &lt;&lt; <span class="stringliteral">&quot; &quot;</span></div><div class="line">                &lt;&lt; (area / <a class="code" href="h1analysisProxy_8h.html#a351c2b9335dfcbe83de6eb9629c2a0e3">sigma</a> / <a class="code" href="namespaceTMath.html#a9ea900c956031cb12057acf7c322b0fa">TMath::Sqrt</a>(<a class="code" href="namespaceTMath.html#afa037a26bb8089dd0f1f65fe5583d308">TMath::TwoPi</a>())) &lt;&lt; <span class="stringliteral">&quot; &quot;</span></div><div class="line">                &lt;&lt; area &lt;&lt; std::endl;</div><div class="line">      <a class="code" href="THbookFile_8cxx.html#a058f249a5e6d20724cb0784b40a183e8">xmin</a> += 3. * <a class="code" href="h1analysisProxy_8h.html#a351c2b9335dfcbe83de6eb9629c2a0e3">sigma</a>;</div><div class="line">   }</div><div class="line">   std::cout &lt;&lt; <span class="stringliteral">&quot;the total number of created peaks = &quot;</span> &lt;&lt; npeaks</div><div class="line">             &lt;&lt; <span class="stringliteral">&quot; with sigma = &quot;</span> &lt;&lt; <a class="code" href="h1analysisProxy_8h.html#a351c2b9335dfcbe83de6eb9629c2a0e3">sigma</a> &lt;&lt; std::endl;</div><div class="line">   <span class="keywordflow">return</span> <a class="code" href="RSha256_8hxx.html#acf9942d15f0dd0ac4fc5ca66096a3f6d">h</a>;</div><div class="line">}</div><div class="line"></div><div class="line"><span class="keywordtype">void</span> FitAwmi(<span class="keywordtype">void</span>) {</div><div class="line"></div><div class="line">   <a class="code" href="classTH1F.html">TH1F</a> *<a class="code" href="RSha256_8hxx.html#acf9942d15f0dd0ac4fc5ca66096a3f6d">h</a> = FitAwmi_Create_Spectrum();</div><div class="line"></div><div class="line">   <a class="code" href="classTCanvas.html">TCanvas</a> *cFit = ((<a class="code" href="classTCanvas.html">TCanvas</a> *)(<a class="code" href="TROOT_8h.html#a851dd11b3478372a25ba6eff6dcfa5b1">gROOT</a>-&gt;GetListOfCanvases()-&gt;FindObject(<span class="stringliteral">&quot;cFit&quot;</span>)));</div><div class="line">   <span class="keywordflow">if</span> (!cFit) cFit = <span class="keyword">new</span> <a class="code" href="classTCanvas.html">TCanvas</a>(<span class="stringliteral">&quot;cFit&quot;</span>, <span class="stringliteral">&quot;cFit&quot;</span>, 10, 10, 1000, 700);</div><div class="line">   <span class="keywordflow">else</span> cFit-&gt;<a class="code" href="classTCanvas.html#a33bbb4c95ac1a51b433c8c42274e65cd">Clear</a>();</div><div class="line">   <a class="code" href="RSha256_8hxx.html#acf9942d15f0dd0ac4fc5ca66096a3f6d">h</a>-&gt;Draw(<span class="stringliteral">&quot;L&quot;</span>);</div><div class="line">   <a class="code" href="RtypesCore_8h.html#a3885b911a54b47a4e61671f45dd45d0b">Int_t</a> i, nfound, bin;</div><div class="line">   <a class="code" href="RtypesCore_8h.html#a3885b911a54b47a4e61671f45dd45d0b">Int_t</a> nbins = <a class="code" href="RSha256_8hxx.html#acf9942d15f0dd0ac4fc5ca66096a3f6d">h</a>-&gt;GetNbinsX();</div><div class="line"></div><div class="line">   <a class="code" href="RtypesCore_8h.html#ab9b5334647b78ec4256db251e3ae1fc6">Double_t</a> *source = <span class="keyword">new</span> <a class="code" href="RtypesCore_8h.html#ab9b5334647b78ec4256db251e3ae1fc6">Double_t</a>[nbins];</div><div class="line">   <a class="code" href="RtypesCore_8h.html#ab9b5334647b78ec4256db251e3ae1fc6">Double_t</a> *<a class="code" href="triangle_8c.html#aa22f343c7ac709eab3fdd162721759a1">dest</a> = <span class="keyword">new</span> <a class="code" href="RtypesCore_8h.html#ab9b5334647b78ec4256db251e3ae1fc6">Double_t</a>[nbins];</div><div class="line"></div><div class="line">   <span class="keywordflow">for</span> (i = 0; i &lt; nbins; i++) source[i] = <a class="code" href="RSha256_8hxx.html#acf9942d15f0dd0ac4fc5ca66096a3f6d">h</a>-&gt;GetBinContent(i + 1);</div><div class="line">   <a class="code" href="classTSpectrum.html">TSpectrum</a> *<a class="code" href="namespaceTGeant4Unit.html#a5d450e80998065902b102dca2a69066a">s</a> = <span class="keyword">new</span> <a class="code" href="classTSpectrum.html">TSpectrum</a>(); <span class="comment">// note: default maxpositions = 100</span></div><div class="line">   <span class="comment">// searching for candidate peaks positions</span></div><div class="line">   nfound = <a class="code" href="namespaceTGeant4Unit.html#a5d450e80998065902b102dca2a69066a">s</a>-&gt;SearchHighRes(source, <a class="code" href="triangle_8c.html#aa22f343c7ac709eab3fdd162721759a1">dest</a>, nbins, 2., 2., <a class="code" href="RtypesCore_8h.html#a7e568baf910535e8ffd438acb843434d">kFALSE</a>, 10000, <a class="code" href="RtypesCore_8h.html#a7e568baf910535e8ffd438acb843434d">kFALSE</a>, 0);</div><div class="line">   <span class="comment">// filling in the initial estimates of the input parameters</span></div><div class="line">   <a class="code" href="RtypesCore_8h.html#aa101f564ac7b845ca31aec2fbc00ce97">Bool_t</a> *FixPos = <span class="keyword">new</span> <a class="code" href="RtypesCore_8h.html#aa101f564ac7b845ca31aec2fbc00ce97">Bool_t</a>[nfound];</div><div class="line">   <a class="code" href="RtypesCore_8h.html#aa101f564ac7b845ca31aec2fbc00ce97">Bool_t</a> *FixAmp = <span class="keyword">new</span> <a class="code" href="RtypesCore_8h.html#aa101f564ac7b845ca31aec2fbc00ce97">Bool_t</a>[nfound];</div><div class="line">   <span class="keywordflow">for</span>(i = 0; i &lt; nfound; i++) FixAmp[i] = FixPos[i] = <a class="code" href="RtypesCore_8h.html#a7e568baf910535e8ffd438acb843434d">kFALSE</a>;</div><div class="line"></div><div class="line">   <a class="code" href="RtypesCore_8h.html#ab9b5334647b78ec4256db251e3ae1fc6">Double_t</a> *Pos, *Amp = <span class="keyword">new</span> <a class="code" href="RtypesCore_8h.html#ab9b5334647b78ec4256db251e3ae1fc6">Double_t</a>[nfound]; <span class="comment">// ROOT 6</span></div><div class="line"></div><div class="line">   Pos = <a class="code" href="namespaceTGeant4Unit.html#a5d450e80998065902b102dca2a69066a">s</a>-&gt;GetPositionX(); <span class="comment">// 0 ... (nbins - 1)</span></div><div class="line">   <span class="keywordflow">for</span> (i = 0; i &lt; nfound; i++) {</div><div class="line">      bin = 1 + <a class="code" href="RtypesCore_8h.html#a3885b911a54b47a4e61671f45dd45d0b">Int_t</a>(Pos[i] + 0.5); <span class="comment">// the &quot;nearest&quot; bin</span></div><div class="line">      Amp[i] = <a class="code" href="RSha256_8hxx.html#acf9942d15f0dd0ac4fc5ca66096a3f6d">h</a>-&gt;GetBinContent(bin);</div><div class="line">   }</div><div class="line">   <a class="code" href="classTSpectrumFit.html">TSpectrumFit</a> *pfit = <span class="keyword">new</span> <a class="code" href="classTSpectrumFit.html">TSpectrumFit</a>(nfound);</div><div class="line">   pfit-&gt;<a class="code" href="classTSpectrumFit.html#ac4419426a5bf9428d3583d972dbb47f2">SetFitParameters</a>(0, (nbins - 1), 1000, 0.1, pfit-&gt;<a class="code" href="classTSpectrumFit.html#a6149e96e49953c842d49c6e1703ff204a3716d6a863302ec728afa2320409614b">kFitOptimChiCounts</a>,</div><div class="line">                          pfit-&gt;<a class="code" href="classTSpectrumFit.html#a6149e96e49953c842d49c6e1703ff204a23fbe99d77f167c87cd78f83cac6d7cd">kFitAlphaHalving</a>, pfit-&gt;<a class="code" href="classTSpectrumFit.html#a6149e96e49953c842d49c6e1703ff204ac29e07f9b30cf7b537c1947fe8b4a07b">kFitPower2</a>,</div><div class="line">                          pfit-&gt;<a class="code" href="classTSpectrumFit.html#a6149e96e49953c842d49c6e1703ff204a218e164ee8f1c70b7851095762fdd355">kFitTaylorOrderFirst</a>);</div><div class="line">   pfit-&gt;<a class="code" href="classTSpectrumFit.html#a16917dc836f23e6057d1024d0f559c1e">SetPeakParameters</a>(2., <a class="code" href="RtypesCore_8h.html#a7e568baf910535e8ffd438acb843434d">kFALSE</a>, Pos, FixPos, Amp, FixAmp);</div><div class="line">   <span class="comment">// pfit-&gt;SetBackgroundParameters(source[0], kFALSE, 0., kFALSE, 0., kFALSE);</span></div><div class="line">   pfit-&gt;<a class="code" href="classTSpectrumFit.html#a4ad5acf673b1199b1aecd9481d871f6f">FitAwmi</a>(source);</div><div class="line">   <a class="code" href="RtypesCore_8h.html#ab9b5334647b78ec4256db251e3ae1fc6">Double_t</a> *Positions = pfit-&gt;<a class="code" href="classTSpectrumFit.html#a8a292b7c47f79f8ba4aba922a1cf1b96">GetPositions</a>();</div><div class="line">   <a class="code" href="RtypesCore_8h.html#ab9b5334647b78ec4256db251e3ae1fc6">Double_t</a> *PositionsErrors = pfit-&gt;<a class="code" href="classTSpectrumFit.html#ae789e145b7845b6446bf4b3b1011d862">GetPositionsErrors</a>();</div><div class="line">   <a class="code" href="RtypesCore_8h.html#ab9b5334647b78ec4256db251e3ae1fc6">Double_t</a> *Amplitudes = pfit-&gt;<a class="code" href="classTSpectrumFit.html#a864a0275c8403b1dc7effeaef9e94a56">GetAmplitudes</a>();</div><div class="line">   <a class="code" href="RtypesCore_8h.html#ab9b5334647b78ec4256db251e3ae1fc6">Double_t</a> *AmplitudesErrors = pfit-&gt;<a class="code" href="classTSpectrumFit.html#a573dbd8f9b7b74d200d04ef88d73efc9">GetAmplitudesErrors</a>();</div><div class="line">   <a class="code" href="RtypesCore_8h.html#ab9b5334647b78ec4256db251e3ae1fc6">Double_t</a> *Areas = pfit-&gt;<a class="code" href="classTSpectrumFit.html#afd2580d9bd45c7b752043a7bd487c2ab">GetAreas</a>();</div><div class="line">   <a class="code" href="RtypesCore_8h.html#ab9b5334647b78ec4256db251e3ae1fc6">Double_t</a> *AreasErrors = pfit-&gt;<a class="code" href="classTSpectrumFit.html#a5d2af55137e535c26cce0d82e40ba5ec">GetAreasErrors</a>();</div><div class="line">   <span class="keyword">delete</span> <a class="code" href="TROOT_8h.html#a851dd11b3478372a25ba6eff6dcfa5b1">gROOT</a>-&gt;FindObject(<span class="stringliteral">&quot;d&quot;</span>); <span class="comment">// prevent &quot;memory leak&quot;</span></div><div class="line">   <a class="code" href="classTH1F.html">TH1F</a> *<a class="code" href="RSha256_8hxx.html#a23b5b0a85bf5762c93a855f40c0343ce">d</a> = <span class="keyword">new</span> <a class="code" href="classTH1F.html">TH1F</a>(*<a class="code" href="RSha256_8hxx.html#acf9942d15f0dd0ac4fc5ca66096a3f6d">h</a>); <a class="code" href="RSha256_8hxx.html#a23b5b0a85bf5762c93a855f40c0343ce">d</a>-&gt;SetNameTitle(<span class="stringliteral">&quot;d&quot;</span>, <span class="stringliteral">&quot;&quot;</span>); <a class="code" href="RSha256_8hxx.html#a23b5b0a85bf5762c93a855f40c0343ce">d</a>-&gt;Reset(<span class="stringliteral">&quot;M&quot;</span>);</div><div class="line">   <span class="keywordflow">for</span> (i = 0; i &lt; nbins; i++) <a class="code" href="RSha256_8hxx.html#a23b5b0a85bf5762c93a855f40c0343ce">d</a>-&gt;SetBinContent(i + 1, source[i]);</div><div class="line">   <a class="code" href="RtypesCore_8h.html#ab9b5334647b78ec4256db251e3ae1fc6">Double_t</a> <a class="code" href="RooGaussKronrodIntegrator1D_8cxx.html#a568bf3de18e110c0e059ae112eb1996b">x1</a> = <a class="code" href="RSha256_8hxx.html#a23b5b0a85bf5762c93a855f40c0343ce">d</a>-&gt;GetBinCenter(1), dx = <a class="code" href="RSha256_8hxx.html#a23b5b0a85bf5762c93a855f40c0343ce">d</a>-&gt;GetBinWidth(1);</div><div class="line">   <a class="code" href="RtypesCore_8h.html#ab9b5334647b78ec4256db251e3ae1fc6">Double_t</a> <a class="code" href="h1analysisProxy_8h.html#a351c2b9335dfcbe83de6eb9629c2a0e3">sigma</a>, sigmaErr;</div><div class="line">   pfit-&gt;<a class="code" href="classTSpectrumFit.html#a8ee3ea4ffe0808aa20f5aa7bd1e468e5">GetSigma</a>(<a class="code" href="h1analysisProxy_8h.html#a351c2b9335dfcbe83de6eb9629c2a0e3">sigma</a>, sigmaErr);</div><div class="line"></div><div class="line">   <span class="comment">// current TSpectrumFit needs a sqrt(2) correction factor for sigma</span></div><div class="line">   <a class="code" href="h1analysisProxy_8h.html#a351c2b9335dfcbe83de6eb9629c2a0e3">sigma</a> /= <a class="code" href="namespaceTMath.html#a61a2c2cb4ec034e93913cac404639ffb">TMath::Sqrt2</a>(); sigmaErr /= <a class="code" href="namespaceTMath.html#a61a2c2cb4ec034e93913cac404639ffb">TMath::Sqrt2</a>();</div><div class="line">   <span class="comment">// convert &quot;bin numbers&quot; into &quot;x-axis values&quot;</span></div><div class="line">   <a class="code" href="h1analysisProxy_8h.html#a351c2b9335dfcbe83de6eb9629c2a0e3">sigma</a> *= dx; sigmaErr *= dx;</div><div class="line"></div><div class="line">   std::cout &lt;&lt; <span class="stringliteral">&quot;the total number of found peaks = &quot;</span> &lt;&lt; nfound</div><div class="line">             &lt;&lt; <span class="stringliteral">&quot; with sigma = &quot;</span> &lt;&lt; <a class="code" href="h1analysisProxy_8h.html#a351c2b9335dfcbe83de6eb9629c2a0e3">sigma</a> &lt;&lt; <span class="stringliteral">&quot; (+-&quot;</span> &lt;&lt; sigmaErr &lt;&lt; <span class="stringliteral">&quot;)&quot;</span></div><div class="line">             &lt;&lt; std::endl;</div><div class="line">   std::cout &lt;&lt; <span class="stringliteral">&quot;fit chi^2 = &quot;</span> &lt;&lt; pfit-&gt;<a class="code" href="classTSpectrumFit.html#a06a6a60dcfc4fe8ca47c01fd47638135">GetChi</a>() &lt;&lt; std::endl;</div><div class="line">   <span class="keywordflow">for</span> (i = 0; i &lt; nfound; i++) {</div><div class="line">      bin = 1 + <a class="code" href="RtypesCore_8h.html#a3885b911a54b47a4e61671f45dd45d0b">Int_t</a>(Positions[i] + 0.5); <span class="comment">// the &quot;nearest&quot; bin</span></div><div class="line">      Pos[i] = <a class="code" href="RSha256_8hxx.html#a23b5b0a85bf5762c93a855f40c0343ce">d</a>-&gt;GetBinCenter(bin);</div><div class="line">      Amp[i] = <a class="code" href="RSha256_8hxx.html#a23b5b0a85bf5762c93a855f40c0343ce">d</a>-&gt;GetBinContent(bin);</div><div class="line"></div><div class="line">      <span class="comment">// convert &quot;bin numbers&quot; into &quot;x-axis values&quot;</span></div><div class="line">      Positions[i] = <a class="code" href="RooGaussKronrodIntegrator1D_8cxx.html#a568bf3de18e110c0e059ae112eb1996b">x1</a> + Positions[i] * dx;</div><div class="line">      PositionsErrors[i] *= dx;</div><div class="line">      Areas[i] *= dx;</div><div class="line">      AreasErrors[i] *= dx;</div><div class="line"></div><div class="line">      std::cout &lt;&lt; <span class="stringliteral">&quot;found &quot;</span></div><div class="line">                &lt;&lt; Positions[i] &lt;&lt; <span class="stringliteral">&quot; (+-&quot;</span> &lt;&lt; PositionsErrors[i] &lt;&lt; <span class="stringliteral">&quot;) &quot;</span></div><div class="line">                &lt;&lt; Amplitudes[i] &lt;&lt; <span class="stringliteral">&quot; (+-&quot;</span> &lt;&lt; AmplitudesErrors[i] &lt;&lt; <span class="stringliteral">&quot;) &quot;</span></div><div class="line">                &lt;&lt; Areas[i] &lt;&lt; <span class="stringliteral">&quot; (+-&quot;</span> &lt;&lt; AreasErrors[i] &lt;&lt; <span class="stringliteral">&quot;)&quot;</span></div><div class="line">                &lt;&lt; std::endl;</div><div class="line">   }</div><div class="line">   <a class="code" href="RSha256_8hxx.html#a23b5b0a85bf5762c93a855f40c0343ce">d</a>-&gt;SetLineColor(<a class="code" href="Rtypes_8h.html#ac31db05c6cb5891c704eae374f6926a8a5a655b1a02e5b0311571ca57ce4f3900">kRed</a>); <a class="code" href="RSha256_8hxx.html#a23b5b0a85bf5762c93a855f40c0343ce">d</a>-&gt;SetLineWidth(1);</div><div class="line">   <a class="code" href="RSha256_8hxx.html#a23b5b0a85bf5762c93a855f40c0343ce">d</a>-&gt;Draw(<span class="stringliteral">&quot;SAME L&quot;</span>);</div><div class="line">   <a class="code" href="classTPolyMarker.html">TPolyMarker</a> *pm = ((<a class="code" href="classTPolyMarker.html">TPolyMarker</a>*)(<a class="code" href="RSha256_8hxx.html#acf9942d15f0dd0ac4fc5ca66096a3f6d">h</a>-&gt;GetListOfFunctions()-&gt;FindObject(<span class="stringliteral">&quot;TPolyMarker&quot;</span>)));</div><div class="line">   <span class="keywordflow">if</span> (pm) {</div><div class="line">      <a class="code" href="RSha256_8hxx.html#acf9942d15f0dd0ac4fc5ca66096a3f6d">h</a>-&gt;GetListOfFunctions()-&gt;Remove(pm);</div><div class="line">      <span class="keyword">delete</span> pm;</div><div class="line">   }</div><div class="line">   pm = <span class="keyword">new</span> <a class="code" href="classTPolyMarker.html">TPolyMarker</a>(nfound, Pos, Amp);</div><div class="line">   <a class="code" href="RSha256_8hxx.html#acf9942d15f0dd0ac4fc5ca66096a3f6d">h</a>-&gt;GetListOfFunctions()-&gt;Add(pm);</div><div class="line">   pm-&gt;<a class="code" href="classTAttMarker.html#a697e1a65975ff344c9dca7618fd44de4">SetMarkerStyle</a>(23);</div><div class="line">   pm-&gt;<a class="code" href="classTAttMarker.html#a27f1eae16a3f990024e8a401ed034fa3">SetMarkerColor</a>(<a class="code" href="Rtypes_8h.html#ac31db05c6cb5891c704eae374f6926a8a5a655b1a02e5b0311571ca57ce4f3900">kRed</a>);</div><div class="line">   pm-&gt;<a class="code" href="classTAttMarker.html#a95522acfc3fa6157f317f9993edfa047">SetMarkerSize</a>(1);</div><div class="line">   <span class="comment">// cleanup</span></div><div class="line">   <span class="keyword">delete</span> pfit;</div><div class="line">   <span class="keyword">delete</span> [] Amp;</div><div class="line">   <span class="keyword">delete</span> [] FixAmp;</div><div class="line">   <span class="keyword">delete</span> [] FixPos;</div><div class="line">   <span class="keyword">delete</span> <a class="code" href="namespaceTGeant4Unit.html#a5d450e80998065902b102dca2a69066a">s</a>;</div><div class="line">   <span class="keyword">delete</span> [] <a class="code" href="triangle_8c.html#aa22f343c7ac709eab3fdd162721759a1">dest</a>;</div><div class="line">   <span class="keyword">delete</span> [] source;</div><div class="line">   <span class="keywordflow">return</span>;</div><div class="line">}</div></div><!-- fragment --><dl class="section author"><dt>Author</dt><dd></dd></dl>

<p class="definition">Definition in file <a class="el" href="FitAwmi_8C_source.html">FitAwmi.C</a>.</p>
</div></div><!-- contents -->
<html>
<body>
<div id="footer" style="background-color:#E5EBF3;">
<small>
<img class="footer" src="rootlogo_s.gif" alt="root"/></a>
ROOT 6.18/03 - Reference Guide Generated on Thu Aug 29 2019 04:10:28 (GVA Time) using Doxygen 1.8.14.
</small>
</div>
</body>
</html>
