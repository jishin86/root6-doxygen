<!-- HTML header for doxygen 1.8.6-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.14"/>
<title>ROOT: The Virtual Monte Carlo (VMC) Package</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/x-mathjax-config">
  MathJax.Hub.Config({
    extensions: ["tex2jax.js"],
    jax: ["input/TeX","output/HTML-CSS"],
});
</script><script type="text/javascript" async src="./mathjax/MathJax.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="ROOT.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table bgcolor="#346295" cellspacing="0" cellpadding="0">
  <tr>
    <td> <img style="height:90px" alt="Logo" src="rootlogo.gif"/> </td>
    <td valign="middle" style="color: #FFFFFF" nowrap="nowrap"><font size="6">ROOT</font> &#160; 6.18/03 <br> Reference Guide </td>
    <td style="width:100%"> </td>
  </tr>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.14 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

</div><!-- top -->
<div class="header">
  <div class="headertitle">
<div class="title">The Virtual Monte Carlo (VMC) Package </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><h2>Overview</h2>
<p>The VMC package provides an abstract interface for Monte Carlo transport engines. Interfaces are implemented for</p><ul>
<li><a href="https://github.com/vmc-project/geant3">GEANT3</a></li>
<li><a href="https://github.com/vmc-project/geant4_vmc">GEANT4</a></li>
</ul>
<p>each deriving from <code><a class="el" href="classTVirtualMC.html" title="Abstract Monte Carlo interface. ">TVirtualMC</a></code> implementing all necessary methods.</p>
<p>Before a user can instantiate an engine, an object deriving from <code><a class="el" href="classTVirtualMCApplication.html" title="Interface to a user Monte Carlo application. ">TVirtualMCApplication</a></code> needs to be present which has to be implemented by the user. It contains necessary hooks called from the <code><a class="el" href="classTVirtualMC.html" title="Abstract Monte Carlo interface. ">TVirtualMC</a></code>s depending on their internal state. At the same time it provides the bridge between the user code and VMC. For instance, the user code can contain the geometry construction routines somewhere which should be called from the implemented <code>UserApplication::ConstructGeometry()</code>.</p>
<p>Further general information on the VMC project can be found <a href="https://root.cern.ch/vmc">here</a></p>
<h2>Running multiple different engines</h2>
<p>The simulation of an event can be shared among multiple different engines deriving from <code><a class="el" href="classTVirtualMC.html" title="Abstract Monte Carlo interface. ">TVirtualMC</a></code> which are handled by a singleton <code><a class="el" href="classTMCManager.html" title="Singleton manager class for handling and steering a run with multiple TVirtualMC engines sharing even...">TMCManager</a></code> object. In such a scenario the user has to call <code><a class="el" href="classTVirtualMCApplication.html#aa96620d0930adceda9abee4b4421b98c" title="Request a TMCManager which is required if multiple engines should be run. ">TVirtualMCApplication::RequestMCManager()</a></code> in the constructor of the user application. A pointer to the manager object is then available via the protected <code><a class="el" href="classTVirtualMCApplication.html#a0fae08d6e541485282fb8bce7764a166" title="Pointer to requested TMCManager which will only be instantiated by a call to RequestMCManager() ...">TVirtualMCApplication::fMCManager</a></code> but can also be obtained using the static method <code><a class="el" href="classTMCManager.html" title="Singleton manager class for handling and steering a run with multiple TVirtualMC engines sharing even...">TMCManager</a> *TMCManager::Instance()</code>.</p>
<p><code><a class="el" href="classTMCManager.html" title="Singleton manager class for handling and steering a run with multiple TVirtualMC engines sharing even...">TMCManager</a></code> provides the following interfaces:</p>
<ul>
<li><code>void SetUserStack(TVirtualMCStack* userStack)</code> notifies the manager on the user stack such that it will be kept up-to-date during the simulation. Running without having set the user stack is not possible and the <code><a class="el" href="classTMCManager.html" title="Singleton manager class for handling and steering a run with multiple TVirtualMC engines sharing even...">TMCManager</a></code> will abort in that case.</li>
<li><code>void ForwardTrack(Int_t toBeDone, Int_t trackId, Int_t parentId, TParticle* userParticle)</code>: The user is still the owner of all track objects (aka <code><a class="el" href="classTParticle.html" title="Description of the dynamic properties of a particle. ">TParticle</a></code>) being created. Hence, all engine calls to <code><a class="el" href="classTVirtualMCStack.html#ab22feb00ba2ff106f154fd9c96f681ac" title="Create a new particle and push into stack;. ">TVirtualMCStack::PushTrack</a>(...)</code> are forwarded to the user stack. This can then invoke the <code>ForwardTrack(..)</code> method of the manager to pass the pointer to the constructed <code><a class="el" href="classTParticle.html" title="Description of the dynamic properties of a particle. ">TParticle</a></code> object. If a particle should be pushed to an engine other than the one currently running the engine's id has to be provided as the last argument.</li>
<li><code>void TransferTrack(Int_t targetEngineId)</code>: E.g. during <code><a class="el" href="classTVirtualMCApplication.html#acae2636d64f8f430218840543b869e8e" title="Define action at each step. ">TVirtualMCApplication::Stepping()</a></code> the user might decide that the current track should be transferred to another engine, for instance, if a certain volume is entered. Specifying the ID of the target engine the manager will take care of interrupting the track in the current engine, extracting the kinematics and geometry state and it will push this to the stack of the target engine.</li>
<li><code>template &lt;typename F&gt; void Apply(F f)</code> assumes <code>f</code> to implement the <code>()</code> operator and taking a <code><a class="el" href="classTVirtualMC.html" title="Abstract Monte Carlo interface. ">TVirtualMC</a></code> pointer as an arument. <code>f</code> will be then called for all engines.</li>
<li><code>template &lt;typename F&gt; void Init(F f)</code> works as <code><a class="el" href="classTMCManager.html#aac1d27921402f879f794a62697c7e974" title="Apply something to all engines. ">TMCManager::Apply</a></code> during the initialization of the engines. It can also be called without an argument such that no additional user routine is included.</li>
<li><code>void Run(Int_t nEvents)</code> steers a run for the specified number of events.</li>
<li><code>void ConnectEnginePointers(TVirtualMC *&amp;mc)</code> gives the possibility for a user to pass a pointer which will always be set to point to the currently running engine.</li>
<li><code><a class="el" href="classTVirtualMC.html" title="Abstract Monte Carlo interface. ">TVirtualMC</a> *GetCurrentEngine()</code> provides the user with the currently running engine.</li>
</ul>
<p>An example of how the <code><a class="el" href="classTMCManager.html" title="Singleton manager class for handling and steering a run with multiple TVirtualMC engines sharing even...">TMCManager</a></code> is utilized in a multi-run can be found in <code>examples/EME</code> of the <a href="https://github.com/vmc-project/geant4_vmc">GEANT4_VMC repository</a>.</p>
<h3>Workflow</h3>
<p><b>Implementation</b></p><ol type="1">
<li>Implement your application as you have done before. Request the <code><a class="el" href="classTMCManager.html" title="Singleton manager class for handling and steering a run with multiple TVirtualMC engines sharing even...">TMCManager</a></code> in your constructor if needed via <code><a class="el" href="classTVirtualMCApplication.html#aa96620d0930adceda9abee4b4421b98c" title="Request a TMCManager which is required if multiple engines should be run. ">TVirtualMCApplication::RequestMCManager()</a></code></li>
<li>Implement your user stack as you have done before. At an appropriate stage (e.g. in <code>UserStack::PushTrack(...)</code>) you should call <code><a class="el" href="classTMCManager.html#a540426bffeb0ae09550e8230516a1f89" title="User interface to forward particle to specifiic engine. ">TMCManager::ForwardTrack</a>(...)</code> to forward the pointers to your newly constructed <code><a class="el" href="classTParticle.html" title="Description of the dynamic properties of a particle. ">TParticle</a></code> objects.</li>
<li>Set your stack using <code><a class="el" href="classTMCManager.html#aea8bda3e8f3fe5619a1de32b20c41297" title="Set user stack. ">TMCManager::SetUserStack</a>(...)</code>.</li>
</ol>
<p><b>Usage</b></p><ol type="1">
<li>Instantiate your application</li>
<li>Instantiate the engines you want to use.</li>
<li>Call <code><a class="el" href="classTMCManager.html#aad887ad9cc3ecc091938e4d9cb34c229" title="Initialize engines. ">TMCManager::Init</a>(...)</code>.</li>
<li>Call <code><a class="el" href="classTMCManager.html#ae563939304730cf0747061ae7716496a" title="Run the event loop. ">TMCManager::Run</a>(...)</code></li>
</ol>
<p><b>Further comments</b></p>
<p>The geometry is built once centrally via the <code><a class="el" href="classTMCManager.html" title="Singleton manager class for handling and steering a run with multiple TVirtualMC engines sharing even...">TMCManager</a></code> calling</p>
<ol type="1">
<li><code><a class="el" href="classTVirtualMCApplication.html#a3ebd85b9d703779415c5307da6436209" title="Construct user geometry. ">TVirtualMCApplication::ConstructGeometry()</a></code></li>
<li><code><a class="el" href="classTVirtualMCApplication.html#a5f0c903039eb1e4407e7a9a22dbddcad" title="Misalign user geometry (optional) ">TVirtualMCApplication::MisalignGeometry()</a></code></li>
</ol>
<ol type="1">
<li><code><a class="el" href="classTVirtualMCApplication.html#a762e35a5e8df4396e04ea547247d87c4" title="Define parameters for optical processes (optional) ">TVirtualMCApplication::ConstructOpGeometry()</a></code></li>
</ol>
<p>so it is expected that these methods do not depend on any engine.</p>
<p>If multiple engines have been instantiated, never call <code><a class="el" href="classTVirtualMC.html#a89ccac0f8c635323547b214a7a8b49ea" title="Process one run and return true if run has finished successfully, return false in other cases (run ab...">TVirtualMC::ProcessRun</a>(...)</code> or other steering methods on the engine since that would bypass the <code><a class="el" href="classTMCManager.html" title="Singleton manager class for handling and steering a run with multiple TVirtualMC engines sharing even...">TMCManager</a></code> </p>
</div></div><!-- contents -->
<html>
<body>
<div id="footer" style="background-color:#E5EBF3;">
<small>
<img class="footer" src="rootlogo_s.gif" alt="root"/></a>
ROOT 6.18/03 - Reference Guide Generated on Thu Aug 29 2019 04:10:40 (GVA Time) using Doxygen 1.8.14.
</small>
</div>
</body>
</html>
