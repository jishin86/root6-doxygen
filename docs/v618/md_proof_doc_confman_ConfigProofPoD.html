<!-- HTML header for doxygen 1.8.6-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.14"/>
<title>ROOT: Setup a static PROOF cluster with PROOF on Demand</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/x-mathjax-config">
  MathJax.Hub.Config({
    extensions: ["tex2jax.js"],
    jax: ["input/TeX","output/HTML-CSS"],
});
</script><script type="text/javascript" async src="./mathjax/MathJax.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="ROOT.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table bgcolor="#346295" cellspacing="0" cellpadding="0">
  <tr>
    <td> <img style="height:90px" alt="Logo" src="rootlogo.gif"/> </td>
    <td valign="middle" style="color: #FFFFFF" nowrap="nowrap"><font size="6">ROOT</font> &#160; 6.18/03 <br> Reference Guide </td>
    <td style="width:100%"> </td>
  </tr>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.14 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

</div><!-- top -->
<div class="header">
  <div class="headertitle">
<div class="title">Setup a static PROOF cluster with PROOF on Demand </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><h2>Introduction </h2>
<p>Using PROOF on Demand is our current recommended way of running a PROOF cluster. The usage of PoD is in particular helpful for the following reasons:</p>
<ul>
<li><b>Sandboxing.</b> Each user get their own personal PROOF cluster, separated from the others: a problem occurring on one personal cluster does not affect the workflow of other users.</li>
<li><b>Easier administration and self-servicing.</b> A user can restart their personal PROOF cluster in case of troubles without waiting for a system administrator's intervention.</li>
<li><b>Efficient multiuser scheduling.</b> PROOF on Demand makes PROOF run on top of an existing resource management system, moving the problem of scheduling many concurrent users outside of PROOF.</li>
</ul>
<p>This guide particularly refers to the setup of a static PROOF cluster running on physical hosts: the recommended setup is in practice the same as the ready-to-go Virtual Analysis Facility. If you want to use PROOF on the clouds there is no configuration to go through.</p>
<h2>Setup a resource management system </h2>
<p>Although PROOF on Demand can run on a cluster of nodes without using a resource management system (using <code>pod-ssh</code>), it is recommended to setup a dedicated one to benefit from the scheduling in a multiuser environment, or a dedicated queue on an existing one.</p>
<p>As there's a variety of resource management systems, this guide does not cover their setup. The RMS preconfigured for the Virtual Analysis Facility is <a href="http://research.cs.wisc.edu/htcondor/">HTCondor</a>, which we recommend primarily because it has dynamic addition of workers built in.</p>
<h2>Configuration steps for all nodes </h2>
<h3>Setup CernVM-FS</h3>
<p><a href="http://cernvm.cern.ch/portal/filesystem">CernVM-FS</a> should be installed on all machines as the preferred method for software distribution.</p>
<blockquote class="doxtable">
<p>Configuration instructions for the latest CernVM-FS can be found <a href="http://cernvm.cern.ch/portal/filesystem/techinformation">here</a>. </p>
</blockquote>
<p>A brief step-by-step procedure to install CernVM-FS is hereby described.</p>
<ul>
<li>Download and install the latest stable version from <a href="http://cernvm.cern.ch/portal/filesystem">here</a>: pick one which is appropriate to your operating system. You need the <code>cvmfs</code> package, you <em>don't</em> need the <code>cvmfs-devel</code> or <code>cvmfs-server</code> ones.</li>
<li>As root user, run: <pre class="fragment"># cvmfs_config setup
</pre></li>
<li><p class="startli">Start the <code>autofs</code> service: how to to this depends on your operating system.</p>
<p class="startli">On Ubuntu using Upstart: </p><pre class="fragment"># restart autofs
</pre><p class="startli">On RHEL-based or older Ubuntus: </p><pre class="fragment"># service autofs restart
</pre></li>
<li><p class="startli">Prepare a <code>/etc/cvmfs/default.local</code> file (create it if it does not exists) with the following configuration bits:</p>
<p class="startli">``` {.bash} CVMFS_HTTP_PROXY=<a href="http://your-proxy-server.domain.ch:3128,DIRECT">http://your-proxy-server.domain.ch:3128,DIRECT</a> CVMFS_REPOSITORIES=your-experiment.cern.ch,sft.cern.ch CVMFS_QUOTA_LIMIT=50000 ```</p>
<p class="startli">You need to properly specify your closest HTTP caching proxy: separate many of them via commas. The last fallback value, <code>DIRECT</code>, tells cvmfs to connect directly without using any proxy at all.</p>
<p class="startli">Among the list of repositories (comma-separated), always specify <code>sft.cern.ch</code> and the one containing the software to your experiment (e.g., <code>cms.cern.ch</code>).</p>
<p class="startli">The quota limit is, in Megabytes, the amount of local disk space to use as cache.</p>
</li>
<li>Check the configuration and repositories with: <pre class="fragment"># cvmfs_config chksetup
OK
# cvmfs_config probe
Probing /cvmfs/cms.cern.ch... OK
Probing /cvmfs/sft.cern.ch... OK
</pre></li>
</ul>
<blockquote class="doxtable">
<p>You might need special configurations for some custom software repositories! Special cases are not covered in this guide. </p>
</blockquote>
<h3>Firewall configuration</h3>
<p><a href="http://pod.gsi.de/">PROOF on Demand</a> is very flexible in handling various cases of network topologies. The best solution would be to allow all TCP communications between the cluster machines.</p>
<p>No other incoming communication is required from the outside.</p>
<h2>Configuration steps for the head node only </h2>
<h3>Setup HTTPS+SSH (sshcertauth) authentication</h3>
<blockquote class="doxtable">
<p>Latest recommended sshcertauth version is 0.8.5.</p>
<p><a href="https://github.com/dberzano/sshcertauth/archive/v0.8.5.zip">Download</a> and <a href="http://newton.ph.unito.it/~berzano/w/doku.php?id=proof:sshcertauth">read the instructions</a>. </p>
</blockquote>
<p>If you want your users to connect to the PROOF cluster using their Grid user certificate and private key you might be interested in installing sshcertauth. Please refer to the <a href="http://newton.ph.unito.it/~berzano/w/doku.php?id=proof:sshcertauth">installation guide</a> for further information.</p>
<h3>PROOF on Demand</h3>
<blockquote class="doxtable">
<p>Latest recommended PROOF on Demand version is 3.12.</p>
<p><b>On CernVM-FS:</b> <code>/cvmfs/sft.cern.ch/lcg/external/PoD/3.12</code></p>
<p><b>Source code:</b> <a href="http://pod.gsi.de/download.html">PoD download page</a> and <a href="http://pod.gsi.de/doc/3.12/Installation.html">Installation instructions</a> </p>
</blockquote>
<p><a href="http://pod.gsi.de/">PROOF on Demand</a> is required on the head node and on the user's client.</p>
<p>In case your experiment provides a version of PoD on CernVM-FS you can use that one. Experiment-independent versions are available from the PH-SFT cvmfs repository.</p>
<p>Only if you have specific reasons while you want to use a customly built PoD version, download the source code and compile it using the installation instructions.</p>
<p>Please note that <a href="http://www.cmake.org/">CMake</a> and <a href="http://www.boost.org/">Boost</a> are required to build PoD.</p>
<ul>
<li>After you have built PoD, install it with: <pre class="fragment">make install
</pre></li>
<li><p class="startli">After installing PoD, run: </p><pre class="fragment">pod-server getbins
</pre><p class="startli">This has to be done only once and downloads the binary packages that will be dynamically transferred to the worker nodes as binary payload, and prevents us from installing PoD on each cluster node.</p>
<p class="startli">It is important to do this step now, because in case PoD has been installed in a directory where the user has no write privileges, as in the case of system-wide installations, the user won't be able to download those required packages in the PoD binary directory.</p>
</li>
</ul>
<blockquote class="doxtable">
<p>There is no need to "configure" PoD for your specific cluster: it is just enough to install it on your head node.</p>
<p>PoD does not have any system-wide persistent daemon running or any system-wide configuration to be performed. Also, no part of PoD will be ever run as root.</p>
<p>Do not worry about environment or software configuration at this time: there is no system configuration for that. All the environment for your software dependencies will be set via proper scripts from the PoD client.</p>
<p>PoD client configuration and running is properly covered in the appropriate manual page. </p>
</blockquote>
<h3>Firewall configuration</h3>
<p>The head node only requires <b>TCP ports 22 (SSH) and 443 (HTTPS)</b> to accept connections from the outside. Users will get an authentication "token" from port 443 and all PROOF traffic will be automatically tunneled in a SSH connection on port 22 by PoD.</p>
<p>In case you are not using the HTTPS+SSH token+authentication method, access to the sole port 22 is all you need. </p>
</div></div><!-- contents -->
<html>
<body>
<div id="footer" style="background-color:#E5EBF3;">
<small>
<img class="footer" src="rootlogo_s.gif" alt="root"/></a>
ROOT 6.18/03 - Reference Guide Generated on Thu Aug 29 2019 04:10:40 (GVA Time) using Doxygen 1.8.14.
</small>
</div>
</body>
</html>
