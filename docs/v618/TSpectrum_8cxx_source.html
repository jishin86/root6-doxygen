<!-- HTML header for doxygen 1.8.6-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.14"/>
<title>ROOT: hist/spectrum/src/TSpectrum.cxx Source File</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/x-mathjax-config">
  MathJax.Hub.Config({
    extensions: ["tex2jax.js"],
    jax: ["input/TeX","output/HTML-CSS"],
});
</script><script type="text/javascript" async src="./mathjax/MathJax.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="ROOT.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table bgcolor="#346295" cellspacing="0" cellpadding="0">
  <tr>
    <td> <img style="height:90px" alt="Logo" src="rootlogo.gif"/> </td>
    <td valign="middle" style="color: #FFFFFF" nowrap="nowrap"><font size="6">ROOT</font> &#160; 6.18/03 <br> Reference Guide </td>
    <td style="width:100%"> </td>
  </tr>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.14 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div id="nav-path" class="navpath">
  <ul>
<li class="navelem"><a class="el" href="dir_8b9334156f3646fccf89e63b9869c7f9.html">hist</a></li><li class="navelem"><a class="el" href="dir_4ba217a18a1577d50b5101554d250fb7.html">spectrum</a></li><li class="navelem"><a class="el" href="dir_951b72617a0dcb03fe7fe95e0ea59f90.html">src</a></li>  </ul>
</div>
</div><!-- top -->
<div class="header">
  <div class="headertitle">
<div class="title">TSpectrum.cxx</div>  </div>
</div><!--header-->
<div class="contents">
<a href="TSpectrum_8cxx.html">Go to the documentation of this file.</a><div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;<span class="comment">// @(#)root/spectrum:$Id$</span></div><div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;<span class="comment">// Author: Miroslav Morhac   27/05/99</span></div><div class="line"><a name="l00003"></a><span class="lineno">    3</span>&#160;</div><div class="line"><a name="l00004"></a><span class="lineno">    4</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="TSpectrum_8h.html">TSpectrum.h</a>&quot;</span></div><div class="line"><a name="l00005"></a><span class="lineno">    5</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="TPolyMarker_8h.html">TPolyMarker.h</a>&quot;</span></div><div class="line"><a name="l00006"></a><span class="lineno">    6</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="TVirtualPad_8h.html">TVirtualPad.h</a>&quot;</span></div><div class="line"><a name="l00007"></a><span class="lineno">    7</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="TList_8h.html">TList.h</a>&quot;</span></div><div class="line"><a name="l00008"></a><span class="lineno">    8</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="TH1_8h.html">TH1.h</a>&quot;</span></div><div class="line"><a name="l00009"></a><span class="lineno">    9</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="TMath_8h.html">TMath.h</a>&quot;</span></div><div class="line"><a name="l00010"></a><span class="lineno">   10</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00011"></a><span class="lineno">   11</span>&#160;<span class="comment">/** \class TSpectrum</span></div><div class="line"><a name="l00012"></a><span class="lineno">   12</span>&#160;<span class="comment">    \ingroup Spectrum</span></div><div class="line"><a name="l00013"></a><span class="lineno">   13</span>&#160;<span class="comment">    \brief Advanced Spectra Processing</span></div><div class="line"><a name="l00014"></a><span class="lineno">   14</span>&#160;<span class="comment">    \author Miroslav Morhac</span></div><div class="line"><a name="l00015"></a><span class="lineno">   15</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00016"></a><span class="lineno">   16</span>&#160;<span class="comment"> This class contains advanced spectra processing functions for:</span></div><div class="line"><a name="l00017"></a><span class="lineno">   17</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00018"></a><span class="lineno">   18</span>&#160;<span class="comment"> -   One-dimensional background estimation</span></div><div class="line"><a name="l00019"></a><span class="lineno">   19</span>&#160;<span class="comment"> -   One-dimensional smoothing</span></div><div class="line"><a name="l00020"></a><span class="lineno">   20</span>&#160;<span class="comment"> -   One-dimensional deconvolution</span></div><div class="line"><a name="l00021"></a><span class="lineno">   21</span>&#160;<span class="comment"> -   One-dimensional peak search</span></div><div class="line"><a name="l00022"></a><span class="lineno">   22</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00023"></a><span class="lineno">   23</span>&#160;<span class="comment"> The algorithms in this class have been published in the following references:</span></div><div class="line"><a name="l00024"></a><span class="lineno">   24</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00025"></a><span class="lineno">   25</span>&#160;<span class="comment"> 1.  M.Morhac et al.: Background elimination methods for multidimensional coincidence gamma-ray spectra. Nuclear Instruments and Methods in Physics Research A 401 (1997) 113-132.</span></div><div class="line"><a name="l00026"></a><span class="lineno">   26</span>&#160;<span class="comment"> 2.  M.Morhac et al.: Efficient one- and two-dimensional Gold deconvolution and its application to gamma-ray spectra decomposition. Nuclear Instruments and Methods in Physics Research A 401 (1997) 385-408.</span></div><div class="line"><a name="l00027"></a><span class="lineno">   27</span>&#160;<span class="comment"> 3.  M.Morhac et al.: Identification of peaks in multidimensional coincidence gamma-ray spectra. Nuclear Instruments and Methods in Research Physics A 443(2000), 108-125.</span></div><div class="line"><a name="l00028"></a><span class="lineno">   28</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00029"></a><span class="lineno">   29</span>&#160;<span class="comment"> These NIM papers are also available as doc or ps files from:</span></div><div class="line"><a name="l00030"></a><span class="lineno">   30</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00031"></a><span class="lineno">   31</span>&#160;<span class="comment"> - [Spectrum.doc](https://root.cern.ch/download/Spectrum.doc)</span></div><div class="line"><a name="l00032"></a><span class="lineno">   32</span>&#160;<span class="comment"> - [SpectrumDec.ps.gz](https://root.cern.ch/download/SpectrumDec.ps.gz)</span></div><div class="line"><a name="l00033"></a><span class="lineno">   33</span>&#160;<span class="comment"> - [SpectrumSrc.ps.gz](https://root.cern.ch/download/SpectrumSrc.ps.gz)</span></div><div class="line"><a name="l00034"></a><span class="lineno">   34</span>&#160;<span class="comment"> - [SpectrumBck.ps.gz](https://root.cern.ch/download/SpectrumBck.ps.gz)</span></div><div class="line"><a name="l00035"></a><span class="lineno">   35</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00036"></a><span class="lineno">   36</span>&#160;<span class="comment"> See also the</span></div><div class="line"><a name="l00037"></a><span class="lineno">   37</span>&#160;<span class="comment"> [online documentation](https://root.cern.ch/guides/tspectrum-manual) and</span></div><div class="line"><a name="l00038"></a><span class="lineno">   38</span>&#160;<span class="comment"> [tutorials](https://root.cern.ch/doc/master/group__tutorial__spectrum.html).</span></div><div class="line"><a name="l00039"></a><span class="lineno">   39</span>&#160;<span class="comment">*/</span></div><div class="line"><a name="l00040"></a><span class="lineno">   40</span>&#160;</div><div class="line"><a name="l00041"></a><span class="lineno">   41</span>&#160;<a class="code" href="RtypesCore_8h.html#a3885b911a54b47a4e61671f45dd45d0b">Int_t</a> <a class="code" href="classTSpectrum.html#ac5b94cc0438601683a9719a217659554">TSpectrum::fgIterations</a>    = 3;</div><div class="line"><a name="l00042"></a><span class="lineno">   42</span>&#160;<a class="code" href="RtypesCore_8h.html#a3885b911a54b47a4e61671f45dd45d0b">Int_t</a> <a class="code" href="classTSpectrum.html#aa32e2d562913b811498683ef6628b494">TSpectrum::fgAverageWindow</a> = 3;</div><div class="line"><a name="l00043"></a><span class="lineno">   43</span>&#160;</div><div class="line"><a name="l00044"></a><span class="lineno"><a class="line" href="TSpectrum_8cxx.html#ade09a69507390390f0d1bd5b7d91826c">   44</a></span>&#160;<span class="preprocessor">#define PEAK_WINDOW 1024</span></div><div class="line"><a name="l00045"></a><span class="lineno">   45</span>&#160;<a class="code" href="Rtypes_8h.html#a3f9bf160bbbb44209e95556960836b96">ClassImp</a>(<a class="code" href="classTSpectrum.html">TSpectrum</a>);</div><div class="line"><a name="l00046"></a><span class="lineno">   46</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00047"></a><span class="lineno">   47</span>&#160;<span class="comment">////////////////////////////////////////////////////////////////////////////////</span></div><div class="line"><a name="l00048"></a><span class="lineno">   48</span>&#160;<span class="comment">/// Constructor.</span></div><div class="line"><a name="l00049"></a><span class="lineno">   49</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00050"></a><span class="lineno"><a class="line" href="classTSpectrum.html#a53f173c4f5b494badfdd86c4d989af8b">   50</a></span>&#160;<a class="code" href="classTSpectrum.html#a53f173c4f5b494badfdd86c4d989af8b">TSpectrum::TSpectrum</a>() :<a class="code" href="classTNamed.html">TNamed</a>(<span class="stringliteral">&quot;Spectrum&quot;</span>, <span class="stringliteral">&quot;Miroslav Morhac peak finder&quot;</span>)</div><div class="line"><a name="l00051"></a><span class="lineno">   51</span>&#160;{</div><div class="line"><a name="l00052"></a><span class="lineno">   52</span>&#160;   <a class="code" href="RtypesCore_8h.html#a3885b911a54b47a4e61671f45dd45d0b">Int_t</a> <a class="code" href="legend1_8C.html#a16daaa7b596941b23915a1ac1be5b42c">n</a> = 100;</div><div class="line"><a name="l00053"></a><span class="lineno">   53</span>&#160;   <a class="code" href="classTSpectrum.html#a10e78d271e709357110ae070b47d3add">fMaxPeaks</a>  = <a class="code" href="legend1_8C.html#a16daaa7b596941b23915a1ac1be5b42c">n</a>;</div><div class="line"><a name="l00054"></a><span class="lineno">   54</span>&#160;   <a class="code" href="classTSpectrum.html#ab2eb713ff50f5ea77d1b456ef4aeee93">fPosition</a>   = <span class="keyword">new</span> <a class="code" href="RtypesCore_8h.html#ab9b5334647b78ec4256db251e3ae1fc6">Double_t</a>[<a class="code" href="legend1_8C.html#a16daaa7b596941b23915a1ac1be5b42c">n</a>];</div><div class="line"><a name="l00055"></a><span class="lineno">   55</span>&#160;   <a class="code" href="classTSpectrum.html#a186f7fab91729aabbd19b446d57ba427">fPositionX</a>  = <span class="keyword">new</span> <a class="code" href="RtypesCore_8h.html#ab9b5334647b78ec4256db251e3ae1fc6">Double_t</a>[<a class="code" href="legend1_8C.html#a16daaa7b596941b23915a1ac1be5b42c">n</a>];</div><div class="line"><a name="l00056"></a><span class="lineno">   56</span>&#160;   <a class="code" href="classTSpectrum.html#afc1624f993eab0e8c1b77db06a3bf839">fPositionY</a>  = <span class="keyword">new</span> <a class="code" href="RtypesCore_8h.html#ab9b5334647b78ec4256db251e3ae1fc6">Double_t</a>[<a class="code" href="legend1_8C.html#a16daaa7b596941b23915a1ac1be5b42c">n</a>];</div><div class="line"><a name="l00057"></a><span class="lineno">   57</span>&#160;   <a class="code" href="classTSpectrum.html#a02fdb00792c69d8b34aa78e42b6682e1">fResolution</a> = 1;</div><div class="line"><a name="l00058"></a><span class="lineno">   58</span>&#160;   <a class="code" href="classTSpectrum.html#ad354948fc1ff381b6e32d9b787ff7207">fHistogram</a>  = 0;</div><div class="line"><a name="l00059"></a><span class="lineno">   59</span>&#160;   <a class="code" href="classTSpectrum.html#a63a4881270541655c2535c46ec52ce6d">fNPeaks</a>     = 0;</div><div class="line"><a name="l00060"></a><span class="lineno">   60</span>&#160;}</div><div class="line"><a name="l00061"></a><span class="lineno">   61</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00062"></a><span class="lineno">   62</span>&#160;<span class="comment">////////////////////////////////////////////////////////////////////////////////</span></div><div class="line"><a name="l00063"></a><span class="lineno">   63</span>&#160;<span class="comment">///   - maxpositions: maximum number of peaks</span></div><div class="line"><a name="l00064"></a><span class="lineno">   64</span>&#160;<span class="comment">///   - resolution: *NOT USED* determines resolution of the neighbouring peaks</span></div><div class="line"><a name="l00065"></a><span class="lineno">   65</span>&#160;<span class="comment">///                   default value is 1 correspond to 3 sigma distance</span></div><div class="line"><a name="l00066"></a><span class="lineno">   66</span>&#160;<span class="comment">///                   between peaks. Higher values allow higher resolution</span></div><div class="line"><a name="l00067"></a><span class="lineno">   67</span>&#160;<span class="comment">///                   (smaller distance between peaks.</span></div><div class="line"><a name="l00068"></a><span class="lineno">   68</span>&#160;<span class="comment">///                   May be set later through SetResolution.</span></div><div class="line"><a name="l00069"></a><span class="lineno">   69</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00070"></a><span class="lineno"><a class="line" href="classTSpectrum.html#aba44d2bb23b8e5db9b495a9dafb41d3b">   70</a></span>&#160;<a class="code" href="classTSpectrum.html#a53f173c4f5b494badfdd86c4d989af8b">TSpectrum::TSpectrum</a>(<a class="code" href="RtypesCore_8h.html#a3885b911a54b47a4e61671f45dd45d0b">Int_t</a> maxpositions, <a class="code" href="RtypesCore_8h.html#ab9b5334647b78ec4256db251e3ae1fc6">Double_t</a> resolution)</div><div class="line"><a name="l00071"></a><span class="lineno">   71</span>&#160;          :<a class="code" href="classTNamed.html">TNamed</a>(<span class="stringliteral">&quot;Spectrum&quot;</span>, <span class="stringliteral">&quot;Miroslav Morhac peak finder&quot;</span>)</div><div class="line"><a name="l00072"></a><span class="lineno">   72</span>&#160;{</div><div class="line"><a name="l00073"></a><span class="lineno">   73</span>&#160;   <a class="code" href="RtypesCore_8h.html#a3885b911a54b47a4e61671f45dd45d0b">Int_t</a> <a class="code" href="legend1_8C.html#a16daaa7b596941b23915a1ac1be5b42c">n</a> = maxpositions;</div><div class="line"><a name="l00074"></a><span class="lineno">   74</span>&#160;   <span class="keywordflow">if</span> (<a class="code" href="legend1_8C.html#a16daaa7b596941b23915a1ac1be5b42c">n</a> &lt;= 0) <a class="code" href="legend1_8C.html#a16daaa7b596941b23915a1ac1be5b42c">n</a> = 1;</div><div class="line"><a name="l00075"></a><span class="lineno">   75</span>&#160;   <a class="code" href="classTSpectrum.html#a10e78d271e709357110ae070b47d3add">fMaxPeaks</a>  = <a class="code" href="legend1_8C.html#a16daaa7b596941b23915a1ac1be5b42c">n</a>;</div><div class="line"><a name="l00076"></a><span class="lineno">   76</span>&#160;   <a class="code" href="classTSpectrum.html#ab2eb713ff50f5ea77d1b456ef4aeee93">fPosition</a>  = <span class="keyword">new</span> <a class="code" href="RtypesCore_8h.html#ab9b5334647b78ec4256db251e3ae1fc6">Double_t</a>[<a class="code" href="legend1_8C.html#a16daaa7b596941b23915a1ac1be5b42c">n</a>];</div><div class="line"><a name="l00077"></a><span class="lineno">   77</span>&#160;   <a class="code" href="classTSpectrum.html#a186f7fab91729aabbd19b446d57ba427">fPositionX</a> = <span class="keyword">new</span> <a class="code" href="RtypesCore_8h.html#ab9b5334647b78ec4256db251e3ae1fc6">Double_t</a>[<a class="code" href="legend1_8C.html#a16daaa7b596941b23915a1ac1be5b42c">n</a>];</div><div class="line"><a name="l00078"></a><span class="lineno">   78</span>&#160;   <a class="code" href="classTSpectrum.html#afc1624f993eab0e8c1b77db06a3bf839">fPositionY</a> = <span class="keyword">new</span> <a class="code" href="RtypesCore_8h.html#ab9b5334647b78ec4256db251e3ae1fc6">Double_t</a>[<a class="code" href="legend1_8C.html#a16daaa7b596941b23915a1ac1be5b42c">n</a>];</div><div class="line"><a name="l00079"></a><span class="lineno">   79</span>&#160;   <a class="code" href="classTSpectrum.html#ad354948fc1ff381b6e32d9b787ff7207">fHistogram</a> = 0;</div><div class="line"><a name="l00080"></a><span class="lineno">   80</span>&#160;   <a class="code" href="classTSpectrum.html#a63a4881270541655c2535c46ec52ce6d">fNPeaks</a>    = 0;</div><div class="line"><a name="l00081"></a><span class="lineno">   81</span>&#160;   <a class="code" href="classTSpectrum.html#a46b603bd0a41f8fa7c2501e164c05b54">SetResolution</a>(resolution);</div><div class="line"><a name="l00082"></a><span class="lineno">   82</span>&#160;}</div><div class="line"><a name="l00083"></a><span class="lineno">   83</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00084"></a><span class="lineno">   84</span>&#160;<span class="comment">////////////////////////////////////////////////////////////////////////////////</span></div><div class="line"><a name="l00085"></a><span class="lineno">   85</span>&#160;<span class="comment">///   Destructor.</span></div><div class="line"><a name="l00086"></a><span class="lineno">   86</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00087"></a><span class="lineno"><a class="line" href="classTSpectrum.html#a4db923aa44f312b9b41074d95d242ae9">   87</a></span>&#160;<a class="code" href="classTSpectrum.html#a4db923aa44f312b9b41074d95d242ae9">TSpectrum::~TSpectrum</a>()</div><div class="line"><a name="l00088"></a><span class="lineno">   88</span>&#160;{</div><div class="line"><a name="l00089"></a><span class="lineno">   89</span>&#160;   <span class="keyword">delete</span> [] <a class="code" href="classTSpectrum.html#ab2eb713ff50f5ea77d1b456ef4aeee93">fPosition</a>;</div><div class="line"><a name="l00090"></a><span class="lineno">   90</span>&#160;   <span class="keyword">delete</span> [] <a class="code" href="classTSpectrum.html#a186f7fab91729aabbd19b446d57ba427">fPositionX</a>;</div><div class="line"><a name="l00091"></a><span class="lineno">   91</span>&#160;   <span class="keyword">delete</span> [] <a class="code" href="classTSpectrum.html#afc1624f993eab0e8c1b77db06a3bf839">fPositionY</a>;</div><div class="line"><a name="l00092"></a><span class="lineno">   92</span>&#160;   <span class="keyword">delete</span>    <a class="code" href="classTSpectrum.html#ad354948fc1ff381b6e32d9b787ff7207">fHistogram</a>;</div><div class="line"><a name="l00093"></a><span class="lineno">   93</span>&#160;}</div><div class="line"><a name="l00094"></a><span class="lineno">   94</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00095"></a><span class="lineno">   95</span>&#160;<span class="comment">////////////////////////////////////////////////////////////////////////////////</span></div><div class="line"><a name="l00096"></a><span class="lineno">   96</span>&#160;<span class="comment">///   Static function: Set average window of searched peaks</span></div><div class="line"><a name="l00097"></a><span class="lineno">   97</span>&#160;<span class="comment">///   (see TSpectrum::SearchHighRes).</span></div><div class="line"><a name="l00098"></a><span class="lineno">   98</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00099"></a><span class="lineno"><a class="line" href="classTSpectrum.html#abecd47dabed3e5b94893cc6e15ba6cd3">   99</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="classTSpectrum.html#abecd47dabed3e5b94893cc6e15ba6cd3">TSpectrum::SetAverageWindow</a>(<a class="code" href="RtypesCore_8h.html#a3885b911a54b47a4e61671f45dd45d0b">Int_t</a> w)</div><div class="line"><a name="l00100"></a><span class="lineno">  100</span>&#160;{</div><div class="line"><a name="l00101"></a><span class="lineno">  101</span>&#160;   <a class="code" href="classTSpectrum.html#aa32e2d562913b811498683ef6628b494">fgAverageWindow</a> = w;</div><div class="line"><a name="l00102"></a><span class="lineno">  102</span>&#160;}</div><div class="line"><a name="l00103"></a><span class="lineno">  103</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00104"></a><span class="lineno">  104</span>&#160;<span class="comment">////////////////////////////////////////////////////////////////////////////////</span></div><div class="line"><a name="l00105"></a><span class="lineno">  105</span>&#160;<span class="comment">///   Static function: Set max number of decon iterations in deconvolution</span></div><div class="line"><a name="l00106"></a><span class="lineno">  106</span>&#160;<span class="comment">///   operation (see TSpectrum::SearchHighRes).</span></div><div class="line"><a name="l00107"></a><span class="lineno">  107</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00108"></a><span class="lineno"><a class="line" href="classTSpectrum.html#aaddbb07c90d5659a6dcee8e1f3c1c801">  108</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="classTSpectrum.html#aaddbb07c90d5659a6dcee8e1f3c1c801">TSpectrum::SetDeconIterations</a>(<a class="code" href="RtypesCore_8h.html#a3885b911a54b47a4e61671f45dd45d0b">Int_t</a> <a class="code" href="legend1_8C.html#a16daaa7b596941b23915a1ac1be5b42c">n</a>)</div><div class="line"><a name="l00109"></a><span class="lineno">  109</span>&#160;{</div><div class="line"><a name="l00110"></a><span class="lineno">  110</span>&#160;   <a class="code" href="classTSpectrum.html#ac5b94cc0438601683a9719a217659554">fgIterations</a> = <a class="code" href="legend1_8C.html#a16daaa7b596941b23915a1ac1be5b42c">n</a>;</div><div class="line"><a name="l00111"></a><span class="lineno">  111</span>&#160;}</div><div class="line"><a name="l00112"></a><span class="lineno">  112</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00113"></a><span class="lineno">  113</span>&#160;<span class="comment">////////////////////////////////////////////////////////////////////////////////</span></div><div class="line"><a name="l00114"></a><span class="lineno">  114</span>&#160;<span class="comment">///   One-dimensional background estimation function.</span></div><div class="line"><a name="l00115"></a><span class="lineno">  115</span>&#160;<span class="comment">///</span></div><div class="line"><a name="l00116"></a><span class="lineno">  116</span>&#160;<span class="comment">///   This function calculates the background spectrum in the input histogram h.</span></div><div class="line"><a name="l00117"></a><span class="lineno">  117</span>&#160;<span class="comment">///   The background is returned as a histogram.</span></div><div class="line"><a name="l00118"></a><span class="lineno">  118</span>&#160;<span class="comment">///</span></div><div class="line"><a name="l00119"></a><span class="lineno">  119</span>&#160;<span class="comment">/// #### Parameters:</span></div><div class="line"><a name="l00120"></a><span class="lineno">  120</span>&#160;<span class="comment">///</span></div><div class="line"><a name="l00121"></a><span class="lineno">  121</span>&#160;<span class="comment">///   - h: input 1-d histogram</span></div><div class="line"><a name="l00122"></a><span class="lineno">  122</span>&#160;<span class="comment">///   - numberIterations, (default value = 20)</span></div><div class="line"><a name="l00123"></a><span class="lineno">  123</span>&#160;<span class="comment">///      Increasing numberIterations make the result smoother and lower.</span></div><div class="line"><a name="l00124"></a><span class="lineno">  124</span>&#160;<span class="comment">///   - option: may contain one of the following options:</span></div><div class="line"><a name="l00125"></a><span class="lineno">  125</span>&#160;<span class="comment">///</span></div><div class="line"><a name="l00126"></a><span class="lineno">  126</span>&#160;<span class="comment">///      - to set the direction parameter</span></div><div class="line"><a name="l00127"></a><span class="lineno">  127</span>&#160;<span class="comment">///      &quot;BackIncreasingWindow&quot;. By default the direction is BackDecreasingWindow</span></div><div class="line"><a name="l00128"></a><span class="lineno">  128</span>&#160;<span class="comment">///      - filterOrder-order of clipping filter,  (default &quot;BackOrder2&quot;)</span></div><div class="line"><a name="l00129"></a><span class="lineno">  129</span>&#160;<span class="comment">///                  -possible values= &quot;BackOrder4&quot;</span></div><div class="line"><a name="l00130"></a><span class="lineno">  130</span>&#160;<span class="comment">///                                    &quot;BackOrder6&quot;</span></div><div class="line"><a name="l00131"></a><span class="lineno">  131</span>&#160;<span class="comment">///                                    &quot;BackOrder8&quot;</span></div><div class="line"><a name="l00132"></a><span class="lineno">  132</span>&#160;<span class="comment">///      - &quot;nosmoothing&quot;- if selected, the background is not smoothed</span></div><div class="line"><a name="l00133"></a><span class="lineno">  133</span>&#160;<span class="comment">///           By default the background is smoothed.</span></div><div class="line"><a name="l00134"></a><span class="lineno">  134</span>&#160;<span class="comment">///      - smoothWindow-width of smoothing window, (default is &quot;BackSmoothing3&quot;)</span></div><div class="line"><a name="l00135"></a><span class="lineno">  135</span>&#160;<span class="comment">///                  -possible values= &quot;BackSmoothing5&quot;</span></div><div class="line"><a name="l00136"></a><span class="lineno">  136</span>&#160;<span class="comment">///                                    &quot;BackSmoothing7&quot;</span></div><div class="line"><a name="l00137"></a><span class="lineno">  137</span>&#160;<span class="comment">///                                    &quot;BackSmoothing9&quot;</span></div><div class="line"><a name="l00138"></a><span class="lineno">  138</span>&#160;<span class="comment">///                                    &quot;BackSmoothing11&quot;</span></div><div class="line"><a name="l00139"></a><span class="lineno">  139</span>&#160;<span class="comment">///                                    &quot;BackSmoothing13&quot;</span></div><div class="line"><a name="l00140"></a><span class="lineno">  140</span>&#160;<span class="comment">///                                    &quot;BackSmoothing15&quot;</span></div><div class="line"><a name="l00141"></a><span class="lineno">  141</span>&#160;<span class="comment">///      - &quot;Compton&quot; if selected the estimation of Compton edge</span></div><div class="line"><a name="l00142"></a><span class="lineno">  142</span>&#160;<span class="comment">///                  will be included.</span></div><div class="line"><a name="l00143"></a><span class="lineno">  143</span>&#160;<span class="comment">///      - &quot;same&quot; : if this option is specified, the resulting background</span></div><div class="line"><a name="l00144"></a><span class="lineno">  144</span>&#160;<span class="comment">///                 histogram is superimposed on the picture in the current pad.</span></div><div class="line"><a name="l00145"></a><span class="lineno">  145</span>&#160;<span class="comment">///</span></div><div class="line"><a name="l00146"></a><span class="lineno">  146</span>&#160;<span class="comment">///   NOTE that the background is only evaluated in the current range of h.</span></div><div class="line"><a name="l00147"></a><span class="lineno">  147</span>&#160;<span class="comment">///   ie, if h has a bin range (set via `h-&gt;GetXaxis()-&gt;SetRange(binmin,binmax)`,</span></div><div class="line"><a name="l00148"></a><span class="lineno">  148</span>&#160;<span class="comment">///   the returned histogram will be created with the same number of bins</span></div><div class="line"><a name="l00149"></a><span class="lineno">  149</span>&#160;<span class="comment">///   as the input histogram h, but only bins from `binmin` to `binmax` will be filled</span></div><div class="line"><a name="l00150"></a><span class="lineno">  150</span>&#160;<span class="comment">///   with the estimated background.</span></div><div class="line"><a name="l00151"></a><span class="lineno">  151</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00152"></a><span class="lineno"><a class="line" href="classTSpectrum.html#a56e15d1c36c7557b17d5f6d68fa315a7">  152</a></span>&#160;<a class="code" href="classTH1.html">TH1</a> *<a class="code" href="classTSpectrum.html#a56e15d1c36c7557b17d5f6d68fa315a7">TSpectrum::Background</a>(<span class="keyword">const</span> <a class="code" href="classTH1.html">TH1</a> * <a class="code" href="RSha256_8hxx.html#acf9942d15f0dd0ac4fc5ca66096a3f6d">h</a>, <span class="keywordtype">int</span> numberIterations,</div><div class="line"><a name="l00153"></a><span class="lineno">  153</span>&#160;                           <a class="code" href="RtypesCore_8h.html#afc405399e08793afdff5b4692827b2a1">Option_t</a> * option)</div><div class="line"><a name="l00154"></a><span class="lineno">  154</span>&#160;{</div><div class="line"><a name="l00155"></a><span class="lineno">  155</span>&#160;   <span class="keywordflow">if</span> (<a class="code" href="RSha256_8hxx.html#acf9942d15f0dd0ac4fc5ca66096a3f6d">h</a> == 0) <span class="keywordflow">return</span> 0;</div><div class="line"><a name="l00156"></a><span class="lineno">  156</span>&#160;   <a class="code" href="RtypesCore_8h.html#a3885b911a54b47a4e61671f45dd45d0b">Int_t</a> dimension = <a class="code" href="RSha256_8hxx.html#acf9942d15f0dd0ac4fc5ca66096a3f6d">h</a>-&gt;GetDimension();</div><div class="line"><a name="l00157"></a><span class="lineno">  157</span>&#160;   <span class="keywordflow">if</span> (dimension &gt; 1) {</div><div class="line"><a name="l00158"></a><span class="lineno">  158</span>&#160;      <a class="code" href="classTObject.html#abe1fb206304cfa1b8d1e77a4a4fd0120">Error</a>(<span class="stringliteral">&quot;Search&quot;</span>, <span class="stringliteral">&quot;Only implemented for 1-d histograms&quot;</span>);</div><div class="line"><a name="l00159"></a><span class="lineno">  159</span>&#160;      <span class="keywordflow">return</span> 0;</div><div class="line"><a name="l00160"></a><span class="lineno">  160</span>&#160;   }</div><div class="line"><a name="l00161"></a><span class="lineno">  161</span>&#160;   <a class="code" href="classTString.html">TString</a> opt = option;</div><div class="line"><a name="l00162"></a><span class="lineno">  162</span>&#160;   opt.<a class="code" href="classTString.html#a1be9e2a41facebeac4feddd9801a0034">ToLower</a>();</div><div class="line"><a name="l00163"></a><span class="lineno">  163</span>&#160;</div><div class="line"><a name="l00164"></a><span class="lineno">  164</span>&#160;   <span class="comment">//set options</span></div><div class="line"><a name="l00165"></a><span class="lineno">  165</span>&#160;   <a class="code" href="RtypesCore_8h.html#a3885b911a54b47a4e61671f45dd45d0b">Int_t</a> direction = <a class="code" href="classTSpectrum.html#a22565bc179ec06fc52d9377905f71871a7f8038087d885e41b186a81ff9c85a2c">kBackDecreasingWindow</a>;</div><div class="line"><a name="l00166"></a><span class="lineno">  166</span>&#160;   <span class="keywordflow">if</span> (opt.<a class="code" href="classTString.html#aefd4aa6797ae0fd7e63345def5c0be92">Contains</a>(<span class="stringliteral">&quot;backincreasingwindow&quot;</span>)) direction = <a class="code" href="classTSpectrum.html#a22565bc179ec06fc52d9377905f71871a4133774c283c838d5473fa75127ae22f">kBackIncreasingWindow</a>;</div><div class="line"><a name="l00167"></a><span class="lineno">  167</span>&#160;   <a class="code" href="RtypesCore_8h.html#a3885b911a54b47a4e61671f45dd45d0b">Int_t</a> filterOrder = <a class="code" href="classTSpectrum.html#a22565bc179ec06fc52d9377905f71871a22ca3a5b1f9745fabaaa8bef2cb39d35">kBackOrder2</a>;</div><div class="line"><a name="l00168"></a><span class="lineno">  168</span>&#160;   <span class="keywordflow">if</span> (opt.<a class="code" href="classTString.html#aefd4aa6797ae0fd7e63345def5c0be92">Contains</a>(<span class="stringliteral">&quot;backorder4&quot;</span>)) filterOrder = <a class="code" href="classTSpectrum.html#a22565bc179ec06fc52d9377905f71871aafa4c82f25e396090b5cecb89d72bce7">kBackOrder4</a>;</div><div class="line"><a name="l00169"></a><span class="lineno">  169</span>&#160;   <span class="keywordflow">if</span> (opt.<a class="code" href="classTString.html#aefd4aa6797ae0fd7e63345def5c0be92">Contains</a>(<span class="stringliteral">&quot;backorder6&quot;</span>)) filterOrder = <a class="code" href="classTSpectrum.html#a22565bc179ec06fc52d9377905f71871a283a827c1815ac5d970895880ebe4948">kBackOrder6</a>;</div><div class="line"><a name="l00170"></a><span class="lineno">  170</span>&#160;   <span class="keywordflow">if</span> (opt.<a class="code" href="classTString.html#aefd4aa6797ae0fd7e63345def5c0be92">Contains</a>(<span class="stringliteral">&quot;backorder8&quot;</span>)) filterOrder = <a class="code" href="classTSpectrum.html#a22565bc179ec06fc52d9377905f71871a0e005bb3ae769555ceb1a6d88c54e804">kBackOrder8</a>;</div><div class="line"><a name="l00171"></a><span class="lineno">  171</span>&#160;   <a class="code" href="RtypesCore_8h.html#aa101f564ac7b845ca31aec2fbc00ce97">Bool_t</a> smoothing = <a class="code" href="RtypesCore_8h.html#af2f51d30ccd86e85be3e3e69793a86ef">kTRUE</a>;</div><div class="line"><a name="l00172"></a><span class="lineno">  172</span>&#160;   <span class="keywordflow">if</span> (opt.<a class="code" href="classTString.html#aefd4aa6797ae0fd7e63345def5c0be92">Contains</a>(<span class="stringliteral">&quot;nosmoothing&quot;</span>)) smoothing = <a class="code" href="RtypesCore_8h.html#a7e568baf910535e8ffd438acb843434d">kFALSE</a>;</div><div class="line"><a name="l00173"></a><span class="lineno">  173</span>&#160;   <a class="code" href="RtypesCore_8h.html#a3885b911a54b47a4e61671f45dd45d0b">Int_t</a> smoothWindow = <a class="code" href="classTSpectrum.html#a22565bc179ec06fc52d9377905f71871af1af12f6d81dd70d82c188845db4af20">kBackSmoothing3</a>;</div><div class="line"><a name="l00174"></a><span class="lineno">  174</span>&#160;   <span class="keywordflow">if</span> (opt.<a class="code" href="classTString.html#aefd4aa6797ae0fd7e63345def5c0be92">Contains</a>(<span class="stringliteral">&quot;backsmoothing5&quot;</span>))  smoothWindow = <a class="code" href="classTSpectrum.html#a22565bc179ec06fc52d9377905f71871ad4143bb4537ab0c1644c73483417c107">kBackSmoothing5</a>;</div><div class="line"><a name="l00175"></a><span class="lineno">  175</span>&#160;   <span class="keywordflow">if</span> (opt.<a class="code" href="classTString.html#aefd4aa6797ae0fd7e63345def5c0be92">Contains</a>(<span class="stringliteral">&quot;backsmoothing7&quot;</span>))  smoothWindow = <a class="code" href="classTSpectrum.html#a22565bc179ec06fc52d9377905f71871a325c5b1acb8d5402c61b7a8b34f03595">kBackSmoothing7</a>;</div><div class="line"><a name="l00176"></a><span class="lineno">  176</span>&#160;   <span class="keywordflow">if</span> (opt.<a class="code" href="classTString.html#aefd4aa6797ae0fd7e63345def5c0be92">Contains</a>(<span class="stringliteral">&quot;backsmoothing9&quot;</span>))  smoothWindow = <a class="code" href="classTSpectrum.html#a22565bc179ec06fc52d9377905f71871a8f97bc92755b5a88c1db976f7ce6d585">kBackSmoothing9</a>;</div><div class="line"><a name="l00177"></a><span class="lineno">  177</span>&#160;   <span class="keywordflow">if</span> (opt.<a class="code" href="classTString.html#aefd4aa6797ae0fd7e63345def5c0be92">Contains</a>(<span class="stringliteral">&quot;backsmoothing11&quot;</span>)) smoothWindow = <a class="code" href="classTSpectrum.html#a22565bc179ec06fc52d9377905f71871a167fc10caa2484d4d3dfae3347c05303">kBackSmoothing11</a>;</div><div class="line"><a name="l00178"></a><span class="lineno">  178</span>&#160;   <span class="keywordflow">if</span> (opt.<a class="code" href="classTString.html#aefd4aa6797ae0fd7e63345def5c0be92">Contains</a>(<span class="stringliteral">&quot;backsmoothing13&quot;</span>)) smoothWindow = <a class="code" href="classTSpectrum.html#a22565bc179ec06fc52d9377905f71871a881ed7ed9012a0e081b164f058094d2e">kBackSmoothing13</a>;</div><div class="line"><a name="l00179"></a><span class="lineno">  179</span>&#160;   <span class="keywordflow">if</span> (opt.<a class="code" href="classTString.html#aefd4aa6797ae0fd7e63345def5c0be92">Contains</a>(<span class="stringliteral">&quot;backsmoothing15&quot;</span>)) smoothWindow = <a class="code" href="classTSpectrum.html#a22565bc179ec06fc52d9377905f71871a192bec0ffbdc8def548e1907a7bad96f">kBackSmoothing15</a>;</div><div class="line"><a name="l00180"></a><span class="lineno">  180</span>&#160;   <a class="code" href="RtypesCore_8h.html#aa101f564ac7b845ca31aec2fbc00ce97">Bool_t</a> compton = <a class="code" href="RtypesCore_8h.html#a7e568baf910535e8ffd438acb843434d">kFALSE</a>;</div><div class="line"><a name="l00181"></a><span class="lineno">  181</span>&#160;   <span class="keywordflow">if</span> (opt.<a class="code" href="classTString.html#aefd4aa6797ae0fd7e63345def5c0be92">Contains</a>(<span class="stringliteral">&quot;compton&quot;</span>)) compton = <a class="code" href="RtypesCore_8h.html#af2f51d30ccd86e85be3e3e69793a86ef">kTRUE</a>;</div><div class="line"><a name="l00182"></a><span class="lineno">  182</span>&#160;</div><div class="line"><a name="l00183"></a><span class="lineno">  183</span>&#160;   <a class="code" href="RtypesCore_8h.html#a3885b911a54b47a4e61671f45dd45d0b">Int_t</a> <a class="code" href="namespacefirst.html">first</a> = <a class="code" href="RSha256_8hxx.html#acf9942d15f0dd0ac4fc5ca66096a3f6d">h</a>-&gt;GetXaxis()-&gt;GetFirst();</div><div class="line"><a name="l00184"></a><span class="lineno">  184</span>&#160;   <a class="code" href="RtypesCore_8h.html#a3885b911a54b47a4e61671f45dd45d0b">Int_t</a> last  = <a class="code" href="RSha256_8hxx.html#acf9942d15f0dd0ac4fc5ca66096a3f6d">h</a>-&gt;GetXaxis()-&gt;GetLast();</div><div class="line"><a name="l00185"></a><span class="lineno">  185</span>&#160;   <a class="code" href="RtypesCore_8h.html#a3885b911a54b47a4e61671f45dd45d0b">Int_t</a> size = last-<a class="code" href="namespacefirst.html">first</a>+1;</div><div class="line"><a name="l00186"></a><span class="lineno">  186</span>&#160;   <a class="code" href="RtypesCore_8h.html#a3885b911a54b47a4e61671f45dd45d0b">Int_t</a> i;</div><div class="line"><a name="l00187"></a><span class="lineno">  187</span>&#160;   <a class="code" href="RtypesCore_8h.html#ab9b5334647b78ec4256db251e3ae1fc6">Double_t</a> * source = <span class="keyword">new</span> <a class="code" href="RtypesCore_8h.html#ab9b5334647b78ec4256db251e3ae1fc6">Double_t</a>[size];</div><div class="line"><a name="l00188"></a><span class="lineno">  188</span>&#160;   <span class="keywordflow">for</span> (i = 0; i &lt; size; i++) source[i] = <a class="code" href="RSha256_8hxx.html#acf9942d15f0dd0ac4fc5ca66096a3f6d">h</a>-&gt;GetBinContent(i + <a class="code" href="namespacefirst.html">first</a>);</div><div class="line"><a name="l00189"></a><span class="lineno">  189</span>&#160;</div><div class="line"><a name="l00190"></a><span class="lineno">  190</span>&#160;   <span class="comment">//find background (source is input and in output contains the background</span></div><div class="line"><a name="l00191"></a><span class="lineno">  191</span>&#160;   <a class="code" href="classTSpectrum.html#a56e15d1c36c7557b17d5f6d68fa315a7">Background</a>(source,size,numberIterations, direction, filterOrder,smoothing,</div><div class="line"><a name="l00192"></a><span class="lineno">  192</span>&#160;              smoothWindow,compton);</div><div class="line"><a name="l00193"></a><span class="lineno">  193</span>&#160;</div><div class="line"><a name="l00194"></a><span class="lineno">  194</span>&#160;   <span class="comment">//create output histogram containing background</span></div><div class="line"><a name="l00195"></a><span class="lineno">  195</span>&#160;   <span class="comment">//only bins in the range of the input histogram are filled</span></div><div class="line"><a name="l00196"></a><span class="lineno">  196</span>&#160;   <a class="code" href="RtypesCore_8h.html#a3885b911a54b47a4e61671f45dd45d0b">Int_t</a> nch = strlen(<a class="code" href="RSha256_8hxx.html#acf9942d15f0dd0ac4fc5ca66096a3f6d">h</a>-&gt;GetName());</div><div class="line"><a name="l00197"></a><span class="lineno">  197</span>&#160;   <span class="keywordtype">char</span> *<a class="code" href="THbookFile_8cxx.html#afd214e8166a9dd362f9907c59e5e2420">hbname</a> = <span class="keyword">new</span> <span class="keywordtype">char</span>[nch+20];</div><div class="line"><a name="l00198"></a><span class="lineno">  198</span>&#160;   <a class="code" href="civetweb_8c.html#aa367b75c5aed883fef5befbdf04835a4">snprintf</a>(<a class="code" href="THbookFile_8cxx.html#afd214e8166a9dd362f9907c59e5e2420">hbname</a>,nch+20,<span class="stringliteral">&quot;%s_background&quot;</span>,<a class="code" href="RSha256_8hxx.html#acf9942d15f0dd0ac4fc5ca66096a3f6d">h</a>-&gt;GetName());</div><div class="line"><a name="l00199"></a><span class="lineno">  199</span>&#160;   <a class="code" href="classTH1.html">TH1</a> *hb = (<a class="code" href="classTH1.html">TH1</a>*)<a class="code" href="RSha256_8hxx.html#acf9942d15f0dd0ac4fc5ca66096a3f6d">h</a>-&gt;Clone(<a class="code" href="THbookFile_8cxx.html#afd214e8166a9dd362f9907c59e5e2420">hbname</a>);</div><div class="line"><a name="l00200"></a><span class="lineno">  200</span>&#160;   hb-&gt;Reset();</div><div class="line"><a name="l00201"></a><span class="lineno">  201</span>&#160;   hb-&gt;GetListOfFunctions()-&gt;Delete();</div><div class="line"><a name="l00202"></a><span class="lineno">  202</span>&#160;   hb-&gt;SetLineColor(2);</div><div class="line"><a name="l00203"></a><span class="lineno">  203</span>&#160;   <span class="keywordflow">for</span> (i=0; i&lt; size; i++) hb-&gt;SetBinContent(i+<a class="code" href="namespacefirst.html">first</a>,source[i]);</div><div class="line"><a name="l00204"></a><span class="lineno">  204</span>&#160;   hb-&gt;SetEntries(size);</div><div class="line"><a name="l00205"></a><span class="lineno">  205</span>&#160;</div><div class="line"><a name="l00206"></a><span class="lineno">  206</span>&#160;   <span class="comment">//if option &quot;same is specified, draw the result in the pad</span></div><div class="line"><a name="l00207"></a><span class="lineno">  207</span>&#160;   <span class="keywordflow">if</span> (opt.<a class="code" href="classTString.html#aefd4aa6797ae0fd7e63345def5c0be92">Contains</a>(<span class="stringliteral">&quot;same&quot;</span>)) {</div><div class="line"><a name="l00208"></a><span class="lineno">  208</span>&#160;      <span class="keywordflow">if</span> (<a class="code" href="TVirtualPad_8h.html#a376b3a920d36f3366fb6a4c9e424aa8c">gPad</a>) <span class="keyword">delete</span> <a class="code" href="TVirtualPad_8h.html#a376b3a920d36f3366fb6a4c9e424aa8c">gPad</a>-&gt;GetPrimitive(<a class="code" href="THbookFile_8cxx.html#afd214e8166a9dd362f9907c59e5e2420">hbname</a>);</div><div class="line"><a name="l00209"></a><span class="lineno">  209</span>&#160;      hb-&gt;Draw(<span class="stringliteral">&quot;same&quot;</span>);</div><div class="line"><a name="l00210"></a><span class="lineno">  210</span>&#160;   }</div><div class="line"><a name="l00211"></a><span class="lineno">  211</span>&#160;   <span class="keyword">delete</span> [] source;</div><div class="line"><a name="l00212"></a><span class="lineno">  212</span>&#160;   <span class="keyword">delete</span> [] <a class="code" href="THbookFile_8cxx.html#afd214e8166a9dd362f9907c59e5e2420">hbname</a>;</div><div class="line"><a name="l00213"></a><span class="lineno">  213</span>&#160;   <span class="keywordflow">return</span> hb;</div><div class="line"><a name="l00214"></a><span class="lineno">  214</span>&#160;}</div><div class="line"><a name="l00215"></a><span class="lineno">  215</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00216"></a><span class="lineno">  216</span>&#160;<span class="comment">////////////////////////////////////////////////////////////////////////////////</span></div><div class="line"><a name="l00217"></a><span class="lineno">  217</span>&#160;<span class="comment">///   Print the array of positions.</span></div><div class="line"><a name="l00218"></a><span class="lineno">  218</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00219"></a><span class="lineno"><a class="line" href="classTSpectrum.html#ad95336e041209b67e899e30ee9809297">  219</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="classTSpectrum.html#ad95336e041209b67e899e30ee9809297">TSpectrum::Print</a>(<a class="code" href="RtypesCore_8h.html#afc405399e08793afdff5b4692827b2a1">Option_t</a> *)<span class="keyword"> const</span></div><div class="line"><a name="l00220"></a><span class="lineno">  220</span>&#160;<span class="keyword"></span>{</div><div class="line"><a name="l00221"></a><span class="lineno">  221</span>&#160;   printf(<span class="stringliteral">&quot;\nNumber of positions = %d\n&quot;</span>,<a class="code" href="classTSpectrum.html#a63a4881270541655c2535c46ec52ce6d">fNPeaks</a>);</div><div class="line"><a name="l00222"></a><span class="lineno">  222</span>&#160;   <span class="keywordflow">for</span> (<a class="code" href="RtypesCore_8h.html#a3885b911a54b47a4e61671f45dd45d0b">Int_t</a> i=0;i&lt;<a class="code" href="classTSpectrum.html#a63a4881270541655c2535c46ec52ce6d">fNPeaks</a>;i++) {</div><div class="line"><a name="l00223"></a><span class="lineno">  223</span>&#160;      printf(<span class="stringliteral">&quot; x[%d] = %g, y[%d] = %g\n&quot;</span>,i,<a class="code" href="classTSpectrum.html#a186f7fab91729aabbd19b446d57ba427">fPositionX</a>[i],i,<a class="code" href="classTSpectrum.html#afc1624f993eab0e8c1b77db06a3bf839">fPositionY</a>[i]);</div><div class="line"><a name="l00224"></a><span class="lineno">  224</span>&#160;   }</div><div class="line"><a name="l00225"></a><span class="lineno">  225</span>&#160;}</div><div class="line"><a name="l00226"></a><span class="lineno">  226</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00227"></a><span class="lineno">  227</span>&#160;<span class="comment">////////////////////////////////////////////////////////////////////////////////</span></div><div class="line"><a name="l00228"></a><span class="lineno">  228</span>&#160;<span class="comment">///   One-dimensional peak search function</span></div><div class="line"><a name="l00229"></a><span class="lineno">  229</span>&#160;<span class="comment">///</span></div><div class="line"><a name="l00230"></a><span class="lineno">  230</span>&#160;<span class="comment">///   This function searches for peaks in source spectrum in hin</span></div><div class="line"><a name="l00231"></a><span class="lineno">  231</span>&#160;<span class="comment">///   The number of found peaks and their positions are written into</span></div><div class="line"><a name="l00232"></a><span class="lineno">  232</span>&#160;<span class="comment">///   the members fNpeaks and fPositionX.</span></div><div class="line"><a name="l00233"></a><span class="lineno">  233</span>&#160;<span class="comment">///   The search is performed in the current histogram range.</span></div><div class="line"><a name="l00234"></a><span class="lineno">  234</span>&#160;<span class="comment">///</span></div><div class="line"><a name="l00235"></a><span class="lineno">  235</span>&#160;<span class="comment">/// #### Parameters:</span></div><div class="line"><a name="l00236"></a><span class="lineno">  236</span>&#160;<span class="comment">///</span></div><div class="line"><a name="l00237"></a><span class="lineno">  237</span>&#160;<span class="comment">///   - hin:       pointer to the histogram of source spectrum</span></div><div class="line"><a name="l00238"></a><span class="lineno">  238</span>&#160;<span class="comment">///   - sigma:   sigma of searched peaks, for details we refer to manual</span></div><div class="line"><a name="l00239"></a><span class="lineno">  239</span>&#160;<span class="comment">///   - threshold: (default=0.05)  peaks with amplitude less than</span></div><div class="line"><a name="l00240"></a><span class="lineno">  240</span>&#160;<span class="comment">///       threshold*highest_peak are discarded.  0&lt;threshold&lt;1</span></div><div class="line"><a name="l00241"></a><span class="lineno">  241</span>&#160;<span class="comment">///</span></div><div class="line"><a name="l00242"></a><span class="lineno">  242</span>&#160;<span class="comment">///   By default, the background is removed before deconvolution.</span></div><div class="line"><a name="l00243"></a><span class="lineno">  243</span>&#160;<span class="comment">///   Specify the option &quot;nobackground&quot; to not remove the background.</span></div><div class="line"><a name="l00244"></a><span class="lineno">  244</span>&#160;<span class="comment">///</span></div><div class="line"><a name="l00245"></a><span class="lineno">  245</span>&#160;<span class="comment">///   By default the &quot;Markov&quot; chain algorithm is used.</span></div><div class="line"><a name="l00246"></a><span class="lineno">  246</span>&#160;<span class="comment">///   Specify the option &quot;noMarkov&quot; to disable this algorithm</span></div><div class="line"><a name="l00247"></a><span class="lineno">  247</span>&#160;<span class="comment">///   Note that by default the source spectrum is replaced by a new spectrum</span></div><div class="line"><a name="l00248"></a><span class="lineno">  248</span>&#160;<span class="comment">///</span></div><div class="line"><a name="l00249"></a><span class="lineno">  249</span>&#160;<span class="comment">///   By default a polymarker object is created and added to the list of</span></div><div class="line"><a name="l00250"></a><span class="lineno">  250</span>&#160;<span class="comment">///   functions of the histogram. The histogram is drawn with the specified</span></div><div class="line"><a name="l00251"></a><span class="lineno">  251</span>&#160;<span class="comment">///   option and the polymarker object drawn on top of the histogram.</span></div><div class="line"><a name="l00252"></a><span class="lineno">  252</span>&#160;<span class="comment">///   The polymarker coordinates correspond to the npeaks peaks found in</span></div><div class="line"><a name="l00253"></a><span class="lineno">  253</span>&#160;<span class="comment">///   the histogram.</span></div><div class="line"><a name="l00254"></a><span class="lineno">  254</span>&#160;<span class="comment">///</span></div><div class="line"><a name="l00255"></a><span class="lineno">  255</span>&#160;<span class="comment">///   A pointer to the polymarker object can be retrieved later via:</span></div><div class="line"><a name="l00256"></a><span class="lineno">  256</span>&#160;<span class="comment">/// ~~~ {.cpp}</span></div><div class="line"><a name="l00257"></a><span class="lineno">  257</span>&#160;<span class="comment">///    TList *functions = hin-&gt;GetListOfFunctions();</span></div><div class="line"><a name="l00258"></a><span class="lineno">  258</span>&#160;<span class="comment">///    TPolyMarker *pm = (TPolyMarker*)functions-&gt;FindObject(&quot;TPolyMarker&quot;);</span></div><div class="line"><a name="l00259"></a><span class="lineno">  259</span>&#160;<span class="comment">/// ~~~</span></div><div class="line"><a name="l00260"></a><span class="lineno">  260</span>&#160;<span class="comment">///   Specify the option &quot;goff&quot; to disable the storage and drawing of the</span></div><div class="line"><a name="l00261"></a><span class="lineno">  261</span>&#160;<span class="comment">///   polymarker.</span></div><div class="line"><a name="l00262"></a><span class="lineno">  262</span>&#160;<span class="comment">///</span></div><div class="line"><a name="l00263"></a><span class="lineno">  263</span>&#160;<span class="comment">///   To disable the final drawing of the histogram with the search results (in case</span></div><div class="line"><a name="l00264"></a><span class="lineno">  264</span>&#160;<span class="comment">///   you want to draw it yourself) specify &quot;nodraw&quot; in the options parameter.</span></div><div class="line"><a name="l00265"></a><span class="lineno">  265</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00266"></a><span class="lineno"><a class="line" href="classTSpectrum.html#a5f8b7b208f813670259b51a8bcdcbfc5">  266</a></span>&#160;<a class="code" href="RtypesCore_8h.html#a3885b911a54b47a4e61671f45dd45d0b">Int_t</a> <a class="code" href="classTSpectrum.html#a5f8b7b208f813670259b51a8bcdcbfc5">TSpectrum::Search</a>(<span class="keyword">const</span> <a class="code" href="classTH1.html">TH1</a> * hin, <a class="code" href="RtypesCore_8h.html#ab9b5334647b78ec4256db251e3ae1fc6">Double_t</a> <a class="code" href="h1analysisProxy_8h.html#a351c2b9335dfcbe83de6eb9629c2a0e3">sigma</a>, <a class="code" href="RtypesCore_8h.html#afc405399e08793afdff5b4692827b2a1">Option_t</a> * option,</div><div class="line"><a name="l00267"></a><span class="lineno">  267</span>&#160;                        <a class="code" href="RtypesCore_8h.html#ab9b5334647b78ec4256db251e3ae1fc6">Double_t</a> threshold)</div><div class="line"><a name="l00268"></a><span class="lineno">  268</span>&#160;{</div><div class="line"><a name="l00269"></a><span class="lineno">  269</span>&#160;   <span class="keywordflow">if</span> (hin == 0) <span class="keywordflow">return</span> 0;</div><div class="line"><a name="l00270"></a><span class="lineno">  270</span>&#160;   <a class="code" href="RtypesCore_8h.html#a3885b911a54b47a4e61671f45dd45d0b">Int_t</a> dimension = hin-&gt;<a class="code" href="classTH1.html#a48abf2a23357ba4c1c4e152686a711d4">GetDimension</a>();</div><div class="line"><a name="l00271"></a><span class="lineno">  271</span>&#160;   <span class="keywordflow">if</span> (dimension &gt; 2) {</div><div class="line"><a name="l00272"></a><span class="lineno">  272</span>&#160;      <a class="code" href="classTObject.html#abe1fb206304cfa1b8d1e77a4a4fd0120">Error</a>(<span class="stringliteral">&quot;Search&quot;</span>, <span class="stringliteral">&quot;Only implemented for 1-d and 2-d histograms&quot;</span>);</div><div class="line"><a name="l00273"></a><span class="lineno">  273</span>&#160;      <span class="keywordflow">return</span> 0;</div><div class="line"><a name="l00274"></a><span class="lineno">  274</span>&#160;   }</div><div class="line"><a name="l00275"></a><span class="lineno">  275</span>&#160;   <span class="keywordflow">if</span> (threshold &lt;=0 || threshold &gt;= 1) {</div><div class="line"><a name="l00276"></a><span class="lineno">  276</span>&#160;      <a class="code" href="classTObject.html#a75fddd7eef38a13c1374130ec7dc5cf8">Warning</a>(<span class="stringliteral">&quot;Search&quot;</span>,<span class="stringliteral">&quot;threshold must 0&lt;threshold&lt;1, threshold=0.05 assumed&quot;</span>);</div><div class="line"><a name="l00277"></a><span class="lineno">  277</span>&#160;      threshold = 0.05;</div><div class="line"><a name="l00278"></a><span class="lineno">  278</span>&#160;   }</div><div class="line"><a name="l00279"></a><span class="lineno">  279</span>&#160;   <a class="code" href="classTString.html">TString</a> opt = option;</div><div class="line"><a name="l00280"></a><span class="lineno">  280</span>&#160;   opt.<a class="code" href="classTString.html#a1be9e2a41facebeac4feddd9801a0034">ToLower</a>();</div><div class="line"><a name="l00281"></a><span class="lineno">  281</span>&#160;   <a class="code" href="RtypesCore_8h.html#aa101f564ac7b845ca31aec2fbc00ce97">Bool_t</a> background = <a class="code" href="RtypesCore_8h.html#af2f51d30ccd86e85be3e3e69793a86ef">kTRUE</a>;</div><div class="line"><a name="l00282"></a><span class="lineno">  282</span>&#160;   <span class="keywordflow">if</span> (opt.<a class="code" href="classTString.html#aefd4aa6797ae0fd7e63345def5c0be92">Contains</a>(<span class="stringliteral">&quot;nobackground&quot;</span>)) {</div><div class="line"><a name="l00283"></a><span class="lineno">  283</span>&#160;      background = <a class="code" href="RtypesCore_8h.html#a7e568baf910535e8ffd438acb843434d">kFALSE</a>;</div><div class="line"><a name="l00284"></a><span class="lineno">  284</span>&#160;      opt.<a class="code" href="classTString.html#a5072f18275913ec22cfa6f7c0c70c557">ReplaceAll</a>(<span class="stringliteral">&quot;nobackground&quot;</span>,<span class="stringliteral">&quot;&quot;</span>);</div><div class="line"><a name="l00285"></a><span class="lineno">  285</span>&#160;   }</div><div class="line"><a name="l00286"></a><span class="lineno">  286</span>&#160;   <a class="code" href="RtypesCore_8h.html#aa101f564ac7b845ca31aec2fbc00ce97">Bool_t</a> markov = <a class="code" href="RtypesCore_8h.html#af2f51d30ccd86e85be3e3e69793a86ef">kTRUE</a>;</div><div class="line"><a name="l00287"></a><span class="lineno">  287</span>&#160;   <span class="keywordflow">if</span> (opt.<a class="code" href="classTString.html#aefd4aa6797ae0fd7e63345def5c0be92">Contains</a>(<span class="stringliteral">&quot;nomarkov&quot;</span>)) {</div><div class="line"><a name="l00288"></a><span class="lineno">  288</span>&#160;      markov = <a class="code" href="RtypesCore_8h.html#a7e568baf910535e8ffd438acb843434d">kFALSE</a>;</div><div class="line"><a name="l00289"></a><span class="lineno">  289</span>&#160;      opt.<a class="code" href="classTString.html#a5072f18275913ec22cfa6f7c0c70c557">ReplaceAll</a>(<span class="stringliteral">&quot;nomarkov&quot;</span>,<span class="stringliteral">&quot;&quot;</span>);</div><div class="line"><a name="l00290"></a><span class="lineno">  290</span>&#160;   }</div><div class="line"><a name="l00291"></a><span class="lineno">  291</span>&#160;   <a class="code" href="RtypesCore_8h.html#aa101f564ac7b845ca31aec2fbc00ce97">Bool_t</a> draw = <a class="code" href="RtypesCore_8h.html#af2f51d30ccd86e85be3e3e69793a86ef">kTRUE</a>;</div><div class="line"><a name="l00292"></a><span class="lineno">  292</span>&#160;   <span class="keywordflow">if</span> (opt.<a class="code" href="classTString.html#aefd4aa6797ae0fd7e63345def5c0be92">Contains</a>(<span class="stringliteral">&quot;nodraw&quot;</span>)) {</div><div class="line"><a name="l00293"></a><span class="lineno">  293</span>&#160;      draw = <a class="code" href="RtypesCore_8h.html#a7e568baf910535e8ffd438acb843434d">kFALSE</a>;</div><div class="line"><a name="l00294"></a><span class="lineno">  294</span>&#160;      opt.<a class="code" href="classTString.html#a5072f18275913ec22cfa6f7c0c70c557">ReplaceAll</a>(<span class="stringliteral">&quot;nodraw&quot;</span>,<span class="stringliteral">&quot;&quot;</span>);</div><div class="line"><a name="l00295"></a><span class="lineno">  295</span>&#160;   }</div><div class="line"><a name="l00296"></a><span class="lineno">  296</span>&#160;   <span class="keywordflow">if</span> (dimension == 1) {</div><div class="line"><a name="l00297"></a><span class="lineno">  297</span>&#160;      <a class="code" href="RtypesCore_8h.html#a3885b911a54b47a4e61671f45dd45d0b">Int_t</a> <a class="code" href="namespacefirst.html">first</a> = hin-&gt;<a class="code" href="classTH1.html#a3d91d3762b9789bd6e54e67d8ccce2e6">GetXaxis</a>()-&gt;<a class="code" href="classTAxis.html#af322ad7e08d05e1aaca9f51ea3e997d7">GetFirst</a>();</div><div class="line"><a name="l00298"></a><span class="lineno">  298</span>&#160;      <a class="code" href="RtypesCore_8h.html#a3885b911a54b47a4e61671f45dd45d0b">Int_t</a> last  = hin-&gt;<a class="code" href="classTH1.html#a3d91d3762b9789bd6e54e67d8ccce2e6">GetXaxis</a>()-&gt;<a class="code" href="classTAxis.html#a9dab7a2892fdbb37f5421fa5d89d845b">GetLast</a>();</div><div class="line"><a name="l00299"></a><span class="lineno">  299</span>&#160;      <a class="code" href="RtypesCore_8h.html#a3885b911a54b47a4e61671f45dd45d0b">Int_t</a> size = last-<a class="code" href="namespacefirst.html">first</a>+1;</div><div class="line"><a name="l00300"></a><span class="lineno">  300</span>&#160;      <a class="code" href="RtypesCore_8h.html#a3885b911a54b47a4e61671f45dd45d0b">Int_t</a> i, bin, npeaks;</div><div class="line"><a name="l00301"></a><span class="lineno">  301</span>&#160;      <a class="code" href="RtypesCore_8h.html#ab9b5334647b78ec4256db251e3ae1fc6">Double_t</a> * source = <span class="keyword">new</span> <a class="code" href="RtypesCore_8h.html#ab9b5334647b78ec4256db251e3ae1fc6">Double_t</a>[size];</div><div class="line"><a name="l00302"></a><span class="lineno">  302</span>&#160;      <a class="code" href="RtypesCore_8h.html#ab9b5334647b78ec4256db251e3ae1fc6">Double_t</a> * <a class="code" href="triangle_8c.html#aa22f343c7ac709eab3fdd162721759a1">dest</a>   = <span class="keyword">new</span> <a class="code" href="RtypesCore_8h.html#ab9b5334647b78ec4256db251e3ae1fc6">Double_t</a>[size];</div><div class="line"><a name="l00303"></a><span class="lineno">  303</span>&#160;      <span class="keywordflow">for</span> (i = 0; i &lt; size; i++) source[i] = hin-&gt;<a class="code" href="classTH1.html#ac70dcb4082bd510f5aa3e6efeb043f39">GetBinContent</a>(i + <a class="code" href="namespacefirst.html">first</a>);</div><div class="line"><a name="l00304"></a><span class="lineno">  304</span>&#160;      <span class="keywordflow">if</span> (<a class="code" href="h1analysisProxy_8h.html#a351c2b9335dfcbe83de6eb9629c2a0e3">sigma</a> &lt; 1) {</div><div class="line"><a name="l00305"></a><span class="lineno">  305</span>&#160;         <a class="code" href="h1analysisProxy_8h.html#a351c2b9335dfcbe83de6eb9629c2a0e3">sigma</a> = size/<a class="code" href="classTSpectrum.html#a10e78d271e709357110ae070b47d3add">fMaxPeaks</a>;</div><div class="line"><a name="l00306"></a><span class="lineno">  306</span>&#160;         <span class="keywordflow">if</span> (<a class="code" href="h1analysisProxy_8h.html#a351c2b9335dfcbe83de6eb9629c2a0e3">sigma</a> &lt; 1) <a class="code" href="h1analysisProxy_8h.html#a351c2b9335dfcbe83de6eb9629c2a0e3">sigma</a> = 1;</div><div class="line"><a name="l00307"></a><span class="lineno">  307</span>&#160;         <span class="keywordflow">if</span> (<a class="code" href="h1analysisProxy_8h.html#a351c2b9335dfcbe83de6eb9629c2a0e3">sigma</a> &gt; 8) <a class="code" href="h1analysisProxy_8h.html#a351c2b9335dfcbe83de6eb9629c2a0e3">sigma</a> = 8;</div><div class="line"><a name="l00308"></a><span class="lineno">  308</span>&#160;      }</div><div class="line"><a name="l00309"></a><span class="lineno">  309</span>&#160;      npeaks = <a class="code" href="classTSpectrum.html#a5ba181a45b117934b48c4ef5f78d0b2b">SearchHighRes</a>(source, <a class="code" href="triangle_8c.html#aa22f343c7ac709eab3fdd162721759a1">dest</a>, size, <a class="code" href="h1analysisProxy_8h.html#a351c2b9335dfcbe83de6eb9629c2a0e3">sigma</a>, 100*threshold,</div><div class="line"><a name="l00310"></a><span class="lineno">  310</span>&#160;                             background, <a class="code" href="classTSpectrum.html#ac5b94cc0438601683a9719a217659554">fgIterations</a>, markov, <a class="code" href="classTSpectrum.html#aa32e2d562913b811498683ef6628b494">fgAverageWindow</a>);</div><div class="line"><a name="l00311"></a><span class="lineno">  311</span>&#160;</div><div class="line"><a name="l00312"></a><span class="lineno">  312</span>&#160;      <span class="keywordflow">for</span> (i = 0; i &lt; npeaks; i++) {</div><div class="line"><a name="l00313"></a><span class="lineno">  313</span>&#160;         bin = <a class="code" href="namespacefirst.html">first</a> + <a class="code" href="RtypesCore_8h.html#a3885b911a54b47a4e61671f45dd45d0b">Int_t</a>(<a class="code" href="classTSpectrum.html#a186f7fab91729aabbd19b446d57ba427">fPositionX</a>[i] + 0.5);</div><div class="line"><a name="l00314"></a><span class="lineno">  314</span>&#160;         <a class="code" href="classTSpectrum.html#a186f7fab91729aabbd19b446d57ba427">fPositionX</a>[i] = hin-&gt;<a class="code" href="classTH1.html#a0ee88e02b75d885985097dcde0a9eaa1">GetBinCenter</a>(bin);</div><div class="line"><a name="l00315"></a><span class="lineno">  315</span>&#160;         <a class="code" href="classTSpectrum.html#afc1624f993eab0e8c1b77db06a3bf839">fPositionY</a>[i] = hin-&gt;<a class="code" href="classTH1.html#ac70dcb4082bd510f5aa3e6efeb043f39">GetBinContent</a>(bin);</div><div class="line"><a name="l00316"></a><span class="lineno">  316</span>&#160;      }</div><div class="line"><a name="l00317"></a><span class="lineno">  317</span>&#160;      <span class="keyword">delete</span> [] source;</div><div class="line"><a name="l00318"></a><span class="lineno">  318</span>&#160;      <span class="keyword">delete</span> [] <a class="code" href="triangle_8c.html#aa22f343c7ac709eab3fdd162721759a1">dest</a>;</div><div class="line"><a name="l00319"></a><span class="lineno">  319</span>&#160;</div><div class="line"><a name="l00320"></a><span class="lineno">  320</span>&#160;      <span class="keywordflow">if</span> (opt.<a class="code" href="classTString.html#aefd4aa6797ae0fd7e63345def5c0be92">Contains</a>(<span class="stringliteral">&quot;goff&quot;</span>))</div><div class="line"><a name="l00321"></a><span class="lineno">  321</span>&#160;         <span class="keywordflow">return</span> npeaks;</div><div class="line"><a name="l00322"></a><span class="lineno">  322</span>&#160;      <span class="keywordflow">if</span> (!npeaks) <span class="keywordflow">return</span> 0;</div><div class="line"><a name="l00323"></a><span class="lineno">  323</span>&#160;      <a class="code" href="classTPolyMarker.html">TPolyMarker</a> * pm =</div><div class="line"><a name="l00324"></a><span class="lineno">  324</span>&#160;         (<a class="code" href="classTPolyMarker.html">TPolyMarker</a>*)hin-&gt;<a class="code" href="classTH1.html#a4f38ff3c9c675313fc647d32c87ea07a">GetListOfFunctions</a>()-&gt;<a class="code" href="classTList.html#a85c8734ab131c0db5f68c724e47496a7">FindObject</a>(<span class="stringliteral">&quot;TPolyMarker&quot;</span>);</div><div class="line"><a name="l00325"></a><span class="lineno">  325</span>&#160;      <span class="keywordflow">if</span> (pm) {</div><div class="line"><a name="l00326"></a><span class="lineno">  326</span>&#160;         hin-&gt;<a class="code" href="classTH1.html#a4f38ff3c9c675313fc647d32c87ea07a">GetListOfFunctions</a>()-&gt;<a class="code" href="classTList.html#a3026e979d86376d2f362044d5a94c71b">Remove</a>(pm);</div><div class="line"><a name="l00327"></a><span class="lineno">  327</span>&#160;         <span class="keyword">delete</span> pm;</div><div class="line"><a name="l00328"></a><span class="lineno">  328</span>&#160;      }</div><div class="line"><a name="l00329"></a><span class="lineno">  329</span>&#160;      pm = <span class="keyword">new</span> <a class="code" href="classTPolyMarker.html">TPolyMarker</a>(npeaks, <a class="code" href="classTSpectrum.html#a186f7fab91729aabbd19b446d57ba427">fPositionX</a>, <a class="code" href="classTSpectrum.html#afc1624f993eab0e8c1b77db06a3bf839">fPositionY</a>);</div><div class="line"><a name="l00330"></a><span class="lineno">  330</span>&#160;      hin-&gt;<a class="code" href="classTH1.html#a4f38ff3c9c675313fc647d32c87ea07a">GetListOfFunctions</a>()-&gt;<a class="code" href="classTList.html#a1b90ccfbde1729266b585194fa45df14">Add</a>(pm);</div><div class="line"><a name="l00331"></a><span class="lineno">  331</span>&#160;      pm-&gt;<a class="code" href="classTAttMarker.html#a697e1a65975ff344c9dca7618fd44de4">SetMarkerStyle</a>(23);</div><div class="line"><a name="l00332"></a><span class="lineno">  332</span>&#160;      pm-&gt;<a class="code" href="classTAttMarker.html#a27f1eae16a3f990024e8a401ed034fa3">SetMarkerColor</a>(<a class="code" href="Rtypes_8h.html#ac31db05c6cb5891c704eae374f6926a8a5a655b1a02e5b0311571ca57ce4f3900">kRed</a>);</div><div class="line"><a name="l00333"></a><span class="lineno">  333</span>&#160;      pm-&gt;<a class="code" href="classTAttMarker.html#a95522acfc3fa6157f317f9993edfa047">SetMarkerSize</a>(1.3);</div><div class="line"><a name="l00334"></a><span class="lineno">  334</span>&#160;      opt.<a class="code" href="classTString.html#a5072f18275913ec22cfa6f7c0c70c557">ReplaceAll</a>(<span class="stringliteral">&quot; &quot;</span>,<span class="stringliteral">&quot;&quot;</span>);</div><div class="line"><a name="l00335"></a><span class="lineno">  335</span>&#160;      opt.<a class="code" href="classTString.html#a5072f18275913ec22cfa6f7c0c70c557">ReplaceAll</a>(<span class="stringliteral">&quot;,&quot;</span>,<span class="stringliteral">&quot;&quot;</span>);</div><div class="line"><a name="l00336"></a><span class="lineno">  336</span>&#160;      <span class="keywordflow">if</span> (draw)</div><div class="line"><a name="l00337"></a><span class="lineno">  337</span>&#160;         ((<a class="code" href="classTH1.html">TH1</a>*)hin)-&gt;Draw(opt.<a class="code" href="classTString.html#a7e4ada8bf2407b461f3ee58b71c5959f">Data</a>());</div><div class="line"><a name="l00338"></a><span class="lineno">  338</span>&#160;      <span class="keywordflow">return</span> npeaks;</div><div class="line"><a name="l00339"></a><span class="lineno">  339</span>&#160;   }</div><div class="line"><a name="l00340"></a><span class="lineno">  340</span>&#160;   <span class="keywordflow">return</span> 0;</div><div class="line"><a name="l00341"></a><span class="lineno">  341</span>&#160;}</div><div class="line"><a name="l00342"></a><span class="lineno">  342</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00343"></a><span class="lineno">  343</span>&#160;<span class="comment">////////////////////////////////////////////////////////////////////////////////</span></div><div class="line"><a name="l00344"></a><span class="lineno">  344</span>&#160;<span class="comment">/// *NOT USED*</span></div><div class="line"><a name="l00345"></a><span class="lineno">  345</span>&#160;<span class="comment">///  resolution: determines resolution of the neighbouring peaks</span></div><div class="line"><a name="l00346"></a><span class="lineno">  346</span>&#160;<span class="comment">///              default value is 1 correspond to 3 sigma distance</span></div><div class="line"><a name="l00347"></a><span class="lineno">  347</span>&#160;<span class="comment">///              between peaks. Higher values allow higher resolution</span></div><div class="line"><a name="l00348"></a><span class="lineno">  348</span>&#160;<span class="comment">///              (smaller distance between peaks.</span></div><div class="line"><a name="l00349"></a><span class="lineno">  349</span>&#160;<span class="comment">///              May be set later through SetResolution.</span></div><div class="line"><a name="l00350"></a><span class="lineno">  350</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00351"></a><span class="lineno"><a class="line" href="classTSpectrum.html#a46b603bd0a41f8fa7c2501e164c05b54">  351</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="classTSpectrum.html#a46b603bd0a41f8fa7c2501e164c05b54">TSpectrum::SetResolution</a>(<a class="code" href="RtypesCore_8h.html#ab9b5334647b78ec4256db251e3ae1fc6">Double_t</a> resolution)</div><div class="line"><a name="l00352"></a><span class="lineno">  352</span>&#160;{</div><div class="line"><a name="l00353"></a><span class="lineno">  353</span>&#160;   <span class="keywordflow">if</span> (resolution &gt; 1)</div><div class="line"><a name="l00354"></a><span class="lineno">  354</span>&#160;      <a class="code" href="classTSpectrum.html#a02fdb00792c69d8b34aa78e42b6682e1">fResolution</a> = resolution;</div><div class="line"><a name="l00355"></a><span class="lineno">  355</span>&#160;   <span class="keywordflow">else</span></div><div class="line"><a name="l00356"></a><span class="lineno">  356</span>&#160;      <a class="code" href="classTSpectrum.html#a02fdb00792c69d8b34aa78e42b6682e1">fResolution</a> = 1;</div><div class="line"><a name="l00357"></a><span class="lineno">  357</span>&#160;}</div><div class="line"><a name="l00358"></a><span class="lineno">  358</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00359"></a><span class="lineno">  359</span>&#160;<span class="comment">////////////////////////////////////////////////////////////////////////////////</span></div><div class="line"><a name="l00360"></a><span class="lineno">  360</span>&#160;<span class="comment">/// This function calculates background spectrum from source spectrum.</span></div><div class="line"><a name="l00361"></a><span class="lineno">  361</span>&#160;<span class="comment">/// The result is placed in the vector pointed by spe1945ctrum pointer.</span></div><div class="line"><a name="l00362"></a><span class="lineno">  362</span>&#160;<span class="comment">/// The goal is to separate the useful information (peaks) from useless</span></div><div class="line"><a name="l00363"></a><span class="lineno">  363</span>&#160;<span class="comment">/// information (background).</span></div><div class="line"><a name="l00364"></a><span class="lineno">  364</span>&#160;<span class="comment">///</span></div><div class="line"><a name="l00365"></a><span class="lineno">  365</span>&#160;<span class="comment">/// - method is based on Sensitive Nonlinear Iterative Peak (SNIP) clipping</span></div><div class="line"><a name="l00366"></a><span class="lineno">  366</span>&#160;<span class="comment">///      algorithm.</span></div><div class="line"><a name="l00367"></a><span class="lineno">  367</span>&#160;<span class="comment">/// - new value in the channel &quot;i&quot; is calculated</span></div><div class="line"><a name="l00368"></a><span class="lineno">  368</span>&#160;<span class="comment">///</span></div><div class="line"><a name="l00369"></a><span class="lineno">  369</span>&#160;<span class="comment">/// \f[</span></div><div class="line"><a name="l00370"></a><span class="lineno">  370</span>&#160;<span class="comment">/// v_p(i) = min \left\{ v_{p-1}(i)^{\frac{\left[v_{p-1}(i+p)+v_{p-1}(i-p)\right]}{2}}   \right\}</span></div><div class="line"><a name="l00371"></a><span class="lineno">  371</span>&#160;<span class="comment">/// \f]</span></div><div class="line"><a name="l00372"></a><span class="lineno">  372</span>&#160;<span class="comment">///</span></div><div class="line"><a name="l00373"></a><span class="lineno">  373</span>&#160;<span class="comment">/// where p = 1, 2, ..., numberIterations. In fact it represents second order</span></div><div class="line"><a name="l00374"></a><span class="lineno">  374</span>&#160;<span class="comment">/// difference filter (-1,2,-1).</span></div><div class="line"><a name="l00375"></a><span class="lineno">  375</span>&#160;<span class="comment">///</span></div><div class="line"><a name="l00376"></a><span class="lineno">  376</span>&#160;<span class="comment">/// One can also change the</span></div><div class="line"><a name="l00377"></a><span class="lineno">  377</span>&#160;<span class="comment">/// direction of the change of the clipping window, the order of the clipping</span></div><div class="line"><a name="l00378"></a><span class="lineno">  378</span>&#160;<span class="comment">/// filter, to include smoothing, to set width of smoothing window and to include</span></div><div class="line"><a name="l00379"></a><span class="lineno">  379</span>&#160;<span class="comment">/// the estimation of Compton edges. On successful completion it returns 0. On</span></div><div class="line"><a name="l00380"></a><span class="lineno">  380</span>&#160;<span class="comment">/// error it returns pointer to the string describing error.</span></div><div class="line"><a name="l00381"></a><span class="lineno">  381</span>&#160;<span class="comment">///</span></div><div class="line"><a name="l00382"></a><span class="lineno">  382</span>&#160;<span class="comment">/// #### Parameters:</span></div><div class="line"><a name="l00383"></a><span class="lineno">  383</span>&#160;<span class="comment">///</span></div><div class="line"><a name="l00384"></a><span class="lineno">  384</span>&#160;<span class="comment">/// - spectrum: pointer to the vector of source spectrum</span></div><div class="line"><a name="l00385"></a><span class="lineno">  385</span>&#160;<span class="comment">/// - ssize: length of the spectrum vector</span></div><div class="line"><a name="l00386"></a><span class="lineno">  386</span>&#160;<span class="comment">/// - numberIterations: maximal width of clipping window,</span></div><div class="line"><a name="l00387"></a><span class="lineno">  387</span>&#160;<span class="comment">/// - direction:  direction of change of clipping window.</span></div><div class="line"><a name="l00388"></a><span class="lineno">  388</span>&#160;<span class="comment">///      Possible values: kBackIncreasingWindow, kBackDecreasingWindow</span></div><div class="line"><a name="l00389"></a><span class="lineno">  389</span>&#160;<span class="comment">/// - filterOrder: order of clipping filter.</span></div><div class="line"><a name="l00390"></a><span class="lineno">  390</span>&#160;<span class="comment">///      Possible values: kBackOrder2, kBackOrder4, kBackOrder6, kBackOrder8</span></div><div class="line"><a name="l00391"></a><span class="lineno">  391</span>&#160;<span class="comment">/// - smoothing: logical variable whether the smoothing operation in the</span></div><div class="line"><a name="l00392"></a><span class="lineno">  392</span>&#160;<span class="comment">///      estimation of background will be included.</span></div><div class="line"><a name="l00393"></a><span class="lineno">  393</span>&#160;<span class="comment">///      Possible values: kFALSE, kTRUE</span></div><div class="line"><a name="l00394"></a><span class="lineno">  394</span>&#160;<span class="comment">/// - smoothWindow: width of smoothing window.</span></div><div class="line"><a name="l00395"></a><span class="lineno">  395</span>&#160;<span class="comment">///      Possible values: kBackSmoothing3, kBackSmoothing5, kBackSmoothing7,</span></div><div class="line"><a name="l00396"></a><span class="lineno">  396</span>&#160;<span class="comment">///      kBackSmoothing9, kBackSmoothing11, kBackSmoothing13, kBackSmoothing15.</span></div><div class="line"><a name="l00397"></a><span class="lineno">  397</span>&#160;<span class="comment">/// - compton: logical variable whether the estimation of Compton edge will be</span></div><div class="line"><a name="l00398"></a><span class="lineno">  398</span>&#160;<span class="comment">///      included. Possible values: kFALSE, kTRUE.</span></div><div class="line"><a name="l00399"></a><span class="lineno">  399</span>&#160;<span class="comment">///</span></div><div class="line"><a name="l00400"></a><span class="lineno">  400</span>&#160;<span class="comment">/// #### References:</span></div><div class="line"><a name="l00401"></a><span class="lineno">  401</span>&#160;<span class="comment">///</span></div><div class="line"><a name="l00402"></a><span class="lineno">  402</span>&#160;<span class="comment">///   1. C. G Ryan et al.: SNIP, a statistics-sensitive background treatment for the</span></div><div class="line"><a name="l00403"></a><span class="lineno">  403</span>&#160;<span class="comment">/// quantitative analysis of PIXE spectra in geoscience applications. NIM, B34</span></div><div class="line"><a name="l00404"></a><span class="lineno">  404</span>&#160;<span class="comment">/// (1988), 396-402.</span></div><div class="line"><a name="l00405"></a><span class="lineno">  405</span>&#160;<span class="comment">///</span></div><div class="line"><a name="l00406"></a><span class="lineno">  406</span>&#160;<span class="comment">///   2. M. Morhac;, J. Kliman, V. Matouoek, M. Veselsky, I. Turzo:</span></div><div class="line"><a name="l00407"></a><span class="lineno">  407</span>&#160;<span class="comment">/// Background elimination methods for multidimensional gamma-ray spectra. NIM,</span></div><div class="line"><a name="l00408"></a><span class="lineno">  408</span>&#160;<span class="comment">/// A401 (1997) 113-132.</span></div><div class="line"><a name="l00409"></a><span class="lineno">  409</span>&#160;<span class="comment">///</span></div><div class="line"><a name="l00410"></a><span class="lineno">  410</span>&#160;<span class="comment">///   3. D. D. Burgess, R. J. Tervo: Background estimation for gamma-ray</span></div><div class="line"><a name="l00411"></a><span class="lineno">  411</span>&#160;<span class="comment">/// spectroscopy. NIM 214 (1983), 431-434.</span></div><div class="line"><a name="l00412"></a><span class="lineno">  412</span>&#160;<span class="comment">///</span></div><div class="line"><a name="l00413"></a><span class="lineno">  413</span>&#160;<span class="comment">/// ### Example 1 script Background_incr.C:</span></div><div class="line"><a name="l00414"></a><span class="lineno">  414</span>&#160;<span class="comment">///</span></div><div class="line"><a name="l00415"></a><span class="lineno">  415</span>&#160;<span class="comment">/// Example of the estimation of background for number of iterations=6.</span></div><div class="line"><a name="l00416"></a><span class="lineno">  416</span>&#160;<span class="comment">/// Original spectrum is shown in black color, estimated background in red color.</span></div><div class="line"><a name="l00417"></a><span class="lineno">  417</span>&#160;<span class="comment">///</span></div><div class="line"><a name="l00418"></a><span class="lineno">  418</span>&#160;<span class="comment">/// Begin_Macro(source)</span></div><div class="line"><a name="l00419"></a><span class="lineno">  419</span>&#160;<span class="comment">/// ../../../tutorials/spectrum/Background_incr.C</span></div><div class="line"><a name="l00420"></a><span class="lineno">  420</span>&#160;<span class="comment">/// End_Macro</span></div><div class="line"><a name="l00421"></a><span class="lineno">  421</span>&#160;<span class="comment">///</span></div><div class="line"><a name="l00422"></a><span class="lineno">  422</span>&#160;<span class="comment">/// ### Example 2 script Background_decr.C:</span></div><div class="line"><a name="l00423"></a><span class="lineno">  423</span>&#160;<span class="comment">///</span></div><div class="line"><a name="l00424"></a><span class="lineno">  424</span>&#160;<span class="comment">/// In Example 1. one can notice that at the edges of the peaks the estimated</span></div><div class="line"><a name="l00425"></a><span class="lineno">  425</span>&#160;<span class="comment">/// background goes under the peaks. An alternative approach is to decrease the</span></div><div class="line"><a name="l00426"></a><span class="lineno">  426</span>&#160;<span class="comment">/// clipping window from a given value numberIterations to the value of one, which</span></div><div class="line"><a name="l00427"></a><span class="lineno">  427</span>&#160;<span class="comment">/// is presented in this example.</span></div><div class="line"><a name="l00428"></a><span class="lineno">  428</span>&#160;<span class="comment">///</span></div><div class="line"><a name="l00429"></a><span class="lineno">  429</span>&#160;<span class="comment">/// Example of the estimation of background for numberIterations=6 using</span></div><div class="line"><a name="l00430"></a><span class="lineno">  430</span>&#160;<span class="comment">/// decreasing clipping window algorithm. Original spectrum is shown in black</span></div><div class="line"><a name="l00431"></a><span class="lineno">  431</span>&#160;<span class="comment">/// color, estimated background in red color.</span></div><div class="line"><a name="l00432"></a><span class="lineno">  432</span>&#160;<span class="comment">///</span></div><div class="line"><a name="l00433"></a><span class="lineno">  433</span>&#160;<span class="comment">/// Begin_Macro(source)</span></div><div class="line"><a name="l00434"></a><span class="lineno">  434</span>&#160;<span class="comment">/// ../../../tutorials/spectrum/Background_decr.C</span></div><div class="line"><a name="l00435"></a><span class="lineno">  435</span>&#160;<span class="comment">/// End_Macro</span></div><div class="line"><a name="l00436"></a><span class="lineno">  436</span>&#160;<span class="comment">///</span></div><div class="line"><a name="l00437"></a><span class="lineno">  437</span>&#160;<span class="comment">/// ### Example 3 script Background_width.C:</span></div><div class="line"><a name="l00438"></a><span class="lineno">  438</span>&#160;<span class="comment">///</span></div><div class="line"><a name="l00439"></a><span class="lineno">  439</span>&#160;<span class="comment">/// The question is how to choose the width of the clipping window, i.e.,</span></div><div class="line"><a name="l00440"></a><span class="lineno">  440</span>&#160;<span class="comment">/// numberIterations parameter. The influence of this parameter on the estimated</span></div><div class="line"><a name="l00441"></a><span class="lineno">  441</span>&#160;<span class="comment">/// background is illustrated in Example 3.</span></div><div class="line"><a name="l00442"></a><span class="lineno">  442</span>&#160;<span class="comment">///</span></div><div class="line"><a name="l00443"></a><span class="lineno">  443</span>&#160;<span class="comment">/// Example of the influence of clipping window width on the estimated background</span></div><div class="line"><a name="l00444"></a><span class="lineno">  444</span>&#160;<span class="comment">/// for numberIterations=4 (red line), 6 (orange line) 8 (green line) using decreasing</span></div><div class="line"><a name="l00445"></a><span class="lineno">  445</span>&#160;<span class="comment">/// clipping window algorithm.</span></div><div class="line"><a name="l00446"></a><span class="lineno">  446</span>&#160;<span class="comment">///</span></div><div class="line"><a name="l00447"></a><span class="lineno">  447</span>&#160;<span class="comment">/// in general one should set this parameter so that the value</span></div><div class="line"><a name="l00448"></a><span class="lineno">  448</span>&#160;<span class="comment">/// 2*numberIterations+1 was greater than the widths of preserved objects (peaks).</span></div><div class="line"><a name="l00449"></a><span class="lineno">  449</span>&#160;<span class="comment">///</span></div><div class="line"><a name="l00450"></a><span class="lineno">  450</span>&#160;<span class="comment">/// Begin_Macro(source)</span></div><div class="line"><a name="l00451"></a><span class="lineno">  451</span>&#160;<span class="comment">/// ../../../tutorials/spectrum/Background_width.C</span></div><div class="line"><a name="l00452"></a><span class="lineno">  452</span>&#160;<span class="comment">/// End_Macro</span></div><div class="line"><a name="l00453"></a><span class="lineno">  453</span>&#160;<span class="comment">///</span></div><div class="line"><a name="l00454"></a><span class="lineno">  454</span>&#160;<span class="comment">/// ### Example 4 script Background_width2.C:</span></div><div class="line"><a name="l00455"></a><span class="lineno">  455</span>&#160;<span class="comment">///</span></div><div class="line"><a name="l00456"></a><span class="lineno">  456</span>&#160;<span class="comment">/// another example for very complex spectrum is given here.</span></div><div class="line"><a name="l00457"></a><span class="lineno">  457</span>&#160;<span class="comment">///</span></div><div class="line"><a name="l00458"></a><span class="lineno">  458</span>&#160;<span class="comment">/// Example of the influence of clipping window width on the estimated background</span></div><div class="line"><a name="l00459"></a><span class="lineno">  459</span>&#160;<span class="comment">/// for numberIterations=10 (red line), 20 (blue line), 30 (green line) and</span></div><div class="line"><a name="l00460"></a><span class="lineno">  460</span>&#160;<span class="comment">/// 40 (magenta line) using decreasing clipping window algorithm.</span></div><div class="line"><a name="l00461"></a><span class="lineno">  461</span>&#160;<span class="comment">///</span></div><div class="line"><a name="l00462"></a><span class="lineno">  462</span>&#160;<span class="comment">/// Begin_Macro(source)</span></div><div class="line"><a name="l00463"></a><span class="lineno">  463</span>&#160;<span class="comment">/// ../../../tutorials/spectrum/Background_width2.C</span></div><div class="line"><a name="l00464"></a><span class="lineno">  464</span>&#160;<span class="comment">/// End_Macro</span></div><div class="line"><a name="l00465"></a><span class="lineno">  465</span>&#160;<span class="comment">///</span></div><div class="line"><a name="l00466"></a><span class="lineno">  466</span>&#160;<span class="comment">/// ### Example 5 script Background_order.C:</span></div><div class="line"><a name="l00467"></a><span class="lineno">  467</span>&#160;<span class="comment">///</span></div><div class="line"><a name="l00468"></a><span class="lineno">  468</span>&#160;<span class="comment">/// Second order difference filter removes linear (quasi-linear) background and</span></div><div class="line"><a name="l00469"></a><span class="lineno">  469</span>&#160;<span class="comment">/// preserves symmetrical peaks. However if the shape of the background is more</span></div><div class="line"><a name="l00470"></a><span class="lineno">  470</span>&#160;<span class="comment">/// complex one can employ higher-order clipping filters.</span></div><div class="line"><a name="l00471"></a><span class="lineno">  471</span>&#160;<span class="comment">///</span></div><div class="line"><a name="l00472"></a><span class="lineno">  472</span>&#160;<span class="comment">/// Example of the influence of clipping filter difference order on the estimated</span></div><div class="line"><a name="l00473"></a><span class="lineno">  473</span>&#160;<span class="comment">/// background for fNnumberIterations=40, 2-nd order red line, 4-th order blue line,</span></div><div class="line"><a name="l00474"></a><span class="lineno">  474</span>&#160;<span class="comment">/// 6-th order green line and 8-th order magenta line, and using decreasing</span></div><div class="line"><a name="l00475"></a><span class="lineno">  475</span>&#160;<span class="comment">/// clipping window algorithm.</span></div><div class="line"><a name="l00476"></a><span class="lineno">  476</span>&#160;<span class="comment">///</span></div><div class="line"><a name="l00477"></a><span class="lineno">  477</span>&#160;<span class="comment">/// Begin_Macro(source)</span></div><div class="line"><a name="l00478"></a><span class="lineno">  478</span>&#160;<span class="comment">/// ../../../tutorials/spectrum/Background_order.C</span></div><div class="line"><a name="l00479"></a><span class="lineno">  479</span>&#160;<span class="comment">/// End_Macro</span></div><div class="line"><a name="l00480"></a><span class="lineno">  480</span>&#160;<span class="comment">///</span></div><div class="line"><a name="l00481"></a><span class="lineno">  481</span>&#160;<span class="comment">/// ### Example 6 script Background_smooth.C:</span></div><div class="line"><a name="l00482"></a><span class="lineno">  482</span>&#160;<span class="comment">///</span></div><div class="line"><a name="l00483"></a><span class="lineno">  483</span>&#160;<span class="comment">/// The estimate of the background can be influenced by noise present in the</span></div><div class="line"><a name="l00484"></a><span class="lineno">  484</span>&#160;<span class="comment">/// spectrum.  We proposed the algorithm of the background estimate with</span></div><div class="line"><a name="l00485"></a><span class="lineno">  485</span>&#160;<span class="comment">/// simultaneous smoothing.  In the original algorithm without smoothing, the</span></div><div class="line"><a name="l00486"></a><span class="lineno">  486</span>&#160;<span class="comment">/// estimated background snatches the lower spikes in the noise. Consequently,</span></div><div class="line"><a name="l00487"></a><span class="lineno">  487</span>&#160;<span class="comment">/// the areas of peaks are biased by this error.</span></div><div class="line"><a name="l00488"></a><span class="lineno">  488</span>&#160;<span class="comment">///</span></div><div class="line"><a name="l00489"></a><span class="lineno">  489</span>&#160;<span class="comment">/// \image html TSpectrum_Background_smooth1.jpg Principle of background estimation algorithm with simultaneous smoothing.</span></div><div class="line"><a name="l00490"></a><span class="lineno">  490</span>&#160;<span class="comment">///</span></div><div class="line"><a name="l00491"></a><span class="lineno">  491</span>&#160;<span class="comment">/// Begin_Macro(source)</span></div><div class="line"><a name="l00492"></a><span class="lineno">  492</span>&#160;<span class="comment">/// ../../../tutorials/spectrum/Background_smooth.C</span></div><div class="line"><a name="l00493"></a><span class="lineno">  493</span>&#160;<span class="comment">/// End_Macro</span></div><div class="line"><a name="l00494"></a><span class="lineno">  494</span>&#160;<span class="comment">///</span></div><div class="line"><a name="l00495"></a><span class="lineno">  495</span>&#160;<span class="comment">/// ### Example 8 script Background_compton.C:</span></div><div class="line"><a name="l00496"></a><span class="lineno">  496</span>&#160;<span class="comment">///</span></div><div class="line"><a name="l00497"></a><span class="lineno">  497</span>&#160;<span class="comment">/// Sometimes it is necessary to include also the Compton edges into the estimate of</span></div><div class="line"><a name="l00498"></a><span class="lineno">  498</span>&#160;<span class="comment">/// the background. This example presents the synthetic spectrum</span></div><div class="line"><a name="l00499"></a><span class="lineno">  499</span>&#160;<span class="comment">/// with Compton edges. The background was estimated using the 8-th order filter</span></div><div class="line"><a name="l00500"></a><span class="lineno">  500</span>&#160;<span class="comment">/// with the estimation of the Compton edges using decreasing</span></div><div class="line"><a name="l00501"></a><span class="lineno">  501</span>&#160;<span class="comment">/// clipping window algorithm (numberIterations=10) with smoothing</span></div><div class="line"><a name="l00502"></a><span class="lineno">  502</span>&#160;<span class="comment">/// (smoothingWindow=5).</span></div><div class="line"><a name="l00503"></a><span class="lineno">  503</span>&#160;<span class="comment">///</span></div><div class="line"><a name="l00504"></a><span class="lineno">  504</span>&#160;<span class="comment">/// Example of the estimate of the background with Compton edges (red line) for</span></div><div class="line"><a name="l00505"></a><span class="lineno">  505</span>&#160;<span class="comment">/// numberIterations=10, 8-th order difference filter, using decreasing clipping</span></div><div class="line"><a name="l00506"></a><span class="lineno">  506</span>&#160;<span class="comment">/// window algorithm and smoothing (smoothingWindow=5).</span></div><div class="line"><a name="l00507"></a><span class="lineno">  507</span>&#160;<span class="comment">///</span></div><div class="line"><a name="l00508"></a><span class="lineno">  508</span>&#160;<span class="comment">/// Begin_Macro(source)</span></div><div class="line"><a name="l00509"></a><span class="lineno">  509</span>&#160;<span class="comment">/// ../../../tutorials/spectrum/Background_compton.C</span></div><div class="line"><a name="l00510"></a><span class="lineno">  510</span>&#160;<span class="comment">/// End_Macro</span></div><div class="line"><a name="l00511"></a><span class="lineno">  511</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00512"></a><span class="lineno"><a class="line" href="classTSpectrum.html#a7830480612d1ee301964e6c79319f444">  512</a></span>&#160;<span class="keyword">const</span> <span class="keywordtype">char</span> *<a class="code" href="classTSpectrum.html#a56e15d1c36c7557b17d5f6d68fa315a7">TSpectrum::Background</a>(<a class="code" href="RtypesCore_8h.html#ab9b5334647b78ec4256db251e3ae1fc6">Double_t</a> *spectrum, <span class="keywordtype">int</span> ssize,</div><div class="line"><a name="l00513"></a><span class="lineno">  513</span>&#160;                                          <span class="keywordtype">int</span> numberIterations,</div><div class="line"><a name="l00514"></a><span class="lineno">  514</span>&#160;                                          <span class="keywordtype">int</span> direction, <span class="keywordtype">int</span> filterOrder,</div><div class="line"><a name="l00515"></a><span class="lineno">  515</span>&#160;                                          <span class="keywordtype">bool</span> smoothing,<span class="keywordtype">int</span> smoothWindow,</div><div class="line"><a name="l00516"></a><span class="lineno">  516</span>&#160;                                          <span class="keywordtype">bool</span> compton)</div><div class="line"><a name="l00517"></a><span class="lineno">  517</span>&#160;{</div><div class="line"><a name="l00518"></a><span class="lineno">  518</span>&#160;   <span class="keywordtype">int</span> i, j, w, bw, b1, b2, priz;</div><div class="line"><a name="l00519"></a><span class="lineno">  519</span>&#160;   <a class="code" href="RtypesCore_8h.html#ab9b5334647b78ec4256db251e3ae1fc6">Double_t</a> <a class="code" href="textangle_8C.html#a655a1c2a1ec25e8fcfb713772281e8f5">a</a>, <a class="code" href="TRolke_8cxx.html#a1a2354f40e332ad13673b70afc2c0dbf">b</a>, <a class="code" href="RSha256_8hxx.html#a63f410abde93141c9013b7d3f3971738">c</a>, <a class="code" href="RSha256_8hxx.html#a23b5b0a85bf5762c93a855f40c0343ce">d</a>, <a class="code" href="TRolke_8cxx.html#a680432d265de4ea2534f8ec32f1aa417">e</a>, yb1, yb2, ai, av, men, b4, c4, d4, e4, b6, c6, d6, e6, f6, g6, b8, c8, d8, e8, f8, g8, h8, i8;</div><div class="line"><a name="l00520"></a><span class="lineno">  520</span>&#160;   <span class="keywordflow">if</span> (ssize &lt;= 0)</div><div class="line"><a name="l00521"></a><span class="lineno">  521</span>&#160;      <span class="keywordflow">return</span> <span class="stringliteral">&quot;Wrong Parameters&quot;</span>;</div><div class="line"><a name="l00522"></a><span class="lineno">  522</span>&#160;   <span class="keywordflow">if</span> (numberIterations &lt; 1)</div><div class="line"><a name="l00523"></a><span class="lineno">  523</span>&#160;      <span class="keywordflow">return</span> <span class="stringliteral">&quot;Width of Clipping Window Must Be Positive&quot;</span>;</div><div class="line"><a name="l00524"></a><span class="lineno">  524</span>&#160;   <span class="keywordflow">if</span> (ssize &lt; 2 * numberIterations + 1)</div><div class="line"><a name="l00525"></a><span class="lineno">  525</span>&#160;      <span class="keywordflow">return</span> <span class="stringliteral">&quot;Too Large Clipping Window&quot;</span>;</div><div class="line"><a name="l00526"></a><span class="lineno">  526</span>&#160;   <span class="keywordflow">if</span> (smoothing == <a class="code" href="RtypesCore_8h.html#af2f51d30ccd86e85be3e3e69793a86ef">kTRUE</a> &amp;&amp; smoothWindow != <a class="code" href="classTSpectrum.html#a22565bc179ec06fc52d9377905f71871af1af12f6d81dd70d82c188845db4af20">kBackSmoothing3</a> &amp;&amp; smoothWindow != <a class="code" href="classTSpectrum.html#a22565bc179ec06fc52d9377905f71871ad4143bb4537ab0c1644c73483417c107">kBackSmoothing5</a> &amp;&amp; smoothWindow != <a class="code" href="classTSpectrum.html#a22565bc179ec06fc52d9377905f71871a325c5b1acb8d5402c61b7a8b34f03595">kBackSmoothing7</a> &amp;&amp; smoothWindow != <a class="code" href="classTSpectrum.html#a22565bc179ec06fc52d9377905f71871a8f97bc92755b5a88c1db976f7ce6d585">kBackSmoothing9</a> &amp;&amp; smoothWindow != <a class="code" href="classTSpectrum.html#a22565bc179ec06fc52d9377905f71871a167fc10caa2484d4d3dfae3347c05303">kBackSmoothing11</a> &amp;&amp; smoothWindow != <a class="code" href="classTSpectrum.html#a22565bc179ec06fc52d9377905f71871a881ed7ed9012a0e081b164f058094d2e">kBackSmoothing13</a> &amp;&amp; smoothWindow != <a class="code" href="classTSpectrum.html#a22565bc179ec06fc52d9377905f71871a192bec0ffbdc8def548e1907a7bad96f">kBackSmoothing15</a>)</div><div class="line"><a name="l00527"></a><span class="lineno">  527</span>&#160;      <span class="keywordflow">return</span> <span class="stringliteral">&quot;Incorrect width of smoothing window&quot;</span>;</div><div class="line"><a name="l00528"></a><span class="lineno">  528</span>&#160;   <a class="code" href="RtypesCore_8h.html#ab9b5334647b78ec4256db251e3ae1fc6">Double_t</a> *working_space = <span class="keyword">new</span> <a class="code" href="RtypesCore_8h.html#ab9b5334647b78ec4256db251e3ae1fc6">Double_t</a>[2 * ssize];</div><div class="line"><a name="l00529"></a><span class="lineno">  529</span>&#160;   <span class="keywordflow">for</span> (i = 0; i &lt; ssize; i++){</div><div class="line"><a name="l00530"></a><span class="lineno">  530</span>&#160;      working_space[i] = spectrum[i];</div><div class="line"><a name="l00531"></a><span class="lineno">  531</span>&#160;      working_space[i + ssize] = spectrum[i];</div><div class="line"><a name="l00532"></a><span class="lineno">  532</span>&#160;   }</div><div class="line"><a name="l00533"></a><span class="lineno">  533</span>&#160;   bw=(smoothWindow-1)/2;</div><div class="line"><a name="l00534"></a><span class="lineno">  534</span>&#160;   <span class="keywordflow">if</span> (direction == <a class="code" href="classTSpectrum.html#a22565bc179ec06fc52d9377905f71871a4133774c283c838d5473fa75127ae22f">kBackIncreasingWindow</a>)</div><div class="line"><a name="l00535"></a><span class="lineno">  535</span>&#160;      i = 1;</div><div class="line"><a name="l00536"></a><span class="lineno">  536</span>&#160;   <span class="keywordflow">else</span> <span class="keywordflow">if</span>(direction == <a class="code" href="classTSpectrum.html#a22565bc179ec06fc52d9377905f71871a7f8038087d885e41b186a81ff9c85a2c">kBackDecreasingWindow</a>)</div><div class="line"><a name="l00537"></a><span class="lineno">  537</span>&#160;      i = numberIterations;</div><div class="line"><a name="l00538"></a><span class="lineno">  538</span>&#160;   <span class="keywordflow">if</span> (filterOrder == <a class="code" href="classTSpectrum.html#a22565bc179ec06fc52d9377905f71871a22ca3a5b1f9745fabaaa8bef2cb39d35">kBackOrder2</a>) {</div><div class="line"><a name="l00539"></a><span class="lineno">  539</span>&#160;      <span class="keywordflow">do</span>{</div><div class="line"><a name="l00540"></a><span class="lineno">  540</span>&#160;         <span class="keywordflow">for</span> (j = i; j &lt; ssize - i; j++) {</div><div class="line"><a name="l00541"></a><span class="lineno">  541</span>&#160;            <span class="keywordflow">if</span> (smoothing == <a class="code" href="RtypesCore_8h.html#a7e568baf910535e8ffd438acb843434d">kFALSE</a>){</div><div class="line"><a name="l00542"></a><span class="lineno">  542</span>&#160;               <a class="code" href="textangle_8C.html#a655a1c2a1ec25e8fcfb713772281e8f5">a</a> = working_space[ssize + j];</div><div class="line"><a name="l00543"></a><span class="lineno">  543</span>&#160;               <a class="code" href="TRolke_8cxx.html#a1a2354f40e332ad13673b70afc2c0dbf">b</a> = (working_space[ssize + j - i] + working_space[ssize + j + i]) / 2.0;</div><div class="line"><a name="l00544"></a><span class="lineno">  544</span>&#160;               <span class="keywordflow">if</span> (<a class="code" href="TRolke_8cxx.html#a1a2354f40e332ad13673b70afc2c0dbf">b</a> &lt; <a class="code" href="textangle_8C.html#a655a1c2a1ec25e8fcfb713772281e8f5">a</a>)</div><div class="line"><a name="l00545"></a><span class="lineno">  545</span>&#160;                  <a class="code" href="textangle_8C.html#a655a1c2a1ec25e8fcfb713772281e8f5">a</a> = <a class="code" href="TRolke_8cxx.html#a1a2354f40e332ad13673b70afc2c0dbf">b</a>;</div><div class="line"><a name="l00546"></a><span class="lineno">  546</span>&#160;               working_space[j] = <a class="code" href="textangle_8C.html#a655a1c2a1ec25e8fcfb713772281e8f5">a</a>;</div><div class="line"><a name="l00547"></a><span class="lineno">  547</span>&#160;            }</div><div class="line"><a name="l00548"></a><span class="lineno">  548</span>&#160;</div><div class="line"><a name="l00549"></a><span class="lineno">  549</span>&#160;            <span class="keywordflow">else</span> <span class="keywordflow">if</span> (smoothing == <a class="code" href="RtypesCore_8h.html#af2f51d30ccd86e85be3e3e69793a86ef">kTRUE</a>){</div><div class="line"><a name="l00550"></a><span class="lineno">  550</span>&#160;               <a class="code" href="textangle_8C.html#a655a1c2a1ec25e8fcfb713772281e8f5">a</a> = working_space[ssize + j];</div><div class="line"><a name="l00551"></a><span class="lineno">  551</span>&#160;               av = 0;</div><div class="line"><a name="l00552"></a><span class="lineno">  552</span>&#160;               men = 0;</div><div class="line"><a name="l00553"></a><span class="lineno">  553</span>&#160;               <span class="keywordflow">for</span> (w = j - bw; w &lt;= j + bw; w++){</div><div class="line"><a name="l00554"></a><span class="lineno">  554</span>&#160;                  <span class="keywordflow">if</span> ( w &gt;= 0 &amp;&amp; w &lt; ssize){</div><div class="line"><a name="l00555"></a><span class="lineno">  555</span>&#160;                     av += working_space[ssize + w];</div><div class="line"><a name="l00556"></a><span class="lineno">  556</span>&#160;                     men +=1;</div><div class="line"><a name="l00557"></a><span class="lineno">  557</span>&#160;                  }</div><div class="line"><a name="l00558"></a><span class="lineno">  558</span>&#160;               }</div><div class="line"><a name="l00559"></a><span class="lineno">  559</span>&#160;               av = av / men;</div><div class="line"><a name="l00560"></a><span class="lineno">  560</span>&#160;               <a class="code" href="TRolke_8cxx.html#a1a2354f40e332ad13673b70afc2c0dbf">b</a> = 0;</div><div class="line"><a name="l00561"></a><span class="lineno">  561</span>&#160;               men = 0;</div><div class="line"><a name="l00562"></a><span class="lineno">  562</span>&#160;               <span class="keywordflow">for</span> (w = j - i - bw; w &lt;= j - i + bw; w++){</div><div class="line"><a name="l00563"></a><span class="lineno">  563</span>&#160;                  <span class="keywordflow">if</span> ( w &gt;= 0 &amp;&amp; w &lt; ssize){</div><div class="line"><a name="l00564"></a><span class="lineno">  564</span>&#160;                     <a class="code" href="TRolke_8cxx.html#a1a2354f40e332ad13673b70afc2c0dbf">b</a> += working_space[ssize + w];</div><div class="line"><a name="l00565"></a><span class="lineno">  565</span>&#160;                     men +=1;</div><div class="line"><a name="l00566"></a><span class="lineno">  566</span>&#160;                  }</div><div class="line"><a name="l00567"></a><span class="lineno">  567</span>&#160;               }</div><div class="line"><a name="l00568"></a><span class="lineno">  568</span>&#160;               <a class="code" href="TRolke_8cxx.html#a1a2354f40e332ad13673b70afc2c0dbf">b</a> = <a class="code" href="TRolke_8cxx.html#a1a2354f40e332ad13673b70afc2c0dbf">b</a> / men;</div><div class="line"><a name="l00569"></a><span class="lineno">  569</span>&#160;               <a class="code" href="RSha256_8hxx.html#a63f410abde93141c9013b7d3f3971738">c</a> = 0;</div><div class="line"><a name="l00570"></a><span class="lineno">  570</span>&#160;               men = 0;</div><div class="line"><a name="l00571"></a><span class="lineno">  571</span>&#160;               <span class="keywordflow">for</span> (w = j + i - bw; w &lt;= j + i + bw; w++){</div><div class="line"><a name="l00572"></a><span class="lineno">  572</span>&#160;                  <span class="keywordflow">if</span> ( w &gt;= 0 &amp;&amp; w &lt; ssize){</div><div class="line"><a name="l00573"></a><span class="lineno">  573</span>&#160;                     <a class="code" href="RSha256_8hxx.html#a63f410abde93141c9013b7d3f3971738">c</a> += working_space[ssize + w];</div><div class="line"><a name="l00574"></a><span class="lineno">  574</span>&#160;                     men +=1;</div><div class="line"><a name="l00575"></a><span class="lineno">  575</span>&#160;                  }</div><div class="line"><a name="l00576"></a><span class="lineno">  576</span>&#160;               }</div><div class="line"><a name="l00577"></a><span class="lineno">  577</span>&#160;               <a class="code" href="RSha256_8hxx.html#a63f410abde93141c9013b7d3f3971738">c</a> = <a class="code" href="RSha256_8hxx.html#a63f410abde93141c9013b7d3f3971738">c</a> / men;</div><div class="line"><a name="l00578"></a><span class="lineno">  578</span>&#160;               <a class="code" href="TRolke_8cxx.html#a1a2354f40e332ad13673b70afc2c0dbf">b</a> = (<a class="code" href="TRolke_8cxx.html#a1a2354f40e332ad13673b70afc2c0dbf">b</a> + <a class="code" href="RSha256_8hxx.html#a63f410abde93141c9013b7d3f3971738">c</a>) / 2;</div><div class="line"><a name="l00579"></a><span class="lineno">  579</span>&#160;               <span class="keywordflow">if</span> (<a class="code" href="TRolke_8cxx.html#a1a2354f40e332ad13673b70afc2c0dbf">b</a> &lt; <a class="code" href="textangle_8C.html#a655a1c2a1ec25e8fcfb713772281e8f5">a</a>)</div><div class="line"><a name="l00580"></a><span class="lineno">  580</span>&#160;                  av = <a class="code" href="TRolke_8cxx.html#a1a2354f40e332ad13673b70afc2c0dbf">b</a>;</div><div class="line"><a name="l00581"></a><span class="lineno">  581</span>&#160;               working_space[j]=av;</div><div class="line"><a name="l00582"></a><span class="lineno">  582</span>&#160;            }</div><div class="line"><a name="l00583"></a><span class="lineno">  583</span>&#160;         }</div><div class="line"><a name="l00584"></a><span class="lineno">  584</span>&#160;         <span class="keywordflow">for</span> (j = i; j &lt; ssize - i; j++)</div><div class="line"><a name="l00585"></a><span class="lineno">  585</span>&#160;            working_space[ssize + j] = working_space[j];</div><div class="line"><a name="l00586"></a><span class="lineno">  586</span>&#160;         <span class="keywordflow">if</span> (direction == <a class="code" href="classTSpectrum.html#a22565bc179ec06fc52d9377905f71871a4133774c283c838d5473fa75127ae22f">kBackIncreasingWindow</a>)</div><div class="line"><a name="l00587"></a><span class="lineno">  587</span>&#160;            i+=1;</div><div class="line"><a name="l00588"></a><span class="lineno">  588</span>&#160;         <span class="keywordflow">else</span> <span class="keywordflow">if</span>(direction == <a class="code" href="classTSpectrum.html#a22565bc179ec06fc52d9377905f71871a7f8038087d885e41b186a81ff9c85a2c">kBackDecreasingWindow</a>)</div><div class="line"><a name="l00589"></a><span class="lineno">  589</span>&#160;            i-=1;</div><div class="line"><a name="l00590"></a><span class="lineno">  590</span>&#160;      }<span class="keywordflow">while</span>((direction == <a class="code" href="classTSpectrum.html#a22565bc179ec06fc52d9377905f71871a4133774c283c838d5473fa75127ae22f">kBackIncreasingWindow</a> &amp;&amp; i &lt;= numberIterations) || (direction == <a class="code" href="classTSpectrum.html#a22565bc179ec06fc52d9377905f71871a7f8038087d885e41b186a81ff9c85a2c">kBackDecreasingWindow</a> &amp;&amp; i &gt;= 1));</div><div class="line"><a name="l00591"></a><span class="lineno">  591</span>&#160;   }</div><div class="line"><a name="l00592"></a><span class="lineno">  592</span>&#160;</div><div class="line"><a name="l00593"></a><span class="lineno">  593</span>&#160;   <span class="keywordflow">else</span> <span class="keywordflow">if</span> (filterOrder == <a class="code" href="classTSpectrum.html#a22565bc179ec06fc52d9377905f71871aafa4c82f25e396090b5cecb89d72bce7">kBackOrder4</a>) {</div><div class="line"><a name="l00594"></a><span class="lineno">  594</span>&#160;      <span class="keywordflow">do</span>{</div><div class="line"><a name="l00595"></a><span class="lineno">  595</span>&#160;         <span class="keywordflow">for</span> (j = i; j &lt; ssize - i; j++) {</div><div class="line"><a name="l00596"></a><span class="lineno">  596</span>&#160;            <span class="keywordflow">if</span> (smoothing == <a class="code" href="RtypesCore_8h.html#a7e568baf910535e8ffd438acb843434d">kFALSE</a>){</div><div class="line"><a name="l00597"></a><span class="lineno">  597</span>&#160;               <a class="code" href="textangle_8C.html#a655a1c2a1ec25e8fcfb713772281e8f5">a</a> = working_space[ssize + j];</div><div class="line"><a name="l00598"></a><span class="lineno">  598</span>&#160;               <a class="code" href="TRolke_8cxx.html#a1a2354f40e332ad13673b70afc2c0dbf">b</a> = (working_space[ssize + j - i] + working_space[ssize + j + i]) / 2.0;</div><div class="line"><a name="l00599"></a><span class="lineno">  599</span>&#160;               <a class="code" href="RSha256_8hxx.html#a63f410abde93141c9013b7d3f3971738">c</a> = 0;</div><div class="line"><a name="l00600"></a><span class="lineno">  600</span>&#160;               ai = i / 2;</div><div class="line"><a name="l00601"></a><span class="lineno">  601</span>&#160;               <a class="code" href="RSha256_8hxx.html#a63f410abde93141c9013b7d3f3971738">c</a> -= working_space[ssize + j - (<a class="code" href="RtypesCore_8h.html#a3885b911a54b47a4e61671f45dd45d0b">Int_t</a>) (2 * ai)] / 6;</div><div class="line"><a name="l00602"></a><span class="lineno">  602</span>&#160;               <a class="code" href="RSha256_8hxx.html#a63f410abde93141c9013b7d3f3971738">c</a> += 4 * working_space[ssize + j - (<a class="code" href="RtypesCore_8h.html#a3885b911a54b47a4e61671f45dd45d0b">Int_t</a>) ai] / 6;</div><div class="line"><a name="l00603"></a><span class="lineno">  603</span>&#160;               <a class="code" href="RSha256_8hxx.html#a63f410abde93141c9013b7d3f3971738">c</a> += 4 * working_space[ssize + j + (<a class="code" href="RtypesCore_8h.html#a3885b911a54b47a4e61671f45dd45d0b">Int_t</a>) ai] / 6;</div><div class="line"><a name="l00604"></a><span class="lineno">  604</span>&#160;               <a class="code" href="RSha256_8hxx.html#a63f410abde93141c9013b7d3f3971738">c</a> -= working_space[ssize + j + (<a class="code" href="RtypesCore_8h.html#a3885b911a54b47a4e61671f45dd45d0b">Int_t</a>) (2 * ai)] / 6;</div><div class="line"><a name="l00605"></a><span class="lineno">  605</span>&#160;               <span class="keywordflow">if</span> (<a class="code" href="TRolke_8cxx.html#a1a2354f40e332ad13673b70afc2c0dbf">b</a> &lt; <a class="code" href="RSha256_8hxx.html#a63f410abde93141c9013b7d3f3971738">c</a>)</div><div class="line"><a name="l00606"></a><span class="lineno">  606</span>&#160;                  <a class="code" href="TRolke_8cxx.html#a1a2354f40e332ad13673b70afc2c0dbf">b</a> = <a class="code" href="RSha256_8hxx.html#a63f410abde93141c9013b7d3f3971738">c</a>;</div><div class="line"><a name="l00607"></a><span class="lineno">  607</span>&#160;               <span class="keywordflow">if</span> (<a class="code" href="TRolke_8cxx.html#a1a2354f40e332ad13673b70afc2c0dbf">b</a> &lt; <a class="code" href="textangle_8C.html#a655a1c2a1ec25e8fcfb713772281e8f5">a</a>)</div><div class="line"><a name="l00608"></a><span class="lineno">  608</span>&#160;                  <a class="code" href="textangle_8C.html#a655a1c2a1ec25e8fcfb713772281e8f5">a</a> = <a class="code" href="TRolke_8cxx.html#a1a2354f40e332ad13673b70afc2c0dbf">b</a>;</div><div class="line"><a name="l00609"></a><span class="lineno">  609</span>&#160;               working_space[j] = <a class="code" href="textangle_8C.html#a655a1c2a1ec25e8fcfb713772281e8f5">a</a>;</div><div class="line"><a name="l00610"></a><span class="lineno">  610</span>&#160;            }</div><div class="line"><a name="l00611"></a><span class="lineno">  611</span>&#160;</div><div class="line"><a name="l00612"></a><span class="lineno">  612</span>&#160;            <span class="keywordflow">else</span> <span class="keywordflow">if</span> (smoothing == <a class="code" href="RtypesCore_8h.html#af2f51d30ccd86e85be3e3e69793a86ef">kTRUE</a>){</div><div class="line"><a name="l00613"></a><span class="lineno">  613</span>&#160;               <a class="code" href="textangle_8C.html#a655a1c2a1ec25e8fcfb713772281e8f5">a</a> = working_space[ssize + j];</div><div class="line"><a name="l00614"></a><span class="lineno">  614</span>&#160;               av = 0;</div><div class="line"><a name="l00615"></a><span class="lineno">  615</span>&#160;               men = 0;</div><div class="line"><a name="l00616"></a><span class="lineno">  616</span>&#160;               <span class="keywordflow">for</span> (w = j - bw; w &lt;= j + bw; w++){</div><div class="line"><a name="l00617"></a><span class="lineno">  617</span>&#160;                  <span class="keywordflow">if</span> ( w &gt;= 0 &amp;&amp; w &lt; ssize){</div><div class="line"><a name="l00618"></a><span class="lineno">  618</span>&#160;                     av += working_space[ssize + w];</div><div class="line"><a name="l00619"></a><span class="lineno">  619</span>&#160;                     men +=1;</div><div class="line"><a name="l00620"></a><span class="lineno">  620</span>&#160;                  }</div><div class="line"><a name="l00621"></a><span class="lineno">  621</span>&#160;               }</div><div class="line"><a name="l00622"></a><span class="lineno">  622</span>&#160;               av = av / men;</div><div class="line"><a name="l00623"></a><span class="lineno">  623</span>&#160;               <a class="code" href="TRolke_8cxx.html#a1a2354f40e332ad13673b70afc2c0dbf">b</a> = 0;</div><div class="line"><a name="l00624"></a><span class="lineno">  624</span>&#160;               men = 0;</div><div class="line"><a name="l00625"></a><span class="lineno">  625</span>&#160;               <span class="keywordflow">for</span> (w = j - i - bw; w &lt;= j - i + bw; w++){</div><div class="line"><a name="l00626"></a><span class="lineno">  626</span>&#160;                  <span class="keywordflow">if</span> ( w &gt;= 0 &amp;&amp; w &lt; ssize){</div><div class="line"><a name="l00627"></a><span class="lineno">  627</span>&#160;                     <a class="code" href="TRolke_8cxx.html#a1a2354f40e332ad13673b70afc2c0dbf">b</a> += working_space[ssize + w];</div><div class="line"><a name="l00628"></a><span class="lineno">  628</span>&#160;                     men +=1;</div><div class="line"><a name="l00629"></a><span class="lineno">  629</span>&#160;                  }</div><div class="line"><a name="l00630"></a><span class="lineno">  630</span>&#160;               }</div><div class="line"><a name="l00631"></a><span class="lineno">  631</span>&#160;               <a class="code" href="TRolke_8cxx.html#a1a2354f40e332ad13673b70afc2c0dbf">b</a> = <a class="code" href="TRolke_8cxx.html#a1a2354f40e332ad13673b70afc2c0dbf">b</a> / men;</div><div class="line"><a name="l00632"></a><span class="lineno">  632</span>&#160;               <a class="code" href="RSha256_8hxx.html#a63f410abde93141c9013b7d3f3971738">c</a> = 0;</div><div class="line"><a name="l00633"></a><span class="lineno">  633</span>&#160;               men = 0;</div><div class="line"><a name="l00634"></a><span class="lineno">  634</span>&#160;               <span class="keywordflow">for</span> (w = j + i - bw; w &lt;= j + i + bw; w++){</div><div class="line"><a name="l00635"></a><span class="lineno">  635</span>&#160;                  <span class="keywordflow">if</span> ( w &gt;= 0 &amp;&amp; w &lt; ssize){</div><div class="line"><a name="l00636"></a><span class="lineno">  636</span>&#160;                     <a class="code" href="RSha256_8hxx.html#a63f410abde93141c9013b7d3f3971738">c</a> += working_space[ssize + w];</div><div class="line"><a name="l00637"></a><span class="lineno">  637</span>&#160;                     men +=1;</div><div class="line"><a name="l00638"></a><span class="lineno">  638</span>&#160;                  }</div><div class="line"><a name="l00639"></a><span class="lineno">  639</span>&#160;               }</div><div class="line"><a name="l00640"></a><span class="lineno">  640</span>&#160;               <a class="code" href="RSha256_8hxx.html#a63f410abde93141c9013b7d3f3971738">c</a> = <a class="code" href="RSha256_8hxx.html#a63f410abde93141c9013b7d3f3971738">c</a> / men;</div><div class="line"><a name="l00641"></a><span class="lineno">  641</span>&#160;               <a class="code" href="TRolke_8cxx.html#a1a2354f40e332ad13673b70afc2c0dbf">b</a> = (<a class="code" href="TRolke_8cxx.html#a1a2354f40e332ad13673b70afc2c0dbf">b</a> + <a class="code" href="RSha256_8hxx.html#a63f410abde93141c9013b7d3f3971738">c</a>) / 2;</div><div class="line"><a name="l00642"></a><span class="lineno">  642</span>&#160;               ai = i / 2;</div><div class="line"><a name="l00643"></a><span class="lineno">  643</span>&#160;               b4 = 0, men = 0;</div><div class="line"><a name="l00644"></a><span class="lineno">  644</span>&#160;               <span class="keywordflow">for</span> (w = j - (<a class="code" href="RtypesCore_8h.html#a3885b911a54b47a4e61671f45dd45d0b">Int_t</a>)(2 * ai) - bw; w &lt;= j - (<a class="code" href="RtypesCore_8h.html#a3885b911a54b47a4e61671f45dd45d0b">Int_t</a>)(2 * ai) + bw; w++){</div><div class="line"><a name="l00645"></a><span class="lineno">  645</span>&#160;                  <span class="keywordflow">if</span> (w &gt;= 0 &amp;&amp; w &lt; ssize){</div><div class="line"><a name="l00646"></a><span class="lineno">  646</span>&#160;                     b4 += working_space[ssize + w];</div><div class="line"><a name="l00647"></a><span class="lineno">  647</span>&#160;                     men +=1;</div><div class="line"><a name="l00648"></a><span class="lineno">  648</span>&#160;                  }</div><div class="line"><a name="l00649"></a><span class="lineno">  649</span>&#160;               }</div><div class="line"><a name="l00650"></a><span class="lineno">  650</span>&#160;               b4 = b4 / men;</div><div class="line"><a name="l00651"></a><span class="lineno">  651</span>&#160;               c4 = 0, men = 0;</div><div class="line"><a name="l00652"></a><span class="lineno">  652</span>&#160;               <span class="keywordflow">for</span> (w = j - (<a class="code" href="RtypesCore_8h.html#a3885b911a54b47a4e61671f45dd45d0b">Int_t</a>)ai - bw; w &lt;= j - (<a class="code" href="RtypesCore_8h.html#a3885b911a54b47a4e61671f45dd45d0b">Int_t</a>)ai + bw; w++){</div><div class="line"><a name="l00653"></a><span class="lineno">  653</span>&#160;                  <span class="keywordflow">if</span> (w &gt;= 0 &amp;&amp; w &lt; ssize){</div><div class="line"><a name="l00654"></a><span class="lineno">  654</span>&#160;                     c4 += working_space[ssize + w];</div><div class="line"><a name="l00655"></a><span class="lineno">  655</span>&#160;                     men +=1;</div><div class="line"><a name="l00656"></a><span class="lineno">  656</span>&#160;                  }</div><div class="line"><a name="l00657"></a><span class="lineno">  657</span>&#160;               }</div><div class="line"><a name="l00658"></a><span class="lineno">  658</span>&#160;               c4 = c4 / men;</div><div class="line"><a name="l00659"></a><span class="lineno">  659</span>&#160;               d4 = 0, men = 0;</div><div class="line"><a name="l00660"></a><span class="lineno">  660</span>&#160;               <span class="keywordflow">for</span> (w = j + (<a class="code" href="RtypesCore_8h.html#a3885b911a54b47a4e61671f45dd45d0b">Int_t</a>)ai - bw; w &lt;= j + (<a class="code" href="RtypesCore_8h.html#a3885b911a54b47a4e61671f45dd45d0b">Int_t</a>)ai + bw; w++){</div><div class="line"><a name="l00661"></a><span class="lineno">  661</span>&#160;                  <span class="keywordflow">if</span> (w &gt;= 0 &amp;&amp; w &lt; ssize){</div><div class="line"><a name="l00662"></a><span class="lineno">  662</span>&#160;                     d4 += working_space[ssize + w];</div><div class="line"><a name="l00663"></a><span class="lineno">  663</span>&#160;                     men +=1;</div><div class="line"><a name="l00664"></a><span class="lineno">  664</span>&#160;                  }</div><div class="line"><a name="l00665"></a><span class="lineno">  665</span>&#160;               }</div><div class="line"><a name="l00666"></a><span class="lineno">  666</span>&#160;               d4 = d4 / men;</div><div class="line"><a name="l00667"></a><span class="lineno">  667</span>&#160;               e4 = 0, men = 0;</div><div class="line"><a name="l00668"></a><span class="lineno">  668</span>&#160;               <span class="keywordflow">for</span> (w = j + (<a class="code" href="RtypesCore_8h.html#a3885b911a54b47a4e61671f45dd45d0b">Int_t</a>)(2 * ai) - bw; w &lt;= j + (<a class="code" href="RtypesCore_8h.html#a3885b911a54b47a4e61671f45dd45d0b">Int_t</a>)(2 * ai) + bw; w++){</div><div class="line"><a name="l00669"></a><span class="lineno">  669</span>&#160;                  <span class="keywordflow">if</span> (w &gt;= 0 &amp;&amp; w &lt; ssize){</div><div class="line"><a name="l00670"></a><span class="lineno">  670</span>&#160;                     e4 += working_space[ssize + w];</div><div class="line"><a name="l00671"></a><span class="lineno">  671</span>&#160;                     men +=1;</div><div class="line"><a name="l00672"></a><span class="lineno">  672</span>&#160;                  }</div><div class="line"><a name="l00673"></a><span class="lineno">  673</span>&#160;               }</div><div class="line"><a name="l00674"></a><span class="lineno">  674</span>&#160;               e4 = e4 / men;</div><div class="line"><a name="l00675"></a><span class="lineno">  675</span>&#160;               b4 = (-b4 + 4 * c4 + 4 * d4 - e4) / 6;</div><div class="line"><a name="l00676"></a><span class="lineno">  676</span>&#160;               <span class="keywordflow">if</span> (<a class="code" href="TRolke_8cxx.html#a1a2354f40e332ad13673b70afc2c0dbf">b</a> &lt; b4)</div><div class="line"><a name="l00677"></a><span class="lineno">  677</span>&#160;                  <a class="code" href="TRolke_8cxx.html#a1a2354f40e332ad13673b70afc2c0dbf">b</a> = b4;</div><div class="line"><a name="l00678"></a><span class="lineno">  678</span>&#160;               <span class="keywordflow">if</span> (<a class="code" href="TRolke_8cxx.html#a1a2354f40e332ad13673b70afc2c0dbf">b</a> &lt; <a class="code" href="textangle_8C.html#a655a1c2a1ec25e8fcfb713772281e8f5">a</a>)</div><div class="line"><a name="l00679"></a><span class="lineno">  679</span>&#160;                  av = <a class="code" href="TRolke_8cxx.html#a1a2354f40e332ad13673b70afc2c0dbf">b</a>;</div><div class="line"><a name="l00680"></a><span class="lineno">  680</span>&#160;               working_space[j]=av;</div><div class="line"><a name="l00681"></a><span class="lineno">  681</span>&#160;            }</div><div class="line"><a name="l00682"></a><span class="lineno">  682</span>&#160;         }</div><div class="line"><a name="l00683"></a><span class="lineno">  683</span>&#160;         <span class="keywordflow">for</span> (j = i; j &lt; ssize - i; j++)</div><div class="line"><a name="l00684"></a><span class="lineno">  684</span>&#160;            working_space[ssize + j] = working_space[j];</div><div class="line"><a name="l00685"></a><span class="lineno">  685</span>&#160;         <span class="keywordflow">if</span> (direction == <a class="code" href="classTSpectrum.html#a22565bc179ec06fc52d9377905f71871a4133774c283c838d5473fa75127ae22f">kBackIncreasingWindow</a>)</div><div class="line"><a name="l00686"></a><span class="lineno">  686</span>&#160;            i+=1;</div><div class="line"><a name="l00687"></a><span class="lineno">  687</span>&#160;         <span class="keywordflow">else</span> <span class="keywordflow">if</span>(direction == <a class="code" href="classTSpectrum.html#a22565bc179ec06fc52d9377905f71871a7f8038087d885e41b186a81ff9c85a2c">kBackDecreasingWindow</a>)</div><div class="line"><a name="l00688"></a><span class="lineno">  688</span>&#160;            i-=1;</div><div class="line"><a name="l00689"></a><span class="lineno">  689</span>&#160;      }<span class="keywordflow">while</span>((direction == <a class="code" href="classTSpectrum.html#a22565bc179ec06fc52d9377905f71871a4133774c283c838d5473fa75127ae22f">kBackIncreasingWindow</a> &amp;&amp; i &lt;= numberIterations) || (direction == <a class="code" href="classTSpectrum.html#a22565bc179ec06fc52d9377905f71871a7f8038087d885e41b186a81ff9c85a2c">kBackDecreasingWindow</a> &amp;&amp; i &gt;= 1));</div><div class="line"><a name="l00690"></a><span class="lineno">  690</span>&#160;   }</div><div class="line"><a name="l00691"></a><span class="lineno">  691</span>&#160;</div><div class="line"><a name="l00692"></a><span class="lineno">  692</span>&#160;   <span class="keywordflow">else</span> <span class="keywordflow">if</span> (filterOrder == <a class="code" href="classTSpectrum.html#a22565bc179ec06fc52d9377905f71871a283a827c1815ac5d970895880ebe4948">kBackOrder6</a>) {</div><div class="line"><a name="l00693"></a><span class="lineno">  693</span>&#160;      <span class="keywordflow">do</span>{</div><div class="line"><a name="l00694"></a><span class="lineno">  694</span>&#160;         <span class="keywordflow">for</span> (j = i; j &lt; ssize - i; j++) {</div><div class="line"><a name="l00695"></a><span class="lineno">  695</span>&#160;            <span class="keywordflow">if</span> (smoothing == <a class="code" href="RtypesCore_8h.html#a7e568baf910535e8ffd438acb843434d">kFALSE</a>){</div><div class="line"><a name="l00696"></a><span class="lineno">  696</span>&#160;               <a class="code" href="textangle_8C.html#a655a1c2a1ec25e8fcfb713772281e8f5">a</a> = working_space[ssize + j];</div><div class="line"><a name="l00697"></a><span class="lineno">  697</span>&#160;               <a class="code" href="TRolke_8cxx.html#a1a2354f40e332ad13673b70afc2c0dbf">b</a> = (working_space[ssize + j - i] + working_space[ssize + j + i]) / 2.0;</div><div class="line"><a name="l00698"></a><span class="lineno">  698</span>&#160;               <a class="code" href="RSha256_8hxx.html#a63f410abde93141c9013b7d3f3971738">c</a> = 0;</div><div class="line"><a name="l00699"></a><span class="lineno">  699</span>&#160;               ai = i / 2;</div><div class="line"><a name="l00700"></a><span class="lineno">  700</span>&#160;               <a class="code" href="RSha256_8hxx.html#a63f410abde93141c9013b7d3f3971738">c</a> -= working_space[ssize + j - (<a class="code" href="RtypesCore_8h.html#a3885b911a54b47a4e61671f45dd45d0b">Int_t</a>) (2 * ai)] / 6;</div><div class="line"><a name="l00701"></a><span class="lineno">  701</span>&#160;               <a class="code" href="RSha256_8hxx.html#a63f410abde93141c9013b7d3f3971738">c</a> += 4 * working_space[ssize + j - (<a class="code" href="RtypesCore_8h.html#a3885b911a54b47a4e61671f45dd45d0b">Int_t</a>) ai] / 6;</div><div class="line"><a name="l00702"></a><span class="lineno">  702</span>&#160;               <a class="code" href="RSha256_8hxx.html#a63f410abde93141c9013b7d3f3971738">c</a> += 4 * working_space[ssize + j + (<a class="code" href="RtypesCore_8h.html#a3885b911a54b47a4e61671f45dd45d0b">Int_t</a>) ai] / 6;</div><div class="line"><a name="l00703"></a><span class="lineno">  703</span>&#160;               <a class="code" href="RSha256_8hxx.html#a63f410abde93141c9013b7d3f3971738">c</a> -= working_space[ssize + j + (<a class="code" href="RtypesCore_8h.html#a3885b911a54b47a4e61671f45dd45d0b">Int_t</a>) (2 * ai)] / 6;</div><div class="line"><a name="l00704"></a><span class="lineno">  704</span>&#160;               <a class="code" href="RSha256_8hxx.html#a23b5b0a85bf5762c93a855f40c0343ce">d</a> = 0;</div><div class="line"><a name="l00705"></a><span class="lineno">  705</span>&#160;               ai = i / 3;</div><div class="line"><a name="l00706"></a><span class="lineno">  706</span>&#160;               <a class="code" href="RSha256_8hxx.html#a23b5b0a85bf5762c93a855f40c0343ce">d</a> += working_space[ssize + j - (<a class="code" href="RtypesCore_8h.html#a3885b911a54b47a4e61671f45dd45d0b">Int_t</a>) (3 * ai)] / 20;</div><div class="line"><a name="l00707"></a><span class="lineno">  707</span>&#160;               <a class="code" href="RSha256_8hxx.html#a23b5b0a85bf5762c93a855f40c0343ce">d</a> -= 6 * working_space[ssize + j - (<a class="code" href="RtypesCore_8h.html#a3885b911a54b47a4e61671f45dd45d0b">Int_t</a>) (2 * ai)] / 20;</div><div class="line"><a name="l00708"></a><span class="lineno">  708</span>&#160;               <a class="code" href="RSha256_8hxx.html#a23b5b0a85bf5762c93a855f40c0343ce">d</a> += 15 * working_space[ssize + j - (<a class="code" href="RtypesCore_8h.html#a3885b911a54b47a4e61671f45dd45d0b">Int_t</a>) ai] / 20;</div><div class="line"><a name="l00709"></a><span class="lineno">  709</span>&#160;               <a class="code" href="RSha256_8hxx.html#a23b5b0a85bf5762c93a855f40c0343ce">d</a> += 15 * working_space[ssize + j + (<a class="code" href="RtypesCore_8h.html#a3885b911a54b47a4e61671f45dd45d0b">Int_t</a>) ai] / 20;</div><div class="line"><a name="l00710"></a><span class="lineno">  710</span>&#160;               <a class="code" href="RSha256_8hxx.html#a23b5b0a85bf5762c93a855f40c0343ce">d</a> -= 6 * working_space[ssize + j + (<a class="code" href="RtypesCore_8h.html#a3885b911a54b47a4e61671f45dd45d0b">Int_t</a>) (2 * ai)] / 20;</div><div class="line"><a name="l00711"></a><span class="lineno">  711</span>&#160;               <a class="code" href="RSha256_8hxx.html#a23b5b0a85bf5762c93a855f40c0343ce">d</a> += working_space[ssize + j + (<a class="code" href="RtypesCore_8h.html#a3885b911a54b47a4e61671f45dd45d0b">Int_t</a>) (3 * ai)] / 20;</div><div class="line"><a name="l00712"></a><span class="lineno">  712</span>&#160;               <span class="keywordflow">if</span> (<a class="code" href="TRolke_8cxx.html#a1a2354f40e332ad13673b70afc2c0dbf">b</a> &lt; <a class="code" href="RSha256_8hxx.html#a23b5b0a85bf5762c93a855f40c0343ce">d</a>)</div><div class="line"><a name="l00713"></a><span class="lineno">  713</span>&#160;                  <a class="code" href="TRolke_8cxx.html#a1a2354f40e332ad13673b70afc2c0dbf">b</a> = <a class="code" href="RSha256_8hxx.html#a23b5b0a85bf5762c93a855f40c0343ce">d</a>;</div><div class="line"><a name="l00714"></a><span class="lineno">  714</span>&#160;               <span class="keywordflow">if</span> (<a class="code" href="TRolke_8cxx.html#a1a2354f40e332ad13673b70afc2c0dbf">b</a> &lt; <a class="code" href="RSha256_8hxx.html#a63f410abde93141c9013b7d3f3971738">c</a>)</div><div class="line"><a name="l00715"></a><span class="lineno">  715</span>&#160;                  <a class="code" href="TRolke_8cxx.html#a1a2354f40e332ad13673b70afc2c0dbf">b</a> = <a class="code" href="RSha256_8hxx.html#a63f410abde93141c9013b7d3f3971738">c</a>;</div><div class="line"><a name="l00716"></a><span class="lineno">  716</span>&#160;               <span class="keywordflow">if</span> (<a class="code" href="TRolke_8cxx.html#a1a2354f40e332ad13673b70afc2c0dbf">b</a> &lt; <a class="code" href="textangle_8C.html#a655a1c2a1ec25e8fcfb713772281e8f5">a</a>)</div><div class="line"><a name="l00717"></a><span class="lineno">  717</span>&#160;                  <a class="code" href="textangle_8C.html#a655a1c2a1ec25e8fcfb713772281e8f5">a</a> = <a class="code" href="TRolke_8cxx.html#a1a2354f40e332ad13673b70afc2c0dbf">b</a>;</div><div class="line"><a name="l00718"></a><span class="lineno">  718</span>&#160;               working_space[j] = <a class="code" href="textangle_8C.html#a655a1c2a1ec25e8fcfb713772281e8f5">a</a>;</div><div class="line"><a name="l00719"></a><span class="lineno">  719</span>&#160;            }</div><div class="line"><a name="l00720"></a><span class="lineno">  720</span>&#160;</div><div class="line"><a name="l00721"></a><span class="lineno">  721</span>&#160;            <span class="keywordflow">else</span> <span class="keywordflow">if</span> (smoothing == <a class="code" href="RtypesCore_8h.html#af2f51d30ccd86e85be3e3e69793a86ef">kTRUE</a>){</div><div class="line"><a name="l00722"></a><span class="lineno">  722</span>&#160;               <a class="code" href="textangle_8C.html#a655a1c2a1ec25e8fcfb713772281e8f5">a</a> = working_space[ssize + j];</div><div class="line"><a name="l00723"></a><span class="lineno">  723</span>&#160;               av = 0;</div><div class="line"><a name="l00724"></a><span class="lineno">  724</span>&#160;               men = 0;</div><div class="line"><a name="l00725"></a><span class="lineno">  725</span>&#160;               <span class="keywordflow">for</span> (w = j - bw; w &lt;= j + bw; w++){</div><div class="line"><a name="l00726"></a><span class="lineno">  726</span>&#160;                  <span class="keywordflow">if</span> ( w &gt;= 0 &amp;&amp; w &lt; ssize){</div><div class="line"><a name="l00727"></a><span class="lineno">  727</span>&#160;                     av += working_space[ssize + w];</div><div class="line"><a name="l00728"></a><span class="lineno">  728</span>&#160;                     men +=1;</div><div class="line"><a name="l00729"></a><span class="lineno">  729</span>&#160;                  }</div><div class="line"><a name="l00730"></a><span class="lineno">  730</span>&#160;               }</div><div class="line"><a name="l00731"></a><span class="lineno">  731</span>&#160;               av = av / men;</div><div class="line"><a name="l00732"></a><span class="lineno">  732</span>&#160;               <a class="code" href="TRolke_8cxx.html#a1a2354f40e332ad13673b70afc2c0dbf">b</a> = 0;</div><div class="line"><a name="l00733"></a><span class="lineno">  733</span>&#160;               men = 0;</div><div class="line"><a name="l00734"></a><span class="lineno">  734</span>&#160;               <span class="keywordflow">for</span> (w = j - i - bw; w &lt;= j - i + bw; w++){</div><div class="line"><a name="l00735"></a><span class="lineno">  735</span>&#160;                  <span class="keywordflow">if</span> ( w &gt;= 0 &amp;&amp; w &lt; ssize){</div><div class="line"><a name="l00736"></a><span class="lineno">  736</span>&#160;                     <a class="code" href="TRolke_8cxx.html#a1a2354f40e332ad13673b70afc2c0dbf">b</a> += working_space[ssize + w];</div><div class="line"><a name="l00737"></a><span class="lineno">  737</span>&#160;                     men +=1;</div><div class="line"><a name="l00738"></a><span class="lineno">  738</span>&#160;                  }</div><div class="line"><a name="l00739"></a><span class="lineno">  739</span>&#160;               }</div><div class="line"><a name="l00740"></a><span class="lineno">  740</span>&#160;               <a class="code" href="TRolke_8cxx.html#a1a2354f40e332ad13673b70afc2c0dbf">b</a> = <a class="code" href="TRolke_8cxx.html#a1a2354f40e332ad13673b70afc2c0dbf">b</a> / men;</div><div class="line"><a name="l00741"></a><span class="lineno">  741</span>&#160;               <a class="code" href="RSha256_8hxx.html#a63f410abde93141c9013b7d3f3971738">c</a> = 0;</div><div class="line"><a name="l00742"></a><span class="lineno">  742</span>&#160;               men = 0;</div><div class="line"><a name="l00743"></a><span class="lineno">  743</span>&#160;               <span class="keywordflow">for</span> (w = j + i - bw; w &lt;= j + i + bw; w++){</div><div class="line"><a name="l00744"></a><span class="lineno">  744</span>&#160;                  <span class="keywordflow">if</span> ( w &gt;= 0 &amp;&amp; w &lt; ssize){</div><div class="line"><a name="l00745"></a><span class="lineno">  745</span>&#160;                     <a class="code" href="RSha256_8hxx.html#a63f410abde93141c9013b7d3f3971738">c</a> += working_space[ssize + w];</div><div class="line"><a name="l00746"></a><span class="lineno">  746</span>&#160;                     men +=1;</div><div class="line"><a name="l00747"></a><span class="lineno">  747</span>&#160;                  }</div><div class="line"><a name="l00748"></a><span class="lineno">  748</span>&#160;               }</div><div class="line"><a name="l00749"></a><span class="lineno">  749</span>&#160;               <a class="code" href="RSha256_8hxx.html#a63f410abde93141c9013b7d3f3971738">c</a> = <a class="code" href="RSha256_8hxx.html#a63f410abde93141c9013b7d3f3971738">c</a> / men;</div><div class="line"><a name="l00750"></a><span class="lineno">  750</span>&#160;               <a class="code" href="TRolke_8cxx.html#a1a2354f40e332ad13673b70afc2c0dbf">b</a> = (<a class="code" href="TRolke_8cxx.html#a1a2354f40e332ad13673b70afc2c0dbf">b</a> + <a class="code" href="RSha256_8hxx.html#a63f410abde93141c9013b7d3f3971738">c</a>) / 2;</div><div class="line"><a name="l00751"></a><span class="lineno">  751</span>&#160;               ai = i / 2;</div><div class="line"><a name="l00752"></a><span class="lineno">  752</span>&#160;               b4 = 0, men = 0;</div><div class="line"><a name="l00753"></a><span class="lineno">  753</span>&#160;               <span class="keywordflow">for</span> (w = j - (<a class="code" href="RtypesCore_8h.html#a3885b911a54b47a4e61671f45dd45d0b">Int_t</a>)(2 * ai) - bw; w &lt;= j - (<a class="code" href="RtypesCore_8h.html#a3885b911a54b47a4e61671f45dd45d0b">Int_t</a>)(2 * ai) + bw; w++){</div><div class="line"><a name="l00754"></a><span class="lineno">  754</span>&#160;                  <span class="keywordflow">if</span> (w &gt;= 0 &amp;&amp; w &lt; ssize){</div><div class="line"><a name="l00755"></a><span class="lineno">  755</span>&#160;                     b4 += working_space[ssize + w];</div><div class="line"><a name="l00756"></a><span class="lineno">  756</span>&#160;                     men +=1;</div><div class="line"><a name="l00757"></a><span class="lineno">  757</span>&#160;                  }</div><div class="line"><a name="l00758"></a><span class="lineno">  758</span>&#160;               }</div><div class="line"><a name="l00759"></a><span class="lineno">  759</span>&#160;               b4 = b4 / men;</div><div class="line"><a name="l00760"></a><span class="lineno">  760</span>&#160;               c4 = 0, men = 0;</div><div class="line"><a name="l00761"></a><span class="lineno">  761</span>&#160;               <span class="keywordflow">for</span> (w = j - (<a class="code" href="RtypesCore_8h.html#a3885b911a54b47a4e61671f45dd45d0b">Int_t</a>)ai - bw; w &lt;= j - (<a class="code" href="RtypesCore_8h.html#a3885b911a54b47a4e61671f45dd45d0b">Int_t</a>)ai + bw; w++){</div><div class="line"><a name="l00762"></a><span class="lineno">  762</span>&#160;                  <span class="keywordflow">if</span> (w &gt;= 0 &amp;&amp; w &lt; ssize){</div><div class="line"><a name="l00763"></a><span class="lineno">  763</span>&#160;                     c4 += working_space[ssize + w];</div><div class="line"><a name="l00764"></a><span class="lineno">  764</span>&#160;                     men +=1;</div><div class="line"><a name="l00765"></a><span class="lineno">  765</span>&#160;                  }</div><div class="line"><a name="l00766"></a><span class="lineno">  766</span>&#160;               }</div><div class="line"><a name="l00767"></a><span class="lineno">  767</span>&#160;               c4 = c4 / men;</div><div class="line"><a name="l00768"></a><span class="lineno">  768</span>&#160;               d4 = 0, men = 0;</div><div class="line"><a name="l00769"></a><span class="lineno">  769</span>&#160;               <span class="keywordflow">for</span> (w = j + (<a class="code" href="RtypesCore_8h.html#a3885b911a54b47a4e61671f45dd45d0b">Int_t</a>)ai - bw; w &lt;= j + (<a class="code" href="RtypesCore_8h.html#a3885b911a54b47a4e61671f45dd45d0b">Int_t</a>)ai + bw; w++){</div><div class="line"><a name="l00770"></a><span class="lineno">  770</span>&#160;                  <span class="keywordflow">if</span> (w &gt;= 0 &amp;&amp; w &lt; ssize){</div><div class="line"><a name="l00771"></a><span class="lineno">  771</span>&#160;                     d4 += working_space[ssize + w];</div><div class="line"><a name="l00772"></a><span class="lineno">  772</span>&#160;                     men +=1;</div><div class="line"><a name="l00773"></a><span class="lineno">  773</span>&#160;                  }</div><div class="line"><a name="l00774"></a><span class="lineno">  774</span>&#160;               }</div><div class="line"><a name="l00775"></a><span class="lineno">  775</span>&#160;               d4 = d4 / men;</div><div class="line"><a name="l00776"></a><span class="lineno">  776</span>&#160;               e4 = 0, men = 0;</div><div class="line"><a name="l00777"></a><span class="lineno">  777</span>&#160;               <span class="keywordflow">for</span> (w = j + (<a class="code" href="RtypesCore_8h.html#a3885b911a54b47a4e61671f45dd45d0b">Int_t</a>)(2 * ai) - bw; w &lt;= j + (<a class="code" href="RtypesCore_8h.html#a3885b911a54b47a4e61671f45dd45d0b">Int_t</a>)(2 * ai) + bw; w++){</div><div class="line"><a name="l00778"></a><span class="lineno">  778</span>&#160;                  <span class="keywordflow">if</span> (w &gt;= 0 &amp;&amp; w &lt; ssize){</div><div class="line"><a name="l00779"></a><span class="lineno">  779</span>&#160;                     e4 += working_space[ssize + w];</div><div class="line"><a name="l00780"></a><span class="lineno">  780</span>&#160;                     men +=1;</div><div class="line"><a name="l00781"></a><span class="lineno">  781</span>&#160;                  }</div><div class="line"><a name="l00782"></a><span class="lineno">  782</span>&#160;               }</div><div class="line"><a name="l00783"></a><span class="lineno">  783</span>&#160;               e4 = e4 / men;</div><div class="line"><a name="l00784"></a><span class="lineno">  784</span>&#160;               b4 = (-b4 + 4 * c4 + 4 * d4 - e4) / 6;</div><div class="line"><a name="l00785"></a><span class="lineno">  785</span>&#160;               ai = i / 3;</div><div class="line"><a name="l00786"></a><span class="lineno">  786</span>&#160;               b6 = 0, men = 0;</div><div class="line"><a name="l00787"></a><span class="lineno">  787</span>&#160;               <span class="keywordflow">for</span> (w = j - (<a class="code" href="RtypesCore_8h.html#a3885b911a54b47a4e61671f45dd45d0b">Int_t</a>)(3 * ai) - bw; w &lt;= j - (<a class="code" href="RtypesCore_8h.html#a3885b911a54b47a4e61671f45dd45d0b">Int_t</a>)(3 * ai) + bw; w++){</div><div class="line"><a name="l00788"></a><span class="lineno">  788</span>&#160;                  <span class="keywordflow">if</span> (w &gt;= 0 &amp;&amp; w &lt; ssize){</div><div class="line"><a name="l00789"></a><span class="lineno">  789</span>&#160;                     b6 += working_space[ssize + w];</div><div class="line"><a name="l00790"></a><span class="lineno">  790</span>&#160;                     men +=1;</div><div class="line"><a name="l00791"></a><span class="lineno">  791</span>&#160;                  }</div><div class="line"><a name="l00792"></a><span class="lineno">  792</span>&#160;               }</div><div class="line"><a name="l00793"></a><span class="lineno">  793</span>&#160;               b6 = b6 / men;</div><div class="line"><a name="l00794"></a><span class="lineno">  794</span>&#160;               c6 = 0, men = 0;</div><div class="line"><a name="l00795"></a><span class="lineno">  795</span>&#160;               <span class="keywordflow">for</span> (w = j - (<a class="code" href="RtypesCore_8h.html#a3885b911a54b47a4e61671f45dd45d0b">Int_t</a>)(2 * ai) - bw; w &lt;= j - (<a class="code" href="RtypesCore_8h.html#a3885b911a54b47a4e61671f45dd45d0b">Int_t</a>)(2 * ai) + bw; w++){</div><div class="line"><a name="l00796"></a><span class="lineno">  796</span>&#160;                  <span class="keywordflow">if</span> (w &gt;= 0 &amp;&amp; w &lt; ssize){</div><div class="line"><a name="l00797"></a><span class="lineno">  797</span>&#160;                     c6 += working_space[ssize + w];</div><div class="line"><a name="l00798"></a><span class="lineno">  798</span>&#160;                     men +=1;</div><div class="line"><a name="l00799"></a><span class="lineno">  799</span>&#160;                  }</div><div class="line"><a name="l00800"></a><span class="lineno">  800</span>&#160;               }</div><div class="line"><a name="l00801"></a><span class="lineno">  801</span>&#160;               c6 = c6 / men;</div><div class="line"><a name="l00802"></a><span class="lineno">  802</span>&#160;               d6 = 0, men = 0;</div><div class="line"><a name="l00803"></a><span class="lineno">  803</span>&#160;               <span class="keywordflow">for</span> (w = j - (<a class="code" href="RtypesCore_8h.html#a3885b911a54b47a4e61671f45dd45d0b">Int_t</a>)ai - bw; w &lt;= j - (<a class="code" href="RtypesCore_8h.html#a3885b911a54b47a4e61671f45dd45d0b">Int_t</a>)ai + bw; w++){</div><div class="line"><a name="l00804"></a><span class="lineno">  804</span>&#160;                  <span class="keywordflow">if</span> (w &gt;= 0 &amp;&amp; w &lt; ssize){</div><div class="line"><a name="l00805"></a><span class="lineno">  805</span>&#160;                     d6 += working_space[ssize + w];</div><div class="line"><a name="l00806"></a><span class="lineno">  806</span>&#160;                     men +=1;</div><div class="line"><a name="l00807"></a><span class="lineno">  807</span>&#160;                  }</div><div class="line"><a name="l00808"></a><span class="lineno">  808</span>&#160;               }</div><div class="line"><a name="l00809"></a><span class="lineno">  809</span>&#160;               d6 = d6 / men;</div><div class="line"><a name="l00810"></a><span class="lineno">  810</span>&#160;               e6 = 0, men = 0;</div><div class="line"><a name="l00811"></a><span class="lineno">  811</span>&#160;               <span class="keywordflow">for</span> (w = j + (<a class="code" href="RtypesCore_8h.html#a3885b911a54b47a4e61671f45dd45d0b">Int_t</a>)ai - bw; w &lt;= j + (<a class="code" href="RtypesCore_8h.html#a3885b911a54b47a4e61671f45dd45d0b">Int_t</a>)ai + bw; w++){</div><div class="line"><a name="l00812"></a><span class="lineno">  812</span>&#160;                  <span class="keywordflow">if</span> (w &gt;= 0 &amp;&amp; w &lt; ssize){</div><div class="line"><a name="l00813"></a><span class="lineno">  813</span>&#160;                     e6 += working_space[ssize + w];</div><div class="line"><a name="l00814"></a><span class="lineno">  814</span>&#160;                     men +=1;</div><div class="line"><a name="l00815"></a><span class="lineno">  815</span>&#160;                  }</div><div class="line"><a name="l00816"></a><span class="lineno">  816</span>&#160;               }</div><div class="line"><a name="l00817"></a><span class="lineno">  817</span>&#160;               e6 = e6 / men;</div><div class="line"><a name="l00818"></a><span class="lineno">  818</span>&#160;               f6 = 0, men = 0;</div><div class="line"><a name="l00819"></a><span class="lineno">  819</span>&#160;               <span class="keywordflow">for</span> (w = j + (<a class="code" href="RtypesCore_8h.html#a3885b911a54b47a4e61671f45dd45d0b">Int_t</a>)(2 * ai) - bw; w &lt;= j + (<a class="code" href="RtypesCore_8h.html#a3885b911a54b47a4e61671f45dd45d0b">Int_t</a>)(2 * ai) + bw; w++){</div><div class="line"><a name="l00820"></a><span class="lineno">  820</span>&#160;                  <span class="keywordflow">if</span> (w &gt;= 0 &amp;&amp; w &lt; ssize){</div><div class="line"><a name="l00821"></a><span class="lineno">  821</span>&#160;                     f6 += working_space[ssize + w];</div><div class="line"><a name="l00822"></a><span class="lineno">  822</span>&#160;                     men +=1;</div><div class="line"><a name="l00823"></a><span class="lineno">  823</span>&#160;                  }</div><div class="line"><a name="l00824"></a><span class="lineno">  824</span>&#160;               }</div><div class="line"><a name="l00825"></a><span class="lineno">  825</span>&#160;               f6 = f6 / men;</div><div class="line"><a name="l00826"></a><span class="lineno">  826</span>&#160;               g6 = 0, men = 0;</div><div class="line"><a name="l00827"></a><span class="lineno">  827</span>&#160;               <span class="keywordflow">for</span> (w = j + (<a class="code" href="RtypesCore_8h.html#a3885b911a54b47a4e61671f45dd45d0b">Int_t</a>)(3 * ai) - bw; w &lt;= j + (<a class="code" href="RtypesCore_8h.html#a3885b911a54b47a4e61671f45dd45d0b">Int_t</a>)(3 * ai) + bw; w++){</div><div class="line"><a name="l00828"></a><span class="lineno">  828</span>&#160;                  <span class="keywordflow">if</span> (w &gt;= 0 &amp;&amp; w &lt; ssize){</div><div class="line"><a name="l00829"></a><span class="lineno">  829</span>&#160;                     g6 += working_space[ssize + w];</div><div class="line"><a name="l00830"></a><span class="lineno">  830</span>&#160;                     men +=1;</div><div class="line"><a name="l00831"></a><span class="lineno">  831</span>&#160;                  }</div><div class="line"><a name="l00832"></a><span class="lineno">  832</span>&#160;               }</div><div class="line"><a name="l00833"></a><span class="lineno">  833</span>&#160;               g6 = g6 / men;</div><div class="line"><a name="l00834"></a><span class="lineno">  834</span>&#160;               b6 = (b6 - 6 * c6 + 15 * d6 + 15 * e6 - 6 * f6 + g6) / 20;</div><div class="line"><a name="l00835"></a><span class="lineno">  835</span>&#160;               <span class="keywordflow">if</span> (<a class="code" href="TRolke_8cxx.html#a1a2354f40e332ad13673b70afc2c0dbf">b</a> &lt; b6)</div><div class="line"><a name="l00836"></a><span class="lineno">  836</span>&#160;                  <a class="code" href="TRolke_8cxx.html#a1a2354f40e332ad13673b70afc2c0dbf">b</a> = b6;</div><div class="line"><a name="l00837"></a><span class="lineno">  837</span>&#160;               <span class="keywordflow">if</span> (<a class="code" href="TRolke_8cxx.html#a1a2354f40e332ad13673b70afc2c0dbf">b</a> &lt; b4)</div><div class="line"><a name="l00838"></a><span class="lineno">  838</span>&#160;                  <a class="code" href="TRolke_8cxx.html#a1a2354f40e332ad13673b70afc2c0dbf">b</a> = b4;</div><div class="line"><a name="l00839"></a><span class="lineno">  839</span>&#160;               <span class="keywordflow">if</span> (<a class="code" href="TRolke_8cxx.html#a1a2354f40e332ad13673b70afc2c0dbf">b</a> &lt; <a class="code" href="textangle_8C.html#a655a1c2a1ec25e8fcfb713772281e8f5">a</a>)</div><div class="line"><a name="l00840"></a><span class="lineno">  840</span>&#160;                  av = <a class="code" href="TRolke_8cxx.html#a1a2354f40e332ad13673b70afc2c0dbf">b</a>;</div><div class="line"><a name="l00841"></a><span class="lineno">  841</span>&#160;               working_space[j]=av;</div><div class="line"><a name="l00842"></a><span class="lineno">  842</span>&#160;            }</div><div class="line"><a name="l00843"></a><span class="lineno">  843</span>&#160;         }</div><div class="line"><a name="l00844"></a><span class="lineno">  844</span>&#160;         <span class="keywordflow">for</span> (j = i; j &lt; ssize - i; j++)</div><div class="line"><a name="l00845"></a><span class="lineno">  845</span>&#160;            working_space[ssize + j] = working_space[j];</div><div class="line"><a name="l00846"></a><span class="lineno">  846</span>&#160;         <span class="keywordflow">if</span> (direction == <a class="code" href="classTSpectrum.html#a22565bc179ec06fc52d9377905f71871a4133774c283c838d5473fa75127ae22f">kBackIncreasingWindow</a>)</div><div class="line"><a name="l00847"></a><span class="lineno">  847</span>&#160;            i+=1;</div><div class="line"><a name="l00848"></a><span class="lineno">  848</span>&#160;         <span class="keywordflow">else</span> <span class="keywordflow">if</span>(direction == <a class="code" href="classTSpectrum.html#a22565bc179ec06fc52d9377905f71871a7f8038087d885e41b186a81ff9c85a2c">kBackDecreasingWindow</a>)</div><div class="line"><a name="l00849"></a><span class="lineno">  849</span>&#160;            i-=1;</div><div class="line"><a name="l00850"></a><span class="lineno">  850</span>&#160;      }<span class="keywordflow">while</span>((direction == <a class="code" href="classTSpectrum.html#a22565bc179ec06fc52d9377905f71871a4133774c283c838d5473fa75127ae22f">kBackIncreasingWindow</a> &amp;&amp; i &lt;= numberIterations) || (direction == <a class="code" href="classTSpectrum.html#a22565bc179ec06fc52d9377905f71871a7f8038087d885e41b186a81ff9c85a2c">kBackDecreasingWindow</a> &amp;&amp; i &gt;= 1));</div><div class="line"><a name="l00851"></a><span class="lineno">  851</span>&#160;   }</div><div class="line"><a name="l00852"></a><span class="lineno">  852</span>&#160;</div><div class="line"><a name="l00853"></a><span class="lineno">  853</span>&#160;   <span class="keywordflow">else</span> <span class="keywordflow">if</span> (filterOrder == <a class="code" href="classTSpectrum.html#a22565bc179ec06fc52d9377905f71871a0e005bb3ae769555ceb1a6d88c54e804">kBackOrder8</a>) {</div><div class="line"><a name="l00854"></a><span class="lineno">  854</span>&#160;      <span class="keywordflow">do</span>{</div><div class="line"><a name="l00855"></a><span class="lineno">  855</span>&#160;         <span class="keywordflow">for</span> (j = i; j &lt; ssize - i; j++) {</div><div class="line"><a name="l00856"></a><span class="lineno">  856</span>&#160;            <span class="keywordflow">if</span> (smoothing == <a class="code" href="RtypesCore_8h.html#a7e568baf910535e8ffd438acb843434d">kFALSE</a>){</div><div class="line"><a name="l00857"></a><span class="lineno">  857</span>&#160;               <a class="code" href="textangle_8C.html#a655a1c2a1ec25e8fcfb713772281e8f5">a</a> = working_space[ssize + j];</div><div class="line"><a name="l00858"></a><span class="lineno">  858</span>&#160;               <a class="code" href="TRolke_8cxx.html#a1a2354f40e332ad13673b70afc2c0dbf">b</a> = (working_space[ssize + j - i] + working_space[ssize + j + i]) / 2.0;</div><div class="line"><a name="l00859"></a><span class="lineno">  859</span>&#160;               <a class="code" href="RSha256_8hxx.html#a63f410abde93141c9013b7d3f3971738">c</a> = 0;</div><div class="line"><a name="l00860"></a><span class="lineno">  860</span>&#160;               ai = i / 2;</div><div class="line"><a name="l00861"></a><span class="lineno">  861</span>&#160;               <a class="code" href="RSha256_8hxx.html#a63f410abde93141c9013b7d3f3971738">c</a> -= working_space[ssize + j - (<a class="code" href="RtypesCore_8h.html#a3885b911a54b47a4e61671f45dd45d0b">Int_t</a>) (2 * ai)] / 6;</div><div class="line"><a name="l00862"></a><span class="lineno">  862</span>&#160;               <a class="code" href="RSha256_8hxx.html#a63f410abde93141c9013b7d3f3971738">c</a> += 4 * working_space[ssize + j - (<a class="code" href="RtypesCore_8h.html#a3885b911a54b47a4e61671f45dd45d0b">Int_t</a>) ai] / 6;</div><div class="line"><a name="l00863"></a><span class="lineno">  863</span>&#160;               <a class="code" href="RSha256_8hxx.html#a63f410abde93141c9013b7d3f3971738">c</a> += 4 * working_space[ssize + j + (<a class="code" href="RtypesCore_8h.html#a3885b911a54b47a4e61671f45dd45d0b">Int_t</a>) ai] / 6;</div><div class="line"><a name="l00864"></a><span class="lineno">  864</span>&#160;               <a class="code" href="RSha256_8hxx.html#a63f410abde93141c9013b7d3f3971738">c</a> -= working_space[ssize + j + (<a class="code" href="RtypesCore_8h.html#a3885b911a54b47a4e61671f45dd45d0b">Int_t</a>) (2 * ai)] / 6;</div><div class="line"><a name="l00865"></a><span class="lineno">  865</span>&#160;               <a class="code" href="RSha256_8hxx.html#a23b5b0a85bf5762c93a855f40c0343ce">d</a> = 0;</div><div class="line"><a name="l00866"></a><span class="lineno">  866</span>&#160;               ai = i / 3;</div><div class="line"><a name="l00867"></a><span class="lineno">  867</span>&#160;               <a class="code" href="RSha256_8hxx.html#a23b5b0a85bf5762c93a855f40c0343ce">d</a> += working_space[ssize + j - (<a class="code" href="RtypesCore_8h.html#a3885b911a54b47a4e61671f45dd45d0b">Int_t</a>) (3 * ai)] / 20;</div><div class="line"><a name="l00868"></a><span class="lineno">  868</span>&#160;               <a class="code" href="RSha256_8hxx.html#a23b5b0a85bf5762c93a855f40c0343ce">d</a> -= 6 * working_space[ssize + j - (<a class="code" href="RtypesCore_8h.html#a3885b911a54b47a4e61671f45dd45d0b">Int_t</a>) (2 * ai)] / 20;</div><div class="line"><a name="l00869"></a><span class="lineno">  869</span>&#160;               <a class="code" href="RSha256_8hxx.html#a23b5b0a85bf5762c93a855f40c0343ce">d</a> += 15 * working_space[ssize + j - (<a class="code" href="RtypesCore_8h.html#a3885b911a54b47a4e61671f45dd45d0b">Int_t</a>) ai] / 20;</div><div class="line"><a name="l00870"></a><span class="lineno">  870</span>&#160;               <a class="code" href="RSha256_8hxx.html#a23b5b0a85bf5762c93a855f40c0343ce">d</a> += 15 * working_space[ssize + j + (<a class="code" href="RtypesCore_8h.html#a3885b911a54b47a4e61671f45dd45d0b">Int_t</a>) ai] / 20;</div><div class="line"><a name="l00871"></a><span class="lineno">  871</span>&#160;               <a class="code" href="RSha256_8hxx.html#a23b5b0a85bf5762c93a855f40c0343ce">d</a> -= 6 * working_space[ssize + j + (<a class="code" href="RtypesCore_8h.html#a3885b911a54b47a4e61671f45dd45d0b">Int_t</a>) (2 * ai)] / 20;</div><div class="line"><a name="l00872"></a><span class="lineno">  872</span>&#160;               <a class="code" href="RSha256_8hxx.html#a23b5b0a85bf5762c93a855f40c0343ce">d</a> += working_space[ssize + j + (<a class="code" href="RtypesCore_8h.html#a3885b911a54b47a4e61671f45dd45d0b">Int_t</a>) (3 * ai)] / 20;</div><div class="line"><a name="l00873"></a><span class="lineno">  873</span>&#160;               <a class="code" href="TRolke_8cxx.html#a680432d265de4ea2534f8ec32f1aa417">e</a> = 0;</div><div class="line"><a name="l00874"></a><span class="lineno">  874</span>&#160;               ai = i / 4;</div><div class="line"><a name="l00875"></a><span class="lineno">  875</span>&#160;               <a class="code" href="TRolke_8cxx.html#a680432d265de4ea2534f8ec32f1aa417">e</a> -= working_space[ssize + j - (<a class="code" href="RtypesCore_8h.html#a3885b911a54b47a4e61671f45dd45d0b">Int_t</a>) (4 * ai)] / 70;</div><div class="line"><a name="l00876"></a><span class="lineno">  876</span>&#160;               <a class="code" href="TRolke_8cxx.html#a680432d265de4ea2534f8ec32f1aa417">e</a> += 8 * working_space[ssize + j - (<a class="code" href="RtypesCore_8h.html#a3885b911a54b47a4e61671f45dd45d0b">Int_t</a>) (3 * ai)] / 70;</div><div class="line"><a name="l00877"></a><span class="lineno">  877</span>&#160;               <a class="code" href="TRolke_8cxx.html#a680432d265de4ea2534f8ec32f1aa417">e</a> -= 28 * working_space[ssize + j - (<a class="code" href="RtypesCore_8h.html#a3885b911a54b47a4e61671f45dd45d0b">Int_t</a>) (2 * ai)] / 70;</div><div class="line"><a name="l00878"></a><span class="lineno">  878</span>&#160;               <a class="code" href="TRolke_8cxx.html#a680432d265de4ea2534f8ec32f1aa417">e</a> += 56 * working_space[ssize + j - (<a class="code" href="RtypesCore_8h.html#a3885b911a54b47a4e61671f45dd45d0b">Int_t</a>) ai] / 70;</div><div class="line"><a name="l00879"></a><span class="lineno">  879</span>&#160;               <a class="code" href="TRolke_8cxx.html#a680432d265de4ea2534f8ec32f1aa417">e</a> += 56 * working_space[ssize + j + (<a class="code" href="RtypesCore_8h.html#a3885b911a54b47a4e61671f45dd45d0b">Int_t</a>) ai] / 70;</div><div class="line"><a name="l00880"></a><span class="lineno">  880</span>&#160;               <a class="code" href="TRolke_8cxx.html#a680432d265de4ea2534f8ec32f1aa417">e</a> -= 28 * working_space[ssize + j + (<a class="code" href="RtypesCore_8h.html#a3885b911a54b47a4e61671f45dd45d0b">Int_t</a>) (2 * ai)] / 70;</div><div class="line"><a name="l00881"></a><span class="lineno">  881</span>&#160;               <a class="code" href="TRolke_8cxx.html#a680432d265de4ea2534f8ec32f1aa417">e</a> += 8 * working_space[ssize + j + (<a class="code" href="RtypesCore_8h.html#a3885b911a54b47a4e61671f45dd45d0b">Int_t</a>) (3 * ai)] / 70;</div><div class="line"><a name="l00882"></a><span class="lineno">  882</span>&#160;               <a class="code" href="TRolke_8cxx.html#a680432d265de4ea2534f8ec32f1aa417">e</a> -= working_space[ssize + j + (<a class="code" href="RtypesCore_8h.html#a3885b911a54b47a4e61671f45dd45d0b">Int_t</a>) (4 * ai)] / 70;</div><div class="line"><a name="l00883"></a><span class="lineno">  883</span>&#160;               <span class="keywordflow">if</span> (<a class="code" href="TRolke_8cxx.html#a1a2354f40e332ad13673b70afc2c0dbf">b</a> &lt; <a class="code" href="TRolke_8cxx.html#a680432d265de4ea2534f8ec32f1aa417">e</a>)</div><div class="line"><a name="l00884"></a><span class="lineno">  884</span>&#160;                  <a class="code" href="TRolke_8cxx.html#a1a2354f40e332ad13673b70afc2c0dbf">b</a> = <a class="code" href="TRolke_8cxx.html#a680432d265de4ea2534f8ec32f1aa417">e</a>;</div><div class="line"><a name="l00885"></a><span class="lineno">  885</span>&#160;               <span class="keywordflow">if</span> (<a class="code" href="TRolke_8cxx.html#a1a2354f40e332ad13673b70afc2c0dbf">b</a> &lt; <a class="code" href="RSha256_8hxx.html#a23b5b0a85bf5762c93a855f40c0343ce">d</a>)</div><div class="line"><a name="l00886"></a><span class="lineno">  886</span>&#160;                  <a class="code" href="TRolke_8cxx.html#a1a2354f40e332ad13673b70afc2c0dbf">b</a> = <a class="code" href="RSha256_8hxx.html#a23b5b0a85bf5762c93a855f40c0343ce">d</a>;</div><div class="line"><a name="l00887"></a><span class="lineno">  887</span>&#160;               <span class="keywordflow">if</span> (<a class="code" href="TRolke_8cxx.html#a1a2354f40e332ad13673b70afc2c0dbf">b</a> &lt; <a class="code" href="RSha256_8hxx.html#a63f410abde93141c9013b7d3f3971738">c</a>)</div><div class="line"><a name="l00888"></a><span class="lineno">  888</span>&#160;                  <a class="code" href="TRolke_8cxx.html#a1a2354f40e332ad13673b70afc2c0dbf">b</a> = <a class="code" href="RSha256_8hxx.html#a63f410abde93141c9013b7d3f3971738">c</a>;</div><div class="line"><a name="l00889"></a><span class="lineno">  889</span>&#160;               <span class="keywordflow">if</span> (<a class="code" href="TRolke_8cxx.html#a1a2354f40e332ad13673b70afc2c0dbf">b</a> &lt; <a class="code" href="textangle_8C.html#a655a1c2a1ec25e8fcfb713772281e8f5">a</a>)</div><div class="line"><a name="l00890"></a><span class="lineno">  890</span>&#160;                  <a class="code" href="textangle_8C.html#a655a1c2a1ec25e8fcfb713772281e8f5">a</a> = <a class="code" href="TRolke_8cxx.html#a1a2354f40e332ad13673b70afc2c0dbf">b</a>;</div><div class="line"><a name="l00891"></a><span class="lineno">  891</span>&#160;               working_space[j] = <a class="code" href="textangle_8C.html#a655a1c2a1ec25e8fcfb713772281e8f5">a</a>;</div><div class="line"><a name="l00892"></a><span class="lineno">  892</span>&#160;            }</div><div class="line"><a name="l00893"></a><span class="lineno">  893</span>&#160;</div><div class="line"><a name="l00894"></a><span class="lineno">  894</span>&#160;            <span class="keywordflow">else</span> <span class="keywordflow">if</span> (smoothing == <a class="code" href="RtypesCore_8h.html#af2f51d30ccd86e85be3e3e69793a86ef">kTRUE</a>){</div><div class="line"><a name="l00895"></a><span class="lineno">  895</span>&#160;               <a class="code" href="textangle_8C.html#a655a1c2a1ec25e8fcfb713772281e8f5">a</a> = working_space[ssize + j];</div><div class="line"><a name="l00896"></a><span class="lineno">  896</span>&#160;               av = 0;</div><div class="line"><a name="l00897"></a><span class="lineno">  897</span>&#160;               men = 0;</div><div class="line"><a name="l00898"></a><span class="lineno">  898</span>&#160;               <span class="keywordflow">for</span> (w = j - bw; w &lt;= j + bw; w++){</div><div class="line"><a name="l00899"></a><span class="lineno">  899</span>&#160;                  <span class="keywordflow">if</span> ( w &gt;= 0 &amp;&amp; w &lt; ssize){</div><div class="line"><a name="l00900"></a><span class="lineno">  900</span>&#160;                     av += working_space[ssize + w];</div><div class="line"><a name="l00901"></a><span class="lineno">  901</span>&#160;                     men +=1;</div><div class="line"><a name="l00902"></a><span class="lineno">  902</span>&#160;                  }</div><div class="line"><a name="l00903"></a><span class="lineno">  903</span>&#160;               }</div><div class="line"><a name="l00904"></a><span class="lineno">  904</span>&#160;               av = av / men;</div><div class="line"><a name="l00905"></a><span class="lineno">  905</span>&#160;               <a class="code" href="TRolke_8cxx.html#a1a2354f40e332ad13673b70afc2c0dbf">b</a> = 0;</div><div class="line"><a name="l00906"></a><span class="lineno">  906</span>&#160;               men = 0;</div><div class="line"><a name="l00907"></a><span class="lineno">  907</span>&#160;               <span class="keywordflow">for</span> (w = j - i - bw; w &lt;= j - i + bw; w++){</div><div class="line"><a name="l00908"></a><span class="lineno">  908</span>&#160;                  <span class="keywordflow">if</span> ( w &gt;= 0 &amp;&amp; w &lt; ssize){</div><div class="line"><a name="l00909"></a><span class="lineno">  909</span>&#160;                     <a class="code" href="TRolke_8cxx.html#a1a2354f40e332ad13673b70afc2c0dbf">b</a> += working_space[ssize + w];</div><div class="line"><a name="l00910"></a><span class="lineno">  910</span>&#160;                     men +=1;</div><div class="line"><a name="l00911"></a><span class="lineno">  911</span>&#160;                  }</div><div class="line"><a name="l00912"></a><span class="lineno">  912</span>&#160;               }</div><div class="line"><a name="l00913"></a><span class="lineno">  913</span>&#160;               <a class="code" href="TRolke_8cxx.html#a1a2354f40e332ad13673b70afc2c0dbf">b</a> = <a class="code" href="TRolke_8cxx.html#a1a2354f40e332ad13673b70afc2c0dbf">b</a> / men;</div><div class="line"><a name="l00914"></a><span class="lineno">  914</span>&#160;               <a class="code" href="RSha256_8hxx.html#a63f410abde93141c9013b7d3f3971738">c</a> = 0;</div><div class="line"><a name="l00915"></a><span class="lineno">  915</span>&#160;               men = 0;</div><div class="line"><a name="l00916"></a><span class="lineno">  916</span>&#160;               <span class="keywordflow">for</span> (w = j + i - bw; w &lt;= j + i + bw; w++){</div><div class="line"><a name="l00917"></a><span class="lineno">  917</span>&#160;                  <span class="keywordflow">if</span> ( w &gt;= 0 &amp;&amp; w &lt; ssize){</div><div class="line"><a name="l00918"></a><span class="lineno">  918</span>&#160;                     <a class="code" href="RSha256_8hxx.html#a63f410abde93141c9013b7d3f3971738">c</a> += working_space[ssize + w];</div><div class="line"><a name="l00919"></a><span class="lineno">  919</span>&#160;                     men +=1;</div><div class="line"><a name="l00920"></a><span class="lineno">  920</span>&#160;                  }</div><div class="line"><a name="l00921"></a><span class="lineno">  921</span>&#160;               }</div><div class="line"><a name="l00922"></a><span class="lineno">  922</span>&#160;               <a class="code" href="RSha256_8hxx.html#a63f410abde93141c9013b7d3f3971738">c</a> = <a class="code" href="RSha256_8hxx.html#a63f410abde93141c9013b7d3f3971738">c</a> / men;</div><div class="line"><a name="l00923"></a><span class="lineno">  923</span>&#160;               <a class="code" href="TRolke_8cxx.html#a1a2354f40e332ad13673b70afc2c0dbf">b</a> = (<a class="code" href="TRolke_8cxx.html#a1a2354f40e332ad13673b70afc2c0dbf">b</a> + <a class="code" href="RSha256_8hxx.html#a63f410abde93141c9013b7d3f3971738">c</a>) / 2;</div><div class="line"><a name="l00924"></a><span class="lineno">  924</span>&#160;               ai = i / 2;</div><div class="line"><a name="l00925"></a><span class="lineno">  925</span>&#160;               b4 = 0, men = 0;</div><div class="line"><a name="l00926"></a><span class="lineno">  926</span>&#160;               <span class="keywordflow">for</span> (w = j - (<a class="code" href="RtypesCore_8h.html#a3885b911a54b47a4e61671f45dd45d0b">Int_t</a>)(2 * ai) - bw; w &lt;= j - (<a class="code" href="RtypesCore_8h.html#a3885b911a54b47a4e61671f45dd45d0b">Int_t</a>)(2 * ai) + bw; w++){</div><div class="line"><a name="l00927"></a><span class="lineno">  927</span>&#160;                  <span class="keywordflow">if</span> (w &gt;= 0 &amp;&amp; w &lt; ssize){</div><div class="line"><a name="l00928"></a><span class="lineno">  928</span>&#160;                     b4 += working_space[ssize + w];</div><div class="line"><a name="l00929"></a><span class="lineno">  929</span>&#160;                     men +=1;</div><div class="line"><a name="l00930"></a><span class="lineno">  930</span>&#160;                  }</div><div class="line"><a name="l00931"></a><span class="lineno">  931</span>&#160;               }</div><div class="line"><a name="l00932"></a><span class="lineno">  932</span>&#160;               b4 = b4 / men;</div><div class="line"><a name="l00933"></a><span class="lineno">  933</span>&#160;               c4 = 0, men = 0;</div><div class="line"><a name="l00934"></a><span class="lineno">  934</span>&#160;               <span class="keywordflow">for</span> (w = j - (<a class="code" href="RtypesCore_8h.html#a3885b911a54b47a4e61671f45dd45d0b">Int_t</a>)ai - bw; w &lt;= j - (<a class="code" href="RtypesCore_8h.html#a3885b911a54b47a4e61671f45dd45d0b">Int_t</a>)ai + bw; w++){</div><div class="line"><a name="l00935"></a><span class="lineno">  935</span>&#160;                  <span class="keywordflow">if</span> (w &gt;= 0 &amp;&amp; w &lt; ssize){</div><div class="line"><a name="l00936"></a><span class="lineno">  936</span>&#160;                     c4 += working_space[ssize + w];</div><div class="line"><a name="l00937"></a><span class="lineno">  937</span>&#160;                     men +=1;</div><div class="line"><a name="l00938"></a><span class="lineno">  938</span>&#160;                  }</div><div class="line"><a name="l00939"></a><span class="lineno">  939</span>&#160;               }</div><div class="line"><a name="l00940"></a><span class="lineno">  940</span>&#160;               c4 = c4 / men;</div><div class="line"><a name="l00941"></a><span class="lineno">  941</span>&#160;               d4 = 0, men = 0;</div><div class="line"><a name="l00942"></a><span class="lineno">  942</span>&#160;               <span class="keywordflow">for</span> (w = j + (<a class="code" href="RtypesCore_8h.html#a3885b911a54b47a4e61671f45dd45d0b">Int_t</a>)ai - bw; w &lt;= j + (<a class="code" href="RtypesCore_8h.html#a3885b911a54b47a4e61671f45dd45d0b">Int_t</a>)ai + bw; w++){</div><div class="line"><a name="l00943"></a><span class="lineno">  943</span>&#160;                  <span class="keywordflow">if</span> (w &gt;= 0 &amp;&amp; w &lt; ssize){</div><div class="line"><a name="l00944"></a><span class="lineno">  944</span>&#160;                     d4 += working_space[ssize + w];</div><div class="line"><a name="l00945"></a><span class="lineno">  945</span>&#160;                     men +=1;</div><div class="line"><a name="l00946"></a><span class="lineno">  946</span>&#160;                  }</div><div class="line"><a name="l00947"></a><span class="lineno">  947</span>&#160;               }</div><div class="line"><a name="l00948"></a><span class="lineno">  948</span>&#160;               d4 = d4 / men;</div><div class="line"><a name="l00949"></a><span class="lineno">  949</span>&#160;               e4 = 0, men = 0;</div><div class="line"><a name="l00950"></a><span class="lineno">  950</span>&#160;               <span class="keywordflow">for</span> (w = j + (<a class="code" href="RtypesCore_8h.html#a3885b911a54b47a4e61671f45dd45d0b">Int_t</a>)(2 * ai) - bw; w &lt;= j + (<a class="code" href="RtypesCore_8h.html#a3885b911a54b47a4e61671f45dd45d0b">Int_t</a>)(2 * ai) + bw; w++){</div><div class="line"><a name="l00951"></a><span class="lineno">  951</span>&#160;                  <span class="keywordflow">if</span> (w &gt;= 0 &amp;&amp; w &lt; ssize){</div><div class="line"><a name="l00952"></a><span class="lineno">  952</span>&#160;                     e4 += working_space[ssize + w];</div><div class="line"><a name="l00953"></a><span class="lineno">  953</span>&#160;                     men +=1;</div><div class="line"><a name="l00954"></a><span class="lineno">  954</span>&#160;                  }</div><div class="line"><a name="l00955"></a><span class="lineno">  955</span>&#160;               }</div><div class="line"><a name="l00956"></a><span class="lineno">  956</span>&#160;               e4 = e4 / men;</div><div class="line"><a name="l00957"></a><span class="lineno">  957</span>&#160;               b4 = (-b4 + 4 * c4 + 4 * d4 - e4) / 6;</div><div class="line"><a name="l00958"></a><span class="lineno">  958</span>&#160;               ai = i / 3;</div><div class="line"><a name="l00959"></a><span class="lineno">  959</span>&#160;               b6 = 0, men = 0;</div><div class="line"><a name="l00960"></a><span class="lineno">  960</span>&#160;               <span class="keywordflow">for</span> (w = j - (<a class="code" href="RtypesCore_8h.html#a3885b911a54b47a4e61671f45dd45d0b">Int_t</a>)(3 * ai) - bw; w &lt;= j - (<a class="code" href="RtypesCore_8h.html#a3885b911a54b47a4e61671f45dd45d0b">Int_t</a>)(3 * ai) + bw; w++){</div><div class="line"><a name="l00961"></a><span class="lineno">  961</span>&#160;                  <span class="keywordflow">if</span> (w &gt;= 0 &amp;&amp; w &lt; ssize){</div><div class="line"><a name="l00962"></a><span class="lineno">  962</span>&#160;                     b6 += working_space[ssize + w];</div><div class="line"><a name="l00963"></a><span class="lineno">  963</span>&#160;                     men +=1;</div><div class="line"><a name="l00964"></a><span class="lineno">  964</span>&#160;                  }</div><div class="line"><a name="l00965"></a><span class="lineno">  965</span>&#160;               }</div><div class="line"><a name="l00966"></a><span class="lineno">  966</span>&#160;               b6 = b6 / men;</div><div class="line"><a name="l00967"></a><span class="lineno">  967</span>&#160;               c6 = 0, men = 0;</div><div class="line"><a name="l00968"></a><span class="lineno">  968</span>&#160;               <span class="keywordflow">for</span> (w = j - (<a class="code" href="RtypesCore_8h.html#a3885b911a54b47a4e61671f45dd45d0b">Int_t</a>)(2 * ai) - bw; w &lt;= j - (<a class="code" href="RtypesCore_8h.html#a3885b911a54b47a4e61671f45dd45d0b">Int_t</a>)(2 * ai) + bw; w++){</div><div class="line"><a name="l00969"></a><span class="lineno">  969</span>&#160;                  <span class="keywordflow">if</span> (w &gt;= 0 &amp;&amp; w &lt; ssize){</div><div class="line"><a name="l00970"></a><span class="lineno">  970</span>&#160;                     c6 += working_space[ssize + w];</div><div class="line"><a name="l00971"></a><span class="lineno">  971</span>&#160;                     men +=1;</div><div class="line"><a name="l00972"></a><span class="lineno">  972</span>&#160;                  }</div><div class="line"><a name="l00973"></a><span class="lineno">  973</span>&#160;               }</div><div class="line"><a name="l00974"></a><span class="lineno">  974</span>&#160;               c6 = c6 / men;</div><div class="line"><a name="l00975"></a><span class="lineno">  975</span>&#160;               d6 = 0, men = 0;</div><div class="line"><a name="l00976"></a><span class="lineno">  976</span>&#160;               <span class="keywordflow">for</span> (w = j - (<a class="code" href="RtypesCore_8h.html#a3885b911a54b47a4e61671f45dd45d0b">Int_t</a>)ai - bw; w &lt;= j - (<a class="code" href="RtypesCore_8h.html#a3885b911a54b47a4e61671f45dd45d0b">Int_t</a>)ai + bw; w++){</div><div class="line"><a name="l00977"></a><span class="lineno">  977</span>&#160;                  <span class="keywordflow">if</span> (w &gt;= 0 &amp;&amp; w &lt; ssize){</div><div class="line"><a name="l00978"></a><span class="lineno">  978</span>&#160;                     d6 += working_space[ssize + w];</div><div class="line"><a name="l00979"></a><span class="lineno">  979</span>&#160;                     men +=1;</div><div class="line"><a name="l00980"></a><span class="lineno">  980</span>&#160;                  }</div><div class="line"><a name="l00981"></a><span class="lineno">  981</span>&#160;               }</div><div class="line"><a name="l00982"></a><span class="lineno">  982</span>&#160;               d6 = d6 / men;</div><div class="line"><a name="l00983"></a><span class="lineno">  983</span>&#160;               e6 = 0, men = 0;</div><div class="line"><a name="l00984"></a><span class="lineno">  984</span>&#160;               <span class="keywordflow">for</span> (w = j + (<a class="code" href="RtypesCore_8h.html#a3885b911a54b47a4e61671f45dd45d0b">Int_t</a>)ai - bw; w &lt;= j + (<a class="code" href="RtypesCore_8h.html#a3885b911a54b47a4e61671f45dd45d0b">Int_t</a>)ai + bw; w++){</div><div class="line"><a name="l00985"></a><span class="lineno">  985</span>&#160;                  <span class="keywordflow">if</span> (w &gt;= 0 &amp;&amp; w &lt; ssize){</div><div class="line"><a name="l00986"></a><span class="lineno">  986</span>&#160;                     e6 += working_space[ssize + w];</div><div class="line"><a name="l00987"></a><span class="lineno">  987</span>&#160;                     men +=1;</div><div class="line"><a name="l00988"></a><span class="lineno">  988</span>&#160;                  }</div><div class="line"><a name="l00989"></a><span class="lineno">  989</span>&#160;               }</div><div class="line"><a name="l00990"></a><span class="lineno">  990</span>&#160;               e6 = e6 / men;</div><div class="line"><a name="l00991"></a><span class="lineno">  991</span>&#160;               f6 = 0, men = 0;</div><div class="line"><a name="l00992"></a><span class="lineno">  992</span>&#160;               <span class="keywordflow">for</span> (w = j + (<a class="code" href="RtypesCore_8h.html#a3885b911a54b47a4e61671f45dd45d0b">Int_t</a>)(2 * ai) - bw; w &lt;= j + (<a class="code" href="RtypesCore_8h.html#a3885b911a54b47a4e61671f45dd45d0b">Int_t</a>)(2 * ai) + bw; w++){</div><div class="line"><a name="l00993"></a><span class="lineno">  993</span>&#160;                  <span class="keywordflow">if</span> (w &gt;= 0 &amp;&amp; w &lt; ssize){</div><div class="line"><a name="l00994"></a><span class="lineno">  994</span>&#160;                     f6 += working_space[ssize + w];</div><div class="line"><a name="l00995"></a><span class="lineno">  995</span>&#160;                     men +=1;</div><div class="line"><a name="l00996"></a><span class="lineno">  996</span>&#160;                  }</div><div class="line"><a name="l00997"></a><span class="lineno">  997</span>&#160;               }</div><div class="line"><a name="l00998"></a><span class="lineno">  998</span>&#160;               f6 = f6 / men;</div><div class="line"><a name="l00999"></a><span class="lineno">  999</span>&#160;               g6 = 0, men = 0;</div><div class="line"><a name="l01000"></a><span class="lineno"> 1000</span>&#160;               <span class="keywordflow">for</span> (w = j + (<a class="code" href="RtypesCore_8h.html#a3885b911a54b47a4e61671f45dd45d0b">Int_t</a>)(3 * ai) - bw; w &lt;= j + (<a class="code" href="RtypesCore_8h.html#a3885b911a54b47a4e61671f45dd45d0b">Int_t</a>)(3 * ai) + bw; w++){</div><div class="line"><a name="l01001"></a><span class="lineno"> 1001</span>&#160;                  <span class="keywordflow">if</span> (w &gt;= 0 &amp;&amp; w &lt; ssize){</div><div class="line"><a name="l01002"></a><span class="lineno"> 1002</span>&#160;                     g6 += working_space[ssize + w];</div><div class="line"><a name="l01003"></a><span class="lineno"> 1003</span>&#160;                     men +=1;</div><div class="line"><a name="l01004"></a><span class="lineno"> 1004</span>&#160;                  }</div><div class="line"><a name="l01005"></a><span class="lineno"> 1005</span>&#160;               }</div><div class="line"><a name="l01006"></a><span class="lineno"> 1006</span>&#160;               g6 = g6 / men;</div><div class="line"><a name="l01007"></a><span class="lineno"> 1007</span>&#160;               b6 = (b6 - 6 * c6 + 15 * d6 + 15 * e6 - 6 * f6 + g6) / 20;</div><div class="line"><a name="l01008"></a><span class="lineno"> 1008</span>&#160;               ai = i / 4;</div><div class="line"><a name="l01009"></a><span class="lineno"> 1009</span>&#160;               b8 = 0, men = 0;</div><div class="line"><a name="l01010"></a><span class="lineno"> 1010</span>&#160;               <span class="keywordflow">for</span> (w = j - (<a class="code" href="RtypesCore_8h.html#a3885b911a54b47a4e61671f45dd45d0b">Int_t</a>)(4 * ai) - bw; w &lt;= j - (<a class="code" href="RtypesCore_8h.html#a3885b911a54b47a4e61671f45dd45d0b">Int_t</a>)(4 * ai) + bw; w++){</div><div class="line"><a name="l01011"></a><span class="lineno"> 1011</span>&#160;                  <span class="keywordflow">if</span> (w &gt;= 0 &amp;&amp; w &lt; ssize){</div><div class="line"><a name="l01012"></a><span class="lineno"> 1012</span>&#160;                     b8 += working_space[ssize + w];</div><div class="line"><a name="l01013"></a><span class="lineno"> 1013</span>&#160;                     men +=1;</div><div class="line"><a name="l01014"></a><span class="lineno"> 1014</span>&#160;                  }</div><div class="line"><a name="l01015"></a><span class="lineno"> 1015</span>&#160;               }</div><div class="line"><a name="l01016"></a><span class="lineno"> 1016</span>&#160;               b8 = b8 / men;</div><div class="line"><a name="l01017"></a><span class="lineno"> 1017</span>&#160;               c8 = 0, men = 0;</div><div class="line"><a name="l01018"></a><span class="lineno"> 1018</span>&#160;               <span class="keywordflow">for</span> (w = j - (<a class="code" href="RtypesCore_8h.html#a3885b911a54b47a4e61671f45dd45d0b">Int_t</a>)(3 * ai) - bw; w &lt;= j - (<a class="code" href="RtypesCore_8h.html#a3885b911a54b47a4e61671f45dd45d0b">Int_t</a>)(3 * ai) + bw; w++){</div><div class="line"><a name="l01019"></a><span class="lineno"> 1019</span>&#160;                  <span class="keywordflow">if</span> (w &gt;= 0 &amp;&amp; w &lt; ssize){</div><div class="line"><a name="l01020"></a><span class="lineno"> 1020</span>&#160;                     c8 += working_space[ssize + w];</div><div class="line"><a name="l01021"></a><span class="lineno"> 1021</span>&#160;                     men +=1;</div><div class="line"><a name="l01022"></a><span class="lineno"> 1022</span>&#160;                  }</div><div class="line"><a name="l01023"></a><span class="lineno"> 1023</span>&#160;               }</div><div class="line"><a name="l01024"></a><span class="lineno"> 1024</span>&#160;               c8 = c8 / men;</div><div class="line"><a name="l01025"></a><span class="lineno"> 1025</span>&#160;               d8 = 0, men = 0;</div><div class="line"><a name="l01026"></a><span class="lineno"> 1026</span>&#160;               <span class="keywordflow">for</span> (w = j - (<a class="code" href="RtypesCore_8h.html#a3885b911a54b47a4e61671f45dd45d0b">Int_t</a>)(2 * ai) - bw; w &lt;= j - (<a class="code" href="RtypesCore_8h.html#a3885b911a54b47a4e61671f45dd45d0b">Int_t</a>)(2 * ai) + bw; w++){</div><div class="line"><a name="l01027"></a><span class="lineno"> 1027</span>&#160;                  <span class="keywordflow">if</span> (w &gt;= 0 &amp;&amp; w &lt; ssize){</div><div class="line"><a name="l01028"></a><span class="lineno"> 1028</span>&#160;                     d8 += working_space[ssize + w];</div><div class="line"><a name="l01029"></a><span class="lineno"> 1029</span>&#160;                     men +=1;</div><div class="line"><a name="l01030"></a><span class="lineno"> 1030</span>&#160;                  }</div><div class="line"><a name="l01031"></a><span class="lineno"> 1031</span>&#160;               }</div><div class="line"><a name="l01032"></a><span class="lineno"> 1032</span>&#160;               d8 = d8 / men;</div><div class="line"><a name="l01033"></a><span class="lineno"> 1033</span>&#160;               e8 = 0, men = 0;</div><div class="line"><a name="l01034"></a><span class="lineno"> 1034</span>&#160;               <span class="keywordflow">for</span> (w = j - (<a class="code" href="RtypesCore_8h.html#a3885b911a54b47a4e61671f45dd45d0b">Int_t</a>)ai - bw; w &lt;= j - (<a class="code" href="RtypesCore_8h.html#a3885b911a54b47a4e61671f45dd45d0b">Int_t</a>)ai + bw; w++){</div><div class="line"><a name="l01035"></a><span class="lineno"> 1035</span>&#160;                  <span class="keywordflow">if</span> (w &gt;= 0 &amp;&amp; w &lt; ssize){</div><div class="line"><a name="l01036"></a><span class="lineno"> 1036</span>&#160;                     e8 += working_space[ssize + w];</div><div class="line"><a name="l01037"></a><span class="lineno"> 1037</span>&#160;                     men +=1;</div><div class="line"><a name="l01038"></a><span class="lineno"> 1038</span>&#160;                  }</div><div class="line"><a name="l01039"></a><span class="lineno"> 1039</span>&#160;               }</div><div class="line"><a name="l01040"></a><span class="lineno"> 1040</span>&#160;               e8 = e8 / men;</div><div class="line"><a name="l01041"></a><span class="lineno"> 1041</span>&#160;               f8 = 0, men = 0;</div><div class="line"><a name="l01042"></a><span class="lineno"> 1042</span>&#160;               <span class="keywordflow">for</span> (w = j + (<a class="code" href="RtypesCore_8h.html#a3885b911a54b47a4e61671f45dd45d0b">Int_t</a>)ai - bw; w &lt;= j + (<a class="code" href="RtypesCore_8h.html#a3885b911a54b47a4e61671f45dd45d0b">Int_t</a>)ai + bw; w++){</div><div class="line"><a name="l01043"></a><span class="lineno"> 1043</span>&#160;                  <span class="keywordflow">if</span> (w &gt;= 0 &amp;&amp; w &lt; ssize){</div><div class="line"><a name="l01044"></a><span class="lineno"> 1044</span>&#160;                     f8 += working_space[ssize + w];</div><div class="line"><a name="l01045"></a><span class="lineno"> 1045</span>&#160;                     men +=1;</div><div class="line"><a name="l01046"></a><span class="lineno"> 1046</span>&#160;                  }</div><div class="line"><a name="l01047"></a><span class="lineno"> 1047</span>&#160;               }</div><div class="line"><a name="l01048"></a><span class="lineno"> 1048</span>&#160;               f8 = f8 / men;</div><div class="line"><a name="l01049"></a><span class="lineno"> 1049</span>&#160;               g8 = 0, men = 0;</div><div class="line"><a name="l01050"></a><span class="lineno"> 1050</span>&#160;               <span class="keywordflow">for</span> (w = j + (<a class="code" href="RtypesCore_8h.html#a3885b911a54b47a4e61671f45dd45d0b">Int_t</a>)(2 * ai) - bw; w &lt;= j + (<a class="code" href="RtypesCore_8h.html#a3885b911a54b47a4e61671f45dd45d0b">Int_t</a>)(2 * ai) + bw; w++){</div><div class="line"><a name="l01051"></a><span class="lineno"> 1051</span>&#160;                  <span class="keywordflow">if</span> (w &gt;= 0 &amp;&amp; w &lt; ssize){</div><div class="line"><a name="l01052"></a><span class="lineno"> 1052</span>&#160;                     g8 += working_space[ssize + w];</div><div class="line"><a name="l01053"></a><span class="lineno"> 1053</span>&#160;                     men +=1;</div><div class="line"><a name="l01054"></a><span class="lineno"> 1054</span>&#160;                  }</div><div class="line"><a name="l01055"></a><span class="lineno"> 1055</span>&#160;               }</div><div class="line"><a name="l01056"></a><span class="lineno"> 1056</span>&#160;               g8 = g8 / men;</div><div class="line"><a name="l01057"></a><span class="lineno"> 1057</span>&#160;               h8 = 0, men = 0;</div><div class="line"><a name="l01058"></a><span class="lineno"> 1058</span>&#160;               <span class="keywordflow">for</span> (w = j + (<a class="code" href="RtypesCore_8h.html#a3885b911a54b47a4e61671f45dd45d0b">Int_t</a>)(3 * ai) - bw; w &lt;= j + (<a class="code" href="RtypesCore_8h.html#a3885b911a54b47a4e61671f45dd45d0b">Int_t</a>)(3 * ai) + bw; w++){</div><div class="line"><a name="l01059"></a><span class="lineno"> 1059</span>&#160;                  <span class="keywordflow">if</span> (w &gt;= 0 &amp;&amp; w &lt; ssize){</div><div class="line"><a name="l01060"></a><span class="lineno"> 1060</span>&#160;                     h8 += working_space[ssize + w];</div><div class="line"><a name="l01061"></a><span class="lineno"> 1061</span>&#160;                     men +=1;</div><div class="line"><a name="l01062"></a><span class="lineno"> 1062</span>&#160;                  }</div><div class="line"><a name="l01063"></a><span class="lineno"> 1063</span>&#160;               }</div><div class="line"><a name="l01064"></a><span class="lineno"> 1064</span>&#160;               h8 = h8 / men;</div><div class="line"><a name="l01065"></a><span class="lineno"> 1065</span>&#160;               i8 = 0, men = 0;</div><div class="line"><a name="l01066"></a><span class="lineno"> 1066</span>&#160;               <span class="keywordflow">for</span> (w = j + (<a class="code" href="RtypesCore_8h.html#a3885b911a54b47a4e61671f45dd45d0b">Int_t</a>)(4 * ai) - bw; w &lt;= j + (<a class="code" href="RtypesCore_8h.html#a3885b911a54b47a4e61671f45dd45d0b">Int_t</a>)(4 * ai) + bw; w++){</div><div class="line"><a name="l01067"></a><span class="lineno"> 1067</span>&#160;                  <span class="keywordflow">if</span> (w &gt;= 0 &amp;&amp; w &lt; ssize){</div><div class="line"><a name="l01068"></a><span class="lineno"> 1068</span>&#160;                     i8 += working_space[ssize + w];</div><div class="line"><a name="l01069"></a><span class="lineno"> 1069</span>&#160;                     men +=1;</div><div class="line"><a name="l01070"></a><span class="lineno"> 1070</span>&#160;                  }</div><div class="line"><a name="l01071"></a><span class="lineno"> 1071</span>&#160;               }</div><div class="line"><a name="l01072"></a><span class="lineno"> 1072</span>&#160;               i8 = i8 / men;</div><div class="line"><a name="l01073"></a><span class="lineno"> 1073</span>&#160;               b8 = ( -b8 + 8 * c8 - 28 * d8 + 56 * e8 - 56 * f8 - 28 * g8 + 8 * h8 - i8)/70;</div><div class="line"><a name="l01074"></a><span class="lineno"> 1074</span>&#160;               <span class="keywordflow">if</span> (<a class="code" href="TRolke_8cxx.html#a1a2354f40e332ad13673b70afc2c0dbf">b</a> &lt; b8)</div><div class="line"><a name="l01075"></a><span class="lineno"> 1075</span>&#160;                  <a class="code" href="TRolke_8cxx.html#a1a2354f40e332ad13673b70afc2c0dbf">b</a> = b8;</div><div class="line"><a name="l01076"></a><span class="lineno"> 1076</span>&#160;               <span class="keywordflow">if</span> (<a class="code" href="TRolke_8cxx.html#a1a2354f40e332ad13673b70afc2c0dbf">b</a> &lt; b6)</div><div class="line"><a name="l01077"></a><span class="lineno"> 1077</span>&#160;                  <a class="code" href="TRolke_8cxx.html#a1a2354f40e332ad13673b70afc2c0dbf">b</a> = b6;</div><div class="line"><a name="l01078"></a><span class="lineno"> 1078</span>&#160;               <span class="keywordflow">if</span> (<a class="code" href="TRolke_8cxx.html#a1a2354f40e332ad13673b70afc2c0dbf">b</a> &lt; b4)</div><div class="line"><a name="l01079"></a><span class="lineno"> 1079</span>&#160;                  <a class="code" href="TRolke_8cxx.html#a1a2354f40e332ad13673b70afc2c0dbf">b</a> = b4;</div><div class="line"><a name="l01080"></a><span class="lineno"> 1080</span>&#160;               <span class="keywordflow">if</span> (<a class="code" href="TRolke_8cxx.html#a1a2354f40e332ad13673b70afc2c0dbf">b</a> &lt; <a class="code" href="textangle_8C.html#a655a1c2a1ec25e8fcfb713772281e8f5">a</a>)</div><div class="line"><a name="l01081"></a><span class="lineno"> 1081</span>&#160;                  av = <a class="code" href="TRolke_8cxx.html#a1a2354f40e332ad13673b70afc2c0dbf">b</a>;</div><div class="line"><a name="l01082"></a><span class="lineno"> 1082</span>&#160;               working_space[j]=av;</div><div class="line"><a name="l01083"></a><span class="lineno"> 1083</span>&#160;            }</div><div class="line"><a name="l01084"></a><span class="lineno"> 1084</span>&#160;         }</div><div class="line"><a name="l01085"></a><span class="lineno"> 1085</span>&#160;         <span class="keywordflow">for</span> (j = i; j &lt; ssize - i; j++)</div><div class="line"><a name="l01086"></a><span class="lineno"> 1086</span>&#160;            working_space[ssize + j] = working_space[j];</div><div class="line"><a name="l01087"></a><span class="lineno"> 1087</span>&#160;         <span class="keywordflow">if</span> (direction == <a class="code" href="classTSpectrum.html#a22565bc179ec06fc52d9377905f71871a4133774c283c838d5473fa75127ae22f">kBackIncreasingWindow</a>)</div><div class="line"><a name="l01088"></a><span class="lineno"> 1088</span>&#160;            i += 1;</div><div class="line"><a name="l01089"></a><span class="lineno"> 1089</span>&#160;         <span class="keywordflow">else</span> <span class="keywordflow">if</span>(direction == <a class="code" href="classTSpectrum.html#a22565bc179ec06fc52d9377905f71871a7f8038087d885e41b186a81ff9c85a2c">kBackDecreasingWindow</a>)</div><div class="line"><a name="l01090"></a><span class="lineno"> 1090</span>&#160;            i -= 1;</div><div class="line"><a name="l01091"></a><span class="lineno"> 1091</span>&#160;      }<span class="keywordflow">while</span>((direction == <a class="code" href="classTSpectrum.html#a22565bc179ec06fc52d9377905f71871a4133774c283c838d5473fa75127ae22f">kBackIncreasingWindow</a> &amp;&amp; i &lt;= numberIterations) || (direction == <a class="code" href="classTSpectrum.html#a22565bc179ec06fc52d9377905f71871a7f8038087d885e41b186a81ff9c85a2c">kBackDecreasingWindow</a> &amp;&amp; i &gt;= 1));</div><div class="line"><a name="l01092"></a><span class="lineno"> 1092</span>&#160;   }</div><div class="line"><a name="l01093"></a><span class="lineno"> 1093</span>&#160;</div><div class="line"><a name="l01094"></a><span class="lineno"> 1094</span>&#160;   <span class="keywordflow">if</span> (compton == <a class="code" href="RtypesCore_8h.html#af2f51d30ccd86e85be3e3e69793a86ef">kTRUE</a>) {</div><div class="line"><a name="l01095"></a><span class="lineno"> 1095</span>&#160;      <span class="keywordflow">for</span> (i = 0, b2 = 0; i &lt; ssize; i++){</div><div class="line"><a name="l01096"></a><span class="lineno"> 1096</span>&#160;         b1 = b2;</div><div class="line"><a name="l01097"></a><span class="lineno"> 1097</span>&#160;         <a class="code" href="textangle_8C.html#a655a1c2a1ec25e8fcfb713772281e8f5">a</a> = working_space[i], <a class="code" href="TRolke_8cxx.html#a1a2354f40e332ad13673b70afc2c0dbf">b</a> = spectrum[i];</div><div class="line"><a name="l01098"></a><span class="lineno"> 1098</span>&#160;         j = i;</div><div class="line"><a name="l01099"></a><span class="lineno"> 1099</span>&#160;         <span class="keywordflow">if</span> (<a class="code" href="namespaceTMath.html#af682354cea223351f1306bf98a858dfd">TMath::Abs</a>(<a class="code" href="textangle_8C.html#a655a1c2a1ec25e8fcfb713772281e8f5">a</a> - <a class="code" href="TRolke_8cxx.html#a1a2354f40e332ad13673b70afc2c0dbf">b</a>) &gt;= 1) {</div><div class="line"><a name="l01100"></a><span class="lineno"> 1100</span>&#160;            b1 = i - 1;</div><div class="line"><a name="l01101"></a><span class="lineno"> 1101</span>&#160;            <span class="keywordflow">if</span> (b1 &lt; 0)</div><div class="line"><a name="l01102"></a><span class="lineno"> 1102</span>&#160;               b1 = 0;</div><div class="line"><a name="l01103"></a><span class="lineno"> 1103</span>&#160;            yb1 = working_space[b1];</div><div class="line"><a name="l01104"></a><span class="lineno"> 1104</span>&#160;            <span class="keywordflow">for</span> (b2 = b1 + 1, <a class="code" href="RSha256_8hxx.html#a63f410abde93141c9013b7d3f3971738">c</a> = 0, priz = 0; priz == 0 &amp;&amp; b2 &lt; ssize; b2++){</div><div class="line"><a name="l01105"></a><span class="lineno"> 1105</span>&#160;               <a class="code" href="textangle_8C.html#a655a1c2a1ec25e8fcfb713772281e8f5">a</a> = working_space[b2], <a class="code" href="TRolke_8cxx.html#a1a2354f40e332ad13673b70afc2c0dbf">b</a> = spectrum[b2];</div><div class="line"><a name="l01106"></a><span class="lineno"> 1106</span>&#160;               <a class="code" href="RSha256_8hxx.html#a63f410abde93141c9013b7d3f3971738">c</a> = <a class="code" href="RSha256_8hxx.html#a63f410abde93141c9013b7d3f3971738">c</a> + <a class="code" href="TRolke_8cxx.html#a1a2354f40e332ad13673b70afc2c0dbf">b</a> - yb1;</div><div class="line"><a name="l01107"></a><span class="lineno"> 1107</span>&#160;               <span class="keywordflow">if</span> (<a class="code" href="namespaceTMath.html#af682354cea223351f1306bf98a858dfd">TMath::Abs</a>(<a class="code" href="textangle_8C.html#a655a1c2a1ec25e8fcfb713772281e8f5">a</a> - <a class="code" href="TRolke_8cxx.html#a1a2354f40e332ad13673b70afc2c0dbf">b</a>) &lt; 1) {</div><div class="line"><a name="l01108"></a><span class="lineno"> 1108</span>&#160;                  priz = 1;</div><div class="line"><a name="l01109"></a><span class="lineno"> 1109</span>&#160;                  yb2 = <a class="code" href="TRolke_8cxx.html#a1a2354f40e332ad13673b70afc2c0dbf">b</a>;</div><div class="line"><a name="l01110"></a><span class="lineno"> 1110</span>&#160;               }</div><div class="line"><a name="l01111"></a><span class="lineno"> 1111</span>&#160;            }</div><div class="line"><a name="l01112"></a><span class="lineno"> 1112</span>&#160;            <span class="keywordflow">if</span> (b2 == ssize)</div><div class="line"><a name="l01113"></a><span class="lineno"> 1113</span>&#160;               b2 -= 1;</div><div class="line"><a name="l01114"></a><span class="lineno"> 1114</span>&#160;            yb2 = working_space[b2];</div><div class="line"><a name="l01115"></a><span class="lineno"> 1115</span>&#160;            <span class="keywordflow">if</span> (yb1 &lt;= yb2){</div><div class="line"><a name="l01116"></a><span class="lineno"> 1116</span>&#160;               <span class="keywordflow">for</span> (j = b1, <a class="code" href="RSha256_8hxx.html#a63f410abde93141c9013b7d3f3971738">c</a> = 0; j &lt;= b2; j++){</div><div class="line"><a name="l01117"></a><span class="lineno"> 1117</span>&#160;                  <a class="code" href="TRolke_8cxx.html#a1a2354f40e332ad13673b70afc2c0dbf">b</a> = spectrum[j];</div><div class="line"><a name="l01118"></a><span class="lineno"> 1118</span>&#160;                  <a class="code" href="RSha256_8hxx.html#a63f410abde93141c9013b7d3f3971738">c</a> = <a class="code" href="RSha256_8hxx.html#a63f410abde93141c9013b7d3f3971738">c</a> + <a class="code" href="TRolke_8cxx.html#a1a2354f40e332ad13673b70afc2c0dbf">b</a> - yb1;</div><div class="line"><a name="l01119"></a><span class="lineno"> 1119</span>&#160;               }</div><div class="line"><a name="l01120"></a><span class="lineno"> 1120</span>&#160;               <span class="keywordflow">if</span> (<a class="code" href="RSha256_8hxx.html#a63f410abde93141c9013b7d3f3971738">c</a> &gt; 1){</div><div class="line"><a name="l01121"></a><span class="lineno"> 1121</span>&#160;                  <a class="code" href="RSha256_8hxx.html#a63f410abde93141c9013b7d3f3971738">c</a> = (yb2 - yb1) / <a class="code" href="RSha256_8hxx.html#a63f410abde93141c9013b7d3f3971738">c</a>;</div><div class="line"><a name="l01122"></a><span class="lineno"> 1122</span>&#160;                  <span class="keywordflow">for</span> (j = b1, <a class="code" href="RSha256_8hxx.html#a23b5b0a85bf5762c93a855f40c0343ce">d</a> = 0; j &lt;= b2 &amp;&amp; j &lt; ssize; j++){</div><div class="line"><a name="l01123"></a><span class="lineno"> 1123</span>&#160;                     <a class="code" href="TRolke_8cxx.html#a1a2354f40e332ad13673b70afc2c0dbf">b</a> = spectrum[j];</div><div class="line"><a name="l01124"></a><span class="lineno"> 1124</span>&#160;                     <a class="code" href="RSha256_8hxx.html#a23b5b0a85bf5762c93a855f40c0343ce">d</a> = <a class="code" href="RSha256_8hxx.html#a23b5b0a85bf5762c93a855f40c0343ce">d</a> + <a class="code" href="TRolke_8cxx.html#a1a2354f40e332ad13673b70afc2c0dbf">b</a> - yb1;</div><div class="line"><a name="l01125"></a><span class="lineno"> 1125</span>&#160;                     <a class="code" href="textangle_8C.html#a655a1c2a1ec25e8fcfb713772281e8f5">a</a> = <a class="code" href="RSha256_8hxx.html#a63f410abde93141c9013b7d3f3971738">c</a> * <a class="code" href="RSha256_8hxx.html#a23b5b0a85bf5762c93a855f40c0343ce">d</a> + yb1;</div><div class="line"><a name="l01126"></a><span class="lineno"> 1126</span>&#160;                     working_space[ssize + j] = <a class="code" href="textangle_8C.html#a655a1c2a1ec25e8fcfb713772281e8f5">a</a>;</div><div class="line"><a name="l01127"></a><span class="lineno"> 1127</span>&#160;                  }</div><div class="line"><a name="l01128"></a><span class="lineno"> 1128</span>&#160;               }</div><div class="line"><a name="l01129"></a><span class="lineno"> 1129</span>&#160;            }</div><div class="line"><a name="l01130"></a><span class="lineno"> 1130</span>&#160;</div><div class="line"><a name="l01131"></a><span class="lineno"> 1131</span>&#160;            <span class="keywordflow">else</span>{</div><div class="line"><a name="l01132"></a><span class="lineno"> 1132</span>&#160;               <span class="keywordflow">for</span> (j = b2, <a class="code" href="RSha256_8hxx.html#a63f410abde93141c9013b7d3f3971738">c</a> = 0; j &gt;= b1; j--){</div><div class="line"><a name="l01133"></a><span class="lineno"> 1133</span>&#160;                  <a class="code" href="TRolke_8cxx.html#a1a2354f40e332ad13673b70afc2c0dbf">b</a> = spectrum[j];</div><div class="line"><a name="l01134"></a><span class="lineno"> 1134</span>&#160;                  <a class="code" href="RSha256_8hxx.html#a63f410abde93141c9013b7d3f3971738">c</a> = <a class="code" href="RSha256_8hxx.html#a63f410abde93141c9013b7d3f3971738">c</a> + <a class="code" href="TRolke_8cxx.html#a1a2354f40e332ad13673b70afc2c0dbf">b</a> - yb2;</div><div class="line"><a name="l01135"></a><span class="lineno"> 1135</span>&#160;               }</div><div class="line"><a name="l01136"></a><span class="lineno"> 1136</span>&#160;               <span class="keywordflow">if</span> (<a class="code" href="RSha256_8hxx.html#a63f410abde93141c9013b7d3f3971738">c</a> &gt; 1){</div><div class="line"><a name="l01137"></a><span class="lineno"> 1137</span>&#160;                  <a class="code" href="RSha256_8hxx.html#a63f410abde93141c9013b7d3f3971738">c</a> = (yb1 - yb2) / <a class="code" href="RSha256_8hxx.html#a63f410abde93141c9013b7d3f3971738">c</a>;</div><div class="line"><a name="l01138"></a><span class="lineno"> 1138</span>&#160;                  <span class="keywordflow">for</span> (j = b2, <a class="code" href="RSha256_8hxx.html#a23b5b0a85bf5762c93a855f40c0343ce">d</a> = 0;j &gt;= b1 &amp;&amp; j &gt;= 0; j--){</div><div class="line"><a name="l01139"></a><span class="lineno"> 1139</span>&#160;                     <a class="code" href="TRolke_8cxx.html#a1a2354f40e332ad13673b70afc2c0dbf">b</a> = spectrum[j];</div><div class="line"><a name="l01140"></a><span class="lineno"> 1140</span>&#160;                     <a class="code" href="RSha256_8hxx.html#a23b5b0a85bf5762c93a855f40c0343ce">d</a> = <a class="code" href="RSha256_8hxx.html#a23b5b0a85bf5762c93a855f40c0343ce">d</a> + <a class="code" href="TRolke_8cxx.html#a1a2354f40e332ad13673b70afc2c0dbf">b</a> - yb2;</div><div class="line"><a name="l01141"></a><span class="lineno"> 1141</span>&#160;                     <a class="code" href="textangle_8C.html#a655a1c2a1ec25e8fcfb713772281e8f5">a</a> = <a class="code" href="RSha256_8hxx.html#a63f410abde93141c9013b7d3f3971738">c</a> * <a class="code" href="RSha256_8hxx.html#a23b5b0a85bf5762c93a855f40c0343ce">d</a> + yb2;</div><div class="line"><a name="l01142"></a><span class="lineno"> 1142</span>&#160;                     working_space[ssize + j] = <a class="code" href="textangle_8C.html#a655a1c2a1ec25e8fcfb713772281e8f5">a</a>;</div><div class="line"><a name="l01143"></a><span class="lineno"> 1143</span>&#160;                  }</div><div class="line"><a name="l01144"></a><span class="lineno"> 1144</span>&#160;               }</div><div class="line"><a name="l01145"></a><span class="lineno"> 1145</span>&#160;            }</div><div class="line"><a name="l01146"></a><span class="lineno"> 1146</span>&#160;            i=b2;</div><div class="line"><a name="l01147"></a><span class="lineno"> 1147</span>&#160;         }</div><div class="line"><a name="l01148"></a><span class="lineno"> 1148</span>&#160;      }</div><div class="line"><a name="l01149"></a><span class="lineno"> 1149</span>&#160;   }</div><div class="line"><a name="l01150"></a><span class="lineno"> 1150</span>&#160;</div><div class="line"><a name="l01151"></a><span class="lineno"> 1151</span>&#160;   <span class="keywordflow">for</span> (j = 0; j &lt; ssize; j++)</div><div class="line"><a name="l01152"></a><span class="lineno"> 1152</span>&#160;      spectrum[j] = working_space[ssize + j];</div><div class="line"><a name="l01153"></a><span class="lineno"> 1153</span>&#160;   <span class="keyword">delete</span>[]working_space;</div><div class="line"><a name="l01154"></a><span class="lineno"> 1154</span>&#160;   <span class="keywordflow">return</span> 0;</div><div class="line"><a name="l01155"></a><span class="lineno"> 1155</span>&#160;}</div><div class="line"><a name="l01156"></a><span class="lineno"> 1156</span>&#160;<span class="comment"></span></div><div class="line"><a name="l01157"></a><span class="lineno"> 1157</span>&#160;<span class="comment">////////////////////////////////////////////////////////////////////////////////</span></div><div class="line"><a name="l01158"></a><span class="lineno"> 1158</span>&#160;<span class="comment">/// One-dimensional markov spectrum smoothing function</span></div><div class="line"><a name="l01159"></a><span class="lineno"> 1159</span>&#160;<span class="comment">///</span></div><div class="line"><a name="l01160"></a><span class="lineno"> 1160</span>&#160;<span class="comment">/// This function calculates smoothed spectrum from source spectrum based on</span></div><div class="line"><a name="l01161"></a><span class="lineno"> 1161</span>&#160;<span class="comment">/// Markov chain method. The result is placed in the array pointed by source</span></div><div class="line"><a name="l01162"></a><span class="lineno"> 1162</span>&#160;<span class="comment">/// pointer. On successful completion it returns 0. On error it returns pointer</span></div><div class="line"><a name="l01163"></a><span class="lineno"> 1163</span>&#160;<span class="comment">/// to the string describing error.</span></div><div class="line"><a name="l01164"></a><span class="lineno"> 1164</span>&#160;<span class="comment">///</span></div><div class="line"><a name="l01165"></a><span class="lineno"> 1165</span>&#160;<span class="comment">/// #### Parameters:</span></div><div class="line"><a name="l01166"></a><span class="lineno"> 1166</span>&#160;<span class="comment">///</span></div><div class="line"><a name="l01167"></a><span class="lineno"> 1167</span>&#160;<span class="comment">///  -  source: pointer to the array of source spectrum</span></div><div class="line"><a name="l01168"></a><span class="lineno"> 1168</span>&#160;<span class="comment">///  -  ssize: length of source array</span></div><div class="line"><a name="l01169"></a><span class="lineno"> 1169</span>&#160;<span class="comment">///  -  averWindow: width of averaging smoothing window</span></div><div class="line"><a name="l01170"></a><span class="lineno"> 1170</span>&#160;<span class="comment">///</span></div><div class="line"><a name="l01171"></a><span class="lineno"> 1171</span>&#160;<span class="comment">/// The goal of this function is the suppression of the statistical fluctuations.</span></div><div class="line"><a name="l01172"></a><span class="lineno"> 1172</span>&#160;<span class="comment">/// The algorithm is based on discrete Markov chain, which has very simple</span></div><div class="line"><a name="l01173"></a><span class="lineno"> 1173</span>&#160;<span class="comment">/// invariant distribution:</span></div><div class="line"><a name="l01174"></a><span class="lineno"> 1174</span>&#160;<span class="comment">///</span></div><div class="line"><a name="l01175"></a><span class="lineno"> 1175</span>&#160;<span class="comment">/// \f[</span></div><div class="line"><a name="l01176"></a><span class="lineno"> 1176</span>&#160;<span class="comment">/// U_2 = \frac{p_{1,2}}{p_{2,1}}U_1, U_3 = \frac{p_{2,3}}{p_{3,2}}U_2U_1, ... , U_n = \frac{p_{n-1,n}}{p_{n,n-1}}U_{n-1}...U_2U_1</span></div><div class="line"><a name="l01177"></a><span class="lineno"> 1177</span>&#160;<span class="comment">/// \f]</span></div><div class="line"><a name="l01178"></a><span class="lineno"> 1178</span>&#160;<span class="comment">/// \f$ U_1\f$ being defined from the normalization condition</span></div><div class="line"><a name="l01179"></a><span class="lineno"> 1179</span>&#160;<span class="comment">/// \f$ \sum_{i=1}^{n} U_i=1\f$. \f$ n \f$ is the length of the smoothed spectrum and</span></div><div class="line"><a name="l01180"></a><span class="lineno"> 1180</span>&#160;<span class="comment">/// \f[</span></div><div class="line"><a name="l01181"></a><span class="lineno"> 1181</span>&#160;<span class="comment">/// p_{i,i\pm 1} = A_i\sum_{k=1}^{m} exp\left[ \frac{y(i\pm k)-y(i)}{y(i\pm k)+y(i)}\right]</span></div><div class="line"><a name="l01182"></a><span class="lineno"> 1182</span>&#160;<span class="comment">/// \f]</span></div><div class="line"><a name="l01183"></a><span class="lineno"> 1183</span>&#160;<span class="comment">///</span></div><div class="line"><a name="l01184"></a><span class="lineno"> 1184</span>&#160;<span class="comment">/// #### Reference:</span></div><div class="line"><a name="l01185"></a><span class="lineno"> 1185</span>&#160;<span class="comment">///</span></div><div class="line"><a name="l01186"></a><span class="lineno"> 1186</span>&#160;<span class="comment">///  1. Z.K. Silagadze, A new algorithm for automatic photopeak searches.</span></div><div class="line"><a name="l01187"></a><span class="lineno"> 1187</span>&#160;<span class="comment">/// NIM A 376 (1996), 451.</span></div><div class="line"><a name="l01188"></a><span class="lineno"> 1188</span>&#160;<span class="comment">///</span></div><div class="line"><a name="l01189"></a><span class="lineno"> 1189</span>&#160;<span class="comment">/// ### Example 14 - script Smoothing.C</span></div><div class="line"><a name="l01190"></a><span class="lineno"> 1190</span>&#160;<span class="comment">///</span></div><div class="line"><a name="l01191"></a><span class="lineno"> 1191</span>&#160;<span class="comment">/// Begin_Macro(source)</span></div><div class="line"><a name="l01192"></a><span class="lineno"> 1192</span>&#160;<span class="comment">/// ../../../tutorials/spectrum/Smoothing.C</span></div><div class="line"><a name="l01193"></a><span class="lineno"> 1193</span>&#160;<span class="comment">/// End_Macro</span></div><div class="line"><a name="l01194"></a><span class="lineno"> 1194</span>&#160;<span class="comment"></span></div><div class="line"><a name="l01195"></a><span class="lineno"><a class="line" href="classTSpectrum.html#a2767b767d39ee7826e9a50b9c0359beb"> 1195</a></span>&#160;<span class="keyword">const</span> <span class="keywordtype">char</span>* <a class="code" href="classTSpectrum.html#a2767b767d39ee7826e9a50b9c0359beb">TSpectrum::SmoothMarkov</a>(<a class="code" href="RtypesCore_8h.html#ab9b5334647b78ec4256db251e3ae1fc6">Double_t</a> *source, <span class="keywordtype">int</span> ssize, <span class="keywordtype">int</span> averWindow)</div><div class="line"><a name="l01196"></a><span class="lineno"> 1196</span>&#160;{</div><div class="line"><a name="l01197"></a><span class="lineno"> 1197</span>&#160;   <span class="keywordtype">int</span> <a class="code" href="THbookFile_8cxx.html#a058f249a5e6d20724cb0784b40a183e8">xmin</a>, <a class="code" href="THbookFile_8cxx.html#a9c42f51718ed192ed1841a53d2b0e507">xmax</a>, i, <a class="code" href="textangle_8C.html#a3359d7f1aa9fe2f8bc884b02020e8d20">l</a>;</div><div class="line"><a name="l01198"></a><span class="lineno"> 1198</span>&#160;   <a class="code" href="RtypesCore_8h.html#ab9b5334647b78ec4256db251e3ae1fc6">Double_t</a> <a class="code" href="textangle_8C.html#a655a1c2a1ec25e8fcfb713772281e8f5">a</a>, <a class="code" href="TRolke_8cxx.html#a1a2354f40e332ad13673b70afc2c0dbf">b</a>, maxch;</div><div class="line"><a name="l01199"></a><span class="lineno"> 1199</span>&#160;   <a class="code" href="RtypesCore_8h.html#ab9b5334647b78ec4256db251e3ae1fc6">Double_t</a> nom, nip, nim, sp, sm, area = 0;</div><div class="line"><a name="l01200"></a><span class="lineno"> 1200</span>&#160;   <span class="keywordflow">if</span>(averWindow &lt;= 0)</div><div class="line"><a name="l01201"></a><span class="lineno"> 1201</span>&#160;      <span class="keywordflow">return</span> <span class="stringliteral">&quot;Averaging Window must be positive&quot;</span>;</div><div class="line"><a name="l01202"></a><span class="lineno"> 1202</span>&#160;   <a class="code" href="RtypesCore_8h.html#ab9b5334647b78ec4256db251e3ae1fc6">Double_t</a> *working_space = <span class="keyword">new</span> <a class="code" href="RtypesCore_8h.html#ab9b5334647b78ec4256db251e3ae1fc6">Double_t</a>[ssize];</div><div class="line"><a name="l01203"></a><span class="lineno"> 1203</span>&#160;   <a class="code" href="THbookFile_8cxx.html#a058f249a5e6d20724cb0784b40a183e8">xmin</a> = 0,<a class="code" href="THbookFile_8cxx.html#a9c42f51718ed192ed1841a53d2b0e507">xmax</a> = ssize - 1;</div><div class="line"><a name="l01204"></a><span class="lineno"> 1204</span>&#160;   <span class="keywordflow">for</span>(i = 0, maxch = 0; i &lt; ssize; i++){</div><div class="line"><a name="l01205"></a><span class="lineno"> 1205</span>&#160;      working_space[i]=0;</div><div class="line"><a name="l01206"></a><span class="lineno"> 1206</span>&#160;      <span class="keywordflow">if</span>(maxch &lt; source[i])</div><div class="line"><a name="l01207"></a><span class="lineno"> 1207</span>&#160;         maxch = source[i];</div><div class="line"><a name="l01208"></a><span class="lineno"> 1208</span>&#160;</div><div class="line"><a name="l01209"></a><span class="lineno"> 1209</span>&#160;      area += source[i];</div><div class="line"><a name="l01210"></a><span class="lineno"> 1210</span>&#160;   }</div><div class="line"><a name="l01211"></a><span class="lineno"> 1211</span>&#160;   <span class="keywordflow">if</span>(maxch == 0) {</div><div class="line"><a name="l01212"></a><span class="lineno"> 1212</span>&#160;      <span class="keyword">delete</span> [] working_space;</div><div class="line"><a name="l01213"></a><span class="lineno"> 1213</span>&#160;      <span class="keywordflow">return</span> 0 ;</div><div class="line"><a name="l01214"></a><span class="lineno"> 1214</span>&#160;   }</div><div class="line"><a name="l01215"></a><span class="lineno"> 1215</span>&#160;</div><div class="line"><a name="l01216"></a><span class="lineno"> 1216</span>&#160;   nom = 1;</div><div class="line"><a name="l01217"></a><span class="lineno"> 1217</span>&#160;   working_space[<a class="code" href="THbookFile_8cxx.html#a058f249a5e6d20724cb0784b40a183e8">xmin</a>] = 1;</div><div class="line"><a name="l01218"></a><span class="lineno"> 1218</span>&#160;   <span class="keywordflow">for</span>(i = <a class="code" href="THbookFile_8cxx.html#a058f249a5e6d20724cb0784b40a183e8">xmin</a>; i &lt; <a class="code" href="THbookFile_8cxx.html#a9c42f51718ed192ed1841a53d2b0e507">xmax</a>; i++){</div><div class="line"><a name="l01219"></a><span class="lineno"> 1219</span>&#160;      nip = source[i] / maxch;</div><div class="line"><a name="l01220"></a><span class="lineno"> 1220</span>&#160;      nim = source[i + 1] / maxch;</div><div class="line"><a name="l01221"></a><span class="lineno"> 1221</span>&#160;      sp = 0,sm = 0;</div><div class="line"><a name="l01222"></a><span class="lineno"> 1222</span>&#160;      <span class="keywordflow">for</span>(<a class="code" href="textangle_8C.html#a3359d7f1aa9fe2f8bc884b02020e8d20">l</a> = 1; <a class="code" href="textangle_8C.html#a3359d7f1aa9fe2f8bc884b02020e8d20">l</a> &lt;= averWindow; <a class="code" href="textangle_8C.html#a3359d7f1aa9fe2f8bc884b02020e8d20">l</a>++){</div><div class="line"><a name="l01223"></a><span class="lineno"> 1223</span>&#160;         <span class="keywordflow">if</span>((i + <a class="code" href="textangle_8C.html#a3359d7f1aa9fe2f8bc884b02020e8d20">l</a>) &gt; <a class="code" href="THbookFile_8cxx.html#a9c42f51718ed192ed1841a53d2b0e507">xmax</a>)</div><div class="line"><a name="l01224"></a><span class="lineno"> 1224</span>&#160;            <a class="code" href="textangle_8C.html#a655a1c2a1ec25e8fcfb713772281e8f5">a</a> = source[<a class="code" href="THbookFile_8cxx.html#a9c42f51718ed192ed1841a53d2b0e507">xmax</a>] / maxch;</div><div class="line"><a name="l01225"></a><span class="lineno"> 1225</span>&#160;</div><div class="line"><a name="l01226"></a><span class="lineno"> 1226</span>&#160;         <span class="keywordflow">else</span></div><div class="line"><a name="l01227"></a><span class="lineno"> 1227</span>&#160;            <a class="code" href="textangle_8C.html#a655a1c2a1ec25e8fcfb713772281e8f5">a</a> = source[i + <a class="code" href="textangle_8C.html#a3359d7f1aa9fe2f8bc884b02020e8d20">l</a>] / maxch;</div><div class="line"><a name="l01228"></a><span class="lineno"> 1228</span>&#160;         <a class="code" href="TRolke_8cxx.html#a1a2354f40e332ad13673b70afc2c0dbf">b</a> = <a class="code" href="textangle_8C.html#a655a1c2a1ec25e8fcfb713772281e8f5">a</a> - nip;</div><div class="line"><a name="l01229"></a><span class="lineno"> 1229</span>&#160;         <span class="keywordflow">if</span>(<a class="code" href="textangle_8C.html#a655a1c2a1ec25e8fcfb713772281e8f5">a</a> + nip &lt;= 0)</div><div class="line"><a name="l01230"></a><span class="lineno"> 1230</span>&#160;            <a class="code" href="textangle_8C.html#a655a1c2a1ec25e8fcfb713772281e8f5">a</a> = 1;</div><div class="line"><a name="l01231"></a><span class="lineno"> 1231</span>&#160;</div><div class="line"><a name="l01232"></a><span class="lineno"> 1232</span>&#160;         <span class="keywordflow">else</span></div><div class="line"><a name="l01233"></a><span class="lineno"> 1233</span>&#160;            <a class="code" href="textangle_8C.html#a655a1c2a1ec25e8fcfb713772281e8f5">a</a> = <a class="code" href="namespaceTMath.html#a9ea900c956031cb12057acf7c322b0fa">TMath::Sqrt</a>(<a class="code" href="textangle_8C.html#a655a1c2a1ec25e8fcfb713772281e8f5">a</a> + nip);</div><div class="line"><a name="l01234"></a><span class="lineno"> 1234</span>&#160;         <a class="code" href="TRolke_8cxx.html#a1a2354f40e332ad13673b70afc2c0dbf">b</a> = <a class="code" href="TRolke_8cxx.html#a1a2354f40e332ad13673b70afc2c0dbf">b</a> / <a class="code" href="textangle_8C.html#a655a1c2a1ec25e8fcfb713772281e8f5">a</a>;</div><div class="line"><a name="l01235"></a><span class="lineno"> 1235</span>&#160;         <a class="code" href="TRolke_8cxx.html#a1a2354f40e332ad13673b70afc2c0dbf">b</a> = <a class="code" href="namespaceTMath.html#a428950de9bddacfb35915a9603880005">TMath::Exp</a>(<a class="code" href="TRolke_8cxx.html#a1a2354f40e332ad13673b70afc2c0dbf">b</a>);</div><div class="line"><a name="l01236"></a><span class="lineno"> 1236</span>&#160;         sp = sp + <a class="code" href="TRolke_8cxx.html#a1a2354f40e332ad13673b70afc2c0dbf">b</a>;</div><div class="line"><a name="l01237"></a><span class="lineno"> 1237</span>&#160;         <span class="keywordflow">if</span>((i - <a class="code" href="textangle_8C.html#a3359d7f1aa9fe2f8bc884b02020e8d20">l</a> + 1) &lt; <a class="code" href="THbookFile_8cxx.html#a058f249a5e6d20724cb0784b40a183e8">xmin</a>)</div><div class="line"><a name="l01238"></a><span class="lineno"> 1238</span>&#160;            <a class="code" href="textangle_8C.html#a655a1c2a1ec25e8fcfb713772281e8f5">a</a> = source[<a class="code" href="THbookFile_8cxx.html#a058f249a5e6d20724cb0784b40a183e8">xmin</a>] / maxch;</div><div class="line"><a name="l01239"></a><span class="lineno"> 1239</span>&#160;</div><div class="line"><a name="l01240"></a><span class="lineno"> 1240</span>&#160;         <span class="keywordflow">else</span></div><div class="line"><a name="l01241"></a><span class="lineno"> 1241</span>&#160;            <a class="code" href="textangle_8C.html#a655a1c2a1ec25e8fcfb713772281e8f5">a</a> = source[i - <a class="code" href="textangle_8C.html#a3359d7f1aa9fe2f8bc884b02020e8d20">l</a> + 1] / maxch;</div><div class="line"><a name="l01242"></a><span class="lineno"> 1242</span>&#160;         <a class="code" href="TRolke_8cxx.html#a1a2354f40e332ad13673b70afc2c0dbf">b</a> = <a class="code" href="textangle_8C.html#a655a1c2a1ec25e8fcfb713772281e8f5">a</a> - nim;</div><div class="line"><a name="l01243"></a><span class="lineno"> 1243</span>&#160;         <span class="keywordflow">if</span>(<a class="code" href="textangle_8C.html#a655a1c2a1ec25e8fcfb713772281e8f5">a</a> + nim &lt;= 0)</div><div class="line"><a name="l01244"></a><span class="lineno"> 1244</span>&#160;            <a class="code" href="textangle_8C.html#a655a1c2a1ec25e8fcfb713772281e8f5">a</a> = 1;</div><div class="line"><a name="l01245"></a><span class="lineno"> 1245</span>&#160;         <span class="keywordflow">else</span></div><div class="line"><a name="l01246"></a><span class="lineno"> 1246</span>&#160;            <a class="code" href="textangle_8C.html#a655a1c2a1ec25e8fcfb713772281e8f5">a</a> = <a class="code" href="namespaceTMath.html#a9ea900c956031cb12057acf7c322b0fa">TMath::Sqrt</a>(<a class="code" href="textangle_8C.html#a655a1c2a1ec25e8fcfb713772281e8f5">a</a> + nim);</div><div class="line"><a name="l01247"></a><span class="lineno"> 1247</span>&#160;         <a class="code" href="TRolke_8cxx.html#a1a2354f40e332ad13673b70afc2c0dbf">b</a> = <a class="code" href="TRolke_8cxx.html#a1a2354f40e332ad13673b70afc2c0dbf">b</a> / <a class="code" href="textangle_8C.html#a655a1c2a1ec25e8fcfb713772281e8f5">a</a>;</div><div class="line"><a name="l01248"></a><span class="lineno"> 1248</span>&#160;         <a class="code" href="TRolke_8cxx.html#a1a2354f40e332ad13673b70afc2c0dbf">b</a> = <a class="code" href="namespaceTMath.html#a428950de9bddacfb35915a9603880005">TMath::Exp</a>(<a class="code" href="TRolke_8cxx.html#a1a2354f40e332ad13673b70afc2c0dbf">b</a>);</div><div class="line"><a name="l01249"></a><span class="lineno"> 1249</span>&#160;         sm = sm + <a class="code" href="TRolke_8cxx.html#a1a2354f40e332ad13673b70afc2c0dbf">b</a>;</div><div class="line"><a name="l01250"></a><span class="lineno"> 1250</span>&#160;      }</div><div class="line"><a name="l01251"></a><span class="lineno"> 1251</span>&#160;      <a class="code" href="textangle_8C.html#a655a1c2a1ec25e8fcfb713772281e8f5">a</a> = sp / sm;</div><div class="line"><a name="l01252"></a><span class="lineno"> 1252</span>&#160;      <a class="code" href="textangle_8C.html#a655a1c2a1ec25e8fcfb713772281e8f5">a</a> = working_space[i + 1] = working_space[i] * <a class="code" href="textangle_8C.html#a655a1c2a1ec25e8fcfb713772281e8f5">a</a>;</div><div class="line"><a name="l01253"></a><span class="lineno"> 1253</span>&#160;      nom = nom + <a class="code" href="textangle_8C.html#a655a1c2a1ec25e8fcfb713772281e8f5">a</a>;</div><div class="line"><a name="l01254"></a><span class="lineno"> 1254</span>&#160;   }</div><div class="line"><a name="l01255"></a><span class="lineno"> 1255</span>&#160;   <span class="keywordflow">for</span>(i = <a class="code" href="THbookFile_8cxx.html#a058f249a5e6d20724cb0784b40a183e8">xmin</a>; i &lt;= <a class="code" href="THbookFile_8cxx.html#a9c42f51718ed192ed1841a53d2b0e507">xmax</a>; i++){</div><div class="line"><a name="l01256"></a><span class="lineno"> 1256</span>&#160;      working_space[i] = working_space[i] / nom;</div><div class="line"><a name="l01257"></a><span class="lineno"> 1257</span>&#160;   }</div><div class="line"><a name="l01258"></a><span class="lineno"> 1258</span>&#160;   <span class="keywordflow">for</span>(i = 0; i &lt; ssize; i++)</div><div class="line"><a name="l01259"></a><span class="lineno"> 1259</span>&#160;      source[i] = working_space[i] * area;</div><div class="line"><a name="l01260"></a><span class="lineno"> 1260</span>&#160;   <span class="keyword">delete</span>[]working_space;</div><div class="line"><a name="l01261"></a><span class="lineno"> 1261</span>&#160;   <span class="keywordflow">return</span> 0;</div><div class="line"><a name="l01262"></a><span class="lineno"> 1262</span>&#160;}</div><div class="line"><a name="l01263"></a><span class="lineno"> 1263</span>&#160;<span class="comment"></span></div><div class="line"><a name="l01264"></a><span class="lineno"> 1264</span>&#160;<span class="comment">////////////////////////////////////////////////////////////////////////////////</span></div><div class="line"><a name="l01265"></a><span class="lineno"> 1265</span>&#160;<span class="comment">/// One-dimensional deconvolution function</span></div><div class="line"><a name="l01266"></a><span class="lineno"> 1266</span>&#160;<span class="comment">///</span></div><div class="line"><a name="l01267"></a><span class="lineno"> 1267</span>&#160;<span class="comment">/// This function calculates deconvolution from source spectrum according to</span></div><div class="line"><a name="l01268"></a><span class="lineno"> 1268</span>&#160;<span class="comment">/// response spectrum using Gold deconvolution algorithm. The result is placed</span></div><div class="line"><a name="l01269"></a><span class="lineno"> 1269</span>&#160;<span class="comment">/// in the vector pointed by source pointer. On successful completion it</span></div><div class="line"><a name="l01270"></a><span class="lineno"> 1270</span>&#160;<span class="comment">/// returns 0. On error it returns pointer to the string describing error. If</span></div><div class="line"><a name="l01271"></a><span class="lineno"> 1271</span>&#160;<span class="comment">/// desired after every numberIterations one can apply boosting operation</span></div><div class="line"><a name="l01272"></a><span class="lineno"> 1272</span>&#160;<span class="comment">/// (exponential function with exponent given by boost coefficient) and repeat</span></div><div class="line"><a name="l01273"></a><span class="lineno"> 1273</span>&#160;<span class="comment">/// it numberRepetitions times.</span></div><div class="line"><a name="l01274"></a><span class="lineno"> 1274</span>&#160;<span class="comment">///</span></div><div class="line"><a name="l01275"></a><span class="lineno"> 1275</span>&#160;<span class="comment">/// #### Parameters:</span></div><div class="line"><a name="l01276"></a><span class="lineno"> 1276</span>&#160;<span class="comment">///</span></div><div class="line"><a name="l01277"></a><span class="lineno"> 1277</span>&#160;<span class="comment">///  - source:  pointer to the vector of source spectrum</span></div><div class="line"><a name="l01278"></a><span class="lineno"> 1278</span>&#160;<span class="comment">///  - response:     pointer to the vector of response spectrum</span></div><div class="line"><a name="l01279"></a><span class="lineno"> 1279</span>&#160;<span class="comment">///  - ssize:    length of source and response spectra</span></div><div class="line"><a name="l01280"></a><span class="lineno"> 1280</span>&#160;<span class="comment">///  - numberIterations, for details we refer to the reference given below</span></div><div class="line"><a name="l01281"></a><span class="lineno"> 1281</span>&#160;<span class="comment">///  - numberRepetitions, for repeated boosted deconvolution</span></div><div class="line"><a name="l01282"></a><span class="lineno"> 1282</span>&#160;<span class="comment">///  - boost, boosting coefficient</span></div><div class="line"><a name="l01283"></a><span class="lineno"> 1283</span>&#160;<span class="comment">///</span></div><div class="line"><a name="l01284"></a><span class="lineno"> 1284</span>&#160;<span class="comment">/// The goal of this function is the improvement of the resolution in spectra,</span></div><div class="line"><a name="l01285"></a><span class="lineno"> 1285</span>&#160;<span class="comment">/// decomposition of multiplets. The mathematical formulation of</span></div><div class="line"><a name="l01286"></a><span class="lineno"> 1286</span>&#160;<span class="comment">/// the convolution system is:</span></div><div class="line"><a name="l01287"></a><span class="lineno"> 1287</span>&#160;<span class="comment">///</span></div><div class="line"><a name="l01288"></a><span class="lineno"> 1288</span>&#160;<span class="comment">/// \f[</span></div><div class="line"><a name="l01289"></a><span class="lineno"> 1289</span>&#160;<span class="comment">/// y(i) = \sum_{k=0}^{N-1} h(i-k)x(k), i=0,1,2,...,N-1</span></div><div class="line"><a name="l01290"></a><span class="lineno"> 1290</span>&#160;<span class="comment">/// \f]</span></div><div class="line"><a name="l01291"></a><span class="lineno"> 1291</span>&#160;<span class="comment">///</span></div><div class="line"><a name="l01292"></a><span class="lineno"> 1292</span>&#160;<span class="comment">/// where h(i) is the impulse response function, x, y are input and output</span></div><div class="line"><a name="l01293"></a><span class="lineno"> 1293</span>&#160;<span class="comment">/// vectors, respectively, N is the length of x and h vectors. In matrix form</span></div><div class="line"><a name="l01294"></a><span class="lineno"> 1294</span>&#160;<span class="comment">/// we have:</span></div><div class="line"><a name="l01295"></a><span class="lineno"> 1295</span>&#160;<span class="comment"></span><span class="comment">/**</span></div><div class="line"><a name="l01296"></a><span class="lineno"> 1296</span>&#160;<span class="comment"> \f[</span></div><div class="line"><a name="l01297"></a><span class="lineno"> 1297</span>&#160;<span class="comment"> \begin{bmatrix}</span></div><div class="line"><a name="l01298"></a><span class="lineno"> 1298</span>&#160;<span class="comment">     y(0)    \\</span></div><div class="line"><a name="l01299"></a><span class="lineno"> 1299</span>&#160;<span class="comment">     y(1)    \\</span></div><div class="line"><a name="l01300"></a><span class="lineno"> 1300</span>&#160;<span class="comment">     \dots   \\</span></div><div class="line"><a name="l01301"></a><span class="lineno"> 1301</span>&#160;<span class="comment">     y(2N-2) \\</span></div><div class="line"><a name="l01302"></a><span class="lineno"> 1302</span>&#160;<span class="comment">     y(2N-1)</span></div><div class="line"><a name="l01303"></a><span class="lineno"> 1303</span>&#160;<span class="comment"> \end{bmatrix}</span></div><div class="line"><a name="l01304"></a><span class="lineno"> 1304</span>&#160;<span class="comment"> =</span></div><div class="line"><a name="l01305"></a><span class="lineno"> 1305</span>&#160;<span class="comment"> \begin{bmatrix}</span></div><div class="line"><a name="l01306"></a><span class="lineno"> 1306</span>&#160;<span class="comment">     h(0)    &amp; 0      &amp; 0      &amp; \dots &amp; 0         \\</span></div><div class="line"><a name="l01307"></a><span class="lineno"> 1307</span>&#160;<span class="comment">     h(1)    &amp; h(0)   &amp; 0      &amp; \dots &amp; \dots     \\</span></div><div class="line"><a name="l01308"></a><span class="lineno"> 1308</span>&#160;<span class="comment">     \dots   &amp; h(1)   &amp; h(0)   &amp; \dots &amp; \dots     \\</span></div><div class="line"><a name="l01309"></a><span class="lineno"> 1309</span>&#160;<span class="comment">     \dots   &amp; \dots  &amp; h(1)   &amp; \dots &amp; \dots     \\</span></div><div class="line"><a name="l01310"></a><span class="lineno"> 1310</span>&#160;<span class="comment">     \dots   &amp; \dots  &amp; \dots  &amp; \dots &amp; \dots     \\</span></div><div class="line"><a name="l01311"></a><span class="lineno"> 1311</span>&#160;<span class="comment">     h(N-1)  &amp; \dots  &amp; \dots  &amp;\dots  &amp; 0         \\</span></div><div class="line"><a name="l01312"></a><span class="lineno"> 1312</span>&#160;<span class="comment">     0       &amp; h(N-1) &amp; \dots   &amp; \dots &amp; h(0)     \\</span></div><div class="line"><a name="l01313"></a><span class="lineno"> 1313</span>&#160;<span class="comment">     0       &amp; 0      &amp; h(N-1)  &amp; \dots &amp; h(1)     \\</span></div><div class="line"><a name="l01314"></a><span class="lineno"> 1314</span>&#160;<span class="comment">     \dots   &amp; \dots  &amp; \dots   &amp; \dots &amp; \dots    \\</span></div><div class="line"><a name="l01315"></a><span class="lineno"> 1315</span>&#160;<span class="comment">     0       &amp; 0      &amp; 0       &amp; \dots &amp; h(N-1)</span></div><div class="line"><a name="l01316"></a><span class="lineno"> 1316</span>&#160;<span class="comment"> \end{bmatrix}</span></div><div class="line"><a name="l01317"></a><span class="lineno"> 1317</span>&#160;<span class="comment"> \begin{bmatrix}</span></div><div class="line"><a name="l01318"></a><span class="lineno"> 1318</span>&#160;<span class="comment">     x(0)  \\</span></div><div class="line"><a name="l01319"></a><span class="lineno"> 1319</span>&#160;<span class="comment">     x(1)  \\</span></div><div class="line"><a name="l01320"></a><span class="lineno"> 1320</span>&#160;<span class="comment">     \dots \\</span></div><div class="line"><a name="l01321"></a><span class="lineno"> 1321</span>&#160;<span class="comment">     x(N-1)</span></div><div class="line"><a name="l01322"></a><span class="lineno"> 1322</span>&#160;<span class="comment"> \end{bmatrix}</span></div><div class="line"><a name="l01323"></a><span class="lineno"> 1323</span>&#160;<span class="comment"> \f]</span></div><div class="line"><a name="l01324"></a><span class="lineno"> 1324</span>&#160;<span class="comment">*/</span><span class="comment"></span></div><div class="line"><a name="l01325"></a><span class="lineno"> 1325</span>&#160;<span class="comment">/// Let us assume that we know the response and the output vector (spectrum) of</span></div><div class="line"><a name="l01326"></a><span class="lineno"> 1326</span>&#160;<span class="comment">/// the above given system. The deconvolution represents solution of the</span></div><div class="line"><a name="l01327"></a><span class="lineno"> 1327</span>&#160;<span class="comment">/// overdetermined system of linear equations, i.e., the calculation of the</span></div><div class="line"><a name="l01328"></a><span class="lineno"> 1328</span>&#160;<span class="comment">/// vector x. From numerical stability point of view the operation of</span></div><div class="line"><a name="l01329"></a><span class="lineno"> 1329</span>&#160;<span class="comment">/// deconvolution is extremely critical (ill-posed problem) as well as time</span></div><div class="line"><a name="l01330"></a><span class="lineno"> 1330</span>&#160;<span class="comment">/// consuming operation. The Gold deconvolution algorithm proves to work very</span></div><div class="line"><a name="l01331"></a><span class="lineno"> 1331</span>&#160;<span class="comment">/// well, other methods (Fourier, VanCittert etc) oscillate. It is suitable to</span></div><div class="line"><a name="l01332"></a><span class="lineno"> 1332</span>&#160;<span class="comment">/// process positive definite data (e.g. histograms).</span></div><div class="line"><a name="l01333"></a><span class="lineno"> 1333</span>&#160;<span class="comment">///</span></div><div class="line"><a name="l01334"></a><span class="lineno"> 1334</span>&#160;<span class="comment">/// #### Gold deconvolution algorithm:</span></div><div class="line"><a name="l01335"></a><span class="lineno"> 1335</span>&#160;<span class="comment"></span><span class="comment">/**</span></div><div class="line"><a name="l01336"></a><span class="lineno"> 1336</span>&#160;<span class="comment"> \f[</span></div><div class="line"><a name="l01337"></a><span class="lineno"> 1337</span>&#160;<span class="comment"> y = Hx \\</span></div><div class="line"><a name="l01338"></a><span class="lineno"> 1338</span>&#160;<span class="comment"> H^{T}y = H^{T}Hx \\</span></div><div class="line"><a name="l01339"></a><span class="lineno"> 1339</span>&#160;<span class="comment"> y^{&#39;} = H^{&#39;}x \\</span></div><div class="line"><a name="l01340"></a><span class="lineno"> 1340</span>&#160;<span class="comment"> x_{i}^{(k+1)} = \frac{y_{i}^{&#39;}}{\sum_{m=0}^{N-1}H_{im}^{&#39;}x_{m}{(k)}}x_{i}{(k)},  i=0,1,2,...,N-1 \\</span></div><div class="line"><a name="l01341"></a><span class="lineno"> 1341</span>&#160;<span class="comment"> k = 1,2,3,...,L</span></div><div class="line"><a name="l01342"></a><span class="lineno"> 1342</span>&#160;<span class="comment"> x^{0} = [1,1, ..., 1]^T</span></div><div class="line"><a name="l01343"></a><span class="lineno"> 1343</span>&#160;<span class="comment"> \f]</span></div><div class="line"><a name="l01344"></a><span class="lineno"> 1344</span>&#160;<span class="comment">*/</span><span class="comment"></span></div><div class="line"><a name="l01345"></a><span class="lineno"> 1345</span>&#160;<span class="comment">/// Where L is given number of iterations (numberIterations parameter).</span></div><div class="line"><a name="l01346"></a><span class="lineno"> 1346</span>&#160;<span class="comment">///</span></div><div class="line"><a name="l01347"></a><span class="lineno"> 1347</span>&#160;<span class="comment">/// #### Boosted deconvolution:</span></div><div class="line"><a name="l01348"></a><span class="lineno"> 1348</span>&#160;<span class="comment">///</span></div><div class="line"><a name="l01349"></a><span class="lineno"> 1349</span>&#160;<span class="comment">///  1. Set the initial solution:</span></div><div class="line"><a name="l01350"></a><span class="lineno"> 1350</span>&#160;<span class="comment">///       \f$ x^{(0)} = [1,1,...,1]^{T} \f$</span></div><div class="line"><a name="l01351"></a><span class="lineno"> 1351</span>&#160;<span class="comment">///  2. Set required number of repetitions R and iterations L.</span></div><div class="line"><a name="l01352"></a><span class="lineno"> 1352</span>&#160;<span class="comment">///  3. Set r = 1.</span></div><div class="line"><a name="l01353"></a><span class="lineno"> 1353</span>&#160;<span class="comment">///  4. Using Gold deconvolution algorithm for k=1,2,...,L find</span></div><div class="line"><a name="l01354"></a><span class="lineno"> 1354</span>&#160;<span class="comment">///      \f$ x^{(L)} \f$</span></div><div class="line"><a name="l01355"></a><span class="lineno"> 1355</span>&#160;<span class="comment">///  5. If r = R stop calculation, else</span></div><div class="line"><a name="l01356"></a><span class="lineno"> 1356</span>&#160;<span class="comment">///</span></div><div class="line"><a name="l01357"></a><span class="lineno"> 1357</span>&#160;<span class="comment">///    1. Apply boosting operation, i.e., set</span></div><div class="line"><a name="l01358"></a><span class="lineno"> 1358</span>&#160;<span class="comment">///        \f$ x^{(0)}(i) = [x^{(L)}(i)]^{p} \f$</span></div><div class="line"><a name="l01359"></a><span class="lineno"> 1359</span>&#160;<span class="comment">///       i=0,1,...N-1 and p is boosting coefficient &gt;0.</span></div><div class="line"><a name="l01360"></a><span class="lineno"> 1360</span>&#160;<span class="comment">///    2. r = r + 1</span></div><div class="line"><a name="l01361"></a><span class="lineno"> 1361</span>&#160;<span class="comment">///    3. continue in 4.</span></div><div class="line"><a name="l01362"></a><span class="lineno"> 1362</span>&#160;<span class="comment">///</span></div><div class="line"><a name="l01363"></a><span class="lineno"> 1363</span>&#160;<span class="comment">/// #### References:</span></div><div class="line"><a name="l01364"></a><span class="lineno"> 1364</span>&#160;<span class="comment">///</span></div><div class="line"><a name="l01365"></a><span class="lineno"> 1365</span>&#160;<span class="comment">///  1. Gold R., ANL-6984, Argonne National Laboratories, Argonne Ill, 1964.</span></div><div class="line"><a name="l01366"></a><span class="lineno"> 1366</span>&#160;<span class="comment">///  2. Coote G.E., Iterative smoothing and deconvolution of one- and two-dimensional</span></div><div class="line"><a name="l01367"></a><span class="lineno"> 1367</span>&#160;<span class="comment">///     elemental distribution data, NIM B 130 (1997) 118.</span></div><div class="line"><a name="l01368"></a><span class="lineno"> 1368</span>&#160;<span class="comment">///  3. M. Morhac;, J. Kliman, V.  Matouoek, M. Veselsky,</span></div><div class="line"><a name="l01369"></a><span class="lineno"> 1369</span>&#160;<span class="comment">///     I. Turzo: Efficient one- and two-dimensional Gold deconvolution and</span></div><div class="line"><a name="l01370"></a><span class="lineno"> 1370</span>&#160;<span class="comment">///     its application to gamma-ray spectra decomposition. NIM, A401 (1997) 385-408.</span></div><div class="line"><a name="l01371"></a><span class="lineno"> 1371</span>&#160;<span class="comment">///  4. Morhac; M., Matouoek V., Kliman J., Efficient algorithm of multidimensional</span></div><div class="line"><a name="l01372"></a><span class="lineno"> 1372</span>&#160;<span class="comment">///     deconvolution and its application to nuclear data processing, Digital Signal</span></div><div class="line"><a name="l01373"></a><span class="lineno"> 1373</span>&#160;<span class="comment">///     Processing 13 (2003) 144.</span></div><div class="line"><a name="l01374"></a><span class="lineno"> 1374</span>&#160;<span class="comment">///</span></div><div class="line"><a name="l01375"></a><span class="lineno"> 1375</span>&#160;<span class="comment">/// ### Example 8 - script Deconvolution.C :</span></div><div class="line"><a name="l01376"></a><span class="lineno"> 1376</span>&#160;<span class="comment">///</span></div><div class="line"><a name="l01377"></a><span class="lineno"> 1377</span>&#160;<span class="comment">/// response function (usually peak) should be shifted left to the first</span></div><div class="line"><a name="l01378"></a><span class="lineno"> 1378</span>&#160;<span class="comment">/// non-zero channel (bin).</span></div><div class="line"><a name="l01379"></a><span class="lineno"> 1379</span>&#160;<span class="comment">///</span></div><div class="line"><a name="l01380"></a><span class="lineno"> 1380</span>&#160;<span class="comment">/// \image html TSpectrum_Deconvolution2.jpg Principle how the response matrix is composed inside of the Deconvolution function.</span></div><div class="line"><a name="l01381"></a><span class="lineno"> 1381</span>&#160;<span class="comment">///</span></div><div class="line"><a name="l01382"></a><span class="lineno"> 1382</span>&#160;<span class="comment">/// Begin_Macro(source)</span></div><div class="line"><a name="l01383"></a><span class="lineno"> 1383</span>&#160;<span class="comment">/// ../../../tutorials/spectrum/Deconvolution.C</span></div><div class="line"><a name="l01384"></a><span class="lineno"> 1384</span>&#160;<span class="comment">/// End_Macro</span></div><div class="line"><a name="l01385"></a><span class="lineno"> 1385</span>&#160;<span class="comment">///</span></div><div class="line"><a name="l01386"></a><span class="lineno"> 1386</span>&#160;<span class="comment">/// ### Examples of Gold deconvolution method:</span></div><div class="line"><a name="l01387"></a><span class="lineno"> 1387</span>&#160;<span class="comment">///</span></div><div class="line"><a name="l01388"></a><span class="lineno"> 1388</span>&#160;<span class="comment">/// First let us study the influence of the number of iterations on the</span></div><div class="line"><a name="l01389"></a><span class="lineno"> 1389</span>&#160;<span class="comment">/// deconvolved spectrum (Fig. 12).</span></div><div class="line"><a name="l01390"></a><span class="lineno"> 1390</span>&#160;<span class="comment">///</span></div><div class="line"><a name="l01391"></a><span class="lineno"> 1391</span>&#160;<span class="comment">/// \image html TSpectrum_Deconvolution_wide1.jpg Fig. 12 Study of Gold deconvolution algorithm.The original source spectrum is drawn with black color, spectrum after 100 iterations with red color, spectrum after 1000 iterations with blue color, spectrum after 10000 iterations with green color and spectrum after 100000 iterations with magenta color.</span></div><div class="line"><a name="l01392"></a><span class="lineno"> 1392</span>&#160;<span class="comment">///</span></div><div class="line"><a name="l01393"></a><span class="lineno"> 1393</span>&#160;<span class="comment">/// For relatively narrow peaks in the above given example the Gold</span></div><div class="line"><a name="l01394"></a><span class="lineno"> 1394</span>&#160;<span class="comment">/// deconvolution method is able to decompose overlapping peaks practically to</span></div><div class="line"><a name="l01395"></a><span class="lineno"> 1395</span>&#160;<span class="comment">/// delta - functions. In the next example we have chosen a synthetic data</span></div><div class="line"><a name="l01396"></a><span class="lineno"> 1396</span>&#160;<span class="comment">/// (spectrum, 256 channels) consisting of 5 very closely positioned, relatively</span></div><div class="line"><a name="l01397"></a><span class="lineno"> 1397</span>&#160;<span class="comment">/// wide peaks (sigma =5), with added noise (Fig. 13). Thin lines represent</span></div><div class="line"><a name="l01398"></a><span class="lineno"> 1398</span>&#160;<span class="comment">/// pure Gaussians (see Table 1); thick line is a resulting spectrum with</span></div><div class="line"><a name="l01399"></a><span class="lineno"> 1399</span>&#160;<span class="comment">/// additive noise (10% of the amplitude of small peaks).</span></div><div class="line"><a name="l01400"></a><span class="lineno"> 1400</span>&#160;<span class="comment">///</span></div><div class="line"><a name="l01401"></a><span class="lineno"> 1401</span>&#160;<span class="comment">/// \image html TSpectrum_Deconvolution_wide2.jpg Fig. 13 Testing example of synthetic spectrum composed of 5 Gaussians with added noise.</span></div><div class="line"><a name="l01402"></a><span class="lineno"> 1402</span>&#160;<span class="comment">///</span></div><div class="line"><a name="l01403"></a><span class="lineno"> 1403</span>&#160;<span class="comment">///   | Peak #   | Position | Height | Area   |</span></div><div class="line"><a name="l01404"></a><span class="lineno"> 1404</span>&#160;<span class="comment">///   |----------|----------|--------|--------|</span></div><div class="line"><a name="l01405"></a><span class="lineno"> 1405</span>&#160;<span class="comment">///   | 1        | 50       | 500    | 10159  |</span></div><div class="line"><a name="l01406"></a><span class="lineno"> 1406</span>&#160;<span class="comment">///   | 2        | 70       | 3000   | 60957  |</span></div><div class="line"><a name="l01407"></a><span class="lineno"> 1407</span>&#160;<span class="comment">///   | 3        | 80       | 1000   | 20319  |</span></div><div class="line"><a name="l01408"></a><span class="lineno"> 1408</span>&#160;<span class="comment">///   | 4        | 100      | 5000   | 101596 |</span></div><div class="line"><a name="l01409"></a><span class="lineno"> 1409</span>&#160;<span class="comment">///   | 5        | 110      | 500    | 10159  |</span></div><div class="line"><a name="l01410"></a><span class="lineno"> 1410</span>&#160;<span class="comment">///</span></div><div class="line"><a name="l01411"></a><span class="lineno"> 1411</span>&#160;<span class="comment">/// Table 1 Positions, heights and areas of peaks in the spectrum shown in Fig. 13.</span></div><div class="line"><a name="l01412"></a><span class="lineno"> 1412</span>&#160;<span class="comment">///</span></div><div class="line"><a name="l01413"></a><span class="lineno"> 1413</span>&#160;<span class="comment">/// In ideal case, we should obtain the result given in Fig. 14. The areas of</span></div><div class="line"><a name="l01414"></a><span class="lineno"> 1414</span>&#160;<span class="comment">/// the Gaussian components of the spectrum are concentrated completely to</span></div><div class="line"><a name="l01415"></a><span class="lineno"> 1415</span>&#160;<span class="comment">/// delta-functions. When solving the overdetermined system of linear equations</span></div><div class="line"><a name="l01416"></a><span class="lineno"> 1416</span>&#160;<span class="comment">/// with data from Fig. 13 in the sense of minimum least squares criterion</span></div><div class="line"><a name="l01417"></a><span class="lineno"> 1417</span>&#160;<span class="comment">/// without any regularisation we obtain the result with large oscillations</span></div><div class="line"><a name="l01418"></a><span class="lineno"> 1418</span>&#160;<span class="comment">/// (Fig. 15). From mathematical point of view, it is the optimal solution in</span></div><div class="line"><a name="l01419"></a><span class="lineno"> 1419</span>&#160;<span class="comment">/// the unconstrained space of independent variables. From physical point of</span></div><div class="line"><a name="l01420"></a><span class="lineno"> 1420</span>&#160;<span class="comment">/// view we are interested only in a meaningful solution. Therefore, we have to</span></div><div class="line"><a name="l01421"></a><span class="lineno"> 1421</span>&#160;<span class="comment">/// employ regularisation techniques (e.g. Gold deconvolution) and/or to</span></div><div class="line"><a name="l01422"></a><span class="lineno"> 1422</span>&#160;<span class="comment">/// confine the space of allowed solutions to subspace of positive solutions.</span></div><div class="line"><a name="l01423"></a><span class="lineno"> 1423</span>&#160;<span class="comment">///</span></div><div class="line"><a name="l01424"></a><span class="lineno"> 1424</span>&#160;<span class="comment">/// \image html TSpectrum_Deconvolution_wide3.jpg Fig. 14 The same spectrum like in Fig. 13, outlined bars show the contents of present components (peaks).</span></div><div class="line"><a name="l01425"></a><span class="lineno"> 1425</span>&#160;<span class="comment">/// \image html TSpectrum_Deconvolution_wide4.jpg Fig. 15 Least squares solution of the system of linear equations without regularisation.</span></div><div class="line"><a name="l01426"></a><span class="lineno"> 1426</span>&#160;<span class="comment">///</span></div><div class="line"><a name="l01427"></a><span class="lineno"> 1427</span>&#160;<span class="comment">/// ### Example 9 - script Deconvolution_wide.C</span></div><div class="line"><a name="l01428"></a><span class="lineno"> 1428</span>&#160;<span class="comment">///</span></div><div class="line"><a name="l01429"></a><span class="lineno"> 1429</span>&#160;<span class="comment">/// When we employ Gold deconvolution algorithm we obtain the result given in</span></div><div class="line"><a name="l01430"></a><span class="lineno"> 1430</span>&#160;<span class="comment">/// Fig. 16. One can observe that the resulting spectrum is smooth. On the</span></div><div class="line"><a name="l01431"></a><span class="lineno"> 1431</span>&#160;<span class="comment">/// other hand the method is not able to decompose completely the peaks in the</span></div><div class="line"><a name="l01432"></a><span class="lineno"> 1432</span>&#160;<span class="comment">/// spectrum.</span></div><div class="line"><a name="l01433"></a><span class="lineno"> 1433</span>&#160;<span class="comment">///</span></div><div class="line"><a name="l01434"></a><span class="lineno"> 1434</span>&#160;<span class="comment">/// Example of Gold deconvolution for closely positioned wide peaks. The original</span></div><div class="line"><a name="l01435"></a><span class="lineno"> 1435</span>&#160;<span class="comment">/// source spectrum is drawn with black color, the spectrum after the deconvolution</span></div><div class="line"><a name="l01436"></a><span class="lineno"> 1436</span>&#160;<span class="comment">/// (10000 iterations) with red color.</span></div><div class="line"><a name="l01437"></a><span class="lineno"> 1437</span>&#160;<span class="comment">///</span></div><div class="line"><a name="l01438"></a><span class="lineno"> 1438</span>&#160;<span class="comment">/// Begin_Macro(source)</span></div><div class="line"><a name="l01439"></a><span class="lineno"> 1439</span>&#160;<span class="comment">/// ../../../tutorials/spectrum/Deconvolution_wide.C</span></div><div class="line"><a name="l01440"></a><span class="lineno"> 1440</span>&#160;<span class="comment">/// End_Macro</span></div><div class="line"><a name="l01441"></a><span class="lineno"> 1441</span>&#160;<span class="comment">///</span></div><div class="line"><a name="l01442"></a><span class="lineno"> 1442</span>&#160;<span class="comment">/// ### Example 10 - script Deconvolution_wide_boost.C :</span></div><div class="line"><a name="l01443"></a><span class="lineno"> 1443</span>&#160;<span class="comment">///</span></div><div class="line"><a name="l01444"></a><span class="lineno"> 1444</span>&#160;<span class="comment">/// Further let us employ boosting operation into deconvolution (Fig. 17).</span></div><div class="line"><a name="l01445"></a><span class="lineno"> 1445</span>&#160;<span class="comment">///</span></div><div class="line"><a name="l01446"></a><span class="lineno"> 1446</span>&#160;<span class="comment">/// The original source spectrum is drawn with black color, the spectrum after</span></div><div class="line"><a name="l01447"></a><span class="lineno"> 1447</span>&#160;<span class="comment">/// the deconvolution with red color. Number of iterations = 200, number of</span></div><div class="line"><a name="l01448"></a><span class="lineno"> 1448</span>&#160;<span class="comment">/// repetitions = 50 and boosting coefficient = 1.2.</span></div><div class="line"><a name="l01449"></a><span class="lineno"> 1449</span>&#160;<span class="comment">///</span></div><div class="line"><a name="l01450"></a><span class="lineno"> 1450</span>&#160;<span class="comment">/// One can observe that peaks are decomposed practically to delta functions.</span></div><div class="line"><a name="l01451"></a><span class="lineno"> 1451</span>&#160;<span class="comment">/// Number of peaks is correct, positions of big peaks as well as their areas</span></div><div class="line"><a name="l01452"></a><span class="lineno"> 1452</span>&#160;<span class="comment">/// are relatively well estimated. However there is a considerable error in</span></div><div class="line"><a name="l01453"></a><span class="lineno"> 1453</span>&#160;<span class="comment">/// the estimation of the position of small right hand peak.</span></div><div class="line"><a name="l01454"></a><span class="lineno"> 1454</span>&#160;<span class="comment">///</span></div><div class="line"><a name="l01455"></a><span class="lineno"> 1455</span>&#160;<span class="comment">/// Begin_Macro(source)</span></div><div class="line"><a name="l01456"></a><span class="lineno"> 1456</span>&#160;<span class="comment">/// ../../../tutorials/spectrum/Deconvolution_wide_boost.C</span></div><div class="line"><a name="l01457"></a><span class="lineno"> 1457</span>&#160;<span class="comment">/// End_Macro</span></div><div class="line"><a name="l01458"></a><span class="lineno"> 1458</span>&#160;<span class="comment"></span></div><div class="line"><a name="l01459"></a><span class="lineno"><a class="line" href="classTSpectrum.html#a81b35e9f63977f017e8a31295f01e05e"> 1459</a></span>&#160;<span class="keyword">const</span> <span class="keywordtype">char</span> *<a class="code" href="classTSpectrum.html#a81b35e9f63977f017e8a31295f01e05e">TSpectrum::Deconvolution</a>(<a class="code" href="RtypesCore_8h.html#ab9b5334647b78ec4256db251e3ae1fc6">Double_t</a> *source, <span class="keyword">const</span> <a class="code" href="RtypesCore_8h.html#ab9b5334647b78ec4256db251e3ae1fc6">Double_t</a> *response,</div><div class="line"><a name="l01460"></a><span class="lineno"> 1460</span>&#160;                                      <span class="keywordtype">int</span> ssize, <span class="keywordtype">int</span> numberIterations,</div><div class="line"><a name="l01461"></a><span class="lineno"> 1461</span>&#160;                                      <span class="keywordtype">int</span> numberRepetitions, <a class="code" href="RtypesCore_8h.html#ab9b5334647b78ec4256db251e3ae1fc6">Double_t</a> <a class="code" href="namespaceROOT_1_1Math_1_1VectorUtil.html#a421c8e59ccf765d83def701c1ff8fa76">boost</a> )</div><div class="line"><a name="l01462"></a><span class="lineno"> 1462</span>&#160;{</div><div class="line"><a name="l01463"></a><span class="lineno"> 1463</span>&#160;   <span class="keywordflow">if</span> (ssize &lt;= 0)</div><div class="line"><a name="l01464"></a><span class="lineno"> 1464</span>&#160;      <span class="keywordflow">return</span> <span class="stringliteral">&quot;Wrong Parameters&quot;</span>;</div><div class="line"><a name="l01465"></a><span class="lineno"> 1465</span>&#160;</div><div class="line"><a name="l01466"></a><span class="lineno"> 1466</span>&#160;   <span class="keywordflow">if</span> (numberRepetitions &lt;= 0)</div><div class="line"><a name="l01467"></a><span class="lineno"> 1467</span>&#160;      <span class="keywordflow">return</span> <span class="stringliteral">&quot;Wrong Parameters&quot;</span>;</div><div class="line"><a name="l01468"></a><span class="lineno"> 1468</span>&#160;</div><div class="line"><a name="l01469"></a><span class="lineno"> 1469</span>&#160;       <span class="comment">//   working_space-pointer to the working vector</span></div><div class="line"><a name="l01470"></a><span class="lineno"> 1470</span>&#160;       <span class="comment">//   (its size must be 4*ssize of source spectrum)</span></div><div class="line"><a name="l01471"></a><span class="lineno"> 1471</span>&#160;   <a class="code" href="RtypesCore_8h.html#ab9b5334647b78ec4256db251e3ae1fc6">Double_t</a> *working_space = <span class="keyword">new</span> <a class="code" href="RtypesCore_8h.html#ab9b5334647b78ec4256db251e3ae1fc6">Double_t</a>[4 * ssize];</div><div class="line"><a name="l01472"></a><span class="lineno"> 1472</span>&#160;   <span class="keywordtype">int</span> i, j, k, lindex, posit, lh_gold, <a class="code" href="textangle_8C.html#a3359d7f1aa9fe2f8bc884b02020e8d20">l</a>, repet;</div><div class="line"><a name="l01473"></a><span class="lineno"> 1473</span>&#160;   <a class="code" href="RtypesCore_8h.html#ab9b5334647b78ec4256db251e3ae1fc6">Double_t</a> lda, ldb, ldc, area, maximum;</div><div class="line"><a name="l01474"></a><span class="lineno"> 1474</span>&#160;   area = 0;</div><div class="line"><a name="l01475"></a><span class="lineno"> 1475</span>&#160;   lh_gold = -1;</div><div class="line"><a name="l01476"></a><span class="lineno"> 1476</span>&#160;   posit = 0;</div><div class="line"><a name="l01477"></a><span class="lineno"> 1477</span>&#160;   maximum = 0;</div><div class="line"><a name="l01478"></a><span class="lineno"> 1478</span>&#160;</div><div class="line"><a name="l01479"></a><span class="lineno"> 1479</span>&#160;<span class="comment">//read response vector</span></div><div class="line"><a name="l01480"></a><span class="lineno"> 1480</span>&#160;   <span class="keywordflow">for</span> (i = 0; i &lt; ssize; i++) {</div><div class="line"><a name="l01481"></a><span class="lineno"> 1481</span>&#160;      lda = response[i];</div><div class="line"><a name="l01482"></a><span class="lineno"> 1482</span>&#160;      <span class="keywordflow">if</span> (lda != 0)</div><div class="line"><a name="l01483"></a><span class="lineno"> 1483</span>&#160;         lh_gold = i + 1;</div><div class="line"><a name="l01484"></a><span class="lineno"> 1484</span>&#160;      working_space[i] = lda;</div><div class="line"><a name="l01485"></a><span class="lineno"> 1485</span>&#160;      area += lda;</div><div class="line"><a name="l01486"></a><span class="lineno"> 1486</span>&#160;      <span class="keywordflow">if</span> (lda &gt; maximum) {</div><div class="line"><a name="l01487"></a><span class="lineno"> 1487</span>&#160;         maximum = lda;</div><div class="line"><a name="l01488"></a><span class="lineno"> 1488</span>&#160;         posit = i;</div><div class="line"><a name="l01489"></a><span class="lineno"> 1489</span>&#160;      }</div><div class="line"><a name="l01490"></a><span class="lineno"> 1490</span>&#160;   }</div><div class="line"><a name="l01491"></a><span class="lineno"> 1491</span>&#160;   <span class="keywordflow">if</span> (lh_gold == -1) {</div><div class="line"><a name="l01492"></a><span class="lineno"> 1492</span>&#160;      <span class="keyword">delete</span> [] working_space;</div><div class="line"><a name="l01493"></a><span class="lineno"> 1493</span>&#160;      <span class="keywordflow">return</span> <span class="stringliteral">&quot;ZERO RESPONSE VECTOR&quot;</span>;</div><div class="line"><a name="l01494"></a><span class="lineno"> 1494</span>&#160;   }</div><div class="line"><a name="l01495"></a><span class="lineno"> 1495</span>&#160;</div><div class="line"><a name="l01496"></a><span class="lineno"> 1496</span>&#160;<span class="comment">//read source vector</span></div><div class="line"><a name="l01497"></a><span class="lineno"> 1497</span>&#160;   <span class="keywordflow">for</span> (i = 0; i &lt; ssize; i++)</div><div class="line"><a name="l01498"></a><span class="lineno"> 1498</span>&#160;      working_space[2 * ssize + i] = source[i];</div><div class="line"><a name="l01499"></a><span class="lineno"> 1499</span>&#160;</div><div class="line"><a name="l01500"></a><span class="lineno"> 1500</span>&#160;<span class="comment">// create matrix at*a and vector at*y</span></div><div class="line"><a name="l01501"></a><span class="lineno"> 1501</span>&#160;   <span class="keywordflow">for</span> (i = 0; i &lt; ssize; i++){</div><div class="line"><a name="l01502"></a><span class="lineno"> 1502</span>&#160;      lda = 0;</div><div class="line"><a name="l01503"></a><span class="lineno"> 1503</span>&#160;      <span class="keywordflow">for</span> (j = 0; j &lt; ssize; j++){</div><div class="line"><a name="l01504"></a><span class="lineno"> 1504</span>&#160;         ldb = working_space[j];</div><div class="line"><a name="l01505"></a><span class="lineno"> 1505</span>&#160;         k = i + j;</div><div class="line"><a name="l01506"></a><span class="lineno"> 1506</span>&#160;         <span class="keywordflow">if</span> (k &lt; ssize){</div><div class="line"><a name="l01507"></a><span class="lineno"> 1507</span>&#160;            ldc = working_space[k];</div><div class="line"><a name="l01508"></a><span class="lineno"> 1508</span>&#160;            lda = lda + ldb * ldc;</div><div class="line"><a name="l01509"></a><span class="lineno"> 1509</span>&#160;         }</div><div class="line"><a name="l01510"></a><span class="lineno"> 1510</span>&#160;      }</div><div class="line"><a name="l01511"></a><span class="lineno"> 1511</span>&#160;      working_space[ssize + i] = lda;</div><div class="line"><a name="l01512"></a><span class="lineno"> 1512</span>&#160;      lda = 0;</div><div class="line"><a name="l01513"></a><span class="lineno"> 1513</span>&#160;      <span class="keywordflow">for</span> (k = 0; k &lt; ssize; k++){</div><div class="line"><a name="l01514"></a><span class="lineno"> 1514</span>&#160;         <a class="code" href="textangle_8C.html#a3359d7f1aa9fe2f8bc884b02020e8d20">l</a> = k - i;</div><div class="line"><a name="l01515"></a><span class="lineno"> 1515</span>&#160;         <span class="keywordflow">if</span> (<a class="code" href="textangle_8C.html#a3359d7f1aa9fe2f8bc884b02020e8d20">l</a> &gt;= 0){</div><div class="line"><a name="l01516"></a><span class="lineno"> 1516</span>&#160;            ldb = working_space[<a class="code" href="textangle_8C.html#a3359d7f1aa9fe2f8bc884b02020e8d20">l</a>];</div><div class="line"><a name="l01517"></a><span class="lineno"> 1517</span>&#160;            ldc = working_space[2 * ssize + k];</div><div class="line"><a name="l01518"></a><span class="lineno"> 1518</span>&#160;            lda = lda + ldb * ldc;</div><div class="line"><a name="l01519"></a><span class="lineno"> 1519</span>&#160;         }</div><div class="line"><a name="l01520"></a><span class="lineno"> 1520</span>&#160;      }</div><div class="line"><a name="l01521"></a><span class="lineno"> 1521</span>&#160;      working_space[3 * ssize + i]=lda;</div><div class="line"><a name="l01522"></a><span class="lineno"> 1522</span>&#160;   }</div><div class="line"><a name="l01523"></a><span class="lineno"> 1523</span>&#160;</div><div class="line"><a name="l01524"></a><span class="lineno"> 1524</span>&#160;<span class="comment">// move vector at*y</span></div><div class="line"><a name="l01525"></a><span class="lineno"> 1525</span>&#160;   <span class="keywordflow">for</span> (i = 0; i &lt; ssize; i++){</div><div class="line"><a name="l01526"></a><span class="lineno"> 1526</span>&#160;      working_space[2 * ssize + i] = working_space[3 * ssize + i];</div><div class="line"><a name="l01527"></a><span class="lineno"> 1527</span>&#160;   }</div><div class="line"><a name="l01528"></a><span class="lineno"> 1528</span>&#160;</div><div class="line"><a name="l01529"></a><span class="lineno"> 1529</span>&#160;<span class="comment">//initialization of resulting vector</span></div><div class="line"><a name="l01530"></a><span class="lineno"> 1530</span>&#160;   <span class="keywordflow">for</span> (i = 0; i &lt; ssize; i++)</div><div class="line"><a name="l01531"></a><span class="lineno"> 1531</span>&#160;      working_space[i] = 1;</div><div class="line"><a name="l01532"></a><span class="lineno"> 1532</span>&#160;</div><div class="line"><a name="l01533"></a><span class="lineno"> 1533</span>&#160;       <span class="comment">//**START OF ITERATIONS**</span></div><div class="line"><a name="l01534"></a><span class="lineno"> 1534</span>&#160;   <span class="keywordflow">for</span> (repet = 0; repet &lt; numberRepetitions; repet++) {</div><div class="line"><a name="l01535"></a><span class="lineno"> 1535</span>&#160;      <span class="keywordflow">if</span> (repet != 0) {</div><div class="line"><a name="l01536"></a><span class="lineno"> 1536</span>&#160;         <span class="keywordflow">for</span> (i = 0; i &lt; ssize; i++)</div><div class="line"><a name="l01537"></a><span class="lineno"> 1537</span>&#160;            working_space[i] = <a class="code" href="namespaceTMath.html#a9f3bcefa095d69086d20e7b76bc9bfc6">TMath::Power</a>(working_space[i], <a class="code" href="namespaceROOT_1_1Math_1_1VectorUtil.html#a421c8e59ccf765d83def701c1ff8fa76">boost</a>);</div><div class="line"><a name="l01538"></a><span class="lineno"> 1538</span>&#160;      }</div><div class="line"><a name="l01539"></a><span class="lineno"> 1539</span>&#160;      <span class="keywordflow">for</span> (lindex = 0; lindex &lt; numberIterations; lindex++) {</div><div class="line"><a name="l01540"></a><span class="lineno"> 1540</span>&#160;         <span class="keywordflow">for</span> (i = 0; i &lt; ssize; i++) {</div><div class="line"><a name="l01541"></a><span class="lineno"> 1541</span>&#160;            <span class="keywordflow">if</span> (working_space[2 * ssize + i] &gt; 0.000001</div><div class="line"><a name="l01542"></a><span class="lineno"> 1542</span>&#160;                 &amp;&amp; working_space[i] &gt; 0.000001) {</div><div class="line"><a name="l01543"></a><span class="lineno"> 1543</span>&#160;               lda = 0;</div><div class="line"><a name="l01544"></a><span class="lineno"> 1544</span>&#160;               <span class="keywordflow">for</span> (j = 0; j &lt; lh_gold; j++) {</div><div class="line"><a name="l01545"></a><span class="lineno"> 1545</span>&#160;                  ldb = working_space[j + ssize];</div><div class="line"><a name="l01546"></a><span class="lineno"> 1546</span>&#160;                  <span class="keywordflow">if</span> (j != 0){</div><div class="line"><a name="l01547"></a><span class="lineno"> 1547</span>&#160;                     k = i + j;</div><div class="line"><a name="l01548"></a><span class="lineno"> 1548</span>&#160;                     ldc = 0;</div><div class="line"><a name="l01549"></a><span class="lineno"> 1549</span>&#160;                     <span class="keywordflow">if</span> (k &lt; ssize)</div><div class="line"><a name="l01550"></a><span class="lineno"> 1550</span>&#160;                        ldc = working_space[k];</div><div class="line"><a name="l01551"></a><span class="lineno"> 1551</span>&#160;                     k = i - j;</div><div class="line"><a name="l01552"></a><span class="lineno"> 1552</span>&#160;                     <span class="keywordflow">if</span> (k &gt;= 0)</div><div class="line"><a name="l01553"></a><span class="lineno"> 1553</span>&#160;                        ldc += working_space[k];</div><div class="line"><a name="l01554"></a><span class="lineno"> 1554</span>&#160;                  }</div><div class="line"><a name="l01555"></a><span class="lineno"> 1555</span>&#160;</div><div class="line"><a name="l01556"></a><span class="lineno"> 1556</span>&#160;                  <span class="keywordflow">else</span></div><div class="line"><a name="l01557"></a><span class="lineno"> 1557</span>&#160;                     ldc = working_space[i];</div><div class="line"><a name="l01558"></a><span class="lineno"> 1558</span>&#160;                  lda = lda + ldb * ldc;</div><div class="line"><a name="l01559"></a><span class="lineno"> 1559</span>&#160;               }</div><div class="line"><a name="l01560"></a><span class="lineno"> 1560</span>&#160;               ldb = working_space[2 * ssize + i];</div><div class="line"><a name="l01561"></a><span class="lineno"> 1561</span>&#160;               <span class="keywordflow">if</span> (lda != 0)</div><div class="line"><a name="l01562"></a><span class="lineno"> 1562</span>&#160;                  lda = ldb / lda;</div><div class="line"><a name="l01563"></a><span class="lineno"> 1563</span>&#160;</div><div class="line"><a name="l01564"></a><span class="lineno"> 1564</span>&#160;               <span class="keywordflow">else</span></div><div class="line"><a name="l01565"></a><span class="lineno"> 1565</span>&#160;                  lda = 0;</div><div class="line"><a name="l01566"></a><span class="lineno"> 1566</span>&#160;               ldb = working_space[i];</div><div class="line"><a name="l01567"></a><span class="lineno"> 1567</span>&#160;               lda = lda * ldb;</div><div class="line"><a name="l01568"></a><span class="lineno"> 1568</span>&#160;               working_space[3 * ssize + i] = lda;</div><div class="line"><a name="l01569"></a><span class="lineno"> 1569</span>&#160;            }</div><div class="line"><a name="l01570"></a><span class="lineno"> 1570</span>&#160;         }</div><div class="line"><a name="l01571"></a><span class="lineno"> 1571</span>&#160;         <span class="keywordflow">for</span> (i = 0; i &lt; ssize; i++)</div><div class="line"><a name="l01572"></a><span class="lineno"> 1572</span>&#160;            working_space[i] = working_space[3 * ssize + i];</div><div class="line"><a name="l01573"></a><span class="lineno"> 1573</span>&#160;      }</div><div class="line"><a name="l01574"></a><span class="lineno"> 1574</span>&#160;   }</div><div class="line"><a name="l01575"></a><span class="lineno"> 1575</span>&#160;</div><div class="line"><a name="l01576"></a><span class="lineno"> 1576</span>&#160;<span class="comment">//shift resulting spectrum</span></div><div class="line"><a name="l01577"></a><span class="lineno"> 1577</span>&#160;   <span class="keywordflow">for</span> (i = 0; i &lt; ssize; i++) {</div><div class="line"><a name="l01578"></a><span class="lineno"> 1578</span>&#160;      lda = working_space[i];</div><div class="line"><a name="l01579"></a><span class="lineno"> 1579</span>&#160;      j = i + posit;</div><div class="line"><a name="l01580"></a><span class="lineno"> 1580</span>&#160;      j = j % ssize;</div><div class="line"><a name="l01581"></a><span class="lineno"> 1581</span>&#160;      working_space[ssize + j] = lda;</div><div class="line"><a name="l01582"></a><span class="lineno"> 1582</span>&#160;   }</div><div class="line"><a name="l01583"></a><span class="lineno"> 1583</span>&#160;</div><div class="line"><a name="l01584"></a><span class="lineno"> 1584</span>&#160;<span class="comment">//write back resulting spectrum</span></div><div class="line"><a name="l01585"></a><span class="lineno"> 1585</span>&#160;   <span class="keywordflow">for</span> (i = 0; i &lt; ssize; i++)</div><div class="line"><a name="l01586"></a><span class="lineno"> 1586</span>&#160;      source[i] = area * working_space[ssize + i];</div><div class="line"><a name="l01587"></a><span class="lineno"> 1587</span>&#160;   <span class="keyword">delete</span>[]working_space;</div><div class="line"><a name="l01588"></a><span class="lineno"> 1588</span>&#160;   <span class="keywordflow">return</span> 0;</div><div class="line"><a name="l01589"></a><span class="lineno"> 1589</span>&#160;}</div><div class="line"><a name="l01590"></a><span class="lineno"> 1590</span>&#160;</div><div class="line"><a name="l01591"></a><span class="lineno"> 1591</span>&#160;<span class="comment"></span></div><div class="line"><a name="l01592"></a><span class="lineno"> 1592</span>&#160;<span class="comment">////////////////////////////////////////////////////////////////////////////////</span></div><div class="line"><a name="l01593"></a><span class="lineno"> 1593</span>&#160;<span class="comment">/// One-dimensional deconvolution function.</span></div><div class="line"><a name="l01594"></a><span class="lineno"> 1594</span>&#160;<span class="comment">///</span></div><div class="line"><a name="l01595"></a><span class="lineno"> 1595</span>&#160;<span class="comment">/// This function calculates deconvolution from source spectrum according to</span></div><div class="line"><a name="l01596"></a><span class="lineno"> 1596</span>&#160;<span class="comment">/// response spectrum using Richardson-Lucy deconvolution algorithm. The result</span></div><div class="line"><a name="l01597"></a><span class="lineno"> 1597</span>&#160;<span class="comment">/// is placed in the vector pointed by source pointer. On successful completion</span></div><div class="line"><a name="l01598"></a><span class="lineno"> 1598</span>&#160;<span class="comment">/// it returns 0. On error it returns pointer to the string describing error.</span></div><div class="line"><a name="l01599"></a><span class="lineno"> 1599</span>&#160;<span class="comment">/// If desired after every numberIterations one can apply boosting operation</span></div><div class="line"><a name="l01600"></a><span class="lineno"> 1600</span>&#160;<span class="comment">/// (exponential function with exponent given by boost coefficient) and repeat</span></div><div class="line"><a name="l01601"></a><span class="lineno"> 1601</span>&#160;<span class="comment">/// it numberRepetitions times (see Gold deconvolution).</span></div><div class="line"><a name="l01602"></a><span class="lineno"> 1602</span>&#160;<span class="comment">///</span></div><div class="line"><a name="l01603"></a><span class="lineno"> 1603</span>&#160;<span class="comment">/// #### Parameters:</span></div><div class="line"><a name="l01604"></a><span class="lineno"> 1604</span>&#160;<span class="comment">///</span></div><div class="line"><a name="l01605"></a><span class="lineno"> 1605</span>&#160;<span class="comment">///  - source:  pointer to the vector of source spectrum</span></div><div class="line"><a name="l01606"></a><span class="lineno"> 1606</span>&#160;<span class="comment">///  - response:     pointer to the vector of response spectrum</span></div><div class="line"><a name="l01607"></a><span class="lineno"> 1607</span>&#160;<span class="comment">///  - ssize:    length of source and response spectra</span></div><div class="line"><a name="l01608"></a><span class="lineno"> 1608</span>&#160;<span class="comment">///  - numberIterations, for details we refer to the reference given above</span></div><div class="line"><a name="l01609"></a><span class="lineno"> 1609</span>&#160;<span class="comment">///  - numberRepetitions, for repeated boosted deconvolution</span></div><div class="line"><a name="l01610"></a><span class="lineno"> 1610</span>&#160;<span class="comment">///  - boost, boosting coefficient</span></div><div class="line"><a name="l01611"></a><span class="lineno"> 1611</span>&#160;<span class="comment">///</span></div><div class="line"><a name="l01612"></a><span class="lineno"> 1612</span>&#160;<span class="comment">/// ### Richardson-Lucy deconvolution algorithm:</span></div><div class="line"><a name="l01613"></a><span class="lineno"> 1613</span>&#160;<span class="comment">///</span></div><div class="line"><a name="l01614"></a><span class="lineno"> 1614</span>&#160;<span class="comment">/// For discrete systems it has the form:</span></div><div class="line"><a name="l01615"></a><span class="lineno"> 1615</span>&#160;<span class="comment"></span><span class="comment">/**</span></div><div class="line"><a name="l01616"></a><span class="lineno"> 1616</span>&#160;<span class="comment"> \f[</span></div><div class="line"><a name="l01617"></a><span class="lineno"> 1617</span>&#160;<span class="comment"> x^{(n)}(i) = x^{(n-1)}(i) \sum_{j=0}^{N-1}h(i,j)\frac{y(j)}{\sum_{k=0}^{M-1}h(j,k)x^{(n-1)}(k)} \\</span></div><div class="line"><a name="l01618"></a><span class="lineno"> 1618</span>&#160;<span class="comment"> i \in \left&lt;0,M-1\right&gt;</span></div><div class="line"><a name="l01619"></a><span class="lineno"> 1619</span>&#160;<span class="comment"> \f]</span></div><div class="line"><a name="l01620"></a><span class="lineno"> 1620</span>&#160;<span class="comment">*/</span><span class="comment"></span></div><div class="line"><a name="l01621"></a><span class="lineno"> 1621</span>&#160;<span class="comment">/// for positive input data and response matrix this iterative method forces</span></div><div class="line"><a name="l01622"></a><span class="lineno"> 1622</span>&#160;<span class="comment">/// the deconvoluted spectra to be non-negative. The Richardson-Lucy</span></div><div class="line"><a name="l01623"></a><span class="lineno"> 1623</span>&#160;<span class="comment">/// iteration converges to the maximum likelihood solution for Poisson statistics</span></div><div class="line"><a name="l01624"></a><span class="lineno"> 1624</span>&#160;<span class="comment">/// in the data.</span></div><div class="line"><a name="l01625"></a><span class="lineno"> 1625</span>&#160;<span class="comment">///</span></div><div class="line"><a name="l01626"></a><span class="lineno"> 1626</span>&#160;<span class="comment">/// #### References:</span></div><div class="line"><a name="l01627"></a><span class="lineno"> 1627</span>&#160;<span class="comment">///</span></div><div class="line"><a name="l01628"></a><span class="lineno"> 1628</span>&#160;<span class="comment">///  1. Abreu M.C. et al., A four-dimensional deconvolution method to correct NA38</span></div><div class="line"><a name="l01629"></a><span class="lineno"> 1629</span>&#160;<span class="comment">///     experimental data, NIM A 405 (1998) 139.</span></div><div class="line"><a name="l01630"></a><span class="lineno"> 1630</span>&#160;<span class="comment">///  2. Lucy L.B., A.J. 79 (1974) 745.</span></div><div class="line"><a name="l01631"></a><span class="lineno"> 1631</span>&#160;<span class="comment">///  3. Richardson W.H., J. Opt. Soc. Am. 62 (1972) 55.</span></div><div class="line"><a name="l01632"></a><span class="lineno"> 1632</span>&#160;<span class="comment">///</span></div><div class="line"><a name="l01633"></a><span class="lineno"> 1633</span>&#160;<span class="comment">/// ### Examples of Richardson-Lucy deconvolution method:</span></div><div class="line"><a name="l01634"></a><span class="lineno"> 1634</span>&#160;<span class="comment">///</span></div><div class="line"><a name="l01635"></a><span class="lineno"> 1635</span>&#160;<span class="comment">/// ### Example 11 - script DeconvolutionRL_wide.C :</span></div><div class="line"><a name="l01636"></a><span class="lineno"> 1636</span>&#160;<span class="comment">///</span></div><div class="line"><a name="l01637"></a><span class="lineno"> 1637</span>&#160;<span class="comment">/// When we employ Richardson-Lucy deconvolution algorithm to our data from</span></div><div class="line"><a name="l01638"></a><span class="lineno"> 1638</span>&#160;<span class="comment">/// Fig. 13 we obtain the following result. One can observe improvements</span></div><div class="line"><a name="l01639"></a><span class="lineno"> 1639</span>&#160;<span class="comment">/// as compared to the result achieved by Gold deconvolution. Nevertheless it is</span></div><div class="line"><a name="l01640"></a><span class="lineno"> 1640</span>&#160;<span class="comment">/// unable to decompose the multiplet.</span></div><div class="line"><a name="l01641"></a><span class="lineno"> 1641</span>&#160;<span class="comment">///</span></div><div class="line"><a name="l01642"></a><span class="lineno"> 1642</span>&#160;<span class="comment">/// Example of Richardson-Lucy deconvolution for closely positioned wide peaks.</span></div><div class="line"><a name="l01643"></a><span class="lineno"> 1643</span>&#160;<span class="comment">/// The original source spectrum is drawn with black color, the spectrum after</span></div><div class="line"><a name="l01644"></a><span class="lineno"> 1644</span>&#160;<span class="comment">/// the deconvolution (10000 iterations) with red color.</span></div><div class="line"><a name="l01645"></a><span class="lineno"> 1645</span>&#160;<span class="comment">///</span></div><div class="line"><a name="l01646"></a><span class="lineno"> 1646</span>&#160;<span class="comment">/// Begin_Macro(source)</span></div><div class="line"><a name="l01647"></a><span class="lineno"> 1647</span>&#160;<span class="comment">/// ../../../tutorials/spectrum/DeconvolutionRL_wide.C</span></div><div class="line"><a name="l01648"></a><span class="lineno"> 1648</span>&#160;<span class="comment">/// End_Macro</span></div><div class="line"><a name="l01649"></a><span class="lineno"> 1649</span>&#160;<span class="comment">///</span></div><div class="line"><a name="l01650"></a><span class="lineno"> 1650</span>&#160;<span class="comment">/// ### Example 12 - script DeconvolutionRL_wide_boost.C :</span></div><div class="line"><a name="l01651"></a><span class="lineno"> 1651</span>&#160;<span class="comment">///</span></div><div class="line"><a name="l01652"></a><span class="lineno"> 1652</span>&#160;<span class="comment">/// Further let us employ boosting operation into deconvolution.</span></div><div class="line"><a name="l01653"></a><span class="lineno"> 1653</span>&#160;<span class="comment">///</span></div><div class="line"><a name="l01654"></a><span class="lineno"> 1654</span>&#160;<span class="comment">/// The original source spectrum is drawn with black color, the spectrum after</span></div><div class="line"><a name="l01655"></a><span class="lineno"> 1655</span>&#160;<span class="comment">/// the deconvolution with red color. Number of iterations = 200, number of</span></div><div class="line"><a name="l01656"></a><span class="lineno"> 1656</span>&#160;<span class="comment">/// repetitions = 50 and boosting coefficient = 1.2.</span></div><div class="line"><a name="l01657"></a><span class="lineno"> 1657</span>&#160;<span class="comment">///</span></div><div class="line"><a name="l01658"></a><span class="lineno"> 1658</span>&#160;<span class="comment">/// One can observe improvements in the estimation of peak positions as compared</span></div><div class="line"><a name="l01659"></a><span class="lineno"> 1659</span>&#160;<span class="comment">/// to the results achieved by Gold deconvolution.</span></div><div class="line"><a name="l01660"></a><span class="lineno"> 1660</span>&#160;<span class="comment">///</span></div><div class="line"><a name="l01661"></a><span class="lineno"> 1661</span>&#160;<span class="comment">/// Begin_Macro(source)</span></div><div class="line"><a name="l01662"></a><span class="lineno"> 1662</span>&#160;<span class="comment">/// ../../../tutorials/spectrum/DeconvolutionRL_wide_boost.C</span></div><div class="line"><a name="l01663"></a><span class="lineno"> 1663</span>&#160;<span class="comment">/// End_Macro</span></div><div class="line"><a name="l01664"></a><span class="lineno"> 1664</span>&#160;<span class="comment"></span></div><div class="line"><a name="l01665"></a><span class="lineno"><a class="line" href="classTSpectrum.html#ac0a2c2b867d5e962f93cf4ddd458fe80"> 1665</a></span>&#160;<span class="keyword">const</span> <span class="keywordtype">char</span> *<a class="code" href="classTSpectrum.html#ac0a2c2b867d5e962f93cf4ddd458fe80">TSpectrum::DeconvolutionRL</a>(<a class="code" href="RtypesCore_8h.html#ab9b5334647b78ec4256db251e3ae1fc6">Double_t</a> *source, <span class="keyword">const</span> <a class="code" href="RtypesCore_8h.html#ab9b5334647b78ec4256db251e3ae1fc6">Double_t</a> *response,</div><div class="line"><a name="l01666"></a><span class="lineno"> 1666</span>&#160;                                      <span class="keywordtype">int</span> ssize, <span class="keywordtype">int</span> numberIterations,</div><div class="line"><a name="l01667"></a><span class="lineno"> 1667</span>&#160;                                      <span class="keywordtype">int</span> numberRepetitions, <a class="code" href="RtypesCore_8h.html#ab9b5334647b78ec4256db251e3ae1fc6">Double_t</a> <a class="code" href="namespaceROOT_1_1Math_1_1VectorUtil.html#a421c8e59ccf765d83def701c1ff8fa76">boost</a> )</div><div class="line"><a name="l01668"></a><span class="lineno"> 1668</span>&#160;{</div><div class="line"><a name="l01669"></a><span class="lineno"> 1669</span>&#160;   <span class="keywordflow">if</span> (ssize &lt;= 0)</div><div class="line"><a name="l01670"></a><span class="lineno"> 1670</span>&#160;      <span class="keywordflow">return</span> <span class="stringliteral">&quot;Wrong Parameters&quot;</span>;</div><div class="line"><a name="l01671"></a><span class="lineno"> 1671</span>&#160;</div><div class="line"><a name="l01672"></a><span class="lineno"> 1672</span>&#160;   <span class="keywordflow">if</span> (numberRepetitions &lt;= 0)</div><div class="line"><a name="l01673"></a><span class="lineno"> 1673</span>&#160;      <span class="keywordflow">return</span> <span class="stringliteral">&quot;Wrong Parameters&quot;</span>;</div><div class="line"><a name="l01674"></a><span class="lineno"> 1674</span>&#160;</div><div class="line"><a name="l01675"></a><span class="lineno"> 1675</span>&#160;       <span class="comment">//   working_space-pointer to the working vector</span></div><div class="line"><a name="l01676"></a><span class="lineno"> 1676</span>&#160;       <span class="comment">//   (its size must be 4*ssize of source spectrum)</span></div><div class="line"><a name="l01677"></a><span class="lineno"> 1677</span>&#160;   <a class="code" href="RtypesCore_8h.html#ab9b5334647b78ec4256db251e3ae1fc6">Double_t</a> *working_space = <span class="keyword">new</span> <a class="code" href="RtypesCore_8h.html#ab9b5334647b78ec4256db251e3ae1fc6">Double_t</a>[4 * ssize];</div><div class="line"><a name="l01678"></a><span class="lineno"> 1678</span>&#160;   <span class="keywordtype">int</span> i, j, k, lindex, posit, lh_gold, repet, kmin, kmax;</div><div class="line"><a name="l01679"></a><span class="lineno"> 1679</span>&#160;   <a class="code" href="RtypesCore_8h.html#ab9b5334647b78ec4256db251e3ae1fc6">Double_t</a> lda, ldb, ldc, maximum;</div><div class="line"><a name="l01680"></a><span class="lineno"> 1680</span>&#160;   lh_gold = -1;</div><div class="line"><a name="l01681"></a><span class="lineno"> 1681</span>&#160;   posit = 0;</div><div class="line"><a name="l01682"></a><span class="lineno"> 1682</span>&#160;   maximum = 0;</div><div class="line"><a name="l01683"></a><span class="lineno"> 1683</span>&#160;</div><div class="line"><a name="l01684"></a><span class="lineno"> 1684</span>&#160;<span class="comment">//read response vector</span></div><div class="line"><a name="l01685"></a><span class="lineno"> 1685</span>&#160;   <span class="keywordflow">for</span> (i = 0; i &lt; ssize; i++) {</div><div class="line"><a name="l01686"></a><span class="lineno"> 1686</span>&#160;      lda = response[i];</div><div class="line"><a name="l01687"></a><span class="lineno"> 1687</span>&#160;      <span class="keywordflow">if</span> (lda != 0)</div><div class="line"><a name="l01688"></a><span class="lineno"> 1688</span>&#160;         lh_gold = i + 1;</div><div class="line"><a name="l01689"></a><span class="lineno"> 1689</span>&#160;      working_space[ssize + i] = lda;</div><div class="line"><a name="l01690"></a><span class="lineno"> 1690</span>&#160;      <span class="keywordflow">if</span> (lda &gt; maximum) {</div><div class="line"><a name="l01691"></a><span class="lineno"> 1691</span>&#160;         maximum = lda;</div><div class="line"><a name="l01692"></a><span class="lineno"> 1692</span>&#160;         posit = i;</div><div class="line"><a name="l01693"></a><span class="lineno"> 1693</span>&#160;      }</div><div class="line"><a name="l01694"></a><span class="lineno"> 1694</span>&#160;   }</div><div class="line"><a name="l01695"></a><span class="lineno"> 1695</span>&#160;   <span class="keywordflow">if</span> (lh_gold == -1) {</div><div class="line"><a name="l01696"></a><span class="lineno"> 1696</span>&#160;      <span class="keyword">delete</span> [] working_space;</div><div class="line"><a name="l01697"></a><span class="lineno"> 1697</span>&#160;      <span class="keywordflow">return</span> <span class="stringliteral">&quot;ZERO RESPONSE VECTOR&quot;</span>;</div><div class="line"><a name="l01698"></a><span class="lineno"> 1698</span>&#160;   }</div><div class="line"><a name="l01699"></a><span class="lineno"> 1699</span>&#160;</div><div class="line"><a name="l01700"></a><span class="lineno"> 1700</span>&#160;<span class="comment">//read source vector</span></div><div class="line"><a name="l01701"></a><span class="lineno"> 1701</span>&#160;   <span class="keywordflow">for</span> (i = 0; i &lt; ssize; i++)</div><div class="line"><a name="l01702"></a><span class="lineno"> 1702</span>&#160;      working_space[2 * ssize + i] = source[i];</div><div class="line"><a name="l01703"></a><span class="lineno"> 1703</span>&#160;</div><div class="line"><a name="l01704"></a><span class="lineno"> 1704</span>&#160;<span class="comment">//initialization of resulting vector</span></div><div class="line"><a name="l01705"></a><span class="lineno"> 1705</span>&#160;   <span class="keywordflow">for</span> (i = 0; i &lt; ssize; i++){</div><div class="line"><a name="l01706"></a><span class="lineno"> 1706</span>&#160;      <span class="keywordflow">if</span> (i &lt;= ssize - lh_gold)</div><div class="line"><a name="l01707"></a><span class="lineno"> 1707</span>&#160;         working_space[i] = 1;</div><div class="line"><a name="l01708"></a><span class="lineno"> 1708</span>&#160;</div><div class="line"><a name="l01709"></a><span class="lineno"> 1709</span>&#160;      <span class="keywordflow">else</span></div><div class="line"><a name="l01710"></a><span class="lineno"> 1710</span>&#160;         working_space[i] = 0;</div><div class="line"><a name="l01711"></a><span class="lineno"> 1711</span>&#160;</div><div class="line"><a name="l01712"></a><span class="lineno"> 1712</span>&#160;   }</div><div class="line"><a name="l01713"></a><span class="lineno"> 1713</span>&#160;       <span class="comment">//**START OF ITERATIONS**</span></div><div class="line"><a name="l01714"></a><span class="lineno"> 1714</span>&#160;   <span class="keywordflow">for</span> (repet = 0; repet &lt; numberRepetitions; repet++) {</div><div class="line"><a name="l01715"></a><span class="lineno"> 1715</span>&#160;      <span class="keywordflow">if</span> (repet != 0) {</div><div class="line"><a name="l01716"></a><span class="lineno"> 1716</span>&#160;         <span class="keywordflow">for</span> (i = 0; i &lt; ssize; i++)</div><div class="line"><a name="l01717"></a><span class="lineno"> 1717</span>&#160;            working_space[i] = <a class="code" href="namespaceTMath.html#a9f3bcefa095d69086d20e7b76bc9bfc6">TMath::Power</a>(working_space[i], <a class="code" href="namespaceROOT_1_1Math_1_1VectorUtil.html#a421c8e59ccf765d83def701c1ff8fa76">boost</a>);</div><div class="line"><a name="l01718"></a><span class="lineno"> 1718</span>&#160;      }</div><div class="line"><a name="l01719"></a><span class="lineno"> 1719</span>&#160;      <span class="keywordflow">for</span> (lindex = 0; lindex &lt; numberIterations; lindex++) {</div><div class="line"><a name="l01720"></a><span class="lineno"> 1720</span>&#160;         <span class="keywordflow">for</span> (i = 0; i &lt;= ssize - lh_gold; i++){</div><div class="line"><a name="l01721"></a><span class="lineno"> 1721</span>&#160;            lda = 0;</div><div class="line"><a name="l01722"></a><span class="lineno"> 1722</span>&#160;            <span class="keywordflow">if</span> (working_space[i] &gt; 0){<span class="comment">//x[i]</span></div><div class="line"><a name="l01723"></a><span class="lineno"> 1723</span>&#160;               <span class="keywordflow">for</span> (j = i; j &lt; i + lh_gold; j++){</div><div class="line"><a name="l01724"></a><span class="lineno"> 1724</span>&#160;                  ldb = working_space[2 * ssize + j];<span class="comment">//y[j]</span></div><div class="line"><a name="l01725"></a><span class="lineno"> 1725</span>&#160;                  <span class="keywordflow">if</span> (j &lt; ssize){</div><div class="line"><a name="l01726"></a><span class="lineno"> 1726</span>&#160;                     <span class="keywordflow">if</span> (ldb &gt; 0){<span class="comment">//y[j]</span></div><div class="line"><a name="l01727"></a><span class="lineno"> 1727</span>&#160;                        kmax = j;</div><div class="line"><a name="l01728"></a><span class="lineno"> 1728</span>&#160;                        <span class="keywordflow">if</span> (kmax &gt; lh_gold - 1)</div><div class="line"><a name="l01729"></a><span class="lineno"> 1729</span>&#160;                           kmax = lh_gold - 1;</div><div class="line"><a name="l01730"></a><span class="lineno"> 1730</span>&#160;                        kmin = j + lh_gold - ssize;</div><div class="line"><a name="l01731"></a><span class="lineno"> 1731</span>&#160;                        <span class="keywordflow">if</span> (kmin &lt; 0)</div><div class="line"><a name="l01732"></a><span class="lineno"> 1732</span>&#160;                           kmin = 0;</div><div class="line"><a name="l01733"></a><span class="lineno"> 1733</span>&#160;                        ldc = 0;</div><div class="line"><a name="l01734"></a><span class="lineno"> 1734</span>&#160;                        <span class="keywordflow">for</span> (k = kmax; k &gt;= kmin; k--){</div><div class="line"><a name="l01735"></a><span class="lineno"> 1735</span>&#160;                           ldc += working_space[ssize + k] * working_space[j - k];<span class="comment">//h[k]*x[j-k]</span></div><div class="line"><a name="l01736"></a><span class="lineno"> 1736</span>&#160;                        }</div><div class="line"><a name="l01737"></a><span class="lineno"> 1737</span>&#160;                        <span class="keywordflow">if</span> (ldc &gt; 0)</div><div class="line"><a name="l01738"></a><span class="lineno"> 1738</span>&#160;                           ldb = ldb / ldc;</div><div class="line"><a name="l01739"></a><span class="lineno"> 1739</span>&#160;</div><div class="line"><a name="l01740"></a><span class="lineno"> 1740</span>&#160;                        <span class="keywordflow">else</span></div><div class="line"><a name="l01741"></a><span class="lineno"> 1741</span>&#160;                           ldb = 0;</div><div class="line"><a name="l01742"></a><span class="lineno"> 1742</span>&#160;                     }</div><div class="line"><a name="l01743"></a><span class="lineno"> 1743</span>&#160;                     ldb = ldb * working_space[ssize + j - i];<span class="comment">//y[j]*h[j-i]/suma(h[j][k]x[k])</span></div><div class="line"><a name="l01744"></a><span class="lineno"> 1744</span>&#160;                  }</div><div class="line"><a name="l01745"></a><span class="lineno"> 1745</span>&#160;                  lda += ldb;</div><div class="line"><a name="l01746"></a><span class="lineno"> 1746</span>&#160;               }</div><div class="line"><a name="l01747"></a><span class="lineno"> 1747</span>&#160;               lda = lda * working_space[i];</div><div class="line"><a name="l01748"></a><span class="lineno"> 1748</span>&#160;            }</div><div class="line"><a name="l01749"></a><span class="lineno"> 1749</span>&#160;            working_space[3 * ssize + i] = lda;</div><div class="line"><a name="l01750"></a><span class="lineno"> 1750</span>&#160;         }</div><div class="line"><a name="l01751"></a><span class="lineno"> 1751</span>&#160;         <span class="keywordflow">for</span> (i = 0; i &lt; ssize; i++)</div><div class="line"><a name="l01752"></a><span class="lineno"> 1752</span>&#160;            working_space[i] = working_space[3 * ssize + i];</div><div class="line"><a name="l01753"></a><span class="lineno"> 1753</span>&#160;      }</div><div class="line"><a name="l01754"></a><span class="lineno"> 1754</span>&#160;   }</div><div class="line"><a name="l01755"></a><span class="lineno"> 1755</span>&#160;</div><div class="line"><a name="l01756"></a><span class="lineno"> 1756</span>&#160;<span class="comment">//shift resulting spectrum</span></div><div class="line"><a name="l01757"></a><span class="lineno"> 1757</span>&#160;   <span class="keywordflow">for</span> (i = 0; i &lt; ssize; i++) {</div><div class="line"><a name="l01758"></a><span class="lineno"> 1758</span>&#160;      lda = working_space[i];</div><div class="line"><a name="l01759"></a><span class="lineno"> 1759</span>&#160;      j = i + posit;</div><div class="line"><a name="l01760"></a><span class="lineno"> 1760</span>&#160;      j = j % ssize;</div><div class="line"><a name="l01761"></a><span class="lineno"> 1761</span>&#160;      working_space[ssize + j] = lda;</div><div class="line"><a name="l01762"></a><span class="lineno"> 1762</span>&#160;   }</div><div class="line"><a name="l01763"></a><span class="lineno"> 1763</span>&#160;</div><div class="line"><a name="l01764"></a><span class="lineno"> 1764</span>&#160;<span class="comment">//write back resulting spectrum</span></div><div class="line"><a name="l01765"></a><span class="lineno"> 1765</span>&#160;   <span class="keywordflow">for</span> (i = 0; i &lt; ssize; i++)</div><div class="line"><a name="l01766"></a><span class="lineno"> 1766</span>&#160;      source[i] = working_space[ssize + i];</div><div class="line"><a name="l01767"></a><span class="lineno"> 1767</span>&#160;   <span class="keyword">delete</span>[]working_space;</div><div class="line"><a name="l01768"></a><span class="lineno"> 1768</span>&#160;   <span class="keywordflow">return</span> 0;</div><div class="line"><a name="l01769"></a><span class="lineno"> 1769</span>&#160;}</div><div class="line"><a name="l01770"></a><span class="lineno"> 1770</span>&#160;</div><div class="line"><a name="l01771"></a><span class="lineno"> 1771</span>&#160;<span class="comment"></span></div><div class="line"><a name="l01772"></a><span class="lineno"> 1772</span>&#160;<span class="comment">////////////////////////////////////////////////////////////////////////////////</span></div><div class="line"><a name="l01773"></a><span class="lineno"> 1773</span>&#160;<span class="comment">/// One-dimensional unfolding function</span></div><div class="line"><a name="l01774"></a><span class="lineno"> 1774</span>&#160;<span class="comment">///</span></div><div class="line"><a name="l01775"></a><span class="lineno"> 1775</span>&#160;<span class="comment">/// This function unfolds source spectrum according to response matrix columns.</span></div><div class="line"><a name="l01776"></a><span class="lineno"> 1776</span>&#160;<span class="comment">/// The result is placed in the vector pointed by source pointer.</span></div><div class="line"><a name="l01777"></a><span class="lineno"> 1777</span>&#160;<span class="comment">/// The coefficients of the resulting vector represent contents of the columns</span></div><div class="line"><a name="l01778"></a><span class="lineno"> 1778</span>&#160;<span class="comment">/// (weights) in the input vector. On successful completion it returns 0. On</span></div><div class="line"><a name="l01779"></a><span class="lineno"> 1779</span>&#160;<span class="comment">/// error it returns pointer to the string describing error. If desired after</span></div><div class="line"><a name="l01780"></a><span class="lineno"> 1780</span>&#160;<span class="comment">/// every numberIterations one can apply boosting operation (exponential</span></div><div class="line"><a name="l01781"></a><span class="lineno"> 1781</span>&#160;<span class="comment">/// function with exponent given by boost coefficient) and repeat it</span></div><div class="line"><a name="l01782"></a><span class="lineno"> 1782</span>&#160;<span class="comment">/// numberRepetitions times. For details we refer to [1].</span></div><div class="line"><a name="l01783"></a><span class="lineno"> 1783</span>&#160;<span class="comment">///</span></div><div class="line"><a name="l01784"></a><span class="lineno"> 1784</span>&#160;<span class="comment">/// #### Parameters:</span></div><div class="line"><a name="l01785"></a><span class="lineno"> 1785</span>&#160;<span class="comment">///</span></div><div class="line"><a name="l01786"></a><span class="lineno"> 1786</span>&#160;<span class="comment">///  -  source: pointer to the vector of source spectrum</span></div><div class="line"><a name="l01787"></a><span class="lineno"> 1787</span>&#160;<span class="comment">///  -  respMatrix: pointer to the matrix of response spectra</span></div><div class="line"><a name="l01788"></a><span class="lineno"> 1788</span>&#160;<span class="comment">///  -  ssizex: length of source spectrum and # of rows of the response</span></div><div class="line"><a name="l01789"></a><span class="lineno"> 1789</span>&#160;<span class="comment">///      matrix. ssizex must be &gt;= ssizey.</span></div><div class="line"><a name="l01790"></a><span class="lineno"> 1790</span>&#160;<span class="comment">///  -  ssizey: length of destination coefficients and # of columns of the response</span></div><div class="line"><a name="l01791"></a><span class="lineno"> 1791</span>&#160;<span class="comment">///      matrix.</span></div><div class="line"><a name="l01792"></a><span class="lineno"> 1792</span>&#160;<span class="comment">///  -  numberIterations: number of iterations</span></div><div class="line"><a name="l01793"></a><span class="lineno"> 1793</span>&#160;<span class="comment">///  -  numberRepetitions: number of repetitions for boosted deconvolution.</span></div><div class="line"><a name="l01794"></a><span class="lineno"> 1794</span>&#160;<span class="comment">///      It must be greater or equal to one.</span></div><div class="line"><a name="l01795"></a><span class="lineno"> 1795</span>&#160;<span class="comment">///  -  boost: boosting coefficient, applies only if numberRepetitions is</span></div><div class="line"><a name="l01796"></a><span class="lineno"> 1796</span>&#160;<span class="comment">///      greater than one.</span></div><div class="line"><a name="l01797"></a><span class="lineno"> 1797</span>&#160;<span class="comment">///</span></div><div class="line"><a name="l01798"></a><span class="lineno"> 1798</span>&#160;<span class="comment">/// ### Unfolding:</span></div><div class="line"><a name="l01799"></a><span class="lineno"> 1799</span>&#160;<span class="comment">///</span></div><div class="line"><a name="l01800"></a><span class="lineno"> 1800</span>&#160;<span class="comment">/// The goal is the decomposition of spectrum to a given set of component spectra.</span></div><div class="line"><a name="l01801"></a><span class="lineno"> 1801</span>&#160;<span class="comment">///</span></div><div class="line"><a name="l01802"></a><span class="lineno"> 1802</span>&#160;<span class="comment">/// The mathematical formulation of the discrete linear system is:</span></div><div class="line"><a name="l01803"></a><span class="lineno"> 1803</span>&#160;<span class="comment">///</span></div><div class="line"><a name="l01804"></a><span class="lineno"> 1804</span>&#160;<span class="comment">/// \f[</span></div><div class="line"><a name="l01805"></a><span class="lineno"> 1805</span>&#160;<span class="comment">/// y(i) = \sum_{k=0}^{N_y-1} h(i,k)x(k), i = 0,1,2,...,N_x-1</span></div><div class="line"><a name="l01806"></a><span class="lineno"> 1806</span>&#160;<span class="comment">/// \f]</span></div><div class="line"><a name="l01807"></a><span class="lineno"> 1807</span>&#160;<span class="comment"></span><span class="comment">/**</span></div><div class="line"><a name="l01808"></a><span class="lineno"> 1808</span>&#160;<span class="comment"> \f[</span></div><div class="line"><a name="l01809"></a><span class="lineno"> 1809</span>&#160;<span class="comment"> \begin{bmatrix}</span></div><div class="line"><a name="l01810"></a><span class="lineno"> 1810</span>&#160;<span class="comment">     y(0) \\</span></div><div class="line"><a name="l01811"></a><span class="lineno"> 1811</span>&#160;<span class="comment">     y(1) \\</span></div><div class="line"><a name="l01812"></a><span class="lineno"> 1812</span>&#160;<span class="comment">     \dots \\</span></div><div class="line"><a name="l01813"></a><span class="lineno"> 1813</span>&#160;<span class="comment">     y(N_x-1)</span></div><div class="line"><a name="l01814"></a><span class="lineno"> 1814</span>&#160;<span class="comment"> \end{bmatrix}</span></div><div class="line"><a name="l01815"></a><span class="lineno"> 1815</span>&#160;<span class="comment"> =</span></div><div class="line"><a name="l01816"></a><span class="lineno"> 1816</span>&#160;<span class="comment"> \begin{bmatrix}</span></div><div class="line"><a name="l01817"></a><span class="lineno"> 1817</span>&#160;<span class="comment">     h(0,0)       &amp; h(0,1) &amp; \dots &amp; h(0,N_y-1) \\</span></div><div class="line"><a name="l01818"></a><span class="lineno"> 1818</span>&#160;<span class="comment">     h(1,0)       &amp; h(1,1) &amp; \dots &amp; h(1,N_y-1) \\</span></div><div class="line"><a name="l01819"></a><span class="lineno"> 1819</span>&#160;<span class="comment"> \dots \\</span></div><div class="line"><a name="l01820"></a><span class="lineno"> 1820</span>&#160;<span class="comment">     h(N_x-1,0)   &amp; h(N_x-1,1) &amp; \dots &amp; h(N_x-1,N_y-1)</span></div><div class="line"><a name="l01821"></a><span class="lineno"> 1821</span>&#160;<span class="comment"> \end{bmatrix}</span></div><div class="line"><a name="l01822"></a><span class="lineno"> 1822</span>&#160;<span class="comment"> \begin{bmatrix}</span></div><div class="line"><a name="l01823"></a><span class="lineno"> 1823</span>&#160;<span class="comment">     x(0) \\</span></div><div class="line"><a name="l01824"></a><span class="lineno"> 1824</span>&#160;<span class="comment">     x(1) \\</span></div><div class="line"><a name="l01825"></a><span class="lineno"> 1825</span>&#160;<span class="comment">     \dots \\</span></div><div class="line"><a name="l01826"></a><span class="lineno"> 1826</span>&#160;<span class="comment">     x(N_y-1)</span></div><div class="line"><a name="l01827"></a><span class="lineno"> 1827</span>&#160;<span class="comment"> \end{bmatrix}</span></div><div class="line"><a name="l01828"></a><span class="lineno"> 1828</span>&#160;<span class="comment"> \f]</span></div><div class="line"><a name="l01829"></a><span class="lineno"> 1829</span>&#160;<span class="comment">*/</span><span class="comment"></span></div><div class="line"><a name="l01830"></a><span class="lineno"> 1830</span>&#160;<span class="comment">///</span></div><div class="line"><a name="l01831"></a><span class="lineno"> 1831</span>&#160;<span class="comment">/// #### References:</span></div><div class="line"><a name="l01832"></a><span class="lineno"> 1832</span>&#160;<span class="comment">///</span></div><div class="line"><a name="l01833"></a><span class="lineno"> 1833</span>&#160;<span class="comment">///  1. Jandel M., Morhac; M., Kliman J., Krupa L., Matouoek</span></div><div class="line"><a name="l01834"></a><span class="lineno"> 1834</span>&#160;<span class="comment">///     V., Hamilton J. H., Ramaya A. V.:</span></div><div class="line"><a name="l01835"></a><span class="lineno"> 1835</span>&#160;<span class="comment">///     Decomposition of continuum gamma-ray spectra using synthesised response matrix.</span></div><div class="line"><a name="l01836"></a><span class="lineno"> 1836</span>&#160;<span class="comment">///     NIM A 516 (2004), 172-183.</span></div><div class="line"><a name="l01837"></a><span class="lineno"> 1837</span>&#160;<span class="comment">///</span></div><div class="line"><a name="l01838"></a><span class="lineno"> 1838</span>&#160;<span class="comment">/// ### Example of unfolding:</span></div><div class="line"><a name="l01839"></a><span class="lineno"> 1839</span>&#160;<span class="comment">///</span></div><div class="line"><a name="l01840"></a><span class="lineno"> 1840</span>&#160;<span class="comment">/// ### Example 13 - script Unfolding.C:</span></div><div class="line"><a name="l01841"></a><span class="lineno"> 1841</span>&#160;<span class="comment">///</span></div><div class="line"><a name="l01842"></a><span class="lineno"> 1842</span>&#160;<span class="comment">/// \image html TSpectrum_Unfolding3.gif Fig. 20 Response matrix composed of neutron spectra of pure chemical elements.</span></div><div class="line"><a name="l01843"></a><span class="lineno"> 1843</span>&#160;<span class="comment">/// \image html TSpectrum_Unfolding2.jpg Fig. 21 Source neutron spectrum to be decomposed</span></div><div class="line"><a name="l01844"></a><span class="lineno"> 1844</span>&#160;<span class="comment">/// \image html TSpectrum_Unfolding3.jpg Fig. 22 Spectrum after decomposition, contains 10 coefficients, which correspond to contents of chemical components (dominant 8-th and 10-th components, i.e. O, Si)</span></div><div class="line"><a name="l01845"></a><span class="lineno"> 1845</span>&#160;<span class="comment">///</span></div><div class="line"><a name="l01846"></a><span class="lineno"> 1846</span>&#160;<span class="comment">/// #### Script:</span></div><div class="line"><a name="l01847"></a><span class="lineno"> 1847</span>&#160;<span class="comment">///</span></div><div class="line"><a name="l01848"></a><span class="lineno"> 1848</span>&#160;<span class="comment">/// ~~~ {.cpp}</span></div><div class="line"><a name="l01849"></a><span class="lineno"> 1849</span>&#160;<span class="comment">///  // Example to illustrate unfolding function (class TSpectrum).</span></div><div class="line"><a name="l01850"></a><span class="lineno"> 1850</span>&#160;<span class="comment">///  // To execute this example, do</span></div><div class="line"><a name="l01851"></a><span class="lineno"> 1851</span>&#160;<span class="comment">///  // root &gt; .x Unfolding.C</span></div><div class="line"><a name="l01852"></a><span class="lineno"> 1852</span>&#160;<span class="comment">///</span></div><div class="line"><a name="l01853"></a><span class="lineno"> 1853</span>&#160;<span class="comment">/// void Unfolding() {</span></div><div class="line"><a name="l01854"></a><span class="lineno"> 1854</span>&#160;<span class="comment">///    Int_t i, j;</span></div><div class="line"><a name="l01855"></a><span class="lineno"> 1855</span>&#160;<span class="comment">///    Int_t nbinsx = 2048;</span></div><div class="line"><a name="l01856"></a><span class="lineno"> 1856</span>&#160;<span class="comment">///    Int_t nbinsy = 10;</span></div><div class="line"><a name="l01857"></a><span class="lineno"> 1857</span>&#160;<span class="comment">///    double xmin  = 0;</span></div><div class="line"><a name="l01858"></a><span class="lineno"> 1858</span>&#160;<span class="comment">///    double xmax  = nbinsx;</span></div><div class="line"><a name="l01859"></a><span class="lineno"> 1859</span>&#160;<span class="comment">///    double ymin  = 0;</span></div><div class="line"><a name="l01860"></a><span class="lineno"> 1860</span>&#160;<span class="comment">///    double ymax  = nbinsy;</span></div><div class="line"><a name="l01861"></a><span class="lineno"> 1861</span>&#160;<span class="comment">///    double *source    = new double[nbinsx];</span></div><div class="line"><a name="l01862"></a><span class="lineno"> 1862</span>&#160;<span class="comment">///    double **response = new double *[nbinsy];</span></div><div class="line"><a name="l01863"></a><span class="lineno"> 1863</span>&#160;<span class="comment">///    for (i=0;i&lt;nbinsy;i++) response[i] = new double[nbinsx];</span></div><div class="line"><a name="l01864"></a><span class="lineno"> 1864</span>&#160;<span class="comment">///    TH1F *h = new TH1F(&quot;h&quot;,&quot;&quot;,nbinsx,xmin,xmax);</span></div><div class="line"><a name="l01865"></a><span class="lineno"> 1865</span>&#160;<span class="comment">///    TH1F *d = new TH1F(&quot;d&quot;,&quot;Decomposition - unfolding&quot;,nbinsx,xmin,xmax);</span></div><div class="line"><a name="l01866"></a><span class="lineno"> 1866</span>&#160;<span class="comment">///    TH2F *decon_unf_resp = new TH2F(&quot;decon_unf_resp&quot;,&quot;Root File&quot;,nbinsy,ymin,ymax,nbinsx,xmin,xmax);</span></div><div class="line"><a name="l01867"></a><span class="lineno"> 1867</span>&#160;<span class="comment">///    TFile *f = new TFile(&quot;TSpectrum.root&quot;);</span></div><div class="line"><a name="l01868"></a><span class="lineno"> 1868</span>&#160;<span class="comment">///    h = (TH1F*) f-&gt;Get(&quot;decon_unf_in;1&quot;);</span></div><div class="line"><a name="l01869"></a><span class="lineno"> 1869</span>&#160;<span class="comment">///    TFile *fr = new TFile(&quot;TSpectrum.root&quot;);</span></div><div class="line"><a name="l01870"></a><span class="lineno"> 1870</span>&#160;<span class="comment">///    decon_unf_resp = (TH2F*) fr-&gt;Get(&quot;decon_unf_resp;1&quot;);</span></div><div class="line"><a name="l01871"></a><span class="lineno"> 1871</span>&#160;<span class="comment">///    for (i = 0; i &lt; nbinsx; i++) source[i] = h-&gt;GetBinContent(i + 1);</span></div><div class="line"><a name="l01872"></a><span class="lineno"> 1872</span>&#160;<span class="comment">///    for (i = 0; i &lt; nbinsy; i++){</span></div><div class="line"><a name="l01873"></a><span class="lineno"> 1873</span>&#160;<span class="comment">///       for (j = 0; j&lt; nbinsx; j++){</span></div><div class="line"><a name="l01874"></a><span class="lineno"> 1874</span>&#160;<span class="comment">///          response[i][j] = decon_unf_resp-&gt;GetBinContent(i + 1, j + 1);</span></div><div class="line"><a name="l01875"></a><span class="lineno"> 1875</span>&#160;<span class="comment">///       }</span></div><div class="line"><a name="l01876"></a><span class="lineno"> 1876</span>&#160;<span class="comment">///    }</span></div><div class="line"><a name="l01877"></a><span class="lineno"> 1877</span>&#160;<span class="comment">///    TCanvas *Decon1 = (TCanvas *)gROOT-&gt;GetListOfCanvases()-&gt;FindObject(&quot;Decon1&quot;);</span></div><div class="line"><a name="l01878"></a><span class="lineno"> 1878</span>&#160;<span class="comment">///    if (!Decon1) Decon1 = new TCanvas(&quot;Decon1&quot;,&quot;Decon1&quot;,10,10,1000,700);</span></div><div class="line"><a name="l01879"></a><span class="lineno"> 1879</span>&#160;<span class="comment">///    h-&gt;Draw(&quot;L&quot;);</span></div><div class="line"><a name="l01880"></a><span class="lineno"> 1880</span>&#160;<span class="comment">///    TSpectrum *s = new TSpectrum();</span></div><div class="line"><a name="l01881"></a><span class="lineno"> 1881</span>&#160;<span class="comment">///    s-&gt;Unfolding(source,(const double**)response,nbinsx,nbinsy,1000,1,1);</span></div><div class="line"><a name="l01882"></a><span class="lineno"> 1882</span>&#160;<span class="comment">///    for (i = 0; i &lt; nbinsy; i++) d-&gt;SetBinContent(i + 1,source[i]);</span></div><div class="line"><a name="l01883"></a><span class="lineno"> 1883</span>&#160;<span class="comment">///    d-&gt;SetLineColor(kRed);</span></div><div class="line"><a name="l01884"></a><span class="lineno"> 1884</span>&#160;<span class="comment">///    d-&gt;SetAxisRange(0,nbinsy);</span></div><div class="line"><a name="l01885"></a><span class="lineno"> 1885</span>&#160;<span class="comment">///    d-&gt;Draw(&quot;&quot;);</span></div><div class="line"><a name="l01886"></a><span class="lineno"> 1886</span>&#160;<span class="comment">/// }</span></div><div class="line"><a name="l01887"></a><span class="lineno"> 1887</span>&#160;<span class="comment">/// ~~~</span></div><div class="line"><a name="l01888"></a><span class="lineno"> 1888</span>&#160;<span class="comment"></span></div><div class="line"><a name="l01889"></a><span class="lineno"><a class="line" href="classTSpectrum.html#a2d2ba4e2d371c17fb6804c9959a2d539"> 1889</a></span>&#160;<span class="keyword">const</span> <span class="keywordtype">char</span> *<a class="code" href="classTSpectrum.html#a2d2ba4e2d371c17fb6804c9959a2d539">TSpectrum::Unfolding</a>(<a class="code" href="RtypesCore_8h.html#ab9b5334647b78ec4256db251e3ae1fc6">Double_t</a> *source,</div><div class="line"><a name="l01890"></a><span class="lineno"> 1890</span>&#160;                                 <span class="keyword">const</span> <a class="code" href="RtypesCore_8h.html#ab9b5334647b78ec4256db251e3ae1fc6">Double_t</a> **respMatrix,</div><div class="line"><a name="l01891"></a><span class="lineno"> 1891</span>&#160;                                 <span class="keywordtype">int</span> ssizex, <span class="keywordtype">int</span> ssizey,</div><div class="line"><a name="l01892"></a><span class="lineno"> 1892</span>&#160;                                 <span class="keywordtype">int</span> numberIterations,</div><div class="line"><a name="l01893"></a><span class="lineno"> 1893</span>&#160;                                 <span class="keywordtype">int</span> numberRepetitions, <a class="code" href="RtypesCore_8h.html#ab9b5334647b78ec4256db251e3ae1fc6">Double_t</a> <a class="code" href="namespaceROOT_1_1Math_1_1VectorUtil.html#a421c8e59ccf765d83def701c1ff8fa76">boost</a>)</div><div class="line"><a name="l01894"></a><span class="lineno"> 1894</span>&#160;{</div><div class="line"><a name="l01895"></a><span class="lineno"> 1895</span>&#160;   <span class="keywordtype">int</span> i, j, k, lindex, lhx = 0, repet;</div><div class="line"><a name="l01896"></a><span class="lineno"> 1896</span>&#160;   <a class="code" href="RtypesCore_8h.html#ab9b5334647b78ec4256db251e3ae1fc6">Double_t</a> lda, ldb, ldc, area;</div><div class="line"><a name="l01897"></a><span class="lineno"> 1897</span>&#160;   <span class="keywordflow">if</span> (ssizex &lt;= 0 || ssizey &lt;= 0)</div><div class="line"><a name="l01898"></a><span class="lineno"> 1898</span>&#160;      <span class="keywordflow">return</span> <span class="stringliteral">&quot;Wrong Parameters&quot;</span>;</div><div class="line"><a name="l01899"></a><span class="lineno"> 1899</span>&#160;   <span class="keywordflow">if</span> (ssizex &lt; ssizey)</div><div class="line"><a name="l01900"></a><span class="lineno"> 1900</span>&#160;      <span class="keywordflow">return</span> <span class="stringliteral">&quot;Sizex must be greater than sizey)&quot;</span>;</div><div class="line"><a name="l01901"></a><span class="lineno"> 1901</span>&#160;   <span class="keywordflow">if</span> (numberIterations &lt;= 0)</div><div class="line"><a name="l01902"></a><span class="lineno"> 1902</span>&#160;      <span class="keywordflow">return</span> <span class="stringliteral">&quot;Number of iterations must be positive&quot;</span>;</div><div class="line"><a name="l01903"></a><span class="lineno"> 1903</span>&#160;   <a class="code" href="RtypesCore_8h.html#ab9b5334647b78ec4256db251e3ae1fc6">Double_t</a> *working_space =</div><div class="line"><a name="l01904"></a><span class="lineno"> 1904</span>&#160;       <span class="keyword">new</span> <a class="code" href="RtypesCore_8h.html#ab9b5334647b78ec4256db251e3ae1fc6">Double_t</a>[ssizex * ssizey + 2 * ssizey * ssizey + 4 * ssizex];</div><div class="line"><a name="l01905"></a><span class="lineno"> 1905</span>&#160;</div><div class="line"><a name="l01906"></a><span class="lineno"> 1906</span>&#160;<span class="comment">/*read response matrix*/</span></div><div class="line"><a name="l01907"></a><span class="lineno"> 1907</span>&#160;   <span class="keywordflow">for</span> (j = 0; j &lt; ssizey &amp;&amp; lhx != -1; j++) {</div><div class="line"><a name="l01908"></a><span class="lineno"> 1908</span>&#160;      area = 0;</div><div class="line"><a name="l01909"></a><span class="lineno"> 1909</span>&#160;      lhx = -1;</div><div class="line"><a name="l01910"></a><span class="lineno"> 1910</span>&#160;      <span class="keywordflow">for</span> (i = 0; i &lt; ssizex; i++) {</div><div class="line"><a name="l01911"></a><span class="lineno"> 1911</span>&#160;         lda = respMatrix[j][i];</div><div class="line"><a name="l01912"></a><span class="lineno"> 1912</span>&#160;         <span class="keywordflow">if</span> (lda != 0) {</div><div class="line"><a name="l01913"></a><span class="lineno"> 1913</span>&#160;            lhx = i + 1;</div><div class="line"><a name="l01914"></a><span class="lineno"> 1914</span>&#160;         }</div><div class="line"><a name="l01915"></a><span class="lineno"> 1915</span>&#160;         working_space[j * ssizex + i] = lda;</div><div class="line"><a name="l01916"></a><span class="lineno"> 1916</span>&#160;         area = area + lda;</div><div class="line"><a name="l01917"></a><span class="lineno"> 1917</span>&#160;      }</div><div class="line"><a name="l01918"></a><span class="lineno"> 1918</span>&#160;      <span class="keywordflow">if</span> (lhx != -1) {</div><div class="line"><a name="l01919"></a><span class="lineno"> 1919</span>&#160;         <span class="keywordflow">for</span> (i = 0; i &lt; ssizex; i++)</div><div class="line"><a name="l01920"></a><span class="lineno"> 1920</span>&#160;            working_space[j * ssizex + i] /= area;</div><div class="line"><a name="l01921"></a><span class="lineno"> 1921</span>&#160;      }</div><div class="line"><a name="l01922"></a><span class="lineno"> 1922</span>&#160;   }</div><div class="line"><a name="l01923"></a><span class="lineno"> 1923</span>&#160;   <span class="keywordflow">if</span> (lhx == -1) {</div><div class="line"><a name="l01924"></a><span class="lineno"> 1924</span>&#160;      <span class="keyword">delete</span> [] working_space;</div><div class="line"><a name="l01925"></a><span class="lineno"> 1925</span>&#160;      <span class="keywordflow">return</span> (<span class="stringliteral">&quot;ZERO COLUMN IN RESPONSE MATRIX&quot;</span>);</div><div class="line"><a name="l01926"></a><span class="lineno"> 1926</span>&#160;   }</div><div class="line"><a name="l01927"></a><span class="lineno"> 1927</span>&#160;</div><div class="line"><a name="l01928"></a><span class="lineno"> 1928</span>&#160;<span class="comment">/*read source vector*/</span></div><div class="line"><a name="l01929"></a><span class="lineno"> 1929</span>&#160;   <span class="keywordflow">for</span> (i = 0; i &lt; ssizex; i++)</div><div class="line"><a name="l01930"></a><span class="lineno"> 1930</span>&#160;      working_space[ssizex * ssizey + 2 * ssizey * ssizey + 2 * ssizex + i] =</div><div class="line"><a name="l01931"></a><span class="lineno"> 1931</span>&#160;          source[i];</div><div class="line"><a name="l01932"></a><span class="lineno"> 1932</span>&#160;</div><div class="line"><a name="l01933"></a><span class="lineno"> 1933</span>&#160;<span class="comment">/*create matrix at*a + at*y */</span></div><div class="line"><a name="l01934"></a><span class="lineno"> 1934</span>&#160;   <span class="keywordflow">for</span> (i = 0; i &lt; ssizey; i++) {</div><div class="line"><a name="l01935"></a><span class="lineno"> 1935</span>&#160;      <span class="keywordflow">for</span> (j = 0; j &lt; ssizey; j++) {</div><div class="line"><a name="l01936"></a><span class="lineno"> 1936</span>&#160;         lda = 0;</div><div class="line"><a name="l01937"></a><span class="lineno"> 1937</span>&#160;         <span class="keywordflow">for</span> (k = 0; k &lt; ssizex; k++) {</div><div class="line"><a name="l01938"></a><span class="lineno"> 1938</span>&#160;            ldb = working_space[ssizex * i + k];</div><div class="line"><a name="l01939"></a><span class="lineno"> 1939</span>&#160;            ldc = working_space[ssizex * j + k];</div><div class="line"><a name="l01940"></a><span class="lineno"> 1940</span>&#160;            lda = lda + ldb * ldc;</div><div class="line"><a name="l01941"></a><span class="lineno"> 1941</span>&#160;         }</div><div class="line"><a name="l01942"></a><span class="lineno"> 1942</span>&#160;         working_space[ssizex * ssizey + ssizey * i + j] = lda;</div><div class="line"><a name="l01943"></a><span class="lineno"> 1943</span>&#160;      }</div><div class="line"><a name="l01944"></a><span class="lineno"> 1944</span>&#160;      lda = 0;</div><div class="line"><a name="l01945"></a><span class="lineno"> 1945</span>&#160;      <span class="keywordflow">for</span> (k = 0; k &lt; ssizex; k++) {</div><div class="line"><a name="l01946"></a><span class="lineno"> 1946</span>&#160;         ldb = working_space[ssizex * i + k];</div><div class="line"><a name="l01947"></a><span class="lineno"> 1947</span>&#160;         ldc =</div><div class="line"><a name="l01948"></a><span class="lineno"> 1948</span>&#160;             working_space[ssizex * ssizey + 2 * ssizey * ssizey + 2 * ssizex +</div><div class="line"><a name="l01949"></a><span class="lineno"> 1949</span>&#160;                           k];</div><div class="line"><a name="l01950"></a><span class="lineno"> 1950</span>&#160;         lda = lda + ldb * ldc;</div><div class="line"><a name="l01951"></a><span class="lineno"> 1951</span>&#160;      }</div><div class="line"><a name="l01952"></a><span class="lineno"> 1952</span>&#160;      working_space[ssizex * ssizey + 2 * ssizey * ssizey + 3 * ssizex + i] =</div><div class="line"><a name="l01953"></a><span class="lineno"> 1953</span>&#160;          lda;</div><div class="line"><a name="l01954"></a><span class="lineno"> 1954</span>&#160;   }</div><div class="line"><a name="l01955"></a><span class="lineno"> 1955</span>&#160;</div><div class="line"><a name="l01956"></a><span class="lineno"> 1956</span>&#160;<span class="comment">/*move vector at*y*/</span></div><div class="line"><a name="l01957"></a><span class="lineno"> 1957</span>&#160;   <span class="keywordflow">for</span> (i = 0; i &lt; ssizey; i++)</div><div class="line"><a name="l01958"></a><span class="lineno"> 1958</span>&#160;      working_space[ssizex * ssizey + 2 * ssizey * ssizey + 2 * ssizex + i] =</div><div class="line"><a name="l01959"></a><span class="lineno"> 1959</span>&#160;          working_space[ssizex * ssizey + 2 * ssizey * ssizey + 3 * ssizex + i];</div><div class="line"><a name="l01960"></a><span class="lineno"> 1960</span>&#160;</div><div class="line"><a name="l01961"></a><span class="lineno"> 1961</span>&#160;<span class="comment">/*create matrix at*a*at*a + vector at*a*at*y */</span></div><div class="line"><a name="l01962"></a><span class="lineno"> 1962</span>&#160;   <span class="keywordflow">for</span> (i = 0; i &lt; ssizey; i++) {</div><div class="line"><a name="l01963"></a><span class="lineno"> 1963</span>&#160;      <span class="keywordflow">for</span> (j = 0; j &lt; ssizey; j++) {</div><div class="line"><a name="l01964"></a><span class="lineno"> 1964</span>&#160;         lda = 0;</div><div class="line"><a name="l01965"></a><span class="lineno"> 1965</span>&#160;         <span class="keywordflow">for</span> (k = 0; k &lt; ssizey; k++) {</div><div class="line"><a name="l01966"></a><span class="lineno"> 1966</span>&#160;            ldb = working_space[ssizex * ssizey + ssizey * i + k];</div><div class="line"><a name="l01967"></a><span class="lineno"> 1967</span>&#160;            ldc = working_space[ssizex * ssizey + ssizey * j + k];</div><div class="line"><a name="l01968"></a><span class="lineno"> 1968</span>&#160;            lda = lda + ldb * ldc;</div><div class="line"><a name="l01969"></a><span class="lineno"> 1969</span>&#160;         }</div><div class="line"><a name="l01970"></a><span class="lineno"> 1970</span>&#160;         working_space[ssizex * ssizey + ssizey * ssizey + ssizey * i + j] =</div><div class="line"><a name="l01971"></a><span class="lineno"> 1971</span>&#160;             lda;</div><div class="line"><a name="l01972"></a><span class="lineno"> 1972</span>&#160;      }</div><div class="line"><a name="l01973"></a><span class="lineno"> 1973</span>&#160;      lda = 0;</div><div class="line"><a name="l01974"></a><span class="lineno"> 1974</span>&#160;      <span class="keywordflow">for</span> (k = 0; k &lt; ssizey; k++) {</div><div class="line"><a name="l01975"></a><span class="lineno"> 1975</span>&#160;         ldb = working_space[ssizex * ssizey + ssizey * i + k];</div><div class="line"><a name="l01976"></a><span class="lineno"> 1976</span>&#160;         ldc =</div><div class="line"><a name="l01977"></a><span class="lineno"> 1977</span>&#160;             working_space[ssizex * ssizey + 2 * ssizey * ssizey + 2 * ssizex +</div><div class="line"><a name="l01978"></a><span class="lineno"> 1978</span>&#160;                           k];</div><div class="line"><a name="l01979"></a><span class="lineno"> 1979</span>&#160;         lda = lda + ldb * ldc;</div><div class="line"><a name="l01980"></a><span class="lineno"> 1980</span>&#160;      }</div><div class="line"><a name="l01981"></a><span class="lineno"> 1981</span>&#160;      working_space[ssizex * ssizey + 2 * ssizey * ssizey + 3 * ssizex + i] =</div><div class="line"><a name="l01982"></a><span class="lineno"> 1982</span>&#160;          lda;</div><div class="line"><a name="l01983"></a><span class="lineno"> 1983</span>&#160;   }</div><div class="line"><a name="l01984"></a><span class="lineno"> 1984</span>&#160;</div><div class="line"><a name="l01985"></a><span class="lineno"> 1985</span>&#160;<span class="comment">/*move at*a*at*y*/</span></div><div class="line"><a name="l01986"></a><span class="lineno"> 1986</span>&#160;   <span class="keywordflow">for</span> (i = 0; i &lt; ssizey; i++)</div><div class="line"><a name="l01987"></a><span class="lineno"> 1987</span>&#160;      working_space[ssizex * ssizey + 2 * ssizey * ssizey + 2 * ssizex + i] =</div><div class="line"><a name="l01988"></a><span class="lineno"> 1988</span>&#160;          working_space[ssizex * ssizey + 2 * ssizey * ssizey + 3 * ssizex + i];</div><div class="line"><a name="l01989"></a><span class="lineno"> 1989</span>&#160;</div><div class="line"><a name="l01990"></a><span class="lineno"> 1990</span>&#160;<span class="comment">/*initialization in resulting vector */</span></div><div class="line"><a name="l01991"></a><span class="lineno"> 1991</span>&#160;   <span class="keywordflow">for</span> (i = 0; i &lt; ssizey; i++)</div><div class="line"><a name="l01992"></a><span class="lineno"> 1992</span>&#160;      working_space[ssizex * ssizey + 2 * ssizey * ssizey + i] = 1;</div><div class="line"><a name="l01993"></a><span class="lineno"> 1993</span>&#160;</div><div class="line"><a name="l01994"></a><span class="lineno"> 1994</span>&#160;        <span class="comment">/***START OF ITERATIONS***/</span></div><div class="line"><a name="l01995"></a><span class="lineno"> 1995</span>&#160;   <span class="keywordflow">for</span> (repet = 0; repet &lt; numberRepetitions; repet++) {</div><div class="line"><a name="l01996"></a><span class="lineno"> 1996</span>&#160;      <span class="keywordflow">if</span> (repet != 0) {</div><div class="line"><a name="l01997"></a><span class="lineno"> 1997</span>&#160;         <span class="keywordflow">for</span> (i = 0; i &lt; ssizey; i++)</div><div class="line"><a name="l01998"></a><span class="lineno"> 1998</span>&#160;            working_space[ssizex * ssizey + 2 * ssizey * ssizey + i] = <a class="code" href="namespaceTMath.html#a9f3bcefa095d69086d20e7b76bc9bfc6">TMath::Power</a>(working_space[ssizex * ssizey + 2 * ssizey * ssizey + i], <a class="code" href="namespaceROOT_1_1Math_1_1VectorUtil.html#a421c8e59ccf765d83def701c1ff8fa76">boost</a>);</div><div class="line"><a name="l01999"></a><span class="lineno"> 1999</span>&#160;      }</div><div class="line"><a name="l02000"></a><span class="lineno"> 2000</span>&#160;      <span class="keywordflow">for</span> (lindex = 0; lindex &lt; numberIterations; lindex++) {</div><div class="line"><a name="l02001"></a><span class="lineno"> 2001</span>&#160;         <span class="keywordflow">for</span> (i = 0; i &lt; ssizey; i++) {</div><div class="line"><a name="l02002"></a><span class="lineno"> 2002</span>&#160;            lda = 0;</div><div class="line"><a name="l02003"></a><span class="lineno"> 2003</span>&#160;            <span class="keywordflow">for</span> (j = 0; j &lt; ssizey; j++) {</div><div class="line"><a name="l02004"></a><span class="lineno"> 2004</span>&#160;               ldb =</div><div class="line"><a name="l02005"></a><span class="lineno"> 2005</span>&#160;                   working_space[ssizex * ssizey + ssizey * ssizey + ssizey * i + j];</div><div class="line"><a name="l02006"></a><span class="lineno"> 2006</span>&#160;               ldc = working_space[ssizex * ssizey + 2 * ssizey * ssizey + j];</div><div class="line"><a name="l02007"></a><span class="lineno"> 2007</span>&#160;               lda = lda + ldb * ldc;</div><div class="line"><a name="l02008"></a><span class="lineno"> 2008</span>&#160;            }</div><div class="line"><a name="l02009"></a><span class="lineno"> 2009</span>&#160;            ldb =</div><div class="line"><a name="l02010"></a><span class="lineno"> 2010</span>&#160;                working_space[ssizex * ssizey + 2 * ssizey * ssizey + 2 * ssizex + i];</div><div class="line"><a name="l02011"></a><span class="lineno"> 2011</span>&#160;            <span class="keywordflow">if</span> (lda != 0) {</div><div class="line"><a name="l02012"></a><span class="lineno"> 2012</span>&#160;               lda = ldb / lda;</div><div class="line"><a name="l02013"></a><span class="lineno"> 2013</span>&#160;            }</div><div class="line"><a name="l02014"></a><span class="lineno"> 2014</span>&#160;</div><div class="line"><a name="l02015"></a><span class="lineno"> 2015</span>&#160;            <span class="keywordflow">else</span></div><div class="line"><a name="l02016"></a><span class="lineno"> 2016</span>&#160;               lda = 0;</div><div class="line"><a name="l02017"></a><span class="lineno"> 2017</span>&#160;            ldb = working_space[ssizex * ssizey + 2 * ssizey * ssizey + i];</div><div class="line"><a name="l02018"></a><span class="lineno"> 2018</span>&#160;            lda = lda * ldb;</div><div class="line"><a name="l02019"></a><span class="lineno"> 2019</span>&#160;            working_space[ssizex * ssizey + 2 * ssizey * ssizey + 3 * ssizex + i] = lda;</div><div class="line"><a name="l02020"></a><span class="lineno"> 2020</span>&#160;         }</div><div class="line"><a name="l02021"></a><span class="lineno"> 2021</span>&#160;         <span class="keywordflow">for</span> (i = 0; i &lt; ssizey; i++)</div><div class="line"><a name="l02022"></a><span class="lineno"> 2022</span>&#160;            working_space[ssizex * ssizey + 2 * ssizey * ssizey + i] =</div><div class="line"><a name="l02023"></a><span class="lineno"> 2023</span>&#160;                working_space[ssizex * ssizey + 2 * ssizey * ssizey + 3 * ssizex + i];</div><div class="line"><a name="l02024"></a><span class="lineno"> 2024</span>&#160;      }</div><div class="line"><a name="l02025"></a><span class="lineno"> 2025</span>&#160;   }</div><div class="line"><a name="l02026"></a><span class="lineno"> 2026</span>&#160;</div><div class="line"><a name="l02027"></a><span class="lineno"> 2027</span>&#160;<span class="comment">/*write back resulting spectrum*/</span></div><div class="line"><a name="l02028"></a><span class="lineno"> 2028</span>&#160;   <span class="keywordflow">for</span> (i = 0; i &lt; ssizex; i++) {</div><div class="line"><a name="l02029"></a><span class="lineno"> 2029</span>&#160;      <span class="keywordflow">if</span> (i &lt; ssizey)</div><div class="line"><a name="l02030"></a><span class="lineno"> 2030</span>&#160;         source[i] = working_space[ssizex * ssizey + 2 * ssizey * ssizey + i];</div><div class="line"><a name="l02031"></a><span class="lineno"> 2031</span>&#160;</div><div class="line"><a name="l02032"></a><span class="lineno"> 2032</span>&#160;      <span class="keywordflow">else</span></div><div class="line"><a name="l02033"></a><span class="lineno"> 2033</span>&#160;         source[i] = 0;</div><div class="line"><a name="l02034"></a><span class="lineno"> 2034</span>&#160;   }</div><div class="line"><a name="l02035"></a><span class="lineno"> 2035</span>&#160;   <span class="keyword">delete</span>[]working_space;</div><div class="line"><a name="l02036"></a><span class="lineno"> 2036</span>&#160;   <span class="keywordflow">return</span> 0;</div><div class="line"><a name="l02037"></a><span class="lineno"> 2037</span>&#160;}</div><div class="line"><a name="l02038"></a><span class="lineno"> 2038</span>&#160;</div><div class="line"><a name="l02039"></a><span class="lineno"> 2039</span>&#160;<span class="comment"></span></div><div class="line"><a name="l02040"></a><span class="lineno"> 2040</span>&#160;<span class="comment">////////////////////////////////////////////////////////////////////////////////</span></div><div class="line"><a name="l02041"></a><span class="lineno"> 2041</span>&#160;<span class="comment">/// One-dimensional high-resolution peak search function</span></div><div class="line"><a name="l02042"></a><span class="lineno"> 2042</span>&#160;<span class="comment">///</span></div><div class="line"><a name="l02043"></a><span class="lineno"> 2043</span>&#160;<span class="comment">/// This function searches for peaks in source spectrum. It is based on</span></div><div class="line"><a name="l02044"></a><span class="lineno"> 2044</span>&#160;<span class="comment">/// deconvolution method. First the background is removed (if desired), then</span></div><div class="line"><a name="l02045"></a><span class="lineno"> 2045</span>&#160;<span class="comment">/// Markov smoothed spectrum is calculated (if desired), then the response</span></div><div class="line"><a name="l02046"></a><span class="lineno"> 2046</span>&#160;<span class="comment">/// function is generated according to given sigma and deconvolution is</span></div><div class="line"><a name="l02047"></a><span class="lineno"> 2047</span>&#160;<span class="comment">/// carried out. The order of peaks is arranged according to their heights in</span></div><div class="line"><a name="l02048"></a><span class="lineno"> 2048</span>&#160;<span class="comment">/// the spectrum after background elimination. The highest peak is the first in</span></div><div class="line"><a name="l02049"></a><span class="lineno"> 2049</span>&#160;<span class="comment">/// the list. On success it returns number of found peaks.</span></div><div class="line"><a name="l02050"></a><span class="lineno"> 2050</span>&#160;<span class="comment">///</span></div><div class="line"><a name="l02051"></a><span class="lineno"> 2051</span>&#160;<span class="comment">/// #### Parameters:</span></div><div class="line"><a name="l02052"></a><span class="lineno"> 2052</span>&#160;<span class="comment">///</span></div><div class="line"><a name="l02053"></a><span class="lineno"> 2053</span>&#160;<span class="comment">///  -  source: pointer to the vector of source spectrum.</span></div><div class="line"><a name="l02054"></a><span class="lineno"> 2054</span>&#160;<span class="comment">///  -  destVector: pointer to the vector of resulting deconvolved spectrum.</span></div><div class="line"><a name="l02055"></a><span class="lineno"> 2055</span>&#160;<span class="comment">///  -  ssize: length of source spectrum.</span></div><div class="line"><a name="l02056"></a><span class="lineno"> 2056</span>&#160;<span class="comment">///  -  sigma: sigma of searched peaks, for details we refer to manual.</span></div><div class="line"><a name="l02057"></a><span class="lineno"> 2057</span>&#160;<span class="comment">///  -  threshold: threshold value in % for selected peaks, peaks with</span></div><div class="line"><a name="l02058"></a><span class="lineno"> 2058</span>&#160;<span class="comment">///     amplitude less than threshold*highest_peak/100</span></div><div class="line"><a name="l02059"></a><span class="lineno"> 2059</span>&#160;<span class="comment">///     are ignored, see manual.</span></div><div class="line"><a name="l02060"></a><span class="lineno"> 2060</span>&#160;<span class="comment">///  -  backgroundRemove: logical variable, set if the removal of</span></div><div class="line"><a name="l02061"></a><span class="lineno"> 2061</span>&#160;<span class="comment">///     background before deconvolution is desired.</span></div><div class="line"><a name="l02062"></a><span class="lineno"> 2062</span>&#160;<span class="comment">///  -  deconIterations-number of iterations in deconvolution operation.</span></div><div class="line"><a name="l02063"></a><span class="lineno"> 2063</span>&#160;<span class="comment">///  -  markov: logical variable, if it is true, first the source spectrum</span></div><div class="line"><a name="l02064"></a><span class="lineno"> 2064</span>&#160;<span class="comment">///     is replaced by new spectrum calculated using Markov</span></div><div class="line"><a name="l02065"></a><span class="lineno"> 2065</span>&#160;<span class="comment">///     chains method.</span></div><div class="line"><a name="l02066"></a><span class="lineno"> 2066</span>&#160;<span class="comment">///  -  averWindow: averaging window of searched peaks, for details</span></div><div class="line"><a name="l02067"></a><span class="lineno"> 2067</span>&#160;<span class="comment">///     we refer to manual (applies only for Markov method).</span></div><div class="line"><a name="l02068"></a><span class="lineno"> 2068</span>&#160;<span class="comment">///</span></div><div class="line"><a name="l02069"></a><span class="lineno"> 2069</span>&#160;<span class="comment">/// ### Peaks searching:</span></div><div class="line"><a name="l02070"></a><span class="lineno"> 2070</span>&#160;<span class="comment">///</span></div><div class="line"><a name="l02071"></a><span class="lineno"> 2071</span>&#160;<span class="comment">/// The goal of this function is to identify automatically the peaks in spectrum</span></div><div class="line"><a name="l02072"></a><span class="lineno"> 2072</span>&#160;<span class="comment">/// with the presence of the continuous background and statistical</span></div><div class="line"><a name="l02073"></a><span class="lineno"> 2073</span>&#160;<span class="comment">/// fluctuations - noise.</span></div><div class="line"><a name="l02074"></a><span class="lineno"> 2074</span>&#160;<span class="comment">///</span></div><div class="line"><a name="l02075"></a><span class="lineno"> 2075</span>&#160;<span class="comment">/// The common problems connected with correct peak identification are:</span></div><div class="line"><a name="l02076"></a><span class="lineno"> 2076</span>&#160;<span class="comment">///</span></div><div class="line"><a name="l02077"></a><span class="lineno"> 2077</span>&#160;<span class="comment">///  - non-sensitivity to noise, i.e., only statistically</span></div><div class="line"><a name="l02078"></a><span class="lineno"> 2078</span>&#160;<span class="comment">///    relevant peaks should be identified.</span></div><div class="line"><a name="l02079"></a><span class="lineno"> 2079</span>&#160;<span class="comment">///  - non-sensitivity of the algorithm to continuous</span></div><div class="line"><a name="l02080"></a><span class="lineno"> 2080</span>&#160;<span class="comment">///    background.</span></div><div class="line"><a name="l02081"></a><span class="lineno"> 2081</span>&#160;<span class="comment">///  - ability to identify peaks close to the edges of the</span></div><div class="line"><a name="l02082"></a><span class="lineno"> 2082</span>&#160;<span class="comment">///    spectrum region. Usually peak finders fail to detect them.</span></div><div class="line"><a name="l02083"></a><span class="lineno"> 2083</span>&#160;<span class="comment">///  - resolution, decomposition of Double_tts and multiplets.</span></div><div class="line"><a name="l02084"></a><span class="lineno"> 2084</span>&#160;<span class="comment">///    The algorithm should be able to recognise close positioned peaks.</span></div><div class="line"><a name="l02085"></a><span class="lineno"> 2085</span>&#160;<span class="comment">///  - ability to identify peaks with different sigma.</span></div><div class="line"><a name="l02086"></a><span class="lineno"> 2086</span>&#160;<span class="comment">///</span></div><div class="line"><a name="l02087"></a><span class="lineno"> 2087</span>&#160;<span class="comment">/// \image html TSpectrum_Searching1.jpg Fig. 27 An example of one-dimensional synthetic spectrum with found peaks denoted by markers.</span></div><div class="line"><a name="l02088"></a><span class="lineno"> 2088</span>&#160;<span class="comment">///</span></div><div class="line"><a name="l02089"></a><span class="lineno"> 2089</span>&#160;<span class="comment">/// #### References:</span></div><div class="line"><a name="l02090"></a><span class="lineno"> 2090</span>&#160;<span class="comment">///</span></div><div class="line"><a name="l02091"></a><span class="lineno"> 2091</span>&#160;<span class="comment">///  1. M.A. Mariscotti: A method for identification of peaks in the presence of</span></div><div class="line"><a name="l02092"></a><span class="lineno"> 2092</span>&#160;<span class="comment">///     background and its application to spectrum analysis. NIM 50 (1967),</span></div><div class="line"><a name="l02093"></a><span class="lineno"> 2093</span>&#160;<span class="comment">///     309-320.</span></div><div class="line"><a name="l02094"></a><span class="lineno"> 2094</span>&#160;<span class="comment">///  2. M. Morhac;, J. Kliman, V.  Matouoek, M. Veselsky,</span></div><div class="line"><a name="l02095"></a><span class="lineno"> 2095</span>&#160;<span class="comment">///     I. Turzo.:Identification of peaks in</span></div><div class="line"><a name="l02096"></a><span class="lineno"> 2096</span>&#160;<span class="comment">///     multidimensional coincidence gamma-ray spectra. NIM, A443 (2000) 108-125.</span></div><div class="line"><a name="l02097"></a><span class="lineno"> 2097</span>&#160;<span class="comment">///  3. Z.K. Silagadze, A new algorithm for automatic photopeak searches. NIM</span></div><div class="line"><a name="l02098"></a><span class="lineno"> 2098</span>&#160;<span class="comment">///     A 376 (1996), 451.</span></div><div class="line"><a name="l02099"></a><span class="lineno"> 2099</span>&#160;<span class="comment">///</span></div><div class="line"><a name="l02100"></a><span class="lineno"> 2100</span>&#160;<span class="comment">/// Examples of peak searching method:</span></div><div class="line"><a name="l02101"></a><span class="lineno"> 2101</span>&#160;<span class="comment">///</span></div><div class="line"><a name="l02102"></a><span class="lineno"> 2102</span>&#160;<span class="comment">/// The SearchHighRes function provides users with the possibility to vary the</span></div><div class="line"><a name="l02103"></a><span class="lineno"> 2103</span>&#160;<span class="comment">/// input parameters and with the access to the output deconvolved data in the</span></div><div class="line"><a name="l02104"></a><span class="lineno"> 2104</span>&#160;<span class="comment">/// destination spectrum. Based on the output data one can tune the parameters.</span></div><div class="line"><a name="l02105"></a><span class="lineno"> 2105</span>&#160;<span class="comment">///</span></div><div class="line"><a name="l02106"></a><span class="lineno"> 2106</span>&#160;<span class="comment">/// ### Example 15 - script SearchHR1.C:</span></div><div class="line"><a name="l02107"></a><span class="lineno"> 2107</span>&#160;<span class="comment">///</span></div><div class="line"><a name="l02108"></a><span class="lineno"> 2108</span>&#160;<span class="comment">/// One-dimensional spectrum with found peaks denoted by markers, 3 iterations</span></div><div class="line"><a name="l02109"></a><span class="lineno"> 2109</span>&#160;<span class="comment">/// steps in the deconvolution.</span></div><div class="line"><a name="l02110"></a><span class="lineno"> 2110</span>&#160;<span class="comment">///</span></div><div class="line"><a name="l02111"></a><span class="lineno"> 2111</span>&#160;<span class="comment">/// #### Script:</span></div><div class="line"><a name="l02112"></a><span class="lineno"> 2112</span>&#160;<span class="comment">///</span></div><div class="line"><a name="l02113"></a><span class="lineno"> 2113</span>&#160;<span class="comment">/// Begin_Macro(source)</span></div><div class="line"><a name="l02114"></a><span class="lineno"> 2114</span>&#160;<span class="comment">/// ../../../tutorials/spectrum/SearchHR1.C</span></div><div class="line"><a name="l02115"></a><span class="lineno"> 2115</span>&#160;<span class="comment">/// End_Macro</span></div><div class="line"><a name="l02116"></a><span class="lineno"> 2116</span>&#160;<span class="comment">///</span></div><div class="line"><a name="l02117"></a><span class="lineno"> 2117</span>&#160;<span class="comment">/// ### Example 16 - script SearchHR3.C:</span></div><div class="line"><a name="l02118"></a><span class="lineno"> 2118</span>&#160;<span class="comment">///</span></div><div class="line"><a name="l02119"></a><span class="lineno"> 2119</span>&#160;<span class="comment">/// Influence of number of iterations (3-red, 10-blue, 100- green, 1000-magenta),</span></div><div class="line"><a name="l02120"></a><span class="lineno"> 2120</span>&#160;<span class="comment">/// sigma=8, smoothing width=3.</span></div><div class="line"><a name="l02121"></a><span class="lineno"> 2121</span>&#160;<span class="comment">///</span></div><div class="line"><a name="l02122"></a><span class="lineno"> 2122</span>&#160;<span class="comment">/// Begin_Macro(source)</span></div><div class="line"><a name="l02123"></a><span class="lineno"> 2123</span>&#160;<span class="comment">/// ../../../tutorials/spectrum/SearchHR3.C</span></div><div class="line"><a name="l02124"></a><span class="lineno"> 2124</span>&#160;<span class="comment">/// End_Macro</span></div><div class="line"><a name="l02125"></a><span class="lineno"> 2125</span>&#160;<span class="comment"></span></div><div class="line"><a name="l02126"></a><span class="lineno"><a class="line" href="classTSpectrum.html#a5ba181a45b117934b48c4ef5f78d0b2b"> 2126</a></span>&#160;<a class="code" href="RtypesCore_8h.html#a3885b911a54b47a4e61671f45dd45d0b">Int_t</a> <a class="code" href="classTSpectrum.html#a5ba181a45b117934b48c4ef5f78d0b2b">TSpectrum::SearchHighRes</a>(<a class="code" href="RtypesCore_8h.html#ab9b5334647b78ec4256db251e3ae1fc6">Double_t</a> *source,<a class="code" href="RtypesCore_8h.html#ab9b5334647b78ec4256db251e3ae1fc6">Double_t</a> *destVector, <span class="keywordtype">int</span> ssize,</div><div class="line"><a name="l02127"></a><span class="lineno"> 2127</span>&#160;                                     <a class="code" href="RtypesCore_8h.html#ab9b5334647b78ec4256db251e3ae1fc6">Double_t</a> <a class="code" href="h1analysisProxy_8h.html#a351c2b9335dfcbe83de6eb9629c2a0e3">sigma</a>, <a class="code" href="RtypesCore_8h.html#ab9b5334647b78ec4256db251e3ae1fc6">Double_t</a> threshold,</div><div class="line"><a name="l02128"></a><span class="lineno"> 2128</span>&#160;                                     <span class="keywordtype">bool</span> backgroundRemove,<span class="keywordtype">int</span> deconIterations,</div><div class="line"><a name="l02129"></a><span class="lineno"> 2129</span>&#160;                                     <span class="keywordtype">bool</span> markov, <span class="keywordtype">int</span> averWindow)</div><div class="line"><a name="l02130"></a><span class="lineno"> 2130</span>&#160;{</div><div class="line"><a name="l02131"></a><span class="lineno"> 2131</span>&#160;   <span class="keywordtype">int</span> i, j, numberIterations = (<a class="code" href="RtypesCore_8h.html#a3885b911a54b47a4e61671f45dd45d0b">Int_t</a>)(7 * <a class="code" href="h1analysisProxy_8h.html#a351c2b9335dfcbe83de6eb9629c2a0e3">sigma</a> + 0.5);</div><div class="line"><a name="l02132"></a><span class="lineno"> 2132</span>&#160;   <a class="code" href="RtypesCore_8h.html#ab9b5334647b78ec4256db251e3ae1fc6">Double_t</a> <a class="code" href="textangle_8C.html#a655a1c2a1ec25e8fcfb713772281e8f5">a</a>, <a class="code" href="TRolke_8cxx.html#a1a2354f40e332ad13673b70afc2c0dbf">b</a>, <a class="code" href="RSha256_8hxx.html#a63f410abde93141c9013b7d3f3971738">c</a>;</div><div class="line"><a name="l02133"></a><span class="lineno"> 2133</span>&#160;   <span class="keywordtype">int</span> k, lindex, posit, imin, imax, jmin, jmax, lh_gold, priz;</div><div class="line"><a name="l02134"></a><span class="lineno"> 2134</span>&#160;   <a class="code" href="RtypesCore_8h.html#ab9b5334647b78ec4256db251e3ae1fc6">Double_t</a> lda, ldb, ldc, area, maximum, maximum_decon;</div><div class="line"><a name="l02135"></a><span class="lineno"> 2135</span>&#160;   <span class="keywordtype">int</span> <a class="code" href="THbookFile_8cxx.html#a058f249a5e6d20724cb0784b40a183e8">xmin</a>, <a class="code" href="THbookFile_8cxx.html#a9c42f51718ed192ed1841a53d2b0e507">xmax</a>, <a class="code" href="textangle_8C.html#a3359d7f1aa9fe2f8bc884b02020e8d20">l</a>, peak_index = 0, size_ext = ssize + 2 * numberIterations, shift = numberIterations, bw = 2, w;</div><div class="line"><a name="l02136"></a><span class="lineno"> 2136</span>&#160;   <a class="code" href="RtypesCore_8h.html#ab9b5334647b78ec4256db251e3ae1fc6">Double_t</a> maxch;</div><div class="line"><a name="l02137"></a><span class="lineno"> 2137</span>&#160;   <a class="code" href="RtypesCore_8h.html#ab9b5334647b78ec4256db251e3ae1fc6">Double_t</a> nom, nip, nim, sp, sm, plocha = 0;</div><div class="line"><a name="l02138"></a><span class="lineno"> 2138</span>&#160;   <a class="code" href="RtypesCore_8h.html#ab9b5334647b78ec4256db251e3ae1fc6">Double_t</a> m0low=0,m1low=0,m2low=0,l0low=0,l1low=0,detlow,av,men;</div><div class="line"><a name="l02139"></a><span class="lineno"> 2139</span>&#160;   <span class="keywordflow">if</span> (<a class="code" href="h1analysisProxy_8h.html#a351c2b9335dfcbe83de6eb9629c2a0e3">sigma</a> &lt; 1) {</div><div class="line"><a name="l02140"></a><span class="lineno"> 2140</span>&#160;      <a class="code" href="classTObject.html#abe1fb206304cfa1b8d1e77a4a4fd0120">Error</a>(<span class="stringliteral">&quot;SearchHighRes&quot;</span>, <span class="stringliteral">&quot;Invalid sigma, must be greater than or equal to 1&quot;</span>);</div><div class="line"><a name="l02141"></a><span class="lineno"> 2141</span>&#160;      <span class="keywordflow">return</span> 0;</div><div class="line"><a name="l02142"></a><span class="lineno"> 2142</span>&#160;   }</div><div class="line"><a name="l02143"></a><span class="lineno"> 2143</span>&#160;</div><div class="line"><a name="l02144"></a><span class="lineno"> 2144</span>&#160;   <span class="keywordflow">if</span>(threshold&lt;=0 || threshold&gt;=100){</div><div class="line"><a name="l02145"></a><span class="lineno"> 2145</span>&#160;      <a class="code" href="classTObject.html#abe1fb206304cfa1b8d1e77a4a4fd0120">Error</a>(<span class="stringliteral">&quot;SearchHighRes&quot;</span>, <span class="stringliteral">&quot;Invalid threshold, must be positive and less than 100&quot;</span>);</div><div class="line"><a name="l02146"></a><span class="lineno"> 2146</span>&#160;      <span class="keywordflow">return</span> 0;</div><div class="line"><a name="l02147"></a><span class="lineno"> 2147</span>&#160;   }</div><div class="line"><a name="l02148"></a><span class="lineno"> 2148</span>&#160;</div><div class="line"><a name="l02149"></a><span class="lineno"> 2149</span>&#160;   j = (<a class="code" href="RtypesCore_8h.html#a3885b911a54b47a4e61671f45dd45d0b">Int_t</a>) (5.0 * <a class="code" href="h1analysisProxy_8h.html#a351c2b9335dfcbe83de6eb9629c2a0e3">sigma</a> + 0.5);</div><div class="line"><a name="l02150"></a><span class="lineno"> 2150</span>&#160;   <span class="keywordflow">if</span> (j &gt;= <a class="code" href="TSpectrum_8cxx.html#ade09a69507390390f0d1bd5b7d91826c">PEAK_WINDOW</a> / 2) {</div><div class="line"><a name="l02151"></a><span class="lineno"> 2151</span>&#160;      <a class="code" href="classTObject.html#abe1fb206304cfa1b8d1e77a4a4fd0120">Error</a>(<span class="stringliteral">&quot;SearchHighRes&quot;</span>, <span class="stringliteral">&quot;Too large sigma&quot;</span>);</div><div class="line"><a name="l02152"></a><span class="lineno"> 2152</span>&#160;      <span class="keywordflow">return</span> 0;</div><div class="line"><a name="l02153"></a><span class="lineno"> 2153</span>&#160;   }</div><div class="line"><a name="l02154"></a><span class="lineno"> 2154</span>&#160;</div><div class="line"><a name="l02155"></a><span class="lineno"> 2155</span>&#160;   <span class="keywordflow">if</span> (markov == <span class="keyword">true</span>) {</div><div class="line"><a name="l02156"></a><span class="lineno"> 2156</span>&#160;      <span class="keywordflow">if</span> (averWindow &lt;= 0) {</div><div class="line"><a name="l02157"></a><span class="lineno"> 2157</span>&#160;         <a class="code" href="classTObject.html#abe1fb206304cfa1b8d1e77a4a4fd0120">Error</a>(<span class="stringliteral">&quot;SearchHighRes&quot;</span>, <span class="stringliteral">&quot;Averaging window must be positive&quot;</span>);</div><div class="line"><a name="l02158"></a><span class="lineno"> 2158</span>&#160;         <span class="keywordflow">return</span> 0;</div><div class="line"><a name="l02159"></a><span class="lineno"> 2159</span>&#160;      }</div><div class="line"><a name="l02160"></a><span class="lineno"> 2160</span>&#160;   }</div><div class="line"><a name="l02161"></a><span class="lineno"> 2161</span>&#160;</div><div class="line"><a name="l02162"></a><span class="lineno"> 2162</span>&#160;   <span class="keywordflow">if</span>(backgroundRemove == <span class="keyword">true</span>){</div><div class="line"><a name="l02163"></a><span class="lineno"> 2163</span>&#160;      <span class="keywordflow">if</span>(ssize &lt; 2 * numberIterations + 1){</div><div class="line"><a name="l02164"></a><span class="lineno"> 2164</span>&#160;         <a class="code" href="classTObject.html#abe1fb206304cfa1b8d1e77a4a4fd0120">Error</a>(<span class="stringliteral">&quot;SearchHighRes&quot;</span>, <span class="stringliteral">&quot;Too large clipping window&quot;</span>);</div><div class="line"><a name="l02165"></a><span class="lineno"> 2165</span>&#160;         <span class="keywordflow">return</span> 0;</div><div class="line"><a name="l02166"></a><span class="lineno"> 2166</span>&#160;      }</div><div class="line"><a name="l02167"></a><span class="lineno"> 2167</span>&#160;   }</div><div class="line"><a name="l02168"></a><span class="lineno"> 2168</span>&#160;</div><div class="line"><a name="l02169"></a><span class="lineno"> 2169</span>&#160;   k = int(2 * <a class="code" href="h1analysisProxy_8h.html#a351c2b9335dfcbe83de6eb9629c2a0e3">sigma</a>+0.5);</div><div class="line"><a name="l02170"></a><span class="lineno"> 2170</span>&#160;   <span class="keywordflow">if</span>(k &gt;= 2){</div><div class="line"><a name="l02171"></a><span class="lineno"> 2171</span>&#160;      <span class="keywordflow">for</span>(i = 0;i &lt; k;i++){</div><div class="line"><a name="l02172"></a><span class="lineno"> 2172</span>&#160;         <a class="code" href="textangle_8C.html#a655a1c2a1ec25e8fcfb713772281e8f5">a</a> = i,<a class="code" href="TRolke_8cxx.html#a1a2354f40e332ad13673b70afc2c0dbf">b</a> = source[i];</div><div class="line"><a name="l02173"></a><span class="lineno"> 2173</span>&#160;         m0low += 1,m1low += <a class="code" href="textangle_8C.html#a655a1c2a1ec25e8fcfb713772281e8f5">a</a>,m2low += <a class="code" href="textangle_8C.html#a655a1c2a1ec25e8fcfb713772281e8f5">a</a> * <a class="code" href="textangle_8C.html#a655a1c2a1ec25e8fcfb713772281e8f5">a</a>,l0low += <a class="code" href="TRolke_8cxx.html#a1a2354f40e332ad13673b70afc2c0dbf">b</a>,l1low += <a class="code" href="textangle_8C.html#a655a1c2a1ec25e8fcfb713772281e8f5">a</a> * <a class="code" href="TRolke_8cxx.html#a1a2354f40e332ad13673b70afc2c0dbf">b</a>;</div><div class="line"><a name="l02174"></a><span class="lineno"> 2174</span>&#160;      }</div><div class="line"><a name="l02175"></a><span class="lineno"> 2175</span>&#160;      detlow = m0low * m2low - m1low * m1low;</div><div class="line"><a name="l02176"></a><span class="lineno"> 2176</span>&#160;      <span class="keywordflow">if</span>(detlow != 0)</div><div class="line"><a name="l02177"></a><span class="lineno"> 2177</span>&#160;         l1low = (-l0low * m1low + l1low * m0low) / detlow;</div><div class="line"><a name="l02178"></a><span class="lineno"> 2178</span>&#160;</div><div class="line"><a name="l02179"></a><span class="lineno"> 2179</span>&#160;      <span class="keywordflow">else</span></div><div class="line"><a name="l02180"></a><span class="lineno"> 2180</span>&#160;         l1low = 0;</div><div class="line"><a name="l02181"></a><span class="lineno"> 2181</span>&#160;      <span class="keywordflow">if</span>(l1low &gt; 0)</div><div class="line"><a name="l02182"></a><span class="lineno"> 2182</span>&#160;         l1low=0;</div><div class="line"><a name="l02183"></a><span class="lineno"> 2183</span>&#160;   }</div><div class="line"><a name="l02184"></a><span class="lineno"> 2184</span>&#160;</div><div class="line"><a name="l02185"></a><span class="lineno"> 2185</span>&#160;   <span class="keywordflow">else</span>{</div><div class="line"><a name="l02186"></a><span class="lineno"> 2186</span>&#160;      l1low = 0;</div><div class="line"><a name="l02187"></a><span class="lineno"> 2187</span>&#160;   }</div><div class="line"><a name="l02188"></a><span class="lineno"> 2188</span>&#160;</div><div class="line"><a name="l02189"></a><span class="lineno"> 2189</span>&#160;   i = (<a class="code" href="RtypesCore_8h.html#a3885b911a54b47a4e61671f45dd45d0b">Int_t</a>)(7 * <a class="code" href="h1analysisProxy_8h.html#a351c2b9335dfcbe83de6eb9629c2a0e3">sigma</a> + 0.5);</div><div class="line"><a name="l02190"></a><span class="lineno"> 2190</span>&#160;   i = 2 * i;</div><div class="line"><a name="l02191"></a><span class="lineno"> 2191</span>&#160;   <a class="code" href="RtypesCore_8h.html#ab9b5334647b78ec4256db251e3ae1fc6">Double_t</a> *working_space = <span class="keyword">new</span> <a class="code" href="RtypesCore_8h.html#ab9b5334647b78ec4256db251e3ae1fc6">Double_t</a> [7 * (ssize + i)];</div><div class="line"><a name="l02192"></a><span class="lineno"> 2192</span>&#160;   <span class="keywordflow">for</span> (j=0;j&lt;7 * (ssize + i);j++) working_space[j] = 0;</div><div class="line"><a name="l02193"></a><span class="lineno"> 2193</span>&#160;   <span class="keywordflow">for</span>(i = 0; i &lt; size_ext; i++){</div><div class="line"><a name="l02194"></a><span class="lineno"> 2194</span>&#160;      <span class="keywordflow">if</span>(i &lt; shift){</div><div class="line"><a name="l02195"></a><span class="lineno"> 2195</span>&#160;         <a class="code" href="textangle_8C.html#a655a1c2a1ec25e8fcfb713772281e8f5">a</a> = i - shift;</div><div class="line"><a name="l02196"></a><span class="lineno"> 2196</span>&#160;         working_space[i + size_ext] = source[0] + l1low * <a class="code" href="textangle_8C.html#a655a1c2a1ec25e8fcfb713772281e8f5">a</a>;</div><div class="line"><a name="l02197"></a><span class="lineno"> 2197</span>&#160;         <span class="keywordflow">if</span>(working_space[i + size_ext] &lt; 0)</div><div class="line"><a name="l02198"></a><span class="lineno"> 2198</span>&#160;            working_space[i + size_ext]=0;</div><div class="line"><a name="l02199"></a><span class="lineno"> 2199</span>&#160;      }</div><div class="line"><a name="l02200"></a><span class="lineno"> 2200</span>&#160;</div><div class="line"><a name="l02201"></a><span class="lineno"> 2201</span>&#160;      <span class="keywordflow">else</span> <span class="keywordflow">if</span>(i &gt;= ssize + shift){</div><div class="line"><a name="l02202"></a><span class="lineno"> 2202</span>&#160;         <a class="code" href="textangle_8C.html#a655a1c2a1ec25e8fcfb713772281e8f5">a</a> = i - (ssize - 1 + shift);</div><div class="line"><a name="l02203"></a><span class="lineno"> 2203</span>&#160;         working_space[i + size_ext] = source[ssize - 1];</div><div class="line"><a name="l02204"></a><span class="lineno"> 2204</span>&#160;         <span class="keywordflow">if</span>(working_space[i + size_ext] &lt; 0)</div><div class="line"><a name="l02205"></a><span class="lineno"> 2205</span>&#160;            working_space[i + size_ext]=0;</div><div class="line"><a name="l02206"></a><span class="lineno"> 2206</span>&#160;      }</div><div class="line"><a name="l02207"></a><span class="lineno"> 2207</span>&#160;</div><div class="line"><a name="l02208"></a><span class="lineno"> 2208</span>&#160;      <span class="keywordflow">else</span></div><div class="line"><a name="l02209"></a><span class="lineno"> 2209</span>&#160;         working_space[i + size_ext] = source[i - shift];</div><div class="line"><a name="l02210"></a><span class="lineno"> 2210</span>&#160;   }</div><div class="line"><a name="l02211"></a><span class="lineno"> 2211</span>&#160;</div><div class="line"><a name="l02212"></a><span class="lineno"> 2212</span>&#160;   <span class="keywordflow">if</span>(backgroundRemove == <span class="keyword">true</span>){</div><div class="line"><a name="l02213"></a><span class="lineno"> 2213</span>&#160;      <span class="keywordflow">for</span>(i = 1; i &lt;= numberIterations; i++){</div><div class="line"><a name="l02214"></a><span class="lineno"> 2214</span>&#160;         <span class="keywordflow">for</span>(j = i; j &lt; size_ext - i; j++){</div><div class="line"><a name="l02215"></a><span class="lineno"> 2215</span>&#160;            <span class="keywordflow">if</span>(markov == <span class="keyword">false</span>){</div><div class="line"><a name="l02216"></a><span class="lineno"> 2216</span>&#160;               <a class="code" href="textangle_8C.html#a655a1c2a1ec25e8fcfb713772281e8f5">a</a> = working_space[size_ext + j];</div><div class="line"><a name="l02217"></a><span class="lineno"> 2217</span>&#160;               <a class="code" href="TRolke_8cxx.html#a1a2354f40e332ad13673b70afc2c0dbf">b</a> = (working_space[size_ext + j - i] + working_space[size_ext + j + i]) / 2.0;</div><div class="line"><a name="l02218"></a><span class="lineno"> 2218</span>&#160;               <span class="keywordflow">if</span>(<a class="code" href="TRolke_8cxx.html#a1a2354f40e332ad13673b70afc2c0dbf">b</a> &lt; <a class="code" href="textangle_8C.html#a655a1c2a1ec25e8fcfb713772281e8f5">a</a>)</div><div class="line"><a name="l02219"></a><span class="lineno"> 2219</span>&#160;                  <a class="code" href="textangle_8C.html#a655a1c2a1ec25e8fcfb713772281e8f5">a</a> = <a class="code" href="TRolke_8cxx.html#a1a2354f40e332ad13673b70afc2c0dbf">b</a>;</div><div class="line"><a name="l02220"></a><span class="lineno"> 2220</span>&#160;</div><div class="line"><a name="l02221"></a><span class="lineno"> 2221</span>&#160;               working_space[j]=<a class="code" href="textangle_8C.html#a655a1c2a1ec25e8fcfb713772281e8f5">a</a>;</div><div class="line"><a name="l02222"></a><span class="lineno"> 2222</span>&#160;            }</div><div class="line"><a name="l02223"></a><span class="lineno"> 2223</span>&#160;</div><div class="line"><a name="l02224"></a><span class="lineno"> 2224</span>&#160;            <span class="keywordflow">else</span>{</div><div class="line"><a name="l02225"></a><span class="lineno"> 2225</span>&#160;               <a class="code" href="textangle_8C.html#a655a1c2a1ec25e8fcfb713772281e8f5">a</a> = working_space[size_ext + j];</div><div class="line"><a name="l02226"></a><span class="lineno"> 2226</span>&#160;               av = 0;</div><div class="line"><a name="l02227"></a><span class="lineno"> 2227</span>&#160;               men = 0;</div><div class="line"><a name="l02228"></a><span class="lineno"> 2228</span>&#160;               <span class="keywordflow">for</span> (w = j - bw; w &lt;= j + bw; w++){</div><div class="line"><a name="l02229"></a><span class="lineno"> 2229</span>&#160;                  <span class="keywordflow">if</span> ( w &gt;= 0 &amp;&amp; w &lt; size_ext){</div><div class="line"><a name="l02230"></a><span class="lineno"> 2230</span>&#160;                     av += working_space[size_ext + w];</div><div class="line"><a name="l02231"></a><span class="lineno"> 2231</span>&#160;                     men +=1;</div><div class="line"><a name="l02232"></a><span class="lineno"> 2232</span>&#160;                  }</div><div class="line"><a name="l02233"></a><span class="lineno"> 2233</span>&#160;               }</div><div class="line"><a name="l02234"></a><span class="lineno"> 2234</span>&#160;               av = av / men;</div><div class="line"><a name="l02235"></a><span class="lineno"> 2235</span>&#160;               <a class="code" href="TRolke_8cxx.html#a1a2354f40e332ad13673b70afc2c0dbf">b</a> = 0;</div><div class="line"><a name="l02236"></a><span class="lineno"> 2236</span>&#160;               men = 0;</div><div class="line"><a name="l02237"></a><span class="lineno"> 2237</span>&#160;               <span class="keywordflow">for</span> (w = j - i - bw; w &lt;= j - i + bw; w++){</div><div class="line"><a name="l02238"></a><span class="lineno"> 2238</span>&#160;                  <span class="keywordflow">if</span> ( w &gt;= 0 &amp;&amp; w &lt; size_ext){</div><div class="line"><a name="l02239"></a><span class="lineno"> 2239</span>&#160;                     <a class="code" href="TRolke_8cxx.html#a1a2354f40e332ad13673b70afc2c0dbf">b</a> += working_space[size_ext + w];</div><div class="line"><a name="l02240"></a><span class="lineno"> 2240</span>&#160;                     men +=1;</div><div class="line"><a name="l02241"></a><span class="lineno"> 2241</span>&#160;                  }</div><div class="line"><a name="l02242"></a><span class="lineno"> 2242</span>&#160;               }</div><div class="line"><a name="l02243"></a><span class="lineno"> 2243</span>&#160;               <a class="code" href="TRolke_8cxx.html#a1a2354f40e332ad13673b70afc2c0dbf">b</a> = <a class="code" href="TRolke_8cxx.html#a1a2354f40e332ad13673b70afc2c0dbf">b</a> / men;</div><div class="line"><a name="l02244"></a><span class="lineno"> 2244</span>&#160;               <a class="code" href="RSha256_8hxx.html#a63f410abde93141c9013b7d3f3971738">c</a> = 0;</div><div class="line"><a name="l02245"></a><span class="lineno"> 2245</span>&#160;               men = 0;</div><div class="line"><a name="l02246"></a><span class="lineno"> 2246</span>&#160;               <span class="keywordflow">for</span> (w = j + i - bw; w &lt;= j + i + bw; w++){</div><div class="line"><a name="l02247"></a><span class="lineno"> 2247</span>&#160;                  <span class="keywordflow">if</span> ( w &gt;= 0 &amp;&amp; w &lt; size_ext){</div><div class="line"><a name="l02248"></a><span class="lineno"> 2248</span>&#160;                     <a class="code" href="RSha256_8hxx.html#a63f410abde93141c9013b7d3f3971738">c</a> += working_space[size_ext + w];</div><div class="line"><a name="l02249"></a><span class="lineno"> 2249</span>&#160;                     men +=1;</div><div class="line"><a name="l02250"></a><span class="lineno"> 2250</span>&#160;                  }</div><div class="line"><a name="l02251"></a><span class="lineno"> 2251</span>&#160;               }</div><div class="line"><a name="l02252"></a><span class="lineno"> 2252</span>&#160;               <a class="code" href="RSha256_8hxx.html#a63f410abde93141c9013b7d3f3971738">c</a> = <a class="code" href="RSha256_8hxx.html#a63f410abde93141c9013b7d3f3971738">c</a> / men;</div><div class="line"><a name="l02253"></a><span class="lineno"> 2253</span>&#160;               <a class="code" href="TRolke_8cxx.html#a1a2354f40e332ad13673b70afc2c0dbf">b</a> = (<a class="code" href="TRolke_8cxx.html#a1a2354f40e332ad13673b70afc2c0dbf">b</a> + <a class="code" href="RSha256_8hxx.html#a63f410abde93141c9013b7d3f3971738">c</a>) / 2;</div><div class="line"><a name="l02254"></a><span class="lineno"> 2254</span>&#160;               <span class="keywordflow">if</span> (<a class="code" href="TRolke_8cxx.html#a1a2354f40e332ad13673b70afc2c0dbf">b</a> &lt; <a class="code" href="textangle_8C.html#a655a1c2a1ec25e8fcfb713772281e8f5">a</a>)</div><div class="line"><a name="l02255"></a><span class="lineno"> 2255</span>&#160;                  av = <a class="code" href="TRolke_8cxx.html#a1a2354f40e332ad13673b70afc2c0dbf">b</a>;</div><div class="line"><a name="l02256"></a><span class="lineno"> 2256</span>&#160;               working_space[j]=av;</div><div class="line"><a name="l02257"></a><span class="lineno"> 2257</span>&#160;            }</div><div class="line"><a name="l02258"></a><span class="lineno"> 2258</span>&#160;         }</div><div class="line"><a name="l02259"></a><span class="lineno"> 2259</span>&#160;         <span class="keywordflow">for</span>(j = i; j &lt; size_ext - i; j++)</div><div class="line"><a name="l02260"></a><span class="lineno"> 2260</span>&#160;            working_space[size_ext + j] = working_space[j];</div><div class="line"><a name="l02261"></a><span class="lineno"> 2261</span>&#160;      }</div><div class="line"><a name="l02262"></a><span class="lineno"> 2262</span>&#160;      <span class="keywordflow">for</span>(j = 0;j &lt; size_ext; j++){</div><div class="line"><a name="l02263"></a><span class="lineno"> 2263</span>&#160;         <span class="keywordflow">if</span>(j &lt; shift){</div><div class="line"><a name="l02264"></a><span class="lineno"> 2264</span>&#160;                  <a class="code" href="textangle_8C.html#a655a1c2a1ec25e8fcfb713772281e8f5">a</a> = j - shift;</div><div class="line"><a name="l02265"></a><span class="lineno"> 2265</span>&#160;                  <a class="code" href="TRolke_8cxx.html#a1a2354f40e332ad13673b70afc2c0dbf">b</a> = source[0] + l1low * <a class="code" href="textangle_8C.html#a655a1c2a1ec25e8fcfb713772281e8f5">a</a>;</div><div class="line"><a name="l02266"></a><span class="lineno"> 2266</span>&#160;                  <span class="keywordflow">if</span> (<a class="code" href="TRolke_8cxx.html#a1a2354f40e332ad13673b70afc2c0dbf">b</a> &lt; 0) <a class="code" href="TRolke_8cxx.html#a1a2354f40e332ad13673b70afc2c0dbf">b</a> = 0;</div><div class="line"><a name="l02267"></a><span class="lineno"> 2267</span>&#160;            working_space[size_ext + j] = <a class="code" href="TRolke_8cxx.html#a1a2354f40e332ad13673b70afc2c0dbf">b</a> - working_space[size_ext + j];</div><div class="line"><a name="l02268"></a><span class="lineno"> 2268</span>&#160;         }</div><div class="line"><a name="l02269"></a><span class="lineno"> 2269</span>&#160;</div><div class="line"><a name="l02270"></a><span class="lineno"> 2270</span>&#160;         <span class="keywordflow">else</span> <span class="keywordflow">if</span>(j &gt;= ssize + shift){</div><div class="line"><a name="l02271"></a><span class="lineno"> 2271</span>&#160;                  <a class="code" href="textangle_8C.html#a655a1c2a1ec25e8fcfb713772281e8f5">a</a> = j - (ssize - 1 + shift);</div><div class="line"><a name="l02272"></a><span class="lineno"> 2272</span>&#160;                  <a class="code" href="TRolke_8cxx.html#a1a2354f40e332ad13673b70afc2c0dbf">b</a> = source[ssize - 1];</div><div class="line"><a name="l02273"></a><span class="lineno"> 2273</span>&#160;                  <span class="keywordflow">if</span> (<a class="code" href="TRolke_8cxx.html#a1a2354f40e332ad13673b70afc2c0dbf">b</a> &lt; 0) <a class="code" href="TRolke_8cxx.html#a1a2354f40e332ad13673b70afc2c0dbf">b</a> = 0;</div><div class="line"><a name="l02274"></a><span class="lineno"> 2274</span>&#160;            working_space[size_ext + j] = <a class="code" href="TRolke_8cxx.html#a1a2354f40e332ad13673b70afc2c0dbf">b</a> - working_space[size_ext + j];</div><div class="line"><a name="l02275"></a><span class="lineno"> 2275</span>&#160;         }</div><div class="line"><a name="l02276"></a><span class="lineno"> 2276</span>&#160;</div><div class="line"><a name="l02277"></a><span class="lineno"> 2277</span>&#160;         <span class="keywordflow">else</span>{</div><div class="line"><a name="l02278"></a><span class="lineno"> 2278</span>&#160;            working_space[size_ext + j] = source[j - shift] - working_space[size_ext + j];</div><div class="line"><a name="l02279"></a><span class="lineno"> 2279</span>&#160;         }</div><div class="line"><a name="l02280"></a><span class="lineno"> 2280</span>&#160;      }</div><div class="line"><a name="l02281"></a><span class="lineno"> 2281</span>&#160;      <span class="keywordflow">for</span>(j = 0;j &lt; size_ext; j++){</div><div class="line"><a name="l02282"></a><span class="lineno"> 2282</span>&#160;         <span class="keywordflow">if</span>(working_space[size_ext + j] &lt; 0) working_space[size_ext + j] = 0;</div><div class="line"><a name="l02283"></a><span class="lineno"> 2283</span>&#160;      }</div><div class="line"><a name="l02284"></a><span class="lineno"> 2284</span>&#160;   }</div><div class="line"><a name="l02285"></a><span class="lineno"> 2285</span>&#160;</div><div class="line"><a name="l02286"></a><span class="lineno"> 2286</span>&#160;   <span class="keywordflow">for</span>(i = 0; i &lt; size_ext; i++){</div><div class="line"><a name="l02287"></a><span class="lineno"> 2287</span>&#160;      working_space[i + 6*size_ext] = working_space[i + size_ext];</div><div class="line"><a name="l02288"></a><span class="lineno"> 2288</span>&#160;   }</div><div class="line"><a name="l02289"></a><span class="lineno"> 2289</span>&#160;</div><div class="line"><a name="l02290"></a><span class="lineno"> 2290</span>&#160;   <span class="keywordflow">if</span>(markov == <span class="keyword">true</span>){</div><div class="line"><a name="l02291"></a><span class="lineno"> 2291</span>&#160;      <span class="keywordflow">for</span>(j = 0; j &lt; size_ext; j++)</div><div class="line"><a name="l02292"></a><span class="lineno"> 2292</span>&#160;         working_space[2 * size_ext + j] = working_space[size_ext + j];</div><div class="line"><a name="l02293"></a><span class="lineno"> 2293</span>&#160;      <a class="code" href="THbookFile_8cxx.html#a058f249a5e6d20724cb0784b40a183e8">xmin</a> = 0,<a class="code" href="THbookFile_8cxx.html#a9c42f51718ed192ed1841a53d2b0e507">xmax</a> = size_ext - 1;</div><div class="line"><a name="l02294"></a><span class="lineno"> 2294</span>&#160;      <span class="keywordflow">for</span>(i = 0, maxch = 0; i &lt; size_ext; i++){</div><div class="line"><a name="l02295"></a><span class="lineno"> 2295</span>&#160;         working_space[i] = 0;</div><div class="line"><a name="l02296"></a><span class="lineno"> 2296</span>&#160;         <span class="keywordflow">if</span>(maxch &lt; working_space[2 * size_ext + i])</div><div class="line"><a name="l02297"></a><span class="lineno"> 2297</span>&#160;            maxch = working_space[2 * size_ext + i];</div><div class="line"><a name="l02298"></a><span class="lineno"> 2298</span>&#160;         plocha += working_space[2 * size_ext + i];</div><div class="line"><a name="l02299"></a><span class="lineno"> 2299</span>&#160;      }</div><div class="line"><a name="l02300"></a><span class="lineno"> 2300</span>&#160;      <span class="keywordflow">if</span>(maxch == 0) {</div><div class="line"><a name="l02301"></a><span class="lineno"> 2301</span>&#160;         <span class="keyword">delete</span> [] working_space;</div><div class="line"><a name="l02302"></a><span class="lineno"> 2302</span>&#160;         <span class="keywordflow">return</span> 0;</div><div class="line"><a name="l02303"></a><span class="lineno"> 2303</span>&#160;      }</div><div class="line"><a name="l02304"></a><span class="lineno"> 2304</span>&#160;</div><div class="line"><a name="l02305"></a><span class="lineno"> 2305</span>&#160;      nom = 1;</div><div class="line"><a name="l02306"></a><span class="lineno"> 2306</span>&#160;      working_space[<a class="code" href="THbookFile_8cxx.html#a058f249a5e6d20724cb0784b40a183e8">xmin</a>] = 1;</div><div class="line"><a name="l02307"></a><span class="lineno"> 2307</span>&#160;      <span class="keywordflow">for</span>(i = <a class="code" href="THbookFile_8cxx.html#a058f249a5e6d20724cb0784b40a183e8">xmin</a>; i &lt; <a class="code" href="THbookFile_8cxx.html#a9c42f51718ed192ed1841a53d2b0e507">xmax</a>; i++){</div><div class="line"><a name="l02308"></a><span class="lineno"> 2308</span>&#160;         nip = working_space[2 * size_ext + i] / maxch;</div><div class="line"><a name="l02309"></a><span class="lineno"> 2309</span>&#160;         nim = working_space[2 * size_ext + i + 1] / maxch;</div><div class="line"><a name="l02310"></a><span class="lineno"> 2310</span>&#160;         sp = 0,sm = 0;</div><div class="line"><a name="l02311"></a><span class="lineno"> 2311</span>&#160;         <span class="keywordflow">for</span>(<a class="code" href="textangle_8C.html#a3359d7f1aa9fe2f8bc884b02020e8d20">l</a> = 1; <a class="code" href="textangle_8C.html#a3359d7f1aa9fe2f8bc884b02020e8d20">l</a> &lt;= averWindow; <a class="code" href="textangle_8C.html#a3359d7f1aa9fe2f8bc884b02020e8d20">l</a>++){</div><div class="line"><a name="l02312"></a><span class="lineno"> 2312</span>&#160;            <span class="keywordflow">if</span>((i + <a class="code" href="textangle_8C.html#a3359d7f1aa9fe2f8bc884b02020e8d20">l</a>) &gt; <a class="code" href="THbookFile_8cxx.html#a9c42f51718ed192ed1841a53d2b0e507">xmax</a>)</div><div class="line"><a name="l02313"></a><span class="lineno"> 2313</span>&#160;               <a class="code" href="textangle_8C.html#a655a1c2a1ec25e8fcfb713772281e8f5">a</a> = working_space[2 * size_ext + <a class="code" href="THbookFile_8cxx.html#a9c42f51718ed192ed1841a53d2b0e507">xmax</a>] / maxch;</div><div class="line"><a name="l02314"></a><span class="lineno"> 2314</span>&#160;</div><div class="line"><a name="l02315"></a><span class="lineno"> 2315</span>&#160;            <span class="keywordflow">else</span></div><div class="line"><a name="l02316"></a><span class="lineno"> 2316</span>&#160;               <a class="code" href="textangle_8C.html#a655a1c2a1ec25e8fcfb713772281e8f5">a</a> = working_space[2 * size_ext + i + <a class="code" href="textangle_8C.html#a3359d7f1aa9fe2f8bc884b02020e8d20">l</a>] / maxch;</div><div class="line"><a name="l02317"></a><span class="lineno"> 2317</span>&#160;</div><div class="line"><a name="l02318"></a><span class="lineno"> 2318</span>&#160;            <a class="code" href="TRolke_8cxx.html#a1a2354f40e332ad13673b70afc2c0dbf">b</a> = <a class="code" href="textangle_8C.html#a655a1c2a1ec25e8fcfb713772281e8f5">a</a> - nip;</div><div class="line"><a name="l02319"></a><span class="lineno"> 2319</span>&#160;            <span class="keywordflow">if</span>(<a class="code" href="textangle_8C.html#a655a1c2a1ec25e8fcfb713772281e8f5">a</a> + nip &lt;= 0)</div><div class="line"><a name="l02320"></a><span class="lineno"> 2320</span>&#160;               <a class="code" href="textangle_8C.html#a655a1c2a1ec25e8fcfb713772281e8f5">a</a>=1;</div><div class="line"><a name="l02321"></a><span class="lineno"> 2321</span>&#160;</div><div class="line"><a name="l02322"></a><span class="lineno"> 2322</span>&#160;            <span class="keywordflow">else</span></div><div class="line"><a name="l02323"></a><span class="lineno"> 2323</span>&#160;               <a class="code" href="textangle_8C.html#a655a1c2a1ec25e8fcfb713772281e8f5">a</a> = <a class="code" href="namespaceTMath.html#a9ea900c956031cb12057acf7c322b0fa">TMath::Sqrt</a>(<a class="code" href="textangle_8C.html#a655a1c2a1ec25e8fcfb713772281e8f5">a</a> + nip);</div><div class="line"><a name="l02324"></a><span class="lineno"> 2324</span>&#160;</div><div class="line"><a name="l02325"></a><span class="lineno"> 2325</span>&#160;            <a class="code" href="TRolke_8cxx.html#a1a2354f40e332ad13673b70afc2c0dbf">b</a> = <a class="code" href="TRolke_8cxx.html#a1a2354f40e332ad13673b70afc2c0dbf">b</a> / <a class="code" href="textangle_8C.html#a655a1c2a1ec25e8fcfb713772281e8f5">a</a>;</div><div class="line"><a name="l02326"></a><span class="lineno"> 2326</span>&#160;            <a class="code" href="TRolke_8cxx.html#a1a2354f40e332ad13673b70afc2c0dbf">b</a> = <a class="code" href="namespaceTMath.html#a428950de9bddacfb35915a9603880005">TMath::Exp</a>(<a class="code" href="TRolke_8cxx.html#a1a2354f40e332ad13673b70afc2c0dbf">b</a>);</div><div class="line"><a name="l02327"></a><span class="lineno"> 2327</span>&#160;            sp = sp + <a class="code" href="TRolke_8cxx.html#a1a2354f40e332ad13673b70afc2c0dbf">b</a>;</div><div class="line"><a name="l02328"></a><span class="lineno"> 2328</span>&#160;            <span class="keywordflow">if</span>((i - <a class="code" href="textangle_8C.html#a3359d7f1aa9fe2f8bc884b02020e8d20">l</a> + 1) &lt; <a class="code" href="THbookFile_8cxx.html#a058f249a5e6d20724cb0784b40a183e8">xmin</a>)</div><div class="line"><a name="l02329"></a><span class="lineno"> 2329</span>&#160;               <a class="code" href="textangle_8C.html#a655a1c2a1ec25e8fcfb713772281e8f5">a</a> = working_space[2 * size_ext + <a class="code" href="THbookFile_8cxx.html#a058f249a5e6d20724cb0784b40a183e8">xmin</a>] / maxch;</div><div class="line"><a name="l02330"></a><span class="lineno"> 2330</span>&#160;</div><div class="line"><a name="l02331"></a><span class="lineno"> 2331</span>&#160;            <span class="keywordflow">else</span></div><div class="line"><a name="l02332"></a><span class="lineno"> 2332</span>&#160;               <a class="code" href="textangle_8C.html#a655a1c2a1ec25e8fcfb713772281e8f5">a</a> = working_space[2 * size_ext + i - <a class="code" href="textangle_8C.html#a3359d7f1aa9fe2f8bc884b02020e8d20">l</a> + 1] / maxch;</div><div class="line"><a name="l02333"></a><span class="lineno"> 2333</span>&#160;</div><div class="line"><a name="l02334"></a><span class="lineno"> 2334</span>&#160;            <a class="code" href="TRolke_8cxx.html#a1a2354f40e332ad13673b70afc2c0dbf">b</a> = <a class="code" href="textangle_8C.html#a655a1c2a1ec25e8fcfb713772281e8f5">a</a> - nim;</div><div class="line"><a name="l02335"></a><span class="lineno"> 2335</span>&#160;            <span class="keywordflow">if</span>(<a class="code" href="textangle_8C.html#a655a1c2a1ec25e8fcfb713772281e8f5">a</a> + nim &lt;= 0)</div><div class="line"><a name="l02336"></a><span class="lineno"> 2336</span>&#160;               <a class="code" href="textangle_8C.html#a655a1c2a1ec25e8fcfb713772281e8f5">a</a> = 1;</div><div class="line"><a name="l02337"></a><span class="lineno"> 2337</span>&#160;</div><div class="line"><a name="l02338"></a><span class="lineno"> 2338</span>&#160;            <span class="keywordflow">else</span></div><div class="line"><a name="l02339"></a><span class="lineno"> 2339</span>&#160;               <a class="code" href="textangle_8C.html#a655a1c2a1ec25e8fcfb713772281e8f5">a</a> = <a class="code" href="namespaceTMath.html#a9ea900c956031cb12057acf7c322b0fa">TMath::Sqrt</a>(<a class="code" href="textangle_8C.html#a655a1c2a1ec25e8fcfb713772281e8f5">a</a> + nim);</div><div class="line"><a name="l02340"></a><span class="lineno"> 2340</span>&#160;</div><div class="line"><a name="l02341"></a><span class="lineno"> 2341</span>&#160;            <a class="code" href="TRolke_8cxx.html#a1a2354f40e332ad13673b70afc2c0dbf">b</a> = <a class="code" href="TRolke_8cxx.html#a1a2354f40e332ad13673b70afc2c0dbf">b</a> / <a class="code" href="textangle_8C.html#a655a1c2a1ec25e8fcfb713772281e8f5">a</a>;</div><div class="line"><a name="l02342"></a><span class="lineno"> 2342</span>&#160;            <a class="code" href="TRolke_8cxx.html#a1a2354f40e332ad13673b70afc2c0dbf">b</a> = <a class="code" href="namespaceTMath.html#a428950de9bddacfb35915a9603880005">TMath::Exp</a>(<a class="code" href="TRolke_8cxx.html#a1a2354f40e332ad13673b70afc2c0dbf">b</a>);</div><div class="line"><a name="l02343"></a><span class="lineno"> 2343</span>&#160;            sm = sm + <a class="code" href="TRolke_8cxx.html#a1a2354f40e332ad13673b70afc2c0dbf">b</a>;</div><div class="line"><a name="l02344"></a><span class="lineno"> 2344</span>&#160;         }</div><div class="line"><a name="l02345"></a><span class="lineno"> 2345</span>&#160;         <a class="code" href="textangle_8C.html#a655a1c2a1ec25e8fcfb713772281e8f5">a</a> = sp / sm;</div><div class="line"><a name="l02346"></a><span class="lineno"> 2346</span>&#160;         <a class="code" href="textangle_8C.html#a655a1c2a1ec25e8fcfb713772281e8f5">a</a> = working_space[i + 1] = working_space[i] * <a class="code" href="textangle_8C.html#a655a1c2a1ec25e8fcfb713772281e8f5">a</a>;</div><div class="line"><a name="l02347"></a><span class="lineno"> 2347</span>&#160;         nom = nom + <a class="code" href="textangle_8C.html#a655a1c2a1ec25e8fcfb713772281e8f5">a</a>;</div><div class="line"><a name="l02348"></a><span class="lineno"> 2348</span>&#160;      }</div><div class="line"><a name="l02349"></a><span class="lineno"> 2349</span>&#160;      <span class="keywordflow">for</span>(i = <a class="code" href="THbookFile_8cxx.html#a058f249a5e6d20724cb0784b40a183e8">xmin</a>; i &lt;= <a class="code" href="THbookFile_8cxx.html#a9c42f51718ed192ed1841a53d2b0e507">xmax</a>; i++){</div><div class="line"><a name="l02350"></a><span class="lineno"> 2350</span>&#160;         working_space[i] = working_space[i] / nom;</div><div class="line"><a name="l02351"></a><span class="lineno"> 2351</span>&#160;      }</div><div class="line"><a name="l02352"></a><span class="lineno"> 2352</span>&#160;      <span class="keywordflow">for</span>(j = 0; j &lt; size_ext; j++)</div><div class="line"><a name="l02353"></a><span class="lineno"> 2353</span>&#160;         working_space[size_ext + j] = working_space[j] * plocha;</div><div class="line"><a name="l02354"></a><span class="lineno"> 2354</span>&#160;      <span class="keywordflow">for</span>(j = 0; j &lt; size_ext; j++){</div><div class="line"><a name="l02355"></a><span class="lineno"> 2355</span>&#160;         working_space[2 * size_ext + j] = working_space[size_ext + j];</div><div class="line"><a name="l02356"></a><span class="lineno"> 2356</span>&#160;      }</div><div class="line"><a name="l02357"></a><span class="lineno"> 2357</span>&#160;      <span class="keywordflow">if</span>(backgroundRemove == <span class="keyword">true</span>){</div><div class="line"><a name="l02358"></a><span class="lineno"> 2358</span>&#160;         <span class="keywordflow">for</span>(i = 1; i &lt;= numberIterations; i++){</div><div class="line"><a name="l02359"></a><span class="lineno"> 2359</span>&#160;            <span class="keywordflow">for</span>(j = i; j &lt; size_ext - i; j++){</div><div class="line"><a name="l02360"></a><span class="lineno"> 2360</span>&#160;               <a class="code" href="textangle_8C.html#a655a1c2a1ec25e8fcfb713772281e8f5">a</a> = working_space[size_ext + j];</div><div class="line"><a name="l02361"></a><span class="lineno"> 2361</span>&#160;               <a class="code" href="TRolke_8cxx.html#a1a2354f40e332ad13673b70afc2c0dbf">b</a> = (working_space[size_ext + j - i] + working_space[size_ext + j + i]) / 2.0;</div><div class="line"><a name="l02362"></a><span class="lineno"> 2362</span>&#160;               <span class="keywordflow">if</span>(<a class="code" href="TRolke_8cxx.html#a1a2354f40e332ad13673b70afc2c0dbf">b</a> &lt; <a class="code" href="textangle_8C.html#a655a1c2a1ec25e8fcfb713772281e8f5">a</a>)</div><div class="line"><a name="l02363"></a><span class="lineno"> 2363</span>&#160;                  <a class="code" href="textangle_8C.html#a655a1c2a1ec25e8fcfb713772281e8f5">a</a> = <a class="code" href="TRolke_8cxx.html#a1a2354f40e332ad13673b70afc2c0dbf">b</a>;</div><div class="line"><a name="l02364"></a><span class="lineno"> 2364</span>&#160;               working_space[j] = <a class="code" href="textangle_8C.html#a655a1c2a1ec25e8fcfb713772281e8f5">a</a>;</div><div class="line"><a name="l02365"></a><span class="lineno"> 2365</span>&#160;            }</div><div class="line"><a name="l02366"></a><span class="lineno"> 2366</span>&#160;            <span class="keywordflow">for</span>(j = i; j &lt; size_ext - i; j++)</div><div class="line"><a name="l02367"></a><span class="lineno"> 2367</span>&#160;               working_space[size_ext + j] = working_space[j];</div><div class="line"><a name="l02368"></a><span class="lineno"> 2368</span>&#160;         }</div><div class="line"><a name="l02369"></a><span class="lineno"> 2369</span>&#160;         <span class="keywordflow">for</span>(j = 0; j &lt; size_ext; j++){</div><div class="line"><a name="l02370"></a><span class="lineno"> 2370</span>&#160;            working_space[size_ext + j] = working_space[2 * size_ext + j] - working_space[size_ext + j];</div><div class="line"><a name="l02371"></a><span class="lineno"> 2371</span>&#160;         }</div><div class="line"><a name="l02372"></a><span class="lineno"> 2372</span>&#160;      }</div><div class="line"><a name="l02373"></a><span class="lineno"> 2373</span>&#160;   }</div><div class="line"><a name="l02374"></a><span class="lineno"> 2374</span>&#160;<span class="comment">//deconvolution starts</span></div><div class="line"><a name="l02375"></a><span class="lineno"> 2375</span>&#160;   area = 0;</div><div class="line"><a name="l02376"></a><span class="lineno"> 2376</span>&#160;   lh_gold = -1;</div><div class="line"><a name="l02377"></a><span class="lineno"> 2377</span>&#160;   posit = 0;</div><div class="line"><a name="l02378"></a><span class="lineno"> 2378</span>&#160;   maximum = 0;</div><div class="line"><a name="l02379"></a><span class="lineno"> 2379</span>&#160;<span class="comment">//generate response vector</span></div><div class="line"><a name="l02380"></a><span class="lineno"> 2380</span>&#160;   <span class="keywordflow">for</span>(i = 0; i &lt; size_ext; i++){</div><div class="line"><a name="l02381"></a><span class="lineno"> 2381</span>&#160;      lda = (<a class="code" href="RtypesCore_8h.html#ab9b5334647b78ec4256db251e3ae1fc6">Double_t</a>)i - 3 * <a class="code" href="h1analysisProxy_8h.html#a351c2b9335dfcbe83de6eb9629c2a0e3">sigma</a>;</div><div class="line"><a name="l02382"></a><span class="lineno"> 2382</span>&#160;      lda = lda * lda / (2 * <a class="code" href="h1analysisProxy_8h.html#a351c2b9335dfcbe83de6eb9629c2a0e3">sigma</a> * <a class="code" href="h1analysisProxy_8h.html#a351c2b9335dfcbe83de6eb9629c2a0e3">sigma</a>);</div><div class="line"><a name="l02383"></a><span class="lineno"> 2383</span>&#160;      j = (<a class="code" href="RtypesCore_8h.html#a3885b911a54b47a4e61671f45dd45d0b">Int_t</a>)(1000 * <a class="code" href="namespaceTMath.html#a428950de9bddacfb35915a9603880005">TMath::Exp</a>(-lda));</div><div class="line"><a name="l02384"></a><span class="lineno"> 2384</span>&#160;      lda = j;</div><div class="line"><a name="l02385"></a><span class="lineno"> 2385</span>&#160;      <span class="keywordflow">if</span>(lda != 0)</div><div class="line"><a name="l02386"></a><span class="lineno"> 2386</span>&#160;         lh_gold = i + 1;</div><div class="line"><a name="l02387"></a><span class="lineno"> 2387</span>&#160;</div><div class="line"><a name="l02388"></a><span class="lineno"> 2388</span>&#160;      working_space[i] = lda;</div><div class="line"><a name="l02389"></a><span class="lineno"> 2389</span>&#160;      area = area + lda;</div><div class="line"><a name="l02390"></a><span class="lineno"> 2390</span>&#160;      <span class="keywordflow">if</span>(lda &gt; maximum){</div><div class="line"><a name="l02391"></a><span class="lineno"> 2391</span>&#160;         maximum = lda;</div><div class="line"><a name="l02392"></a><span class="lineno"> 2392</span>&#160;         posit = i;</div><div class="line"><a name="l02393"></a><span class="lineno"> 2393</span>&#160;      }</div><div class="line"><a name="l02394"></a><span class="lineno"> 2394</span>&#160;   }</div><div class="line"><a name="l02395"></a><span class="lineno"> 2395</span>&#160;<span class="comment">//read source vector</span></div><div class="line"><a name="l02396"></a><span class="lineno"> 2396</span>&#160;   <span class="keywordflow">for</span>(i = 0; i &lt; size_ext; i++)</div><div class="line"><a name="l02397"></a><span class="lineno"> 2397</span>&#160;      working_space[2 * size_ext + i] = <a class="code" href="namespaceTMath.html#af682354cea223351f1306bf98a858dfd">TMath::Abs</a>(working_space[size_ext + i]);</div><div class="line"><a name="l02398"></a><span class="lineno"> 2398</span>&#160;<span class="comment">//create matrix at*a(vector b)</span></div><div class="line"><a name="l02399"></a><span class="lineno"> 2399</span>&#160;   i = lh_gold - 1;</div><div class="line"><a name="l02400"></a><span class="lineno"> 2400</span>&#160;   <span class="keywordflow">if</span>(i &gt; size_ext)</div><div class="line"><a name="l02401"></a><span class="lineno"> 2401</span>&#160;      i = size_ext;</div><div class="line"><a name="l02402"></a><span class="lineno"> 2402</span>&#160;</div><div class="line"><a name="l02403"></a><span class="lineno"> 2403</span>&#160;   imin = -i,imax = i;</div><div class="line"><a name="l02404"></a><span class="lineno"> 2404</span>&#160;   <span class="keywordflow">for</span>(i = imin; i &lt;= imax; i++){</div><div class="line"><a name="l02405"></a><span class="lineno"> 2405</span>&#160;      lda = 0;</div><div class="line"><a name="l02406"></a><span class="lineno"> 2406</span>&#160;      jmin = 0;</div><div class="line"><a name="l02407"></a><span class="lineno"> 2407</span>&#160;      <span class="keywordflow">if</span>(i &lt; 0)</div><div class="line"><a name="l02408"></a><span class="lineno"> 2408</span>&#160;         jmin = -i;</div><div class="line"><a name="l02409"></a><span class="lineno"> 2409</span>&#160;      jmax = lh_gold - 1 - i;</div><div class="line"><a name="l02410"></a><span class="lineno"> 2410</span>&#160;      <span class="keywordflow">if</span>(jmax &gt; (lh_gold - 1))</div><div class="line"><a name="l02411"></a><span class="lineno"> 2411</span>&#160;         jmax = lh_gold - 1;</div><div class="line"><a name="l02412"></a><span class="lineno"> 2412</span>&#160;</div><div class="line"><a name="l02413"></a><span class="lineno"> 2413</span>&#160;      <span class="keywordflow">for</span>(j = jmin;j &lt;= jmax; j++){</div><div class="line"><a name="l02414"></a><span class="lineno"> 2414</span>&#160;         ldb = working_space[j];</div><div class="line"><a name="l02415"></a><span class="lineno"> 2415</span>&#160;         ldc = working_space[i + j];</div><div class="line"><a name="l02416"></a><span class="lineno"> 2416</span>&#160;         lda = lda + ldb * ldc;</div><div class="line"><a name="l02417"></a><span class="lineno"> 2417</span>&#160;      }</div><div class="line"><a name="l02418"></a><span class="lineno"> 2418</span>&#160;      working_space[size_ext + i - imin] = lda;</div><div class="line"><a name="l02419"></a><span class="lineno"> 2419</span>&#160;   }</div><div class="line"><a name="l02420"></a><span class="lineno"> 2420</span>&#160;<span class="comment">//create vector p</span></div><div class="line"><a name="l02421"></a><span class="lineno"> 2421</span>&#160;   i = lh_gold - 1;</div><div class="line"><a name="l02422"></a><span class="lineno"> 2422</span>&#160;   imin = -i,imax = size_ext + i - 1;</div><div class="line"><a name="l02423"></a><span class="lineno"> 2423</span>&#160;   <span class="keywordflow">for</span>(i = imin; i &lt;= imax; i++){</div><div class="line"><a name="l02424"></a><span class="lineno"> 2424</span>&#160;      lda = 0;</div><div class="line"><a name="l02425"></a><span class="lineno"> 2425</span>&#160;      <span class="keywordflow">for</span>(j = 0; j &lt;= (lh_gold - 1); j++){</div><div class="line"><a name="l02426"></a><span class="lineno"> 2426</span>&#160;         ldb = working_space[j];</div><div class="line"><a name="l02427"></a><span class="lineno"> 2427</span>&#160;         k = i + j;</div><div class="line"><a name="l02428"></a><span class="lineno"> 2428</span>&#160;         <span class="keywordflow">if</span>(k &gt;= 0 &amp;&amp; k &lt; size_ext){</div><div class="line"><a name="l02429"></a><span class="lineno"> 2429</span>&#160;            ldc = working_space[2 * size_ext + k];</div><div class="line"><a name="l02430"></a><span class="lineno"> 2430</span>&#160;            lda = lda + ldb * ldc;</div><div class="line"><a name="l02431"></a><span class="lineno"> 2431</span>&#160;         }</div><div class="line"><a name="l02432"></a><span class="lineno"> 2432</span>&#160;</div><div class="line"><a name="l02433"></a><span class="lineno"> 2433</span>&#160;      }</div><div class="line"><a name="l02434"></a><span class="lineno"> 2434</span>&#160;      working_space[4 * size_ext + i - imin] = lda;</div><div class="line"><a name="l02435"></a><span class="lineno"> 2435</span>&#160;   }</div><div class="line"><a name="l02436"></a><span class="lineno"> 2436</span>&#160;<span class="comment">//move vector p</span></div><div class="line"><a name="l02437"></a><span class="lineno"> 2437</span>&#160;   <span class="keywordflow">for</span>(i = imin; i &lt;= imax; i++)</div><div class="line"><a name="l02438"></a><span class="lineno"> 2438</span>&#160;      working_space[2 * size_ext + i - imin] = working_space[4 * size_ext + i - imin];</div><div class="line"><a name="l02439"></a><span class="lineno"> 2439</span>&#160;<span class="comment">//initialization of resulting vector</span></div><div class="line"><a name="l02440"></a><span class="lineno"> 2440</span>&#160;   <span class="keywordflow">for</span>(i = 0; i &lt; size_ext; i++)</div><div class="line"><a name="l02441"></a><span class="lineno"> 2441</span>&#160;      working_space[i] = 1;</div><div class="line"><a name="l02442"></a><span class="lineno"> 2442</span>&#160;<span class="comment">//START OF ITERATIONS</span></div><div class="line"><a name="l02443"></a><span class="lineno"> 2443</span>&#160;   <span class="keywordflow">for</span>(lindex = 0; lindex &lt; deconIterations; lindex++){</div><div class="line"><a name="l02444"></a><span class="lineno"> 2444</span>&#160;      <span class="keywordflow">for</span>(i = 0; i &lt; size_ext; i++){</div><div class="line"><a name="l02445"></a><span class="lineno"> 2445</span>&#160;         <span class="keywordflow">if</span>(<a class="code" href="namespaceTMath.html#af682354cea223351f1306bf98a858dfd">TMath::Abs</a>(working_space[2 * size_ext + i]) &gt; 0.00001 &amp;&amp; <a class="code" href="namespaceTMath.html#af682354cea223351f1306bf98a858dfd">TMath::Abs</a>(working_space[i]) &gt; 0.00001){</div><div class="line"><a name="l02446"></a><span class="lineno"> 2446</span>&#160;            lda=0;</div><div class="line"><a name="l02447"></a><span class="lineno"> 2447</span>&#160;            jmin = lh_gold - 1;</div><div class="line"><a name="l02448"></a><span class="lineno"> 2448</span>&#160;            <span class="keywordflow">if</span>(jmin &gt; i)</div><div class="line"><a name="l02449"></a><span class="lineno"> 2449</span>&#160;               jmin = i;</div><div class="line"><a name="l02450"></a><span class="lineno"> 2450</span>&#160;</div><div class="line"><a name="l02451"></a><span class="lineno"> 2451</span>&#160;            jmin = -jmin;</div><div class="line"><a name="l02452"></a><span class="lineno"> 2452</span>&#160;            jmax = lh_gold - 1;</div><div class="line"><a name="l02453"></a><span class="lineno"> 2453</span>&#160;            <span class="keywordflow">if</span>(jmax &gt; (size_ext - 1 - i))</div><div class="line"><a name="l02454"></a><span class="lineno"> 2454</span>&#160;               jmax=size_ext-1-i;</div><div class="line"><a name="l02455"></a><span class="lineno"> 2455</span>&#160;</div><div class="line"><a name="l02456"></a><span class="lineno"> 2456</span>&#160;            <span class="keywordflow">for</span>(j = jmin; j &lt;= jmax; j++){</div><div class="line"><a name="l02457"></a><span class="lineno"> 2457</span>&#160;               ldb = working_space[j + lh_gold - 1 + size_ext];</div><div class="line"><a name="l02458"></a><span class="lineno"> 2458</span>&#160;               ldc = working_space[i + j];</div><div class="line"><a name="l02459"></a><span class="lineno"> 2459</span>&#160;               lda = lda + ldb * ldc;</div><div class="line"><a name="l02460"></a><span class="lineno"> 2460</span>&#160;            }</div><div class="line"><a name="l02461"></a><span class="lineno"> 2461</span>&#160;            ldb = working_space[2 * size_ext + i];</div><div class="line"><a name="l02462"></a><span class="lineno"> 2462</span>&#160;            <span class="keywordflow">if</span>(lda != 0)</div><div class="line"><a name="l02463"></a><span class="lineno"> 2463</span>&#160;               lda = ldb / lda;</div><div class="line"><a name="l02464"></a><span class="lineno"> 2464</span>&#160;</div><div class="line"><a name="l02465"></a><span class="lineno"> 2465</span>&#160;            <span class="keywordflow">else</span></div><div class="line"><a name="l02466"></a><span class="lineno"> 2466</span>&#160;               lda = 0;</div><div class="line"><a name="l02467"></a><span class="lineno"> 2467</span>&#160;</div><div class="line"><a name="l02468"></a><span class="lineno"> 2468</span>&#160;            ldb = working_space[i];</div><div class="line"><a name="l02469"></a><span class="lineno"> 2469</span>&#160;            lda = lda * ldb;</div><div class="line"><a name="l02470"></a><span class="lineno"> 2470</span>&#160;            working_space[3 * size_ext + i] = lda;</div><div class="line"><a name="l02471"></a><span class="lineno"> 2471</span>&#160;         }</div><div class="line"><a name="l02472"></a><span class="lineno"> 2472</span>&#160;      }</div><div class="line"><a name="l02473"></a><span class="lineno"> 2473</span>&#160;      <span class="keywordflow">for</span>(i = 0; i &lt; size_ext; i++){</div><div class="line"><a name="l02474"></a><span class="lineno"> 2474</span>&#160;         working_space[i] = working_space[3 * size_ext + i];</div><div class="line"><a name="l02475"></a><span class="lineno"> 2475</span>&#160;      }</div><div class="line"><a name="l02476"></a><span class="lineno"> 2476</span>&#160;   }</div><div class="line"><a name="l02477"></a><span class="lineno"> 2477</span>&#160;<span class="comment">//shift resulting spectrum</span></div><div class="line"><a name="l02478"></a><span class="lineno"> 2478</span>&#160;   <span class="keywordflow">for</span>(i=0;i&lt;size_ext;i++){</div><div class="line"><a name="l02479"></a><span class="lineno"> 2479</span>&#160;      lda = working_space[i];</div><div class="line"><a name="l02480"></a><span class="lineno"> 2480</span>&#160;      j = i + posit;</div><div class="line"><a name="l02481"></a><span class="lineno"> 2481</span>&#160;      j = j % size_ext;</div><div class="line"><a name="l02482"></a><span class="lineno"> 2482</span>&#160;      working_space[size_ext + j] = lda;</div><div class="line"><a name="l02483"></a><span class="lineno"> 2483</span>&#160;   }</div><div class="line"><a name="l02484"></a><span class="lineno"> 2484</span>&#160;<span class="comment">//write back resulting spectrum</span></div><div class="line"><a name="l02485"></a><span class="lineno"> 2485</span>&#160;   maximum = 0, maximum_decon = 0;</div><div class="line"><a name="l02486"></a><span class="lineno"> 2486</span>&#160;   j = lh_gold - 1;</div><div class="line"><a name="l02487"></a><span class="lineno"> 2487</span>&#160;   <span class="keywordflow">for</span>(i = 0; i &lt; size_ext - j; i++){</div><div class="line"><a name="l02488"></a><span class="lineno"> 2488</span>&#160;      <span class="keywordflow">if</span>(i &gt;= shift &amp;&amp; i &lt; ssize + shift){</div><div class="line"><a name="l02489"></a><span class="lineno"> 2489</span>&#160;         working_space[i] = area * working_space[size_ext + i + j];</div><div class="line"><a name="l02490"></a><span class="lineno"> 2490</span>&#160;         <span class="keywordflow">if</span>(maximum_decon &lt; working_space[i])</div><div class="line"><a name="l02491"></a><span class="lineno"> 2491</span>&#160;            maximum_decon = working_space[i];</div><div class="line"><a name="l02492"></a><span class="lineno"> 2492</span>&#160;         <span class="keywordflow">if</span>(maximum &lt; working_space[6 * size_ext + i])</div><div class="line"><a name="l02493"></a><span class="lineno"> 2493</span>&#160;            maximum = working_space[6 * size_ext + i];</div><div class="line"><a name="l02494"></a><span class="lineno"> 2494</span>&#160;      }</div><div class="line"><a name="l02495"></a><span class="lineno"> 2495</span>&#160;</div><div class="line"><a name="l02496"></a><span class="lineno"> 2496</span>&#160;      <span class="keywordflow">else</span></div><div class="line"><a name="l02497"></a><span class="lineno"> 2497</span>&#160;         working_space[i] = 0;</div><div class="line"><a name="l02498"></a><span class="lineno"> 2498</span>&#160;   }</div><div class="line"><a name="l02499"></a><span class="lineno"> 2499</span>&#160;   lda=1;</div><div class="line"><a name="l02500"></a><span class="lineno"> 2500</span>&#160;   <span class="keywordflow">if</span>(lda&gt;threshold)</div><div class="line"><a name="l02501"></a><span class="lineno"> 2501</span>&#160;      lda=threshold;</div><div class="line"><a name="l02502"></a><span class="lineno"> 2502</span>&#160;   lda=lda/100;</div><div class="line"><a name="l02503"></a><span class="lineno"> 2503</span>&#160;</div><div class="line"><a name="l02504"></a><span class="lineno"> 2504</span>&#160;<span class="comment">//searching for peaks in deconvolved spectrum</span></div><div class="line"><a name="l02505"></a><span class="lineno"> 2505</span>&#160;   <span class="keywordflow">for</span>(i = 1; i &lt; size_ext - 1; i++){</div><div class="line"><a name="l02506"></a><span class="lineno"> 2506</span>&#160;      <span class="keywordflow">if</span>(working_space[i] &gt; working_space[i - 1] &amp;&amp; working_space[i] &gt; working_space[i + 1]){</div><div class="line"><a name="l02507"></a><span class="lineno"> 2507</span>&#160;         <span class="keywordflow">if</span>(i &gt;= shift &amp;&amp; i &lt; ssize + shift){</div><div class="line"><a name="l02508"></a><span class="lineno"> 2508</span>&#160;            <span class="keywordflow">if</span>(working_space[i] &gt; lda*maximum_decon &amp;&amp; working_space[6 * size_ext + i] &gt; threshold * maximum / 100.0){</div><div class="line"><a name="l02509"></a><span class="lineno"> 2509</span>&#160;               <span class="keywordflow">for</span>(j = i - 1, <a class="code" href="textangle_8C.html#a655a1c2a1ec25e8fcfb713772281e8f5">a</a> = 0, <a class="code" href="TRolke_8cxx.html#a1a2354f40e332ad13673b70afc2c0dbf">b</a> = 0; j &lt;= i + 1; j++){</div><div class="line"><a name="l02510"></a><span class="lineno"> 2510</span>&#160;                  <a class="code" href="textangle_8C.html#a655a1c2a1ec25e8fcfb713772281e8f5">a</a> += (<a class="code" href="RtypesCore_8h.html#ab9b5334647b78ec4256db251e3ae1fc6">Double_t</a>)(j - shift) * working_space[j];</div><div class="line"><a name="l02511"></a><span class="lineno"> 2511</span>&#160;                  <a class="code" href="TRolke_8cxx.html#a1a2354f40e332ad13673b70afc2c0dbf">b</a> += working_space[j];</div><div class="line"><a name="l02512"></a><span class="lineno"> 2512</span>&#160;               }</div><div class="line"><a name="l02513"></a><span class="lineno"> 2513</span>&#160;               <a class="code" href="textangle_8C.html#a655a1c2a1ec25e8fcfb713772281e8f5">a</a> = <a class="code" href="textangle_8C.html#a655a1c2a1ec25e8fcfb713772281e8f5">a</a> / <a class="code" href="TRolke_8cxx.html#a1a2354f40e332ad13673b70afc2c0dbf">b</a>;</div><div class="line"><a name="l02514"></a><span class="lineno"> 2514</span>&#160;               <span class="keywordflow">if</span>(<a class="code" href="textangle_8C.html#a655a1c2a1ec25e8fcfb713772281e8f5">a</a> &lt; 0)</div><div class="line"><a name="l02515"></a><span class="lineno"> 2515</span>&#160;                  <a class="code" href="textangle_8C.html#a655a1c2a1ec25e8fcfb713772281e8f5">a</a> = 0;</div><div class="line"><a name="l02516"></a><span class="lineno"> 2516</span>&#160;</div><div class="line"><a name="l02517"></a><span class="lineno"> 2517</span>&#160;               <span class="keywordflow">if</span>(<a class="code" href="textangle_8C.html#a655a1c2a1ec25e8fcfb713772281e8f5">a</a> &gt;= ssize)</div><div class="line"><a name="l02518"></a><span class="lineno"> 2518</span>&#160;                  <a class="code" href="textangle_8C.html#a655a1c2a1ec25e8fcfb713772281e8f5">a</a> = ssize - 1;</div><div class="line"><a name="l02519"></a><span class="lineno"> 2519</span>&#160;               <span class="keywordflow">if</span>(peak_index == 0){</div><div class="line"><a name="l02520"></a><span class="lineno"> 2520</span>&#160;                  <a class="code" href="classTSpectrum.html#a186f7fab91729aabbd19b446d57ba427">fPositionX</a>[0] = <a class="code" href="textangle_8C.html#a655a1c2a1ec25e8fcfb713772281e8f5">a</a>;</div><div class="line"><a name="l02521"></a><span class="lineno"> 2521</span>&#160;                  peak_index = 1;</div><div class="line"><a name="l02522"></a><span class="lineno"> 2522</span>&#160;               }</div><div class="line"><a name="l02523"></a><span class="lineno"> 2523</span>&#160;</div><div class="line"><a name="l02524"></a><span class="lineno"> 2524</span>&#160;               <span class="keywordflow">else</span>{</div><div class="line"><a name="l02525"></a><span class="lineno"> 2525</span>&#160;                  <span class="keywordflow">for</span>(j = 0, priz = 0; j &lt; peak_index &amp;&amp; priz == 0; j++){</div><div class="line"><a name="l02526"></a><span class="lineno"> 2526</span>&#160;                     <span class="keywordflow">if</span>(working_space[6 * size_ext + shift + (<a class="code" href="RtypesCore_8h.html#a3885b911a54b47a4e61671f45dd45d0b">Int_t</a>)<a class="code" href="textangle_8C.html#a655a1c2a1ec25e8fcfb713772281e8f5">a</a>] &gt; working_space[6 * size_ext + shift + (<a class="code" href="RtypesCore_8h.html#a3885b911a54b47a4e61671f45dd45d0b">Int_t</a>)<a class="code" href="classTSpectrum.html#a186f7fab91729aabbd19b446d57ba427">fPositionX</a>[j]])</div><div class="line"><a name="l02527"></a><span class="lineno"> 2527</span>&#160;                        priz = 1;</div><div class="line"><a name="l02528"></a><span class="lineno"> 2528</span>&#160;                  }</div><div class="line"><a name="l02529"></a><span class="lineno"> 2529</span>&#160;                  <span class="keywordflow">if</span>(priz == 0){</div><div class="line"><a name="l02530"></a><span class="lineno"> 2530</span>&#160;                     <span class="keywordflow">if</span>(j &lt; <a class="code" href="classTSpectrum.html#a10e78d271e709357110ae070b47d3add">fMaxPeaks</a>){</div><div class="line"><a name="l02531"></a><span class="lineno"> 2531</span>&#160;                        <a class="code" href="classTSpectrum.html#a186f7fab91729aabbd19b446d57ba427">fPositionX</a>[j] = <a class="code" href="textangle_8C.html#a655a1c2a1ec25e8fcfb713772281e8f5">a</a>;</div><div class="line"><a name="l02532"></a><span class="lineno"> 2532</span>&#160;                     }</div><div class="line"><a name="l02533"></a><span class="lineno"> 2533</span>&#160;                  }</div><div class="line"><a name="l02534"></a><span class="lineno"> 2534</span>&#160;</div><div class="line"><a name="l02535"></a><span class="lineno"> 2535</span>&#160;                  <span class="keywordflow">else</span>{</div><div class="line"><a name="l02536"></a><span class="lineno"> 2536</span>&#160;                     <span class="keywordflow">for</span>(k = peak_index; k &gt;= j; k--){</div><div class="line"><a name="l02537"></a><span class="lineno"> 2537</span>&#160;                        <span class="keywordflow">if</span>(k &lt; <a class="code" href="classTSpectrum.html#a10e78d271e709357110ae070b47d3add">fMaxPeaks</a>){</div><div class="line"><a name="l02538"></a><span class="lineno"> 2538</span>&#160;                           <a class="code" href="classTSpectrum.html#a186f7fab91729aabbd19b446d57ba427">fPositionX</a>[k] = <a class="code" href="classTSpectrum.html#a186f7fab91729aabbd19b446d57ba427">fPositionX</a>[k - 1];</div><div class="line"><a name="l02539"></a><span class="lineno"> 2539</span>&#160;                        }</div><div class="line"><a name="l02540"></a><span class="lineno"> 2540</span>&#160;                     }</div><div class="line"><a name="l02541"></a><span class="lineno"> 2541</span>&#160;                     <a class="code" href="classTSpectrum.html#a186f7fab91729aabbd19b446d57ba427">fPositionX</a>[j - 1] = <a class="code" href="textangle_8C.html#a655a1c2a1ec25e8fcfb713772281e8f5">a</a>;</div><div class="line"><a name="l02542"></a><span class="lineno"> 2542</span>&#160;                  }</div><div class="line"><a name="l02543"></a><span class="lineno"> 2543</span>&#160;                  <span class="keywordflow">if</span>(peak_index &lt; <a class="code" href="classTSpectrum.html#a10e78d271e709357110ae070b47d3add">fMaxPeaks</a>)</div><div class="line"><a name="l02544"></a><span class="lineno"> 2544</span>&#160;                     peak_index += 1;</div><div class="line"><a name="l02545"></a><span class="lineno"> 2545</span>&#160;               }</div><div class="line"><a name="l02546"></a><span class="lineno"> 2546</span>&#160;            }</div><div class="line"><a name="l02547"></a><span class="lineno"> 2547</span>&#160;         }</div><div class="line"><a name="l02548"></a><span class="lineno"> 2548</span>&#160;      }</div><div class="line"><a name="l02549"></a><span class="lineno"> 2549</span>&#160;   }</div><div class="line"><a name="l02550"></a><span class="lineno"> 2550</span>&#160;</div><div class="line"><a name="l02551"></a><span class="lineno"> 2551</span>&#160;   <span class="keywordflow">for</span>(i = 0; i &lt; ssize; i++) destVector[i] = working_space[i + shift];</div><div class="line"><a name="l02552"></a><span class="lineno"> 2552</span>&#160;   <span class="keyword">delete</span> [] working_space;</div><div class="line"><a name="l02553"></a><span class="lineno"> 2553</span>&#160;   <a class="code" href="classTSpectrum.html#a63a4881270541655c2535c46ec52ce6d">fNPeaks</a> = peak_index;</div><div class="line"><a name="l02554"></a><span class="lineno"> 2554</span>&#160;   <span class="keywordflow">if</span>(peak_index == <a class="code" href="classTSpectrum.html#a10e78d271e709357110ae070b47d3add">fMaxPeaks</a>)</div><div class="line"><a name="l02555"></a><span class="lineno"> 2555</span>&#160;      <a class="code" href="classTObject.html#a75fddd7eef38a13c1374130ec7dc5cf8">Warning</a>(<span class="stringliteral">&quot;SearchHighRes&quot;</span>, <span class="stringliteral">&quot;Peak buffer full&quot;</span>);</div><div class="line"><a name="l02556"></a><span class="lineno"> 2556</span>&#160;   <span class="keywordflow">return</span> <a class="code" href="classTSpectrum.html#a63a4881270541655c2535c46ec52ce6d">fNPeaks</a>;</div><div class="line"><a name="l02557"></a><span class="lineno"> 2557</span>&#160;}</div><div class="line"><a name="l02558"></a><span class="lineno"> 2558</span>&#160;<span class="comment"></span></div><div class="line"><a name="l02559"></a><span class="lineno"> 2559</span>&#160;<span class="comment">////////////////////////////////////////////////////////////////////////////////</span></div><div class="line"><a name="l02560"></a><span class="lineno"> 2560</span>&#160;<span class="comment">/// Old name of SearcHighRes introduced for back compatibility.</span></div><div class="line"><a name="l02561"></a><span class="lineno"> 2561</span>&#160;<span class="comment">/// This function will be removed after the June 2006 release</span></div><div class="line"><a name="l02562"></a><span class="lineno"> 2562</span>&#160;<span class="comment"></span></div><div class="line"><a name="l02563"></a><span class="lineno"><a class="line" href="classTSpectrum.html#a747438b1fdb6740859c54aa09af8e119"> 2563</a></span>&#160;<a class="code" href="RtypesCore_8h.html#a3885b911a54b47a4e61671f45dd45d0b">Int_t</a> <a class="code" href="classTSpectrum.html#a747438b1fdb6740859c54aa09af8e119">TSpectrum::Search1HighRes</a>(<a class="code" href="RtypesCore_8h.html#ab9b5334647b78ec4256db251e3ae1fc6">Double_t</a> *source,<a class="code" href="RtypesCore_8h.html#ab9b5334647b78ec4256db251e3ae1fc6">Double_t</a> *destVector, <span class="keywordtype">int</span> ssize,</div><div class="line"><a name="l02564"></a><span class="lineno"> 2564</span>&#160;                                     <a class="code" href="RtypesCore_8h.html#ab9b5334647b78ec4256db251e3ae1fc6">Double_t</a> <a class="code" href="h1analysisProxy_8h.html#a351c2b9335dfcbe83de6eb9629c2a0e3">sigma</a>, <a class="code" href="RtypesCore_8h.html#ab9b5334647b78ec4256db251e3ae1fc6">Double_t</a> threshold,</div><div class="line"><a name="l02565"></a><span class="lineno"> 2565</span>&#160;                                     <span class="keywordtype">bool</span> backgroundRemove,<span class="keywordtype">int</span> deconIterations,</div><div class="line"><a name="l02566"></a><span class="lineno"> 2566</span>&#160;                                     <span class="keywordtype">bool</span> markov, <span class="keywordtype">int</span> averWindow)</div><div class="line"><a name="l02567"></a><span class="lineno"> 2567</span>&#160;{</div><div class="line"><a name="l02568"></a><span class="lineno"> 2568</span>&#160;</div><div class="line"><a name="l02569"></a><span class="lineno"> 2569</span>&#160;</div><div class="line"><a name="l02570"></a><span class="lineno"> 2570</span>&#160;   <span class="keywordflow">return</span> <a class="code" href="classTSpectrum.html#a5ba181a45b117934b48c4ef5f78d0b2b">SearchHighRes</a>(source,destVector,ssize,<a class="code" href="h1analysisProxy_8h.html#a351c2b9335dfcbe83de6eb9629c2a0e3">sigma</a>,threshold,backgroundRemove,</div><div class="line"><a name="l02571"></a><span class="lineno"> 2571</span>&#160;                        deconIterations,markov,averWindow);</div><div class="line"><a name="l02572"></a><span class="lineno"> 2572</span>&#160;}</div><div class="line"><a name="l02573"></a><span class="lineno"> 2573</span>&#160;<span class="comment"></span></div><div class="line"><a name="l02574"></a><span class="lineno"> 2574</span>&#160;<span class="comment">////////////////////////////////////////////////////////////////////////////////</span></div><div class="line"><a name="l02575"></a><span class="lineno"> 2575</span>&#160;<span class="comment">/// Static function, interface to TSpectrum::Search.</span></div><div class="line"><a name="l02576"></a><span class="lineno"> 2576</span>&#160;<span class="comment"></span></div><div class="line"><a name="l02577"></a><span class="lineno"><a class="line" href="classTSpectrum.html#af2b4ae59d35493a236d120c70aaad731"> 2577</a></span>&#160;<a class="code" href="RtypesCore_8h.html#a3885b911a54b47a4e61671f45dd45d0b">Int_t</a> <a class="code" href="classTSpectrum.html#af2b4ae59d35493a236d120c70aaad731">TSpectrum::StaticSearch</a>(<span class="keyword">const</span> <a class="code" href="classTH1.html">TH1</a> *hist, <a class="code" href="RtypesCore_8h.html#ab9b5334647b78ec4256db251e3ae1fc6">Double_t</a> <a class="code" href="h1analysisProxy_8h.html#a351c2b9335dfcbe83de6eb9629c2a0e3">sigma</a>, <a class="code" href="RtypesCore_8h.html#afc405399e08793afdff5b4692827b2a1">Option_t</a> *option, <a class="code" href="RtypesCore_8h.html#ab9b5334647b78ec4256db251e3ae1fc6">Double_t</a> threshold)</div><div class="line"><a name="l02578"></a><span class="lineno"> 2578</span>&#160;{</div><div class="line"><a name="l02579"></a><span class="lineno"> 2579</span>&#160;</div><div class="line"><a name="l02580"></a><span class="lineno"> 2580</span>&#160;   <a class="code" href="classTSpectrum.html">TSpectrum</a> <a class="code" href="namespaceTGeant4Unit.html#a5d450e80998065902b102dca2a69066a">s</a>;</div><div class="line"><a name="l02581"></a><span class="lineno"> 2581</span>&#160;   <span class="keywordflow">return</span> <a class="code" href="namespaceTGeant4Unit.html#a5d450e80998065902b102dca2a69066a">s</a>.Search(hist,<a class="code" href="h1analysisProxy_8h.html#a351c2b9335dfcbe83de6eb9629c2a0e3">sigma</a>,option,threshold);</div><div class="line"><a name="l02582"></a><span class="lineno"> 2582</span>&#160;}</div><div class="line"><a name="l02583"></a><span class="lineno"> 2583</span>&#160;<span class="comment"></span></div><div class="line"><a name="l02584"></a><span class="lineno"> 2584</span>&#160;<span class="comment">////////////////////////////////////////////////////////////////////////////////</span></div><div class="line"><a name="l02585"></a><span class="lineno"> 2585</span>&#160;<span class="comment">/// Static function, interface to TSpectrum::Background.</span></div><div class="line"><a name="l02586"></a><span class="lineno"> 2586</span>&#160;<span class="comment"></span></div><div class="line"><a name="l02587"></a><span class="lineno"><a class="line" href="classTSpectrum.html#a064d097f8ac6bc95ac99a9555ea49b88"> 2587</a></span>&#160;<a class="code" href="classTH1.html">TH1</a> *<a class="code" href="classTSpectrum.html#a064d097f8ac6bc95ac99a9555ea49b88">TSpectrum::StaticBackground</a>(<span class="keyword">const</span> <a class="code" href="classTH1.html">TH1</a> *hist,<a class="code" href="RtypesCore_8h.html#a3885b911a54b47a4e61671f45dd45d0b">Int_t</a> niter, <a class="code" href="RtypesCore_8h.html#afc405399e08793afdff5b4692827b2a1">Option_t</a> *option)</div><div class="line"><a name="l02588"></a><span class="lineno"> 2588</span>&#160;{</div><div class="line"><a name="l02589"></a><span class="lineno"> 2589</span>&#160;   <a class="code" href="classTSpectrum.html">TSpectrum</a> <a class="code" href="namespaceTGeant4Unit.html#a5d450e80998065902b102dca2a69066a">s</a>;</div><div class="line"><a name="l02590"></a><span class="lineno"> 2590</span>&#160;   <span class="keywordflow">return</span> <a class="code" href="namespaceTGeant4Unit.html#a5d450e80998065902b102dca2a69066a">s</a>.Background(hist,niter,option);</div><div class="line"><a name="l02591"></a><span class="lineno"> 2591</span>&#160;}</div><div class="ttc" id="classTSpectrum_html_a22565bc179ec06fc52d9377905f71871a0e005bb3ae769555ceb1a6d88c54e804"><div class="ttname"><a href="classTSpectrum.html#a22565bc179ec06fc52d9377905f71871a0e005bb3ae769555ceb1a6d88c54e804">TSpectrum::kBackOrder8</a></div><div class="ttdef"><b>Definition:</b> <a href="TSpectrum_8h_source.html#l00040">TSpectrum.h:40</a></div></div>
<div class="ttc" id="classTSpectrum_html_a747438b1fdb6740859c54aa09af8e119"><div class="ttname"><a href="classTSpectrum.html#a747438b1fdb6740859c54aa09af8e119">TSpectrum::Search1HighRes</a></div><div class="ttdeci">Int_t Search1HighRes(Double_t *source, Double_t *destVector, Int_t ssize, Double_t sigma, Double_t threshold, bool backgroundRemove, Int_t deconIterations, bool markov, Int_t averWindow)</div><div class="ttdoc">Old name of SearcHighRes introduced for back compatibility. </div><div class="ttdef"><b>Definition:</b> <a href="TSpectrum_8cxx_source.html#l02563">TSpectrum.cxx:2563</a></div></div>
<div class="ttc" id="classTSpectrum_html_a22565bc179ec06fc52d9377905f71871a881ed7ed9012a0e081b164f058094d2e"><div class="ttname"><a href="classTSpectrum.html#a22565bc179ec06fc52d9377905f71871a881ed7ed9012a0e081b164f058094d2e">TSpectrum::kBackSmoothing13</a></div><div class="ttdef"><b>Definition:</b> <a href="TSpectrum_8h_source.html#l00048">TSpectrum.h:48</a></div></div>
<div class="ttc" id="THbookFile_8cxx_html_a058f249a5e6d20724cb0784b40a183e8"><div class="ttname"><a href="THbookFile_8cxx.html#a058f249a5e6d20724cb0784b40a183e8">xmin</a></div><div class="ttdeci">float xmin</div><div class="ttdef"><b>Definition:</b> <a href="THbookFile_8cxx_source.html#l00093">THbookFile.cxx:93</a></div></div>
<div class="ttc" id="classTH1_html_a0ee88e02b75d885985097dcde0a9eaa1"><div class="ttname"><a href="classTH1.html#a0ee88e02b75d885985097dcde0a9eaa1">TH1::GetBinCenter</a></div><div class="ttdeci">virtual Double_t GetBinCenter(Int_t bin) const</div><div class="ttdoc">Return bin center for 1D histogram. </div><div class="ttdef"><b>Definition:</b> <a href="TH1_8cxx_source.html#l08554">TH1.cxx:8554</a></div></div>
<div class="ttc" id="classTSpectrum_html_a22565bc179ec06fc52d9377905f71871ad4143bb4537ab0c1644c73483417c107"><div class="ttname"><a href="classTSpectrum.html#a22565bc179ec06fc52d9377905f71871ad4143bb4537ab0c1644c73483417c107">TSpectrum::kBackSmoothing5</a></div><div class="ttdef"><b>Definition:</b> <a href="TSpectrum_8h_source.html#l00044">TSpectrum.h:44</a></div></div>
<div class="ttc" id="classTAxis_html_af322ad7e08d05e1aaca9f51ea3e997d7"><div class="ttname"><a href="classTAxis.html#af322ad7e08d05e1aaca9f51ea3e997d7">TAxis::GetFirst</a></div><div class="ttdeci">Int_t GetFirst() const</div><div class="ttdoc">Return first bin on the axis i.e. </div><div class="ttdef"><b>Definition:</b> <a href="TAxis_8cxx_source.html#l00444">TAxis.cxx:444</a></div></div>
<div class="ttc" id="RtypesCore_8h_html_afc405399e08793afdff5b4692827b2a1"><div class="ttname"><a href="RtypesCore_8h.html#afc405399e08793afdff5b4692827b2a1">Option_t</a></div><div class="ttdeci">const char Option_t</div><div class="ttdef"><b>Definition:</b> <a href="RtypesCore_8h_source.html#l00062">RtypesCore.h:62</a></div></div>
<div class="ttc" id="Rtypes_8h_html_ac31db05c6cb5891c704eae374f6926a8a5a655b1a02e5b0311571ca57ce4f3900"><div class="ttname"><a href="Rtypes_8h.html#ac31db05c6cb5891c704eae374f6926a8a5a655b1a02e5b0311571ca57ce4f3900">kRed</a></div><div class="ttdef"><b>Definition:</b> <a href="Rtypes_8h_source.html#l00064">Rtypes.h:64</a></div></div>
<div class="ttc" id="classTString_html_a5072f18275913ec22cfa6f7c0c70c557"><div class="ttname"><a href="classTString.html#a5072f18275913ec22cfa6f7c0c70c557">TString::ReplaceAll</a></div><div class="ttdeci">TString &amp; ReplaceAll(const TString &amp;s1, const TString &amp;s2)</div><div class="ttdef"><b>Definition:</b> <a href="TString_8h_source.html#l00687">TString.h:687</a></div></div>
<div class="ttc" id="classTSpectrum_html_a064d097f8ac6bc95ac99a9555ea49b88"><div class="ttname"><a href="classTSpectrum.html#a064d097f8ac6bc95ac99a9555ea49b88">TSpectrum::StaticBackground</a></div><div class="ttdeci">static TH1 * StaticBackground(const TH1 *hist, Int_t niter=20, Option_t *option=&quot;&quot;)</div><div class="ttdoc">Static function, interface to TSpectrum::Background. </div><div class="ttdef"><b>Definition:</b> <a href="TSpectrum_8cxx_source.html#l02587">TSpectrum.cxx:2587</a></div></div>
<div class="ttc" id="classTSpectrum_html_ac0a2c2b867d5e962f93cf4ddd458fe80"><div class="ttname"><a href="classTSpectrum.html#ac0a2c2b867d5e962f93cf4ddd458fe80">TSpectrum::DeconvolutionRL</a></div><div class="ttdeci">const char * DeconvolutionRL(Double_t *source, const Double_t *response, Int_t ssize, Int_t numberIterations, Int_t numberRepetitions, Double_t boost)</div><div class="ttdoc">One-dimensional deconvolution function. </div><div class="ttdef"><b>Definition:</b> <a href="TSpectrum_8cxx_source.html#l01665">TSpectrum.cxx:1665</a></div></div>
<div class="ttc" id="classTH1_html_ac70dcb4082bd510f5aa3e6efeb043f39"><div class="ttname"><a href="classTH1.html#ac70dcb4082bd510f5aa3e6efeb043f39">TH1::GetBinContent</a></div><div class="ttdeci">virtual Double_t GetBinContent(Int_t bin) const</div><div class="ttdoc">Return content of bin number bin. </div><div class="ttdef"><b>Definition:</b> <a href="TH1_8cxx_source.html#l04882">TH1.cxx:4882</a></div></div>
<div class="ttc" id="classTString_html"><div class="ttname"><a href="classTString.html">TString</a></div><div class="ttdoc">Basic string class. </div><div class="ttdef"><b>Definition:</b> <a href="TString_8h_source.html#l00131">TString.h:131</a></div></div>
<div class="ttc" id="classTString_html_a1be9e2a41facebeac4feddd9801a0034"><div class="ttname"><a href="classTString.html#a1be9e2a41facebeac4feddd9801a0034">TString::ToLower</a></div><div class="ttdeci">void ToLower()</div><div class="ttdoc">Change string to lower-case. </div><div class="ttdef"><b>Definition:</b> <a href="TString_8cxx_source.html#l01125">TString.cxx:1125</a></div></div>
<div class="ttc" id="RtypesCore_8h_html_a3885b911a54b47a4e61671f45dd45d0b"><div class="ttname"><a href="RtypesCore_8h.html#a3885b911a54b47a4e61671f45dd45d0b">Int_t</a></div><div class="ttdeci">int Int_t</div><div class="ttdef"><b>Definition:</b> <a href="RtypesCore_8h_source.html#l00041">RtypesCore.h:41</a></div></div>
<div class="ttc" id="RtypesCore_8h_html_aa101f564ac7b845ca31aec2fbc00ce97"><div class="ttname"><a href="RtypesCore_8h.html#aa101f564ac7b845ca31aec2fbc00ce97">Bool_t</a></div><div class="ttdeci">bool Bool_t</div><div class="ttdef"><b>Definition:</b> <a href="RtypesCore_8h_source.html#l00059">RtypesCore.h:59</a></div></div>
<div class="ttc" id="classTSpectrum_html_a22565bc179ec06fc52d9377905f71871a283a827c1815ac5d970895880ebe4948"><div class="ttname"><a href="classTSpectrum.html#a22565bc179ec06fc52d9377905f71871a283a827c1815ac5d970895880ebe4948">TSpectrum::kBackOrder6</a></div><div class="ttdef"><b>Definition:</b> <a href="TSpectrum_8h_source.html#l00039">TSpectrum.h:39</a></div></div>
<div class="ttc" id="namespaceTMath_html_af682354cea223351f1306bf98a858dfd"><div class="ttname"><a href="namespaceTMath.html#af682354cea223351f1306bf98a858dfd">TMath::Abs</a></div><div class="ttdeci">Short_t Abs(Short_t d)</div><div class="ttdef"><b>Definition:</b> <a href="TMathBase_8h_source.html#l00120">TMathBase.h:120</a></div></div>
<div class="ttc" id="classTSpectrum_html_a22565bc179ec06fc52d9377905f71871a8f97bc92755b5a88c1db976f7ce6d585"><div class="ttname"><a href="classTSpectrum.html#a22565bc179ec06fc52d9377905f71871a8f97bc92755b5a88c1db976f7ce6d585">TSpectrum::kBackSmoothing9</a></div><div class="ttdef"><b>Definition:</b> <a href="TSpectrum_8h_source.html#l00046">TSpectrum.h:46</a></div></div>
<div class="ttc" id="namespaceTMath_html_a9f3bcefa095d69086d20e7b76bc9bfc6"><div class="ttname"><a href="namespaceTMath.html#a9f3bcefa095d69086d20e7b76bc9bfc6">TMath::Power</a></div><div class="ttdeci">LongDouble_t Power(LongDouble_t x, LongDouble_t y)</div><div class="ttdef"><b>Definition:</b> <a href="TMath_8h_source.html#l00723">TMath.h:723</a></div></div>
<div class="ttc" id="classTList_html_a85c8734ab131c0db5f68c724e47496a7"><div class="ttname"><a href="classTList.html#a85c8734ab131c0db5f68c724e47496a7">TList::FindObject</a></div><div class="ttdeci">virtual TObject * FindObject(const char *name) const</div><div class="ttdoc">Find an object in this list using its name. </div><div class="ttdef"><b>Definition:</b> <a href="TList_8cxx_source.html#l00575">TList.cxx:575</a></div></div>
<div class="ttc" id="classTH1_html_a48abf2a23357ba4c1c4e152686a711d4"><div class="ttname"><a href="classTH1.html#a48abf2a23357ba4c1c4e152686a711d4">TH1::GetDimension</a></div><div class="ttdeci">virtual Int_t GetDimension() const</div><div class="ttdef"><b>Definition:</b> <a href="TH1_8h_source.html#l00278">TH1.h:278</a></div></div>
<div class="ttc" id="classTNamed_html"><div class="ttname"><a href="classTNamed.html">TNamed</a></div><div class="ttdoc">The TNamed class is the base class for all named ROOT classes. </div><div class="ttdef"><b>Definition:</b> <a href="TNamed_8h_source.html#l00029">TNamed.h:29</a></div></div>
<div class="ttc" id="classTSpectrum_html_a186f7fab91729aabbd19b446d57ba427"><div class="ttname"><a href="classTSpectrum.html#a186f7fab91729aabbd19b446d57ba427">TSpectrum::fPositionX</a></div><div class="ttdeci">Double_t * fPositionX</div><div class="ttdoc">[fNPeaks] X position of peaks </div><div class="ttdef"><b>Definition:</b> <a href="TSpectrum_8h_source.html#l00028">TSpectrum.h:28</a></div></div>
<div class="ttc" id="classTSpectrum_html_a5ba181a45b117934b48c4ef5f78d0b2b"><div class="ttname"><a href="classTSpectrum.html#a5ba181a45b117934b48c4ef5f78d0b2b">TSpectrum::SearchHighRes</a></div><div class="ttdeci">Int_t SearchHighRes(Double_t *source, Double_t *destVector, Int_t ssize, Double_t sigma, Double_t threshold, bool backgroundRemove, Int_t deconIterations, bool markov, Int_t averWindow)</div><div class="ttdoc">One-dimensional high-resolution peak search function. </div><div class="ttdef"><b>Definition:</b> <a href="TSpectrum_8cxx_source.html#l02126">TSpectrum.cxx:2126</a></div></div>
<div class="ttc" id="classTAttMarker_html_a27f1eae16a3f990024e8a401ed034fa3"><div class="ttname"><a href="classTAttMarker.html#a27f1eae16a3f990024e8a401ed034fa3">TAttMarker::SetMarkerColor</a></div><div class="ttdeci">virtual void SetMarkerColor(Color_t mcolor=1)</div><div class="ttdoc">Set the marker color. </div><div class="ttdef"><b>Definition:</b> <a href="TAttMarker_8h_source.html#l00038">TAttMarker.h:38</a></div></div>
<div class="ttc" id="h1analysisProxy_8h_html_a351c2b9335dfcbe83de6eb9629c2a0e3"><div class="ttname"><a href="h1analysisProxy_8h.html#a351c2b9335dfcbe83de6eb9629c2a0e3">sigma</a></div><div class="ttdeci">const Double_t sigma</div><div class="ttdef"><b>Definition:</b> <a href="h1analysisProxy_8h_source.html#l00011">h1analysisProxy.h:11</a></div></div>
<div class="ttc" id="TList_8h_html"><div class="ttname"><a href="TList_8h.html">TList.h</a></div></div>
<div class="ttc" id="namespaceTGeant4Unit_html_a5d450e80998065902b102dca2a69066a"><div class="ttname"><a href="namespaceTGeant4Unit.html#a5d450e80998065902b102dca2a69066a">TGeant4Unit::s</a></div><div class="ttdeci">static constexpr double s</div><div class="ttdef"><b>Definition:</b> <a href="TGeant4SystemOfUnits_8h_source.html#l00162">TGeant4SystemOfUnits.h:162</a></div></div>
<div class="ttc" id="TVirtualPad_8h_html"><div class="ttname"><a href="TVirtualPad_8h.html">TVirtualPad.h</a></div></div>
<div class="ttc" id="classTSpectrum_html_a22565bc179ec06fc52d9377905f71871aafa4c82f25e396090b5cecb89d72bce7"><div class="ttname"><a href="classTSpectrum.html#a22565bc179ec06fc52d9377905f71871aafa4c82f25e396090b5cecb89d72bce7">TSpectrum::kBackOrder4</a></div><div class="ttdef"><b>Definition:</b> <a href="TSpectrum_8h_source.html#l00038">TSpectrum.h:38</a></div></div>
<div class="ttc" id="classTSpectrum_html_a5f8b7b208f813670259b51a8bcdcbfc5"><div class="ttname"><a href="classTSpectrum.html#a5f8b7b208f813670259b51a8bcdcbfc5">TSpectrum::Search</a></div><div class="ttdeci">virtual Int_t Search(const TH1 *hist, Double_t sigma=2, Option_t *option=&quot;&quot;, Double_t threshold=0.05)</div><div class="ttdoc">One-dimensional peak search function. </div><div class="ttdef"><b>Definition:</b> <a href="TSpectrum_8cxx_source.html#l00266">TSpectrum.cxx:266</a></div></div>
<div class="ttc" id="classTSpectrum_html_a4db923aa44f312b9b41074d95d242ae9"><div class="ttname"><a href="classTSpectrum.html#a4db923aa44f312b9b41074d95d242ae9">TSpectrum::~TSpectrum</a></div><div class="ttdeci">virtual ~TSpectrum()</div><div class="ttdoc">Destructor. </div><div class="ttdef"><b>Definition:</b> <a href="TSpectrum_8cxx_source.html#l00087">TSpectrum.cxx:87</a></div></div>
<div class="ttc" id="classTAxis_html_a9dab7a2892fdbb37f5421fa5d89d845b"><div class="ttname"><a href="classTAxis.html#a9dab7a2892fdbb37f5421fa5d89d845b">TAxis::GetLast</a></div><div class="ttdeci">Int_t GetLast() const</div><div class="ttdoc">Return last bin on the axis i.e. </div><div class="ttdef"><b>Definition:</b> <a href="TAxis_8cxx_source.html#l00455">TAxis.cxx:455</a></div></div>
<div class="ttc" id="textangle_8C_html_a655a1c2a1ec25e8fcfb713772281e8f5"><div class="ttname"><a href="textangle_8C.html#a655a1c2a1ec25e8fcfb713772281e8f5">a</a></div><div class="ttdeci">auto * a</div><div class="ttdef"><b>Definition:</b> <a href="textangle_8C_source.html#l00012">textangle.C:12</a></div></div>
<div class="ttc" id="classTList_html_a3026e979d86376d2f362044d5a94c71b"><div class="ttname"><a href="classTList.html#a3026e979d86376d2f362044d5a94c71b">TList::Remove</a></div><div class="ttdeci">virtual TObject * Remove(TObject *obj)</div><div class="ttdoc">Remove object from the list. </div><div class="ttdef"><b>Definition:</b> <a href="TList_8cxx_source.html#l00819">TList.cxx:819</a></div></div>
<div class="ttc" id="classTSpectrum_html_a22565bc179ec06fc52d9377905f71871a325c5b1acb8d5402c61b7a8b34f03595"><div class="ttname"><a href="classTSpectrum.html#a22565bc179ec06fc52d9377905f71871a325c5b1acb8d5402c61b7a8b34f03595">TSpectrum::kBackSmoothing7</a></div><div class="ttdef"><b>Definition:</b> <a href="TSpectrum_8h_source.html#l00045">TSpectrum.h:45</a></div></div>
<div class="ttc" id="namespaceROOT_1_1Math_1_1VectorUtil_html_a421c8e59ccf765d83def701c1ff8fa76"><div class="ttname"><a href="namespaceROOT_1_1Math_1_1VectorUtil.html#a421c8e59ccf765d83def701c1ff8fa76">ROOT::Math::VectorUtil::boost</a></div><div class="ttdeci">LVector boost(const LVector &amp;v, const BoostVector &amp;b)</div><div class="ttdoc"> Boost a generic Lorentz Vector class using a generic 3D Vector class describing the boost The only r...</div><div class="ttdef"><b>Definition:</b> <a href="GenVector_2VectorUtil_8h_source.html#l00327">VectorUtil.h:327</a></div></div>
<div class="ttc" id="classTSpectrum_html_ad354948fc1ff381b6e32d9b787ff7207"><div class="ttname"><a href="classTSpectrum.html#ad354948fc1ff381b6e32d9b787ff7207">TSpectrum::fHistogram</a></div><div class="ttdeci">TH1 * fHistogram</div><div class="ttdoc">resulting histogram </div><div class="ttdef"><b>Definition:</b> <a href="TSpectrum_8h_source.html#l00031">TSpectrum.h:31</a></div></div>
<div class="ttc" id="classTSpectrum_html_afc1624f993eab0e8c1b77db06a3bf839"><div class="ttname"><a href="classTSpectrum.html#afc1624f993eab0e8c1b77db06a3bf839">TSpectrum::fPositionY</a></div><div class="ttdeci">Double_t * fPositionY</div><div class="ttdoc">[fNPeaks] Y position of peaks </div><div class="ttdef"><b>Definition:</b> <a href="TSpectrum_8h_source.html#l00029">TSpectrum.h:29</a></div></div>
<div class="ttc" id="classTObject_html_abe1fb206304cfa1b8d1e77a4a4fd0120"><div class="ttname"><a href="classTObject.html#abe1fb206304cfa1b8d1e77a4a4fd0120">TObject::Error</a></div><div class="ttdeci">virtual void Error(const char *method, const char *msgfmt,...) const</div><div class="ttdoc">Issue error message. </div><div class="ttdef"><b>Definition:</b> <a href="TObject_8cxx_source.html#l00880">TObject.cxx:880</a></div></div>
<div class="ttc" id="classTSpectrum_html_a81b35e9f63977f017e8a31295f01e05e"><div class="ttname"><a href="classTSpectrum.html#a81b35e9f63977f017e8a31295f01e05e">TSpectrum::Deconvolution</a></div><div class="ttdeci">const char * Deconvolution(Double_t *source, const Double_t *response, Int_t ssize, Int_t numberIterations, Int_t numberRepetitions, Double_t boost)</div><div class="ttdoc">One-dimensional deconvolution function. </div><div class="ttdef"><b>Definition:</b> <a href="TSpectrum_8cxx_source.html#l01459">TSpectrum.cxx:1459</a></div></div>
<div class="ttc" id="classTSpectrum_html_abecd47dabed3e5b94893cc6e15ba6cd3"><div class="ttname"><a href="classTSpectrum.html#abecd47dabed3e5b94893cc6e15ba6cd3">TSpectrum::SetAverageWindow</a></div><div class="ttdeci">static void SetAverageWindow(Int_t w=3)</div><div class="ttdoc">Static function: Set average window of searched peaks (see TSpectrum::SearchHighRes). </div><div class="ttdef"><b>Definition:</b> <a href="TSpectrum_8cxx_source.html#l00099">TSpectrum.cxx:99</a></div></div>
<div class="ttc" id="classTSpectrum_html_aa32e2d562913b811498683ef6628b494"><div class="ttname"><a href="classTSpectrum.html#aa32e2d562913b811498683ef6628b494">TSpectrum::fgAverageWindow</a></div><div class="ttdeci">static Int_t fgAverageWindow</div><div class="ttdoc">Average window of searched peaks. </div><div class="ttdef"><b>Definition:</b> <a href="TSpectrum_8h_source.html#l00032">TSpectrum.h:32</a></div></div>
<div class="ttc" id="classTSpectrum_html_a22565bc179ec06fc52d9377905f71871a4133774c283c838d5473fa75127ae22f"><div class="ttname"><a href="classTSpectrum.html#a22565bc179ec06fc52d9377905f71871a4133774c283c838d5473fa75127ae22f">TSpectrum::kBackIncreasingWindow</a></div><div class="ttdef"><b>Definition:</b> <a href="TSpectrum_8h_source.html#l00041">TSpectrum.h:41</a></div></div>
<div class="ttc" id="classTAttMarker_html_a697e1a65975ff344c9dca7618fd44de4"><div class="ttname"><a href="classTAttMarker.html#a697e1a65975ff344c9dca7618fd44de4">TAttMarker::SetMarkerStyle</a></div><div class="ttdeci">virtual void SetMarkerStyle(Style_t mstyle=1)</div><div class="ttdoc">Set the marker style. </div><div class="ttdef"><b>Definition:</b> <a href="TAttMarker_8h_source.html#l00040">TAttMarker.h:40</a></div></div>
<div class="ttc" id="THbookFile_8cxx_html_a9c42f51718ed192ed1841a53d2b0e507"><div class="ttname"><a href="THbookFile_8cxx.html#a9c42f51718ed192ed1841a53d2b0e507">xmax</a></div><div class="ttdeci">float xmax</div><div class="ttdef"><b>Definition:</b> <a href="THbookFile_8cxx_source.html#l00093">THbookFile.cxx:93</a></div></div>
<div class="ttc" id="TSpectrum_8cxx_html_ade09a69507390390f0d1bd5b7d91826c"><div class="ttname"><a href="TSpectrum_8cxx.html#ade09a69507390390f0d1bd5b7d91826c">PEAK_WINDOW</a></div><div class="ttdeci">#define PEAK_WINDOW</div><div class="ttdef"><b>Definition:</b> <a href="TSpectrum_8cxx_source.html#l00044">TSpectrum.cxx:44</a></div></div>
<div class="ttc" id="classTSpectrum_html_aaddbb07c90d5659a6dcee8e1f3c1c801"><div class="ttname"><a href="classTSpectrum.html#aaddbb07c90d5659a6dcee8e1f3c1c801">TSpectrum::SetDeconIterations</a></div><div class="ttdeci">static void SetDeconIterations(Int_t n=3)</div><div class="ttdoc">Static function: Set max number of decon iterations in deconvolution operation (see TSpectrum::Search...</div><div class="ttdef"><b>Definition:</b> <a href="TSpectrum_8cxx_source.html#l00108">TSpectrum.cxx:108</a></div></div>
<div class="ttc" id="classTAttMarker_html_a95522acfc3fa6157f317f9993edfa047"><div class="ttname"><a href="classTAttMarker.html#a95522acfc3fa6157f317f9993edfa047">TAttMarker::SetMarkerSize</a></div><div class="ttdeci">virtual void SetMarkerSize(Size_t msize=1)</div><div class="ttdoc">Set the marker size. </div><div class="ttdef"><b>Definition:</b> <a href="TAttMarker_8h_source.html#l00041">TAttMarker.h:41</a></div></div>
<div class="ttc" id="RSha256_8hxx_html_acf9942d15f0dd0ac4fc5ca66096a3f6d"><div class="ttname"><a href="RSha256_8hxx.html#acf9942d15f0dd0ac4fc5ca66096a3f6d">h</a></div><div class="ttdeci">#define h(i)</div><div class="ttdef"><b>Definition:</b> <a href="RSha256_8hxx_source.html#l00106">RSha256.hxx:106</a></div></div>
<div class="ttc" id="classTSpectrum_html_a22565bc179ec06fc52d9377905f71871a22ca3a5b1f9745fabaaa8bef2cb39d35"><div class="ttname"><a href="classTSpectrum.html#a22565bc179ec06fc52d9377905f71871a22ca3a5b1f9745fabaaa8bef2cb39d35">TSpectrum::kBackOrder2</a></div><div class="ttdef"><b>Definition:</b> <a href="TSpectrum_8h_source.html#l00037">TSpectrum.h:37</a></div></div>
<div class="ttc" id="RtypesCore_8h_html_a7e568baf910535e8ffd438acb843434d"><div class="ttname"><a href="RtypesCore_8h.html#a7e568baf910535e8ffd438acb843434d">kFALSE</a></div><div class="ttdeci">const Bool_t kFALSE</div><div class="ttdef"><b>Definition:</b> <a href="RtypesCore_8h_source.html#l00088">RtypesCore.h:88</a></div></div>
<div class="ttc" id="classTSpectrum_html_a53f173c4f5b494badfdd86c4d989af8b"><div class="ttname"><a href="classTSpectrum.html#a53f173c4f5b494badfdd86c4d989af8b">TSpectrum::TSpectrum</a></div><div class="ttdeci">TSpectrum()</div><div class="ttdoc">Constructor. </div><div class="ttdef"><b>Definition:</b> <a href="TSpectrum_8cxx_source.html#l00050">TSpectrum.cxx:50</a></div></div>
<div class="ttc" id="RSha256_8hxx_html_a23b5b0a85bf5762c93a855f40c0343ce"><div class="ttname"><a href="RSha256_8hxx.html#a23b5b0a85bf5762c93a855f40c0343ce">d</a></div><div class="ttdeci">#define d(i)</div><div class="ttdef"><b>Definition:</b> <a href="RSha256_8hxx_source.html#l00102">RSha256.hxx:102</a></div></div>
<div class="ttc" id="TPolyMarker_8h_html"><div class="ttname"><a href="TPolyMarker_8h.html">TPolyMarker.h</a></div></div>
<div class="ttc" id="namespaceTMath_html_a428950de9bddacfb35915a9603880005"><div class="ttname"><a href="namespaceTMath.html#a428950de9bddacfb35915a9603880005">TMath::Exp</a></div><div class="ttdeci">Double_t Exp(Double_t x)</div><div class="ttdef"><b>Definition:</b> <a href="TMath_8h_source.html#l00715">TMath.h:715</a></div></div>
<div class="ttc" id="classTPolyMarker_html"><div class="ttname"><a href="classTPolyMarker.html">TPolyMarker</a></div><div class="ttdoc">A PolyMarker is defined by an array on N points in a 2-D space. </div><div class="ttdef"><b>Definition:</b> <a href="TPolyMarker_8h_source.html#l00031">TPolyMarker.h:31</a></div></div>
<div class="ttc" id="Rtypes_8h_html_a3f9bf160bbbb44209e95556960836b96"><div class="ttname"><a href="Rtypes_8h.html#a3f9bf160bbbb44209e95556960836b96">ClassImp</a></div><div class="ttdeci">#define ClassImp(name)</div><div class="ttdef"><b>Definition:</b> <a href="Rtypes_8h_source.html#l00365">Rtypes.h:365</a></div></div>
<div class="ttc" id="classTSpectrum_html_ad95336e041209b67e899e30ee9809297"><div class="ttname"><a href="classTSpectrum.html#ad95336e041209b67e899e30ee9809297">TSpectrum::Print</a></div><div class="ttdeci">virtual void Print(Option_t *option=&quot;&quot;) const</div><div class="ttdoc">Print the array of positions. </div><div class="ttdef"><b>Definition:</b> <a href="TSpectrum_8cxx_source.html#l00219">TSpectrum.cxx:219</a></div></div>
<div class="ttc" id="RtypesCore_8h_html_ab9b5334647b78ec4256db251e3ae1fc6"><div class="ttname"><a href="RtypesCore_8h.html#ab9b5334647b78ec4256db251e3ae1fc6">Double_t</a></div><div class="ttdeci">double Double_t</div><div class="ttdef"><b>Definition:</b> <a href="RtypesCore_8h_source.html#l00055">RtypesCore.h:55</a></div></div>
<div class="ttc" id="classTSpectrum_html_a56e15d1c36c7557b17d5f6d68fa315a7"><div class="ttname"><a href="classTSpectrum.html#a56e15d1c36c7557b17d5f6d68fa315a7">TSpectrum::Background</a></div><div class="ttdeci">virtual TH1 * Background(const TH1 *hist, Int_t niter=20, Option_t *option=&quot;&quot;)</div><div class="ttdoc">One-dimensional background estimation function. </div><div class="ttdef"><b>Definition:</b> <a href="TSpectrum_8cxx_source.html#l00152">TSpectrum.cxx:152</a></div></div>
<div class="ttc" id="classTSpectrum_html_ac5b94cc0438601683a9719a217659554"><div class="ttname"><a href="classTSpectrum.html#ac5b94cc0438601683a9719a217659554">TSpectrum::fgIterations</a></div><div class="ttdeci">static Int_t fgIterations</div><div class="ttdoc">Maximum number of decon iterations (default=3) </div><div class="ttdef"><b>Definition:</b> <a href="TSpectrum_8h_source.html#l00033">TSpectrum.h:33</a></div></div>
<div class="ttc" id="classTSpectrum_html_a22565bc179ec06fc52d9377905f71871af1af12f6d81dd70d82c188845db4af20"><div class="ttname"><a href="classTSpectrum.html#a22565bc179ec06fc52d9377905f71871af1af12f6d81dd70d82c188845db4af20">TSpectrum::kBackSmoothing3</a></div><div class="ttdef"><b>Definition:</b> <a href="TSpectrum_8h_source.html#l00043">TSpectrum.h:43</a></div></div>
<div class="ttc" id="classTSpectrum_html_a10e78d271e709357110ae070b47d3add"><div class="ttname"><a href="classTSpectrum.html#a10e78d271e709357110ae070b47d3add">TSpectrum::fMaxPeaks</a></div><div class="ttdeci">Int_t fMaxPeaks</div><div class="ttdoc">Maximum number of peaks to be found. </div><div class="ttdef"><b>Definition:</b> <a href="TSpectrum_8h_source.html#l00025">TSpectrum.h:25</a></div></div>
<div class="ttc" id="classTString_html_aefd4aa6797ae0fd7e63345def5c0be92"><div class="ttname"><a href="classTString.html#aefd4aa6797ae0fd7e63345def5c0be92">TString::Contains</a></div><div class="ttdeci">Bool_t Contains(const char *pat, ECaseCompare cmp=kExact) const</div><div class="ttdef"><b>Definition:</b> <a href="TString_8h_source.html#l00619">TString.h:619</a></div></div>
<div class="ttc" id="classTH1_html"><div class="ttname"><a href="classTH1.html">TH1</a></div><div class="ttdoc">The TH1 histogram class. </div><div class="ttdef"><b>Definition:</b> <a href="TH1_8h_source.html#l00056">TH1.h:56</a></div></div>
<div class="ttc" id="TRolke_8cxx_html_a680432d265de4ea2534f8ec32f1aa417"><div class="ttname"><a href="TRolke_8cxx.html#a680432d265de4ea2534f8ec32f1aa417">e</a></div><div class="ttdeci">you should not use this method at all Int_t Int_t Double_t Double_t Double_t e</div><div class="ttdef"><b>Definition:</b> <a href="TRolke_8cxx_source.html#l00630">TRolke.cxx:630</a></div></div>
<div class="ttc" id="classTSpectrum_html_a46b603bd0a41f8fa7c2501e164c05b54"><div class="ttname"><a href="classTSpectrum.html#a46b603bd0a41f8fa7c2501e164c05b54">TSpectrum::SetResolution</a></div><div class="ttdeci">void SetResolution(Double_t resolution=1)</div><div class="ttdoc">NOT USED resolution: determines resolution of the neighbouring peaks default value is 1 correspond to...</div><div class="ttdef"><b>Definition:</b> <a href="TSpectrum_8cxx_source.html#l00351">TSpectrum.cxx:351</a></div></div>
<div class="ttc" id="classTSpectrum_html"><div class="ttname"><a href="classTSpectrum.html">TSpectrum</a></div><div class="ttdoc">Advanced Spectra Processing. </div><div class="ttdef"><b>Definition:</b> <a href="TSpectrum_8h_source.html#l00018">TSpectrum.h:18</a></div></div>
<div class="ttc" id="THbookFile_8cxx_html_afd214e8166a9dd362f9907c59e5e2420"><div class="ttname"><a href="THbookFile_8cxx.html#afd214e8166a9dd362f9907c59e5e2420">hbname</a></div><div class="ttdeci">#define hbname</div><div class="ttdef"><b>Definition:</b> <a href="THbookFile_8cxx_source.html#l00123">THbookFile.cxx:123</a></div></div>
<div class="ttc" id="TSpectrum_8h_html"><div class="ttname"><a href="TSpectrum_8h.html">TSpectrum.h</a></div></div>
<div class="ttc" id="classTSpectrum_html_ab2eb713ff50f5ea77d1b456ef4aeee93"><div class="ttname"><a href="classTSpectrum.html#ab2eb713ff50f5ea77d1b456ef4aeee93">TSpectrum::fPosition</a></div><div class="ttdeci">Double_t * fPosition</div><div class="ttdoc">[fNPeaks] array of current peak positions </div><div class="ttdef"><b>Definition:</b> <a href="TSpectrum_8h_source.html#l00027">TSpectrum.h:27</a></div></div>
<div class="ttc" id="classTList_html_a1b90ccfbde1729266b585194fa45df14"><div class="ttname"><a href="classTList.html#a1b90ccfbde1729266b585194fa45df14">TList::Add</a></div><div class="ttdeci">virtual void Add(TObject *obj)</div><div class="ttdef"><b>Definition:</b> <a href="TList_8h_source.html#l00087">TList.h:87</a></div></div>
<div class="ttc" id="textangle_8C_html_a3359d7f1aa9fe2f8bc884b02020e8d20"><div class="ttname"><a href="textangle_8C.html#a3359d7f1aa9fe2f8bc884b02020e8d20">l</a></div><div class="ttdeci">auto * l</div><div class="ttdef"><b>Definition:</b> <a href="textangle_8C_source.html#l00004">textangle.C:4</a></div></div>
<div class="ttc" id="classTSpectrum_html_a22565bc179ec06fc52d9377905f71871a7f8038087d885e41b186a81ff9c85a2c"><div class="ttname"><a href="classTSpectrum.html#a22565bc179ec06fc52d9377905f71871a7f8038087d885e41b186a81ff9c85a2c">TSpectrum::kBackDecreasingWindow</a></div><div class="ttdef"><b>Definition:</b> <a href="TSpectrum_8h_source.html#l00042">TSpectrum.h:42</a></div></div>
<div class="ttc" id="triangle_8c_html_aa22f343c7ac709eab3fdd162721759a1"><div class="ttname"><a href="triangle_8c.html#aa22f343c7ac709eab3fdd162721759a1">dest</a></div><div class="ttdeci">#define dest(otri, vertexptr)</div><div class="ttdef"><b>Definition:</b> <a href="triangle_8c_source.html#l01040">triangle.c:1040</a></div></div>
<div class="ttc" id="classTSpectrum_html_af2b4ae59d35493a236d120c70aaad731"><div class="ttname"><a href="classTSpectrum.html#af2b4ae59d35493a236d120c70aaad731">TSpectrum::StaticSearch</a></div><div class="ttdeci">static Int_t StaticSearch(const TH1 *hist, Double_t sigma=2, Option_t *option=&quot;goff&quot;, Double_t threshold=0.05)</div><div class="ttdoc">Static function, interface to TSpectrum::Search. </div><div class="ttdef"><b>Definition:</b> <a href="TSpectrum_8cxx_source.html#l02577">TSpectrum.cxx:2577</a></div></div>
<div class="ttc" id="TRolke_8cxx_html_a1a2354f40e332ad13673b70afc2c0dbf"><div class="ttname"><a href="TRolke_8cxx.html#a1a2354f40e332ad13673b70afc2c0dbf">b</a></div><div class="ttdeci">you should not use this method at all Int_t Int_t Double_t Double_t Double_t Int_t Double_t Double_t Double_t Double_t b</div><div class="ttdef"><b>Definition:</b> <a href="TRolke_8cxx_source.html#l00630">TRolke.cxx:630</a></div></div>
<div class="ttc" id="TH1_8h_html"><div class="ttname"><a href="TH1_8h.html">TH1.h</a></div></div>
<div class="ttc" id="civetweb_8c_html_aa367b75c5aed883fef5befbdf04835a4"><div class="ttname"><a href="civetweb_8c.html#aa367b75c5aed883fef5befbdf04835a4">snprintf</a></div><div class="ttdeci">#define snprintf</div><div class="ttdef"><b>Definition:</b> <a href="civetweb_8c_source.html#l01540">civetweb.c:1540</a></div></div>
<div class="ttc" id="TVirtualPad_8h_html_a376b3a920d36f3366fb6a4c9e424aa8c"><div class="ttname"><a href="TVirtualPad_8h.html#a376b3a920d36f3366fb6a4c9e424aa8c">gPad</a></div><div class="ttdeci">#define gPad</div><div class="ttdef"><b>Definition:</b> <a href="TVirtualPad_8h_source.html#l00286">TVirtualPad.h:286</a></div></div>
<div class="ttc" id="RSha256_8hxx_html_a63f410abde93141c9013b7d3f3971738"><div class="ttname"><a href="RSha256_8hxx.html#a63f410abde93141c9013b7d3f3971738">c</a></div><div class="ttdeci">#define c(i)</div><div class="ttdef"><b>Definition:</b> <a href="RSha256_8hxx_source.html#l00101">RSha256.hxx:101</a></div></div>
<div class="ttc" id="classTSpectrum_html_a63a4881270541655c2535c46ec52ce6d"><div class="ttname"><a href="classTSpectrum.html#a63a4881270541655c2535c46ec52ce6d">TSpectrum::fNPeaks</a></div><div class="ttdeci">Int_t fNPeaks</div><div class="ttdoc">number of peaks found </div><div class="ttdef"><b>Definition:</b> <a href="TSpectrum_8h_source.html#l00026">TSpectrum.h:26</a></div></div>
<div class="ttc" id="namespacefirst_html"><div class="ttname"><a href="namespacefirst.html">first</a></div><div class="ttdef"><b>Definition:</b> <a href="first_8py_source.html#l00001">first.py:1</a></div></div>
<div class="ttc" id="classTSpectrum_html_a22565bc179ec06fc52d9377905f71871a192bec0ffbdc8def548e1907a7bad96f"><div class="ttname"><a href="classTSpectrum.html#a22565bc179ec06fc52d9377905f71871a192bec0ffbdc8def548e1907a7bad96f">TSpectrum::kBackSmoothing15</a></div><div class="ttdef"><b>Definition:</b> <a href="TSpectrum_8h_source.html#l00049">TSpectrum.h:49</a></div></div>
<div class="ttc" id="namespaceTMath_html_a9ea900c956031cb12057acf7c322b0fa"><div class="ttname"><a href="namespaceTMath.html#a9ea900c956031cb12057acf7c322b0fa">TMath::Sqrt</a></div><div class="ttdeci">Double_t Sqrt(Double_t x)</div><div class="ttdef"><b>Definition:</b> <a href="TMath_8h_source.html#l00679">TMath.h:679</a></div></div>
<div class="ttc" id="TMath_8h_html"><div class="ttname"><a href="TMath_8h.html">TMath.h</a></div></div>
<div class="ttc" id="classTH1_html_a4f38ff3c9c675313fc647d32c87ea07a"><div class="ttname"><a href="classTH1.html#a4f38ff3c9c675313fc647d32c87ea07a">TH1::GetListOfFunctions</a></div><div class="ttdeci">TList * GetListOfFunctions() const</div><div class="ttdef"><b>Definition:</b> <a href="TH1_8h_source.html#l00239">TH1.h:239</a></div></div>
<div class="ttc" id="classTSpectrum_html_a2767b767d39ee7826e9a50b9c0359beb"><div class="ttname"><a href="classTSpectrum.html#a2767b767d39ee7826e9a50b9c0359beb">TSpectrum::SmoothMarkov</a></div><div class="ttdeci">const char * SmoothMarkov(Double_t *source, Int_t ssize, Int_t averWindow)</div><div class="ttdoc">One-dimensional markov spectrum smoothing function. </div><div class="ttdef"><b>Definition:</b> <a href="TSpectrum_8cxx_source.html#l01195">TSpectrum.cxx:1195</a></div></div>
<div class="ttc" id="RtypesCore_8h_html_af2f51d30ccd86e85be3e3e69793a86ef"><div class="ttname"><a href="RtypesCore_8h.html#af2f51d30ccd86e85be3e3e69793a86ef">kTRUE</a></div><div class="ttdeci">const Bool_t kTRUE</div><div class="ttdef"><b>Definition:</b> <a href="RtypesCore_8h_source.html#l00087">RtypesCore.h:87</a></div></div>
<div class="ttc" id="classTSpectrum_html_a22565bc179ec06fc52d9377905f71871a167fc10caa2484d4d3dfae3347c05303"><div class="ttname"><a href="classTSpectrum.html#a22565bc179ec06fc52d9377905f71871a167fc10caa2484d4d3dfae3347c05303">TSpectrum::kBackSmoothing11</a></div><div class="ttdef"><b>Definition:</b> <a href="TSpectrum_8h_source.html#l00047">TSpectrum.h:47</a></div></div>
<div class="ttc" id="legend1_8C_html_a16daaa7b596941b23915a1ac1be5b42c"><div class="ttname"><a href="legend1_8C.html#a16daaa7b596941b23915a1ac1be5b42c">n</a></div><div class="ttdeci">const Int_t n</div><div class="ttdef"><b>Definition:</b> <a href="legend1_8C_source.html#l00016">legend1.C:16</a></div></div>
<div class="ttc" id="classTSpectrum_html_a2d2ba4e2d371c17fb6804c9959a2d539"><div class="ttname"><a href="classTSpectrum.html#a2d2ba4e2d371c17fb6804c9959a2d539">TSpectrum::Unfolding</a></div><div class="ttdeci">const char * Unfolding(Double_t *source, const Double_t **respMatrix, Int_t ssizex, Int_t ssizey, Int_t numberIterations, Int_t numberRepetitions, Double_t boost)</div><div class="ttdoc">One-dimensional unfolding function. </div><div class="ttdef"><b>Definition:</b> <a href="TSpectrum_8cxx_source.html#l01889">TSpectrum.cxx:1889</a></div></div>
<div class="ttc" id="classTSpectrum_html_a02fdb00792c69d8b34aa78e42b6682e1"><div class="ttname"><a href="classTSpectrum.html#a02fdb00792c69d8b34aa78e42b6682e1">TSpectrum::fResolution</a></div><div class="ttdeci">Double_t fResolution</div><div class="ttdoc">NOT USED resolution of the neighboring peaks </div><div class="ttdef"><b>Definition:</b> <a href="TSpectrum_8h_source.html#l00030">TSpectrum.h:30</a></div></div>
<div class="ttc" id="classTObject_html_a75fddd7eef38a13c1374130ec7dc5cf8"><div class="ttname"><a href="classTObject.html#a75fddd7eef38a13c1374130ec7dc5cf8">TObject::Warning</a></div><div class="ttdeci">virtual void Warning(const char *method, const char *msgfmt,...) const</div><div class="ttdoc">Issue warning message. </div><div class="ttdef"><b>Definition:</b> <a href="TObject_8cxx_source.html#l00866">TObject.cxx:866</a></div></div>
<div class="ttc" id="classTH1_html_a3d91d3762b9789bd6e54e67d8ccce2e6"><div class="ttname"><a href="classTH1.html#a3d91d3762b9789bd6e54e67d8ccce2e6">TH1::GetXaxis</a></div><div class="ttdeci">TAxis * GetXaxis()</div><div class="ttdoc">Get the behaviour adopted by the object about the statoverflows. See EStatOverflows for more informat...</div><div class="ttdef"><b>Definition:</b> <a href="TH1_8h_source.html#l00316">TH1.h:316</a></div></div>
<div class="ttc" id="classTString_html_a7e4ada8bf2407b461f3ee58b71c5959f"><div class="ttname"><a href="classTString.html#a7e4ada8bf2407b461f3ee58b71c5959f">TString::Data</a></div><div class="ttdeci">const char * Data() const</div><div class="ttdef"><b>Definition:</b> <a href="TString_8h_source.html#l00364">TString.h:364</a></div></div>
</div><!-- fragment --></div><!-- contents -->
<html>
<body>
<div id="footer" style="background-color:#E5EBF3;">
<small>
<img class="footer" src="rootlogo_s.gif" alt="root"/></a>
ROOT 6.18/03 - Reference Guide Generated on Thu Aug 29 2019 04:09:22 (GVA Time) using Doxygen 1.8.14.
</small>
</div>
</body>
</html>
