<!-- HTML header for doxygen 1.8.6-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.14"/>
<title>ROOT: tutorials/roostats/rs_bernsteinCorrection.C File Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/x-mathjax-config">
  MathJax.Hub.Config({
    extensions: ["tex2jax.js"],
    jax: ["input/TeX","output/HTML-CSS"],
});
</script><script type="text/javascript" async src="./mathjax/MathJax.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="ROOT.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table bgcolor="#346295" cellspacing="0" cellpadding="0">
  <tr>
    <td> <img style="height:90px" alt="Logo" src="rootlogo.gif"/> </td>
    <td valign="middle" style="color: #FFFFFF" nowrap="nowrap"><font size="6">ROOT</font> &#160; 6.18/03 <br> Reference Guide </td>
    <td style="width:100%"> </td>
  </tr>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.14 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div id="nav-path" class="navpath">
  <ul>
<li class="navelem"><a class="el" href="dir_0d353d24d0afa59909efab6593124f6d.html">tutorials</a></li><li class="navelem"><a class="el" href="dir_87facaa6959ceb8d3dacccaf663f7b84.html">roostats</a></li>  </ul>
</div>
</div><!-- top -->
<div class="header">
  <div class="headertitle">
<div class="title">rs_bernsteinCorrection.C File Reference<div class="ingroups"><a class="el" href="group__Tutorials.html">Tutorials</a> &raquo; <a class="el" href="group__tutorial__roostats.html">RooStats Tutorials</a></div></div>  </div>
</div><!--header-->
<div class="contents">
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<div class="textblock"><p> <a href="http://nbviewer.jupyter.org/url/root.cern.ch/doc/master/notebooks/rs_bernsteinCorrection.C.nbconvert.ipynb" target="_blank"><img src= notebook.gif alt="View in nbviewer" style="height:1em" ></a> <a href="https://cern.ch/swanserver/cgi-bin/go?projurl=https://root.cern.ch/doc/master/notebooks/rs_bernsteinCorrection.C.nbconvert.ipynb" target="_blank"><img src="http://swanserver.web.cern.ch/swanserver/images/badge_swan_white_150.png"  alt="Open in SWAN" style="height:1em" ></a>  Example of the BernsteinCorrection utility in <a class="el" href="namespaceRooStats.html" title="Namespace for the RooStats classes. ">RooStats</a>. </p>
<p>The idea is that one has a distribution coming either from data or Monte Carlo (called "reality" in the macro) and a nominal model that is not sufficiently flexible to take into account the real distribution. One wants to take into account the systematic associated with this imperfect modeling by augmenting the nominal model with some correction term (in this case a polynomial). The BernsteinCorrection utility will import into your workspace a corrected model given by nominal(x) * poly_N(x), where poly_N is an n-th order polynomial in the Bernstein basis. The degree N of the polynomial is chosen by specifying the tolerance one has in adding an extra term to the polynomial. The Bernstein basis is nice because it only has positive-definite terms and works well with PDFs. Finally, the macro makes a plot of:</p><ul>
<li>the data (drawn from 'reality'),</li>
<li>the best fit of the nominal model (blue)</li>
<li>and the best fit corrected model.</li>
</ul>
<div class="image">
<img src="pict1_rs_bernsteinCorrection.C.png" alt="pict1_rs_bernsteinCorrection.C.png" width="700"/>
</div>
 <div class="fragment"><div class="line"></div><div class="line"></div><div class="line">[1mRooFit v3.60 -- Developed by Wouter Verkerke and David Kirkby[0m </div><div class="line">                Copyright (C) 2000-2013 NIKHEF, University of California &amp; Stanford University</div><div class="line">                All rights reserved, please read http://roofit.sourceforge.net/license.txt</div><div class="line"></div><div class="line">[#1] INFO:ObjectHandling -- RooWorkspace::import(myWorksspace) importing dataset realityData</div><div class="line">[#1] INFO:ObjectHandling -- RooWorkSpace::import(myWorksspace) changing name of dataset from  realityData to data</div><div class="line">[#1] INFO:ObjectHandling -- RooWorkspace::import(myWorksspace) importing RooRealVar::x</div><div class="line">[#1] INFO:ObjectHandling -- RooWorkspace::import(myWorksspace) importing RooGaussian::nominal</div><div class="line">[#1] INFO:ObjectHandling -- RooWorkspace::import(myWorksspace) importing RooConstVar::0</div><div class="line">[#1] INFO:ObjectHandling -- RooWorkspace::import(myWorksspace) importing RooRealVar::sigma</div><div class="line">BernsteinCorrection::ImportCorrectedPdf -  Doing initial Fit with nominal model </div><div class="line">[#1] INFO:Minization -- createNLL: caching constraint set under name CONSTR_OF_PDF_nominal_FOR_OBS_x with 0 entries</div><div class="line">[#1] INFO:Minization -- RooMinimizer::optimizeConst: activating const optimization</div><div class="line">[#1] INFO:Minization -- RooMinimizer::optimizeConst: deactivating const optimization</div><div class="line">[#1] INFO:NumericIntegration -- RooRealIntegral::init(corrected_clone_Int[x]) using numeric integrator RooIntegrator1D to calculate Int(x)</div><div class="line">[#1] INFO:Minization -- RooMinimizer::optimizeConst: activating const optimization</div><div class="line">[#1] INFO:Minization -- RooMinimizer::optimizeConst: deactivating const optimization</div><div class="line">[#1] INFO:NumericIntegration -- RooRealIntegral::init(corrected_clone_Int[x]) using numeric integrator RooIntegrator1D to calculate Int(x)</div><div class="line">[#1] INFO:Minization -- RooMinimizer::optimizeConst: activating const optimization</div><div class="line">[#1] INFO:Minization -- RooMinimizer::optimizeConst: deactivating const optimization</div><div class="line">[#1] INFO:NumericIntegration -- RooRealIntegral::init(corrected_clone_Int[x]) using numeric integrator RooIntegrator1D to calculate Int(x)</div><div class="line">[#1] INFO:Minization -- RooMinimizer::optimizeConst: activating const optimization</div><div class="line">[#1] INFO:Minization -- RooMinimizer::optimizeConst: deactivating const optimization</div><div class="line">[#1] INFO:NumericIntegration -- RooRealIntegral::init(corrected_clone_Int[x]) using numeric integrator RooIntegrator1D to calculate Int(x)</div><div class="line">[#1] INFO:Minization -- RooMinimizer::optimizeConst: activating const optimization</div><div class="line">[#1] INFO:Minization -- RooMinimizer::optimizeConst: deactivating const optimization</div><div class="line">[#1] INFO:NumericIntegration -- RooRealIntegral::init(corrected_clone_Int[x]) using numeric integrator RooIntegrator1D to calculate Int(x)</div><div class="line">[#1] INFO:Minization -- RooMinimizer::optimizeConst: activating const optimization</div><div class="line">[#1] INFO:Minization -- RooMinimizer::optimizeConst: deactivating const optimization</div><div class="line">[#1] INFO:NumericIntegration -- RooRealIntegral::init(corrected_clone_Int[x]) using numeric integrator RooIntegrator1D to calculate Int(x)</div><div class="line">[#1] INFO:Minization -- RooMinimizer::optimizeConst: activating const optimization</div><div class="line">[#1] INFO:Minization -- RooMinimizer::optimizeConst: deactivating const optimization</div><div class="line">[#1] INFO:ObjectHandling -- RooWorkspace::import(myWorksspace) importing RooEffProd::corrected</div><div class="line">[#1] INFO:ObjectHandling -- RooWorkspace::import(myWorksspace) importing RooBernstein::poly</div><div class="line">[#1] INFO:ObjectHandling -- RooWorkspace::import(myWorksspace) importing RooRealVar::c_0</div><div class="line">[#1] INFO:ObjectHandling -- RooWorkspace::import(myWorksspace) importing RooRealVar::c_1</div><div class="line">[#1] INFO:ObjectHandling -- RooWorkspace::import(myWorksspace) importing RooRealVar::c_2</div><div class="line">[#1] INFO:ObjectHandling -- RooWorkspace::import(myWorksspace) importing RooRealVar::c_3</div><div class="line">[#1] INFO:ObjectHandling -- RooWorkspace::import(myWorksspace) importing RooRealVar::c_4</div><div class="line">[#1] INFO:ObjectHandling -- RooWorkspace::import(myWorksspace) importing RooRealVar::c_5</div><div class="line">[#1] INFO:ObjectHandling -- RooWorkspace::import(myWorksspace) importing RooRealVar::c_6</div><div class="line">------ Begin Bernstein Correction Log --------</div><div class="line">degree = 1 -log L(0) = 1216.78 -log L(1) = 1208.89 q = 15.7692 P(chi^2_1 &gt; q) = 7.1557e-05</div><div class="line">degree = 2 -log L(1) = 1208.89 -log L(2) = 1203.21 q = 11.3692 P(chi^2_1 &gt; q) = 0.000746732</div><div class="line">degree = 3 -log L(2) = 1203.21 -log L(3) = 1198.85 q = 8.72213 P(chi^2_1 &gt; q) = 0.00314371</div><div class="line">degree = 4 -log L(3) = 1198.85 -log L(4) = 1190.19 q = 17.3163 P(chi^2_1 &gt; q) = 3.1646e-05</div><div class="line">degree = 5 -log L(4) = 1190.19 -log L(5) = 1183.56 q = 13.259 P(chi^2_1 &gt; q) = 0.00027127</div><div class="line">degree = 6 -log L(5) = 1183.56 -log L(6) = 1182.57 q = 1.98376 P(chi^2_1 &gt; q) = 0.158995</div><div class="line">------ End Bernstein Correction Log --------</div><div class="line"> Correction based on Bernstein Poly of degree 6</div><div class="line">[#1] INFO:Minization -- RooMinimizer::optimizeConst: activating const optimization</div><div class="line">Minuit2Minimizer: Minimize with max-calls 500 convergence for edm &lt; 1 strategy 1</div><div class="line">Minuit2Minimizer : Valid minimum - status = 0</div><div class="line">FVAL  = 1216.77793416266263</div><div class="line">Edm   = 4.16187321843267985e-07</div><div class="line">Nfcn  = 19</div><div class="line">sigma   = 1.18138  +/-  0.0315451   (limited)</div><div class="line">[#1] INFO:Minization -- RooMinimizer::optimizeConst: deactivating const optimization</div><div class="line">[#1] INFO:NumericIntegration -- RooRealIntegral::init(corrected_clone_Int[x]) using numeric integrator RooIntegrator1D to calculate Int(x)</div><div class="line">[#1] INFO:Minization -- createNLL: caching constraint set under name CONSTR_OF_PDF_corrected_FOR_OBS_x with 0 entries</div><div class="line">[#1] INFO:Minization -- RooMinimizer::optimizeConst: activating const optimization</div><div class="line">Minuit2Minimizer: Minimize with max-calls 3500 convergence for edm &lt; 1 strategy 1</div><div class="line">Minuit2Minimizer : Valid minimum - status = 0</div><div class="line">FVAL  = 1182.56771175955873</div><div class="line">Edm   = 0.000104308534890513858</div><div class="line">Nfcn  = 184</div><div class="line">c_1     = 3.1837   +/-  0.834348 (limited)</div><div class="line">c_2     = 1.2322e-05  +/-  3.09822  (limited)</div><div class="line">c_3     = 1.61168e-06    +/-  1.52589  (limited)</div><div class="line">c_4     = 0.971334    +/-  2.5239   (limited)</div><div class="line">c_5     = 0.200166    +/-  75.522   (limited)</div><div class="line">c_6     = 10.5071  +/-  22.97 (limited)</div><div class="line">sigma   = 1.26617  +/-  0.232029 (limited)</div><div class="line">[#1] INFO:Minization -- RooMinimizer::optimizeConst: deactivating const optimization</div><div class="line">[#1] INFO:NumericIntegration -- RooRealIntegral::init(corrected_clone_Int[x]) using numeric integrator RooIntegrator1D to calculate Int(x)</div><div class="line">made pdfs, make toy generator</div><div class="line">on toy 0</div><div class="line">on toy 1</div><div class="line">on toy 2</div><div class="line">on toy 3</div><div class="line">on toy 4</div><div class="line">on toy 5</div><div class="line">on toy 6</div><div class="line">on toy 7</div><div class="line">on toy 8</div><div class="line">on toy 9</div><div class="line">on toy 10</div><div class="line">on toy 11</div><div class="line">on toy 12</div><div class="line">on toy 13</div><div class="line">on toy 14</div><div class="line">on toy 15</div><div class="line">on toy 16</div><div class="line">on toy 17</div><div class="line">on toy 18</div><div class="line">on toy 19</div></div><!-- fragment --> <div class="fragment"><div class="line"></div><div class="line"><span class="preprocessor">#include &quot;<a class="code" href="RooDataSet_8h.html">RooDataSet.h</a>&quot;</span></div><div class="line"><span class="preprocessor">#include &quot;<a class="code" href="RooRealVar_8h.html">RooRealVar.h</a>&quot;</span></div><div class="line"><span class="preprocessor">#include &quot;<a class="code" href="RooConstVar_8h.html">RooConstVar.h</a>&quot;</span></div><div class="line"><span class="preprocessor">#include &quot;<a class="code" href="RooBernstein_8h.html">RooBernstein.h</a>&quot;</span></div><div class="line"><span class="preprocessor">#include &quot;<a class="code" href="TCanvas_8h.html">TCanvas.h</a>&quot;</span></div><div class="line"><span class="preprocessor">#include &quot;<a class="code" href="RooAbsPdf_8h.html">RooAbsPdf.h</a>&quot;</span></div><div class="line"><span class="preprocessor">#include &quot;<a class="code" href="RooFit_8h.html">RooFit.h</a>&quot;</span></div><div class="line"><span class="preprocessor">#include &quot;<a class="code" href="RooFitResult_8h.html">RooFitResult.h</a>&quot;</span></div><div class="line"><span class="preprocessor">#include &quot;<a class="code" href="RooPlot_8h.html">RooPlot.h</a>&quot;</span></div><div class="line"><span class="preprocessor">#include &lt;string&gt;</span></div><div class="line"><span class="preprocessor">#include &lt;vector&gt;</span></div><div class="line"><span class="preprocessor">#include &lt;stdio.h&gt;</span></div><div class="line"><span class="preprocessor">#include &lt;sstream&gt;</span></div><div class="line"><span class="preprocessor">#include &lt;iostream&gt;</span></div><div class="line"></div><div class="line"><span class="preprocessor">#include &quot;<a class="code" href="RooProdPdf_8h.html">RooProdPdf.h</a>&quot;</span></div><div class="line"><span class="preprocessor">#include &quot;<a class="code" href="RooAddPdf_8h.html">RooAddPdf.h</a>&quot;</span></div><div class="line"><span class="preprocessor">#include &quot;<a class="code" href="RooGaussian_8h.html">RooGaussian.h</a>&quot;</span></div><div class="line"><span class="preprocessor">#include &quot;<a class="code" href="RooNLLVar_8h.html">RooNLLVar.h</a>&quot;</span></div><div class="line"><span class="preprocessor">#include &quot;<a class="code" href="RooMinuit_8h.html">RooMinuit.h</a>&quot;</span></div><div class="line"><span class="preprocessor">#include &quot;<a class="code" href="RooProfileLL_8h.html">RooProfileLL.h</a>&quot;</span></div><div class="line"><span class="preprocessor">#include &quot;<a class="code" href="RooWorkspace_8h.html">RooWorkspace.h</a>&quot;</span></div><div class="line"></div><div class="line"><span class="preprocessor">#include &quot;<a class="code" href="BernsteinCorrection_8h.html">RooStats/BernsteinCorrection.h</a>&quot;</span></div><div class="line"></div><div class="line"><span class="comment">// use this order for safety on library loading</span></div><div class="line"><span class="keyword">using namespace </span><a class="code" href="namespaceRooFit.html">RooFit</a>;</div><div class="line"><span class="keyword">using namespace </span><a class="code" href="namespaceRooStats.html">RooStats</a>;</div><div class="line"></div><div class="line"><span class="comment">//____________________________________</span></div><div class="line"><span class="keywordtype">void</span> rs_bernsteinCorrection()</div><div class="line">{</div><div class="line"></div><div class="line">   <span class="comment">// set range of observable</span></div><div class="line">   <a class="code" href="RtypesCore_8h.html#ab9b5334647b78ec4256db251e3ae1fc6">Double_t</a> lowRange = -1, highRange = 5;</div><div class="line"></div><div class="line">   <span class="comment">// make a RooRealVar for the observable</span></div><div class="line">   <a class="code" href="classRooRealVar.html">RooRealVar</a> <a class="code" href="legend1_8C.html#a13c6713ae496caa8195647f76887f926">x</a>(<span class="stringliteral">&quot;x&quot;</span>, <span class="stringliteral">&quot;x&quot;</span>, lowRange, highRange);</div><div class="line"></div><div class="line">   <span class="comment">// true model</span></div><div class="line">   <a class="code" href="classRooGaussian.html">RooGaussian</a> narrow(<span class="stringliteral">&quot;narrow&quot;</span>, <span class="stringliteral">&quot;&quot;</span>, <a class="code" href="legend1_8C.html#a13c6713ae496caa8195647f76887f926">x</a>, <a class="code" href="namespaceRooFit.html#aabf71812817894196e743cf2ef1d1e7b">RooConst</a>(0.), <a class="code" href="namespaceRooFit.html#aabf71812817894196e743cf2ef1d1e7b">RooConst</a>(.8));</div><div class="line">   <a class="code" href="classRooGaussian.html">RooGaussian</a> wide(<span class="stringliteral">&quot;wide&quot;</span>, <span class="stringliteral">&quot;&quot;</span>, <a class="code" href="legend1_8C.html#a13c6713ae496caa8195647f76887f926">x</a>, <a class="code" href="namespaceRooFit.html#aabf71812817894196e743cf2ef1d1e7b">RooConst</a>(0.), <a class="code" href="namespaceRooFit.html#aabf71812817894196e743cf2ef1d1e7b">RooConst</a>(2.));</div><div class="line">   <a class="code" href="classRooAddPdf.html">RooAddPdf</a> reality(<span class="stringliteral">&quot;reality&quot;</span>, <span class="stringliteral">&quot;&quot;</span>, <a class="code" href="classRooArgList.html">RooArgList</a>(narrow, wide), <a class="code" href="namespaceRooFit.html#aabf71812817894196e743cf2ef1d1e7b">RooConst</a>(0.8));</div><div class="line"></div><div class="line">   <a class="code" href="classRooDataSet.html">RooDataSet</a> *data = reality.generate(<a class="code" href="legend1_8C.html#a13c6713ae496caa8195647f76887f926">x</a>, 1000);</div><div class="line"></div><div class="line">   <span class="comment">// nominal model</span></div><div class="line">   <a class="code" href="classRooRealVar.html">RooRealVar</a> <a class="code" href="h1analysisProxy_8h.html#a351c2b9335dfcbe83de6eb9629c2a0e3">sigma</a>(<span class="stringliteral">&quot;sigma&quot;</span>, <span class="stringliteral">&quot;&quot;</span>, 1., 0, 10);</div><div class="line">   <a class="code" href="classRooGaussian.html">RooGaussian</a> nominal(<span class="stringliteral">&quot;nominal&quot;</span>, <span class="stringliteral">&quot;&quot;</span>, <a class="code" href="legend1_8C.html#a13c6713ae496caa8195647f76887f926">x</a>, <a class="code" href="namespaceRooFit.html#aabf71812817894196e743cf2ef1d1e7b">RooConst</a>(0.), <a class="code" href="h1analysisProxy_8h.html#a351c2b9335dfcbe83de6eb9629c2a0e3">sigma</a>);</div><div class="line"></div><div class="line">   <a class="code" href="classRooWorkspace.html">RooWorkspace</a> *wks = <span class="keyword">new</span> <a class="code" href="classRooWorkspace.html">RooWorkspace</a>(<span class="stringliteral">&quot;myWorksspace&quot;</span>);</div><div class="line"></div><div class="line">   wks-&gt;<a class="code" href="classRooWorkspace.html#acff0ca83ad63c5b7a4cb8ea39d0e1669">import</a>(*data, <a class="code" href="namespaceRooFit.html#a93649fc02f13b843c7fb5a5e81e097ff">Rename</a>(<span class="stringliteral">&quot;data&quot;</span>));</div><div class="line">   wks-&gt;<a class="code" href="classRooWorkspace.html#acff0ca83ad63c5b7a4cb8ea39d0e1669">import</a>(nominal);</div><div class="line"></div><div class="line">   <span class="keywordflow">if</span> (<a class="code" href="classTClass.html#a4a5443bb08096e49cb6b1bce1d07139d">TClass::GetClass</a>(<span class="stringliteral">&quot;ROOT::Minuit2::Minuit2Minimizer&quot;</span>)) {</div><div class="line">      <span class="comment">// use Minuit2 if ROOT was built with support for it:</span></div><div class="line">      <a class="code" href="classROOT_1_1Math_1_1MinimizerOptions.html#a18f305ee5af8d3947cab2848ff52944a">ROOT::Math::MinimizerOptions::SetDefaultMinimizer</a>(<span class="stringliteral">&quot;Minuit2&quot;</span>);</div><div class="line">   }</div><div class="line"></div><div class="line">   <span class="comment">// The tolerance sets the probability to add an unnecessary term.</span></div><div class="line">   <span class="comment">// lower tolerance will add fewer terms, while higher tolerance</span></div><div class="line">   <span class="comment">// will add more terms and provide a more flexible function.</span></div><div class="line">   <a class="code" href="RtypesCore_8h.html#ab9b5334647b78ec4256db251e3ae1fc6">Double_t</a> tolerance = 0.05;</div><div class="line">   <a class="code" href="classRooStats_1_1BernsteinCorrection.html">BernsteinCorrection</a> bernsteinCorrection(tolerance);</div><div class="line">   <a class="code" href="RtypesCore_8h.html#a3885b911a54b47a4e61671f45dd45d0b">Int_t</a> <a class="code" href="namespaceTGeant4Unit.html#aa0bc5b01eb54c71b44d208122381c60f">degree</a> = bernsteinCorrection.ImportCorrectedPdf(wks, <span class="stringliteral">&quot;nominal&quot;</span>, <span class="stringliteral">&quot;x&quot;</span>, <span class="stringliteral">&quot;data&quot;</span>);</div><div class="line"></div><div class="line">   <span class="keywordflow">if</span> (<a class="code" href="namespaceTGeant4Unit.html#aa0bc5b01eb54c71b44d208122381c60f">degree</a> &lt; 0) {</div><div class="line">      <a class="code" href="TError_8h.html#a66cc228e173b5602f3733072c52266b0">Error</a>(<span class="stringliteral">&quot;rs_bernsteinCorrection&quot;</span>, <span class="stringliteral">&quot;Bernstein correction failed ! &quot;</span>);</div><div class="line">      <span class="keywordflow">return</span>;</div><div class="line">   }</div><div class="line"></div><div class="line">   cout &lt;&lt; <span class="stringliteral">&quot; Correction based on Bernstein Poly of degree &quot;</span> &lt;&lt; <a class="code" href="namespaceTGeant4Unit.html#aa0bc5b01eb54c71b44d208122381c60f">degree</a> &lt;&lt; endl;</div><div class="line"></div><div class="line">   <a class="code" href="classRooPlot.html">RooPlot</a> *frame = <a class="code" href="legend1_8C.html#a13c6713ae496caa8195647f76887f926">x</a>.frame();</div><div class="line">   data-&gt;<a class="code" href="classRooAbsData.html#ac27709a0077810f29787f046e8d03898">plotOn</a>(frame);</div><div class="line">   <span class="comment">// plot the best fit nominal model in blue</span></div><div class="line">   <a class="code" href="classTString.html">TString</a> minimType = <a class="code" href="classROOT_1_1Math_1_1MinimizerOptions.html#a79e6f20462fe6221e662fb3a6a59c844">ROOT::Math::MinimizerOptions::DefaultMinimizerType</a>();</div><div class="line">   nominal.fitTo(*data, <a class="code" href="namespaceRooFit.html#aaec91c86d0bb20f56844412530e5c9fb">PrintLevel</a>(0), <a class="code" href="namespaceRooFit.html#afac78d31d10b7e7396b999e4ea3af76c">Minimizer</a>(minimType));</div><div class="line">   nominal.plotOn(frame);</div><div class="line"></div><div class="line">   <span class="comment">// plot the best fit corrected model in red</span></div><div class="line">   <a class="code" href="classRooAbsPdf.html">RooAbsPdf</a> *corrected = wks-&gt;<a class="code" href="classRooWorkspace.html#afa7384cece424a1a94a644bb05549eee">pdf</a>(<span class="stringliteral">&quot;corrected&quot;</span>);</div><div class="line">   <span class="keywordflow">if</span> (!corrected)</div><div class="line">      <span class="keywordflow">return</span>;</div><div class="line"></div><div class="line">   <span class="comment">// fit corrected model</span></div><div class="line">   corrected-&gt;<a class="code" href="classRooAbsPdf.html#a8f802a3a93467d5b7b089e3ccaec0fa8">fitTo</a>(*data, <a class="code" href="namespaceRooFit.html#aaec91c86d0bb20f56844412530e5c9fb">PrintLevel</a>(0), <a class="code" href="namespaceRooFit.html#afac78d31d10b7e7396b999e4ea3af76c">Minimizer</a>(minimType));</div><div class="line">   corrected-&gt;<a class="code" href="classRooAbsPdf.html#a16d579415ec8eb8160ae212d683324f2">plotOn</a>(frame, <a class="code" href="namespaceRooFit.html#ad309cf5f63ec87ae5a7025d530f0398f">LineColor</a>(<a class="code" href="Rtypes_8h.html#ac31db05c6cb5891c704eae374f6926a8a5a655b1a02e5b0311571ca57ce4f3900">kRed</a>));</div><div class="line"></div><div class="line">   <span class="comment">// plot the correction term (* norm constant) in dashed green</span></div><div class="line">   <span class="comment">// should make norm constant just be 1, not depend on binning of data</span></div><div class="line">   <a class="code" href="classRooAbsPdf.html">RooAbsPdf</a> *poly = wks-&gt;<a class="code" href="classRooWorkspace.html#afa7384cece424a1a94a644bb05549eee">pdf</a>(<span class="stringliteral">&quot;poly&quot;</span>);</div><div class="line">   <span class="keywordflow">if</span> (poly)</div><div class="line">      poly-&gt;<a class="code" href="classRooAbsPdf.html#a16d579415ec8eb8160ae212d683324f2">plotOn</a>(frame, <a class="code" href="namespaceRooFit.html#ad309cf5f63ec87ae5a7025d530f0398f">LineColor</a>(<a class="code" href="Rtypes_8h.html#ac31db05c6cb5891c704eae374f6926a8a8ea4b941d1d41f4bd88387c38e13e9d3">kGreen</a>), <a class="code" href="namespaceRooFit.html#af1f7922ba5965c1a5a9791a00ef354cb">LineStyle</a>(<a class="code" href="TAttLine_8h.html#a7092c0c4616367016b70d54e5c680a69a079153995f89acb1ea87c52e9b45949a">kDashed</a>));</div><div class="line"></div><div class="line">   <span class="comment">// this is a switch to check the sampling distribution</span></div><div class="line">   <span class="comment">// of -2 log LR for two comparisons:</span></div><div class="line">   <span class="comment">// the first is for n-1 vs. n degree polynomial corrections</span></div><div class="line">   <span class="comment">// the second is for n vs. n+1 degree polynomial corrections</span></div><div class="line">   <span class="comment">// Here we choose n to be the one chosen by the tolerance</span></div><div class="line">   <span class="comment">// criterion above, eg. n = &quot;degree&quot; in the code.</span></div><div class="line">   <span class="comment">// Setting this to true is takes about 10 min.</span></div><div class="line">   <span class="keywordtype">bool</span> checkSamplingDist = <span class="keyword">true</span>;</div><div class="line">   <span class="keywordtype">int</span> numToyMC = 20; <span class="comment">// increase this value for sensible results</span></div><div class="line"></div><div class="line">   <a class="code" href="classTCanvas.html">TCanvas</a> *<a class="code" href="legend1_8C.html#a1259eec59a19080ae1da77e79182c60e">c1</a> = <span class="keyword">new</span> <a class="code" href="classTCanvas.html">TCanvas</a>();</div><div class="line">   <span class="keywordflow">if</span> (checkSamplingDist) {</div><div class="line">      <a class="code" href="legend1_8C.html#a1259eec59a19080ae1da77e79182c60e">c1</a>-&gt;Divide(1, 2);</div><div class="line">      <a class="code" href="legend1_8C.html#a1259eec59a19080ae1da77e79182c60e">c1</a>-&gt;cd(1);</div><div class="line">   }</div><div class="line">   frame-&gt;<a class="code" href="classRooPlot.html#ad7cdede86cb3721e079ec55fcb3b4edc">Draw</a>();</div><div class="line">   <a class="code" href="TVirtualPad_8h.html#a376b3a920d36f3366fb6a4c9e424aa8c">gPad</a>-&gt;Update();</div><div class="line"></div><div class="line">   <span class="keywordflow">if</span> (checkSamplingDist) {</div><div class="line">      <span class="comment">// check sampling dist</span></div><div class="line">      <a class="code" href="classROOT_1_1Math_1_1MinimizerOptions.html#aaeabe43d34a8aedd907d404910d605aa">ROOT::Math::MinimizerOptions::SetDefaultPrintLevel</a>(-1);</div><div class="line">      <a class="code" href="classTH1F.html">TH1F</a> *samplingDist = <span class="keyword">new</span> <a class="code" href="classTH1F.html">TH1F</a>(<span class="stringliteral">&quot;samplingDist&quot;</span>, <span class="stringliteral">&quot;&quot;</span>, 20, 0, 10);</div><div class="line">      <a class="code" href="classTH1F.html">TH1F</a> *samplingDistExtra = <span class="keyword">new</span> <a class="code" href="classTH1F.html">TH1F</a>(<span class="stringliteral">&quot;samplingDistExtra&quot;</span>, <span class="stringliteral">&quot;&quot;</span>, 20, 0, 10);</div><div class="line">      bernsteinCorrection.CreateQSamplingDist(wks, <span class="stringliteral">&quot;nominal&quot;</span>, <span class="stringliteral">&quot;x&quot;</span>, <span class="stringliteral">&quot;data&quot;</span>, samplingDist, samplingDistExtra, <a class="code" href="namespaceTGeant4Unit.html#aa0bc5b01eb54c71b44d208122381c60f">degree</a>,</div><div class="line">                                              numToyMC);</div><div class="line"></div><div class="line">      <a class="code" href="legend1_8C.html#a1259eec59a19080ae1da77e79182c60e">c1</a>-&gt;cd(2);</div><div class="line">      samplingDistExtra-&gt;<a class="code" href="classTAttLine.html#a718156d3be0e4b3e0c52b2257a9d4e7a">SetLineColor</a>(<a class="code" href="Rtypes_8h.html#ac31db05c6cb5891c704eae374f6926a8a5a655b1a02e5b0311571ca57ce4f3900">kRed</a>);</div><div class="line">      samplingDistExtra-&gt;<a class="code" href="classTH1.html#aa53a024a9e94d5ec91e3ef49e49563da">Draw</a>();</div><div class="line">      samplingDist-&gt;<a class="code" href="classTH1.html#aa53a024a9e94d5ec91e3ef49e49563da">Draw</a>(<span class="stringliteral">&quot;same&quot;</span>);</div><div class="line">   }</div><div class="line">}</div></div><!-- fragment --><dl class="section author"><dt>Author</dt><dd>Kyle Cranmer </dd></dl>

<p class="definition">Definition in file <a class="el" href="rs__bernsteinCorrection_8C_source.html">rs_bernsteinCorrection.C</a>.</p>
</div></div><!-- contents -->
<html>
<body>
<div id="footer" style="background-color:#E5EBF3;">
<small>
<img class="footer" src="rootlogo_s.gif" alt="root"/></a>
ROOT 6.18/03 - Reference Guide Generated on Thu Aug 29 2019 04:10:27 (GVA Time) using Doxygen 1.8.14.
</small>
</div>
</body>
</html>
