<!-- HTML header for doxygen 1.8.6-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.14"/>
<title>ROOT: tutorials/unfold/testUnfold3.C File Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/x-mathjax-config">
  MathJax.Hub.Config({
    extensions: ["tex2jax.js"],
    jax: ["input/TeX","output/HTML-CSS"],
});
</script><script type="text/javascript" async src="./mathjax/MathJax.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="ROOT.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table bgcolor="#346295" cellspacing="0" cellpadding="0">
  <tr>
    <td> <img style="height:90px" alt="Logo" src="rootlogo.gif"/> </td>
    <td valign="middle" style="color: #FFFFFF" nowrap="nowrap"><font size="6">ROOT</font> &#160; 6.18/03 <br> Reference Guide </td>
    <td style="width:100%"> </td>
  </tr>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.14 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div id="nav-path" class="navpath">
  <ul>
<li class="navelem"><a class="el" href="dir_0d353d24d0afa59909efab6593124f6d.html">tutorials</a></li><li class="navelem"><a class="el" href="dir_284875b6767095332f555c963e26f94e.html">unfold</a></li>  </ul>
</div>
</div><!-- top -->
<div class="header">
  <div class="headertitle">
<div class="title">testUnfold3.C File Reference<div class="ingroups"><a class="el" href="group__Tutorials.html">Tutorials</a> &raquo; <a class="el" href="group__tutorial__unfold.html">TUnfold tutorials</a></div></div>  </div>
</div><!--header-->
<div class="contents">
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<div class="textblock"><p> <a href="http://nbviewer.jupyter.org/url/root.cern.ch/doc/master/notebooks/testUnfold3.C.nbconvert.ipynb" target="_blank"><img src= notebook.gif alt="View in nbviewer" style="height:1em" ></a> <a href="https://cern.ch/swanserver/cgi-bin/go?projurl=https://root.cern.ch/doc/master/notebooks/testUnfold3.C.nbconvert.ipynb" target="_blank"><img src="http://swanserver.web.cern.ch/swanserver/images/badge_swan_white_150.png"  alt="Open in SWAN" style="height:1em" ></a>  Simple Test program for the class <a class="el" href="classTUnfoldDensity.html" title="An algorithm to unfold distributions from detector to truth level. ">TUnfoldDensity</a>. </p>
<p>1-dimensional unfolding with background subtraction</p>
<p>the goal is to unfold the underlying "true" distribution of a variable Pt</p>
<p>the reconstructed Pt is measured in 24 bins from 4 to 28 the generator-level Pt is unfolded into 10 bins from 6 to 26</p><ul>
<li>plus underflow bin from 0 to 6</li>
<li>plus overflow bin above 26 there are two background sources bgr1 and bgr2 the signal has a finite trigger efficiency at a threshold of 8 GeV</li>
</ul>
<p>one type of systematic error is studied, where the signal parameters are changed</p>
<p>Finally, the unfolding is compared to a "bin-by-bin" correction method</p>
<div class="fragment"><div class="line"></div><div class="line">TUnfold version is V17.6</div><div class="line">chi**2=25.3912+4.28619 / 11</div><div class="line">bin truth   result   (stat)   (bgr)    (sys)</div><div class="line">===+=====+=========+========+========+=======</div><div class="line">  1  4002   4261.3 +/-137.0 +/-  8.9 +/-473.2 (unfolding)</div><div class="line">            4190.1 +/-128.7 +/-104.7 +/-266.3 (bin-by-bin)</div><div class="line"></div><div class="line">  2  1816   1775.1 +/- 82.0 +/-  7.3 +/- 25.2 (unfolding)</div><div class="line">            1714.1 +/- 61.0 +/- 17.0 +/- 70.8 (bin-by-bin)</div><div class="line"></div><div class="line">  3  1011   1020.9 +/- 60.1 +/-  6.7 +/- 24.8 (unfolding)</div><div class="line">             959.5 +/- 40.9 +/-  9.2 +/- 43.3 (bin-by-bin)</div><div class="line"></div><div class="line">  4   593    526.9 +/- 45.2 +/-  6.1 +/- 15.0 (unfolding)</div><div class="line">             506.2 +/- 27.9 +/-  6.6 +/- 45.2 (bin-by-bin)</div><div class="line"></div><div class="line">  5   379    371.6 +/- 38.6 +/-  6.5 +/- 19.8 (unfolding)</div><div class="line">             351.8 +/- 22.6 +/-  6.0 +/- 29.2 (bin-by-bin)</div><div class="line"></div><div class="line">  6   256    341.5 +/- 34.4 +/-  6.0 +/-  9.2 (unfolding)</div><div class="line">             282.5 +/- 19.2 +/-  5.2 +/- 46.6 (bin-by-bin)</div><div class="line"></div><div class="line">  7   193    182.0 +/- 30.1 +/-  5.7 +/-  7.5 (unfolding)</div><div class="line">             177.7 +/- 15.8 +/-  4.9 +/- 22.5 (bin-by-bin)</div><div class="line"></div><div class="line">  8   137    147.1 +/- 28.4 +/-  5.6 +/-  7.0 (unfolding)</div><div class="line">             133.6 +/- 13.9 +/-  4.5 +/- 20.5 (bin-by-bin)</div><div class="line"></div><div class="line">  9   123    109.6 +/- 26.3 +/-  5.4 +/- 10.4 (unfolding)</div><div class="line">              98.6 +/- 12.1 +/-  4.1 +/- 20.7 (bin-by-bin)</div><div class="line"></div><div class="line"> 10    78    100.7 +/- 24.7 +/-  6.1 +/-  8.4 (unfolding)</div><div class="line">              89.7 +/- 13.2 +/-  5.0 +/- 17.1 (bin-by-bin)</div><div class="line"></div></div><!-- fragment --> <div class="fragment"><div class="line"></div><div class="line"><span class="preprocessor">#include &lt;<a class="code" href="TMath_8h.html">TMath.h</a>&gt;</span></div><div class="line"><span class="preprocessor">#include &lt;<a class="code" href="TCanvas_8h.html">TCanvas.h</a>&gt;</span></div><div class="line"><span class="preprocessor">#include &lt;<a class="code" href="TRandom3_8h.html">TRandom3.h</a>&gt;</span></div><div class="line"><span class="preprocessor">#include &lt;<a class="code" href="TFitter_8h.html">TFitter.h</a>&gt;</span></div><div class="line"><span class="preprocessor">#include &lt;<a class="code" href="TF1_8h.html">TF1.h</a>&gt;</span></div><div class="line"><span class="preprocessor">#include &lt;<a class="code" href="TStyle_8h.html">TStyle.h</a>&gt;</span></div><div class="line"><span class="preprocessor">#include &lt;<a class="code" href="TVector_8h.html">TVector.h</a>&gt;</span></div><div class="line"><span class="preprocessor">#include &lt;<a class="code" href="TGraph_8h.html">TGraph.h</a>&gt;</span></div><div class="line"></div><div class="line"><span class="preprocessor">#include &quot;<a class="code" href="TUnfoldDensity_8h.html">TUnfoldDensity.h</a>&quot;</span></div><div class="line"></div><div class="line"><span class="keyword">using namespace </span><a class="code" href="namespacestd.html">std</a>;</div><div class="line"></div><div class="line"><a class="code" href="classTRandom.html">TRandom</a> *rnd=0;</div><div class="line"></div><div class="line"><a class="code" href="RtypesCore_8h.html#ab9b5334647b78ec4256db251e3ae1fc6">Double_t</a> GenerateEvent(<span class="keyword">const</span> <a class="code" href="RtypesCore_8h.html#ab9b5334647b78ec4256db251e3ae1fc6">Double_t</a> *parm,</div><div class="line">                       <span class="keyword">const</span> <a class="code" href="RtypesCore_8h.html#ab9b5334647b78ec4256db251e3ae1fc6">Double_t</a> *triggerParm,</div><div class="line">                       <a class="code" href="RtypesCore_8h.html#ab9b5334647b78ec4256db251e3ae1fc6">Double_t</a> *intLumi,</div><div class="line">                       <a class="code" href="RtypesCore_8h.html#aa101f564ac7b845ca31aec2fbc00ce97">Bool_t</a> *triggerFlag,</div><div class="line">                       <a class="code" href="RtypesCore_8h.html#ab9b5334647b78ec4256db251e3ae1fc6">Double_t</a> *ptGen,<a class="code" href="RtypesCore_8h.html#a3885b911a54b47a4e61671f45dd45d0b">Int_t</a> *iType)</div><div class="line">{</div><div class="line">   <span class="comment">// generate an event</span></div><div class="line">   <span class="comment">// input:</span></div><div class="line">   <span class="comment">//      parameters for the event generator</span></div><div class="line">   <span class="comment">// return value:</span></div><div class="line">   <span class="comment">//      reconstructed Pt</span></div><div class="line">   <span class="comment">// output to pointers:</span></div><div class="line">   <span class="comment">//      integrated luminosity</span></div><div class="line">   <span class="comment">//      several variables only accessible on generator level</span></div><div class="line">   <span class="comment">//</span></div><div class="line">   <span class="comment">// the parm array defines the physical parameters</span></div><div class="line">   <span class="comment">//  parm[0]: background source 1 fraction</span></div><div class="line">   <span class="comment">//  parm[1]: background source 2 fraction</span></div><div class="line">   <span class="comment">//  parm[2]: lower limit of generated Pt distribution</span></div><div class="line">   <span class="comment">//  parm[3]: upper limit of generated Pt distribution</span></div><div class="line">   <span class="comment">//  parm[4]: exponent for Pt distribution signal</span></div><div class="line">   <span class="comment">//  parm[5]: exponent for Pt distribution background 1</span></div><div class="line">   <span class="comment">//  parm[6]: exponent for Pt distribution background 2</span></div><div class="line">   <span class="comment">//  parm[7]: resolution parameter a goes with sqrt(Pt)</span></div><div class="line">   <span class="comment">//  parm[8]: resolution parameter b goes with Pt</span></div><div class="line">   <span class="comment">//  triggerParm[0]: trigger threshold turn-on position</span></div><div class="line">   <span class="comment">//  triggerParm[1]: trigger threshold turn-on width</span></div><div class="line">   <span class="comment">//  triggerParm[2]: trigger efficiency for high pt</span></div><div class="line">   <span class="comment">//</span></div><div class="line">   <span class="comment">// intLumi is advanced bu 1 for each *generated* event</span></div><div class="line">   <span class="comment">// for data, several events may be generated, until one passes the trigger</span></div><div class="line">   <span class="comment">//</span></div><div class="line">   <span class="comment">// some generator-level quantities are also returned:</span></div><div class="line">   <span class="comment">//   triggerFlag: whether the event passed the trigger threshold</span></div><div class="line">   <span class="comment">//   ptGen: the generated pt</span></div><div class="line">   <span class="comment">//   iType: which type of process was simulated</span></div><div class="line">   <span class="comment">//</span></div><div class="line">   <span class="comment">// the &quot;triggerFlag&quot; also has another meaning:</span></div><div class="line">   <span class="comment">//   if(triggerFlag==0)   only triggered events are returned</span></div><div class="line">   <span class="comment">//</span></div><div class="line">   <span class="comment">// Usage to generate data events</span></div><div class="line">   <span class="comment">//      ptObs=GenerateEvent(parm,triggerParm,0,0,0)</span></div><div class="line">   <span class="comment">//</span></div><div class="line">   <span class="comment">// Usage to generate MC events</span></div><div class="line">   <span class="comment">//      ptGen=GenerateEvent(parm,triggerParm,&amp;triggerFlag,&amp;ptGen,&amp;iType);</span></div><div class="line">   <span class="comment">//</span></div><div class="line">   <a class="code" href="RtypesCore_8h.html#ab9b5334647b78ec4256db251e3ae1fc6">Double_t</a> ptObs;</div><div class="line">   <a class="code" href="RtypesCore_8h.html#aa101f564ac7b845ca31aec2fbc00ce97">Bool_t</a> isTriggered=<a class="code" href="RtypesCore_8h.html#a7e568baf910535e8ffd438acb843434d">kFALSE</a>;</div><div class="line">   <span class="keywordflow">do</span> {</div><div class="line">      <a class="code" href="RtypesCore_8h.html#a3885b911a54b47a4e61671f45dd45d0b">Int_t</a> itype;</div><div class="line">      <a class="code" href="RtypesCore_8h.html#ab9b5334647b78ec4256db251e3ae1fc6">Double_t</a> ptgen;</div><div class="line">      <a class="code" href="RtypesCore_8h.html#ab9b5334647b78ec4256db251e3ae1fc6">Double_t</a> <a class="code" href="RSha256_8hxx.html#a357394e0f6f88c8a57bd893ab28dc8f8">f</a>=rnd-&gt;<a class="code" href="classTRandom.html#af504d4f838ab09eb48b7c252615563aa">Rndm</a>();</div><div class="line">      <span class="comment">// decide whether this is background or signal</span></div><div class="line">      itype=0;</div><div class="line">      <span class="keywordflow">if</span>(<a class="code" href="RSha256_8hxx.html#a357394e0f6f88c8a57bd893ab28dc8f8">f</a>&lt;parm[0]) itype=1;</div><div class="line">      <span class="keywordflow">else</span> <span class="keywordflow">if</span>(<a class="code" href="RSha256_8hxx.html#a357394e0f6f88c8a57bd893ab28dc8f8">f</a>&lt;parm[0]+parm[1]) itype=2;</div><div class="line">      <span class="comment">// generate Pt according to distribution  pow(ptgen,a)</span></div><div class="line">      <span class="comment">// get exponent</span></div><div class="line">      <a class="code" href="RtypesCore_8h.html#ab9b5334647b78ec4256db251e3ae1fc6">Double_t</a> <a class="code" href="textangle_8C.html#a655a1c2a1ec25e8fcfb713772281e8f5">a</a>=parm[4+itype];</div><div class="line">      <a class="code" href="RtypesCore_8h.html#ab9b5334647b78ec4256db251e3ae1fc6">Double_t</a> a1=<a class="code" href="textangle_8C.html#a655a1c2a1ec25e8fcfb713772281e8f5">a</a>+1.0;</div><div class="line">      <a class="code" href="RtypesCore_8h.html#ab9b5334647b78ec4256db251e3ae1fc6">Double_t</a> t=rnd-&gt;<a class="code" href="classTRandom.html#af504d4f838ab09eb48b7c252615563aa">Rndm</a>();</div><div class="line">      <span class="keywordflow">if</span>(a1 == 0.0) {</div><div class="line">         <a class="code" href="RtypesCore_8h.html#ab9b5334647b78ec4256db251e3ae1fc6">Double_t</a> x0=<a class="code" href="namespaceTMath.html#a8f07e00d6511f2fbbad41d351d71731a">TMath::Log</a>(parm[2]);</div><div class="line">         ptgen=<a class="code" href="namespaceTMath.html#a428950de9bddacfb35915a9603880005">TMath::Exp</a>(t*(<a class="code" href="namespaceTMath.html#a8f07e00d6511f2fbbad41d351d71731a">TMath::Log</a>(parm[3])-x0)+x0);</div><div class="line">      } <span class="keywordflow">else</span> {</div><div class="line">         <a class="code" href="RtypesCore_8h.html#ab9b5334647b78ec4256db251e3ae1fc6">Double_t</a> x0=<a class="code" href="TMath_8h.html#a96ae9abed439401fd6dd28a1e2c2f94e">pow</a>(parm[2],a1);</div><div class="line">         ptgen=<a class="code" href="TMath_8h.html#a96ae9abed439401fd6dd28a1e2c2f94e">pow</a>(t*(<a class="code" href="TMath_8h.html#a96ae9abed439401fd6dd28a1e2c2f94e">pow</a>(parm[3],a1)-x0)+x0,1./a1);</div><div class="line">      }</div><div class="line">      <span class="keywordflow">if</span>(iType) *iType=itype;</div><div class="line">      <span class="keywordflow">if</span>(ptGen) *ptGen=ptgen;</div><div class="line"></div><div class="line">      <span class="comment">// smearing in Pt with large asymmetric tail</span></div><div class="line">      <a class="code" href="RtypesCore_8h.html#ab9b5334647b78ec4256db251e3ae1fc6">Double_t</a> <a class="code" href="h1analysisProxy_8h.html#a351c2b9335dfcbe83de6eb9629c2a0e3">sigma</a>=</div><div class="line">         <a class="code" href="namespaceTMath.html#a9ea900c956031cb12057acf7c322b0fa">TMath::Sqrt</a>(parm[7]*parm[7]*ptgen+parm[8]*parm[8]*ptgen*ptgen);</div><div class="line">      ptObs=rnd-&gt;<a class="code" href="classTRandom.html#ab6cc428c9bfe15b5e5bc425d6288b5a8">BreitWigner</a>(ptgen,<a class="code" href="h1analysisProxy_8h.html#a351c2b9335dfcbe83de6eb9629c2a0e3">sigma</a>);</div><div class="line"></div><div class="line">      <span class="comment">// decide whether event was triggered</span></div><div class="line">      <a class="code" href="RtypesCore_8h.html#ab9b5334647b78ec4256db251e3ae1fc6">Double_t</a> triggerProb =</div><div class="line">         triggerParm[2]/(1.+<a class="code" href="namespaceTMath.html#a428950de9bddacfb35915a9603880005">TMath::Exp</a>((triggerParm[0]-ptObs)/triggerParm[1]));</div><div class="line">      isTriggered= rnd-&gt;<a class="code" href="classTRandom.html#af504d4f838ab09eb48b7c252615563aa">Rndm</a>()&lt;triggerProb;</div><div class="line">      (*intLumi) ++;</div><div class="line">   } <span class="keywordflow">while</span>((!triggerFlag) &amp;&amp; (!isTriggered));</div><div class="line">   <span class="comment">// return trigger decision</span></div><div class="line">   <span class="keywordflow">if</span>(triggerFlag) *triggerFlag=isTriggered;</div><div class="line">   <span class="keywordflow">return</span> ptObs;</div><div class="line">}</div><div class="line"></div><div class="line"><span class="comment">//int main(int argc, char *argv[])</span></div><div class="line"><span class="keywordtype">void</span> testUnfold3()</div><div class="line">{</div><div class="line">  <span class="comment">// switch on histogram errors</span></div><div class="line">  <a class="code" href="classTH1.html#a8cd3b44217c8fec1d74046ed2ac153c2">TH1::SetDefaultSumw2</a>();</div><div class="line"></div><div class="line">  <span class="comment">// show fit result</span></div><div class="line">  <a class="code" href="TStyle_8h.html#ace94cabdcf18c1e8a7856d8c3f388cfe">gStyle</a>-&gt;<a class="code" href="classTStyle.html#aedeb1d117d9f16af9f8ad430bf956d64">SetOptFit</a>(1111);</div><div class="line"></div><div class="line">  <span class="comment">// random generator</span></div><div class="line">  rnd=<span class="keyword">new</span> <a class="code" href="classTRandom3.html">TRandom3</a>();</div><div class="line"></div><div class="line">  <span class="comment">// data and MC luminosities</span></div><div class="line">  <a class="code" href="RtypesCore_8h.html#ab9b5334647b78ec4256db251e3ae1fc6">Double_t</a> <span class="keyword">const</span> lumiData= 30000;</div><div class="line">  <a class="code" href="RtypesCore_8h.html#ab9b5334647b78ec4256db251e3ae1fc6">Double_t</a> <span class="keyword">const</span> lumiMC  =1000000;</div><div class="line"></div><div class="line">  <span class="comment">//========================</span></div><div class="line">  <span class="comment">// Step 1: define binning, book histograms</span></div><div class="line"></div><div class="line">  <span class="comment">// reconstructed pt (fine binning)</span></div><div class="line">  <a class="code" href="RtypesCore_8h.html#a3885b911a54b47a4e61671f45dd45d0b">Int_t</a> <span class="keyword">const</span> nDet=24;</div><div class="line">  <a class="code" href="RtypesCore_8h.html#ab9b5334647b78ec4256db251e3ae1fc6">Double_t</a> <span class="keyword">const</span> xminDet=4.0;</div><div class="line">  <a class="code" href="RtypesCore_8h.html#ab9b5334647b78ec4256db251e3ae1fc6">Double_t</a> <span class="keyword">const</span> xmaxDet=28.0;</div><div class="line"></div><div class="line">  <span class="comment">// generated pt (coarse binning)</span></div><div class="line">  <a class="code" href="RtypesCore_8h.html#a3885b911a54b47a4e61671f45dd45d0b">Int_t</a> <span class="keyword">const</span> nGen=10;</div><div class="line">  <a class="code" href="RtypesCore_8h.html#ab9b5334647b78ec4256db251e3ae1fc6">Double_t</a> <span class="keyword">const</span> xminGen= 6.0;</div><div class="line">  <a class="code" href="RtypesCore_8h.html#ab9b5334647b78ec4256db251e3ae1fc6">Double_t</a> <span class="keyword">const</span> xmaxGen=26.0;</div><div class="line"></div><div class="line">  <span class="comment">//==================================================================</span></div><div class="line">  <span class="comment">// book histograms</span></div><div class="line">  <span class="comment">//  (1) unfolding input: binning scheme is fine for detector,coarse for gen</span></div><div class="line">  <span class="comment">//   histUnfoldInput : reconstructed data, binning for unfolding</span></div><div class="line">  <span class="comment">//   histUnfoldMatrix : generated vs reconstructed distribution</span></div><div class="line">  <span class="comment">//   histUnfoldBgr1 : background source1, as predicted by MC</span></div><div class="line">  <span class="comment">//   histUnfoldBgr2 : background source2, as predicted by MC</span></div><div class="line">  <span class="comment">//      for systematic studies</span></div><div class="line">  <span class="comment">//   histUnfoldMatrixSys : generated vs reconstructed with different signal</span></div><div class="line">  <span class="comment">//</span></div><div class="line">  <span class="comment">//  (2) histograms required for bin-by-bin method</span></div><div class="line">  <span class="comment">//   histDetDATAbbb : reconstructed data for bin-by-bin</span></div><div class="line">  <span class="comment">//   histDetMCbbb : reconstructed MC for bin-by-bin</span></div><div class="line">  <span class="comment">//   histDetMCBgr1bbb : reconstructed MC bgr1 for bin-by-bin</span></div><div class="line">  <span class="comment">//   histDetMCBgr2bbb : reconstructed MC bgr2 for bin-by-bin</span></div><div class="line">  <span class="comment">//   histDetMCBgrPtbbb : reconstructed MC bgr from low/high pt for bin-by-bin</span></div><div class="line">  <span class="comment">//   histGenMCbbb : generated MC truth</span></div><div class="line">  <span class="comment">//     for systematic studies</span></div><div class="line">  <span class="comment">//   histDetMCSysbbb : reconstructed with changed trigger</span></div><div class="line">  <span class="comment">//   histGenMCSysbbb : generated MC truth</span></div><div class="line">  <span class="comment">//</span></div><div class="line">  <span class="comment">//  (3) monitoring and control</span></div><div class="line">  <span class="comment">//   histGenData : data truth for bias tests</span></div><div class="line">  <span class="comment">//   histDetMC : MC prediction</span></div><div class="line"></div><div class="line">  <span class="comment">// (1) create histograms required for unfolding</span></div><div class="line">  <a class="code" href="classTH1D.html">TH1D</a> *histUnfoldInput=</div><div class="line">     <span class="keyword">new</span> <a class="code" href="classTH1D.html">TH1D</a>(<span class="stringliteral">&quot;unfolding input rec&quot;</span>,<span class="stringliteral">&quot;;ptrec&quot;</span>,nDet,xminDet,xmaxDet);</div><div class="line">  <a class="code" href="classTH2D.html">TH2D</a> *histUnfoldMatrix=</div><div class="line">     <span class="keyword">new</span> <a class="code" href="classTH2D.html">TH2D</a>(<span class="stringliteral">&quot;unfolding matrix&quot;</span>,<span class="stringliteral">&quot;;ptgen;ptrec&quot;</span>,</div><div class="line">              nGen,xminGen,xmaxGen,nDet,xminDet,xmaxDet);</div><div class="line">  <a class="code" href="classTH1D.html">TH1D</a> *histUnfoldBgr1=</div><div class="line">     <span class="keyword">new</span> <a class="code" href="classTH1D.html">TH1D</a>(<span class="stringliteral">&quot;unfolding bgr1 rec&quot;</span>,<span class="stringliteral">&quot;;ptrec&quot;</span>,nDet,xminDet,xmaxDet);</div><div class="line">  <a class="code" href="classTH1D.html">TH1D</a> *histUnfoldBgr2=</div><div class="line">     <span class="keyword">new</span> <a class="code" href="classTH1D.html">TH1D</a>(<span class="stringliteral">&quot;unfolding bgr2 rec&quot;</span>,<span class="stringliteral">&quot;;ptrec&quot;</span>,nDet,xminDet,xmaxDet);</div><div class="line">  <a class="code" href="classTH2D.html">TH2D</a> *histUnfoldMatrixSys=</div><div class="line">     <span class="keyword">new</span> <a class="code" href="classTH2D.html">TH2D</a>(<span class="stringliteral">&quot;unfolding matrix sys&quot;</span>,<span class="stringliteral">&quot;;ptgen;ptrec&quot;</span>,</div><div class="line">              nGen,xminGen,xmaxGen,nDet,xminDet,xmaxDet);</div><div class="line"></div><div class="line">  <span class="comment">// (2) histograms required for bin-by-bin</span></div><div class="line">  <a class="code" href="classTH1D.html">TH1D</a> *histBbbInput=</div><div class="line">     <span class="keyword">new</span> <a class="code" href="classTH1D.html">TH1D</a>(<span class="stringliteral">&quot;bbb input rec&quot;</span>,<span class="stringliteral">&quot;;ptrec&quot;</span>,nGen,xminGen,xmaxGen);</div><div class="line">  <a class="code" href="classTH1D.html">TH1D</a> *histBbbSignalRec=</div><div class="line">     <span class="keyword">new</span> <a class="code" href="classTH1D.html">TH1D</a>(<span class="stringliteral">&quot;bbb signal rec&quot;</span>,<span class="stringliteral">&quot;;ptrec&quot;</span>,nGen,xminGen,xmaxGen);</div><div class="line">  <a class="code" href="classTH1D.html">TH1D</a> *histBbbBgr1=</div><div class="line">     <span class="keyword">new</span> <a class="code" href="classTH1D.html">TH1D</a>(<span class="stringliteral">&quot;bbb bgr1 rec&quot;</span>,<span class="stringliteral">&quot;;ptrec&quot;</span>,nGen,xminGen,xmaxGen);</div><div class="line">  <a class="code" href="classTH1D.html">TH1D</a> *histBbbBgr2=</div><div class="line">     <span class="keyword">new</span> <a class="code" href="classTH1D.html">TH1D</a>(<span class="stringliteral">&quot;bbb bgr2 rec&quot;</span>,<span class="stringliteral">&quot;;ptrec&quot;</span>,nGen,xminGen,xmaxGen);</div><div class="line">  <a class="code" href="classTH1D.html">TH1D</a> *histBbbBgrPt=</div><div class="line">     <span class="keyword">new</span> <a class="code" href="classTH1D.html">TH1D</a>(<span class="stringliteral">&quot;bbb bgrPt rec&quot;</span>,<span class="stringliteral">&quot;;ptrec&quot;</span>,nGen,xminGen,xmaxGen);</div><div class="line">  <a class="code" href="classTH1D.html">TH1D</a> *histBbbSignalGen=</div><div class="line">     <span class="keyword">new</span> <a class="code" href="classTH1D.html">TH1D</a>(<span class="stringliteral">&quot;bbb signal gen&quot;</span>,<span class="stringliteral">&quot;;ptgen&quot;</span>,nGen,xminGen,xmaxGen);</div><div class="line">  <a class="code" href="classTH1D.html">TH1D</a> *histBbbSignalRecSys=</div><div class="line">     <span class="keyword">new</span> <a class="code" href="classTH1D.html">TH1D</a>(<span class="stringliteral">&quot;bbb signal sys rec&quot;</span>,<span class="stringliteral">&quot;;ptrec&quot;</span>,nGen,xminGen,xmaxGen);</div><div class="line">  <a class="code" href="classTH1D.html">TH1D</a> *histBbbBgrPtSys=</div><div class="line">     <span class="keyword">new</span> <a class="code" href="classTH1D.html">TH1D</a>(<span class="stringliteral">&quot;bbb bgrPt sys rec&quot;</span>,<span class="stringliteral">&quot;;ptrec&quot;</span>,nGen,xminGen,xmaxGen);</div><div class="line">  <a class="code" href="classTH1D.html">TH1D</a> *histBbbSignalGenSys=</div><div class="line">     <span class="keyword">new</span> <a class="code" href="classTH1D.html">TH1D</a>(<span class="stringliteral">&quot;bbb signal sys gen&quot;</span>,<span class="stringliteral">&quot;;ptgen&quot;</span>,nGen,xminGen,xmaxGen);</div><div class="line"></div><div class="line">  <span class="comment">// (3) control histograms</span></div><div class="line">  <a class="code" href="classTH1D.html">TH1D</a> *histDataTruth=</div><div class="line">     <span class="keyword">new</span> <a class="code" href="classTH1D.html">TH1D</a>(<span class="stringliteral">&quot;DATA truth gen&quot;</span>,<span class="stringliteral">&quot;;ptgen&quot;</span>,nGen,xminGen,xmaxGen);</div><div class="line">  <a class="code" href="classTH1D.html">TH1D</a> *histDetMC=</div><div class="line">     <span class="keyword">new</span> <a class="code" href="classTH1D.html">TH1D</a>(<span class="stringliteral">&quot;MC prediction rec&quot;</span>,<span class="stringliteral">&quot;;ptrec&quot;</span>,nDet,xminDet,xmaxDet);</div><div class="line">  <span class="comment">// ==============================================================</span></div><div class="line">  <span class="comment">// Step 2: generate data distributions</span></div><div class="line">  <span class="comment">//</span></div><div class="line">  <span class="comment">// data parameters: in real life these are unknown</span></div><div class="line">  <span class="keyword">static</span> <a class="code" href="RtypesCore_8h.html#ab9b5334647b78ec4256db251e3ae1fc6">Double_t</a> parm_DATA[]={</div><div class="line">     0.05, <span class="comment">// fraction of background 1 (on generator level)</span></div><div class="line">     0.05, <span class="comment">// fraction of background 2 (on generator level)</span></div><div class="line">     3.5, <span class="comment">// lower Pt cut (generator level)</span></div><div class="line">     100.,<span class="comment">// upper Pt cut (generator level)</span></div><div class="line">     -3.0,<span class="comment">// signal exponent</span></div><div class="line">     0.1, <span class="comment">// background 1 exponent</span></div><div class="line">     -0.5, <span class="comment">// background 2 exponent</span></div><div class="line">     0.2, <span class="comment">// energy resolution a term</span></div><div class="line">     0.01, <span class="comment">// energy resolution b term</span></div><div class="line">  };</div><div class="line">  <span class="keyword">static</span> <a class="code" href="RtypesCore_8h.html#ab9b5334647b78ec4256db251e3ae1fc6">Double_t</a> triggerParm_DATA[]={8.0, <span class="comment">// threshold is 8 GeV</span></div><div class="line">                               4.0, <span class="comment">// width is 4 GeV</span></div><div class="line">                               0.95 <span class="comment">// high Pt efficiency os 95%</span></div><div class="line">  };</div><div class="line"></div><div class="line">  <a class="code" href="RtypesCore_8h.html#ab9b5334647b78ec4256db251e3ae1fc6">Double_t</a> intLumi=0.0;</div><div class="line">  <span class="keywordflow">while</span>(intLumi&lt;lumiData) {</div><div class="line">     <a class="code" href="RtypesCore_8h.html#a3885b911a54b47a4e61671f45dd45d0b">Int_t</a> iTypeGen;</div><div class="line">     <a class="code" href="RtypesCore_8h.html#aa101f564ac7b845ca31aec2fbc00ce97">Bool_t</a> isTriggered;</div><div class="line">     <a class="code" href="RtypesCore_8h.html#ab9b5334647b78ec4256db251e3ae1fc6">Double_t</a> ptGen;</div><div class="line">     <a class="code" href="RtypesCore_8h.html#ab9b5334647b78ec4256db251e3ae1fc6">Double_t</a> ptObs=GenerateEvent(parm_DATA,triggerParm_DATA,&amp;intLumi,</div><div class="line">                                  &amp;isTriggered,&amp;ptGen,&amp;iTypeGen);</div><div class="line">     <span class="keywordflow">if</span>(isTriggered) {</div><div class="line">        <span class="comment">// (1) histogram for unfolding</span></div><div class="line">        histUnfoldInput-&gt;<a class="code" href="classTH1.html#a77e71290a82517d317ea8d05e96b6c4a">Fill</a>(ptObs);</div><div class="line"></div><div class="line">        <span class="comment">// (2) histogram for bin-by-bin</span></div><div class="line">        histBbbInput-&gt;<a class="code" href="classTH1.html#a77e71290a82517d317ea8d05e96b6c4a">Fill</a>(ptObs);</div><div class="line">     }</div><div class="line">     <span class="comment">// (3) monitoring</span></div><div class="line">     <span class="keywordflow">if</span>(iTypeGen==0) histDataTruth-&gt;<a class="code" href="classTH1.html#a77e71290a82517d317ea8d05e96b6c4a">Fill</a>(ptGen);</div><div class="line">  }</div><div class="line"></div><div class="line">  <span class="comment">// ==============================================================</span></div><div class="line">  <span class="comment">// Step 3: generate default MC distributions</span></div><div class="line">  <span class="comment">//</span></div><div class="line">  <span class="comment">// MC parameters</span></div><div class="line">  <span class="comment">// default settings</span></div><div class="line">  <span class="keyword">static</span> <a class="code" href="RtypesCore_8h.html#ab9b5334647b78ec4256db251e3ae1fc6">Double_t</a> parm_MC[]={</div><div class="line">     0.05, <span class="comment">// fraction of background 1 (on generator level)</span></div><div class="line">     0.05, <span class="comment">// fraction of background 2 (on generator level)</span></div><div class="line">     3.5, <span class="comment">// lower Pt cut (generator level)</span></div><div class="line">     100.,<span class="comment">// upper Pt cut (generator level)</span></div><div class="line">     -4.0,<span class="comment">// signal exponent !!! steeper than in data</span></div><div class="line">          <span class="comment">//                     to illustrate bin-by-bin bias</span></div><div class="line">     0.1, <span class="comment">// background 1 exponent</span></div><div class="line">     -0.5, <span class="comment">// background 2 exponent</span></div><div class="line">     0.2, <span class="comment">// energy resolution a term</span></div><div class="line">     0.01, <span class="comment">// energy resolution b term</span></div><div class="line">  };</div><div class="line">  <span class="keyword">static</span> <a class="code" href="RtypesCore_8h.html#ab9b5334647b78ec4256db251e3ae1fc6">Double_t</a> triggerParm_MC[]={8.0, <span class="comment">// threshold is 8 GeV</span></div><div class="line">                             4.0, <span class="comment">// width is 4 GeV</span></div><div class="line">                             0.95 <span class="comment">// high Pt efficiency is 95%</span></div><div class="line">  };</div><div class="line"></div><div class="line">  <span class="comment">// weighting factor to accomodate for the different luminosity in data and MC</span></div><div class="line">  <a class="code" href="RtypesCore_8h.html#ab9b5334647b78ec4256db251e3ae1fc6">Double_t</a> lumiWeight = lumiData/lumiMC;</div><div class="line">  intLumi=0.0;</div><div class="line">  <span class="keywordflow">while</span>(intLumi&lt;lumiMC) {</div><div class="line">     <a class="code" href="RtypesCore_8h.html#a3885b911a54b47a4e61671f45dd45d0b">Int_t</a> iTypeGen;</div><div class="line">     <a class="code" href="RtypesCore_8h.html#aa101f564ac7b845ca31aec2fbc00ce97">Bool_t</a> isTriggered;</div><div class="line">     <a class="code" href="RtypesCore_8h.html#ab9b5334647b78ec4256db251e3ae1fc6">Double_t</a> ptGen;</div><div class="line">     <a class="code" href="RtypesCore_8h.html#ab9b5334647b78ec4256db251e3ae1fc6">Double_t</a> ptObs=GenerateEvent(parm_MC,triggerParm_MC,&amp;intLumi,&amp;isTriggered,</div><div class="line">                                  &amp;ptGen,&amp;iTypeGen);</div><div class="line">     <span class="keywordflow">if</span>(!isTriggered) ptObs=0.0;</div><div class="line"></div><div class="line">     <span class="comment">// (1) distribution required for unfolding</span></div><div class="line"></div><div class="line">     <span class="keywordflow">if</span>(iTypeGen==0) {</div><div class="line">        histUnfoldMatrix-&gt;<a class="code" href="classTH2.html#a4cf5530929bd446be82148884d0d1fa3">Fill</a>(ptGen,ptObs,lumiWeight);</div><div class="line">     } <span class="keywordflow">else</span> <span class="keywordflow">if</span>(iTypeGen==1) {</div><div class="line">        histUnfoldBgr1-&gt;<a class="code" href="classTH1.html#a77e71290a82517d317ea8d05e96b6c4a">Fill</a>(ptObs,lumiWeight);</div><div class="line">     } <span class="keywordflow">else</span> <span class="keywordflow">if</span>(iTypeGen==2) {</div><div class="line">        histUnfoldBgr2-&gt;<a class="code" href="classTH1.html#a77e71290a82517d317ea8d05e96b6c4a">Fill</a>(ptObs,lumiWeight);</div><div class="line">     }</div><div class="line"></div><div class="line">     <span class="comment">// (2) distributions for bbb</span></div><div class="line">     <span class="keywordflow">if</span>(iTypeGen==0) {</div><div class="line">        <span class="keywordflow">if</span>((ptGen&gt;=xminGen)&amp;&amp;(ptGen&lt;xmaxGen)) {</div><div class="line">           histBbbSignalRec-&gt;<a class="code" href="classTH1.html#a77e71290a82517d317ea8d05e96b6c4a">Fill</a>(ptObs,lumiWeight);</div><div class="line">        } <span class="keywordflow">else</span> {</div><div class="line">           histBbbBgrPt-&gt;<a class="code" href="classTH1.html#a77e71290a82517d317ea8d05e96b6c4a">Fill</a>(ptObs,lumiWeight);</div><div class="line">        }</div><div class="line">        histBbbSignalGen-&gt;<a class="code" href="classTH1.html#a77e71290a82517d317ea8d05e96b6c4a">Fill</a>(ptGen,lumiWeight);</div><div class="line">     } <span class="keywordflow">else</span> <span class="keywordflow">if</span>(iTypeGen==1) {</div><div class="line">        histBbbBgr1-&gt;<a class="code" href="classTH1.html#a77e71290a82517d317ea8d05e96b6c4a">Fill</a>(ptObs,lumiWeight);</div><div class="line">     } <span class="keywordflow">else</span> <span class="keywordflow">if</span>(iTypeGen==2) {</div><div class="line">        histBbbBgr2-&gt;<a class="code" href="classTH1.html#a77e71290a82517d317ea8d05e96b6c4a">Fill</a>(ptObs,lumiWeight);</div><div class="line">     }</div><div class="line"></div><div class="line">     <span class="comment">// (3) control distribution</span></div><div class="line">     histDetMC -&gt;<a class="code" href="classTH1.html#a77e71290a82517d317ea8d05e96b6c4a">Fill</a>(ptObs,lumiWeight);</div><div class="line">  }</div><div class="line"></div><div class="line">  <span class="comment">// ==============================================================</span></div><div class="line">  <span class="comment">// Step 4: generate MC distributions for systematic study</span></div><div class="line">  <span class="comment">// example: study dependence on initial signal shape</span></div><div class="line">  <span class="comment">//   -&gt; BGR distributions do not change</span></div><div class="line">  <span class="keyword">static</span> <a class="code" href="RtypesCore_8h.html#ab9b5334647b78ec4256db251e3ae1fc6">Double_t</a> parm_MC_SYS[]={</div><div class="line">     0.05, <span class="comment">// fraction of background: unchanged</span></div><div class="line">     0.05, <span class="comment">// fraction of background: unchanged</span></div><div class="line">     3.5, <span class="comment">// lower Pt cut (generator level)</span></div><div class="line">     100.,<span class="comment">// upper Pt cut (generator level)</span></div><div class="line">     -2.0, <span class="comment">// signal exponent changed</span></div><div class="line">     0.1, <span class="comment">// background 1 exponent</span></div><div class="line">     -0.5, <span class="comment">// background 2 exponent</span></div><div class="line">     0.2, <span class="comment">// energy resolution a term</span></div><div class="line">     0.01, <span class="comment">// energy resolution b term</span></div><div class="line">  };</div><div class="line"></div><div class="line">  intLumi=0.0;</div><div class="line">  <span class="keywordflow">while</span>(intLumi&lt;lumiMC) {</div><div class="line">     <a class="code" href="RtypesCore_8h.html#a3885b911a54b47a4e61671f45dd45d0b">Int_t</a> iTypeGen;</div><div class="line">     <a class="code" href="RtypesCore_8h.html#aa101f564ac7b845ca31aec2fbc00ce97">Bool_t</a> isTriggered;</div><div class="line">     <a class="code" href="RtypesCore_8h.html#ab9b5334647b78ec4256db251e3ae1fc6">Double_t</a> ptGen;</div><div class="line">     <a class="code" href="RtypesCore_8h.html#ab9b5334647b78ec4256db251e3ae1fc6">Double_t</a> ptObs=GenerateEvent(parm_MC_SYS,triggerParm_MC,&amp;intLumi,</div><div class="line">                                  &amp;isTriggered,&amp;ptGen,&amp;iTypeGen);</div><div class="line">     <span class="keywordflow">if</span>(!isTriggered) ptObs=0.0;</div><div class="line"></div><div class="line">     <span class="comment">// (1) for unfolding</span></div><div class="line">     <span class="keywordflow">if</span>(iTypeGen==0) {</div><div class="line">        histUnfoldMatrixSys-&gt;<a class="code" href="classTH2.html#a4cf5530929bd446be82148884d0d1fa3">Fill</a>(ptGen,ptObs);</div><div class="line">     }</div><div class="line"></div><div class="line">     <span class="comment">// (2) for bin-by-bin</span></div><div class="line">     <span class="keywordflow">if</span>(iTypeGen==0) {</div><div class="line">        <span class="keywordflow">if</span>((ptGen&gt;=xminGen)&amp;&amp;(ptGen&lt;xmaxGen)) {</div><div class="line">           histBbbSignalRecSys-&gt;<a class="code" href="classTH1.html#a77e71290a82517d317ea8d05e96b6c4a">Fill</a>(ptObs);</div><div class="line">        } <span class="keywordflow">else</span> {</div><div class="line">           histBbbBgrPtSys-&gt;<a class="code" href="classTH1.html#a77e71290a82517d317ea8d05e96b6c4a">Fill</a>(ptObs);</div><div class="line">        }</div><div class="line">        histBbbSignalGenSys-&gt;<a class="code" href="classTH1.html#a77e71290a82517d317ea8d05e96b6c4a">Fill</a>(ptGen);</div><div class="line">     }</div><div class="line">  }</div><div class="line"></div><div class="line">  <span class="comment">// this method is new in version 16 of TUnfold</span></div><div class="line">  cout&lt;&lt;<span class="stringliteral">&quot;TUnfold version is &quot;</span>&lt;&lt;<a class="code" href="classTUnfold.html#a4b9f6064b7d743689428861f511e6f2b">TUnfold::GetTUnfoldVersion</a>()&lt;&lt;<span class="stringliteral">&quot;\n&quot;</span>;</div><div class="line"></div><div class="line">  <span class="comment">//========================</span></div><div class="line">  <span class="comment">// Step 5: unfolding</span></div><div class="line">  <span class="comment">//</span></div><div class="line"></div><div class="line">  <span class="comment">// here one has to decide about the regularisation scheme</span></div><div class="line"></div><div class="line">  <span class="comment">// regularize curvature</span></div><div class="line">  <a class="code" href="classTUnfold.html#a8dbac6b2a783e95f4dc008b7e0352ab9">TUnfold::ERegMode</a> regMode =</div><div class="line">     <a class="code" href="classTUnfold.html#a8dbac6b2a783e95f4dc008b7e0352ab9aa97e6928c3f4c7f347d736d126f1dbdf">TUnfold::kRegModeCurvature</a>;</div><div class="line"></div><div class="line"> <span class="comment">// preserve the area</span></div><div class="line">  <a class="code" href="classTUnfold.html#a728827089c781ef7ff3e03c25eed784a">TUnfold::EConstraint</a> constraintMode=</div><div class="line">     <a class="code" href="classTUnfold.html#a728827089c781ef7ff3e03c25eed784aa0c6db965feefac22363aa92d8517f990">TUnfold::kEConstraintArea</a>;</div><div class="line"></div><div class="line">  <span class="comment">// bin content is divided by the bin width</span></div><div class="line">  <a class="code" href="classTUnfoldDensity.html#afb249cac412da2b13c9a6b71c717d3b3">TUnfoldDensity::EDensityMode</a> densityFlags=</div><div class="line">     <a class="code" href="classTUnfoldDensity.html#afb249cac412da2b13c9a6b71c717d3b3ae7194163522270ece68c073a59543d94">TUnfoldDensity::kDensityModeBinWidth</a>;</div><div class="line"></div><div class="line">  <span class="comment">// set up matrix of migrations</span></div><div class="line">  <a class="code" href="classTUnfoldDensity.html">TUnfoldDensity</a> unfold(histUnfoldMatrix,<a class="code" href="classTUnfold.html#adb3ade9e94eedc71e5258e1af589de62a87355f8fd856583a77487ed5cca69ce2">TUnfold::kHistMapOutputHoriz</a>,</div><div class="line">                        regMode,constraintMode,densityFlags);</div><div class="line"></div><div class="line">  <span class="comment">// define the input vector (the measured data distribution)</span></div><div class="line">  unfold.SetInput(histUnfoldInput);</div><div class="line"></div><div class="line">  <span class="comment">// subtract background, normalized to data luminosity</span></div><div class="line">  <span class="comment">//  with 10% scale error each</span></div><div class="line">  <a class="code" href="RtypesCore_8h.html#ab9b5334647b78ec4256db251e3ae1fc6">Double_t</a> scale_bgr=1.0;</div><div class="line">  <a class="code" href="RtypesCore_8h.html#ab9b5334647b78ec4256db251e3ae1fc6">Double_t</a> dscale_bgr=0.1;</div><div class="line">  unfold.SubtractBackground(histUnfoldBgr1,<span class="stringliteral">&quot;background1&quot;</span>,scale_bgr,dscale_bgr);</div><div class="line">  unfold.SubtractBackground(histUnfoldBgr2,<span class="stringliteral">&quot;background2&quot;</span>,scale_bgr,dscale_bgr);</div><div class="line"></div><div class="line">  <span class="comment">// add systematic error</span></div><div class="line">  unfold.AddSysError(histUnfoldMatrixSys,<span class="stringliteral">&quot;signalshape_SYS&quot;</span>,</div><div class="line">                     <a class="code" href="classTUnfold.html#adb3ade9e94eedc71e5258e1af589de62a87355f8fd856583a77487ed5cca69ce2">TUnfold::kHistMapOutputHoriz</a>,</div><div class="line">                     <a class="code" href="classTUnfoldSys.html#a6d8765d59dff7a58197acfb2c9b8a1ceaaa3dbf1e025e66945ee403cbf26e66b5">TUnfoldSys::kSysErrModeMatrix</a>);</div><div class="line"></div><div class="line">  <span class="comment">// run the unfolding</span></div><div class="line">  <a class="code" href="RtypesCore_8h.html#a3885b911a54b47a4e61671f45dd45d0b">Int_t</a> nScan=30;</div><div class="line">  <a class="code" href="classTSpline.html">TSpline</a> *logTauX,*logTauY;</div><div class="line">  <a class="code" href="classTGraph.html">TGraph</a> *lCurve;</div><div class="line">  <span class="comment">// this method scans the parameter tau and finds the kink in the L curve</span></div><div class="line">  <span class="comment">// finally, the unfolding is done for the best choice of tau</span></div><div class="line">  <a class="code" href="RtypesCore_8h.html#a3885b911a54b47a4e61671f45dd45d0b">Int_t</a> iBest=unfold.ScanLcurve(nScan,0.,0.,&amp;lCurve,&amp;logTauX,&amp;logTauY);</div><div class="line"></div><div class="line">  cout&lt;&lt;<span class="stringliteral">&quot;chi**2=&quot;</span>&lt;&lt;unfold.GetChi2A()&lt;&lt;<span class="stringliteral">&quot;+&quot;</span>&lt;&lt;unfold.GetChi2L()</div><div class="line">      &lt;&lt;<span class="stringliteral">&quot; / &quot;</span>&lt;&lt;unfold.GetNdf()&lt;&lt;<span class="stringliteral">&quot;\n&quot;</span>;</div><div class="line"></div><div class="line">  <span class="comment">// save graphs with one point to visualize best choice of tau</span></div><div class="line">  <a class="code" href="RtypesCore_8h.html#ab9b5334647b78ec4256db251e3ae1fc6">Double_t</a> t[1],<a class="code" href="legend1_8C.html#a13c6713ae496caa8195647f76887f926">x</a>[1],<a class="code" href="legend1_8C.html#a1380cd153a0fc78015dd604dbcb6c841">y</a>[1];</div><div class="line">  logTauX-&gt;<a class="code" href="classTSpline.html#a8fbe3832077ae0a14374173d978fa75f">GetKnot</a>(iBest,t[0],<a class="code" href="legend1_8C.html#a13c6713ae496caa8195647f76887f926">x</a>[0]);</div><div class="line">  logTauY-&gt;<a class="code" href="classTSpline.html#a8fbe3832077ae0a14374173d978fa75f">GetKnot</a>(iBest,t[0],<a class="code" href="legend1_8C.html#a1380cd153a0fc78015dd604dbcb6c841">y</a>[0]);</div><div class="line">  <a class="code" href="classTGraph.html">TGraph</a> *bestLcurve=<span class="keyword">new</span> <a class="code" href="classTGraph.html">TGraph</a>(1,<a class="code" href="legend1_8C.html#a13c6713ae496caa8195647f76887f926">x</a>,<a class="code" href="legend1_8C.html#a1380cd153a0fc78015dd604dbcb6c841">y</a>);</div><div class="line">  <a class="code" href="classTGraph.html">TGraph</a> *bestLogTauLogChi2=<span class="keyword">new</span> <a class="code" href="classTGraph.html">TGraph</a>(1,t,<a class="code" href="legend1_8C.html#a13c6713ae496caa8195647f76887f926">x</a>);</div><div class="line"></div><div class="line"></div><div class="line">  <span class="comment">//===========================</span></div><div class="line">  <span class="comment">// Step 6: retrieve unfolding results</span></div><div class="line"></div><div class="line">  <span class="comment">// get unfolding output</span></div><div class="line">  <span class="comment">// includes the statistical and background errors</span></div><div class="line">  <span class="comment">// but not the other systematic uncertainties</span></div><div class="line">  <a class="code" href="classTH1.html">TH1</a> *histUnfoldOutput=unfold.GetOutput(<span class="stringliteral">&quot;PT(unfold,stat+bgrerr)&quot;</span>);</div><div class="line"></div><div class="line">  <span class="comment">// retrieve error matrix of statistical errors</span></div><div class="line">  <a class="code" href="classTH2.html">TH2</a> *histEmatStat=unfold.GetEmatrixInput(<span class="stringliteral">&quot;unfolding stat error matrix&quot;</span>);</div><div class="line"></div><div class="line">  <span class="comment">// retrieve full error matrix</span></div><div class="line">  <span class="comment">// This includes all systematic errors</span></div><div class="line">  <a class="code" href="classTH2.html">TH2</a> *histEmatTotal=unfold.GetEmatrixTotal(<span class="stringliteral">&quot;unfolding total error matrix&quot;</span>);</div><div class="line"></div><div class="line">  <span class="comment">// create two copies of the unfolded data, one with statistical errors</span></div><div class="line">  <span class="comment">// the other with total errors</span></div><div class="line">  <a class="code" href="classTH1.html">TH1</a> *histUnfoldStat=<span class="keyword">new</span> <a class="code" href="classTH1D.html">TH1D</a>(<span class="stringliteral">&quot;PT(unfold,staterr)&quot;</span>,<span class="stringliteral">&quot;;Pt(gen)&quot;</span>,</div><div class="line">                                nGen,xminGen,xmaxGen);</div><div class="line">  <a class="code" href="classTH1.html">TH1</a> *histUnfoldTotal=<span class="keyword">new</span> <a class="code" href="classTH1D.html">TH1D</a>(<span class="stringliteral">&quot;PT(unfold,totalerr)&quot;</span>,<span class="stringliteral">&quot;;Pt(gen)&quot;</span>,</div><div class="line">                                 nGen,xminGen,xmaxGen);</div><div class="line">  <span class="keywordflow">for</span>(<a class="code" href="RtypesCore_8h.html#a3885b911a54b47a4e61671f45dd45d0b">Int_t</a> i=0;i&lt;nGen+2;i++) {</div><div class="line">     <a class="code" href="RtypesCore_8h.html#ab9b5334647b78ec4256db251e3ae1fc6">Double_t</a> <a class="code" href="RSha256_8hxx.html#a63f410abde93141c9013b7d3f3971738">c</a>=histUnfoldOutput-&gt;<a class="code" href="classTH1.html#ac70dcb4082bd510f5aa3e6efeb043f39">GetBinContent</a>(i);</div><div class="line"></div><div class="line">     <span class="comment">// histogram with unfolded data and stat errors</span></div><div class="line">     histUnfoldStat-&gt;<a class="code" href="classTH1.html#a9599e2dae40c574fd9d8970aaf638ee6">SetBinContent</a>(i,<a class="code" href="RSha256_8hxx.html#a63f410abde93141c9013b7d3f3971738">c</a>);</div><div class="line">     histUnfoldStat-&gt;<a class="code" href="classTH1.html#a73a3e35e3134bd53ddad841143f86573">SetBinError</a></div><div class="line">        (i,<a class="code" href="namespaceTMath.html#a9ea900c956031cb12057acf7c322b0fa">TMath::Sqrt</a>(histEmatStat-&gt;<a class="code" href="classTH2.html#ae1a28d839d8e176da5198e50c2d700c5">GetBinContent</a>(i,i)));</div><div class="line"></div><div class="line">     <span class="comment">// histogram with unfolded data and total errors</span></div><div class="line">     histUnfoldTotal-&gt;<a class="code" href="classTH1.html#a9599e2dae40c574fd9d8970aaf638ee6">SetBinContent</a>(i,<a class="code" href="RSha256_8hxx.html#a63f410abde93141c9013b7d3f3971738">c</a>);</div><div class="line">     histUnfoldTotal-&gt;<a class="code" href="classTH1.html#a73a3e35e3134bd53ddad841143f86573">SetBinError</a></div><div class="line">        (i,<a class="code" href="namespaceTMath.html#a9ea900c956031cb12057acf7c322b0fa">TMath::Sqrt</a>(histEmatTotal-&gt;<a class="code" href="classTH2.html#ae1a28d839d8e176da5198e50c2d700c5">GetBinContent</a>(i,i)));</div><div class="line">  }</div><div class="line"></div><div class="line">  <span class="comment">// create histogram with correlation matrix</span></div><div class="line">  <a class="code" href="classTH2D.html">TH2D</a> *histCorr=<span class="keyword">new</span> <a class="code" href="classTH2D.html">TH2D</a>(<span class="stringliteral">&quot;Corr(total)&quot;</span>,<span class="stringliteral">&quot;;Pt(gen);Pt(gen)&quot;</span>,</div><div class="line">                          nGen,xminGen,xmaxGen,nGen,xminGen,xmaxGen);</div><div class="line">  <span class="keywordflow">for</span>(<a class="code" href="RtypesCore_8h.html#a3885b911a54b47a4e61671f45dd45d0b">Int_t</a> i=0;i&lt;nGen+2;i++) {</div><div class="line">     <a class="code" href="RtypesCore_8h.html#ab9b5334647b78ec4256db251e3ae1fc6">Double_t</a> ei,ej;</div><div class="line">     ei=<a class="code" href="namespaceTMath.html#a9ea900c956031cb12057acf7c322b0fa">TMath::Sqrt</a>(histEmatTotal-&gt;<a class="code" href="classTH2.html#ae1a28d839d8e176da5198e50c2d700c5">GetBinContent</a>(i,i));</div><div class="line">     <span class="keywordflow">if</span>(ei&lt;=0.0) <span class="keywordflow">continue</span>;</div><div class="line">     <span class="keywordflow">for</span>(<a class="code" href="RtypesCore_8h.html#a3885b911a54b47a4e61671f45dd45d0b">Int_t</a> j=0;j&lt;nGen+2;j++) {</div><div class="line">        ej=<a class="code" href="namespaceTMath.html#a9ea900c956031cb12057acf7c322b0fa">TMath::Sqrt</a>(histEmatTotal-&gt;<a class="code" href="classTH2.html#ae1a28d839d8e176da5198e50c2d700c5">GetBinContent</a>(j,j));</div><div class="line">        <span class="keywordflow">if</span>(ej&lt;=0.0) <span class="keywordflow">continue</span>;</div><div class="line">        histCorr-&gt;<a class="code" href="classTH2.html#ae951a5fcde9f41a7cfa68acbe2d1b3c6">SetBinContent</a>(i,j,histEmatTotal-&gt;<a class="code" href="classTH2.html#ae1a28d839d8e176da5198e50c2d700c5">GetBinContent</a>(i,j)/ei/ej);</div><div class="line">     }</div><div class="line">  }</div><div class="line"></div><div class="line">  <span class="comment">// retrieve bgr source 1</span></div><div class="line">  <a class="code" href="classTH1.html">TH1</a> *histDetNormBgr1=unfold.GetBackground(<span class="stringliteral">&quot;bgr1 normalized&quot;</span>,</div><div class="line">                                             <span class="stringliteral">&quot;background1&quot;</span>);</div><div class="line">  <a class="code" href="classTH1.html">TH1</a> *histDetNormBgrTotal=unfold.GetBackground(<span class="stringliteral">&quot;bgr total normalized&quot;</span>);</div><div class="line"></div><div class="line">  <span class="comment">//========================</span></div><div class="line">  <span class="comment">// Step 7: plots</span></div><div class="line"></div><div class="line">  <a class="code" href="classTCanvas.html">TCanvas</a> <a class="code" href="win32gdk_2src_2gifencode_8c.html#a606a386e5db616c66c8c8d932d23dc39">output</a>;</div><div class="line">  <a class="code" href="win32gdk_2src_2gifencode_8c.html#a606a386e5db616c66c8c8d932d23dc39">output</a>.Divide(3,2);</div><div class="line">  <a class="code" href="win32gdk_2src_2gifencode_8c.html#a606a386e5db616c66c8c8d932d23dc39">output</a>.cd(1);</div><div class="line">  <span class="comment">// data, MC prediction, background</span></div><div class="line">  histUnfoldInput-&gt;<a class="code" href="classTH1.html#a89a5d8fc84154b504566f367ba8d0238">SetMinimum</a>(0.0);</div><div class="line">  histUnfoldInput-&gt;<a class="code" href="classTH1.html#aa53a024a9e94d5ec91e3ef49e49563da">Draw</a>(<span class="stringliteral">&quot;E&quot;</span>);</div><div class="line">  histDetMC-&gt;<a class="code" href="classTH1.html#a89a5d8fc84154b504566f367ba8d0238">SetMinimum</a>(0.0);</div><div class="line">  histDetMC-&gt;<a class="code" href="classTAttLine.html#a718156d3be0e4b3e0c52b2257a9d4e7a">SetLineColor</a>(<a class="code" href="Rtypes_8h.html#ac31db05c6cb5891c704eae374f6926a8aab48c32302f7159d81e081c41dc2d3d2">kBlue</a>);</div><div class="line">  histDetNormBgrTotal-&gt;<a class="code" href="classTAttLine.html#a718156d3be0e4b3e0c52b2257a9d4e7a">SetLineColor</a>(<a class="code" href="Rtypes_8h.html#ac31db05c6cb5891c704eae374f6926a8a5a655b1a02e5b0311571ca57ce4f3900">kRed</a>);</div><div class="line">  histDetNormBgr1-&gt;<a class="code" href="classTAttLine.html#a718156d3be0e4b3e0c52b2257a9d4e7a">SetLineColor</a>(<a class="code" href="Rtypes_8h.html#ac31db05c6cb5891c704eae374f6926a8aa50b50ee11f75960bd7dcc6e254e3783">kCyan</a>);</div><div class="line">  histDetMC-&gt;<a class="code" href="classTH1.html#aa53a024a9e94d5ec91e3ef49e49563da">Draw</a>(<span class="stringliteral">&quot;SAME HIST&quot;</span>);</div><div class="line">  histDetNormBgr1-&gt;<a class="code" href="classTH1.html#aa53a024a9e94d5ec91e3ef49e49563da">Draw</a>(<span class="stringliteral">&quot;SAME HIST&quot;</span>);</div><div class="line">  histDetNormBgrTotal-&gt;<a class="code" href="classTH1.html#aa53a024a9e94d5ec91e3ef49e49563da">Draw</a>(<span class="stringliteral">&quot;SAME HIST&quot;</span>);</div><div class="line"></div><div class="line">  <a class="code" href="win32gdk_2src_2gifencode_8c.html#a606a386e5db616c66c8c8d932d23dc39">output</a>.cd(2);</div><div class="line">  <span class="comment">// unfolded data, data truth, MC truth</span></div><div class="line">  histUnfoldTotal-&gt;<a class="code" href="classTH1.html#a89a5d8fc84154b504566f367ba8d0238">SetMinimum</a>(0.0);</div><div class="line">  histUnfoldTotal-&gt;<a class="code" href="classTH1.html#a68e78664002d109dd4747964d66778a3">SetMaximum</a>(histUnfoldTotal-&gt;<a class="code" href="classTH1.html#a653d76932d3710f5f021be4c5d019167">GetMaximum</a>()*1.5);</div><div class="line">  <span class="comment">// outer error: total error</span></div><div class="line">  histUnfoldTotal-&gt;<a class="code" href="classTH1.html#aa53a024a9e94d5ec91e3ef49e49563da">Draw</a>(<span class="stringliteral">&quot;E&quot;</span>);</div><div class="line">  <span class="comment">// middle error: stat+bgr</span></div><div class="line">  histUnfoldOutput-&gt;<a class="code" href="classTH1.html#aa53a024a9e94d5ec91e3ef49e49563da">Draw</a>(<span class="stringliteral">&quot;SAME E1&quot;</span>);</div><div class="line">  <span class="comment">// inner error: stat only</span></div><div class="line">  histUnfoldStat-&gt;<a class="code" href="classTH1.html#aa53a024a9e94d5ec91e3ef49e49563da">Draw</a>(<span class="stringliteral">&quot;SAME E1&quot;</span>);</div><div class="line">  histDataTruth-&gt;<a class="code" href="classTH1.html#aa53a024a9e94d5ec91e3ef49e49563da">Draw</a>(<span class="stringliteral">&quot;SAME HIST&quot;</span>);</div><div class="line">  histBbbSignalGen-&gt;<a class="code" href="classTAttLine.html#a718156d3be0e4b3e0c52b2257a9d4e7a">SetLineColor</a>(<a class="code" href="Rtypes_8h.html#ac31db05c6cb5891c704eae374f6926a8aab48c32302f7159d81e081c41dc2d3d2">kBlue</a>);</div><div class="line">  histBbbSignalGen-&gt;<a class="code" href="classTH1.html#aa53a024a9e94d5ec91e3ef49e49563da">Draw</a>(<span class="stringliteral">&quot;SAME HIST&quot;</span>);</div><div class="line"></div><div class="line">  <a class="code" href="win32gdk_2src_2gifencode_8c.html#a606a386e5db616c66c8c8d932d23dc39">output</a>.cd(3);</div><div class="line">  <span class="comment">// unfolding matrix</span></div><div class="line">  histUnfoldMatrix-&gt;<a class="code" href="classTAttLine.html#a718156d3be0e4b3e0c52b2257a9d4e7a">SetLineColor</a>(<a class="code" href="Rtypes_8h.html#ac31db05c6cb5891c704eae374f6926a8aab48c32302f7159d81e081c41dc2d3d2">kBlue</a>);</div><div class="line">  histUnfoldMatrix-&gt;<a class="code" href="classTH1.html#aa53a024a9e94d5ec91e3ef49e49563da">Draw</a>(<span class="stringliteral">&quot;BOX&quot;</span>);</div><div class="line"></div><div class="line">  <span class="comment">// show tau as a function of chi**2</span></div><div class="line">  <a class="code" href="win32gdk_2src_2gifencode_8c.html#a606a386e5db616c66c8c8d932d23dc39">output</a>.cd(4);</div><div class="line">  logTauX-&gt;<a class="code" href="classTSpline.html#a457d81feb5e496a87331b4895fc1834d">Draw</a>();</div><div class="line">  bestLogTauLogChi2-&gt;<a class="code" href="classTAttMarker.html#a27f1eae16a3f990024e8a401ed034fa3">SetMarkerColor</a>(<a class="code" href="Rtypes_8h.html#ac31db05c6cb5891c704eae374f6926a8a5a655b1a02e5b0311571ca57ce4f3900">kRed</a>);</div><div class="line">  bestLogTauLogChi2-&gt;<a class="code" href="classTGraph.html#a7ee6d3572ef075dd4fa1a6deb939a986">Draw</a>(<span class="stringliteral">&quot;*&quot;</span>);</div><div class="line"></div><div class="line">  <span class="comment">// show the L curve</span></div><div class="line">  <a class="code" href="win32gdk_2src_2gifencode_8c.html#a606a386e5db616c66c8c8d932d23dc39">output</a>.cd(5);</div><div class="line">  lCurve-&gt;<a class="code" href="classTGraph.html#a7ee6d3572ef075dd4fa1a6deb939a986">Draw</a>(<span class="stringliteral">&quot;AL&quot;</span>);</div><div class="line">  bestLcurve-&gt;<a class="code" href="classTAttMarker.html#a27f1eae16a3f990024e8a401ed034fa3">SetMarkerColor</a>(<a class="code" href="Rtypes_8h.html#ac31db05c6cb5891c704eae374f6926a8a5a655b1a02e5b0311571ca57ce4f3900">kRed</a>);</div><div class="line">  bestLcurve-&gt;<a class="code" href="classTGraph.html#a7ee6d3572ef075dd4fa1a6deb939a986">Draw</a>(<span class="stringliteral">&quot;*&quot;</span>);</div><div class="line"></div><div class="line">  <span class="comment">// show correlation matrix</span></div><div class="line">  <a class="code" href="win32gdk_2src_2gifencode_8c.html#a606a386e5db616c66c8c8d932d23dc39">output</a>.cd(6);</div><div class="line">  histCorr-&gt;<a class="code" href="classTH1.html#aa53a024a9e94d5ec91e3ef49e49563da">Draw</a>(<span class="stringliteral">&quot;BOX&quot;</span>);</div><div class="line"></div><div class="line">  <a class="code" href="win32gdk_2src_2gifencode_8c.html#a606a386e5db616c66c8c8d932d23dc39">output</a>.SaveAs(<span class="stringliteral">&quot;testUnfold3.ps&quot;</span>);</div><div class="line"></div><div class="line">  <span class="comment">//============================================================</span></div><div class="line">  <span class="comment">// step 8: compare results to the so-called bin-by-bin &quot;correction&quot;</span></div><div class="line"></div><div class="line">  std::cout&lt;&lt;<span class="stringliteral">&quot;bin truth   result   (stat)   (bgr)    (sys)\n&quot;</span>;</div><div class="line">  std::cout&lt;&lt;<span class="stringliteral">&quot;===+=====+=========+========+========+=======\n&quot;</span>;</div><div class="line">  <span class="keywordflow">for</span>(<a class="code" href="RtypesCore_8h.html#a3885b911a54b47a4e61671f45dd45d0b">Int_t</a> i=1;i&lt;=nGen;i++) {</div><div class="line">     <span class="comment">// data contribution in this bin</span></div><div class="line">     <a class="code" href="RtypesCore_8h.html#ab9b5334647b78ec4256db251e3ae1fc6">Double_t</a> data=histBbbInput-&gt;<a class="code" href="classTH1.html#ac70dcb4082bd510f5aa3e6efeb043f39">GetBinContent</a>(i);</div><div class="line">     <a class="code" href="RtypesCore_8h.html#ab9b5334647b78ec4256db251e3ae1fc6">Double_t</a> errData=histBbbInput-&gt;<a class="code" href="classTH1.html#a3af6cc15ab6c2490428c9b691885d919">GetBinError</a>(i);</div><div class="line"></div><div class="line">     <span class="comment">// subtract background contributions</span></div><div class="line">     <a class="code" href="RtypesCore_8h.html#ab9b5334647b78ec4256db251e3ae1fc6">Double_t</a> data_bgr=data</div><div class="line">        - scale_bgr*(histBbbBgr1-&gt;<a class="code" href="classTH1.html#ac70dcb4082bd510f5aa3e6efeb043f39">GetBinContent</a>(i)</div><div class="line">                     + histBbbBgr2-&gt;<a class="code" href="classTH1.html#ac70dcb4082bd510f5aa3e6efeb043f39">GetBinContent</a>(i)</div><div class="line">                     + histBbbBgrPt-&gt;<a class="code" href="classTH1.html#ac70dcb4082bd510f5aa3e6efeb043f39">GetBinContent</a>(i));</div><div class="line">     <a class="code" href="RtypesCore_8h.html#ab9b5334647b78ec4256db251e3ae1fc6">Double_t</a> errData_bgr=<a class="code" href="namespaceTMath.html#a9ea900c956031cb12057acf7c322b0fa">TMath::Sqrt</a></div><div class="line">        (errData*errData+</div><div class="line">         <a class="code" href="namespaceTMath.html#a9f3bcefa095d69086d20e7b76bc9bfc6">TMath::Power</a>(dscale_bgr*histBbbBgr1-&gt;<a class="code" href="classTH1.html#ac70dcb4082bd510f5aa3e6efeb043f39">GetBinContent</a>(i),2)+</div><div class="line">         <a class="code" href="namespaceTMath.html#a9f3bcefa095d69086d20e7b76bc9bfc6">TMath::Power</a>(scale_bgr*histBbbBgr1-&gt;<a class="code" href="classTH1.html#a3af6cc15ab6c2490428c9b691885d919">GetBinError</a>(i),2)+</div><div class="line">         <a class="code" href="namespaceTMath.html#a9f3bcefa095d69086d20e7b76bc9bfc6">TMath::Power</a>(dscale_bgr*histBbbBgr2-&gt;<a class="code" href="classTH1.html#ac70dcb4082bd510f5aa3e6efeb043f39">GetBinContent</a>(i),2)+</div><div class="line">         <a class="code" href="namespaceTMath.html#a9f3bcefa095d69086d20e7b76bc9bfc6">TMath::Power</a>(scale_bgr*histBbbBgr2-&gt;<a class="code" href="classTH1.html#a3af6cc15ab6c2490428c9b691885d919">GetBinError</a>(i),2)+</div><div class="line">         <a class="code" href="namespaceTMath.html#a9f3bcefa095d69086d20e7b76bc9bfc6">TMath::Power</a>(dscale_bgr*histBbbBgrPt-&gt;<a class="code" href="classTH1.html#ac70dcb4082bd510f5aa3e6efeb043f39">GetBinContent</a>(i),2)+</div><div class="line">         <a class="code" href="namespaceTMath.html#a9f3bcefa095d69086d20e7b76bc9bfc6">TMath::Power</a>(scale_bgr*histBbbBgrPt-&gt;<a class="code" href="classTH1.html#a3af6cc15ab6c2490428c9b691885d919">GetBinError</a>(i),2));</div><div class="line">     <span class="comment">// &quot;correct&quot; the data, using the Monte Carlo and neglecting off-diagonals</span></div><div class="line">     <a class="code" href="RtypesCore_8h.html#ab9b5334647b78ec4256db251e3ae1fc6">Double_t</a> fCorr=(histBbbSignalGen-&gt;<a class="code" href="classTH1.html#ac70dcb4082bd510f5aa3e6efeb043f39">GetBinContent</a>(i)/</div><div class="line">                     histBbbSignalRec-&gt;<a class="code" href="classTH1.html#ac70dcb4082bd510f5aa3e6efeb043f39">GetBinContent</a>(i));</div><div class="line">     <a class="code" href="RtypesCore_8h.html#ab9b5334647b78ec4256db251e3ae1fc6">Double_t</a> data_bbb= data_bgr *fCorr;</div><div class="line">     <span class="comment">// stat only error</span></div><div class="line">     <a class="code" href="RtypesCore_8h.html#ab9b5334647b78ec4256db251e3ae1fc6">Double_t</a> errData_stat_bbb = errData*fCorr;</div><div class="line">     <span class="comment">// stat plus background subtraction</span></div><div class="line">     <a class="code" href="RtypesCore_8h.html#ab9b5334647b78ec4256db251e3ae1fc6">Double_t</a> errData_statbgr_bbb = errData_bgr*fCorr;</div><div class="line"></div><div class="line">     <span class="comment">// estimate systematic error by repeating the exercise</span></div><div class="line">     <span class="comment">// using the MC with systematic shifts applied</span></div><div class="line">     <a class="code" href="RtypesCore_8h.html#ab9b5334647b78ec4256db251e3ae1fc6">Double_t</a> fCorr_sys=(histBbbSignalGenSys-&gt;<a class="code" href="classTH1.html#ac70dcb4082bd510f5aa3e6efeb043f39">GetBinContent</a>(i)/</div><div class="line">                         histBbbSignalRecSys-&gt;<a class="code" href="classTH1.html#ac70dcb4082bd510f5aa3e6efeb043f39">GetBinContent</a>(i));</div><div class="line">     <a class="code" href="RtypesCore_8h.html#ab9b5334647b78ec4256db251e3ae1fc6">Double_t</a> shift_sys= data_bgr*fCorr_sys - data_bbb;</div><div class="line"></div><div class="line">     <span class="comment">// add systematic shift quadratically and get total error</span></div><div class="line">     <a class="code" href="RtypesCore_8h.html#ab9b5334647b78ec4256db251e3ae1fc6">Double_t</a> errData_total_bbb=</div><div class="line">        <a class="code" href="namespaceTMath.html#a9ea900c956031cb12057acf7c322b0fa">TMath::Sqrt</a>(errData_statbgr_bbb*errData_statbgr_bbb</div><div class="line">                    +shift_sys*shift_sys);</div><div class="line"></div><div class="line">     <span class="comment">// get results from real unfolding</span></div><div class="line">     <a class="code" href="RtypesCore_8h.html#ab9b5334647b78ec4256db251e3ae1fc6">Double_t</a> data_unfold= histUnfoldStat-&gt;<a class="code" href="classTH1.html#ac70dcb4082bd510f5aa3e6efeb043f39">GetBinContent</a>(i);</div><div class="line">     <a class="code" href="RtypesCore_8h.html#ab9b5334647b78ec4256db251e3ae1fc6">Double_t</a> errData_stat_unfold=histUnfoldStat-&gt;<a class="code" href="classTH1.html#a3af6cc15ab6c2490428c9b691885d919">GetBinError</a>(i);</div><div class="line">     <a class="code" href="RtypesCore_8h.html#ab9b5334647b78ec4256db251e3ae1fc6">Double_t</a> errData_statbgr_unfold=histUnfoldOutput-&gt;<a class="code" href="classTH1.html#a3af6cc15ab6c2490428c9b691885d919">GetBinError</a>(i);</div><div class="line">     <a class="code" href="RtypesCore_8h.html#ab9b5334647b78ec4256db251e3ae1fc6">Double_t</a> errData_total_unfold=histUnfoldTotal-&gt;<a class="code" href="classTH1.html#a3af6cc15ab6c2490428c9b691885d919">GetBinError</a>(i);</div><div class="line"></div><div class="line">     <span class="comment">// compare</span></div><div class="line"></div><div class="line">     std::cout&lt;&lt;<a class="code" href="classTString.html#ac34bbb89627e20624a416dfbb7a3db70">TString::Format</a></div><div class="line">        (<span class="stringliteral">&quot;%3d %5.0f %8.1f +/-%5.1f +/-%5.1f +/-%5.1f (unfolding)&quot;</span>,</div><div class="line">         i,histDataTruth-&gt;<a class="code" href="classTH1.html#ac70dcb4082bd510f5aa3e6efeb043f39">GetBinContent</a>(i),data_unfold,</div><div class="line">         errData_stat_unfold,<a class="code" href="namespaceTMath.html#a9ea900c956031cb12057acf7c322b0fa">TMath::Sqrt</a>(errData_statbgr_unfold*</div><div class="line">                                         errData_statbgr_unfold-</div><div class="line">                                         errData_stat_unfold*</div><div class="line">                                         errData_stat_unfold),</div><div class="line">         <a class="code" href="namespaceTMath.html#a9ea900c956031cb12057acf7c322b0fa">TMath::Sqrt</a>(errData_total_unfold*</div><div class="line">                     errData_total_unfold-</div><div class="line">                     errData_statbgr_unfold*</div><div class="line">                     errData_statbgr_unfold))&lt;&lt;<span class="stringliteral">&quot;\n&quot;</span>;</div><div class="line">     std::cout&lt;&lt;<a class="code" href="classTString.html#ac34bbb89627e20624a416dfbb7a3db70">TString::Format</a></div><div class="line">        (<span class="stringliteral">&quot;          %8.1f +/-%5.1f +/-%5.1f +/-%5.1f (bin-by-bin)&quot;</span>,</div><div class="line">         data_bbb,errData_stat_bbb,<a class="code" href="namespaceTMath.html#a9ea900c956031cb12057acf7c322b0fa">TMath::Sqrt</a>(errData_statbgr_bbb*</div><div class="line">                                               errData_statbgr_bbb-</div><div class="line">                                               errData_stat_bbb*</div><div class="line">                                               errData_stat_bbb),</div><div class="line">         <a class="code" href="namespaceTMath.html#a9ea900c956031cb12057acf7c322b0fa">TMath::Sqrt</a>(errData_total_bbb*</div><div class="line">                     errData_total_bbb-</div><div class="line">                     errData_statbgr_bbb*</div><div class="line">                     errData_statbgr_bbb))</div><div class="line">              &lt;&lt;<span class="stringliteral">&quot;\n\n&quot;</span>;</div><div class="line">  }</div><div class="line">}</div></div><!-- fragment --><p><b>Version 17.6, in parallel to changes in <a class="el" href="classTUnfold.html" title="An algorithm to unfold distributions from detector to truth level. ">TUnfold</a></b></p>
<h4>History:</h4>
<ul>
<li>Version 17.5, in parallel to changes in <a class="el" href="classTUnfold.html" title="An algorithm to unfold distributions from detector to truth level. ">TUnfold</a></li>
<li>Version 17.4, in parallel to changes in <a class="el" href="classTUnfold.html" title="An algorithm to unfold distributions from detector to truth level. ">TUnfold</a></li>
<li>Version 17.3, in parallel to changes in <a class="el" href="classTUnfold.html" title="An algorithm to unfold distributions from detector to truth level. ">TUnfold</a></li>
<li>Version 17.2, in parallel to changes in <a class="el" href="classTUnfold.html" title="An algorithm to unfold distributions from detector to truth level. ">TUnfold</a></li>
<li>Version 17.1, in parallel to changes in <a class="el" href="classTUnfold.html" title="An algorithm to unfold distributions from detector to truth level. ">TUnfold</a></li>
<li>Version 17.0, change to use the class <a class="el" href="classTUnfoldDensity.html" title="An algorithm to unfold distributions from detector to truth level. ">TUnfoldDensity</a></li>
<li>Version 16.1, parallel to changes in <a class="el" href="classTUnfold.html" title="An algorithm to unfold distributions from detector to truth level. ">TUnfold</a></li>
<li>Version 16.0, parallel to changes in <a class="el" href="classTUnfold.html" title="An algorithm to unfold distributions from detector to truth level. ">TUnfold</a></li>
<li>Version 15, simple example including background subtraction</li>
</ul>
<p>This file is part of <a class="el" href="classTUnfold.html" title="An algorithm to unfold distributions from detector to truth level. ">TUnfold</a>.</p>
<p><a class="el" href="classTUnfold.html" title="An algorithm to unfold distributions from detector to truth level. ">TUnfold</a> is free software: you can redistribute it and/or modify it under the terms of the GNU General Public License as published by the Free Software Foundation, either version 3 of the License, or (at your option) any later version.</p>
<p><a class="el" href="classTUnfold.html" title="An algorithm to unfold distributions from detector to truth level. ">TUnfold</a> is distributed in the hope that it will be useful, but WITHOUT ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU General Public License for more details.</p>
<p>You should have received a copy of the GNU General Public License along with <a class="el" href="classTUnfold.html" title="An algorithm to unfold distributions from detector to truth level. ">TUnfold</a>. If not, see <a href="http://www.gnu.org/licenses/">http://www.gnu.org/licenses/</a>.</p>
<dl class="section author"><dt>Author</dt><dd>Stefan Schmitt DESY, 14.10.2008 </dd></dl>

<p class="definition">Definition in file <a class="el" href="testUnfold3_8C_source.html">testUnfold3.C</a>.</p>
</div></div><!-- contents -->
<html>
<body>
<div id="footer" style="background-color:#E5EBF3;">
<small>
<img class="footer" src="rootlogo_s.gif" alt="root"/></a>
ROOT 6.18/03 - Reference Guide Generated on Thu Aug 29 2019 04:10:34 (GVA Time) using Doxygen 1.8.14.
</small>
</div>
</body>
</html>
