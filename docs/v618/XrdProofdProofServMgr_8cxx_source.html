<!-- HTML header for doxygen 1.8.6-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.14"/>
<title>ROOT: proof/proofd/src/XrdProofdProofServMgr.cxx Source File</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/x-mathjax-config">
  MathJax.Hub.Config({
    extensions: ["tex2jax.js"],
    jax: ["input/TeX","output/HTML-CSS"],
});
</script><script type="text/javascript" async src="./mathjax/MathJax.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="ROOT.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table bgcolor="#346295" cellspacing="0" cellpadding="0">
  <tr>
    <td> <img style="height:90px" alt="Logo" src="rootlogo.gif"/> </td>
    <td valign="middle" style="color: #FFFFFF" nowrap="nowrap"><font size="6">ROOT</font> &#160; 6.18/03 <br> Reference Guide </td>
    <td style="width:100%"> </td>
  </tr>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.14 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div id="nav-path" class="navpath">
  <ul>
<li class="navelem"><a class="el" href="dir_fe12f41d3d3092bbef531b606df75bb2.html">proof</a></li><li class="navelem"><a class="el" href="dir_8b22ffdfe7b9a032e8015a269e56c5b5.html">proofd</a></li><li class="navelem"><a class="el" href="dir_3d83a88aec459430d47b506f67735144.html">src</a></li>  </ul>
</div>
</div><!-- top -->
<div class="header">
  <div class="headertitle">
<div class="title">XrdProofdProofServMgr.cxx</div>  </div>
</div><!--header-->
<div class="contents">
<a href="XrdProofdProofServMgr_8cxx.html">Go to the documentation of this file.</a><div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;<span class="comment">// @(#)root/proofd:$Id$</span></div><div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;<span class="comment">// Author: G. Ganis Jan 2008</span></div><div class="line"><a name="l00003"></a><span class="lineno">    3</span>&#160;</div><div class="line"><a name="l00004"></a><span class="lineno">    4</span>&#160;<span class="comment">/*************************************************************************</span></div><div class="line"><a name="l00005"></a><span class="lineno">    5</span>&#160;<span class="comment"> * Copyright (C) 1995-2005, Rene Brun and Fons Rademakers.               *</span></div><div class="line"><a name="l00006"></a><span class="lineno">    6</span>&#160;<span class="comment"> * All rights reserved.                                                  *</span></div><div class="line"><a name="l00007"></a><span class="lineno">    7</span>&#160;<span class="comment"> *                                                                       *</span></div><div class="line"><a name="l00008"></a><span class="lineno">    8</span>&#160;<span class="comment"> * For the licensing terms see $ROOTSYS/LICENSE.                         *</span></div><div class="line"><a name="l00009"></a><span class="lineno">    9</span>&#160;<span class="comment"> * For the list of contributors see $ROOTSYS/README/CREDITS.             *</span></div><div class="line"><a name="l00010"></a><span class="lineno">   10</span>&#160;<span class="comment"> *************************************************************************/</span></div><div class="line"><a name="l00011"></a><span class="lineno">   11</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00012"></a><span class="lineno">   12</span>&#160;<span class="comment">//////////////////////////////////////////////////////////////////////////</span></div><div class="line"><a name="l00013"></a><span class="lineno">   13</span>&#160;<span class="comment"></span><span class="comment">//                                                                      //</span></div><div class="line"><a name="l00014"></a><span class="lineno">   14</span>&#160;<span class="comment">// XrdProofdProofServMgr                                                //</span></div><div class="line"><a name="l00015"></a><span class="lineno">   15</span>&#160;<span class="comment">//                                                                      //</span></div><div class="line"><a name="l00016"></a><span class="lineno">   16</span>&#160;<span class="comment">// Author: G. Ganis, CERN, 2008                                         //</span></div><div class="line"><a name="l00017"></a><span class="lineno">   17</span>&#160;<span class="comment">//                                                                      //</span></div><div class="line"><a name="l00018"></a><span class="lineno">   18</span>&#160;<span class="comment">// Class managing proofserv sessions manager.                           //</span></div><div class="line"><a name="l00019"></a><span class="lineno">   19</span>&#160;<span class="comment">//                                                                      //</span><span class="comment"></span></div><div class="line"><a name="l00020"></a><span class="lineno">   20</span>&#160;<span class="comment">//////////////////////////////////////////////////////////////////////////</span></div><div class="line"><a name="l00021"></a><span class="lineno">   21</span>&#160;<span class="comment"></span><span class="preprocessor">#include &quot;<a class="code" href="XrdProofdPlatform_8h.html">XrdProofdPlatform.h</a>&quot;</span></div><div class="line"><a name="l00022"></a><span class="lineno">   22</span>&#160;</div><div class="line"><a name="l00023"></a><span class="lineno">   23</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="XpdSysDNS_8h.html">XpdSysDNS.h</a>&quot;</span></div><div class="line"><a name="l00024"></a><span class="lineno">   24</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="XpdSysError_8h.html">XpdSysError.h</a>&quot;</span></div><div class="line"><a name="l00025"></a><span class="lineno">   25</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="XpdSysLogger_8h.html">XpdSysLogger.h</a>&quot;</span></div><div class="line"><a name="l00026"></a><span class="lineno">   26</span>&#160;</div><div class="line"><a name="l00027"></a><span class="lineno">   27</span>&#160;<span class="preprocessor">#include &quot;Xrd/XrdBuffer.hh&quot;</span></div><div class="line"><a name="l00028"></a><span class="lineno">   28</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="XrdPoll_8hh.html">Xrd/XrdPoll.hh</a>&quot;</span></div><div class="line"><a name="l00029"></a><span class="lineno">   29</span>&#160;<span class="preprocessor">#include &quot;Xrd/XrdScheduler.hh&quot;</span></div><div class="line"><a name="l00030"></a><span class="lineno">   30</span>&#160;<span class="preprocessor">#include &quot;XrdNet/XrdNet.hh&quot;</span></div><div class="line"><a name="l00031"></a><span class="lineno">   31</span>&#160;<span class="preprocessor">#include &quot;XrdOuc/XrdOucRash.hh&quot;</span></div><div class="line"><a name="l00032"></a><span class="lineno">   32</span>&#160;<span class="preprocessor">#include &quot;XrdOuc/XrdOucStream.hh&quot;</span></div><div class="line"><a name="l00033"></a><span class="lineno">   33</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="XrdSysPriv_8hh.html">XrdSys/XrdSysPriv.hh</a>&quot;</span></div><div class="line"><a name="l00034"></a><span class="lineno">   34</span>&#160;<span class="preprocessor">#include &quot;XrdSys/XrdSysPlugin.hh&quot;</span></div><div class="line"><a name="l00035"></a><span class="lineno">   35</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="XrdProofdClient_8h.html">XrdProofdClient.h</a>&quot;</span></div><div class="line"><a name="l00036"></a><span class="lineno">   36</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="XrdProofdClientMgr_8h.html">XrdProofdClientMgr.h</a>&quot;</span></div><div class="line"><a name="l00037"></a><span class="lineno">   37</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="XrdProofdManager_8h.html">XrdProofdManager.h</a>&quot;</span></div><div class="line"><a name="l00038"></a><span class="lineno">   38</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="XrdProofdNetMgr_8h.html">XrdProofdNetMgr.h</a>&quot;</span></div><div class="line"><a name="l00039"></a><span class="lineno">   39</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="XrdProofdPriorityMgr_8h.html">XrdProofdPriorityMgr.h</a>&quot;</span></div><div class="line"><a name="l00040"></a><span class="lineno">   40</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="XrdProofdProofServMgr_8h.html">XrdProofdProofServMgr.h</a>&quot;</span></div><div class="line"><a name="l00041"></a><span class="lineno">   41</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="XrdProofdProtocol_8h.html">XrdProofdProtocol.h</a>&quot;</span></div><div class="line"><a name="l00042"></a><span class="lineno">   42</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="XrdProofGroup_8h.html">XrdProofGroup.h</a>&quot;</span></div><div class="line"><a name="l00043"></a><span class="lineno">   43</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="XrdProofSched_8h.html">XrdProofSched.h</a>&quot;</span></div><div class="line"><a name="l00044"></a><span class="lineno">   44</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="XrdROOT_8h.html">XrdROOT.h</a>&quot;</span></div><div class="line"><a name="l00045"></a><span class="lineno">   45</span>&#160;</div><div class="line"><a name="l00046"></a><span class="lineno">   46</span>&#160;<span class="preprocessor">#include &lt;grp.h&gt;</span></div><div class="line"><a name="l00047"></a><span class="lineno">   47</span>&#160;<span class="preprocessor">#include &lt;map&gt;</span></div><div class="line"><a name="l00048"></a><span class="lineno">   48</span>&#160;<span class="preprocessor">#include &lt;unistd.h&gt;</span></div><div class="line"><a name="l00049"></a><span class="lineno">   49</span>&#160;</div><div class="line"><a name="l00050"></a><span class="lineno">   50</span>&#160;<span class="comment">// Aux structures for scan through operations</span></div><div class="line"><a name="l00051"></a><span class="lineno">   51</span>&#160;<span class="keyword">typedef</span> <span class="keyword">struct </span>{</div><div class="line"><a name="l00052"></a><span class="lineno">   52</span>&#160;   <a class="code" href="classXrdProofGroupMgr.html">XrdProofGroupMgr</a> *fGroupMgr;</div><div class="line"><a name="l00053"></a><span class="lineno">   53</span>&#160;   <span class="keywordtype">int</span> *fNBroadcast;</div><div class="line"><a name="l00054"></a><span class="lineno">   54</span>&#160;} XpdBroadcastPriority_t;</div><div class="line"><a name="l00055"></a><span class="lineno">   55</span>&#160;<span class="keyword">typedef</span> <span class="keyword">struct </span>{</div><div class="line"><a name="l00056"></a><span class="lineno">   56</span>&#160;   <a class="code" href="classXrdProofdManager.html">XrdProofdManager</a> *fMgr;</div><div class="line"><a name="l00057"></a><span class="lineno">   57</span>&#160;   <a class="code" href="classXrdProofdClient.html">XrdProofdClient</a> *fClient;</div><div class="line"><a name="l00058"></a><span class="lineno">   58</span>&#160;   FILE *fEnv;</div><div class="line"><a name="l00059"></a><span class="lineno">   59</span>&#160;   <span class="keywordtype">bool</span> fExport;</div><div class="line"><a name="l00060"></a><span class="lineno">   60</span>&#160;} XpdWriteEnv_t;</div><div class="line"><a name="l00061"></a><span class="lineno">   61</span>&#160;</div><div class="line"><a name="l00062"></a><span class="lineno">   62</span>&#160;<span class="preprocessor">#ifndef PutEnv</span></div><div class="line"><a name="l00063"></a><span class="lineno"><a class="line" href="XrdProofdProofServMgr_8cxx.html#a7cfa47f520ffb28d614134a05dc8cb14">   63</a></span>&#160;<span class="preprocessor">#define PutEnv(x,e) { if (e) { putenv(x); } else { delete[] x; } }</span></div><div class="line"><a name="l00064"></a><span class="lineno">   64</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l00065"></a><span class="lineno">   65</span>&#160;</div><div class="line"><a name="l00066"></a><span class="lineno">   66</span>&#160;<span class="comment">// Tracing utilities</span></div><div class="line"><a name="l00067"></a><span class="lineno">   67</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="XrdProofdTrace_8h.html">XrdProofdTrace.h</a>&quot;</span></div><div class="line"><a name="l00068"></a><span class="lineno">   68</span>&#160;</div><div class="line"><a name="l00069"></a><span class="lineno"><a class="line" href="XrdProofdProofServMgr_8cxx.html#ae6f1dbe8fdbfff0847439c11076a4ac2">   69</a></span>&#160;<span class="keyword">static</span> <a class="code" href="structXpdManagerCron__t.html">XpdManagerCron_t</a> <a class="code" href="XrdProofdProofServMgr_8cxx.html#ae6f1dbe8fdbfff0847439c11076a4ac2">fManagerCron</a>;</div><div class="line"><a name="l00070"></a><span class="lineno">   70</span>&#160;</div><div class="line"><a name="l00071"></a><span class="lineno">   71</span>&#160;<span class="comment">//--------------------------------------------------------------------------</span></div><div class="line"><a name="l00072"></a><span class="lineno">   72</span>&#160;<span class="comment">//</span></div><div class="line"><a name="l00073"></a><span class="lineno">   73</span>&#160;<span class="comment">// XrdProofdProofServCron</span></div><div class="line"><a name="l00074"></a><span class="lineno">   74</span>&#160;<span class="comment">//</span></div><div class="line"><a name="l00075"></a><span class="lineno">   75</span>&#160;<span class="comment">// Function run in separate thread watching changes in session status</span></div><div class="line"><a name="l00076"></a><span class="lineno">   76</span>&#160;<span class="comment">// frequency</span></div><div class="line"><a name="l00077"></a><span class="lineno">   77</span>&#160;<span class="comment">//</span><span class="comment"></span></div><div class="line"><a name="l00078"></a><span class="lineno">   78</span>&#160;<span class="comment">////////////////////////////////////////////////////////////////////////////////</span></div><div class="line"><a name="l00079"></a><span class="lineno">   79</span>&#160;<span class="comment">/// This is an endless loop to check the system periodically or when</span></div><div class="line"><a name="l00080"></a><span class="lineno">   80</span>&#160;<span class="comment">/// triggered via a message in a dedicated pipe</span></div><div class="line"><a name="l00081"></a><span class="lineno">   81</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00082"></a><span class="lineno"><a class="line" href="XrdProofdProofServMgr_8cxx.html#acb7a7a3f2f44854897676341935e1161">   82</a></span>&#160;<span class="keywordtype">void</span> *<a class="code" href="XrdProofdProofServMgr_8cxx.html#acb7a7a3f2f44854897676341935e1161">XrdProofdProofServCron</a>(<span class="keywordtype">void</span> *p)</div><div class="line"><a name="l00083"></a><span class="lineno">   83</span>&#160;{</div><div class="line"><a name="l00084"></a><span class="lineno">   84</span>&#160;   <a class="code" href="XrdProofdTrace_8h.html#a7c31822912a8d0dc9bfd544097b29e12">XPDLOC</a>(SMGR, <span class="stringliteral">&quot;ProofServCron&quot;</span>)</div><div class="line"><a name="l00085"></a><span class="lineno">   85</span>&#160;</div><div class="line"><a name="l00086"></a><span class="lineno">   86</span>&#160;   <a class="code" href="structXpdManagerCron__t.html">XpdManagerCron_t</a> *mc = (<a class="code" href="structXpdManagerCron__t.html">XpdManagerCron_t</a> *)p;</div><div class="line"><a name="l00087"></a><span class="lineno">   87</span>&#160;   <a class="code" href="classXrdProofdProofServMgr.html">XrdProofdProofServMgr</a> *mgr = mc-&gt;<a class="code" href="structXpdManagerCron__t.html#a847ebc78e5dabbd2910df2994ad60c68">fSessionMgr</a>;</div><div class="line"><a name="l00088"></a><span class="lineno">   88</span>&#160;   <a class="code" href="classXrdProofSched.html">XrdProofSched</a> *sched = mc-&gt;<a class="code" href="structXpdManagerCron__t.html#ad59ee4aee440c474f8ad13d5f6b4db2d">fProofSched</a>;</div><div class="line"><a name="l00089"></a><span class="lineno">   89</span>&#160;   <span class="keywordflow">if</span> (!(mgr)) {</div><div class="line"><a name="l00090"></a><span class="lineno">   90</span>&#160;      <a class="code" href="TGHtml_8h.html#ad5bb4a3d12fd54f29da2b924b29e652b">TRACE</a>(XERR,  <span class="stringliteral">&quot;undefined session manager: cannot start&quot;</span>);</div><div class="line"><a name="l00091"></a><span class="lineno">   91</span>&#160;      <span class="keywordflow">return</span> (<span class="keywordtype">void</span> *)0;</div><div class="line"><a name="l00092"></a><span class="lineno">   92</span>&#160;   }</div><div class="line"><a name="l00093"></a><span class="lineno">   93</span>&#160;</div><div class="line"><a name="l00094"></a><span class="lineno">   94</span>&#160;   <span class="comment">// Quicj checks for client disconnections: frequency (5 secs) and</span></div><div class="line"><a name="l00095"></a><span class="lineno">   95</span>&#160;   <span class="comment">// flag for disconnections effectively occuring</span></div><div class="line"><a name="l00096"></a><span class="lineno">   96</span>&#160;   <span class="keywordtype">int</span> quickcheckfreq = 5;</div><div class="line"><a name="l00097"></a><span class="lineno">   97</span>&#160;   <span class="keywordtype">int</span> clnlostscale = 0;</div><div class="line"><a name="l00098"></a><span class="lineno">   98</span>&#160;</div><div class="line"><a name="l00099"></a><span class="lineno">   99</span>&#160;   <span class="comment">// Time of last full sessions check</span></div><div class="line"><a name="l00100"></a><span class="lineno">  100</span>&#160;   <span class="keywordtype">int</span> lastrun = time(0);</div><div class="line"><a name="l00101"></a><span class="lineno">  101</span>&#160;   <span class="keywordtype">int</span> lastcheck = lastrun, ckfreq = mgr-&gt;<a class="code" href="classXrdProofdProofServMgr.html#aeb9a5a16403495ef007aa9717ebaf482">CheckFrequency</a>(), waitt = 0;</div><div class="line"><a name="l00102"></a><span class="lineno">  102</span>&#160;   <span class="keywordtype">int</span> deltat = ((int)(0.1*ckfreq) &gt;= 1) ? (<span class="keywordtype">int</span>)(0.1*ckfreq) : 1;</div><div class="line"><a name="l00103"></a><span class="lineno">  103</span>&#160;   <span class="keywordtype">int</span> maxdelay = 5*ckfreq; <span class="comment">// Force check after 5 times the check frequency</span></div><div class="line"><a name="l00104"></a><span class="lineno">  104</span>&#160;   mgr-&gt;<a class="code" href="classXrdProofdProofServMgr.html#aa6d48bec6ed96ba43ce7702d3451997a">SetNextSessionsCheck</a>(lastcheck + ckfreq);</div><div class="line"><a name="l00105"></a><span class="lineno">  105</span>&#160;   <a class="code" href="TGHtml_8h.html#ad5bb4a3d12fd54f29da2b924b29e652b">TRACE</a>(ALL, <span class="stringliteral">&quot;next full sessions check in &quot;</span>&lt;&lt;ckfreq&lt;&lt;<span class="stringliteral">&quot; secs&quot;</span>);</div><div class="line"><a name="l00106"></a><span class="lineno">  106</span>&#160;   <span class="keywordflow">while</span>(1) {</div><div class="line"><a name="l00107"></a><span class="lineno">  107</span>&#160;      <span class="comment">// We check for client disconnections every &#39;quickcheckfreq&#39; secs; we do</span></div><div class="line"><a name="l00108"></a><span class="lineno">  108</span>&#160;      <span class="comment">// a full check every mgr-&gt;CheckFrequency() secs; we make sure that we</span></div><div class="line"><a name="l00109"></a><span class="lineno">  109</span>&#160;      <span class="comment">// do not pass a negative value (meaning no timeout)</span></div><div class="line"><a name="l00110"></a><span class="lineno">  110</span>&#160;      waitt =  ckfreq - (time(0) - lastcheck);</div><div class="line"><a name="l00111"></a><span class="lineno">  111</span>&#160;      <span class="keywordflow">if</span> (waitt &gt; quickcheckfreq || waitt &lt;= 0)</div><div class="line"><a name="l00112"></a><span class="lineno">  112</span>&#160;         waitt = quickcheckfreq;</div><div class="line"><a name="l00113"></a><span class="lineno">  113</span>&#160;      <span class="keywordtype">int</span> pollRet = mgr-&gt;<a class="code" href="classXrdProofdProofServMgr.html#a2ad6176eb419d7edd51704580d006993">Pipe</a>()-&gt;<a class="code" href="classXrdProofdPipe.html#a51532896ac35adec6efe6840dcac0354">Poll</a>(waitt);</div><div class="line"><a name="l00114"></a><span class="lineno">  114</span>&#160;</div><div class="line"><a name="l00115"></a><span class="lineno">  115</span>&#160;      <span class="keywordflow">if</span> (pollRet &gt; 0) {</div><div class="line"><a name="l00116"></a><span class="lineno">  116</span>&#160;         <span class="comment">// Read message</span></div><div class="line"><a name="l00117"></a><span class="lineno">  117</span>&#160;         <a class="code" href="classXpdMsg.html">XpdMsg</a> msg;</div><div class="line"><a name="l00118"></a><span class="lineno">  118</span>&#160;         <span class="keywordtype">int</span> rc = 0;</div><div class="line"><a name="l00119"></a><span class="lineno">  119</span>&#160;         <span class="keywordflow">if</span> ((rc = mgr-&gt;<a class="code" href="classXrdProofdProofServMgr.html#a2ad6176eb419d7edd51704580d006993">Pipe</a>()-&gt;<a class="code" href="classXrdProofdPipe.html#a4d40ad82fde9e49c25085779ad82c27c">Recv</a>(msg)) != 0) {</div><div class="line"><a name="l00120"></a><span class="lineno">  120</span>&#160;            <a class="code" href="TGHtml_8h.html#ad5bb4a3d12fd54f29da2b924b29e652b">TRACE</a>(XERR, <span class="stringliteral">&quot;problems receiving message; errno: &quot;</span>&lt;&lt;-rc);</div><div class="line"><a name="l00121"></a><span class="lineno">  121</span>&#160;            <span class="keywordflow">continue</span>;</div><div class="line"><a name="l00122"></a><span class="lineno">  122</span>&#160;         }</div><div class="line"><a name="l00123"></a><span class="lineno">  123</span>&#160;         <span class="comment">// Parse type</span></div><div class="line"><a name="l00124"></a><span class="lineno">  124</span>&#160;         <span class="keywordflow">if</span> (msg.<a class="code" href="classXpdMsg.html#a29c82456ff1bc75ba72be288f96c7693">Type</a>() == <a class="code" href="classXrdProofdProofServMgr.html#aaebdf9da139d40cf89c6c98f38941c97acd0b6b8d06824cfff38e240575b61036">XrdProofdProofServMgr::kSessionRemoval</a>) {</div><div class="line"><a name="l00125"></a><span class="lineno">  125</span>&#160;            <span class="comment">// A session has just gone: read process id</span></div><div class="line"><a name="l00126"></a><span class="lineno">  126</span>&#160;            XrdOucString fpid;</div><div class="line"><a name="l00127"></a><span class="lineno">  127</span>&#160;            <span class="keywordflow">if</span> ((rc = msg.<a class="code" href="classXpdMsg.html#aa9622613afd3280395e27cc6e2e2b440">Get</a>(fpid)) != 0) {</div><div class="line"><a name="l00128"></a><span class="lineno">  128</span>&#160;               <a class="code" href="TGHtml_8h.html#ad5bb4a3d12fd54f29da2b924b29e652b">TRACE</a>(XERR, <span class="stringliteral">&quot;kSessionRemoval: problems receiving process ID (buf: &#39;&quot;</span>&lt;&lt;</div><div class="line"><a name="l00129"></a><span class="lineno">  129</span>&#160;                           msg.<a class="code" href="classXpdMsg.html#a76f23fb246000fb53707c441192776a7">Buf</a>()&lt;&lt;<span class="stringliteral">&quot;&#39;); errno: &quot;</span>&lt;&lt;-rc);</div><div class="line"><a name="l00130"></a><span class="lineno">  130</span>&#160;               <span class="keywordflow">continue</span>;</div><div class="line"><a name="l00131"></a><span class="lineno">  131</span>&#160;            }</div><div class="line"><a name="l00132"></a><span class="lineno">  132</span>&#160;            <a class="code" href="XrdSysToOuc_8h.html#a4ba18bedbb8a1a4367d57f49a4d773ce">XrdSysMutexHelper</a> mhp(mgr-&gt;<a class="code" href="classXrdProofdProofServMgr.html#ad740c44abd44e15d5c58ba014b310307">Mutex</a>());</div><div class="line"><a name="l00133"></a><span class="lineno">  133</span>&#160;            <span class="comment">// Remove it from the hash list</span></div><div class="line"><a name="l00134"></a><span class="lineno">  134</span>&#160;            mgr-&gt;<a class="code" href="classXrdProofdProofServMgr.html#ab78ba4f2c0b8916e62977e50b6677c02">DeleteFromSessions</a>(fpid.c_str());</div><div class="line"><a name="l00135"></a><span class="lineno">  135</span>&#160;            <span class="comment">// Move the entry to the terminated sessions area</span></div><div class="line"><a name="l00136"></a><span class="lineno">  136</span>&#160;            mgr-&gt;<a class="code" href="classXrdProofdProofServMgr.html#a3afafd9e885f8c755801496783ae333e">MvSession</a>(fpid.c_str());</div><div class="line"><a name="l00137"></a><span class="lineno">  137</span>&#160;            <span class="comment">// Notify the scheduler too</span></div><div class="line"><a name="l00138"></a><span class="lineno">  138</span>&#160;            <span class="keywordflow">if</span> (sched) {</div><div class="line"><a name="l00139"></a><span class="lineno">  139</span>&#160;               <span class="keywordflow">if</span> (sched-&gt;<a class="code" href="classXrdProofSched.html#a90df9f0af902f68f8cf248f52e68c2f4">Pipe</a>()-&gt;<a class="code" href="classXrdProofdPipe.html#af3d2dbc5b021d794acc09bdc0aa3fa5e">Post</a>(<a class="code" href="classXrdProofSched.html#a99837614e43c388e939032a008323e4ea1e3d8e3c5bcd49ce0e5451c81cf96a77">XrdProofSched::kReschedule</a>, 0) != 0) {</div><div class="line"><a name="l00140"></a><span class="lineno">  140</span>&#160;                  <a class="code" href="TGHtml_8h.html#ad5bb4a3d12fd54f29da2b924b29e652b">TRACE</a>(XERR, <span class="stringliteral">&quot;kSessionRemoval: problem posting the scheduler pipe&quot;</span>);</div><div class="line"><a name="l00141"></a><span class="lineno">  141</span>&#160;               }</div><div class="line"><a name="l00142"></a><span class="lineno">  142</span>&#160;            }</div><div class="line"><a name="l00143"></a><span class="lineno">  143</span>&#160;            <span class="comment">// Notify action</span></div><div class="line"><a name="l00144"></a><span class="lineno">  144</span>&#160;            <a class="code" href="TGHtml_8h.html#ad5bb4a3d12fd54f29da2b924b29e652b">TRACE</a>(REQ, <span class="stringliteral">&quot;kSessionRemoval: session: &quot;</span>&lt;&lt;fpid&lt;&lt;</div><div class="line"><a name="l00145"></a><span class="lineno">  145</span>&#160;                        <span class="stringliteral">&quot; has been removed from the active list&quot;</span>);</div><div class="line"><a name="l00146"></a><span class="lineno">  146</span>&#160;        } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (msg.<a class="code" href="classXpdMsg.html#a29c82456ff1bc75ba72be288f96c7693">Type</a>() == <a class="code" href="classXrdProofdProofServMgr.html#aaebdf9da139d40cf89c6c98f38941c97ae9a4ce032524114f728898ec5ca413ac">XrdProofdProofServMgr::kClientDisconnect</a>) {</div><div class="line"><a name="l00147"></a><span class="lineno">  147</span>&#160;            <span class="comment">// Obsolete</span></div><div class="line"><a name="l00148"></a><span class="lineno">  148</span>&#160;            <a class="code" href="TGHtml_8h.html#ad5bb4a3d12fd54f29da2b924b29e652b">TRACE</a>(XERR, <span class="stringliteral">&quot;obsolete type: XrdProofdProofServMgr::kClientDisconnect&quot;</span>);</div><div class="line"><a name="l00149"></a><span class="lineno">  149</span>&#160;        } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (msg.<a class="code" href="classXpdMsg.html#a29c82456ff1bc75ba72be288f96c7693">Type</a>() == <a class="code" href="classXrdProofdProofServMgr.html#aaebdf9da139d40cf89c6c98f38941c97af81d5f6e2cc719e8e1f0fbe92ee14f93">XrdProofdProofServMgr::kCleanSessions</a>) {</div><div class="line"><a name="l00150"></a><span class="lineno">  150</span>&#160;            <span class="comment">// Request for cleanup all sessions of a client (or all clients)</span></div><div class="line"><a name="l00151"></a><span class="lineno">  151</span>&#160;            <a class="code" href="classXpdSrvMgrCreateCnt.html">XpdSrvMgrCreateCnt</a> <a class="code" href="namespacexmlio.html#a7da9572bcb8815ae48bc1845efd235b5">cnt</a>(mgr, <a class="code" href="classXrdProofdProofServMgr.html#a34c425cdb5ec334f7c3b7acc2fa335e5af201ff79b593ebb09185a708eeefc602">XrdProofdProofServMgr::kCleanSessionsCnt</a>);</div><div class="line"><a name="l00152"></a><span class="lineno">  152</span>&#160;            XrdOucString usr;</div><div class="line"><a name="l00153"></a><span class="lineno">  153</span>&#160;            rc = msg.<a class="code" href="classXpdMsg.html#aa9622613afd3280395e27cc6e2e2b440">Get</a>(usr);</div><div class="line"><a name="l00154"></a><span class="lineno">  154</span>&#160;            <span class="keywordtype">int</span> svrtype = <a class="code" href="XProofProtocol_8h.html#a727fb77180370df43315288005e23b99">kXPD_AnyServer</a>;</div><div class="line"><a name="l00155"></a><span class="lineno">  155</span>&#160;            rc = (rc == 0) ? msg.<a class="code" href="classXpdMsg.html#aa9622613afd3280395e27cc6e2e2b440">Get</a>(svrtype) : rc;</div><div class="line"><a name="l00156"></a><span class="lineno">  156</span>&#160;            <span class="keywordflow">if</span> (rc != 0) {</div><div class="line"><a name="l00157"></a><span class="lineno">  157</span>&#160;               <a class="code" href="TGHtml_8h.html#ad5bb4a3d12fd54f29da2b924b29e652b">TRACE</a>(XERR, <span class="stringliteral">&quot;kCleanSessions: problems parsing message (buf: &#39;&quot;</span>&lt;&lt;</div><div class="line"><a name="l00158"></a><span class="lineno">  158</span>&#160;                           msg.<a class="code" href="classXpdMsg.html#a76f23fb246000fb53707c441192776a7">Buf</a>()&lt;&lt;<span class="stringliteral">&quot;&#39;); errno: &quot;</span>&lt;&lt;-rc);</div><div class="line"><a name="l00159"></a><span class="lineno">  159</span>&#160;               <span class="keywordflow">continue</span>;</div><div class="line"><a name="l00160"></a><span class="lineno">  160</span>&#160;            }</div><div class="line"><a name="l00161"></a><span class="lineno">  161</span>&#160;            <span class="comment">// Notify action</span></div><div class="line"><a name="l00162"></a><span class="lineno">  162</span>&#160;            <a class="code" href="TGHtml_8h.html#ad5bb4a3d12fd54f29da2b924b29e652b">TRACE</a>(REQ, <span class="stringliteral">&quot;kCleanSessions: request for user: &#39;&quot;</span>&lt;&lt;usr&lt;&lt;<span class="stringliteral">&quot;&#39;, server type: &quot;</span>&lt;&lt;svrtype);</div><div class="line"><a name="l00163"></a><span class="lineno">  163</span>&#160;            <span class="comment">// Clean sessions</span></div><div class="line"><a name="l00164"></a><span class="lineno">  164</span>&#160;            mgr-&gt;<a class="code" href="classXrdProofdProofServMgr.html#afeb94f243e78b1fadae77fbaa52bcd39">CleanClientSessions</a>(usr.c_str(), svrtype);</div><div class="line"><a name="l00165"></a><span class="lineno">  165</span>&#160;            <span class="comment">// Check if there is any orphalin sessions and clean them up</span></div><div class="line"><a name="l00166"></a><span class="lineno">  166</span>&#160;            mgr-&gt;<a class="code" href="classXrdProofdProofServMgr.html#a235180ac7d5ec759ee1f6c924b9b85dc">CleanupLostProofServ</a>();</div><div class="line"><a name="l00167"></a><span class="lineno">  167</span>&#160;         } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (msg.<a class="code" href="classXpdMsg.html#a29c82456ff1bc75ba72be288f96c7693">Type</a>() == <a class="code" href="classXrdProofdProofServMgr.html#aaebdf9da139d40cf89c6c98f38941c97a75fd20e4a8f0ea218112713cd86648f1">XrdProofdProofServMgr::kProcessReq</a>) {</div><div class="line"><a name="l00168"></a><span class="lineno">  168</span>&#160;            <span class="comment">// Process request from some client: if we are here it means they can go ahead</span></div><div class="line"><a name="l00169"></a><span class="lineno">  169</span>&#160;            mgr-&gt;<a class="code" href="classXrdProofdProofServMgr.html#a21046ad1c642166890076df140f367a4">ProcessSem</a>()-&gt;Post();</div><div class="line"><a name="l00170"></a><span class="lineno">  170</span>&#160;         } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (msg.<a class="code" href="classXpdMsg.html#a29c82456ff1bc75ba72be288f96c7693">Type</a>() == <a class="code" href="classXrdProofdProofServMgr.html#aaebdf9da139d40cf89c6c98f38941c97a3209788aac4b903246a5ae5ec3f7e7ff">XrdProofdProofServMgr::kChgSessionSt</a>) {</div><div class="line"><a name="l00171"></a><span class="lineno">  171</span>&#160;            <span class="comment">// Propagate cluster information to active sessions after one session changed its state</span></div><div class="line"><a name="l00172"></a><span class="lineno">  172</span>&#160;            mgr-&gt;<a class="code" href="classXrdProofdProofServMgr.html#a08f16bc02f1e60847b83eddb9c012bc0">BroadcastClusterInfo</a>();</div><div class="line"><a name="l00173"></a><span class="lineno">  173</span>&#160;         } <span class="keywordflow">else</span> {</div><div class="line"><a name="l00174"></a><span class="lineno">  174</span>&#160;            <a class="code" href="TGHtml_8h.html#ad5bb4a3d12fd54f29da2b924b29e652b">TRACE</a>(XERR, <span class="stringliteral">&quot;unknown type: &quot;</span>&lt;&lt;msg.<a class="code" href="classXpdMsg.html#a29c82456ff1bc75ba72be288f96c7693">Type</a>());</div><div class="line"><a name="l00175"></a><span class="lineno">  175</span>&#160;            <span class="keywordflow">continue</span>;</div><div class="line"><a name="l00176"></a><span class="lineno">  176</span>&#160;         }</div><div class="line"><a name="l00177"></a><span class="lineno">  177</span>&#160;      } <span class="keywordflow">else</span> {</div><div class="line"><a name="l00178"></a><span class="lineno">  178</span>&#160;</div><div class="line"><a name="l00179"></a><span class="lineno">  179</span>&#160;         <span class="comment">// The current time</span></div><div class="line"><a name="l00180"></a><span class="lineno">  180</span>&#160;         <span class="keywordtype">int</span> now = time(0);</div><div class="line"><a name="l00181"></a><span class="lineno">  181</span>&#160;</div><div class="line"><a name="l00182"></a><span class="lineno">  182</span>&#160;         <span class="comment">// If there is any activity in mgr-&gt;Process() we postpone the checks in 5 secs</span></div><div class="line"><a name="l00183"></a><span class="lineno">  183</span>&#160;         <span class="keywordtype">int</span> <a class="code" href="namespacexmlio.html#a7da9572bcb8815ae48bc1845efd235b5">cnt</a> = mgr-&gt;<a class="code" href="classXrdProofdProofServMgr.html#a27dec7acd4252ca1e14bf50c654e66c2">CheckCounter</a>(<a class="code" href="classXrdProofdProofServMgr.html#a34c425cdb5ec334f7c3b7acc2fa335e5a0892adb84f4f6028803f0f2404b61eaf">XrdProofdProofServMgr::kProcessCnt</a>);</div><div class="line"><a name="l00184"></a><span class="lineno">  184</span>&#160;         <span class="keywordflow">if</span> (<a class="code" href="namespacexmlio.html#a7da9572bcb8815ae48bc1845efd235b5">cnt</a> &gt; 0) {</div><div class="line"><a name="l00185"></a><span class="lineno">  185</span>&#160;            <span class="keywordflow">if</span> ((now - lastrun) &lt; maxdelay) {</div><div class="line"><a name="l00186"></a><span class="lineno">  186</span>&#160;               <span class="comment">// The current time</span></div><div class="line"><a name="l00187"></a><span class="lineno">  187</span>&#160;               lastcheck = now + 5 - ckfreq;</div><div class="line"><a name="l00188"></a><span class="lineno">  188</span>&#160;               mgr-&gt;<a class="code" href="classXrdProofdProofServMgr.html#aa6d48bec6ed96ba43ce7702d3451997a">SetNextSessionsCheck</a>(now + 5);</div><div class="line"><a name="l00189"></a><span class="lineno">  189</span>&#160;               <span class="comment">// Notify</span></div><div class="line"><a name="l00190"></a><span class="lineno">  190</span>&#160;               <a class="code" href="TGHtml_8h.html#ad5bb4a3d12fd54f29da2b924b29e652b">TRACE</a>(ALL, <span class="stringliteral">&quot;postponing sessions check (will retry in 5 secs)&quot;</span>);</div><div class="line"><a name="l00191"></a><span class="lineno">  191</span>&#160;               <span class="keywordflow">continue</span>;</div><div class="line"><a name="l00192"></a><span class="lineno">  192</span>&#160;            } <span class="keywordflow">else</span> {</div><div class="line"><a name="l00193"></a><span class="lineno">  193</span>&#160;               <span class="comment">// Max time without checks reached: force a check</span></div><div class="line"><a name="l00194"></a><span class="lineno">  194</span>&#160;               <a class="code" href="TGHtml_8h.html#ad5bb4a3d12fd54f29da2b924b29e652b">TRACE</a>(ALL, <span class="stringliteral">&quot;Max time without checks reached (&quot;</span>&lt;&lt;maxdelay&lt;&lt;<span class="stringliteral">&quot;): force a session check&quot;</span>);</div><div class="line"><a name="l00195"></a><span class="lineno">  195</span>&#160;               <span class="comment">// Reset the counter</span></div><div class="line"><a name="l00196"></a><span class="lineno">  196</span>&#160;               mgr-&gt;<a class="code" href="classXrdProofdProofServMgr.html#a06afec54e6f910193389cde6661e6deb">UpdateCounter</a>(<a class="code" href="classXrdProofdProofServMgr.html#a34c425cdb5ec334f7c3b7acc2fa335e5a0892adb84f4f6028803f0f2404b61eaf">XrdProofdProofServMgr::kProcessCnt</a>, -<a class="code" href="namespacexmlio.html#a7da9572bcb8815ae48bc1845efd235b5">cnt</a>);</div><div class="line"><a name="l00197"></a><span class="lineno">  197</span>&#160;            }</div><div class="line"><a name="l00198"></a><span class="lineno">  198</span>&#160;         }</div><div class="line"><a name="l00199"></a><span class="lineno">  199</span>&#160;</div><div class="line"><a name="l00200"></a><span class="lineno">  200</span>&#160;         <span class="keywordtype">bool</span> full = (now &gt; mgr-&gt;<a class="code" href="classXrdProofdProofServMgr.html#a103000bfb9aff60cb72df61a1f81227e">NextSessionsCheck</a>() - deltat) ? 1 : 0;</div><div class="line"><a name="l00201"></a><span class="lineno">  201</span>&#160;         <span class="keywordflow">if</span> (full) {</div><div class="line"><a name="l00202"></a><span class="lineno">  202</span>&#160;            <span class="comment">// Run periodical full checks</span></div><div class="line"><a name="l00203"></a><span class="lineno">  203</span>&#160;            mgr-&gt;<a class="code" href="classXrdProofdProofServMgr.html#aa240763e1eeb263e403b7c5cd8aca2ae">CheckActiveSessions</a>();</div><div class="line"><a name="l00204"></a><span class="lineno">  204</span>&#160;            mgr-&gt;<a class="code" href="classXrdProofdProofServMgr.html#a1a7f51b1a820604451001cd020f12130">CheckTerminatedSessions</a>();</div><div class="line"><a name="l00205"></a><span class="lineno">  205</span>&#160;            <span class="keywordflow">if</span> (clnlostscale &lt;= 0) {</div><div class="line"><a name="l00206"></a><span class="lineno">  206</span>&#160;               mgr-&gt;<a class="code" href="classXrdProofdProofServMgr.html#a235180ac7d5ec759ee1f6c924b9b85dc">CleanupLostProofServ</a>();</div><div class="line"><a name="l00207"></a><span class="lineno">  207</span>&#160;               clnlostscale = 10;</div><div class="line"><a name="l00208"></a><span class="lineno">  208</span>&#160;            } <span class="keywordflow">else</span> {</div><div class="line"><a name="l00209"></a><span class="lineno">  209</span>&#160;               clnlostscale--;</div><div class="line"><a name="l00210"></a><span class="lineno">  210</span>&#160;            }</div><div class="line"><a name="l00211"></a><span class="lineno">  211</span>&#160;            <span class="comment">// How many active sessions do we have</span></div><div class="line"><a name="l00212"></a><span class="lineno">  212</span>&#160;            <span class="keywordtype">int</span> cursess = mgr-&gt;<a class="code" href="classXrdProofdProofServMgr.html#a112317944ba9a3b64b9f784a9ef8d6b8">CurrentSessions</a>(1);</div><div class="line"><a name="l00213"></a><span class="lineno">  213</span>&#160;            <a class="code" href="TGHtml_8h.html#ad5bb4a3d12fd54f29da2b924b29e652b">TRACE</a>(ALL, cursess &lt;&lt; <span class="stringliteral">&quot; sessions are currently active&quot;</span>);</div><div class="line"><a name="l00214"></a><span class="lineno">  214</span>&#160;            <span class="comment">// Remember when ...</span></div><div class="line"><a name="l00215"></a><span class="lineno">  215</span>&#160;            lastrun = now;</div><div class="line"><a name="l00216"></a><span class="lineno">  216</span>&#160;            lastcheck = now;</div><div class="line"><a name="l00217"></a><span class="lineno">  217</span>&#160;            mgr-&gt;<a class="code" href="classXrdProofdProofServMgr.html#aa6d48bec6ed96ba43ce7702d3451997a">SetNextSessionsCheck</a>(lastcheck + mgr-&gt;<a class="code" href="classXrdProofdProofServMgr.html#aeb9a5a16403495ef007aa9717ebaf482">CheckFrequency</a>());</div><div class="line"><a name="l00218"></a><span class="lineno">  218</span>&#160;            <span class="comment">// Notify</span></div><div class="line"><a name="l00219"></a><span class="lineno">  219</span>&#160;            <a class="code" href="TGHtml_8h.html#ad5bb4a3d12fd54f29da2b924b29e652b">TRACE</a>(ALL, <span class="stringliteral">&quot;next sessions check in &quot;</span>&lt;&lt;mgr-&gt;<a class="code" href="classXrdProofdProofServMgr.html#aeb9a5a16403495ef007aa9717ebaf482">CheckFrequency</a>()&lt;&lt;<span class="stringliteral">&quot; secs&quot;</span>);</div><div class="line"><a name="l00220"></a><span class="lineno">  220</span>&#160;         } <span class="keywordflow">else</span> {</div><div class="line"><a name="l00221"></a><span class="lineno">  221</span>&#160;            <a class="code" href="TGHtml_8h.html#ad5bb4a3d12fd54f29da2b924b29e652b">TRACE</a>(HDBG, <span class="stringliteral">&quot;nothing to do; &quot;</span>&lt;&lt;mgr-&gt;<a class="code" href="classXrdProofdProofServMgr.html#a103000bfb9aff60cb72df61a1f81227e">NextSessionsCheck</a>()-now&lt;&lt;<span class="stringliteral">&quot; secs to full check&quot;</span>);</div><div class="line"><a name="l00222"></a><span class="lineno">  222</span>&#160;         }</div><div class="line"><a name="l00223"></a><span class="lineno">  223</span>&#160;      }</div><div class="line"><a name="l00224"></a><span class="lineno">  224</span>&#160;   }</div><div class="line"><a name="l00225"></a><span class="lineno">  225</span>&#160;</div><div class="line"><a name="l00226"></a><span class="lineno">  226</span>&#160;   <span class="comment">// Should never come here</span></div><div class="line"><a name="l00227"></a><span class="lineno">  227</span>&#160;   <span class="keywordflow">return</span> (<span class="keywordtype">void</span> *)0;</div><div class="line"><a name="l00228"></a><span class="lineno">  228</span>&#160;}</div><div class="line"><a name="l00229"></a><span class="lineno">  229</span>&#160;</div><div class="line"><a name="l00230"></a><span class="lineno">  230</span>&#160;<span class="comment">//--------------------------------------------------------------------------</span></div><div class="line"><a name="l00231"></a><span class="lineno">  231</span>&#160;<span class="comment">//</span></div><div class="line"><a name="l00232"></a><span class="lineno">  232</span>&#160;<span class="comment">// XrdProofdProofServRecover</span></div><div class="line"><a name="l00233"></a><span class="lineno">  233</span>&#160;<span class="comment">//</span></div><div class="line"><a name="l00234"></a><span class="lineno">  234</span>&#160;<span class="comment">// Function run in a separate thread waiting for session to recover after</span></div><div class="line"><a name="l00235"></a><span class="lineno">  235</span>&#160;<span class="comment">// an abrupt shutdown</span></div><div class="line"><a name="l00236"></a><span class="lineno">  236</span>&#160;<span class="comment">//</span><span class="comment"></span></div><div class="line"><a name="l00237"></a><span class="lineno">  237</span>&#160;<span class="comment">////////////////////////////////////////////////////////////////////////////////</span></div><div class="line"><a name="l00238"></a><span class="lineno">  238</span>&#160;<span class="comment">/// Waiting for session to recover after an abrupt shutdown</span></div><div class="line"><a name="l00239"></a><span class="lineno">  239</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00240"></a><span class="lineno"><a class="line" href="XrdProofdProofServMgr_8cxx.html#aeb83da043d20a94faa3416a061e885b7">  240</a></span>&#160;<span class="keywordtype">void</span> *<a class="code" href="XrdProofdProofServMgr_8cxx.html#aeb83da043d20a94faa3416a061e885b7">XrdProofdProofServRecover</a>(<span class="keywordtype">void</span> *p)</div><div class="line"><a name="l00241"></a><span class="lineno">  241</span>&#160;{</div><div class="line"><a name="l00242"></a><span class="lineno">  242</span>&#160;   <a class="code" href="XrdProofdTrace_8h.html#a7c31822912a8d0dc9bfd544097b29e12">XPDLOC</a>(SMGR, <span class="stringliteral">&quot;ProofServRecover&quot;</span>)</div><div class="line"><a name="l00243"></a><span class="lineno">  243</span>&#160;</div><div class="line"><a name="l00244"></a><span class="lineno">  244</span>&#160;   <a class="code" href="structXpdManagerCron__t.html">XpdManagerCron_t</a> *mc = (<a class="code" href="structXpdManagerCron__t.html">XpdManagerCron_t</a> *)p;</div><div class="line"><a name="l00245"></a><span class="lineno">  245</span>&#160;   <a class="code" href="classXrdProofdProofServMgr.html">XrdProofdProofServMgr</a> *mgr = mc-&gt;<a class="code" href="structXpdManagerCron__t.html#a847ebc78e5dabbd2910df2994ad60c68">fSessionMgr</a>;</div><div class="line"><a name="l00246"></a><span class="lineno">  246</span>&#160;   <span class="keywordflow">if</span> (!(mgr)) {</div><div class="line"><a name="l00247"></a><span class="lineno">  247</span>&#160;      <a class="code" href="TGHtml_8h.html#ad5bb4a3d12fd54f29da2b924b29e652b">TRACE</a>(XERR,  <span class="stringliteral">&quot;undefined session manager: cannot start&quot;</span>);</div><div class="line"><a name="l00248"></a><span class="lineno">  248</span>&#160;      <span class="keywordflow">return</span> (<span class="keywordtype">void</span> *)0;</div><div class="line"><a name="l00249"></a><span class="lineno">  249</span>&#160;   }</div><div class="line"><a name="l00250"></a><span class="lineno">  250</span>&#160;</div><div class="line"><a name="l00251"></a><span class="lineno">  251</span>&#160;   <span class="comment">// Recover active sessions</span></div><div class="line"><a name="l00252"></a><span class="lineno">  252</span>&#160;   <span class="keywordtype">int</span> rc = mgr-&gt;<a class="code" href="classXrdProofdProofServMgr.html#a9ab19d67f4db0bd30bc8ac858f790951">RecoverActiveSessions</a>();</div><div class="line"><a name="l00253"></a><span class="lineno">  253</span>&#160;</div><div class="line"><a name="l00254"></a><span class="lineno">  254</span>&#160;   <span class="comment">// Notify end of recovering</span></div><div class="line"><a name="l00255"></a><span class="lineno">  255</span>&#160;   <span class="keywordflow">if</span> (rc &gt; 0) {</div><div class="line"><a name="l00256"></a><span class="lineno">  256</span>&#160;      <a class="code" href="TGHtml_8h.html#ad5bb4a3d12fd54f29da2b924b29e652b">TRACE</a>(ALL, <span class="stringliteral">&quot;timeout recovering sessions: &quot;</span>&lt;&lt;rc&lt;&lt;<span class="stringliteral">&quot; sessions not recovered&quot;</span>);</div><div class="line"><a name="l00257"></a><span class="lineno">  257</span>&#160;   } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (rc &lt; 0) {</div><div class="line"><a name="l00258"></a><span class="lineno">  258</span>&#160;      <a class="code" href="TGHtml_8h.html#ad5bb4a3d12fd54f29da2b924b29e652b">TRACE</a>(XERR, <span class="stringliteral">&quot;some problem occured while recovering sessions&quot;</span>);</div><div class="line"><a name="l00259"></a><span class="lineno">  259</span>&#160;   } <span class="keywordflow">else</span> {</div><div class="line"><a name="l00260"></a><span class="lineno">  260</span>&#160;      <a class="code" href="TGHtml_8h.html#ad5bb4a3d12fd54f29da2b924b29e652b">TRACE</a>(ALL, <span class="stringliteral">&quot;recovering successfully terminated&quot;</span>);</div><div class="line"><a name="l00261"></a><span class="lineno">  261</span>&#160;   }</div><div class="line"><a name="l00262"></a><span class="lineno">  262</span>&#160;</div><div class="line"><a name="l00263"></a><span class="lineno">  263</span>&#160;   <span class="comment">// Should never come here</span></div><div class="line"><a name="l00264"></a><span class="lineno">  264</span>&#160;   <span class="keywordflow">return</span> (<span class="keywordtype">void</span> *)0;</div><div class="line"><a name="l00265"></a><span class="lineno">  265</span>&#160;}</div><div class="line"><a name="l00266"></a><span class="lineno">  266</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00267"></a><span class="lineno">  267</span>&#160;<span class="comment">////////////////////////////////////////////////////////////////////////////////</span></div><div class="line"><a name="l00268"></a><span class="lineno">  268</span>&#160;<span class="comment">/// Constructor</span></div><div class="line"><a name="l00269"></a><span class="lineno">  269</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00270"></a><span class="lineno"><a class="line" href="classXrdProofdProofServMgr.html#a2981c286cc9af1b538b5ba3cd57574c8">  270</a></span>&#160;<a class="code" href="classXrdProofdProofServMgr.html#a2981c286cc9af1b538b5ba3cd57574c8">XrdProofdProofServMgr::XrdProofdProofServMgr</a>(<a class="code" href="classXrdProofdManager.html">XrdProofdManager</a> *mgr,</div><div class="line"><a name="l00271"></a><span class="lineno">  271</span>&#160;                                             XrdProtocol_Config *<a class="code" href="namespaceTGeant4Unit.html#a61aca601fa057e4f7601210bcc81d478">pi</a>, <a class="code" href="XpdSysError_8h.html#a3a6303e847f63204af8dd2b8953d89a1">XrdSysError</a> *<a class="code" href="TRolke_8cxx.html#a680432d265de4ea2534f8ec32f1aa417">e</a>)</div><div class="line"><a name="l00272"></a><span class="lineno">  272</span>&#160;                      : <a class="code" href="classXrdProofdConfig.html">XrdProofdConfig</a>(<a class="code" href="namespaceTGeant4Unit.html#a61aca601fa057e4f7601210bcc81d478">pi</a>-&gt;ConfigFN, <a class="code" href="TRolke_8cxx.html#a680432d265de4ea2534f8ec32f1aa417">e</a>), fProcessSem(0)</div><div class="line"><a name="l00273"></a><span class="lineno">  273</span>&#160;{</div><div class="line"><a name="l00274"></a><span class="lineno">  274</span>&#160;   <a class="code" href="XrdProofdTrace_8h.html#a7c31822912a8d0dc9bfd544097b29e12">XPDLOC</a>(SMGR, <span class="stringliteral">&quot;XrdProofdProofServMgr&quot;</span>)</div><div class="line"><a name="l00275"></a><span class="lineno">  275</span>&#160;</div><div class="line"><a name="l00276"></a><span class="lineno">  276</span>&#160;   <a class="code" href="classXrdProofdProofServMgr.html#a86cac591a5646811e38ff6a2477f4da7">fMgr</a> = mgr;</div><div class="line"><a name="l00277"></a><span class="lineno">  277</span>&#160;   <a class="code" href="classXrdProofdProofServMgr.html#a286409daa6699f599723fc5046c71c76">fLogger</a> = <a class="code" href="namespaceTGeant4Unit.html#a61aca601fa057e4f7601210bcc81d478">pi</a>-&gt;eDest-&gt;logger();</div><div class="line"><a name="l00278"></a><span class="lineno">  278</span>&#160;   <a class="code" href="classXrdProofdProofServMgr.html#a3d7506e0fff1042ca99d77c2ad432f19">fInternalWait</a> = 10;</div><div class="line"><a name="l00279"></a><span class="lineno">  279</span>&#160;   <a class="code" href="classXrdProofdProofServMgr.html#a909fb1d3452ad38d9cc83782f777d07c">fActiveSessions</a>.clear();</div><div class="line"><a name="l00280"></a><span class="lineno">  280</span>&#160;   <a class="code" href="classXrdProofdProofServMgr.html#aa10fdb50ded6eb18fbe118b0f8407027">fShutdownOpt</a> = 1;</div><div class="line"><a name="l00281"></a><span class="lineno">  281</span>&#160;   <a class="code" href="classXrdProofdProofServMgr.html#a4d745a9880deae66b89a3536e3d21cf0">fShutdownDelay</a> = 0;</div><div class="line"><a name="l00282"></a><span class="lineno">  282</span>&#160;   <a class="code" href="classXrdProofdProofServMgr.html#ad9f61f67fd36511fe72bea2334260176">fReconnectTime</a> = -1;</div><div class="line"><a name="l00283"></a><span class="lineno">  283</span>&#160;   <a class="code" href="classXrdProofdProofServMgr.html#a6dea65be9cfafa463f8d8200e3d02ecc">fReconnectTimeOut</a> = 300;</div><div class="line"><a name="l00284"></a><span class="lineno">  284</span>&#160;   <a class="code" href="classXrdProofdProofServMgr.html#a9e0751cbf6fbab427038ebfe478f5afe">fNextSessionsCheck</a> = -1;</div><div class="line"><a name="l00285"></a><span class="lineno">  285</span>&#160;   <span class="comment">// Init internal counters</span></div><div class="line"><a name="l00286"></a><span class="lineno">  286</span>&#160;   <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; <a class="code" href="XrdProofdProofServMgr_8h.html#a4640192217d85ff3c4111f2498dd6329">PSMMAXCNTS</a>; i++) {</div><div class="line"><a name="l00287"></a><span class="lineno">  287</span>&#160;      <a class="code" href="classXrdProofdProofServMgr.html#a166d3cc8d5d88c9bf2ac9a8a9d1f8d5e">fCounters</a>[i] = 0;</div><div class="line"><a name="l00288"></a><span class="lineno">  288</span>&#160;   }</div><div class="line"><a name="l00289"></a><span class="lineno">  289</span>&#160;   <a class="code" href="classXrdProofdProofServMgr.html#afddc4c3251e7293b77ca5f8b4dbe0595">fCurrentSessions</a> = 0;</div><div class="line"><a name="l00290"></a><span class="lineno">  290</span>&#160;</div><div class="line"><a name="l00291"></a><span class="lineno">  291</span>&#160;   <a class="code" href="classXrdProofdProofServMgr.html#ab5ef76ea6d32a74b258884914c8fa0a5">fSeqSessionN</a> = 0;</div><div class="line"><a name="l00292"></a><span class="lineno">  292</span>&#160;</div><div class="line"><a name="l00293"></a><span class="lineno">  293</span>&#160;   <a class="code" href="classXrdProofdProofServMgr.html#a7cb3d5c0d8bcb814202a15e354a5d92b">fCredsSaver</a> = 0;</div><div class="line"><a name="l00294"></a><span class="lineno">  294</span>&#160;</div><div class="line"><a name="l00295"></a><span class="lineno">  295</span>&#160;   <span class="comment">// Defaults can be changed via &#39;proofservmgr&#39;</span></div><div class="line"><a name="l00296"></a><span class="lineno">  296</span>&#160;   <a class="code" href="classXrdProofdProofServMgr.html#a17dc7a6fb286b3bdaf1c7739ea68f7c1">fCheckFrequency</a> = 30;</div><div class="line"><a name="l00297"></a><span class="lineno">  297</span>&#160;   <a class="code" href="classXrdProofdProofServMgr.html#a1c418ea2fa6ac9a8e6990506de51a5d6">fTerminationTimeOut</a> = <a class="code" href="classXrdProofdProofServMgr.html#a17dc7a6fb286b3bdaf1c7739ea68f7c1">fCheckFrequency</a> - 10;</div><div class="line"><a name="l00298"></a><span class="lineno">  298</span>&#160;   <a class="code" href="classXrdProofdProofServMgr.html#a1a5fce183660e6508e874505445d88dd">fVerifyTimeOut</a> = 3 * <a class="code" href="classXrdProofdProofServMgr.html#a17dc7a6fb286b3bdaf1c7739ea68f7c1">fCheckFrequency</a>;</div><div class="line"><a name="l00299"></a><span class="lineno">  299</span>&#160;   <a class="code" href="classXrdProofdProofServMgr.html#aa150146266359bec018e9b443e49818d">fRecoverTimeOut</a> = 10;</div><div class="line"><a name="l00300"></a><span class="lineno">  300</span>&#160;   <a class="code" href="classXrdProofdProofServMgr.html#a001151ea555c7e0d21298d831452665f">fCheckLost</a> = 1;</div><div class="line"><a name="l00301"></a><span class="lineno">  301</span>&#160;   <a class="code" href="classXrdProofdProofServMgr.html#a4d0997e0348d21914091e8bd3d844751">fUseFork</a> = 1;</div><div class="line"><a name="l00302"></a><span class="lineno">  302</span>&#160;   <a class="code" href="classXrdProofdProofServMgr.html#a0dab770ad59dea7bbfceb63d345af63b">fParentExecs</a> = <span class="stringliteral">&quot;xproofd,xrootd&quot;</span>;</div><div class="line"><a name="l00303"></a><span class="lineno">  303</span>&#160;</div><div class="line"><a name="l00304"></a><span class="lineno">  304</span>&#160;   <span class="comment">// Recover-related quantities</span></div><div class="line"><a name="l00305"></a><span class="lineno">  305</span>&#160;   <a class="code" href="classXrdProofdProofServMgr.html#ab1e3069da69611967716f0cecd93dedc">fRecoverClients</a> = 0;</div><div class="line"><a name="l00306"></a><span class="lineno">  306</span>&#160;   <a class="code" href="classXrdProofdProofServMgr.html#a2312694173da8ebbefabb702a4dd089b">fRecoverDeadline</a> = -1;</div><div class="line"><a name="l00307"></a><span class="lineno">  307</span>&#160;</div><div class="line"><a name="l00308"></a><span class="lineno">  308</span>&#160;   <span class="comment">// Init pipe for the poller</span></div><div class="line"><a name="l00309"></a><span class="lineno">  309</span>&#160;   <span class="keywordflow">if</span> (!<a class="code" href="classXrdProofdProofServMgr.html#a501f91690e366de7dd5c8a859a92242a">fPipe</a>.<a class="code" href="classXrdProofdPipe.html#a28d8bcdda93fc3c8beb4eb4ee22f5aa0">IsValid</a>()) {</div><div class="line"><a name="l00310"></a><span class="lineno">  310</span>&#160;      <a class="code" href="TGHtml_8h.html#ad5bb4a3d12fd54f29da2b924b29e652b">TRACE</a>(XERR, <span class="stringliteral">&quot;unable to generate pipe for the session poller&quot;</span>);</div><div class="line"><a name="l00311"></a><span class="lineno">  311</span>&#160;      <span class="keywordflow">return</span>;</div><div class="line"><a name="l00312"></a><span class="lineno">  312</span>&#160;   }</div><div class="line"><a name="l00313"></a><span class="lineno">  313</span>&#160;</div><div class="line"><a name="l00314"></a><span class="lineno">  314</span>&#160;   <span class="comment">// Configuration directives</span></div><div class="line"><a name="l00315"></a><span class="lineno">  315</span>&#160;   <a class="code" href="classXrdProofdProofServMgr.html#ab518387c7aac71be2a03214b83f10e71">RegisterDirectives</a>();</div><div class="line"><a name="l00316"></a><span class="lineno">  316</span>&#160;}</div><div class="line"><a name="l00317"></a><span class="lineno">  317</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00318"></a><span class="lineno">  318</span>&#160;<span class="comment">////////////////////////////////////////////////////////////////////////////////</span></div><div class="line"><a name="l00319"></a><span class="lineno">  319</span>&#160;<span class="comment">/// Run configuration and parse the entered config directives.</span></div><div class="line"><a name="l00320"></a><span class="lineno">  320</span>&#160;<span class="comment">/// Return 0 on success, -1 on error</span></div><div class="line"><a name="l00321"></a><span class="lineno">  321</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00322"></a><span class="lineno"><a class="line" href="classXrdProofdProofServMgr.html#addb2f49af9028ad498e4f0711eb47b33">  322</a></span>&#160;<span class="keywordtype">int</span> <a class="code" href="classXrdProofdProofServMgr.html#addb2f49af9028ad498e4f0711eb47b33">XrdProofdProofServMgr::Config</a>(<span class="keywordtype">bool</span> rcf)</div><div class="line"><a name="l00323"></a><span class="lineno">  323</span>&#160;{</div><div class="line"><a name="l00324"></a><span class="lineno">  324</span>&#160;   <a class="code" href="XrdProofdTrace_8h.html#a7c31822912a8d0dc9bfd544097b29e12">XPDLOC</a>(SMGR, <span class="stringliteral">&quot;ProofServMgr::Config&quot;</span>)</div><div class="line"><a name="l00325"></a><span class="lineno">  325</span>&#160;</div><div class="line"><a name="l00326"></a><span class="lineno">  326</span>&#160;   <a class="code" href="XrdSysToOuc_8h.html#a4ba18bedbb8a1a4367d57f49a4d773ce">XrdSysMutexHelper</a> mhp(<a class="code" href="classXrdProofdProofServMgr.html#af244f1c4fd9592313e3cfc4bdeb64aaf">fEnvsMutex</a>);</div><div class="line"><a name="l00327"></a><span class="lineno">  327</span>&#160;</div><div class="line"><a name="l00328"></a><span class="lineno">  328</span>&#160;   <span class="keywordtype">bool</span> notify = (rcf) ? 0 : 1;</div><div class="line"><a name="l00329"></a><span class="lineno">  329</span>&#160;   <span class="keywordflow">if</span> (rcf &amp;&amp; <a class="code" href="classXrdProofdConfig.html#a2096e21b5241fa5b04e82d3cbbec60e9">ReadFile</a>(0)) {</div><div class="line"><a name="l00330"></a><span class="lineno">  330</span>&#160;      <span class="comment">// Cleanup lists of envs and RCs</span></div><div class="line"><a name="l00331"></a><span class="lineno">  331</span>&#160;      <a class="code" href="classXrdProofdProofServMgr.html#acaa26797a7f4b194dd8f3f5d39be11af">fProofServRCs</a>.clear();</div><div class="line"><a name="l00332"></a><span class="lineno">  332</span>&#160;      <a class="code" href="classXrdProofdProofServMgr.html#af99918358c943b44bb636cf70b97671e">fProofServEnvs</a>.clear();</div><div class="line"><a name="l00333"></a><span class="lineno">  333</span>&#160;      <span class="comment">// Notify possible new settings</span></div><div class="line"><a name="l00334"></a><span class="lineno">  334</span>&#160;      notify = 1;</div><div class="line"><a name="l00335"></a><span class="lineno">  335</span>&#160;   }</div><div class="line"><a name="l00336"></a><span class="lineno">  336</span>&#160;</div><div class="line"><a name="l00337"></a><span class="lineno">  337</span>&#160;   <span class="comment">// Run first the configurator</span></div><div class="line"><a name="l00338"></a><span class="lineno">  338</span>&#160;   <span class="keywordflow">if</span> (<a class="code" href="classXrdProofdConfig.html#a3c6ee459c7e1ee7042f72139ce32a3dc">XrdProofdConfig::Config</a>(rcf) != 0) {</div><div class="line"><a name="l00339"></a><span class="lineno">  339</span>&#160;      <a class="code" href="TGHtml_8h.html#ad5bb4a3d12fd54f29da2b924b29e652b">TRACE</a>(XERR, <span class="stringliteral">&quot;problems parsing file &quot;</span>);</div><div class="line"><a name="l00340"></a><span class="lineno">  340</span>&#160;      <span class="keywordflow">return</span> -1;</div><div class="line"><a name="l00341"></a><span class="lineno">  341</span>&#160;   }</div><div class="line"><a name="l00342"></a><span class="lineno">  342</span>&#160;</div><div class="line"><a name="l00343"></a><span class="lineno">  343</span>&#160;   XrdOucString msg;</div><div class="line"><a name="l00344"></a><span class="lineno">  344</span>&#160;   msg = (rcf) ? <span class="stringliteral">&quot;re-configuring&quot;</span> : <span class="stringliteral">&quot;configuring&quot;</span>;</div><div class="line"><a name="l00345"></a><span class="lineno">  345</span>&#160;   <span class="keywordflow">if</span> (notify) <a class="code" href="XrdProofdTrace_8h.html#a16e6f602476f24a2b61f420a39b38527">XPDPRT</a>(msg);</div><div class="line"><a name="l00346"></a><span class="lineno">  346</span>&#160;</div><div class="line"><a name="l00347"></a><span class="lineno">  347</span>&#160;   <span class="comment">// Notify timeout on internal communications</span></div><div class="line"><a name="l00348"></a><span class="lineno">  348</span>&#160;   <a class="code" href="XrdProofdAux_8h.html#a631cc8787af1a02d9e51c86117ae042e">XPDFORM</a>(msg, <span class="stringliteral">&quot;setting internal timeout to %d secs&quot;</span>, <a class="code" href="classXrdProofdProofServMgr.html#a3d7506e0fff1042ca99d77c2ad432f19">fInternalWait</a>);</div><div class="line"><a name="l00349"></a><span class="lineno">  349</span>&#160;   <span class="keywordflow">if</span> (notify) <a class="code" href="XrdProofdTrace_8h.html#a16e6f602476f24a2b61f420a39b38527">XPDPRT</a>(msg);</div><div class="line"><a name="l00350"></a><span class="lineno">  350</span>&#160;</div><div class="line"><a name="l00351"></a><span class="lineno">  351</span>&#160;   <span class="comment">// Shutdown options</span></div><div class="line"><a name="l00352"></a><span class="lineno">  352</span>&#160;   msg = <span class="stringliteral">&quot;client sessions shutdown after disconnection&quot;</span>;</div><div class="line"><a name="l00353"></a><span class="lineno">  353</span>&#160;   <span class="keywordflow">if</span> (<a class="code" href="classXrdProofdProofServMgr.html#aa10fdb50ded6eb18fbe118b0f8407027">fShutdownOpt</a> &gt; 0) {</div><div class="line"><a name="l00354"></a><span class="lineno">  354</span>&#160;      <a class="code" href="XrdProofdAux_8h.html#a631cc8787af1a02d9e51c86117ae042e">XPDFORM</a>(msg, <span class="stringliteral">&quot;client sessions kept %sfor %d secs after disconnection&quot;</span>,</div><div class="line"><a name="l00355"></a><span class="lineno">  355</span>&#160;                   (<a class="code" href="classXrdProofdProofServMgr.html#aa10fdb50ded6eb18fbe118b0f8407027">fShutdownOpt</a> == 1) ? <span class="stringliteral">&quot;idle &quot;</span> : <span class="stringliteral">&quot;&quot;</span>, <a class="code" href="classXrdProofdProofServMgr.html#a4d745a9880deae66b89a3536e3d21cf0">fShutdownDelay</a>);</div><div class="line"><a name="l00356"></a><span class="lineno">  356</span>&#160;   }</div><div class="line"><a name="l00357"></a><span class="lineno">  357</span>&#160;   <span class="keywordflow">if</span> (notify) <a class="code" href="XrdProofdTrace_8h.html#a16e6f602476f24a2b61f420a39b38527">XPDPRT</a>(msg);</div><div class="line"><a name="l00358"></a><span class="lineno">  358</span>&#160;</div><div class="line"><a name="l00359"></a><span class="lineno">  359</span>&#160;   <span class="keywordflow">if</span> (!rcf) {</div><div class="line"><a name="l00360"></a><span class="lineno">  360</span>&#160;      <span class="comment">// Admin paths</span></div><div class="line"><a name="l00361"></a><span class="lineno">  361</span>&#160;      <a class="code" href="classXrdProofdProofServMgr.html#aa7d4e4ec33be14cd70bbc3595332736e">fActiAdminPath</a> = <a class="code" href="classXrdProofdProofServMgr.html#a86cac591a5646811e38ff6a2477f4da7">fMgr</a>-&gt;<a class="code" href="classXrdProofdManager.html#a69bde6786ea2b81c63d7777a47f7ba5d">AdminPath</a>();</div><div class="line"><a name="l00362"></a><span class="lineno">  362</span>&#160;      <a class="code" href="classXrdProofdProofServMgr.html#aa7d4e4ec33be14cd70bbc3595332736e">fActiAdminPath</a> += <span class="stringliteral">&quot;/activesessions&quot;</span>;</div><div class="line"><a name="l00363"></a><span class="lineno">  363</span>&#160;      <a class="code" href="classXrdProofdProofServMgr.html#a6d168474303d8b503001502f4f5ad306">fTermAdminPath</a> = <a class="code" href="classXrdProofdProofServMgr.html#a86cac591a5646811e38ff6a2477f4da7">fMgr</a>-&gt;<a class="code" href="classXrdProofdManager.html#a69bde6786ea2b81c63d7777a47f7ba5d">AdminPath</a>();</div><div class="line"><a name="l00364"></a><span class="lineno">  364</span>&#160;      <a class="code" href="classXrdProofdProofServMgr.html#a6d168474303d8b503001502f4f5ad306">fTermAdminPath</a> += <span class="stringliteral">&quot;/terminatedsessions&quot;</span>;</div><div class="line"><a name="l00365"></a><span class="lineno">  365</span>&#160;</div><div class="line"><a name="l00366"></a><span class="lineno">  366</span>&#160;      <span class="comment">// Make sure they exist</span></div><div class="line"><a name="l00367"></a><span class="lineno">  367</span>&#160;      <a class="code" href="classXrdProofUI.html">XrdProofUI</a> ui;</div><div class="line"><a name="l00368"></a><span class="lineno">  368</span>&#160;      <a class="code" href="classXrdProofdAux.html#a0230423581c62e4fabf4fda6538fd4a7">XrdProofdAux::GetUserInfo</a>(<a class="code" href="classXrdProofdProofServMgr.html#a86cac591a5646811e38ff6a2477f4da7">fMgr</a>-&gt;<a class="code" href="classXrdProofdManager.html#a0f1457620cc4e2de56258bf553843634">EffectiveUser</a>(), ui);</div><div class="line"><a name="l00369"></a><span class="lineno">  369</span>&#160;      <span class="keywordflow">if</span> (<a class="code" href="classXrdProofdAux.html#a3918ddc5c3912b017a3f7695ba5f3a40">XrdProofdAux::AssertDir</a>(<a class="code" href="classXrdProofdProofServMgr.html#aa7d4e4ec33be14cd70bbc3595332736e">fActiAdminPath</a>.c_str(), ui, 1) != 0) {</div><div class="line"><a name="l00370"></a><span class="lineno">  370</span>&#160;         <a class="code" href="TGHtml_8h.html#ad5bb4a3d12fd54f29da2b924b29e652b">TRACE</a>(XERR, <span class="stringliteral">&quot;unable to assert the admin path: &quot;</span>&lt;&lt;<a class="code" href="classXrdProofdProofServMgr.html#aa7d4e4ec33be14cd70bbc3595332736e">fActiAdminPath</a>);</div><div class="line"><a name="l00371"></a><span class="lineno">  371</span>&#160;         <a class="code" href="classXrdProofdProofServMgr.html#aa7d4e4ec33be14cd70bbc3595332736e">fActiAdminPath</a> = <span class="stringliteral">&quot;&quot;</span>;</div><div class="line"><a name="l00372"></a><span class="lineno">  372</span>&#160;         <span class="keywordflow">return</span> -1;</div><div class="line"><a name="l00373"></a><span class="lineno">  373</span>&#160;      }</div><div class="line"><a name="l00374"></a><span class="lineno">  374</span>&#160;      <a class="code" href="XrdProofdTrace_8h.html#a16e6f602476f24a2b61f420a39b38527">XPDPRT</a>(<span class="stringliteral">&quot;active sessions admin path set to: &quot;</span>&lt;&lt;<a class="code" href="classXrdProofdProofServMgr.html#aa7d4e4ec33be14cd70bbc3595332736e">fActiAdminPath</a>);</div><div class="line"><a name="l00375"></a><span class="lineno">  375</span>&#160;</div><div class="line"><a name="l00376"></a><span class="lineno">  376</span>&#160;      <span class="keywordflow">if</span> (<a class="code" href="classXrdProofdAux.html#a3918ddc5c3912b017a3f7695ba5f3a40">XrdProofdAux::AssertDir</a>(<a class="code" href="classXrdProofdProofServMgr.html#a6d168474303d8b503001502f4f5ad306">fTermAdminPath</a>.c_str(), ui, 1) != 0) {</div><div class="line"><a name="l00377"></a><span class="lineno">  377</span>&#160;         <a class="code" href="TGHtml_8h.html#ad5bb4a3d12fd54f29da2b924b29e652b">TRACE</a>(XERR, <span class="stringliteral">&quot;unable to assert the admin path &quot;</span>&lt;&lt;<a class="code" href="classXrdProofdProofServMgr.html#a6d168474303d8b503001502f4f5ad306">fTermAdminPath</a>);</div><div class="line"><a name="l00378"></a><span class="lineno">  378</span>&#160;         <a class="code" href="classXrdProofdProofServMgr.html#a6d168474303d8b503001502f4f5ad306">fTermAdminPath</a> = <span class="stringliteral">&quot;&quot;</span>;</div><div class="line"><a name="l00379"></a><span class="lineno">  379</span>&#160;         <span class="keywordflow">return</span> -1;</div><div class="line"><a name="l00380"></a><span class="lineno">  380</span>&#160;      }</div><div class="line"><a name="l00381"></a><span class="lineno">  381</span>&#160;      <a class="code" href="XrdProofdTrace_8h.html#a16e6f602476f24a2b61f420a39b38527">XPDPRT</a>(<span class="stringliteral">&quot;terminated sessions admin path set to &quot;</span>&lt;&lt;<a class="code" href="classXrdProofdProofServMgr.html#a6d168474303d8b503001502f4f5ad306">fTermAdminPath</a>);</div><div class="line"><a name="l00382"></a><span class="lineno">  382</span>&#160;   }</div><div class="line"><a name="l00383"></a><span class="lineno">  383</span>&#160;</div><div class="line"><a name="l00384"></a><span class="lineno">  384</span>&#160;   <span class="keywordflow">if</span> (notify) {</div><div class="line"><a name="l00385"></a><span class="lineno">  385</span>&#160;      <a class="code" href="XrdProofdTrace_8h.html#a16e6f602476f24a2b61f420a39b38527">XPDPRT</a>(<span class="stringliteral">&quot;RC settings: &quot;</span>&lt;&lt; <a class="code" href="classXrdProofdProofServMgr.html#acaa26797a7f4b194dd8f3f5d39be11af">fProofServRCs</a>.size());</div><div class="line"><a name="l00386"></a><span class="lineno">  386</span>&#160;      <span class="keywordflow">if</span> (<a class="code" href="classXrdProofdProofServMgr.html#acaa26797a7f4b194dd8f3f5d39be11af">fProofServRCs</a>.size() &gt; 0) {</div><div class="line"><a name="l00387"></a><span class="lineno">  387</span>&#160;         std::list&lt;XpdEnv&gt;::iterator ircs = <a class="code" href="classXrdProofdProofServMgr.html#acaa26797a7f4b194dd8f3f5d39be11af">fProofServRCs</a>.begin();</div><div class="line"><a name="l00388"></a><span class="lineno">  388</span>&#160;         <span class="keywordflow">for</span> ( ; ircs != <a class="code" href="classXrdProofdProofServMgr.html#acaa26797a7f4b194dd8f3f5d39be11af">fProofServRCs</a>.end(); ++ircs) { (*ircs).Print(<span class="stringliteral">&quot;rc&quot;</span>); }</div><div class="line"><a name="l00389"></a><span class="lineno">  389</span>&#160;      }</div><div class="line"><a name="l00390"></a><span class="lineno">  390</span>&#160;      <a class="code" href="XrdProofdTrace_8h.html#a16e6f602476f24a2b61f420a39b38527">XPDPRT</a>(<span class="stringliteral">&quot;ENV settings: &quot;</span>&lt;&lt; <a class="code" href="classXrdProofdProofServMgr.html#af99918358c943b44bb636cf70b97671e">fProofServEnvs</a>.size());</div><div class="line"><a name="l00391"></a><span class="lineno">  391</span>&#160;      <span class="keywordflow">if</span> (<a class="code" href="classXrdProofdProofServMgr.html#af99918358c943b44bb636cf70b97671e">fProofServEnvs</a>.size() &gt; 0) {</div><div class="line"><a name="l00392"></a><span class="lineno">  392</span>&#160;         std::list&lt;XpdEnv&gt;::iterator ienvs = <a class="code" href="classXrdProofdProofServMgr.html#af99918358c943b44bb636cf70b97671e">fProofServEnvs</a>.begin();</div><div class="line"><a name="l00393"></a><span class="lineno">  393</span>&#160;         <span class="keywordflow">for</span> ( ; ienvs != <a class="code" href="classXrdProofdProofServMgr.html#af99918358c943b44bb636cf70b97671e">fProofServEnvs</a>.end(); ++ienvs) { (*ienvs).Print(<span class="stringliteral">&quot;env&quot;</span>); }</div><div class="line"><a name="l00394"></a><span class="lineno">  394</span>&#160;      }</div><div class="line"><a name="l00395"></a><span class="lineno">  395</span>&#160;   }</div><div class="line"><a name="l00396"></a><span class="lineno">  396</span>&#160;</div><div class="line"><a name="l00397"></a><span class="lineno">  397</span>&#160;   <span class="comment">// Notify sessions startup technology</span></div><div class="line"><a name="l00398"></a><span class="lineno">  398</span>&#160;   <a class="code" href="XrdProofdAux_8h.html#a631cc8787af1a02d9e51c86117ae042e">XPDFORM</a>(msg, <span class="stringliteral">&quot;using %s to start proofserv sessions&quot;</span>, <a class="code" href="classXrdProofdProofServMgr.html#a4d0997e0348d21914091e8bd3d844751">fUseFork</a> ? <span class="stringliteral">&quot;fork()&quot;</span> : <span class="stringliteral">&quot;system()&quot;</span>);</div><div class="line"><a name="l00399"></a><span class="lineno">  399</span>&#160;   <span class="keywordflow">if</span> (notify) <a class="code" href="XrdProofdTrace_8h.html#a16e6f602476f24a2b61f420a39b38527">XPDPRT</a>(msg);</div><div class="line"><a name="l00400"></a><span class="lineno">  400</span>&#160;</div><div class="line"><a name="l00401"></a><span class="lineno">  401</span>&#160;   <span class="keywordflow">if</span> (!rcf) {</div><div class="line"><a name="l00402"></a><span class="lineno">  402</span>&#160;      <span class="comment">// Try to recover active session previously started</span></div><div class="line"><a name="l00403"></a><span class="lineno">  403</span>&#160;      <span class="keywordtype">int</span> nr = -1;</div><div class="line"><a name="l00404"></a><span class="lineno">  404</span>&#160;      <span class="keywordflow">if</span> ((nr = <a class="code" href="classXrdProofdProofServMgr.html#a226eefc373fb6d7d68f65649032f1009">PrepareSessionRecovering</a>()) &lt; 0) {</div><div class="line"><a name="l00405"></a><span class="lineno">  405</span>&#160;         <a class="code" href="TGHtml_8h.html#ad5bb4a3d12fd54f29da2b924b29e652b">TRACE</a>(XERR, <span class="stringliteral">&quot;problems trying to recover active sessions&quot;</span>);</div><div class="line"><a name="l00406"></a><span class="lineno">  406</span>&#160;      } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (nr &gt; 0) {</div><div class="line"><a name="l00407"></a><span class="lineno">  407</span>&#160;         <a class="code" href="XrdProofdAux_8h.html#a631cc8787af1a02d9e51c86117ae042e">XPDFORM</a>(msg, <span class="stringliteral">&quot;%d active sessions have been recovered&quot;</span>, nr);</div><div class="line"><a name="l00408"></a><span class="lineno">  408</span>&#160;         <a class="code" href="XrdProofdTrace_8h.html#a16e6f602476f24a2b61f420a39b38527">XPDPRT</a>(msg);</div><div class="line"><a name="l00409"></a><span class="lineno">  409</span>&#160;      }</div><div class="line"><a name="l00410"></a><span class="lineno">  410</span>&#160;</div><div class="line"><a name="l00411"></a><span class="lineno">  411</span>&#160;      <span class="comment">// Start cron thread</span></div><div class="line"><a name="l00412"></a><span class="lineno">  412</span>&#160;      pthread_t tid;</div><div class="line"><a name="l00413"></a><span class="lineno">  413</span>&#160;      <span class="comment">// Fill manager pointers structure</span></div><div class="line"><a name="l00414"></a><span class="lineno">  414</span>&#160;      <a class="code" href="XrdProofdProofServMgr_8cxx.html#ae6f1dbe8fdbfff0847439c11076a4ac2">fManagerCron</a>.<a class="code" href="structXpdManagerCron__t.html#ab30050b19479fd7e6e6cbeffc5030a6c">fClientMgr</a> = <a class="code" href="classXrdProofdProofServMgr.html#a86cac591a5646811e38ff6a2477f4da7">fMgr</a>-&gt;<a class="code" href="classXrdProofdManager.html#ac1aeacfd6edb71f9bc4ebe8e472d006b">ClientMgr</a>();</div><div class="line"><a name="l00415"></a><span class="lineno">  415</span>&#160;      <a class="code" href="XrdProofdProofServMgr_8cxx.html#ae6f1dbe8fdbfff0847439c11076a4ac2">fManagerCron</a>.<a class="code" href="structXpdManagerCron__t.html#a847ebc78e5dabbd2910df2994ad60c68">fSessionMgr</a> = <span class="keyword">this</span>;</div><div class="line"><a name="l00416"></a><span class="lineno">  416</span>&#160;      <span class="keywordflow">if</span> (XrdSysThread::Run(&amp;tid, <a class="code" href="XrdProofdProofServMgr_8cxx.html#acb7a7a3f2f44854897676341935e1161">XrdProofdProofServCron</a>,</div><div class="line"><a name="l00417"></a><span class="lineno">  417</span>&#160;                            (<span class="keywordtype">void</span> *)&amp;<a class="code" href="XrdProofdProofServMgr_8cxx.html#ae6f1dbe8fdbfff0847439c11076a4ac2">fManagerCron</a>, 0, <span class="stringliteral">&quot;ProofServMgr cron thread&quot;</span>) != 0) {</div><div class="line"><a name="l00418"></a><span class="lineno">  418</span>&#160;         <a class="code" href="TGHtml_8h.html#ad5bb4a3d12fd54f29da2b924b29e652b">TRACE</a>(XERR, <span class="stringliteral">&quot;could not start cron thread&quot;</span>);</div><div class="line"><a name="l00419"></a><span class="lineno">  419</span>&#160;         <span class="keywordflow">return</span> 0;</div><div class="line"><a name="l00420"></a><span class="lineno">  420</span>&#160;      }</div><div class="line"><a name="l00421"></a><span class="lineno">  421</span>&#160;      <a class="code" href="XrdProofdTrace_8h.html#a16e6f602476f24a2b61f420a39b38527">XPDPRT</a>(<span class="stringliteral">&quot;cron thread started&quot;</span>);</div><div class="line"><a name="l00422"></a><span class="lineno">  422</span>&#160;   }</div><div class="line"><a name="l00423"></a><span class="lineno">  423</span>&#160;</div><div class="line"><a name="l00424"></a><span class="lineno">  424</span>&#160;   <span class="comment">// Done</span></div><div class="line"><a name="l00425"></a><span class="lineno">  425</span>&#160;   <span class="keywordflow">return</span> 0;</div><div class="line"><a name="l00426"></a><span class="lineno">  426</span>&#160;}</div><div class="line"><a name="l00427"></a><span class="lineno">  427</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00428"></a><span class="lineno">  428</span>&#160;<span class="comment">////////////////////////////////////////////////////////////////////////////////</span></div><div class="line"><a name="l00429"></a><span class="lineno">  429</span>&#160;<span class="comment">/// Add new active session</span></div><div class="line"><a name="l00430"></a><span class="lineno">  430</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00431"></a><span class="lineno"><a class="line" href="classXrdProofdProofServMgr.html#a9eb9a2df9609e14f677437aa115718a3">  431</a></span>&#160;<span class="keywordtype">int</span> <a class="code" href="classXrdProofdProofServMgr.html#a9eb9a2df9609e14f677437aa115718a3">XrdProofdProofServMgr::AddSession</a>(<a class="code" href="classXrdProofdProtocol.html">XrdProofdProtocol</a> *p, <a class="code" href="classXrdProofdProofServ.html">XrdProofdProofServ</a> *<a class="code" href="namespaceTGeant4Unit.html#a5d450e80998065902b102dca2a69066a">s</a>)</div><div class="line"><a name="l00432"></a><span class="lineno">  432</span>&#160;{</div><div class="line"><a name="l00433"></a><span class="lineno">  433</span>&#160;   <a class="code" href="XrdProofdTrace_8h.html#a7c31822912a8d0dc9bfd544097b29e12">XPDLOC</a>(SMGR, <span class="stringliteral">&quot;ProofServMgr::AddSession&quot;</span>)</div><div class="line"><a name="l00434"></a><span class="lineno">  434</span>&#160;</div><div class="line"><a name="l00435"></a><span class="lineno">  435</span>&#160;   <a class="code" href="TGHtml_8h.html#ad5bb4a3d12fd54f29da2b924b29e652b">TRACE</a>(REQ, <span class="stringliteral">&quot;adding new active session ...&quot;</span>);</div><div class="line"><a name="l00436"></a><span class="lineno">  436</span>&#160;</div><div class="line"><a name="l00437"></a><span class="lineno">  437</span>&#160;   <span class="comment">// Check inputs</span></div><div class="line"><a name="l00438"></a><span class="lineno">  438</span>&#160;   <span class="keywordflow">if</span> (!<a class="code" href="namespaceTGeant4Unit.html#a5d450e80998065902b102dca2a69066a">s</a> || !p-&gt;<a class="code" href="classXrdProofdProtocol.html#a80024c8f848d0eabe9f13d09f06c8d9d">Client</a>()) {</div><div class="line"><a name="l00439"></a><span class="lineno">  439</span>&#160;      <a class="code" href="TGHtml_8h.html#ad5bb4a3d12fd54f29da2b924b29e652b">TRACE</a>(XERR,<span class="stringliteral">&quot;invalid inputs: &quot;</span>&lt;&lt;(<a class="code" href="namespaceTGeant4Unit.html#a5d450e80998065902b102dca2a69066a">s</a> ? <span class="stringliteral">&quot;&quot;</span> : <span class="stringliteral">&quot;s, &quot;</span>) &lt;&lt;<span class="stringliteral">&quot;, &quot;</span>&lt;&lt; (p-&gt;<a class="code" href="classXrdProofdProtocol.html#a80024c8f848d0eabe9f13d09f06c8d9d">Client</a>() ? <span class="stringliteral">&quot;&quot;</span> : <span class="stringliteral">&quot;p-&gt;Client()&quot;</span>));</div><div class="line"><a name="l00440"></a><span class="lineno">  440</span>&#160;      <span class="keywordflow">return</span> -1;</div><div class="line"><a name="l00441"></a><span class="lineno">  441</span>&#160;   }</div><div class="line"><a name="l00442"></a><span class="lineno">  442</span>&#160;   <a class="code" href="classXrdProofdClient.html">XrdProofdClient</a> *<a class="code" href="RSha256_8hxx.html#a63f410abde93141c9013b7d3f3971738">c</a> = p-&gt;<a class="code" href="classXrdProofdProtocol.html#a80024c8f848d0eabe9f13d09f06c8d9d">Client</a>();</div><div class="line"><a name="l00443"></a><span class="lineno">  443</span>&#160;</div><div class="line"><a name="l00444"></a><span class="lineno">  444</span>&#160;   <span class="comment">// Path</span></div><div class="line"><a name="l00445"></a><span class="lineno">  445</span>&#160;   XrdOucString path;</div><div class="line"><a name="l00446"></a><span class="lineno">  446</span>&#160;   <a class="code" href="XrdProofdAux_8h.html#a631cc8787af1a02d9e51c86117ae042e">XPDFORM</a>(path, <span class="stringliteral">&quot;%s/%s.%s.%d&quot;</span>, <a class="code" href="classXrdProofdProofServMgr.html#aa7d4e4ec33be14cd70bbc3595332736e">fActiAdminPath</a>.c_str(), <a class="code" href="RSha256_8hxx.html#a63f410abde93141c9013b7d3f3971738">c</a>-&gt;User(), <a class="code" href="RSha256_8hxx.html#a63f410abde93141c9013b7d3f3971738">c</a>-&gt;Group(), <a class="code" href="namespaceTGeant4Unit.html#a5d450e80998065902b102dca2a69066a">s</a>-&gt;SrvPID());</div><div class="line"><a name="l00447"></a><span class="lineno">  447</span>&#160;</div><div class="line"><a name="l00448"></a><span class="lineno">  448</span>&#160;   <span class="comment">// Save session info to file</span></div><div class="line"><a name="l00449"></a><span class="lineno">  449</span>&#160;   <a class="code" href="classXrdProofSessionInfo.html">XrdProofSessionInfo</a> info(<a class="code" href="RSha256_8hxx.html#a63f410abde93141c9013b7d3f3971738">c</a>, <a class="code" href="namespaceTGeant4Unit.html#a5d450e80998065902b102dca2a69066a">s</a>);</div><div class="line"><a name="l00450"></a><span class="lineno">  450</span>&#160;   <span class="keywordtype">int</span> rc = info.SaveToFile(path.c_str());</div><div class="line"><a name="l00451"></a><span class="lineno">  451</span>&#160;</div><div class="line"><a name="l00452"></a><span class="lineno">  452</span>&#160;   <span class="keywordflow">return</span> rc;</div><div class="line"><a name="l00453"></a><span class="lineno">  453</span>&#160;}</div><div class="line"><a name="l00454"></a><span class="lineno">  454</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00455"></a><span class="lineno">  455</span>&#160;<span class="comment">////////////////////////////////////////////////////////////////////////////////</span></div><div class="line"><a name="l00456"></a><span class="lineno">  456</span>&#160;<span class="comment">/// Checks is fpid is the path of a session UNIX socket</span></div><div class="line"><a name="l00457"></a><span class="lineno">  457</span>&#160;<span class="comment">/// Returns TRUE is yes; cleans the socket if the session is gone.</span></div><div class="line"><a name="l00458"></a><span class="lineno">  458</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00459"></a><span class="lineno"><a class="line" href="classXrdProofdProofServMgr.html#aa2c82434b2d6b59188b6afc2fd6478ef">  459</a></span>&#160;<span class="keywordtype">bool</span> <a class="code" href="classXrdProofdProofServMgr.html#aa2c82434b2d6b59188b6afc2fd6478ef">XrdProofdProofServMgr::IsSessionSocket</a>(<span class="keyword">const</span> <span class="keywordtype">char</span> *fpid)</div><div class="line"><a name="l00460"></a><span class="lineno">  460</span>&#160;{</div><div class="line"><a name="l00461"></a><span class="lineno">  461</span>&#160;   <a class="code" href="XrdProofdTrace_8h.html#a7c31822912a8d0dc9bfd544097b29e12">XPDLOC</a>(SMGR, <span class="stringliteral">&quot;ProofServMgr::IsSessionSocket&quot;</span>)</div><div class="line"><a name="l00462"></a><span class="lineno">  462</span>&#160;</div><div class="line"><a name="l00463"></a><span class="lineno">  463</span>&#160;   <a class="code" href="TGHtml_8h.html#ad5bb4a3d12fd54f29da2b924b29e652b">TRACE</a>(REQ, <span class="stringliteral">&quot;checking &quot;</span>&lt;&lt;fpid&lt;&lt;<span class="stringliteral">&quot; ...&quot;</span>);</div><div class="line"><a name="l00464"></a><span class="lineno">  464</span>&#160;</div><div class="line"><a name="l00465"></a><span class="lineno">  465</span>&#160;   <span class="comment">// Check inputs</span></div><div class="line"><a name="l00466"></a><span class="lineno">  466</span>&#160;   <span class="keywordflow">if</span> (!fpid || strlen(fpid) &lt;= 0) {</div><div class="line"><a name="l00467"></a><span class="lineno">  467</span>&#160;      <a class="code" href="TGHtml_8h.html#ad5bb4a3d12fd54f29da2b924b29e652b">TRACE</a>(XERR, <span class="stringliteral">&quot;invalid input: &quot;</span>&lt;&lt;(fpid ? fpid : <span class="stringliteral">&quot;&lt;nul&gt;&quot;</span>));</div><div class="line"><a name="l00468"></a><span class="lineno">  468</span>&#160;      <span class="keywordflow">return</span> 0;</div><div class="line"><a name="l00469"></a><span class="lineno">  469</span>&#160;   }</div><div class="line"><a name="l00470"></a><span class="lineno">  470</span>&#160;</div><div class="line"><a name="l00471"></a><span class="lineno">  471</span>&#160;   <span class="comment">// Paths</span></div><div class="line"><a name="l00472"></a><span class="lineno">  472</span>&#160;   XrdOucString spath(fpid);</div><div class="line"><a name="l00473"></a><span class="lineno">  473</span>&#160;   <span class="keywordflow">if</span> (!spath.endswith(<span class="stringliteral">&quot;.sock&quot;</span>)) <span class="keywordflow">return</span> 0;</div><div class="line"><a name="l00474"></a><span class="lineno">  474</span>&#160;   <span class="keywordflow">if</span> (!spath.beginswith(<a class="code" href="classXrdProofdProofServMgr.html#aa7d4e4ec33be14cd70bbc3595332736e">fActiAdminPath</a>.c_str())) {</div><div class="line"><a name="l00475"></a><span class="lineno">  475</span>&#160;      <span class="comment">// We are given a partial path: create full paths</span></div><div class="line"><a name="l00476"></a><span class="lineno">  476</span>&#160;      <a class="code" href="XrdProofdAux_8h.html#a631cc8787af1a02d9e51c86117ae042e">XPDFORM</a>(spath, <span class="stringliteral">&quot;%s/%s&quot;</span>, <a class="code" href="classXrdProofdProofServMgr.html#aa7d4e4ec33be14cd70bbc3595332736e">fActiAdminPath</a>.c_str(), fpid);</div><div class="line"><a name="l00477"></a><span class="lineno">  477</span>&#160;   }</div><div class="line"><a name="l00478"></a><span class="lineno">  478</span>&#160;   XrdOucString apath = spath;</div><div class="line"><a name="l00479"></a><span class="lineno">  479</span>&#160;   apath.replace(<span class="stringliteral">&quot;.sock&quot;</span>, <span class="stringliteral">&quot;&quot;</span>);</div><div class="line"><a name="l00480"></a><span class="lineno">  480</span>&#160;</div><div class="line"><a name="l00481"></a><span class="lineno">  481</span>&#160;   <span class="comment">// Check the admin path</span></div><div class="line"><a name="l00482"></a><span class="lineno">  482</span>&#160;   <span class="keyword">struct </span>stat st;</div><div class="line"><a name="l00483"></a><span class="lineno">  483</span>&#160;   <span class="keywordflow">if</span> (stat(apath.c_str(), &amp;st) != 0 &amp;&amp; (errno == ENOENT)) {</div><div class="line"><a name="l00484"></a><span class="lineno">  484</span>&#160;      <span class="comment">// Remove the socket path if not during creation</span></div><div class="line"><a name="l00485"></a><span class="lineno">  485</span>&#160;      <span class="keywordflow">if</span> (<a class="code" href="classXrdProofdProofServMgr.html#a27dec7acd4252ca1e14bf50c654e66c2">CheckCounter</a>(<a class="code" href="classXrdProofdProofServMgr.html#a34c425cdb5ec334f7c3b7acc2fa335e5a9f76e372c8b07c5c30efe4616afb6724">kCreateCnt</a>) &lt;= 0) {</div><div class="line"><a name="l00486"></a><span class="lineno">  486</span>&#160;         unlink(spath.c_str());</div><div class="line"><a name="l00487"></a><span class="lineno">  487</span>&#160;         <a class="code" href="TGHtml_8h.html#ad5bb4a3d12fd54f29da2b924b29e652b">TRACE</a>(REQ, <span class="stringliteral">&quot;missing admin path: removing &quot;</span>&lt;&lt;spath&lt;&lt;<span class="stringliteral">&quot; ...&quot;</span>);</div><div class="line"><a name="l00488"></a><span class="lineno">  488</span>&#160;      }</div><div class="line"><a name="l00489"></a><span class="lineno">  489</span>&#160;   }</div><div class="line"><a name="l00490"></a><span class="lineno">  490</span>&#160;</div><div class="line"><a name="l00491"></a><span class="lineno">  491</span>&#160;   <span class="comment">// Done</span></div><div class="line"><a name="l00492"></a><span class="lineno">  492</span>&#160;   <span class="keywordflow">return</span> 1;</div><div class="line"><a name="l00493"></a><span class="lineno">  493</span>&#160;}</div><div class="line"><a name="l00494"></a><span class="lineno">  494</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00495"></a><span class="lineno">  495</span>&#160;<span class="comment">////////////////////////////////////////////////////////////////////////////////</span></div><div class="line"><a name="l00496"></a><span class="lineno">  496</span>&#160;<span class="comment">/// Move session file from the active to the terminated areas</span></div><div class="line"><a name="l00497"></a><span class="lineno">  497</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00498"></a><span class="lineno"><a class="line" href="classXrdProofdProofServMgr.html#a3afafd9e885f8c755801496783ae333e">  498</a></span>&#160;<span class="keywordtype">int</span> <a class="code" href="classXrdProofdProofServMgr.html#a3afafd9e885f8c755801496783ae333e">XrdProofdProofServMgr::MvSession</a>(<span class="keyword">const</span> <span class="keywordtype">char</span> *fpid)</div><div class="line"><a name="l00499"></a><span class="lineno">  499</span>&#160;{</div><div class="line"><a name="l00500"></a><span class="lineno">  500</span>&#160;   <a class="code" href="XrdProofdTrace_8h.html#a7c31822912a8d0dc9bfd544097b29e12">XPDLOC</a>(SMGR, <span class="stringliteral">&quot;ProofServMgr::MvSession&quot;</span>)</div><div class="line"><a name="l00501"></a><span class="lineno">  501</span>&#160;</div><div class="line"><a name="l00502"></a><span class="lineno">  502</span>&#160;   <a class="code" href="TGHtml_8h.html#ad5bb4a3d12fd54f29da2b924b29e652b">TRACE</a>(REQ, <span class="stringliteral">&quot;moving &quot;</span>&lt;&lt;fpid&lt;&lt;<span class="stringliteral">&quot; ...&quot;</span>);</div><div class="line"><a name="l00503"></a><span class="lineno">  503</span>&#160;</div><div class="line"><a name="l00504"></a><span class="lineno">  504</span>&#160;   <span class="comment">// Check inputs</span></div><div class="line"><a name="l00505"></a><span class="lineno">  505</span>&#160;   <span class="keywordflow">if</span> (!fpid || strlen(fpid) &lt;= 0) {</div><div class="line"><a name="l00506"></a><span class="lineno">  506</span>&#160;      <a class="code" href="TGHtml_8h.html#ad5bb4a3d12fd54f29da2b924b29e652b">TRACE</a>(XERR, <span class="stringliteral">&quot;invalid input: &quot;</span>&lt;&lt;(fpid ? fpid : <span class="stringliteral">&quot;&lt;nul&gt;&quot;</span>));</div><div class="line"><a name="l00507"></a><span class="lineno">  507</span>&#160;      <span class="keywordflow">return</span> -1;</div><div class="line"><a name="l00508"></a><span class="lineno">  508</span>&#160;   }</div><div class="line"><a name="l00509"></a><span class="lineno">  509</span>&#160;</div><div class="line"><a name="l00510"></a><span class="lineno">  510</span>&#160;   <span class="comment">// Paths</span></div><div class="line"><a name="l00511"></a><span class="lineno">  511</span>&#160;   XrdOucString opath(fpid), npath;</div><div class="line"><a name="l00512"></a><span class="lineno">  512</span>&#160;   <span class="keywordflow">if</span> (!opath.beginswith(<a class="code" href="classXrdProofdProofServMgr.html#aa7d4e4ec33be14cd70bbc3595332736e">fActiAdminPath</a>.c_str())) {</div><div class="line"><a name="l00513"></a><span class="lineno">  513</span>&#160;      <span class="comment">// We are given a partial path: create full paths</span></div><div class="line"><a name="l00514"></a><span class="lineno">  514</span>&#160;      <a class="code" href="XrdProofdAux_8h.html#a631cc8787af1a02d9e51c86117ae042e">XPDFORM</a>(opath, <span class="stringliteral">&quot;%s/%s&quot;</span>, <a class="code" href="classXrdProofdProofServMgr.html#aa7d4e4ec33be14cd70bbc3595332736e">fActiAdminPath</a>.c_str(), fpid);</div><div class="line"><a name="l00515"></a><span class="lineno">  515</span>&#160;      opath.replace(<span class="stringliteral">&quot;.status&quot;</span>, <span class="stringliteral">&quot;&quot;</span>);</div><div class="line"><a name="l00516"></a><span class="lineno">  516</span>&#160;   } <span class="keywordflow">else</span> {</div><div class="line"><a name="l00517"></a><span class="lineno">  517</span>&#160;      <span class="comment">// Full path: just create the new path</span></div><div class="line"><a name="l00518"></a><span class="lineno">  518</span>&#160;      opath.replace(<span class="stringliteral">&quot;.status&quot;</span>, <span class="stringliteral">&quot;&quot;</span>);</div><div class="line"><a name="l00519"></a><span class="lineno">  519</span>&#160;   }</div><div class="line"><a name="l00520"></a><span class="lineno">  520</span>&#160;   <span class="comment">// The target path</span></div><div class="line"><a name="l00521"></a><span class="lineno">  521</span>&#160;   npath = opath;</div><div class="line"><a name="l00522"></a><span class="lineno">  522</span>&#160;   npath.replace(<a class="code" href="classXrdProofdProofServMgr.html#aa7d4e4ec33be14cd70bbc3595332736e">fActiAdminPath</a>.c_str(), <a class="code" href="classXrdProofdProofServMgr.html#a6d168474303d8b503001502f4f5ad306">fTermAdminPath</a>.c_str());</div><div class="line"><a name="l00523"></a><span class="lineno">  523</span>&#160;</div><div class="line"><a name="l00524"></a><span class="lineno">  524</span>&#160;   <span class="comment">// Remove the socket path</span></div><div class="line"><a name="l00525"></a><span class="lineno">  525</span>&#160;   XrdOucString spath = opath;</div><div class="line"><a name="l00526"></a><span class="lineno">  526</span>&#160;   spath += <span class="stringliteral">&quot;.sock&quot;</span>;</div><div class="line"><a name="l00527"></a><span class="lineno">  527</span>&#160;   <span class="keywordflow">if</span> (unlink(spath.c_str()) != 0 &amp;&amp; errno != ENOENT)</div><div class="line"><a name="l00528"></a><span class="lineno">  528</span>&#160;      <a class="code" href="TGHtml_8h.html#ad5bb4a3d12fd54f29da2b924b29e652b">TRACE</a>(XERR, <span class="stringliteral">&quot;problems removing the UNIX socket path: &quot;</span>&lt;&lt;spath&lt;&lt;<span class="stringliteral">&quot;; errno: &quot;</span>&lt;&lt;errno);</div><div class="line"><a name="l00529"></a><span class="lineno">  529</span>&#160;   spath.replace(<span class="stringliteral">&quot;.sock&quot;</span>, <span class="stringliteral">&quot;.status&quot;</span>);</div><div class="line"><a name="l00530"></a><span class="lineno">  530</span>&#160;   <span class="keywordflow">if</span> (unlink(spath.c_str()) != 0 &amp;&amp; errno != ENOENT)</div><div class="line"><a name="l00531"></a><span class="lineno">  531</span>&#160;      <a class="code" href="TGHtml_8h.html#ad5bb4a3d12fd54f29da2b924b29e652b">TRACE</a>(XERR, <span class="stringliteral">&quot;problems removing the status file: &quot;</span>&lt;&lt;spath&lt;&lt;<span class="stringliteral">&quot;; errno: &quot;</span>&lt;&lt;errno);</div><div class="line"><a name="l00532"></a><span class="lineno">  532</span>&#160;</div><div class="line"><a name="l00533"></a><span class="lineno">  533</span>&#160;   <span class="comment">// Move the file</span></div><div class="line"><a name="l00534"></a><span class="lineno">  534</span>&#160;   errno = 0;</div><div class="line"><a name="l00535"></a><span class="lineno">  535</span>&#160;   <span class="keywordtype">int</span> rc = 0;</div><div class="line"><a name="l00536"></a><span class="lineno">  536</span>&#160;   <span class="keywordflow">if</span> ((rc = rename(opath.c_str(), npath.c_str())) == 0 || (errno == ENOENT)) {</div><div class="line"><a name="l00537"></a><span class="lineno">  537</span>&#160;      <span class="keywordflow">if</span> (!rc)</div><div class="line"><a name="l00538"></a><span class="lineno">  538</span>&#160;         <span class="comment">// Record the time when we did this</span></div><div class="line"><a name="l00539"></a><span class="lineno">  539</span>&#160;         <a class="code" href="classXrdProofdProofServMgr.html#ace73dbf67431d3004992eaddb709d498">TouchSession</a>(fpid, npath.c_str());</div><div class="line"><a name="l00540"></a><span class="lineno">  540</span>&#160;      <span class="keywordflow">return</span> 0;</div><div class="line"><a name="l00541"></a><span class="lineno">  541</span>&#160;   }</div><div class="line"><a name="l00542"></a><span class="lineno">  542</span>&#160;</div><div class="line"><a name="l00543"></a><span class="lineno">  543</span>&#160;   <a class="code" href="TGHtml_8h.html#ad5bb4a3d12fd54f29da2b924b29e652b">TRACE</a>(XERR, <span class="stringliteral">&quot;session pid file cannot be moved: &quot;</span>&lt;&lt;opath&lt;&lt;</div><div class="line"><a name="l00544"></a><span class="lineno">  544</span>&#160;              <span class="stringliteral">&quot;; target file: &quot;</span>&lt;&lt;npath&lt;&lt;<span class="stringliteral">&quot;; errno: &quot;</span>&lt;&lt;errno);</div><div class="line"><a name="l00545"></a><span class="lineno">  545</span>&#160;   <span class="keywordflow">return</span> -1;</div><div class="line"><a name="l00546"></a><span class="lineno">  546</span>&#160;}</div><div class="line"><a name="l00547"></a><span class="lineno">  547</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00548"></a><span class="lineno">  548</span>&#160;<span class="comment">////////////////////////////////////////////////////////////////////////////////</span></div><div class="line"><a name="l00549"></a><span class="lineno">  549</span>&#160;<span class="comment">/// Remove session file from the terminated sessions area</span></div><div class="line"><a name="l00550"></a><span class="lineno">  550</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00551"></a><span class="lineno"><a class="line" href="classXrdProofdProofServMgr.html#a7efc0cc555297fe131bb6813d51ac957">  551</a></span>&#160;<span class="keywordtype">int</span> <a class="code" href="classXrdProofdProofServMgr.html#a7efc0cc555297fe131bb6813d51ac957">XrdProofdProofServMgr::RmSession</a>(<span class="keyword">const</span> <span class="keywordtype">char</span> *fpid)</div><div class="line"><a name="l00552"></a><span class="lineno">  552</span>&#160;{</div><div class="line"><a name="l00553"></a><span class="lineno">  553</span>&#160;   <a class="code" href="XrdProofdTrace_8h.html#a7c31822912a8d0dc9bfd544097b29e12">XPDLOC</a>(SMGR, <span class="stringliteral">&quot;ProofServMgr::RmSession&quot;</span>)</div><div class="line"><a name="l00554"></a><span class="lineno">  554</span>&#160;</div><div class="line"><a name="l00555"></a><span class="lineno">  555</span>&#160;   <a class="code" href="TGHtml_8h.html#ad5bb4a3d12fd54f29da2b924b29e652b">TRACE</a>(REQ, <span class="stringliteral">&quot;removing &quot;</span>&lt;&lt;fpid&lt;&lt;<span class="stringliteral">&quot; ...&quot;</span>);</div><div class="line"><a name="l00556"></a><span class="lineno">  556</span>&#160;</div><div class="line"><a name="l00557"></a><span class="lineno">  557</span>&#160;   <span class="comment">// Check inputs</span></div><div class="line"><a name="l00558"></a><span class="lineno">  558</span>&#160;   <span class="keywordflow">if</span> (!fpid || strlen(fpid) &lt;= 0) {</div><div class="line"><a name="l00559"></a><span class="lineno">  559</span>&#160;      <a class="code" href="TGHtml_8h.html#ad5bb4a3d12fd54f29da2b924b29e652b">TRACE</a>(XERR, <span class="stringliteral">&quot;invalid input: &quot;</span>&lt;&lt; (fpid ? fpid : <span class="stringliteral">&quot;&lt;nul&gt;&quot;</span>));</div><div class="line"><a name="l00560"></a><span class="lineno">  560</span>&#160;      <span class="keywordflow">return</span> -1;</div><div class="line"><a name="l00561"></a><span class="lineno">  561</span>&#160;   }</div><div class="line"><a name="l00562"></a><span class="lineno">  562</span>&#160;</div><div class="line"><a name="l00563"></a><span class="lineno">  563</span>&#160;   <span class="comment">// Path</span></div><div class="line"><a name="l00564"></a><span class="lineno">  564</span>&#160;   XrdOucString path;</div><div class="line"><a name="l00565"></a><span class="lineno">  565</span>&#160;   <a class="code" href="XrdProofdAux_8h.html#a631cc8787af1a02d9e51c86117ae042e">XPDFORM</a>(path, <span class="stringliteral">&quot;%s/%s&quot;</span>, <a class="code" href="classXrdProofdProofServMgr.html#a6d168474303d8b503001502f4f5ad306">fTermAdminPath</a>.c_str(), fpid);</div><div class="line"><a name="l00566"></a><span class="lineno">  566</span>&#160;</div><div class="line"><a name="l00567"></a><span class="lineno">  567</span>&#160;   <span class="comment">// remove the file</span></div><div class="line"><a name="l00568"></a><span class="lineno">  568</span>&#160;   <span class="keywordflow">if</span> (unlink(path.c_str()) == 0)</div><div class="line"><a name="l00569"></a><span class="lineno">  569</span>&#160;      <span class="keywordflow">return</span> 0;</div><div class="line"><a name="l00570"></a><span class="lineno">  570</span>&#160;</div><div class="line"><a name="l00571"></a><span class="lineno">  571</span>&#160;   <a class="code" href="TGHtml_8h.html#ad5bb4a3d12fd54f29da2b924b29e652b">TRACE</a>(XERR, <span class="stringliteral">&quot;session pid file cannot be unlinked: &quot;</span>&lt;&lt;</div><div class="line"><a name="l00572"></a><span class="lineno">  572</span>&#160;               path&lt;&lt;<span class="stringliteral">&quot;; error: &quot;</span>&lt;&lt;errno);</div><div class="line"><a name="l00573"></a><span class="lineno">  573</span>&#160;   <span class="keywordflow">return</span> -1;</div><div class="line"><a name="l00574"></a><span class="lineno">  574</span>&#160;}</div><div class="line"><a name="l00575"></a><span class="lineno">  575</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00576"></a><span class="lineno">  576</span>&#160;<span class="comment">////////////////////////////////////////////////////////////////////////////////</span></div><div class="line"><a name="l00577"></a><span class="lineno">  577</span>&#160;<span class="comment">/// Update the access time for the session pid file to the current time</span></div><div class="line"><a name="l00578"></a><span class="lineno">  578</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00579"></a><span class="lineno"><a class="line" href="classXrdProofdProofServMgr.html#ace73dbf67431d3004992eaddb709d498">  579</a></span>&#160;<span class="keywordtype">int</span> <a class="code" href="classXrdProofdProofServMgr.html#ace73dbf67431d3004992eaddb709d498">XrdProofdProofServMgr::TouchSession</a>(<span class="keyword">const</span> <span class="keywordtype">char</span> *fpid, <span class="keyword">const</span> <span class="keywordtype">char</span> *fpath)</div><div class="line"><a name="l00580"></a><span class="lineno">  580</span>&#160;{</div><div class="line"><a name="l00581"></a><span class="lineno">  581</span>&#160;   <a class="code" href="XrdProofdTrace_8h.html#a7c31822912a8d0dc9bfd544097b29e12">XPDLOC</a>(SMGR, <span class="stringliteral">&quot;ProofServMgr::TouchSession&quot;</span>)</div><div class="line"><a name="l00582"></a><span class="lineno">  582</span>&#160;</div><div class="line"><a name="l00583"></a><span class="lineno">  583</span>&#160;   <a class="code" href="TGHtml_8h.html#ad5bb4a3d12fd54f29da2b924b29e652b">TRACE</a>(REQ, <span class="stringliteral">&quot;touching &quot;</span>&lt;&lt;(fpid ? fpid : <span class="stringliteral">&quot;&lt;nul&gt;&quot;</span>)&lt;&lt;<span class="stringliteral">&quot;, &quot;</span>&lt;&lt;(fpath ? fpath : <span class="stringliteral">&quot;&lt;nul&gt;&quot;</span>)&lt;&lt;<span class="stringliteral">&quot; ...&quot;</span>);</div><div class="line"><a name="l00584"></a><span class="lineno">  584</span>&#160;</div><div class="line"><a name="l00585"></a><span class="lineno">  585</span>&#160;   <span class="comment">// Check inputs</span></div><div class="line"><a name="l00586"></a><span class="lineno">  586</span>&#160;   <span class="keywordflow">if</span> (!fpid || strlen(fpid) &lt;= 0) {</div><div class="line"><a name="l00587"></a><span class="lineno">  587</span>&#160;      <a class="code" href="TGHtml_8h.html#ad5bb4a3d12fd54f29da2b924b29e652b">TRACE</a>(XERR, <span class="stringliteral">&quot;invalid input: &quot;</span>&lt;&lt;(fpid ? fpid : <span class="stringliteral">&quot;&lt;nul&gt;&quot;</span>));</div><div class="line"><a name="l00588"></a><span class="lineno">  588</span>&#160;      <span class="keywordflow">return</span> -1;</div><div class="line"><a name="l00589"></a><span class="lineno">  589</span>&#160;   }</div><div class="line"><a name="l00590"></a><span class="lineno">  590</span>&#160;</div><div class="line"><a name="l00591"></a><span class="lineno">  591</span>&#160;   <span class="comment">// Path</span></div><div class="line"><a name="l00592"></a><span class="lineno">  592</span>&#160;   XrdOucString path(fpath);</div><div class="line"><a name="l00593"></a><span class="lineno">  593</span>&#160;   <span class="keywordflow">if</span> (!fpath || !fpath[0])</div><div class="line"><a name="l00594"></a><span class="lineno">  594</span>&#160;      <a class="code" href="XrdProofdAux_8h.html#a631cc8787af1a02d9e51c86117ae042e">XPDFORM</a>(path, <span class="stringliteral">&quot;%s/%s.status&quot;</span>, <a class="code" href="classXrdProofdProofServMgr.html#aa7d4e4ec33be14cd70bbc3595332736e">fActiAdminPath</a>.c_str(), fpid);</div><div class="line"><a name="l00595"></a><span class="lineno">  595</span>&#160;</div><div class="line"><a name="l00596"></a><span class="lineno">  596</span>&#160;   <span class="comment">// Update file time stamps</span></div><div class="line"><a name="l00597"></a><span class="lineno">  597</span>&#160;   <span class="keywordflow">if</span> (utime(path.c_str(), 0) == 0)</div><div class="line"><a name="l00598"></a><span class="lineno">  598</span>&#160;      <span class="keywordflow">return</span> 0;</div><div class="line"><a name="l00599"></a><span class="lineno">  599</span>&#160;</div><div class="line"><a name="l00600"></a><span class="lineno">  600</span>&#160;   <a class="code" href="TGHtml_8h.html#ad5bb4a3d12fd54f29da2b924b29e652b">TRACE</a>(XERR, <span class="stringliteral">&quot;time stamps for session pid file cannot be updated: &quot;</span>&lt;&lt;</div><div class="line"><a name="l00601"></a><span class="lineno">  601</span>&#160;               path&lt;&lt;<span class="stringliteral">&quot;; error: &quot;</span>&lt;&lt;errno);</div><div class="line"><a name="l00602"></a><span class="lineno">  602</span>&#160;   <span class="keywordflow">return</span> -1;</div><div class="line"><a name="l00603"></a><span class="lineno">  603</span>&#160;}</div><div class="line"><a name="l00604"></a><span class="lineno">  604</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00605"></a><span class="lineno">  605</span>&#160;<span class="comment">////////////////////////////////////////////////////////////////////////////////</span></div><div class="line"><a name="l00606"></a><span class="lineno">  606</span>&#160;<span class="comment">/// Check if the session is alive, i.e. if it has recently touched its admin file.</span></div><div class="line"><a name="l00607"></a><span class="lineno">  607</span>&#160;<span class="comment">/// Return 0 if alive, 1 if not-responding, -1 in case of error.</span></div><div class="line"><a name="l00608"></a><span class="lineno">  608</span>&#160;<span class="comment">/// The timeout for verification is &#39;to&#39; if positive, else fVerifyTimeOut;</span></div><div class="line"><a name="l00609"></a><span class="lineno">  609</span>&#160;<span class="comment">/// the admin file is looked under &#39;fpath&#39; if defined, else fActiAdminPath.</span></div><div class="line"><a name="l00610"></a><span class="lineno">  610</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00611"></a><span class="lineno"><a class="line" href="classXrdProofdProofServMgr.html#af287fe3c85318d8fff5cfccac3dbb422">  611</a></span>&#160;<span class="keywordtype">int</span> <a class="code" href="classXrdProofdProofServMgr.html#af287fe3c85318d8fff5cfccac3dbb422">XrdProofdProofServMgr::VerifySession</a>(<span class="keyword">const</span> <span class="keywordtype">char</span> *fpid,</div><div class="line"><a name="l00612"></a><span class="lineno">  612</span>&#160;                                         <span class="keywordtype">int</span> to, <span class="keyword">const</span> <span class="keywordtype">char</span> *fpath)</div><div class="line"><a name="l00613"></a><span class="lineno">  613</span>&#160;{</div><div class="line"><a name="l00614"></a><span class="lineno">  614</span>&#160;   <a class="code" href="XrdProofdTrace_8h.html#a7c31822912a8d0dc9bfd544097b29e12">XPDLOC</a>(SMGR, <span class="stringliteral">&quot;ProofServMgr::VerifySession&quot;</span>)</div><div class="line"><a name="l00615"></a><span class="lineno">  615</span>&#160;</div><div class="line"><a name="l00616"></a><span class="lineno">  616</span>&#160;   <span class="comment">// Check inputs</span></div><div class="line"><a name="l00617"></a><span class="lineno">  617</span>&#160;   <span class="keywordflow">if</span> (!fpid || strlen(fpid) &lt;= 0) {</div><div class="line"><a name="l00618"></a><span class="lineno">  618</span>&#160;      <a class="code" href="TGHtml_8h.html#ad5bb4a3d12fd54f29da2b924b29e652b">TRACE</a>(XERR, <span class="stringliteral">&quot;invalid input: &quot;</span>&lt;&lt;(fpid ? fpid : <span class="stringliteral">&quot;&lt;nul&gt;&quot;</span>));</div><div class="line"><a name="l00619"></a><span class="lineno">  619</span>&#160;      <span class="keywordflow">return</span> -1;</div><div class="line"><a name="l00620"></a><span class="lineno">  620</span>&#160;   }</div><div class="line"><a name="l00621"></a><span class="lineno">  621</span>&#160;</div><div class="line"><a name="l00622"></a><span class="lineno">  622</span>&#160;   <span class="comment">// Path</span></div><div class="line"><a name="l00623"></a><span class="lineno">  623</span>&#160;   XrdOucString path;</div><div class="line"><a name="l00624"></a><span class="lineno">  624</span>&#160;   <span class="keywordflow">if</span> (fpath &amp;&amp; strlen(fpath) &gt; 0)</div><div class="line"><a name="l00625"></a><span class="lineno">  625</span>&#160;      <a class="code" href="XrdProofdAux_8h.html#a631cc8787af1a02d9e51c86117ae042e">XPDFORM</a>(path, <span class="stringliteral">&quot;%s/%s&quot;</span>, fpath, fpid);</div><div class="line"><a name="l00626"></a><span class="lineno">  626</span>&#160;   <span class="keywordflow">else</span></div><div class="line"><a name="l00627"></a><span class="lineno">  627</span>&#160;      <a class="code" href="XrdProofdAux_8h.html#a631cc8787af1a02d9e51c86117ae042e">XPDFORM</a>(path, <span class="stringliteral">&quot;%s/%s&quot;</span>, <a class="code" href="classXrdProofdProofServMgr.html#aa7d4e4ec33be14cd70bbc3595332736e">fActiAdminPath</a>.c_str(), fpid);</div><div class="line"><a name="l00628"></a><span class="lineno">  628</span>&#160;</div><div class="line"><a name="l00629"></a><span class="lineno">  629</span>&#160;   <span class="comment">// Check first the new file but also the old one, for backward compatibility</span></div><div class="line"><a name="l00630"></a><span class="lineno">  630</span>&#160;   <span class="keywordtype">int</span> deltat = -1;</div><div class="line"><a name="l00631"></a><span class="lineno">  631</span>&#160;   <span class="keywordtype">bool</span> checkmore = 1;</div><div class="line"><a name="l00632"></a><span class="lineno">  632</span>&#160;   <span class="keywordflow">while</span> (checkmore) {</div><div class="line"><a name="l00633"></a><span class="lineno">  633</span>&#160;      <span class="comment">// Current settings</span></div><div class="line"><a name="l00634"></a><span class="lineno">  634</span>&#160;      <span class="keyword">struct </span>stat st;</div><div class="line"><a name="l00635"></a><span class="lineno">  635</span>&#160;      <span class="keywordflow">if</span> (stat(path.c_str(), &amp;st)) {</div><div class="line"><a name="l00636"></a><span class="lineno">  636</span>&#160;         <a class="code" href="TGHtml_8h.html#ad5bb4a3d12fd54f29da2b924b29e652b">TRACE</a>(XERR, <span class="stringliteral">&quot;session status file cannot be stat&#39;ed: &quot;</span>&lt;&lt;</div><div class="line"><a name="l00637"></a><span class="lineno">  637</span>&#160;                     path&lt;&lt;<span class="stringliteral">&quot;; error: &quot;</span>&lt;&lt;errno);</div><div class="line"><a name="l00638"></a><span class="lineno">  638</span>&#160;         <span class="keywordflow">return</span> -1;</div><div class="line"><a name="l00639"></a><span class="lineno">  639</span>&#160;      }</div><div class="line"><a name="l00640"></a><span class="lineno">  640</span>&#160;      <span class="comment">// Check times</span></div><div class="line"><a name="l00641"></a><span class="lineno">  641</span>&#160;      <span class="keywordtype">int</span> xto = (to &gt; 0) ? to : <a class="code" href="classXrdProofdProofServMgr.html#a1a5fce183660e6508e874505445d88dd">fVerifyTimeOut</a>;</div><div class="line"><a name="l00642"></a><span class="lineno">  642</span>&#160;      deltat = time(0) - st.st_mtime;</div><div class="line"><a name="l00643"></a><span class="lineno">  643</span>&#160;      <span class="keywordflow">if</span> (deltat &gt; xto) {</div><div class="line"><a name="l00644"></a><span class="lineno">  644</span>&#160;         <span class="keywordflow">if</span> (path.endswith(<span class="stringliteral">&quot;.status&quot;</span>)) {</div><div class="line"><a name="l00645"></a><span class="lineno">  645</span>&#160;            <span class="comment">// Check the old one too</span></div><div class="line"><a name="l00646"></a><span class="lineno">  646</span>&#160;            path.erase(path.rfind(<span class="stringliteral">&quot;.status&quot;</span>));</div><div class="line"><a name="l00647"></a><span class="lineno">  647</span>&#160;         } <span class="keywordflow">else</span> {</div><div class="line"><a name="l00648"></a><span class="lineno">  648</span>&#160;            <span class="comment">// Dead</span></div><div class="line"><a name="l00649"></a><span class="lineno">  649</span>&#160;            <a class="code" href="TGHtml_8h.html#ad5bb4a3d12fd54f29da2b924b29e652b">TRACE</a>(DBG, <span class="stringliteral">&quot;admin path for session &quot;</span>&lt;&lt;fpid&lt;&lt;<span class="stringliteral">&quot; hase not been touched&quot;</span></div><div class="line"><a name="l00650"></a><span class="lineno">  650</span>&#160;                       <span class="stringliteral">&quot; since at least &quot;</span>&lt;&lt; xto &lt;&lt;<span class="stringliteral">&quot; secs&quot;</span>);</div><div class="line"><a name="l00651"></a><span class="lineno">  651</span>&#160;            <span class="keywordflow">return</span> 1;</div><div class="line"><a name="l00652"></a><span class="lineno">  652</span>&#160;         }</div><div class="line"><a name="l00653"></a><span class="lineno">  653</span>&#160;      } <span class="keywordflow">else</span> {</div><div class="line"><a name="l00654"></a><span class="lineno">  654</span>&#160;         <span class="comment">// We are done</span></div><div class="line"><a name="l00655"></a><span class="lineno">  655</span>&#160;         checkmore = 0;</div><div class="line"><a name="l00656"></a><span class="lineno">  656</span>&#160;      }</div><div class="line"><a name="l00657"></a><span class="lineno">  657</span>&#160;   }</div><div class="line"><a name="l00658"></a><span class="lineno">  658</span>&#160;</div><div class="line"><a name="l00659"></a><span class="lineno">  659</span>&#160;   <span class="comment">// Alive</span></div><div class="line"><a name="l00660"></a><span class="lineno">  660</span>&#160;   <a class="code" href="TGHtml_8h.html#ad5bb4a3d12fd54f29da2b924b29e652b">TRACE</a>(DBG, <span class="stringliteral">&quot;admin path for session &quot;</span>&lt;&lt;fpid&lt;&lt;<span class="stringliteral">&quot; was touched &quot;</span> &lt;&lt;</div><div class="line"><a name="l00661"></a><span class="lineno">  661</span>&#160;              deltat &lt;&lt;<span class="stringliteral">&quot; secs ago&quot;</span>);</div><div class="line"><a name="l00662"></a><span class="lineno">  662</span>&#160;   <span class="keywordflow">return</span> 0;</div><div class="line"><a name="l00663"></a><span class="lineno">  663</span>&#160;}</div><div class="line"><a name="l00664"></a><span class="lineno">  664</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00665"></a><span class="lineno">  665</span>&#160;<span class="comment">////////////////////////////////////////////////////////////////////////////////</span></div><div class="line"><a name="l00666"></a><span class="lineno">  666</span>&#160;<span class="comment">/// Delete from the hash list the session with ID pid.</span></div><div class="line"><a name="l00667"></a><span class="lineno">  667</span>&#160;<span class="comment">/// Return -ENOENT if not found, or 0.</span></div><div class="line"><a name="l00668"></a><span class="lineno">  668</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00669"></a><span class="lineno"><a class="line" href="classXrdProofdProofServMgr.html#ab78ba4f2c0b8916e62977e50b6677c02">  669</a></span>&#160;<span class="keywordtype">int</span> <a class="code" href="classXrdProofdProofServMgr.html#ab78ba4f2c0b8916e62977e50b6677c02">XrdProofdProofServMgr::DeleteFromSessions</a>(<span class="keyword">const</span> <span class="keywordtype">char</span> *fpid)</div><div class="line"><a name="l00670"></a><span class="lineno">  670</span>&#160;{</div><div class="line"><a name="l00671"></a><span class="lineno">  671</span>&#160;   <a class="code" href="XrdProofdTrace_8h.html#a7c31822912a8d0dc9bfd544097b29e12">XPDLOC</a>(SMGR, <span class="stringliteral">&quot;ProofServMgr::DeleteFromSessions&quot;</span>)</div><div class="line"><a name="l00672"></a><span class="lineno">  672</span>&#160;</div><div class="line"><a name="l00673"></a><span class="lineno">  673</span>&#160;   <a class="code" href="TGHtml_8h.html#ad5bb4a3d12fd54f29da2b924b29e652b">TRACE</a>(REQ, <span class="stringliteral">&quot;session: &quot;</span>&lt;&lt;fpid);</div><div class="line"><a name="l00674"></a><span class="lineno">  674</span>&#160;</div><div class="line"><a name="l00675"></a><span class="lineno">  675</span>&#160;   <span class="comment">// Check inputs</span></div><div class="line"><a name="l00676"></a><span class="lineno">  676</span>&#160;   <span class="keywordflow">if</span> (!fpid || strlen(fpid) &lt;= 0) {</div><div class="line"><a name="l00677"></a><span class="lineno">  677</span>&#160;      <a class="code" href="TGHtml_8h.html#ad5bb4a3d12fd54f29da2b924b29e652b">TRACE</a>(XERR, <span class="stringliteral">&quot;invalid input: &quot;</span>&lt;&lt;(fpid ? fpid : <span class="stringliteral">&quot;&lt;nul&gt;&quot;</span>));</div><div class="line"><a name="l00678"></a><span class="lineno">  678</span>&#160;      <span class="keywordflow">return</span> -1;</div><div class="line"><a name="l00679"></a><span class="lineno">  679</span>&#160;   }</div><div class="line"><a name="l00680"></a><span class="lineno">  680</span>&#160;</div><div class="line"><a name="l00681"></a><span class="lineno">  681</span>&#160;   XrdOucString key = fpid;</div><div class="line"><a name="l00682"></a><span class="lineno">  682</span>&#160;   key.replace(<span class="stringliteral">&quot;.status&quot;</span>, <span class="stringliteral">&quot;&quot;</span>);</div><div class="line"><a name="l00683"></a><span class="lineno">  683</span>&#160;   key.erase(0, key.rfind(<span class="charliteral">&#39;.&#39;</span>) + 1);</div><div class="line"><a name="l00684"></a><span class="lineno">  684</span>&#160;   <a class="code" href="classXrdProofdProofServ.html">XrdProofdProofServ</a> *xps = 0;</div><div class="line"><a name="l00685"></a><span class="lineno">  685</span>&#160;   { <a class="code" href="XrdSysToOuc_8h.html#a4ba18bedbb8a1a4367d57f49a4d773ce">XrdSysMutexHelper</a> mhp(<a class="code" href="classXrdProofdProofServMgr.html#ab90491b1fb65834e75bd46f6e09db87f">fMutex</a>); xps = <a class="code" href="classXrdProofdProofServMgr.html#a4a8be4f347170c279824168597e16caa">fSessions</a>.Find(key.c_str()); }</div><div class="line"><a name="l00686"></a><span class="lineno">  686</span>&#160;   <span class="keywordflow">if</span> (xps) {</div><div class="line"><a name="l00687"></a><span class="lineno">  687</span>&#160;      <span class="comment">// Tell other attached clients, if any, that this session is gone</span></div><div class="line"><a name="l00688"></a><span class="lineno">  688</span>&#160;      XrdOucString msg;</div><div class="line"><a name="l00689"></a><span class="lineno">  689</span>&#160;      <a class="code" href="XrdProofdAux_8h.html#a631cc8787af1a02d9e51c86117ae042e">XPDFORM</a>(msg, <span class="stringliteral">&quot;session: %s terminated by peer&quot;</span>, fpid);</div><div class="line"><a name="l00690"></a><span class="lineno">  690</span>&#160;      <a class="code" href="TGHtml_8h.html#ad5bb4a3d12fd54f29da2b924b29e652b">TRACE</a>(DBG, msg);</div><div class="line"><a name="l00691"></a><span class="lineno">  691</span>&#160;      <span class="comment">// Reset this instance</span></div><div class="line"><a name="l00692"></a><span class="lineno">  692</span>&#160;      <span class="keywordtype">int</span> tp = xps-&gt;<a class="code" href="classXrdProofdProofServ.html#ac4953244f65634a9ee47299d408591d8">Reset</a>(msg.c_str(), <a class="code" href="XProofProtocol_8h.html#af90b47a2dd37c58ac6f67e16c279e27ba3e99445973002fe938a8ac2da4ab5b4a">kXPD_wrkmortem</a>);</div><div class="line"><a name="l00693"></a><span class="lineno">  693</span>&#160;      <span class="comment">// Update counters and lists</span></div><div class="line"><a name="l00694"></a><span class="lineno">  694</span>&#160;      <a class="code" href="XrdSysToOuc_8h.html#a4ba18bedbb8a1a4367d57f49a4d773ce">XrdSysMutexHelper</a> mhp(<a class="code" href="classXrdProofdProofServMgr.html#ab90491b1fb65834e75bd46f6e09db87f">fMutex</a>);</div><div class="line"><a name="l00695"></a><span class="lineno">  695</span>&#160;      <span class="keywordflow">if</span> (tp == 1) <a class="code" href="classXrdProofdProofServMgr.html#afddc4c3251e7293b77ca5f8b4dbe0595">fCurrentSessions</a>--;</div><div class="line"><a name="l00696"></a><span class="lineno">  696</span>&#160;      <span class="comment">// remove from the list of active sessions</span></div><div class="line"><a name="l00697"></a><span class="lineno">  697</span>&#160;      <a class="code" href="classXrdProofdProofServMgr.html#a909fb1d3452ad38d9cc83782f777d07c">fActiveSessions</a>.remove(xps);</div><div class="line"><a name="l00698"></a><span class="lineno">  698</span>&#160;   }</div><div class="line"><a name="l00699"></a><span class="lineno">  699</span>&#160;   <span class="keywordtype">int</span> rc = -1;</div><div class="line"><a name="l00700"></a><span class="lineno">  700</span>&#160;   { <a class="code" href="XrdSysToOuc_8h.html#a4ba18bedbb8a1a4367d57f49a4d773ce">XrdSysMutexHelper</a> mhp(<a class="code" href="classXrdProofdProofServMgr.html#ab90491b1fb65834e75bd46f6e09db87f">fMutex</a>); rc = <a class="code" href="classXrdProofdProofServMgr.html#a4a8be4f347170c279824168597e16caa">fSessions</a>.Del(key.c_str()); }</div><div class="line"><a name="l00701"></a><span class="lineno">  701</span>&#160;   <span class="keywordflow">return</span> rc;</div><div class="line"><a name="l00702"></a><span class="lineno">  702</span>&#160;}</div><div class="line"><a name="l00703"></a><span class="lineno">  703</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00704"></a><span class="lineno">  704</span>&#160;<span class="comment">////////////////////////////////////////////////////////////////////////////////</span></div><div class="line"><a name="l00705"></a><span class="lineno">  705</span>&#160;<span class="comment">/// Go through the active sessions admin path and prepare reconnection of those</span></div><div class="line"><a name="l00706"></a><span class="lineno">  706</span>&#160;<span class="comment">/// still alive.</span></div><div class="line"><a name="l00707"></a><span class="lineno">  707</span>&#160;<span class="comment">/// Called at start-up.</span></div><div class="line"><a name="l00708"></a><span class="lineno">  708</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00709"></a><span class="lineno"><a class="line" href="classXrdProofdProofServMgr.html#a226eefc373fb6d7d68f65649032f1009">  709</a></span>&#160;<span class="keywordtype">int</span> <a class="code" href="classXrdProofdProofServMgr.html#a226eefc373fb6d7d68f65649032f1009">XrdProofdProofServMgr::PrepareSessionRecovering</a>()</div><div class="line"><a name="l00710"></a><span class="lineno">  710</span>&#160;{</div><div class="line"><a name="l00711"></a><span class="lineno">  711</span>&#160;   <a class="code" href="XrdProofdTrace_8h.html#a7c31822912a8d0dc9bfd544097b29e12">XPDLOC</a>(SMGR, <span class="stringliteral">&quot;ProofServMgr::PrepareSessionRecovering&quot;</span>)</div><div class="line"><a name="l00712"></a><span class="lineno">  712</span>&#160;</div><div class="line"><a name="l00713"></a><span class="lineno">  713</span>&#160;   <span class="comment">// Open dir</span></div><div class="line"><a name="l00714"></a><span class="lineno">  714</span>&#160;   DIR *dir = opendir(<a class="code" href="classXrdProofdProofServMgr.html#aa7d4e4ec33be14cd70bbc3595332736e">fActiAdminPath</a>.c_str());</div><div class="line"><a name="l00715"></a><span class="lineno">  715</span>&#160;   <span class="keywordflow">if</span> (!dir) {</div><div class="line"><a name="l00716"></a><span class="lineno">  716</span>&#160;      <a class="code" href="TGHtml_8h.html#ad5bb4a3d12fd54f29da2b924b29e652b">TRACE</a>(XERR, <span class="stringliteral">&quot;cannot open dir &quot;</span>&lt;&lt;<a class="code" href="classXrdProofdProofServMgr.html#aa7d4e4ec33be14cd70bbc3595332736e">fActiAdminPath</a>&lt;&lt;<span class="stringliteral">&quot; ; error: &quot;</span>&lt;&lt;errno);</div><div class="line"><a name="l00717"></a><span class="lineno">  717</span>&#160;      <span class="keywordflow">return</span> -1;</div><div class="line"><a name="l00718"></a><span class="lineno">  718</span>&#160;   }</div><div class="line"><a name="l00719"></a><span class="lineno">  719</span>&#160;   <a class="code" href="TGHtml_8h.html#ad5bb4a3d12fd54f29da2b924b29e652b">TRACE</a>(REQ, <span class="stringliteral">&quot;preparing recovering of active sessions ...&quot;</span>);</div><div class="line"><a name="l00720"></a><span class="lineno">  720</span>&#160;</div><div class="line"><a name="l00721"></a><span class="lineno">  721</span>&#160;   <span class="comment">// Scan the active sessions admin path</span></div><div class="line"><a name="l00722"></a><span class="lineno">  722</span>&#160;   <a class="code" href="classXrdProofdProofServMgr.html#ab1e3069da69611967716f0cecd93dedc">fRecoverClients</a> = <span class="keyword">new</span> std::list&lt;XpdClientSessions *&gt;;</div><div class="line"><a name="l00723"></a><span class="lineno">  723</span>&#160;   <span class="keyword">struct </span>dirent *ent = 0;</div><div class="line"><a name="l00724"></a><span class="lineno">  724</span>&#160;   <span class="keywordflow">while</span> ((ent = (<span class="keyword">struct</span> dirent *)readdir(dir))) {</div><div class="line"><a name="l00725"></a><span class="lineno">  725</span>&#160;      <span class="keywordflow">if</span> (!strncmp(ent-&gt;d_name, <span class="stringliteral">&quot;.&quot;</span>, 1) || !strncmp(ent-&gt;d_name, <span class="stringliteral">&quot;..&quot;</span>, 2)) <span class="keywordflow">continue</span>;</div><div class="line"><a name="l00726"></a><span class="lineno">  726</span>&#160;      <span class="comment">// Get the session instance (skip non-digital entries)</span></div><div class="line"><a name="l00727"></a><span class="lineno">  727</span>&#160;      XrdOucString rest, <a class="code" href="textangle_8C.html#a655a1c2a1ec25e8fcfb713772281e8f5">a</a>;</div><div class="line"><a name="l00728"></a><span class="lineno">  728</span>&#160;      <span class="keywordtype">int</span> pid = <a class="code" href="classXrdProofdAux.html#ae5801323b51316b641483f41dde67aa5">XrdProofdAux::ParsePidPath</a>(ent-&gt;d_name, rest, <a class="code" href="textangle_8C.html#a655a1c2a1ec25e8fcfb713772281e8f5">a</a>);</div><div class="line"><a name="l00729"></a><span class="lineno">  729</span>&#160;      <span class="keywordflow">if</span> (!<a class="code" href="XrdProofdPlatform_8h.html#a8862563dbade574514445160166dcd2d">XPD_LONGOK</a>(pid) || pid &lt;= 0) <span class="keywordflow">continue</span>;</div><div class="line"><a name="l00730"></a><span class="lineno">  730</span>&#160;      <span class="keywordflow">if</span> (<a class="code" href="textangle_8C.html#a655a1c2a1ec25e8fcfb713772281e8f5">a</a>.length() &gt; 0) <span class="keywordflow">continue</span>;</div><div class="line"><a name="l00731"></a><span class="lineno">  731</span>&#160;      <span class="keywordtype">bool</span> rmsession = 1;</div><div class="line"><a name="l00732"></a><span class="lineno">  732</span>&#160;      <span class="comment">// Check if the process is still alive</span></div><div class="line"><a name="l00733"></a><span class="lineno">  733</span>&#160;      <span class="keywordflow">if</span> (<a class="code" href="classXrdProofdAux.html#a44927170bd725bb1476300e603bb9332">XrdProofdAux::VerifyProcessByID</a>(pid) != 0) {</div><div class="line"><a name="l00734"></a><span class="lineno">  734</span>&#160;         <span class="keywordflow">if</span> (<a class="code" href="classXrdProofdProofServMgr.html#af983b32d34ecd820a44c78cf1fa57a8a">ResolveSession</a>(ent-&gt;d_name) == 0) {</div><div class="line"><a name="l00735"></a><span class="lineno">  735</span>&#160;            <a class="code" href="TGHtml_8h.html#ad5bb4a3d12fd54f29da2b924b29e652b">TRACE</a>(DBG, <span class="stringliteral">&quot;found active session: &quot;</span>&lt;&lt;pid);</div><div class="line"><a name="l00736"></a><span class="lineno">  736</span>&#160;            rmsession = 0;</div><div class="line"><a name="l00737"></a><span class="lineno">  737</span>&#160;         }</div><div class="line"><a name="l00738"></a><span class="lineno">  738</span>&#160;      }</div><div class="line"><a name="l00739"></a><span class="lineno">  739</span>&#160;      <span class="comment">// Remove the session, if needed</span></div><div class="line"><a name="l00740"></a><span class="lineno">  740</span>&#160;      <span class="keywordflow">if</span> (rmsession)</div><div class="line"><a name="l00741"></a><span class="lineno">  741</span>&#160;         <a class="code" href="classXrdProofdProofServMgr.html#a3afafd9e885f8c755801496783ae333e">MvSession</a>(ent-&gt;d_name);</div><div class="line"><a name="l00742"></a><span class="lineno">  742</span>&#160;   }</div><div class="line"><a name="l00743"></a><span class="lineno">  743</span>&#160;   <span class="comment">// Close the directory</span></div><div class="line"><a name="l00744"></a><span class="lineno">  744</span>&#160;   closedir(dir);</div><div class="line"><a name="l00745"></a><span class="lineno">  745</span>&#160;</div><div class="line"><a name="l00746"></a><span class="lineno">  746</span>&#160;   <span class="comment">// Start the recovering thread, if needed</span></div><div class="line"><a name="l00747"></a><span class="lineno">  747</span>&#160;   <span class="keywordtype">int</span> nrc = 0;</div><div class="line"><a name="l00748"></a><span class="lineno">  748</span>&#160;   { <a class="code" href="XrdSysToOuc_8h.html#a4ba18bedbb8a1a4367d57f49a4d773ce">XrdSysMutexHelper</a> mhp(<a class="code" href="classXrdProofdProofServMgr.html#a91f8131e123b4e864bdf0c9f069f0ebd">fRecoverMutex</a>); nrc = <a class="code" href="classXrdProofdProofServMgr.html#ab1e3069da69611967716f0cecd93dedc">fRecoverClients</a>-&gt;size(); }</div><div class="line"><a name="l00749"></a><span class="lineno">  749</span>&#160;   <span class="keywordflow">if</span> (nrc &gt; 0) {</div><div class="line"><a name="l00750"></a><span class="lineno">  750</span>&#160;      <span class="comment">// Start recovering thread</span></div><div class="line"><a name="l00751"></a><span class="lineno">  751</span>&#160;      pthread_t tid;</div><div class="line"><a name="l00752"></a><span class="lineno">  752</span>&#160;      <span class="comment">// Fill manager pointers structure</span></div><div class="line"><a name="l00753"></a><span class="lineno">  753</span>&#160;      <a class="code" href="XrdProofdProofServMgr_8cxx.html#ae6f1dbe8fdbfff0847439c11076a4ac2">fManagerCron</a>.<a class="code" href="structXpdManagerCron__t.html#ab30050b19479fd7e6e6cbeffc5030a6c">fClientMgr</a> = <a class="code" href="classXrdProofdProofServMgr.html#a86cac591a5646811e38ff6a2477f4da7">fMgr</a>-&gt;<a class="code" href="classXrdProofdManager.html#ac1aeacfd6edb71f9bc4ebe8e472d006b">ClientMgr</a>();</div><div class="line"><a name="l00754"></a><span class="lineno">  754</span>&#160;      <a class="code" href="XrdProofdProofServMgr_8cxx.html#ae6f1dbe8fdbfff0847439c11076a4ac2">fManagerCron</a>.<a class="code" href="structXpdManagerCron__t.html#a847ebc78e5dabbd2910df2994ad60c68">fSessionMgr</a> = <span class="keyword">this</span>;</div><div class="line"><a name="l00755"></a><span class="lineno">  755</span>&#160;      <a class="code" href="XrdProofdProofServMgr_8cxx.html#ae6f1dbe8fdbfff0847439c11076a4ac2">fManagerCron</a>.<a class="code" href="structXpdManagerCron__t.html#ad59ee4aee440c474f8ad13d5f6b4db2d">fProofSched</a> = <a class="code" href="classXrdProofdProofServMgr.html#a86cac591a5646811e38ff6a2477f4da7">fMgr</a>-&gt;<a class="code" href="classXrdProofdManager.html#aa1be6f6b31c8a496b4b301d9143f0de8">ProofSched</a>();</div><div class="line"><a name="l00756"></a><span class="lineno">  756</span>&#160;      <span class="keywordflow">if</span> (XrdSysThread::Run(&amp;tid, <a class="code" href="XrdProofdProofServMgr_8cxx.html#aeb83da043d20a94faa3416a061e885b7">XrdProofdProofServRecover</a>, (<span class="keywordtype">void</span> *)&amp;<a class="code" href="XrdProofdProofServMgr_8cxx.html#ae6f1dbe8fdbfff0847439c11076a4ac2">fManagerCron</a>,</div><div class="line"><a name="l00757"></a><span class="lineno">  757</span>&#160;                            0, <span class="stringliteral">&quot;ProofServMgr session recover thread&quot;</span>) != 0) {</div><div class="line"><a name="l00758"></a><span class="lineno">  758</span>&#160;         <a class="code" href="TGHtml_8h.html#ad5bb4a3d12fd54f29da2b924b29e652b">TRACE</a>(XERR, <span class="stringliteral">&quot;could not start session recover thread&quot;</span>);</div><div class="line"><a name="l00759"></a><span class="lineno">  759</span>&#160;         <span class="keywordflow">return</span> 0;</div><div class="line"><a name="l00760"></a><span class="lineno">  760</span>&#160;      }</div><div class="line"><a name="l00761"></a><span class="lineno">  761</span>&#160;      <a class="code" href="XrdProofdTrace_8h.html#a16e6f602476f24a2b61f420a39b38527">XPDPRT</a>(<span class="stringliteral">&quot;session recover thread started&quot;</span>);</div><div class="line"><a name="l00762"></a><span class="lineno">  762</span>&#160;   } <span class="keywordflow">else</span> {</div><div class="line"><a name="l00763"></a><span class="lineno">  763</span>&#160;      <span class="comment">// End reconnect state if there is nothing to reconnect</span></div><div class="line"><a name="l00764"></a><span class="lineno">  764</span>&#160;      <span class="keywordflow">if</span> (<a class="code" href="classXrdProofdProofServMgr.html#a86cac591a5646811e38ff6a2477f4da7">fMgr</a>-&gt;<a class="code" href="classXrdProofdManager.html#ac1aeacfd6edb71f9bc4ebe8e472d006b">ClientMgr</a>() &amp;&amp; <a class="code" href="classXrdProofdProofServMgr.html#a86cac591a5646811e38ff6a2477f4da7">fMgr</a>-&gt;<a class="code" href="classXrdProofdManager.html#ac1aeacfd6edb71f9bc4ebe8e472d006b">ClientMgr</a>()-&gt;<a class="code" href="classXrdProofdClientMgr.html#ac04782f2f8795debb4257c67dd499e3c">GetNClients</a>() &lt;= 0)</div><div class="line"><a name="l00765"></a><span class="lineno">  765</span>&#160;         <a class="code" href="classXrdProofdProofServMgr.html#ae4a26a2ec9dc1e8b510ba16d5bbd809b">SetReconnectTime</a>(0);</div><div class="line"><a name="l00766"></a><span class="lineno">  766</span>&#160;   }</div><div class="line"><a name="l00767"></a><span class="lineno">  767</span>&#160;</div><div class="line"><a name="l00768"></a><span class="lineno">  768</span>&#160;   <span class="comment">// Done</span></div><div class="line"><a name="l00769"></a><span class="lineno">  769</span>&#160;   <span class="keywordflow">return</span> 0;</div><div class="line"><a name="l00770"></a><span class="lineno">  770</span>&#160;}</div><div class="line"><a name="l00771"></a><span class="lineno">  771</span>&#160;</div><div class="line"><a name="l00772"></a><span class="lineno">  772</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00773"></a><span class="lineno">  773</span>&#160;<span class="comment">////////////////////////////////////////////////////////////////////////////////</span></div><div class="line"><a name="l00774"></a><span class="lineno">  774</span>&#160;<span class="comment">/// Accept connections from sessions still alive. This is run in a dedicated</span></div><div class="line"><a name="l00775"></a><span class="lineno">  775</span>&#160;<span class="comment">/// thread.</span></div><div class="line"><a name="l00776"></a><span class="lineno">  776</span>&#160;<span class="comment">/// Returns -1 in case of failure, 0 if all alive sessions reconnected or the</span></div><div class="line"><a name="l00777"></a><span class="lineno">  777</span>&#160;<span class="comment">/// numer of sessions not reconnected if the timeout (fRecoverTimeOut per client)</span></div><div class="line"><a name="l00778"></a><span class="lineno">  778</span>&#160;<span class="comment">/// expired.</span></div><div class="line"><a name="l00779"></a><span class="lineno">  779</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00780"></a><span class="lineno"><a class="line" href="classXrdProofdProofServMgr.html#a9ab19d67f4db0bd30bc8ac858f790951">  780</a></span>&#160;<span class="keywordtype">int</span> <a class="code" href="classXrdProofdProofServMgr.html#a9ab19d67f4db0bd30bc8ac858f790951">XrdProofdProofServMgr::RecoverActiveSessions</a>()</div><div class="line"><a name="l00781"></a><span class="lineno">  781</span>&#160;{</div><div class="line"><a name="l00782"></a><span class="lineno">  782</span>&#160;   <a class="code" href="XrdProofdTrace_8h.html#a7c31822912a8d0dc9bfd544097b29e12">XPDLOC</a>(SMGR, <span class="stringliteral">&quot;ProofServMgr::RecoverActiveSessions&quot;</span>)</div><div class="line"><a name="l00783"></a><span class="lineno">  783</span>&#160;</div><div class="line"><a name="l00784"></a><span class="lineno">  784</span>&#160;   <span class="keywordtype">int</span> rc = 0;</div><div class="line"><a name="l00785"></a><span class="lineno">  785</span>&#160;</div><div class="line"><a name="l00786"></a><span class="lineno">  786</span>&#160;   <span class="keywordflow">if</span> (!<a class="code" href="classXrdProofdProofServMgr.html#ab1e3069da69611967716f0cecd93dedc">fRecoverClients</a>) {</div><div class="line"><a name="l00787"></a><span class="lineno">  787</span>&#160;      <span class="comment">// Invalid input</span></div><div class="line"><a name="l00788"></a><span class="lineno">  788</span>&#160;      <a class="code" href="TGHtml_8h.html#ad5bb4a3d12fd54f29da2b924b29e652b">TRACE</a>(XERR, <span class="stringliteral">&quot;recovering clients list undefined&quot;</span>);</div><div class="line"><a name="l00789"></a><span class="lineno">  789</span>&#160;      <span class="keywordflow">return</span> -1;</div><div class="line"><a name="l00790"></a><span class="lineno">  790</span>&#160;   }</div><div class="line"><a name="l00791"></a><span class="lineno">  791</span>&#160;</div><div class="line"><a name="l00792"></a><span class="lineno">  792</span>&#160;   <span class="keywordtype">int</span> nrc = 0;</div><div class="line"><a name="l00793"></a><span class="lineno">  793</span>&#160;   { <a class="code" href="XrdSysToOuc_8h.html#a4ba18bedbb8a1a4367d57f49a4d773ce">XrdSysMutexHelper</a> mhp(<a class="code" href="classXrdProofdProofServMgr.html#a91f8131e123b4e864bdf0c9f069f0ebd">fRecoverMutex</a>); nrc = <a class="code" href="classXrdProofdProofServMgr.html#ab1e3069da69611967716f0cecd93dedc">fRecoverClients</a>-&gt;size(); }</div><div class="line"><a name="l00794"></a><span class="lineno">  794</span>&#160;   <a class="code" href="TGHtml_8h.html#ad5bb4a3d12fd54f29da2b924b29e652b">TRACE</a>(REQ, <span class="stringliteral">&quot;start recovering of &quot;</span>&lt;&lt;nrc&lt;&lt;<span class="stringliteral">&quot; clients&quot;</span>);</div><div class="line"><a name="l00795"></a><span class="lineno">  795</span>&#160;</div><div class="line"><a name="l00796"></a><span class="lineno">  796</span>&#160;   <span class="comment">// Recovering deadline</span></div><div class="line"><a name="l00797"></a><span class="lineno">  797</span>&#160;   { <a class="code" href="XrdSysToOuc_8h.html#a4ba18bedbb8a1a4367d57f49a4d773ce">XrdSysMutexHelper</a> mhp(<a class="code" href="classXrdProofdProofServMgr.html#a91f8131e123b4e864bdf0c9f069f0ebd">fRecoverMutex</a>);</div><div class="line"><a name="l00798"></a><span class="lineno">  798</span>&#160;     <a class="code" href="classXrdProofdProofServMgr.html#a2312694173da8ebbefabb702a4dd089b">fRecoverDeadline</a> = time(0) + <a class="code" href="classXrdProofdProofServMgr.html#aa150146266359bec018e9b443e49818d">fRecoverTimeOut</a> * nrc; }</div><div class="line"><a name="l00799"></a><span class="lineno">  799</span>&#160;</div><div class="line"><a name="l00800"></a><span class="lineno">  800</span>&#160;   <span class="comment">// Respect the deadline</span></div><div class="line"><a name="l00801"></a><span class="lineno">  801</span>&#160;   <span class="keywordtype">int</span> nr = 0;</div><div class="line"><a name="l00802"></a><span class="lineno">  802</span>&#160;   <a class="code" href="classXpdClientSessions.html">XpdClientSessions</a> *cls = 0;</div><div class="line"><a name="l00803"></a><span class="lineno">  803</span>&#160;   <span class="keywordtype">bool</span> go = <span class="keyword">true</span>;</div><div class="line"><a name="l00804"></a><span class="lineno">  804</span>&#160;   <span class="keywordflow">while</span> (go) {</div><div class="line"><a name="l00805"></a><span class="lineno">  805</span>&#160;</div><div class="line"><a name="l00806"></a><span class="lineno">  806</span>&#160;      <span class="comment">// Pickup the first one in the list</span></div><div class="line"><a name="l00807"></a><span class="lineno">  807</span>&#160;      { <a class="code" href="XrdSysToOuc_8h.html#a4ba18bedbb8a1a4367d57f49a4d773ce">XrdSysMutexHelper</a> mhp(<a class="code" href="classXrdProofdProofServMgr.html#a91f8131e123b4e864bdf0c9f069f0ebd">fRecoverMutex</a>); cls = <a class="code" href="classXrdProofdProofServMgr.html#ab1e3069da69611967716f0cecd93dedc">fRecoverClients</a>-&gt;front(); }</div><div class="line"><a name="l00808"></a><span class="lineno">  808</span>&#160;      <span class="keywordflow">if</span> (cls) {</div><div class="line"><a name="l00809"></a><span class="lineno">  809</span>&#160;         <a class="code" href="classXrdProofdProofServMgr.html#ae4a26a2ec9dc1e8b510ba16d5bbd809b">SetReconnectTime</a>();</div><div class="line"><a name="l00810"></a><span class="lineno">  810</span>&#160;         nr += <a class="code" href="classXrdProofdProofServMgr.html#ac8b90ca558edf52af7b174c02aca89ac">Recover</a>(cls);</div><div class="line"><a name="l00811"></a><span class="lineno">  811</span>&#160;</div><div class="line"><a name="l00812"></a><span class="lineno">  812</span>&#160;         <span class="comment">// If all client sessions reconnected remove the client from the list</span></div><div class="line"><a name="l00813"></a><span class="lineno">  813</span>&#160;         {  <a class="code" href="XrdSysToOuc_8h.html#a4ba18bedbb8a1a4367d57f49a4d773ce">XrdSysMutexHelper</a> mhp(cls-&gt;<a class="code" href="classXpdClientSessions.html#a45dc70ffd3df9c03fda9f63db865ee0d">fMutex</a>);</div><div class="line"><a name="l00814"></a><span class="lineno">  814</span>&#160;            <span class="keywordflow">if</span> (cls-&gt;<a class="code" href="classXpdClientSessions.html#ad416d664f0ee7bfcece4e30e0f796346">fProofServs</a>.size() &lt;= 0) {</div><div class="line"><a name="l00815"></a><span class="lineno">  815</span>&#160;               <a class="code" href="XrdSysToOuc_8h.html#a4ba18bedbb8a1a4367d57f49a4d773ce">XrdSysMutexHelper</a> mhpr(<a class="code" href="classXrdProofdProofServMgr.html#a91f8131e123b4e864bdf0c9f069f0ebd">fRecoverMutex</a>);</div><div class="line"><a name="l00816"></a><span class="lineno">  816</span>&#160;               <a class="code" href="classXrdProofdProofServMgr.html#ab1e3069da69611967716f0cecd93dedc">fRecoverClients</a>-&gt;remove(cls);</div><div class="line"><a name="l00817"></a><span class="lineno">  817</span>&#160;               <span class="comment">// We may be over</span></div><div class="line"><a name="l00818"></a><span class="lineno">  818</span>&#160;               <span class="keywordflow">if</span> ((nrc = <a class="code" href="classXrdProofdProofServMgr.html#ab1e3069da69611967716f0cecd93dedc">fRecoverClients</a>-&gt;size()) &lt;= 0)</div><div class="line"><a name="l00819"></a><span class="lineno">  819</span>&#160;                  <span class="keywordflow">break</span>;</div><div class="line"><a name="l00820"></a><span class="lineno">  820</span>&#160;            }</div><div class="line"><a name="l00821"></a><span class="lineno">  821</span>&#160;         }</div><div class="line"><a name="l00822"></a><span class="lineno">  822</span>&#160;      }</div><div class="line"><a name="l00823"></a><span class="lineno">  823</span>&#160;      <a class="code" href="TGHtml_8h.html#ad5bb4a3d12fd54f29da2b924b29e652b">TRACE</a>(REQ, nrc&lt;&lt;<span class="stringliteral">&quot; clients still to recover&quot;</span>);</div><div class="line"><a name="l00824"></a><span class="lineno">  824</span>&#160;</div><div class="line"><a name="l00825"></a><span class="lineno">  825</span>&#160;      <span class="comment">// Check the deadline</span></div><div class="line"><a name="l00826"></a><span class="lineno">  826</span>&#160;      {  <a class="code" href="XrdSysToOuc_8h.html#a4ba18bedbb8a1a4367d57f49a4d773ce">XrdSysMutexHelper</a> mhp(<a class="code" href="classXrdProofdProofServMgr.html#a91f8131e123b4e864bdf0c9f069f0ebd">fRecoverMutex</a>);</div><div class="line"><a name="l00827"></a><span class="lineno">  827</span>&#160;         go = (time(0) &lt; <a class="code" href="classXrdProofdProofServMgr.html#a2312694173da8ebbefabb702a4dd089b">fRecoverDeadline</a>) ? <span class="keyword">true</span> : <span class="keyword">false</span>; }</div><div class="line"><a name="l00828"></a><span class="lineno">  828</span>&#160;   }</div><div class="line"><a name="l00829"></a><span class="lineno">  829</span>&#160;   <span class="comment">// End reconnect state</span></div><div class="line"><a name="l00830"></a><span class="lineno">  830</span>&#160;   <a class="code" href="classXrdProofdProofServMgr.html#ae4a26a2ec9dc1e8b510ba16d5bbd809b">SetReconnectTime</a>(0);</div><div class="line"><a name="l00831"></a><span class="lineno">  831</span>&#160;</div><div class="line"><a name="l00832"></a><span class="lineno">  832</span>&#160;   <span class="comment">// If we reached the deadline, calculate the number of sessions not reconnected</span></div><div class="line"><a name="l00833"></a><span class="lineno">  833</span>&#160;   rc = 0;</div><div class="line"><a name="l00834"></a><span class="lineno">  834</span>&#160;   {  <a class="code" href="XrdSysToOuc_8h.html#a4ba18bedbb8a1a4367d57f49a4d773ce">XrdSysMutexHelper</a> mhp(<a class="code" href="classXrdProofdProofServMgr.html#a91f8131e123b4e864bdf0c9f069f0ebd">fRecoverMutex</a>);</div><div class="line"><a name="l00835"></a><span class="lineno">  835</span>&#160;      <span class="keywordflow">if</span> (<a class="code" href="classXrdProofdProofServMgr.html#ab1e3069da69611967716f0cecd93dedc">fRecoverClients</a>-&gt;size() &gt; 0) {</div><div class="line"><a name="l00836"></a><span class="lineno">  836</span>&#160;         std::list&lt;XpdClientSessions* &gt;::iterator ii = <a class="code" href="classXrdProofdProofServMgr.html#ab1e3069da69611967716f0cecd93dedc">fRecoverClients</a>-&gt;begin();</div><div class="line"><a name="l00837"></a><span class="lineno">  837</span>&#160;         <span class="keywordflow">for</span> (; ii != <a class="code" href="classXrdProofdProofServMgr.html#ab1e3069da69611967716f0cecd93dedc">fRecoverClients</a>-&gt;end(); ++ii) {</div><div class="line"><a name="l00838"></a><span class="lineno">  838</span>&#160;            rc += (*ii)-&gt;fProofServs.size();</div><div class="line"><a name="l00839"></a><span class="lineno">  839</span>&#160;         }</div><div class="line"><a name="l00840"></a><span class="lineno">  840</span>&#160;      }</div><div class="line"><a name="l00841"></a><span class="lineno">  841</span>&#160;   }</div><div class="line"><a name="l00842"></a><span class="lineno">  842</span>&#160;</div><div class="line"><a name="l00843"></a><span class="lineno">  843</span>&#160;   <span class="comment">// Delete the recovering clients list</span></div><div class="line"><a name="l00844"></a><span class="lineno">  844</span>&#160;   {  <a class="code" href="XrdSysToOuc_8h.html#a4ba18bedbb8a1a4367d57f49a4d773ce">XrdSysMutexHelper</a> mhp(<a class="code" href="classXrdProofdProofServMgr.html#a91f8131e123b4e864bdf0c9f069f0ebd">fRecoverMutex</a>);</div><div class="line"><a name="l00845"></a><span class="lineno">  845</span>&#160;      <a class="code" href="classXrdProofdProofServMgr.html#ab1e3069da69611967716f0cecd93dedc">fRecoverClients</a>-&gt;clear();</div><div class="line"><a name="l00846"></a><span class="lineno">  846</span>&#160;      <span class="keyword">delete</span> <a class="code" href="classXrdProofdProofServMgr.html#ab1e3069da69611967716f0cecd93dedc">fRecoverClients</a>;</div><div class="line"><a name="l00847"></a><span class="lineno">  847</span>&#160;      <a class="code" href="classXrdProofdProofServMgr.html#ab1e3069da69611967716f0cecd93dedc">fRecoverClients</a> = 0;</div><div class="line"><a name="l00848"></a><span class="lineno">  848</span>&#160;      <a class="code" href="classXrdProofdProofServMgr.html#a2312694173da8ebbefabb702a4dd089b">fRecoverDeadline</a> = -1;</div><div class="line"><a name="l00849"></a><span class="lineno">  849</span>&#160;   }</div><div class="line"><a name="l00850"></a><span class="lineno">  850</span>&#160;</div><div class="line"><a name="l00851"></a><span class="lineno">  851</span>&#160;   <span class="comment">// Done</span></div><div class="line"><a name="l00852"></a><span class="lineno">  852</span>&#160;   <span class="keywordflow">return</span> rc;</div><div class="line"><a name="l00853"></a><span class="lineno">  853</span>&#160;}</div><div class="line"><a name="l00854"></a><span class="lineno">  854</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00855"></a><span class="lineno">  855</span>&#160;<span class="comment">////////////////////////////////////////////////////////////////////////////////</span></div><div class="line"><a name="l00856"></a><span class="lineno">  856</span>&#160;<span class="comment">/// Returns true (an the recovering deadline) if the client has sessions in</span></div><div class="line"><a name="l00857"></a><span class="lineno">  857</span>&#160;<span class="comment">/// recovering state; returns false otherwise.</span></div><div class="line"><a name="l00858"></a><span class="lineno">  858</span>&#160;<span class="comment">/// Called during for attach requests.</span></div><div class="line"><a name="l00859"></a><span class="lineno">  859</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00860"></a><span class="lineno"><a class="line" href="classXrdProofdProofServMgr.html#a3aef7efdf20b92f8db384ff26aa5f7fc">  860</a></span>&#160;<span class="keywordtype">bool</span> <a class="code" href="classXrdProofdProofServMgr.html#a3aef7efdf20b92f8db384ff26aa5f7fc">XrdProofdProofServMgr::IsClientRecovering</a>(<span class="keyword">const</span> <span class="keywordtype">char</span> *usr, <span class="keyword">const</span> <span class="keywordtype">char</span> *grp,</div><div class="line"><a name="l00861"></a><span class="lineno">  861</span>&#160;                                               <span class="keywordtype">int</span> &amp;deadline)</div><div class="line"><a name="l00862"></a><span class="lineno">  862</span>&#160;{</div><div class="line"><a name="l00863"></a><span class="lineno">  863</span>&#160;   <a class="code" href="XrdProofdTrace_8h.html#a7c31822912a8d0dc9bfd544097b29e12">XPDLOC</a>(SMGR, <span class="stringliteral">&quot;ProofServMgr::IsClientRecovering&quot;</span>)</div><div class="line"><a name="l00864"></a><span class="lineno">  864</span>&#160;</div><div class="line"><a name="l00865"></a><span class="lineno">  865</span>&#160;   <span class="keywordflow">if</span> (!usr || !grp) {</div><div class="line"><a name="l00866"></a><span class="lineno">  866</span>&#160;      <a class="code" href="TGHtml_8h.html#ad5bb4a3d12fd54f29da2b924b29e652b">TRACE</a>(XERR, <span class="stringliteral">&quot;invalid inputs: usr: &quot;</span>&lt;&lt;(usr ? usr : <span class="stringliteral">&quot;&quot;</span>)&lt;&lt;<span class="stringliteral">&quot;, grp:&quot;</span>&lt;&lt;(grp ? grp : <span class="stringliteral">&quot;&quot;</span>)&lt;&lt;<span class="stringliteral">&quot; ...&quot;</span>);</div><div class="line"><a name="l00867"></a><span class="lineno">  867</span>&#160;      <span class="keywordflow">return</span> <span class="keyword">false</span>;</div><div class="line"><a name="l00868"></a><span class="lineno">  868</span>&#160;   }</div><div class="line"><a name="l00869"></a><span class="lineno">  869</span>&#160;</div><div class="line"><a name="l00870"></a><span class="lineno">  870</span>&#160;   deadline = -1;</div><div class="line"><a name="l00871"></a><span class="lineno">  871</span>&#160;   <span class="keywordtype">int</span> rc = <span class="keyword">false</span>;</div><div class="line"><a name="l00872"></a><span class="lineno">  872</span>&#160;   {  <a class="code" href="XrdSysToOuc_8h.html#a4ba18bedbb8a1a4367d57f49a4d773ce">XrdSysMutexHelper</a> mhp(<a class="code" href="classXrdProofdProofServMgr.html#a91f8131e123b4e864bdf0c9f069f0ebd">fRecoverMutex</a>);</div><div class="line"><a name="l00873"></a><span class="lineno">  873</span>&#160;      <span class="keywordflow">if</span> (<a class="code" href="classXrdProofdProofServMgr.html#ab1e3069da69611967716f0cecd93dedc">fRecoverClients</a> &amp;&amp; <a class="code" href="classXrdProofdProofServMgr.html#ab1e3069da69611967716f0cecd93dedc">fRecoverClients</a>-&gt;size() &gt; 0) {</div><div class="line"><a name="l00874"></a><span class="lineno">  874</span>&#160;         std::list&lt;XpdClientSessions *&gt;::iterator ii = <a class="code" href="classXrdProofdProofServMgr.html#ab1e3069da69611967716f0cecd93dedc">fRecoverClients</a>-&gt;begin();</div><div class="line"><a name="l00875"></a><span class="lineno">  875</span>&#160;         <span class="keywordflow">for</span> (; ii != <a class="code" href="classXrdProofdProofServMgr.html#ab1e3069da69611967716f0cecd93dedc">fRecoverClients</a>-&gt;end(); ++ii) {</div><div class="line"><a name="l00876"></a><span class="lineno">  876</span>&#160;            <span class="keywordflow">if</span> ((*ii)-&gt;fClient &amp;&amp; (*ii)-&gt;fClient-&gt;Match(usr, grp)) {</div><div class="line"><a name="l00877"></a><span class="lineno">  877</span>&#160;               rc = <span class="keyword">true</span>;</div><div class="line"><a name="l00878"></a><span class="lineno">  878</span>&#160;               deadline = <a class="code" href="classXrdProofdProofServMgr.html#a2312694173da8ebbefabb702a4dd089b">fRecoverDeadline</a>;</div><div class="line"><a name="l00879"></a><span class="lineno">  879</span>&#160;               <span class="keywordflow">break</span>;</div><div class="line"><a name="l00880"></a><span class="lineno">  880</span>&#160;            }</div><div class="line"><a name="l00881"></a><span class="lineno">  881</span>&#160;         }</div><div class="line"><a name="l00882"></a><span class="lineno">  882</span>&#160;      }</div><div class="line"><a name="l00883"></a><span class="lineno">  883</span>&#160;   }</div><div class="line"><a name="l00884"></a><span class="lineno">  884</span>&#160;   <a class="code" href="TGHtml_8h.html#ad5bb4a3d12fd54f29da2b924b29e652b">TRACE</a>(DBG, <span class="stringliteral">&quot;checking usr: &quot;</span>&lt;&lt;usr&lt;&lt;<span class="stringliteral">&quot;, grp:&quot;</span>&lt;&lt;grp&lt;&lt;<span class="stringliteral">&quot; ... recovering? &quot;</span>&lt;&lt;</div><div class="line"><a name="l00885"></a><span class="lineno">  885</span>&#160;              rc&lt;&lt;<span class="stringliteral">&quot;, until: &quot;</span>&lt;&lt;deadline);</div><div class="line"><a name="l00886"></a><span class="lineno">  886</span>&#160;</div><div class="line"><a name="l00887"></a><span class="lineno">  887</span>&#160;   <span class="comment">// Done</span></div><div class="line"><a name="l00888"></a><span class="lineno">  888</span>&#160;   <span class="keywordflow">return</span> rc;</div><div class="line"><a name="l00889"></a><span class="lineno">  889</span>&#160;}</div><div class="line"><a name="l00890"></a><span class="lineno">  890</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00891"></a><span class="lineno">  891</span>&#160;<span class="comment">////////////////////////////////////////////////////////////////////////////////</span></div><div class="line"><a name="l00892"></a><span class="lineno">  892</span>&#160;<span class="comment">/// Go through the active sessions admin path and make sure sessions are alive.</span></div><div class="line"><a name="l00893"></a><span class="lineno">  893</span>&#160;<span class="comment">/// If &#39;verify&#39; is true also ask the session to proof that they are alive</span></div><div class="line"><a name="l00894"></a><span class="lineno">  894</span>&#160;<span class="comment">/// via asynchronous ping (the result will be done at next check).</span></div><div class="line"><a name="l00895"></a><span class="lineno">  895</span>&#160;<span class="comment">/// Move those not responding in the terminated sessions admin path.</span></div><div class="line"><a name="l00896"></a><span class="lineno">  896</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00897"></a><span class="lineno"><a class="line" href="classXrdProofdProofServMgr.html#aa240763e1eeb263e403b7c5cd8aca2ae">  897</a></span>&#160;<span class="keywordtype">int</span> <a class="code" href="classXrdProofdProofServMgr.html#aa240763e1eeb263e403b7c5cd8aca2ae">XrdProofdProofServMgr::CheckActiveSessions</a>(<span class="keywordtype">bool</span> verify)</div><div class="line"><a name="l00898"></a><span class="lineno">  898</span>&#160;{</div><div class="line"><a name="l00899"></a><span class="lineno">  899</span>&#160;   <a class="code" href="XrdProofdTrace_8h.html#a7c31822912a8d0dc9bfd544097b29e12">XPDLOC</a>(SMGR, <span class="stringliteral">&quot;ProofServMgr::CheckActiveSessions&quot;</span>)</div><div class="line"><a name="l00900"></a><span class="lineno">  900</span>&#160;</div><div class="line"><a name="l00901"></a><span class="lineno">  901</span>&#160;   <a class="code" href="TGHtml_8h.html#ad5bb4a3d12fd54f29da2b924b29e652b">TRACE</a>(REQ, <span class="stringliteral">&quot;checking active sessions ...&quot;</span>);</div><div class="line"><a name="l00902"></a><span class="lineno">  902</span>&#160;</div><div class="line"><a name="l00903"></a><span class="lineno">  903</span>&#160;   <span class="comment">// Open dir</span></div><div class="line"><a name="l00904"></a><span class="lineno">  904</span>&#160;   DIR *dir = opendir(<a class="code" href="classXrdProofdProofServMgr.html#aa7d4e4ec33be14cd70bbc3595332736e">fActiAdminPath</a>.c_str());</div><div class="line"><a name="l00905"></a><span class="lineno">  905</span>&#160;   <span class="keywordflow">if</span> (!dir) {</div><div class="line"><a name="l00906"></a><span class="lineno">  906</span>&#160;      <a class="code" href="TGHtml_8h.html#ad5bb4a3d12fd54f29da2b924b29e652b">TRACE</a>(XERR, <span class="stringliteral">&quot;cannot open dir &quot;</span>&lt;&lt;<a class="code" href="classXrdProofdProofServMgr.html#aa7d4e4ec33be14cd70bbc3595332736e">fActiAdminPath</a>&lt;&lt;<span class="stringliteral">&quot; ; error: &quot;</span>&lt;&lt;errno);</div><div class="line"><a name="l00907"></a><span class="lineno">  907</span>&#160;      <span class="keywordflow">return</span> -1;</div><div class="line"><a name="l00908"></a><span class="lineno">  908</span>&#160;   }</div><div class="line"><a name="l00909"></a><span class="lineno">  909</span>&#160;</div><div class="line"><a name="l00910"></a><span class="lineno">  910</span>&#160;   <span class="comment">// Scan the active sessions admin path</span></div><div class="line"><a name="l00911"></a><span class="lineno">  911</span>&#160;   <span class="keyword">struct </span>dirent *ent = 0;</div><div class="line"><a name="l00912"></a><span class="lineno">  912</span>&#160;   <span class="keywordflow">while</span> ((ent = (<span class="keyword">struct</span> dirent *)readdir(dir))) {</div><div class="line"><a name="l00913"></a><span class="lineno">  913</span>&#160;      <span class="keywordflow">if</span> (!strncmp(ent-&gt;d_name, <span class="stringliteral">&quot;.&quot;</span>, 1) || !strncmp(ent-&gt;d_name, <span class="stringliteral">&quot;..&quot;</span>, 2)) <span class="keywordflow">continue</span>;</div><div class="line"><a name="l00914"></a><span class="lineno">  914</span>&#160;      <span class="comment">// If a socket path, make sure that the associated session still exists</span></div><div class="line"><a name="l00915"></a><span class="lineno">  915</span>&#160;      <span class="comment">// and go to the next</span></div><div class="line"><a name="l00916"></a><span class="lineno">  916</span>&#160;      <span class="keywordflow">if</span> (strstr(ent-&gt;d_name, <span class="stringliteral">&quot;.sock&quot;</span>) &amp;&amp; <a class="code" href="classXrdProofdProofServMgr.html#aa2c82434b2d6b59188b6afc2fd6478ef">IsSessionSocket</a>(ent-&gt;d_name)) <span class="keywordflow">continue</span>;</div><div class="line"><a name="l00917"></a><span class="lineno">  917</span>&#160;      <span class="comment">// Get the session instance (skip non-digital entries)</span></div><div class="line"><a name="l00918"></a><span class="lineno">  918</span>&#160;      XrdOucString rest, key, after;</div><div class="line"><a name="l00919"></a><span class="lineno">  919</span>&#160;      <span class="keywordtype">int</span> pid = <a class="code" href="classXrdProofdAux.html#ae5801323b51316b641483f41dde67aa5">XrdProofdAux::ParsePidPath</a>(ent-&gt;d_name, rest, after);</div><div class="line"><a name="l00920"></a><span class="lineno">  920</span>&#160;      <span class="comment">// If not a status path, go to the next</span></div><div class="line"><a name="l00921"></a><span class="lineno">  921</span>&#160;      <span class="keywordflow">if</span> (after != <span class="stringliteral">&quot;status&quot;</span>) <span class="keywordflow">continue</span>;</div><div class="line"><a name="l00922"></a><span class="lineno">  922</span>&#160;      <span class="comment">// If not a good pid</span></div><div class="line"><a name="l00923"></a><span class="lineno">  923</span>&#160;      <span class="keywordflow">if</span> (!<a class="code" href="XrdProofdPlatform_8h.html#a8862563dbade574514445160166dcd2d">XPD_LONGOK</a>(pid) || pid &lt;= 0) <span class="keywordflow">continue</span>;</div><div class="line"><a name="l00924"></a><span class="lineno">  924</span>&#160;      key += pid;</div><div class="line"><a name="l00925"></a><span class="lineno">  925</span>&#160;      <span class="comment">//</span></div><div class="line"><a name="l00926"></a><span class="lineno">  926</span>&#160;      <a class="code" href="classXrdProofdProofServ.html">XrdProofdProofServ</a> *xps = 0;</div><div class="line"><a name="l00927"></a><span class="lineno">  927</span>&#160;      {  <a class="code" href="XrdSysToOuc_8h.html#a4ba18bedbb8a1a4367d57f49a4d773ce">XrdSysMutexHelper</a> mhp(<a class="code" href="classXrdProofdProofServMgr.html#ab90491b1fb65834e75bd46f6e09db87f">fMutex</a>);</div><div class="line"><a name="l00928"></a><span class="lineno">  928</span>&#160;         xps = <a class="code" href="classXrdProofdProofServMgr.html#a4a8be4f347170c279824168597e16caa">fSessions</a>.Find(key.c_str());</div><div class="line"><a name="l00929"></a><span class="lineno">  929</span>&#160;      }</div><div class="line"><a name="l00930"></a><span class="lineno">  930</span>&#160;</div><div class="line"><a name="l00931"></a><span class="lineno">  931</span>&#160;      <span class="keywordtype">bool</span> sessionalive = (<a class="code" href="classXrdProofdProofServMgr.html#af287fe3c85318d8fff5cfccac3dbb422">VerifySession</a>(ent-&gt;d_name) == 0) ? 1 : 0;</div><div class="line"><a name="l00932"></a><span class="lineno">  932</span>&#160;      <span class="keywordtype">bool</span> rmsession = 0;</div><div class="line"><a name="l00933"></a><span class="lineno">  933</span>&#160;      <span class="keywordflow">if</span> (xps) {</div><div class="line"><a name="l00934"></a><span class="lineno">  934</span>&#160;         <span class="keywordflow">if</span> (!xps-&gt;<a class="code" href="classXrdProofdProofServ.html#af67067c8b8f82303367b9307350c6e59">IsValid</a>() || !sessionalive) rmsession = 1;</div><div class="line"><a name="l00935"></a><span class="lineno">  935</span>&#160;      } <span class="keywordflow">else</span> {</div><div class="line"><a name="l00936"></a><span class="lineno">  936</span>&#160;         <span class="comment">// Session not yet registered, possibly starting</span></div><div class="line"><a name="l00937"></a><span class="lineno">  937</span>&#160;         <span class="comment">// Skips checks the admin file verification was OK</span></div><div class="line"><a name="l00938"></a><span class="lineno">  938</span>&#160;         <span class="keywordflow">if</span> (sessionalive) <span class="keywordflow">continue</span>;</div><div class="line"><a name="l00939"></a><span class="lineno">  939</span>&#160;         rmsession = 1;</div><div class="line"><a name="l00940"></a><span class="lineno">  940</span>&#160;      }</div><div class="line"><a name="l00941"></a><span class="lineno">  941</span>&#160;</div><div class="line"><a name="l00942"></a><span class="lineno">  942</span>&#160;      <span class="comment">// For backward compatibility we need to check the session version</span></div><div class="line"><a name="l00943"></a><span class="lineno">  943</span>&#160;      <span class="keywordtype">bool</span> oldvers = (xps &amp;&amp; xps-&gt;<a class="code" href="classXrdProofdProofServ.html#a18e4a17f4e9ef07f923b654e2d000148">ROOT</a>() &amp;&amp; xps-&gt;<a class="code" href="classXrdProofdProofServ.html#a18e4a17f4e9ef07f923b654e2d000148">ROOT</a>()-&gt;<a class="code" href="classXrdROOT.html#a9c3ee0a503928edaab2675dd4d6638b0">SrvProtVers</a>() &gt;= 18) ? 0 : 1;</div><div class="line"><a name="l00944"></a><span class="lineno">  944</span>&#160;</div><div class="line"><a name="l00945"></a><span class="lineno">  945</span>&#160;      <span class="comment">// If somebody is interested in this session, we give them some</span></div><div class="line"><a name="l00946"></a><span class="lineno">  946</span>&#160;      <span class="comment">// more time by skipping the connected clients check this time</span></div><div class="line"><a name="l00947"></a><span class="lineno">  947</span>&#160;      <span class="keywordtype">int</span> nc = -1;</div><div class="line"><a name="l00948"></a><span class="lineno">  948</span>&#160;      <span class="keywordflow">if</span> (!rmsession)</div><div class="line"><a name="l00949"></a><span class="lineno">  949</span>&#160;         rmsession = xps-&gt;<a class="code" href="classXrdProofdProofServ.html#afca1f3fc31dfb797c36d9b1d3593f1c4">CheckSession</a>(oldvers, <a class="code" href="classXrdProofdProofServMgr.html#a5543f787eb99df299babf19e0194835d">IsReconnecting</a>(),</div><div class="line"><a name="l00950"></a><span class="lineno">  950</span>&#160;                                       <a class="code" href="classXrdProofdProofServMgr.html#aa10fdb50ded6eb18fbe118b0f8407027">fShutdownOpt</a>, <a class="code" href="classXrdProofdProofServMgr.html#a4d745a9880deae66b89a3536e3d21cf0">fShutdownDelay</a>, <a class="code" href="classXrdProofdProofServMgr.html#a86cac591a5646811e38ff6a2477f4da7">fMgr</a>-&gt;<a class="code" href="classXrdProofdManager.html#a15d2e414e67bfc0cc4304605a6b509ff">ChangeOwn</a>(), nc);</div><div class="line"><a name="l00951"></a><span class="lineno">  951</span>&#160;</div><div class="line"><a name="l00952"></a><span class="lineno">  952</span>&#160;      <span class="comment">// Verify the session: this just sends a request to the session</span></div><div class="line"><a name="l00953"></a><span class="lineno">  953</span>&#160;      <span class="comment">// to touch the session file; all this will be done asynchronously;</span></div><div class="line"><a name="l00954"></a><span class="lineno">  954</span>&#160;      <span class="comment">// the result will be checked next time.</span></div><div class="line"><a name="l00955"></a><span class="lineno">  955</span>&#160;      <span class="comment">// We do not want further propagation at this stage.</span></div><div class="line"><a name="l00956"></a><span class="lineno">  956</span>&#160;      <span class="keywordflow">if</span> (!rmsession &amp;&amp; verify &amp;&amp; !oldvers) {</div><div class="line"><a name="l00957"></a><span class="lineno">  957</span>&#160;         <span class="keywordflow">if</span> (xps-&gt;<a class="code" href="classXrdProofdProofServ.html#a85bb976f3658a3544bdff4fa0d4cd1bf">VerifyProofServ</a>(0) != 0) {</div><div class="line"><a name="l00958"></a><span class="lineno">  958</span>&#160;            <span class="comment">// This means that the connection is already gone</span></div><div class="line"><a name="l00959"></a><span class="lineno">  959</span>&#160;            rmsession = 1;</div><div class="line"><a name="l00960"></a><span class="lineno">  960</span>&#160;         }</div><div class="line"><a name="l00961"></a><span class="lineno">  961</span>&#160;      }</div><div class="line"><a name="l00962"></a><span class="lineno">  962</span>&#160;      <a class="code" href="TGHtml_8h.html#ad5bb4a3d12fd54f29da2b924b29e652b">TRACE</a>(REQ, <span class="stringliteral">&quot;session: &quot;</span>&lt;&lt;ent-&gt;d_name&lt;&lt;<span class="stringliteral">&quot;; nc: &quot;</span>&lt;&lt;nc&lt;&lt;<span class="stringliteral">&quot;; rm: &quot;</span>&lt;&lt;rmsession);</div><div class="line"><a name="l00963"></a><span class="lineno">  963</span>&#160;      <span class="comment">// Remove the session, if needed</span></div><div class="line"><a name="l00964"></a><span class="lineno">  964</span>&#160;      <span class="keywordflow">if</span> (rmsession)</div><div class="line"><a name="l00965"></a><span class="lineno">  965</span>&#160;         <a class="code" href="classXrdProofdProofServMgr.html#a3afafd9e885f8c755801496783ae333e">MvSession</a>(ent-&gt;d_name);</div><div class="line"><a name="l00966"></a><span class="lineno">  966</span>&#160;   }</div><div class="line"><a name="l00967"></a><span class="lineno">  967</span>&#160;   <span class="comment">// Close the directory</span></div><div class="line"><a name="l00968"></a><span class="lineno">  968</span>&#160;   closedir(dir);</div><div class="line"><a name="l00969"></a><span class="lineno">  969</span>&#160;</div><div class="line"><a name="l00970"></a><span class="lineno">  970</span>&#160;   <span class="comment">// Done</span></div><div class="line"><a name="l00971"></a><span class="lineno">  971</span>&#160;   <span class="keywordflow">return</span> 0;</div><div class="line"><a name="l00972"></a><span class="lineno">  972</span>&#160;}</div><div class="line"><a name="l00973"></a><span class="lineno">  973</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00974"></a><span class="lineno">  974</span>&#160;<span class="comment">////////////////////////////////////////////////////////////////////////////////</span></div><div class="line"><a name="l00975"></a><span class="lineno">  975</span>&#160;<span class="comment">/// Go through the terminated sessions admin path and make sure sessions they</span></div><div class="line"><a name="l00976"></a><span class="lineno">  976</span>&#160;<span class="comment">/// are gone.</span></div><div class="line"><a name="l00977"></a><span class="lineno">  977</span>&#160;<span class="comment">/// Hard-kill those still alive.</span></div><div class="line"><a name="l00978"></a><span class="lineno">  978</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00979"></a><span class="lineno"><a class="line" href="classXrdProofdProofServMgr.html#a1a7f51b1a820604451001cd020f12130">  979</a></span>&#160;<span class="keywordtype">int</span> <a class="code" href="classXrdProofdProofServMgr.html#a1a7f51b1a820604451001cd020f12130">XrdProofdProofServMgr::CheckTerminatedSessions</a>()</div><div class="line"><a name="l00980"></a><span class="lineno">  980</span>&#160;{</div><div class="line"><a name="l00981"></a><span class="lineno">  981</span>&#160;   <a class="code" href="XrdProofdTrace_8h.html#a7c31822912a8d0dc9bfd544097b29e12">XPDLOC</a>(SMGR, <span class="stringliteral">&quot;ProofServMgr::CheckTerminatedSessions&quot;</span>)</div><div class="line"><a name="l00982"></a><span class="lineno">  982</span>&#160;</div><div class="line"><a name="l00983"></a><span class="lineno">  983</span>&#160;   <a class="code" href="TGHtml_8h.html#ad5bb4a3d12fd54f29da2b924b29e652b">TRACE</a>(REQ, <span class="stringliteral">&quot;checking terminated sessions ...&quot;</span>);</div><div class="line"><a name="l00984"></a><span class="lineno">  984</span>&#160;</div><div class="line"><a name="l00985"></a><span class="lineno">  985</span>&#160;   <span class="comment">// Open dir</span></div><div class="line"><a name="l00986"></a><span class="lineno">  986</span>&#160;   DIR *dir = opendir(<a class="code" href="classXrdProofdProofServMgr.html#a6d168474303d8b503001502f4f5ad306">fTermAdminPath</a>.c_str());</div><div class="line"><a name="l00987"></a><span class="lineno">  987</span>&#160;   <span class="keywordflow">if</span> (!dir) {</div><div class="line"><a name="l00988"></a><span class="lineno">  988</span>&#160;      <a class="code" href="TGHtml_8h.html#ad5bb4a3d12fd54f29da2b924b29e652b">TRACE</a>(XERR, <span class="stringliteral">&quot;cannot open dir &quot;</span>&lt;&lt;<a class="code" href="classXrdProofdProofServMgr.html#a6d168474303d8b503001502f4f5ad306">fTermAdminPath</a>&lt;&lt;<span class="stringliteral">&quot; ; error: &quot;</span>&lt;&lt;errno);</div><div class="line"><a name="l00989"></a><span class="lineno">  989</span>&#160;      <span class="keywordflow">return</span> -1;</div><div class="line"><a name="l00990"></a><span class="lineno">  990</span>&#160;   }</div><div class="line"><a name="l00991"></a><span class="lineno">  991</span>&#160;</div><div class="line"><a name="l00992"></a><span class="lineno">  992</span>&#160;   <span class="comment">// Scan the terminated sessions admin path</span></div><div class="line"><a name="l00993"></a><span class="lineno">  993</span>&#160;   <span class="keywordtype">int</span> now = -1;</div><div class="line"><a name="l00994"></a><span class="lineno">  994</span>&#160;   <span class="keyword">struct </span>dirent *ent = 0;</div><div class="line"><a name="l00995"></a><span class="lineno">  995</span>&#160;   <span class="keywordflow">while</span> ((ent = (<span class="keyword">struct</span> dirent *)readdir(dir))) {</div><div class="line"><a name="l00996"></a><span class="lineno">  996</span>&#160;      <span class="keywordflow">if</span> (!strncmp(ent-&gt;d_name, <span class="stringliteral">&quot;.&quot;</span>, 1) || !strncmp(ent-&gt;d_name, <span class="stringliteral">&quot;..&quot;</span>, 2)) <span class="keywordflow">continue</span>;</div><div class="line"><a name="l00997"></a><span class="lineno">  997</span>&#160;      <span class="comment">// Get the session instance (skip non-digital entries)</span></div><div class="line"><a name="l00998"></a><span class="lineno">  998</span>&#160;      XrdOucString rest, <a class="code" href="textangle_8C.html#a655a1c2a1ec25e8fcfb713772281e8f5">a</a>;</div><div class="line"><a name="l00999"></a><span class="lineno">  999</span>&#160;      <span class="keywordtype">int</span> pid = <a class="code" href="classXrdProofdAux.html#ae5801323b51316b641483f41dde67aa5">XrdProofdAux::ParsePidPath</a>(ent-&gt;d_name, rest, <a class="code" href="textangle_8C.html#a655a1c2a1ec25e8fcfb713772281e8f5">a</a>);</div><div class="line"><a name="l01000"></a><span class="lineno"> 1000</span>&#160;      <span class="keywordflow">if</span> (!<a class="code" href="XrdProofdPlatform_8h.html#a8862563dbade574514445160166dcd2d">XPD_LONGOK</a>(pid) || pid &lt;= 0) <span class="keywordflow">continue</span>;</div><div class="line"><a name="l01001"></a><span class="lineno"> 1001</span>&#160;</div><div class="line"><a name="l01002"></a><span class="lineno"> 1002</span>&#160;      <span class="comment">// Current time</span></div><div class="line"><a name="l01003"></a><span class="lineno"> 1003</span>&#160;      now = (now &gt; 0) ? now : time(0);</div><div class="line"><a name="l01004"></a><span class="lineno"> 1004</span>&#160;</div><div class="line"><a name="l01005"></a><span class="lineno"> 1005</span>&#160;      <span class="comment">// Full path</span></div><div class="line"><a name="l01006"></a><span class="lineno"> 1006</span>&#160;      XrdOucString path;</div><div class="line"><a name="l01007"></a><span class="lineno"> 1007</span>&#160;      <a class="code" href="XrdProofdAux_8h.html#a631cc8787af1a02d9e51c86117ae042e">XPDFORM</a>(path, <span class="stringliteral">&quot;%s/%s&quot;</span>, <a class="code" href="classXrdProofdProofServMgr.html#a6d168474303d8b503001502f4f5ad306">fTermAdminPath</a>.c_str(), ent-&gt;d_name);</div><div class="line"><a name="l01008"></a><span class="lineno"> 1008</span>&#160;</div><div class="line"><a name="l01009"></a><span class="lineno"> 1009</span>&#160;      <span class="comment">// Check termination time</span></div><div class="line"><a name="l01010"></a><span class="lineno"> 1010</span>&#160;      <span class="keyword">struct </span>stat st;</div><div class="line"><a name="l01011"></a><span class="lineno"> 1011</span>&#160;      <span class="keywordtype">int</span> rcst = stat(path.c_str(), &amp;st);</div><div class="line"><a name="l01012"></a><span class="lineno"> 1012</span>&#160;      <a class="code" href="TGHtml_8h.html#ad5bb4a3d12fd54f29da2b924b29e652b">TRACE</a>(DBG, pid&lt;&lt;<span class="stringliteral">&quot;: rcst: &quot;</span>&lt;&lt;rcst&lt;&lt;<span class="stringliteral">&quot;, now - mtime: &quot;</span>&lt;&lt;now - st.st_mtime&lt;&lt;<span class="stringliteral">&quot; secs&quot;</span>)</div><div class="line"><a name="l01013"></a><span class="lineno"> 1013</span>&#160;      <span class="keywordflow">if</span> ((now - st.st_mtime) &gt; <a class="code" href="classXrdProofdProofServMgr.html#a1c418ea2fa6ac9a8e6990506de51a5d6">fTerminationTimeOut</a> || rcst != 0) {</div><div class="line"><a name="l01014"></a><span class="lineno"> 1014</span>&#160;         <span class="comment">// Check if the process is still alive</span></div><div class="line"><a name="l01015"></a><span class="lineno"> 1015</span>&#160;         <span class="keywordflow">if</span> (<a class="code" href="classXrdProofdAux.html#a44927170bd725bb1476300e603bb9332">XrdProofdAux::VerifyProcessByID</a>(pid) != 0) {</div><div class="line"><a name="l01016"></a><span class="lineno"> 1016</span>&#160;            <span class="comment">// Send again an hard-kill signal</span></div><div class="line"><a name="l01017"></a><span class="lineno"> 1017</span>&#160;            <a class="code" href="classXrdProofSessionInfo.html">XrdProofSessionInfo</a> info(path.c_str());</div><div class="line"><a name="l01018"></a><span class="lineno"> 1018</span>&#160;            <a class="code" href="classXrdProofUI.html">XrdProofUI</a> ui;</div><div class="line"><a name="l01019"></a><span class="lineno"> 1019</span>&#160;            <a class="code" href="classXrdProofdAux.html#a0230423581c62e4fabf4fda6538fd4a7">XrdProofdAux::GetUserInfo</a>(info.fUser.c_str(), ui);</div><div class="line"><a name="l01020"></a><span class="lineno"> 1020</span>&#160;            <a class="code" href="classXrdProofdAux.html#a6b1d64972dcdae69de7af68d43fdd5be">XrdProofdAux::KillProcess</a>(pid, 1, ui, <a class="code" href="classXrdProofdProofServMgr.html#a86cac591a5646811e38ff6a2477f4da7">fMgr</a>-&gt;<a class="code" href="classXrdProofdManager.html#a15d2e414e67bfc0cc4304605a6b509ff">ChangeOwn</a>());</div><div class="line"><a name="l01021"></a><span class="lineno"> 1021</span>&#160;         } <span class="keywordflow">else</span> {</div><div class="line"><a name="l01022"></a><span class="lineno"> 1022</span>&#160;            <span class="comment">// Delete the entry</span></div><div class="line"><a name="l01023"></a><span class="lineno"> 1023</span>&#160;            <a class="code" href="classXrdProofdProofServMgr.html#a7efc0cc555297fe131bb6813d51ac957">RmSession</a>(ent-&gt;d_name);</div><div class="line"><a name="l01024"></a><span class="lineno"> 1024</span>&#160;         }</div><div class="line"><a name="l01025"></a><span class="lineno"> 1025</span>&#160;      }</div><div class="line"><a name="l01026"></a><span class="lineno"> 1026</span>&#160;   }</div><div class="line"><a name="l01027"></a><span class="lineno"> 1027</span>&#160;   <span class="comment">// Close the directory</span></div><div class="line"><a name="l01028"></a><span class="lineno"> 1028</span>&#160;   closedir(dir);</div><div class="line"><a name="l01029"></a><span class="lineno"> 1029</span>&#160;</div><div class="line"><a name="l01030"></a><span class="lineno"> 1030</span>&#160;   <span class="comment">// Done</span></div><div class="line"><a name="l01031"></a><span class="lineno"> 1031</span>&#160;   <span class="keywordflow">return</span> 0;</div><div class="line"><a name="l01032"></a><span class="lineno"> 1032</span>&#160;}</div><div class="line"><a name="l01033"></a><span class="lineno"> 1033</span>&#160;<span class="comment"></span></div><div class="line"><a name="l01034"></a><span class="lineno"> 1034</span>&#160;<span class="comment">////////////////////////////////////////////////////////////////////////////////</span></div><div class="line"><a name="l01035"></a><span class="lineno"> 1035</span>&#160;<span class="comment">/// Go through the sessions admin path and clean all sessions belonging to &#39;usr&#39;.</span></div><div class="line"><a name="l01036"></a><span class="lineno"> 1036</span>&#160;<span class="comment">/// Move those not responding in the terminated sessions admin path.</span></div><div class="line"><a name="l01037"></a><span class="lineno"> 1037</span>&#160;<span class="comment"></span></div><div class="line"><a name="l01038"></a><span class="lineno"><a class="line" href="classXrdProofdProofServMgr.html#afeb94f243e78b1fadae77fbaa52bcd39"> 1038</a></span>&#160;<span class="keywordtype">int</span> <a class="code" href="classXrdProofdProofServMgr.html#afeb94f243e78b1fadae77fbaa52bcd39">XrdProofdProofServMgr::CleanClientSessions</a>(<span class="keyword">const</span> <span class="keywordtype">char</span> *usr, <span class="keywordtype">int</span> srvtype)</div><div class="line"><a name="l01039"></a><span class="lineno"> 1039</span>&#160;{</div><div class="line"><a name="l01040"></a><span class="lineno"> 1040</span>&#160;   <a class="code" href="XrdProofdTrace_8h.html#a7c31822912a8d0dc9bfd544097b29e12">XPDLOC</a>(SMGR, <span class="stringliteral">&quot;ProofServMgr::CleanClientSessions&quot;</span>)</div><div class="line"><a name="l01041"></a><span class="lineno"> 1041</span>&#160;</div><div class="line"><a name="l01042"></a><span class="lineno"> 1042</span>&#160;   <a class="code" href="TGHtml_8h.html#ad5bb4a3d12fd54f29da2b924b29e652b">TRACE</a>(REQ, <span class="stringliteral">&quot;cleaning &quot;</span>&lt;&lt;usr&lt;&lt;<span class="stringliteral">&quot; ...&quot;</span>);</div><div class="line"><a name="l01043"></a><span class="lineno"> 1043</span>&#160;</div><div class="line"><a name="l01044"></a><span class="lineno"> 1044</span>&#160;   <span class="comment">// Check which client</span></div><div class="line"><a name="l01045"></a><span class="lineno"> 1045</span>&#160;   <span class="keywordtype">bool</span> all = (!usr || strlen(usr) &lt;= 0 || !strcmp(usr, <span class="stringliteral">&quot;all&quot;</span>)) ? 1 : 0;</div><div class="line"><a name="l01046"></a><span class="lineno"> 1046</span>&#160;</div><div class="line"><a name="l01047"></a><span class="lineno"> 1047</span>&#160;   <span class="comment">// Get user info</span></div><div class="line"><a name="l01048"></a><span class="lineno"> 1048</span>&#160;   <a class="code" href="classXrdProofUI.html">XrdProofUI</a> ui;</div><div class="line"><a name="l01049"></a><span class="lineno"> 1049</span>&#160;   <span class="keywordflow">if</span> (!all)</div><div class="line"><a name="l01050"></a><span class="lineno"> 1050</span>&#160;      <a class="code" href="classXrdProofdAux.html#a0230423581c62e4fabf4fda6538fd4a7">XrdProofdAux::GetUserInfo</a>(usr, ui);</div><div class="line"><a name="l01051"></a><span class="lineno"> 1051</span>&#160;   XrdOucString path, rest, key, <a class="code" href="textangle_8C.html#a655a1c2a1ec25e8fcfb713772281e8f5">a</a>;</div><div class="line"><a name="l01052"></a><span class="lineno"> 1052</span>&#160;</div><div class="line"><a name="l01053"></a><span class="lineno"> 1053</span>&#160;   <span class="comment">// We need lock to avoid session actions request while we are doing this</span></div><div class="line"><a name="l01054"></a><span class="lineno"> 1054</span>&#160;   <a class="code" href="XrdSysToOuc_8h.html#aef8b02ba04526e432427472092286bc5">XrdSysRecMutex</a> *mtx = 0;</div><div class="line"><a name="l01055"></a><span class="lineno"> 1055</span>&#160;   <span class="keywordflow">if</span> (all) {</div><div class="line"><a name="l01056"></a><span class="lineno"> 1056</span>&#160;      <span class="comment">// Lock us all</span></div><div class="line"><a name="l01057"></a><span class="lineno"> 1057</span>&#160;      mtx = &amp;<a class="code" href="classXrdProofdProofServMgr.html#ab90491b1fb65834e75bd46f6e09db87f">fMutex</a>;</div><div class="line"><a name="l01058"></a><span class="lineno"> 1058</span>&#160;   } <span class="keywordflow">else</span> {</div><div class="line"><a name="l01059"></a><span class="lineno"> 1059</span>&#160;      <span class="comment">// Lock the client</span></div><div class="line"><a name="l01060"></a><span class="lineno"> 1060</span>&#160;      <a class="code" href="classXrdProofdClient.html">XrdProofdClient</a> *<a class="code" href="RSha256_8hxx.html#a63f410abde93141c9013b7d3f3971738">c</a> = <a class="code" href="classXrdProofdProofServMgr.html#a86cac591a5646811e38ff6a2477f4da7">fMgr</a>-&gt;<a class="code" href="classXrdProofdManager.html#ac1aeacfd6edb71f9bc4ebe8e472d006b">ClientMgr</a>()-&gt;<a class="code" href="classXrdProofdClientMgr.html#a412036bb15d081a0b77deb6ff778d197">GetClient</a>(usr);</div><div class="line"><a name="l01061"></a><span class="lineno"> 1061</span>&#160;      <span class="keywordflow">if</span> (<a class="code" href="RSha256_8hxx.html#a63f410abde93141c9013b7d3f3971738">c</a>) mtx = <a class="code" href="RSha256_8hxx.html#a63f410abde93141c9013b7d3f3971738">c</a>-&gt;Mutex();</div><div class="line"><a name="l01062"></a><span class="lineno"> 1062</span>&#160;   }</div><div class="line"><a name="l01063"></a><span class="lineno"> 1063</span>&#160;</div><div class="line"><a name="l01064"></a><span class="lineno"> 1064</span>&#160;   std::list&lt;int&gt; tobedel;</div><div class="line"><a name="l01065"></a><span class="lineno"> 1065</span>&#160;   {  <a class="code" href="XrdSysToOuc_8h.html#a4ba18bedbb8a1a4367d57f49a4d773ce">XrdSysMutexHelper</a> mtxh(mtx);</div><div class="line"><a name="l01066"></a><span class="lineno"> 1066</span>&#160;</div><div class="line"><a name="l01067"></a><span class="lineno"> 1067</span>&#160;      <span class="comment">// Check the terminated session dir first</span></div><div class="line"><a name="l01068"></a><span class="lineno"> 1068</span>&#160;      DIR *dir = opendir(<a class="code" href="classXrdProofdProofServMgr.html#a6d168474303d8b503001502f4f5ad306">fTermAdminPath</a>.c_str());</div><div class="line"><a name="l01069"></a><span class="lineno"> 1069</span>&#160;      <span class="keywordflow">if</span> (!dir) {</div><div class="line"><a name="l01070"></a><span class="lineno"> 1070</span>&#160;         <a class="code" href="TGHtml_8h.html#ad5bb4a3d12fd54f29da2b924b29e652b">TRACE</a>(XERR, <span class="stringliteral">&quot;cannot open dir &quot;</span>&lt;&lt;<a class="code" href="classXrdProofdProofServMgr.html#a6d168474303d8b503001502f4f5ad306">fTermAdminPath</a>&lt;&lt;<span class="stringliteral">&quot; ; error: &quot;</span>&lt;&lt;errno);</div><div class="line"><a name="l01071"></a><span class="lineno"> 1071</span>&#160;      } <span class="keywordflow">else</span> {</div><div class="line"><a name="l01072"></a><span class="lineno"> 1072</span>&#160;         <span class="comment">// Go trough</span></div><div class="line"><a name="l01073"></a><span class="lineno"> 1073</span>&#160;         <span class="keyword">struct </span>dirent *ent = 0;</div><div class="line"><a name="l01074"></a><span class="lineno"> 1074</span>&#160;         <span class="keywordflow">while</span> ((ent = (<span class="keyword">struct</span> dirent *)readdir(dir))) {</div><div class="line"><a name="l01075"></a><span class="lineno"> 1075</span>&#160;            <span class="comment">// Skip basic entries</span></div><div class="line"><a name="l01076"></a><span class="lineno"> 1076</span>&#160;            <span class="keywordflow">if</span> (!strncmp(ent-&gt;d_name, <span class="stringliteral">&quot;.&quot;</span>, 1) || !strncmp(ent-&gt;d_name, <span class="stringliteral">&quot;..&quot;</span>, 2)) <span class="keywordflow">continue</span>;</div><div class="line"><a name="l01077"></a><span class="lineno"> 1077</span>&#160;            <span class="comment">// Get the session instance</span></div><div class="line"><a name="l01078"></a><span class="lineno"> 1078</span>&#160;            <span class="keywordtype">int</span> pid = <a class="code" href="classXrdProofdAux.html#ae5801323b51316b641483f41dde67aa5">XrdProofdAux::ParsePidPath</a>(ent-&gt;d_name, rest, <a class="code" href="textangle_8C.html#a655a1c2a1ec25e8fcfb713772281e8f5">a</a>);</div><div class="line"><a name="l01079"></a><span class="lineno"> 1079</span>&#160;            <span class="keywordflow">if</span> (!<a class="code" href="XrdProofdPlatform_8h.html#a8862563dbade574514445160166dcd2d">XPD_LONGOK</a>(pid) || pid &lt;= 0) <span class="keywordflow">continue</span>;</div><div class="line"><a name="l01080"></a><span class="lineno"> 1080</span>&#160;            <span class="comment">// Read info from file and check that we are interested in this session</span></div><div class="line"><a name="l01081"></a><span class="lineno"> 1081</span>&#160;            <a class="code" href="XrdProofdAux_8h.html#a631cc8787af1a02d9e51c86117ae042e">XPDFORM</a>(path, <span class="stringliteral">&quot;%s/%s&quot;</span>, <a class="code" href="classXrdProofdProofServMgr.html#a6d168474303d8b503001502f4f5ad306">fTermAdminPath</a>.c_str(), ent-&gt;d_name);</div><div class="line"><a name="l01082"></a><span class="lineno"> 1082</span>&#160;            <a class="code" href="classXrdProofSessionInfo.html">XrdProofSessionInfo</a> info(path.c_str());</div><div class="line"><a name="l01083"></a><span class="lineno"> 1083</span>&#160;            <span class="comment">// Check user</span></div><div class="line"><a name="l01084"></a><span class="lineno"> 1084</span>&#160;            <span class="keywordflow">if</span> (!all &amp;&amp; info.fUser != usr) <span class="keywordflow">continue</span>;</div><div class="line"><a name="l01085"></a><span class="lineno"> 1085</span>&#160;            <span class="comment">// Check server type</span></div><div class="line"><a name="l01086"></a><span class="lineno"> 1086</span>&#160;            <span class="keywordflow">if</span> (srvtype != <a class="code" href="XProofProtocol_8h.html#a727fb77180370df43315288005e23b99">kXPD_AnyServer</a> &amp;&amp; info.fSrvType != srvtype) <span class="keywordflow">continue</span>;</div><div class="line"><a name="l01087"></a><span class="lineno"> 1087</span>&#160;            <span class="comment">// Refresh user info, if needed</span></div><div class="line"><a name="l01088"></a><span class="lineno"> 1088</span>&#160;            <span class="keywordflow">if</span> (all)</div><div class="line"><a name="l01089"></a><span class="lineno"> 1089</span>&#160;               <a class="code" href="classXrdProofdAux.html#a0230423581c62e4fabf4fda6538fd4a7">XrdProofdAux::GetUserInfo</a>(info.fUser.c_str(), ui);</div><div class="line"><a name="l01090"></a><span class="lineno"> 1090</span>&#160;            <span class="comment">// Check if the process is still alive</span></div><div class="line"><a name="l01091"></a><span class="lineno"> 1091</span>&#160;            <span class="keywordflow">if</span> (<a class="code" href="classXrdProofdAux.html#a44927170bd725bb1476300e603bb9332">XrdProofdAux::VerifyProcessByID</a>(pid) != 0) {</div><div class="line"><a name="l01092"></a><span class="lineno"> 1092</span>&#160;               <span class="comment">// Send a hard-kill signal</span></div><div class="line"><a name="l01093"></a><span class="lineno"> 1093</span>&#160;               <a class="code" href="classXrdProofdAux.html#a6b1d64972dcdae69de7af68d43fdd5be">XrdProofdAux::KillProcess</a>(pid, 1, ui, <a class="code" href="classXrdProofdProofServMgr.html#a86cac591a5646811e38ff6a2477f4da7">fMgr</a>-&gt;<a class="code" href="classXrdProofdManager.html#a15d2e414e67bfc0cc4304605a6b509ff">ChangeOwn</a>());</div><div class="line"><a name="l01094"></a><span class="lineno"> 1094</span>&#160;            } <span class="keywordflow">else</span> {</div><div class="line"><a name="l01095"></a><span class="lineno"> 1095</span>&#160;               <span class="comment">// Delete the entry</span></div><div class="line"><a name="l01096"></a><span class="lineno"> 1096</span>&#160;               <a class="code" href="classXrdProofdProofServMgr.html#a7efc0cc555297fe131bb6813d51ac957">RmSession</a>(ent-&gt;d_name);</div><div class="line"><a name="l01097"></a><span class="lineno"> 1097</span>&#160;            }</div><div class="line"><a name="l01098"></a><span class="lineno"> 1098</span>&#160;         }</div><div class="line"><a name="l01099"></a><span class="lineno"> 1099</span>&#160;         <span class="comment">// Close the directory</span></div><div class="line"><a name="l01100"></a><span class="lineno"> 1100</span>&#160;         closedir(dir);</div><div class="line"><a name="l01101"></a><span class="lineno"> 1101</span>&#160;      }</div><div class="line"><a name="l01102"></a><span class="lineno"> 1102</span>&#160;</div><div class="line"><a name="l01103"></a><span class="lineno"> 1103</span>&#160;      <span class="comment">// Check the active session dir now</span></div><div class="line"><a name="l01104"></a><span class="lineno"> 1104</span>&#160;      dir = opendir(<a class="code" href="classXrdProofdProofServMgr.html#aa7d4e4ec33be14cd70bbc3595332736e">fActiAdminPath</a>.c_str());</div><div class="line"><a name="l01105"></a><span class="lineno"> 1105</span>&#160;      <span class="keywordflow">if</span> (!dir) {</div><div class="line"><a name="l01106"></a><span class="lineno"> 1106</span>&#160;         <a class="code" href="TGHtml_8h.html#ad5bb4a3d12fd54f29da2b924b29e652b">TRACE</a>(XERR, <span class="stringliteral">&quot;cannot open dir &quot;</span>&lt;&lt;<a class="code" href="classXrdProofdProofServMgr.html#aa7d4e4ec33be14cd70bbc3595332736e">fActiAdminPath</a>&lt;&lt;<span class="stringliteral">&quot; ; error: &quot;</span>&lt;&lt;errno);</div><div class="line"><a name="l01107"></a><span class="lineno"> 1107</span>&#160;         <span class="keywordflow">return</span> -1;</div><div class="line"><a name="l01108"></a><span class="lineno"> 1108</span>&#160;      }</div><div class="line"><a name="l01109"></a><span class="lineno"> 1109</span>&#160;</div><div class="line"><a name="l01110"></a><span class="lineno"> 1110</span>&#160;      <span class="comment">// Scan the active sessions admin path</span></div><div class="line"><a name="l01111"></a><span class="lineno"> 1111</span>&#160;      <span class="keyword">struct </span>dirent *ent = 0;</div><div class="line"><a name="l01112"></a><span class="lineno"> 1112</span>&#160;      <span class="keywordflow">while</span> ((ent = (<span class="keyword">struct</span> dirent *)readdir(dir))) {</div><div class="line"><a name="l01113"></a><span class="lineno"> 1113</span>&#160;         <span class="comment">// Skip basic entries</span></div><div class="line"><a name="l01114"></a><span class="lineno"> 1114</span>&#160;         <span class="keywordflow">if</span> (!strncmp(ent-&gt;d_name, <span class="stringliteral">&quot;.&quot;</span>, 1) || !strncmp(ent-&gt;d_name, <span class="stringliteral">&quot;..&quot;</span>, 2)) <span class="keywordflow">continue</span>;</div><div class="line"><a name="l01115"></a><span class="lineno"> 1115</span>&#160;         <span class="comment">// Get the session instance</span></div><div class="line"><a name="l01116"></a><span class="lineno"> 1116</span>&#160;         <span class="keywordtype">int</span> pid = <a class="code" href="classXrdProofdAux.html#ae5801323b51316b641483f41dde67aa5">XrdProofdAux::ParsePidPath</a>(ent-&gt;d_name, rest, <a class="code" href="textangle_8C.html#a655a1c2a1ec25e8fcfb713772281e8f5">a</a>);</div><div class="line"><a name="l01117"></a><span class="lineno"> 1117</span>&#160;         <span class="keywordflow">if</span> (<a class="code" href="textangle_8C.html#a655a1c2a1ec25e8fcfb713772281e8f5">a</a> == <span class="stringliteral">&quot;status&quot;</span>) <span class="keywordflow">continue</span>;</div><div class="line"><a name="l01118"></a><span class="lineno"> 1118</span>&#160;         <span class="keywordflow">if</span> (!<a class="code" href="XrdProofdPlatform_8h.html#a8862563dbade574514445160166dcd2d">XPD_LONGOK</a>(pid) || pid &lt;= 0) <span class="keywordflow">continue</span>;</div><div class="line"><a name="l01119"></a><span class="lineno"> 1119</span>&#160;         <span class="comment">// Read info from file and check that we are interested in this session</span></div><div class="line"><a name="l01120"></a><span class="lineno"> 1120</span>&#160;         <a class="code" href="XrdProofdAux_8h.html#a631cc8787af1a02d9e51c86117ae042e">XPDFORM</a>(path, <span class="stringliteral">&quot;%s/%s&quot;</span>, <a class="code" href="classXrdProofdProofServMgr.html#aa7d4e4ec33be14cd70bbc3595332736e">fActiAdminPath</a>.c_str(), ent-&gt;d_name);</div><div class="line"><a name="l01121"></a><span class="lineno"> 1121</span>&#160;         <a class="code" href="classXrdProofSessionInfo.html">XrdProofSessionInfo</a> info(path.c_str());</div><div class="line"><a name="l01122"></a><span class="lineno"> 1122</span>&#160;         <span class="keywordflow">if</span> (!all &amp;&amp; info.fUser != usr) <span class="keywordflow">continue</span>;</div><div class="line"><a name="l01123"></a><span class="lineno"> 1123</span>&#160;         <span class="comment">// Check server type</span></div><div class="line"><a name="l01124"></a><span class="lineno"> 1124</span>&#160;         <span class="keywordflow">if</span> (srvtype != <a class="code" href="XProofProtocol_8h.html#a727fb77180370df43315288005e23b99">kXPD_AnyServer</a> &amp;&amp; info.fSrvType != srvtype) <span class="keywordflow">continue</span>;</div><div class="line"><a name="l01125"></a><span class="lineno"> 1125</span>&#160;         <span class="comment">// Refresh user info, if needed</span></div><div class="line"><a name="l01126"></a><span class="lineno"> 1126</span>&#160;         <span class="keywordflow">if</span> (all)</div><div class="line"><a name="l01127"></a><span class="lineno"> 1127</span>&#160;            <a class="code" href="classXrdProofdAux.html#a0230423581c62e4fabf4fda6538fd4a7">XrdProofdAux::GetUserInfo</a>(info.fUser.c_str(), ui);</div><div class="line"><a name="l01128"></a><span class="lineno"> 1128</span>&#160;         <span class="comment">// Check if the process is still alive</span></div><div class="line"><a name="l01129"></a><span class="lineno"> 1129</span>&#160;         <span class="keywordflow">if</span> (<a class="code" href="classXrdProofdAux.html#a44927170bd725bb1476300e603bb9332">XrdProofdAux::VerifyProcessByID</a>(pid) != 0) {</div><div class="line"><a name="l01130"></a><span class="lineno"> 1130</span>&#160;            <span class="comment">// We will remove this later</span></div><div class="line"><a name="l01131"></a><span class="lineno"> 1131</span>&#160;            tobedel.push_back(pid);</div><div class="line"><a name="l01132"></a><span class="lineno"> 1132</span>&#160;            <span class="comment">// Send a termination signal</span></div><div class="line"><a name="l01133"></a><span class="lineno"> 1133</span>&#160;            <a class="code" href="classXrdProofdAux.html#a6b1d64972dcdae69de7af68d43fdd5be">XrdProofdAux::KillProcess</a>(pid, 0, ui, <a class="code" href="classXrdProofdProofServMgr.html#a86cac591a5646811e38ff6a2477f4da7">fMgr</a>-&gt;<a class="code" href="classXrdProofdManager.html#a15d2e414e67bfc0cc4304605a6b509ff">ChangeOwn</a>());</div><div class="line"><a name="l01134"></a><span class="lineno"> 1134</span>&#160;         }</div><div class="line"><a name="l01135"></a><span class="lineno"> 1135</span>&#160;         <span class="comment">// Flag as terminated</span></div><div class="line"><a name="l01136"></a><span class="lineno"> 1136</span>&#160;         <a class="code" href="classXrdProofdProofServMgr.html#a3afafd9e885f8c755801496783ae333e">MvSession</a>(ent-&gt;d_name);</div><div class="line"><a name="l01137"></a><span class="lineno"> 1137</span>&#160;      }</div><div class="line"><a name="l01138"></a><span class="lineno"> 1138</span>&#160;      <span class="comment">// Close the directory</span></div><div class="line"><a name="l01139"></a><span class="lineno"> 1139</span>&#160;      closedir(dir);</div><div class="line"><a name="l01140"></a><span class="lineno"> 1140</span>&#160;   }</div><div class="line"><a name="l01141"></a><span class="lineno"> 1141</span>&#160;</div><div class="line"><a name="l01142"></a><span class="lineno"> 1142</span>&#160;   <span class="comment">// Cleanup fSessions</span></div><div class="line"><a name="l01143"></a><span class="lineno"> 1143</span>&#160;   std::list&lt;int&gt;::iterator ii = tobedel.begin();</div><div class="line"><a name="l01144"></a><span class="lineno"> 1144</span>&#160;   <span class="keywordflow">while</span> (ii != tobedel.end()) {</div><div class="line"><a name="l01145"></a><span class="lineno"> 1145</span>&#160;      <a class="code" href="XrdProofdAux_8h.html#a631cc8787af1a02d9e51c86117ae042e">XPDFORM</a>(key, <span class="stringliteral">&quot;%d&quot;</span>, *ii);</div><div class="line"><a name="l01146"></a><span class="lineno"> 1146</span>&#160;      <a class="code" href="XrdSysToOuc_8h.html#a4ba18bedbb8a1a4367d57f49a4d773ce">XrdSysMutexHelper</a> mhp(<a class="code" href="classXrdProofdProofServMgr.html#ab90491b1fb65834e75bd46f6e09db87f">fMutex</a>);</div><div class="line"><a name="l01147"></a><span class="lineno"> 1147</span>&#160;      <a class="code" href="classXrdProofdProofServ.html">XrdProofdProofServ</a> *xps = <a class="code" href="classXrdProofdProofServMgr.html#a4a8be4f347170c279824168597e16caa">fSessions</a>.Find(key.c_str());</div><div class="line"><a name="l01148"></a><span class="lineno"> 1148</span>&#160;      <span class="keywordtype">bool</span> active = 0;</div><div class="line"><a name="l01149"></a><span class="lineno"> 1149</span>&#160;      std::list&lt;XrdProofdProofServ *&gt;::iterator ixps = <a class="code" href="classXrdProofdProofServMgr.html#a909fb1d3452ad38d9cc83782f777d07c">fActiveSessions</a>.begin();</div><div class="line"><a name="l01150"></a><span class="lineno"> 1150</span>&#160;      <span class="keywordflow">while</span> (ixps != <a class="code" href="classXrdProofdProofServMgr.html#a909fb1d3452ad38d9cc83782f777d07c">fActiveSessions</a>.end()) {</div><div class="line"><a name="l01151"></a><span class="lineno"> 1151</span>&#160;         <span class="keywordflow">if</span> (*ixps == xps) {</div><div class="line"><a name="l01152"></a><span class="lineno"> 1152</span>&#160;            active = 1;</div><div class="line"><a name="l01153"></a><span class="lineno"> 1153</span>&#160;            <span class="keywordflow">break</span>;</div><div class="line"><a name="l01154"></a><span class="lineno"> 1154</span>&#160;         }</div><div class="line"><a name="l01155"></a><span class="lineno"> 1155</span>&#160;         ++ixps;</div><div class="line"><a name="l01156"></a><span class="lineno"> 1156</span>&#160;      }</div><div class="line"><a name="l01157"></a><span class="lineno"> 1157</span>&#160;      <span class="keywordflow">if</span> (!active) <a class="code" href="classXrdProofdProofServMgr.html#a4a8be4f347170c279824168597e16caa">fSessions</a>.Del(key.c_str());</div><div class="line"><a name="l01158"></a><span class="lineno"> 1158</span>&#160;      ++ii;</div><div class="line"><a name="l01159"></a><span class="lineno"> 1159</span>&#160;   }</div><div class="line"><a name="l01160"></a><span class="lineno"> 1160</span>&#160;</div><div class="line"><a name="l01161"></a><span class="lineno"> 1161</span>&#160;   <span class="comment">// Done</span></div><div class="line"><a name="l01162"></a><span class="lineno"> 1162</span>&#160;   <span class="keywordflow">return</span> 0;</div><div class="line"><a name="l01163"></a><span class="lineno"> 1163</span>&#160;}</div><div class="line"><a name="l01164"></a><span class="lineno"> 1164</span>&#160;<span class="comment"></span></div><div class="line"><a name="l01165"></a><span class="lineno"> 1165</span>&#160;<span class="comment">////////////////////////////////////////////////////////////////////////////////</span></div><div class="line"><a name="l01166"></a><span class="lineno"> 1166</span>&#160;<span class="comment">/// Register directives for configuration</span></div><div class="line"><a name="l01167"></a><span class="lineno"> 1167</span>&#160;<span class="comment"></span></div><div class="line"><a name="l01168"></a><span class="lineno"><a class="line" href="classXrdProofdProofServMgr.html#ab518387c7aac71be2a03214b83f10e71"> 1168</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="classXrdProofdProofServMgr.html#ab518387c7aac71be2a03214b83f10e71">XrdProofdProofServMgr::RegisterDirectives</a>()</div><div class="line"><a name="l01169"></a><span class="lineno"> 1169</span>&#160;{</div><div class="line"><a name="l01170"></a><span class="lineno"> 1170</span>&#160;   <span class="comment">// Register special config directives</span></div><div class="line"><a name="l01171"></a><span class="lineno"> 1171</span>&#160;   <a class="code" href="classXrdProofdConfig.html#a475cd09abba63646d77f00767c34552a">Register</a>(<span class="stringliteral">&quot;proofservmgr&quot;</span>, <span class="keyword">new</span> <a class="code" href="classXrdProofdDirective.html">XrdProofdDirective</a>(<span class="stringliteral">&quot;proofservmgr&quot;</span>, <span class="keyword">this</span>, &amp;<a class="code" href="XrdProofdAux_8h.html#aad0932bed13278acd82d9a710a3b5393">DoDirectiveClass</a>));</div><div class="line"><a name="l01172"></a><span class="lineno"> 1172</span>&#160;   <a class="code" href="classXrdProofdConfig.html#a475cd09abba63646d77f00767c34552a">Register</a>(<span class="stringliteral">&quot;putenv&quot;</span>, <span class="keyword">new</span> <a class="code" href="classXrdProofdDirective.html">XrdProofdDirective</a>(<span class="stringliteral">&quot;putenv&quot;</span>, <span class="keyword">this</span>, &amp;<a class="code" href="XrdProofdAux_8h.html#aad0932bed13278acd82d9a710a3b5393">DoDirectiveClass</a>));</div><div class="line"><a name="l01173"></a><span class="lineno"> 1173</span>&#160;   <a class="code" href="classXrdProofdConfig.html#a475cd09abba63646d77f00767c34552a">Register</a>(<span class="stringliteral">&quot;putrc&quot;</span>, <span class="keyword">new</span> <a class="code" href="classXrdProofdDirective.html">XrdProofdDirective</a>(<span class="stringliteral">&quot;putrc&quot;</span>, <span class="keyword">this</span>, &amp;<a class="code" href="XrdProofdAux_8h.html#aad0932bed13278acd82d9a710a3b5393">DoDirectiveClass</a>));</div><div class="line"><a name="l01174"></a><span class="lineno"> 1174</span>&#160;   <a class="code" href="classXrdProofdConfig.html#a475cd09abba63646d77f00767c34552a">Register</a>(<span class="stringliteral">&quot;shutdown&quot;</span>, <span class="keyword">new</span> <a class="code" href="classXrdProofdDirective.html">XrdProofdDirective</a>(<span class="stringliteral">&quot;shutdown&quot;</span>, <span class="keyword">this</span>, &amp;<a class="code" href="XrdProofdAux_8h.html#aad0932bed13278acd82d9a710a3b5393">DoDirectiveClass</a>));</div><div class="line"><a name="l01175"></a><span class="lineno"> 1175</span>&#160;   <span class="comment">// Register config directives for ints</span></div><div class="line"><a name="l01176"></a><span class="lineno"> 1176</span>&#160;   <a class="code" href="classXrdProofdConfig.html#a475cd09abba63646d77f00767c34552a">Register</a>(<span class="stringliteral">&quot;intwait&quot;</span>,</div><div class="line"><a name="l01177"></a><span class="lineno"> 1177</span>&#160;                  <span class="keyword">new</span> <a class="code" href="classXrdProofdDirective.html">XrdProofdDirective</a>(<span class="stringliteral">&quot;intwait&quot;</span>, (<span class="keywordtype">void</span> *)&amp;<a class="code" href="classXrdProofdProofServMgr.html#a3d7506e0fff1042ca99d77c2ad432f19">fInternalWait</a>, &amp;<a class="code" href="XrdProofdAux_8h.html#abfb9e40e3aca19fd83a379e1e1af81bd">DoDirectiveInt</a>));</div><div class="line"><a name="l01178"></a><span class="lineno"> 1178</span>&#160;   <a class="code" href="classXrdProofdConfig.html#a475cd09abba63646d77f00767c34552a">Register</a>(<span class="stringliteral">&quot;reconnto&quot;</span>,</div><div class="line"><a name="l01179"></a><span class="lineno"> 1179</span>&#160;                  <span class="keyword">new</span> <a class="code" href="classXrdProofdDirective.html">XrdProofdDirective</a>(<span class="stringliteral">&quot;reconnto&quot;</span>, (<span class="keywordtype">void</span> *)&amp;<a class="code" href="classXrdProofdProofServMgr.html#a6dea65be9cfafa463f8d8200e3d02ecc">fReconnectTimeOut</a>, &amp;<a class="code" href="XrdProofdAux_8h.html#abfb9e40e3aca19fd83a379e1e1af81bd">DoDirectiveInt</a>));</div><div class="line"><a name="l01180"></a><span class="lineno"> 1180</span>&#160;   <span class="comment">// Register config directives for strings</span></div><div class="line"><a name="l01181"></a><span class="lineno"> 1181</span>&#160;   <a class="code" href="classXrdProofdConfig.html#a475cd09abba63646d77f00767c34552a">Register</a>(<span class="stringliteral">&quot;proofplugin&quot;</span>,</div><div class="line"><a name="l01182"></a><span class="lineno"> 1182</span>&#160;                  <span class="keyword">new</span> <a class="code" href="classXrdProofdDirective.html">XrdProofdDirective</a>(<span class="stringliteral">&quot;proofplugin&quot;</span>, (<span class="keywordtype">void</span> *)&amp;<a class="code" href="classXrdProofdProofServMgr.html#ad8126ec253b738adc2ae64a95354edec">fProofPlugin</a>, &amp;<a class="code" href="XrdProofdAux_8h.html#a106fc173319cff3b69ea8182cd223a3c">DoDirectiveString</a>));</div><div class="line"><a name="l01183"></a><span class="lineno"> 1183</span>&#160;   <a class="code" href="classXrdProofdConfig.html#a475cd09abba63646d77f00767c34552a">Register</a>(<span class="stringliteral">&quot;proofservparents&quot;</span>,</div><div class="line"><a name="l01184"></a><span class="lineno"> 1184</span>&#160;                  <span class="keyword">new</span> <a class="code" href="classXrdProofdDirective.html">XrdProofdDirective</a>(<span class="stringliteral">&quot;proofservparents&quot;</span>, (<span class="keywordtype">void</span> *)&amp;<a class="code" href="classXrdProofdProofServMgr.html#a0dab770ad59dea7bbfceb63d345af63b">fParentExecs</a>, &amp;<a class="code" href="XrdProofdAux_8h.html#a106fc173319cff3b69ea8182cd223a3c">DoDirectiveString</a>));</div><div class="line"><a name="l01185"></a><span class="lineno"> 1185</span>&#160;}</div><div class="line"><a name="l01186"></a><span class="lineno"> 1186</span>&#160;<span class="comment"></span></div><div class="line"><a name="l01187"></a><span class="lineno"> 1187</span>&#160;<span class="comment">////////////////////////////////////////////////////////////////////////////////</span></div><div class="line"><a name="l01188"></a><span class="lineno"> 1188</span>&#160;<span class="comment">/// Update the priorities of the active sessions.</span></div><div class="line"><a name="l01189"></a><span class="lineno"> 1189</span>&#160;<span class="comment"></span></div><div class="line"><a name="l01190"></a><span class="lineno"><a class="line" href="classXrdProofdProofServMgr.html#a8952ab10fb646580a5defde06754a38a"> 1190</a></span>&#160;<span class="keywordtype">int</span> <a class="code" href="classXrdProofdProofServMgr.html#a8952ab10fb646580a5defde06754a38a">XrdProofdProofServMgr::DoDirective</a>(<a class="code" href="classXrdProofdDirective.html">XrdProofdDirective</a> *<a class="code" href="RSha256_8hxx.html#a23b5b0a85bf5762c93a855f40c0343ce">d</a>,</div><div class="line"><a name="l01191"></a><span class="lineno"> 1191</span>&#160;                                       <span class="keywordtype">char</span> *val, XrdOucStream *cfg, <span class="keywordtype">bool</span> rcf)</div><div class="line"><a name="l01192"></a><span class="lineno"> 1192</span>&#160;{</div><div class="line"><a name="l01193"></a><span class="lineno"> 1193</span>&#160;   <a class="code" href="XrdProofdTrace_8h.html#a7c31822912a8d0dc9bfd544097b29e12">XPDLOC</a>(SMGR, <span class="stringliteral">&quot;ProofServMgr::DoDirective&quot;</span>)</div><div class="line"><a name="l01194"></a><span class="lineno"> 1194</span>&#160;</div><div class="line"><a name="l01195"></a><span class="lineno"> 1195</span>&#160;   <span class="keywordflow">if</span> (!<a class="code" href="RSha256_8hxx.html#a23b5b0a85bf5762c93a855f40c0343ce">d</a>)</div><div class="line"><a name="l01196"></a><span class="lineno"> 1196</span>&#160;      <span class="comment">// undefined inputs</span></div><div class="line"><a name="l01197"></a><span class="lineno"> 1197</span>&#160;      <span class="keywordflow">return</span> -1;</div><div class="line"><a name="l01198"></a><span class="lineno"> 1198</span>&#160;</div><div class="line"><a name="l01199"></a><span class="lineno"> 1199</span>&#160;   <span class="keywordflow">if</span> (<a class="code" href="RSha256_8hxx.html#a23b5b0a85bf5762c93a855f40c0343ce">d</a>-&gt;fName == <span class="stringliteral">&quot;proofservmgr&quot;</span>) {</div><div class="line"><a name="l01200"></a><span class="lineno"> 1200</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="classXrdProofdProofServMgr.html#a11b1baa66c0e286dd1839917ab500656">DoDirectiveProofServMgr</a>(val, cfg, rcf);</div><div class="line"><a name="l01201"></a><span class="lineno"> 1201</span>&#160;   } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="RSha256_8hxx.html#a23b5b0a85bf5762c93a855f40c0343ce">d</a>-&gt;fName == <span class="stringliteral">&quot;putenv&quot;</span>) {</div><div class="line"><a name="l01202"></a><span class="lineno"> 1202</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="classXrdProofdProofServMgr.html#a94600aafa5d2398a65a971f1189e9423">DoDirectivePutEnv</a>(val, cfg, rcf);</div><div class="line"><a name="l01203"></a><span class="lineno"> 1203</span>&#160;   } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="RSha256_8hxx.html#a23b5b0a85bf5762c93a855f40c0343ce">d</a>-&gt;fName == <span class="stringliteral">&quot;putrc&quot;</span>) {</div><div class="line"><a name="l01204"></a><span class="lineno"> 1204</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="classXrdProofdProofServMgr.html#a2a5e88f26472a0d1fde187373a1d7831">DoDirectivePutRc</a>(val, cfg, rcf);</div><div class="line"><a name="l01205"></a><span class="lineno"> 1205</span>&#160;   } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="RSha256_8hxx.html#a23b5b0a85bf5762c93a855f40c0343ce">d</a>-&gt;fName == <span class="stringliteral">&quot;shutdown&quot;</span>) {</div><div class="line"><a name="l01206"></a><span class="lineno"> 1206</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="classXrdProofdProofServMgr.html#a7c23aca8c6f65bbd37ef356a3cdf7bef">DoDirectiveShutdown</a>(val, cfg, rcf);</div><div class="line"><a name="l01207"></a><span class="lineno"> 1207</span>&#160;   }</div><div class="line"><a name="l01208"></a><span class="lineno"> 1208</span>&#160;   <a class="code" href="TGHtml_8h.html#ad5bb4a3d12fd54f29da2b924b29e652b">TRACE</a>(XERR,<span class="stringliteral">&quot;unknown directive: &quot;</span>&lt;&lt;<a class="code" href="RSha256_8hxx.html#a23b5b0a85bf5762c93a855f40c0343ce">d</a>-&gt;fName);</div><div class="line"><a name="l01209"></a><span class="lineno"> 1209</span>&#160;   <span class="keywordflow">return</span> -1;</div><div class="line"><a name="l01210"></a><span class="lineno"> 1210</span>&#160;}</div><div class="line"><a name="l01211"></a><span class="lineno"> 1211</span>&#160;<span class="comment"></span></div><div class="line"><a name="l01212"></a><span class="lineno"> 1212</span>&#160;<span class="comment">////////////////////////////////////////////////////////////////////////////////</span></div><div class="line"><a name="l01213"></a><span class="lineno"> 1213</span>&#160;<span class="comment">/// Process &#39;proofswrvmgr&#39; directive</span></div><div class="line"><a name="l01214"></a><span class="lineno"> 1214</span>&#160;<span class="comment">/// eg: xpd.proofswrvmgr checkfq:120 termto:100 verifyto:5 recoverto:20</span></div><div class="line"><a name="l01215"></a><span class="lineno"> 1215</span>&#160;<span class="comment"></span></div><div class="line"><a name="l01216"></a><span class="lineno"><a class="line" href="classXrdProofdProofServMgr.html#a11b1baa66c0e286dd1839917ab500656"> 1216</a></span>&#160;<span class="keywordtype">int</span> <a class="code" href="classXrdProofdProofServMgr.html#a11b1baa66c0e286dd1839917ab500656">XrdProofdProofServMgr::DoDirectiveProofServMgr</a>(<span class="keywordtype">char</span> *val, XrdOucStream *cfg, <span class="keywordtype">bool</span> rcf)</div><div class="line"><a name="l01217"></a><span class="lineno"> 1217</span>&#160;{</div><div class="line"><a name="l01218"></a><span class="lineno"> 1218</span>&#160;   <a class="code" href="XrdProofdTrace_8h.html#a7c31822912a8d0dc9bfd544097b29e12">XPDLOC</a>(SMGR, <span class="stringliteral">&quot;ProofServMgr::DoDirectiveProofServMgr&quot;</span>)</div><div class="line"><a name="l01219"></a><span class="lineno"> 1219</span>&#160;</div><div class="line"><a name="l01220"></a><span class="lineno"> 1220</span>&#160;   <span class="keywordflow">if</span> (!val || !cfg)</div><div class="line"><a name="l01221"></a><span class="lineno"> 1221</span>&#160;      <span class="comment">// undefined inputs</span></div><div class="line"><a name="l01222"></a><span class="lineno"> 1222</span>&#160;      <span class="keywordflow">return</span> -1;</div><div class="line"><a name="l01223"></a><span class="lineno"> 1223</span>&#160;</div><div class="line"><a name="l01224"></a><span class="lineno"> 1224</span>&#160;   <span class="keywordflow">if</span> (rcf)</div><div class="line"><a name="l01225"></a><span class="lineno"> 1225</span>&#160;      <span class="comment">// Do not reconfigure this (need to check what happens with the cron thread ...</span></div><div class="line"><a name="l01226"></a><span class="lineno"> 1226</span>&#160;      <span class="keywordflow">return</span> 0;</div><div class="line"><a name="l01227"></a><span class="lineno"> 1227</span>&#160;</div><div class="line"><a name="l01228"></a><span class="lineno"> 1228</span>&#160;   <span class="keywordtype">int</span> checkfq = -1;</div><div class="line"><a name="l01229"></a><span class="lineno"> 1229</span>&#160;   <span class="keywordtype">int</span> termto = -1;</div><div class="line"><a name="l01230"></a><span class="lineno"> 1230</span>&#160;   <span class="keywordtype">int</span> verifyto = -1;</div><div class="line"><a name="l01231"></a><span class="lineno"> 1231</span>&#160;   <span class="keywordtype">int</span> recoverto = -1;</div><div class="line"><a name="l01232"></a><span class="lineno"> 1232</span>&#160;   <span class="keywordtype">int</span> checklost = 0;</div><div class="line"><a name="l01233"></a><span class="lineno"> 1233</span>&#160;   <span class="keywordtype">int</span> usefork = 0;</div><div class="line"><a name="l01234"></a><span class="lineno"> 1234</span>&#160;</div><div class="line"><a name="l01235"></a><span class="lineno"> 1235</span>&#160;   <span class="keywordflow">while</span> (val) {</div><div class="line"><a name="l01236"></a><span class="lineno"> 1236</span>&#160;      XrdOucString tok(val);</div><div class="line"><a name="l01237"></a><span class="lineno"> 1237</span>&#160;      <span class="keywordflow">if</span> (tok.beginswith(<span class="stringliteral">&quot;checkfq:&quot;</span>)) {</div><div class="line"><a name="l01238"></a><span class="lineno"> 1238</span>&#160;         tok.replace(<span class="stringliteral">&quot;checkfq:&quot;</span>, <span class="stringliteral">&quot;&quot;</span>);</div><div class="line"><a name="l01239"></a><span class="lineno"> 1239</span>&#160;         checkfq = strtol(tok.c_str(), 0, 10);</div><div class="line"><a name="l01240"></a><span class="lineno"> 1240</span>&#160;      } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (tok.beginswith(<span class="stringliteral">&quot;termto:&quot;</span>)) {</div><div class="line"><a name="l01241"></a><span class="lineno"> 1241</span>&#160;         tok.replace(<span class="stringliteral">&quot;termto:&quot;</span>, <span class="stringliteral">&quot;&quot;</span>);</div><div class="line"><a name="l01242"></a><span class="lineno"> 1242</span>&#160;         termto = strtol(tok.c_str(), 0, 10);</div><div class="line"><a name="l01243"></a><span class="lineno"> 1243</span>&#160;      } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (tok.beginswith(<span class="stringliteral">&quot;verifyto:&quot;</span>)) {</div><div class="line"><a name="l01244"></a><span class="lineno"> 1244</span>&#160;         tok.replace(<span class="stringliteral">&quot;verifyto:&quot;</span>, <span class="stringliteral">&quot;&quot;</span>);</div><div class="line"><a name="l01245"></a><span class="lineno"> 1245</span>&#160;         verifyto = strtol(tok.c_str(), 0, 10);</div><div class="line"><a name="l01246"></a><span class="lineno"> 1246</span>&#160;      } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (tok.beginswith(<span class="stringliteral">&quot;recoverto:&quot;</span>)) {</div><div class="line"><a name="l01247"></a><span class="lineno"> 1247</span>&#160;         tok.replace(<span class="stringliteral">&quot;recoverto:&quot;</span>, <span class="stringliteral">&quot;&quot;</span>);</div><div class="line"><a name="l01248"></a><span class="lineno"> 1248</span>&#160;         recoverto = strtol(tok.c_str(), 0, 10);</div><div class="line"><a name="l01249"></a><span class="lineno"> 1249</span>&#160;      } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (tok.beginswith(<span class="stringliteral">&quot;checklost:&quot;</span>)) {</div><div class="line"><a name="l01250"></a><span class="lineno"> 1250</span>&#160;         tok.replace(<span class="stringliteral">&quot;checklost:&quot;</span>, <span class="stringliteral">&quot;&quot;</span>);</div><div class="line"><a name="l01251"></a><span class="lineno"> 1251</span>&#160;         checklost = strtol(tok.c_str(), 0, 10);</div><div class="line"><a name="l01252"></a><span class="lineno"> 1252</span>&#160;      } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (tok.beginswith(<span class="stringliteral">&quot;usefork:&quot;</span>)) {</div><div class="line"><a name="l01253"></a><span class="lineno"> 1253</span>&#160;         tok.replace(<span class="stringliteral">&quot;usefork:&quot;</span>, <span class="stringliteral">&quot;&quot;</span>);</div><div class="line"><a name="l01254"></a><span class="lineno"> 1254</span>&#160;         usefork = strtol(tok.c_str(), 0, 10);</div><div class="line"><a name="l01255"></a><span class="lineno"> 1255</span>&#160;      }</div><div class="line"><a name="l01256"></a><span class="lineno"> 1256</span>&#160;      <span class="comment">// Get next</span></div><div class="line"><a name="l01257"></a><span class="lineno"> 1257</span>&#160;      val = cfg-&gt;GetWord();</div><div class="line"><a name="l01258"></a><span class="lineno"> 1258</span>&#160;   }</div><div class="line"><a name="l01259"></a><span class="lineno"> 1259</span>&#160;</div><div class="line"><a name="l01260"></a><span class="lineno"> 1260</span>&#160;   <span class="comment">// Check deprecated &#39;if&#39; directive</span></div><div class="line"><a name="l01261"></a><span class="lineno"> 1261</span>&#160;   <span class="keywordflow">if</span> (<a class="code" href="classXrdProofdProofServMgr.html#a86cac591a5646811e38ff6a2477f4da7">fMgr</a>-&gt;<a class="code" href="classXrdProofdManager.html#a3f8780d0a9d3fabe02aa01fe8ebbf5b5">Host</a>() &amp;&amp; cfg)</div><div class="line"><a name="l01262"></a><span class="lineno"> 1262</span>&#160;      <span class="keywordflow">if</span> (<a class="code" href="classXrdProofdAux.html#ae175d666f49fefdfb6e4e3fde1151ee4">XrdProofdAux::CheckIf</a>(cfg, <a class="code" href="classXrdProofdProofServMgr.html#a86cac591a5646811e38ff6a2477f4da7">fMgr</a>-&gt;<a class="code" href="classXrdProofdManager.html#a3f8780d0a9d3fabe02aa01fe8ebbf5b5">Host</a>()) == 0)</div><div class="line"><a name="l01263"></a><span class="lineno"> 1263</span>&#160;         <span class="keywordflow">return</span> 0;</div><div class="line"><a name="l01264"></a><span class="lineno"> 1264</span>&#160;</div><div class="line"><a name="l01265"></a><span class="lineno"> 1265</span>&#160;   <span class="comment">// Set the values</span></div><div class="line"><a name="l01266"></a><span class="lineno"> 1266</span>&#160;   <a class="code" href="classXrdProofdProofServMgr.html#a17dc7a6fb286b3bdaf1c7739ea68f7c1">fCheckFrequency</a> = (<a class="code" href="XrdProofdPlatform_8h.html#a8862563dbade574514445160166dcd2d">XPD_LONGOK</a>(checkfq) &amp;&amp; checkfq &gt; 0) ? checkfq : <a class="code" href="classXrdProofdProofServMgr.html#a17dc7a6fb286b3bdaf1c7739ea68f7c1">fCheckFrequency</a>;</div><div class="line"><a name="l01267"></a><span class="lineno"> 1267</span>&#160;   <a class="code" href="classXrdProofdProofServMgr.html#a1c418ea2fa6ac9a8e6990506de51a5d6">fTerminationTimeOut</a> = (<a class="code" href="XrdProofdPlatform_8h.html#a8862563dbade574514445160166dcd2d">XPD_LONGOK</a>(termto) &amp;&amp; termto &gt; 0) ? termto : <a class="code" href="classXrdProofdProofServMgr.html#a1c418ea2fa6ac9a8e6990506de51a5d6">fTerminationTimeOut</a>;</div><div class="line"><a name="l01268"></a><span class="lineno"> 1268</span>&#160;   <a class="code" href="classXrdProofdProofServMgr.html#a1a5fce183660e6508e874505445d88dd">fVerifyTimeOut</a> = (<a class="code" href="XrdProofdPlatform_8h.html#a8862563dbade574514445160166dcd2d">XPD_LONGOK</a>(verifyto) &amp;&amp; (verifyto &gt; <a class="code" href="classXrdProofdProofServMgr.html#a17dc7a6fb286b3bdaf1c7739ea68f7c1">fCheckFrequency</a> + 1))</div><div class="line"><a name="l01269"></a><span class="lineno"> 1269</span>&#160;                  ? verifyto : <a class="code" href="classXrdProofdProofServMgr.html#a1a5fce183660e6508e874505445d88dd">fVerifyTimeOut</a>;</div><div class="line"><a name="l01270"></a><span class="lineno"> 1270</span>&#160;   <a class="code" href="classXrdProofdProofServMgr.html#aa150146266359bec018e9b443e49818d">fRecoverTimeOut</a> = (<a class="code" href="XrdProofdPlatform_8h.html#a8862563dbade574514445160166dcd2d">XPD_LONGOK</a>(recoverto) &amp;&amp; recoverto &gt; 0) ? recoverto : <a class="code" href="classXrdProofdProofServMgr.html#aa150146266359bec018e9b443e49818d">fRecoverTimeOut</a>;</div><div class="line"><a name="l01271"></a><span class="lineno"> 1271</span>&#160;   <span class="keywordflow">if</span> (<a class="code" href="XrdProofdPlatform_8h.html#a8862563dbade574514445160166dcd2d">XPD_LONGOK</a>(checklost)) <a class="code" href="classXrdProofdProofServMgr.html#a001151ea555c7e0d21298d831452665f">fCheckLost</a> = (checklost != 0) ? 1 : 0;</div><div class="line"><a name="l01272"></a><span class="lineno"> 1272</span>&#160;   <span class="keywordflow">if</span> (<a class="code" href="XrdProofdPlatform_8h.html#a8862563dbade574514445160166dcd2d">XPD_LONGOK</a>(usefork)) <a class="code" href="classXrdProofdProofServMgr.html#a4d0997e0348d21914091e8bd3d844751">fUseFork</a> = (usefork != 0) ? 1 : 0;</div><div class="line"><a name="l01273"></a><span class="lineno"> 1273</span>&#160;</div><div class="line"><a name="l01274"></a><span class="lineno"> 1274</span>&#160;   XrdOucString msg;</div><div class="line"><a name="l01275"></a><span class="lineno"> 1275</span>&#160;   <a class="code" href="XrdProofdAux_8h.html#a631cc8787af1a02d9e51c86117ae042e">XPDFORM</a>(msg, <span class="stringliteral">&quot;checkfq: %d s, termto: %d s, verifyto: %d s, recoverto: %d s, checklost: %d, usefork: %d&quot;</span>,</div><div class="line"><a name="l01276"></a><span class="lineno"> 1276</span>&#160;            <a class="code" href="classXrdProofdProofServMgr.html#a17dc7a6fb286b3bdaf1c7739ea68f7c1">fCheckFrequency</a>, <a class="code" href="classXrdProofdProofServMgr.html#a1c418ea2fa6ac9a8e6990506de51a5d6">fTerminationTimeOut</a>, <a class="code" href="classXrdProofdProofServMgr.html#a1a5fce183660e6508e874505445d88dd">fVerifyTimeOut</a>, <a class="code" href="classXrdProofdProofServMgr.html#aa150146266359bec018e9b443e49818d">fRecoverTimeOut</a>, <a class="code" href="classXrdProofdProofServMgr.html#a001151ea555c7e0d21298d831452665f">fCheckLost</a>, <a class="code" href="classXrdProofdProofServMgr.html#a4d0997e0348d21914091e8bd3d844751">fUseFork</a>);</div><div class="line"><a name="l01277"></a><span class="lineno"> 1277</span>&#160;   <a class="code" href="TGHtml_8h.html#ad5bb4a3d12fd54f29da2b924b29e652b">TRACE</a>(ALL, msg);</div><div class="line"><a name="l01278"></a><span class="lineno"> 1278</span>&#160;</div><div class="line"><a name="l01279"></a><span class="lineno"> 1279</span>&#160;   <span class="keywordflow">return</span> 0;</div><div class="line"><a name="l01280"></a><span class="lineno"> 1280</span>&#160;}</div><div class="line"><a name="l01281"></a><span class="lineno"> 1281</span>&#160;<span class="comment"></span></div><div class="line"><a name="l01282"></a><span class="lineno"> 1282</span>&#160;<span class="comment">////////////////////////////////////////////////////////////////////////////////</span></div><div class="line"><a name="l01283"></a><span class="lineno"> 1283</span>&#160;<span class="comment">/// Process &#39;putenv&#39; directives</span></div><div class="line"><a name="l01284"></a><span class="lineno"> 1284</span>&#160;<span class="comment"></span></div><div class="line"><a name="l01285"></a><span class="lineno"><a class="line" href="classXrdProofdProofServMgr.html#a94600aafa5d2398a65a971f1189e9423"> 1285</a></span>&#160;<span class="keywordtype">int</span> <a class="code" href="classXrdProofdProofServMgr.html#a94600aafa5d2398a65a971f1189e9423">XrdProofdProofServMgr::DoDirectivePutEnv</a>(<span class="keywordtype">char</span> *val, XrdOucStream *cfg, <span class="keywordtype">bool</span>)</div><div class="line"><a name="l01286"></a><span class="lineno"> 1286</span>&#160;{</div><div class="line"><a name="l01287"></a><span class="lineno"> 1287</span>&#160;   <span class="keywordflow">if</span> (!val)</div><div class="line"><a name="l01288"></a><span class="lineno"> 1288</span>&#160;      <span class="comment">// undefined inputs</span></div><div class="line"><a name="l01289"></a><span class="lineno"> 1289</span>&#160;      <span class="keywordflow">return</span> -1;</div><div class="line"><a name="l01290"></a><span class="lineno"> 1290</span>&#160;</div><div class="line"><a name="l01291"></a><span class="lineno"> 1291</span>&#160;   <span class="comment">// Parse env variables to be passed to &#39;proofserv&#39;:</span></div><div class="line"><a name="l01292"></a><span class="lineno"> 1292</span>&#160;   XrdOucString users, groups, rcval, rcnam;</div><div class="line"><a name="l01293"></a><span class="lineno"> 1293</span>&#160;   <span class="keywordtype">int</span> smi = -1, smx = -1, vmi = -1, vmx = -1;</div><div class="line"><a name="l01294"></a><span class="lineno"> 1294</span>&#160;   <span class="keywordtype">bool</span> hex = 0;</div><div class="line"><a name="l01295"></a><span class="lineno"> 1295</span>&#160;   <a class="code" href="classXrdProofdProofServMgr.html#a12349f4130cb34fa51fa75d4c4dcb5c2">ExtractEnv</a>(val, cfg, users, groups, rcval, rcnam, smi, smx, vmi, vmx, hex);</div><div class="line"><a name="l01296"></a><span class="lineno"> 1296</span>&#160;</div><div class="line"><a name="l01297"></a><span class="lineno"> 1297</span>&#160;   <span class="comment">// Adjust name of the variable</span></div><div class="line"><a name="l01298"></a><span class="lineno"> 1298</span>&#160;   <span class="keywordtype">int</span> iequ = rcnam.find(<span class="charliteral">&#39;=&#39;</span>);</div><div class="line"><a name="l01299"></a><span class="lineno"> 1299</span>&#160;   <span class="keywordflow">if</span> (iequ == STR_NPOS) <span class="keywordflow">return</span> -1;</div><div class="line"><a name="l01300"></a><span class="lineno"> 1300</span>&#160;   rcnam.erase(iequ);</div><div class="line"><a name="l01301"></a><span class="lineno"> 1301</span>&#160;</div><div class="line"><a name="l01302"></a><span class="lineno"> 1302</span>&#160;   <span class="comment">// Fill entries</span></div><div class="line"><a name="l01303"></a><span class="lineno"> 1303</span>&#160;   <a class="code" href="classXrdProofdProofServMgr.html#a2d9c4bfb86ff4297ee34f14153d98616">FillEnvList</a>(&amp;<a class="code" href="classXrdProofdProofServMgr.html#af99918358c943b44bb636cf70b97671e">fProofServEnvs</a>, rcnam.c_str(), rcval.c_str(),</div><div class="line"><a name="l01304"></a><span class="lineno"> 1304</span>&#160;                                users.c_str(), groups.c_str(), smi, smx, vmi, vmx, hex);</div><div class="line"><a name="l01305"></a><span class="lineno"> 1305</span>&#160;</div><div class="line"><a name="l01306"></a><span class="lineno"> 1306</span>&#160;   <span class="keywordflow">return</span> 0;</div><div class="line"><a name="l01307"></a><span class="lineno"> 1307</span>&#160;}</div><div class="line"><a name="l01308"></a><span class="lineno"> 1308</span>&#160;<span class="comment"></span></div><div class="line"><a name="l01309"></a><span class="lineno"> 1309</span>&#160;<span class="comment">////////////////////////////////////////////////////////////////////////////////</span></div><div class="line"><a name="l01310"></a><span class="lineno"> 1310</span>&#160;<span class="comment">/// Process &#39;putrc&#39; directives.</span></div><div class="line"><a name="l01311"></a><span class="lineno"> 1311</span>&#160;<span class="comment">/// Syntax:</span></div><div class="line"><a name="l01312"></a><span class="lineno"> 1312</span>&#160;<span class="comment">///    xpd.putrc  [u:&lt;usr1&gt;,&lt;usr2&gt;,...] [g:&lt;grp1&gt;,&lt;grp2&gt;,...]</span></div><div class="line"><a name="l01313"></a><span class="lineno"> 1313</span>&#160;<span class="comment">///               [s:[svnmin][-][svnmax]] [v:[vermin][-][vermax]] RcVarName RcVarValue</span></div><div class="line"><a name="l01314"></a><span class="lineno"> 1314</span>&#160;<span class="comment">/// NB: &lt;usr1&gt;,... and &lt;grp1&gt;,... may contain the wild card &#39;*&#39;</span></div><div class="line"><a name="l01315"></a><span class="lineno"> 1315</span>&#160;<span class="comment"></span></div><div class="line"><a name="l01316"></a><span class="lineno"><a class="line" href="classXrdProofdProofServMgr.html#a2a5e88f26472a0d1fde187373a1d7831"> 1316</a></span>&#160;<span class="keywordtype">int</span> <a class="code" href="classXrdProofdProofServMgr.html#a2a5e88f26472a0d1fde187373a1d7831">XrdProofdProofServMgr::DoDirectivePutRc</a>(<span class="keywordtype">char</span> *val, XrdOucStream *cfg, <span class="keywordtype">bool</span>)</div><div class="line"><a name="l01317"></a><span class="lineno"> 1317</span>&#160;{</div><div class="line"><a name="l01318"></a><span class="lineno"> 1318</span>&#160;   <span class="keywordflow">if</span> (!val || !cfg)</div><div class="line"><a name="l01319"></a><span class="lineno"> 1319</span>&#160;      <span class="comment">// undefined inputs</span></div><div class="line"><a name="l01320"></a><span class="lineno"> 1320</span>&#160;      <span class="keywordflow">return</span> -1;</div><div class="line"><a name="l01321"></a><span class="lineno"> 1321</span>&#160;</div><div class="line"><a name="l01322"></a><span class="lineno"> 1322</span>&#160;   <span class="comment">// Parse rootrc variables to be passed to &#39;proofserv&#39;:</span></div><div class="line"><a name="l01323"></a><span class="lineno"> 1323</span>&#160;   XrdOucString users, groups, rcval, rcnam;</div><div class="line"><a name="l01324"></a><span class="lineno"> 1324</span>&#160;   <span class="keywordtype">int</span> smi = -1, smx = -1, vmi = -1, vmx = -1;</div><div class="line"><a name="l01325"></a><span class="lineno"> 1325</span>&#160;   <span class="keywordtype">bool</span> hex = 0;</div><div class="line"><a name="l01326"></a><span class="lineno"> 1326</span>&#160;   <a class="code" href="classXrdProofdProofServMgr.html#a12349f4130cb34fa51fa75d4c4dcb5c2">ExtractEnv</a>(val, cfg, users, groups, rcval, rcnam, smi, smx, vmi, vmx, hex);</div><div class="line"><a name="l01327"></a><span class="lineno"> 1327</span>&#160;</div><div class="line"><a name="l01328"></a><span class="lineno"> 1328</span>&#160;   <span class="comment">// Fill entries</span></div><div class="line"><a name="l01329"></a><span class="lineno"> 1329</span>&#160;   <a class="code" href="classXrdProofdProofServMgr.html#a2d9c4bfb86ff4297ee34f14153d98616">FillEnvList</a>(&amp;<a class="code" href="classXrdProofdProofServMgr.html#acaa26797a7f4b194dd8f3f5d39be11af">fProofServRCs</a>, rcnam.c_str(), rcval.c_str(),</div><div class="line"><a name="l01330"></a><span class="lineno"> 1330</span>&#160;                               users.c_str(), groups.c_str(), smi, smx, vmi, vmx, hex);</div><div class="line"><a name="l01331"></a><span class="lineno"> 1331</span>&#160;</div><div class="line"><a name="l01332"></a><span class="lineno"> 1332</span>&#160;   <span class="keywordflow">return</span> 0;</div><div class="line"><a name="l01333"></a><span class="lineno"> 1333</span>&#160;}</div><div class="line"><a name="l01334"></a><span class="lineno"> 1334</span>&#160;<span class="comment"></span></div><div class="line"><a name="l01335"></a><span class="lineno"> 1335</span>&#160;<span class="comment">////////////////////////////////////////////////////////////////////////////////</span></div><div class="line"><a name="l01336"></a><span class="lineno"> 1336</span>&#160;<span class="comment">/// Extract env information from the stream &#39;cfg&#39;</span></div><div class="line"><a name="l01337"></a><span class="lineno"> 1337</span>&#160;<span class="comment"></span></div><div class="line"><a name="l01338"></a><span class="lineno"><a class="line" href="classXrdProofdProofServMgr.html#a12349f4130cb34fa51fa75d4c4dcb5c2"> 1338</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="classXrdProofdProofServMgr.html#a12349f4130cb34fa51fa75d4c4dcb5c2">XrdProofdProofServMgr::ExtractEnv</a>(<span class="keywordtype">char</span> *val, XrdOucStream *cfg,</div><div class="line"><a name="l01339"></a><span class="lineno"> 1339</span>&#160;                                       XrdOucString &amp;users, XrdOucString &amp;groups,</div><div class="line"><a name="l01340"></a><span class="lineno"> 1340</span>&#160;                                       XrdOucString &amp;rcval, XrdOucString &amp;rcnam,</div><div class="line"><a name="l01341"></a><span class="lineno"> 1341</span>&#160;                                       <span class="keywordtype">int</span> &amp;smi, <span class="keywordtype">int</span> &amp;smx, <span class="keywordtype">int</span> &amp;vmi, <span class="keywordtype">int</span> &amp;vmx, <span class="keywordtype">bool</span> &amp;hex)</div><div class="line"><a name="l01342"></a><span class="lineno"> 1342</span>&#160;{</div><div class="line"><a name="l01343"></a><span class="lineno"> 1343</span>&#160;   XrdOucString ssvn, sver;</div><div class="line"><a name="l01344"></a><span class="lineno"> 1344</span>&#160;   <span class="keywordtype">int</span> idash = -1;</div><div class="line"><a name="l01345"></a><span class="lineno"> 1345</span>&#160;   <span class="keywordflow">while</span> (val &amp;&amp; val[0]) {</div><div class="line"><a name="l01346"></a><span class="lineno"> 1346</span>&#160;      <span class="keywordflow">if</span> (!strncmp(val, <span class="stringliteral">&quot;u:&quot;</span>, 2)) {</div><div class="line"><a name="l01347"></a><span class="lineno"> 1347</span>&#160;         users = val;</div><div class="line"><a name="l01348"></a><span class="lineno"> 1348</span>&#160;         users.erase(0,2);</div><div class="line"><a name="l01349"></a><span class="lineno"> 1349</span>&#160;      } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strncmp(val, <span class="stringliteral">&quot;g:&quot;</span>, 2)) {</div><div class="line"><a name="l01350"></a><span class="lineno"> 1350</span>&#160;         groups = val;</div><div class="line"><a name="l01351"></a><span class="lineno"> 1351</span>&#160;         groups.erase(0,2);</div><div class="line"><a name="l01352"></a><span class="lineno"> 1352</span>&#160;      } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strncmp(val, <span class="stringliteral">&quot;s:&quot;</span>, 2)) {</div><div class="line"><a name="l01353"></a><span class="lineno"> 1353</span>&#160;         ssvn = val;</div><div class="line"><a name="l01354"></a><span class="lineno"> 1354</span>&#160;         ssvn.erase(0,2);</div><div class="line"><a name="l01355"></a><span class="lineno"> 1355</span>&#160;         idash = ssvn.find(<span class="charliteral">&#39;-&#39;</span>);</div><div class="line"><a name="l01356"></a><span class="lineno"> 1356</span>&#160;         <span class="keywordflow">if</span> (idash != STR_NPOS) {</div><div class="line"><a name="l01357"></a><span class="lineno"> 1357</span>&#160;            <span class="keywordflow">if</span> (ssvn.isdigit(0, idash-1)) smi = ssvn.atoi(0, idash-1);</div><div class="line"><a name="l01358"></a><span class="lineno"> 1358</span>&#160;            <span class="keywordflow">if</span> (ssvn.isdigit(idash+1)) smx = ssvn.atoi(idash+1);</div><div class="line"><a name="l01359"></a><span class="lineno"> 1359</span>&#160;         } <span class="keywordflow">else</span> {</div><div class="line"><a name="l01360"></a><span class="lineno"> 1360</span>&#160;            <span class="keywordflow">if</span> (ssvn.isdigit()) smi = ssvn.atoi();</div><div class="line"><a name="l01361"></a><span class="lineno"> 1361</span>&#160;         }</div><div class="line"><a name="l01362"></a><span class="lineno"> 1362</span>&#160;      } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strncmp(val, <span class="stringliteral">&quot;v:&quot;</span>, 2)) {</div><div class="line"><a name="l01363"></a><span class="lineno"> 1363</span>&#160;         sver = val;</div><div class="line"><a name="l01364"></a><span class="lineno"> 1364</span>&#160;         sver.erase(0,2);</div><div class="line"><a name="l01365"></a><span class="lineno"> 1365</span>&#160;         hex = 0;</div><div class="line"><a name="l01366"></a><span class="lineno"> 1366</span>&#160;         <span class="keywordflow">if</span> (sver.beginswith(<span class="charliteral">&#39;x&#39;</span>)) {</div><div class="line"><a name="l01367"></a><span class="lineno"> 1367</span>&#160;            hex = 1;</div><div class="line"><a name="l01368"></a><span class="lineno"> 1368</span>&#160;            sver.erase(0,1);</div><div class="line"><a name="l01369"></a><span class="lineno"> 1369</span>&#160;         }</div><div class="line"><a name="l01370"></a><span class="lineno"> 1370</span>&#160;         idash = sver.find(<span class="charliteral">&#39;-&#39;</span>);</div><div class="line"><a name="l01371"></a><span class="lineno"> 1371</span>&#160;         <span class="keywordflow">if</span> (idash != STR_NPOS) {</div><div class="line"><a name="l01372"></a><span class="lineno"> 1372</span>&#160;            <span class="keywordflow">if</span> (sver.isdigit(0, idash-1)) vmi = sver.atoi(0, idash-1);</div><div class="line"><a name="l01373"></a><span class="lineno"> 1373</span>&#160;            <span class="keywordflow">if</span> (sver.isdigit(idash+1)) vmx = sver.atoi(idash+1);</div><div class="line"><a name="l01374"></a><span class="lineno"> 1374</span>&#160;         } <span class="keywordflow">else</span> {</div><div class="line"><a name="l01375"></a><span class="lineno"> 1375</span>&#160;            <span class="keywordflow">if</span> (sver.isdigit()) vmi = sver.atoi();</div><div class="line"><a name="l01376"></a><span class="lineno"> 1376</span>&#160;         }</div><div class="line"><a name="l01377"></a><span class="lineno"> 1377</span>&#160;      } <span class="keywordflow">else</span> {</div><div class="line"><a name="l01378"></a><span class="lineno"> 1378</span>&#160;        <span class="keywordflow">if</span> (rcval.length() &gt; 0) {</div><div class="line"><a name="l01379"></a><span class="lineno"> 1379</span>&#160;           rcval += <span class="charliteral">&#39; &#39;</span>;</div><div class="line"><a name="l01380"></a><span class="lineno"> 1380</span>&#160;        } <span class="keywordflow">else</span> {</div><div class="line"><a name="l01381"></a><span class="lineno"> 1381</span>&#160;           rcnam = val;</div><div class="line"><a name="l01382"></a><span class="lineno"> 1382</span>&#160;        }</div><div class="line"><a name="l01383"></a><span class="lineno"> 1383</span>&#160;        rcval += val;</div><div class="line"><a name="l01384"></a><span class="lineno"> 1384</span>&#160;      }</div><div class="line"><a name="l01385"></a><span class="lineno"> 1385</span>&#160;      val = cfg-&gt;GetWord();</div><div class="line"><a name="l01386"></a><span class="lineno"> 1386</span>&#160;   }</div><div class="line"><a name="l01387"></a><span class="lineno"> 1387</span>&#160;   <span class="comment">// Done</span></div><div class="line"><a name="l01388"></a><span class="lineno"> 1388</span>&#160;   <span class="keywordflow">return</span>;</div><div class="line"><a name="l01389"></a><span class="lineno"> 1389</span>&#160;}</div><div class="line"><a name="l01390"></a><span class="lineno"> 1390</span>&#160;<span class="comment"></span></div><div class="line"><a name="l01391"></a><span class="lineno"> 1391</span>&#160;<span class="comment">////////////////////////////////////////////////////////////////////////////////</span></div><div class="line"><a name="l01392"></a><span class="lineno"> 1392</span>&#160;<span class="comment">/// Fill env entry(ies) in the relevant list</span></div><div class="line"><a name="l01393"></a><span class="lineno"> 1393</span>&#160;<span class="comment"></span></div><div class="line"><a name="l01394"></a><span class="lineno"><a class="line" href="classXrdProofdProofServMgr.html#a2d9c4bfb86ff4297ee34f14153d98616"> 1394</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="classXrdProofdProofServMgr.html#a2d9c4bfb86ff4297ee34f14153d98616">XrdProofdProofServMgr::FillEnvList</a>(std::list&lt;XpdEnv&gt; *el, <span class="keyword">const</span> <span class="keywordtype">char</span> *nam, <span class="keyword">const</span> <span class="keywordtype">char</span> *val,</div><div class="line"><a name="l01395"></a><span class="lineno"> 1395</span>&#160;                                        <span class="keyword">const</span> <span class="keywordtype">char</span> *usrs, <span class="keyword">const</span> <span class="keywordtype">char</span> *grps,</div><div class="line"><a name="l01396"></a><span class="lineno"> 1396</span>&#160;                                        <span class="keywordtype">int</span> smi, <span class="keywordtype">int</span> smx, <span class="keywordtype">int</span> vmi, <span class="keywordtype">int</span> vmx, <span class="keywordtype">bool</span> hex)</div><div class="line"><a name="l01397"></a><span class="lineno"> 1397</span>&#160;{</div><div class="line"><a name="l01398"></a><span class="lineno"> 1398</span>&#160;   <a class="code" href="XrdProofdTrace_8h.html#a7c31822912a8d0dc9bfd544097b29e12">XPDLOC</a>(SMGR, <span class="stringliteral">&quot;ProofServMgr::FillEnvList&quot;</span>)</div><div class="line"><a name="l01399"></a><span class="lineno"> 1399</span>&#160;</div><div class="line"><a name="l01400"></a><span class="lineno"> 1400</span>&#160;   <span class="keywordflow">if</span> (!el) {</div><div class="line"><a name="l01401"></a><span class="lineno"> 1401</span>&#160;      <a class="code" href="TGHtml_8h.html#ad5bb4a3d12fd54f29da2b924b29e652b">TRACE</a>(ALL, <span class="stringliteral">&quot;env list undefined!&quot;</span>);</div><div class="line"><a name="l01402"></a><span class="lineno"> 1402</span>&#160;      <span class="keywordflow">return</span>;</div><div class="line"><a name="l01403"></a><span class="lineno"> 1403</span>&#160;   }</div><div class="line"><a name="l01404"></a><span class="lineno"> 1404</span>&#160;</div><div class="line"><a name="l01405"></a><span class="lineno"> 1405</span>&#160;   XrdOucString users(usrs), groups(grps);</div><div class="line"><a name="l01406"></a><span class="lineno"> 1406</span>&#160;   <span class="comment">// Transform version numbers in the human unreadable format used internally (version code)</span></div><div class="line"><a name="l01407"></a><span class="lineno"> 1407</span>&#160;   <span class="keywordflow">if</span> (vmi &gt; 0) vmi = <a class="code" href="classXpdEnv.html#ae9c162b3ad476c505b38f4b5e022c953">XpdEnv::ToVersCode</a>(vmi, hex);</div><div class="line"><a name="l01408"></a><span class="lineno"> 1408</span>&#160;   <span class="keywordflow">if</span> (vmx &gt; 0) vmx = <a class="code" href="classXpdEnv.html#ae9c162b3ad476c505b38f4b5e022c953">XpdEnv::ToVersCode</a>(vmx, hex);</div><div class="line"><a name="l01409"></a><span class="lineno"> 1409</span>&#160;   <span class="comment">// Create the entry</span></div><div class="line"><a name="l01410"></a><span class="lineno"> 1410</span>&#160;   <a class="code" href="classXpdEnv.html">XpdEnv</a> xpe(nam, val, users.c_str(), groups.c_str(), smi, smx, vmi, vmx);</div><div class="line"><a name="l01411"></a><span class="lineno"> 1411</span>&#160;   <span class="keywordflow">if</span> (users.length() &gt; 0) {</div><div class="line"><a name="l01412"></a><span class="lineno"> 1412</span>&#160;      XrdOucString usr;</div><div class="line"><a name="l01413"></a><span class="lineno"> 1413</span>&#160;      <span class="keywordtype">int</span> from = 0;</div><div class="line"><a name="l01414"></a><span class="lineno"> 1414</span>&#160;      <span class="keywordflow">while</span> ((from = users.tokenize(usr, from, <span class="charliteral">&#39;,&#39;</span>)) != -1) {</div><div class="line"><a name="l01415"></a><span class="lineno"> 1415</span>&#160;         <span class="keywordflow">if</span> (usr.length() &gt; 0) {</div><div class="line"><a name="l01416"></a><span class="lineno"> 1416</span>&#160;            <span class="keywordflow">if</span> (groups.length() &gt; 0) {</div><div class="line"><a name="l01417"></a><span class="lineno"> 1417</span>&#160;               XrdOucString grp;</div><div class="line"><a name="l01418"></a><span class="lineno"> 1418</span>&#160;               <span class="keywordtype">int</span> fromg = 0;</div><div class="line"><a name="l01419"></a><span class="lineno"> 1419</span>&#160;               <span class="keywordflow">while</span> ((fromg = groups.tokenize(grp, from, <span class="charliteral">&#39;,&#39;</span>)) != -1) {</div><div class="line"><a name="l01420"></a><span class="lineno"> 1420</span>&#160;                  <span class="keywordflow">if</span> (grp.length() &gt; 0) {</div><div class="line"><a name="l01421"></a><span class="lineno"> 1421</span>&#160;                     xpe.<a class="code" href="classXpdEnv.html#ae457913000a09b79692db8ca7ed2eaf5">Reset</a>(nam, val, usr.c_str(), grp.c_str(), smi, smx, vmi, vmx);</div><div class="line"><a name="l01422"></a><span class="lineno"> 1422</span>&#160;                     el-&gt;push_back(xpe);</div><div class="line"><a name="l01423"></a><span class="lineno"> 1423</span>&#160;                  }</div><div class="line"><a name="l01424"></a><span class="lineno"> 1424</span>&#160;               }</div><div class="line"><a name="l01425"></a><span class="lineno"> 1425</span>&#160;            } <span class="keywordflow">else</span> {</div><div class="line"><a name="l01426"></a><span class="lineno"> 1426</span>&#160;               xpe.Reset(nam, val, usr.c_str(), 0, smi, smx, vmi, vmx);</div><div class="line"><a name="l01427"></a><span class="lineno"> 1427</span>&#160;               el-&gt;push_back(xpe);</div><div class="line"><a name="l01428"></a><span class="lineno"> 1428</span>&#160;            }</div><div class="line"><a name="l01429"></a><span class="lineno"> 1429</span>&#160;         }</div><div class="line"><a name="l01430"></a><span class="lineno"> 1430</span>&#160;      }</div><div class="line"><a name="l01431"></a><span class="lineno"> 1431</span>&#160;   } <span class="keywordflow">else</span> {</div><div class="line"><a name="l01432"></a><span class="lineno"> 1432</span>&#160;      <span class="keywordflow">if</span> (groups.length() &gt; 0) {</div><div class="line"><a name="l01433"></a><span class="lineno"> 1433</span>&#160;         XrdOucString grp;</div><div class="line"><a name="l01434"></a><span class="lineno"> 1434</span>&#160;         <span class="keywordtype">int</span> fromg = 0;</div><div class="line"><a name="l01435"></a><span class="lineno"> 1435</span>&#160;         <span class="keywordflow">while</span> ((fromg = groups.tokenize(grp, fromg, <span class="charliteral">&#39;,&#39;</span>)) != -1) {</div><div class="line"><a name="l01436"></a><span class="lineno"> 1436</span>&#160;            <span class="keywordflow">if</span> (grp.length() &gt; 0) {</div><div class="line"><a name="l01437"></a><span class="lineno"> 1437</span>&#160;               xpe.Reset(nam, val, 0, grp.c_str(), smi, smx, vmi, vmx);</div><div class="line"><a name="l01438"></a><span class="lineno"> 1438</span>&#160;               el-&gt;push_back(xpe);</div><div class="line"><a name="l01439"></a><span class="lineno"> 1439</span>&#160;            }</div><div class="line"><a name="l01440"></a><span class="lineno"> 1440</span>&#160;         }</div><div class="line"><a name="l01441"></a><span class="lineno"> 1441</span>&#160;      } <span class="keywordflow">else</span> {</div><div class="line"><a name="l01442"></a><span class="lineno"> 1442</span>&#160;         el-&gt;push_back(xpe);</div><div class="line"><a name="l01443"></a><span class="lineno"> 1443</span>&#160;      }</div><div class="line"><a name="l01444"></a><span class="lineno"> 1444</span>&#160;   }</div><div class="line"><a name="l01445"></a><span class="lineno"> 1445</span>&#160;   <span class="comment">// Done</span></div><div class="line"><a name="l01446"></a><span class="lineno"> 1446</span>&#160;   <span class="keywordflow">return</span>;</div><div class="line"><a name="l01447"></a><span class="lineno"> 1447</span>&#160;}</div><div class="line"><a name="l01448"></a><span class="lineno"> 1448</span>&#160;<span class="comment"></span></div><div class="line"><a name="l01449"></a><span class="lineno"> 1449</span>&#160;<span class="comment">////////////////////////////////////////////////////////////////////////////////</span></div><div class="line"><a name="l01450"></a><span class="lineno"> 1450</span>&#160;<span class="comment">/// Process &#39;shutdown&#39; directive</span></div><div class="line"><a name="l01451"></a><span class="lineno"> 1451</span>&#160;<span class="comment"></span></div><div class="line"><a name="l01452"></a><span class="lineno"><a class="line" href="classXrdProofdProofServMgr.html#a7c23aca8c6f65bbd37ef356a3cdf7bef"> 1452</a></span>&#160;<span class="keywordtype">int</span> <a class="code" href="classXrdProofdProofServMgr.html#a7c23aca8c6f65bbd37ef356a3cdf7bef">XrdProofdProofServMgr::DoDirectiveShutdown</a>(<span class="keywordtype">char</span> *val, XrdOucStream *cfg, <span class="keywordtype">bool</span>)</div><div class="line"><a name="l01453"></a><span class="lineno"> 1453</span>&#160;{</div><div class="line"><a name="l01454"></a><span class="lineno"> 1454</span>&#160;   <span class="keywordflow">if</span> (!val || !cfg)</div><div class="line"><a name="l01455"></a><span class="lineno"> 1455</span>&#160;      <span class="comment">// undefined inputs</span></div><div class="line"><a name="l01456"></a><span class="lineno"> 1456</span>&#160;      <span class="keywordflow">return</span> -1;</div><div class="line"><a name="l01457"></a><span class="lineno"> 1457</span>&#160;</div><div class="line"><a name="l01458"></a><span class="lineno"> 1458</span>&#160;   <span class="keywordtype">int</span> opt = -1;</div><div class="line"><a name="l01459"></a><span class="lineno"> 1459</span>&#160;   <span class="keywordtype">int</span> delay = -1;</div><div class="line"><a name="l01460"></a><span class="lineno"> 1460</span>&#160;</div><div class="line"><a name="l01461"></a><span class="lineno"> 1461</span>&#160;   <span class="comment">// Shutdown option</span></div><div class="line"><a name="l01462"></a><span class="lineno"> 1462</span>&#160;   <span class="keywordtype">int</span> dp = strtol(val,0,10);</div><div class="line"><a name="l01463"></a><span class="lineno"> 1463</span>&#160;   <span class="keywordflow">if</span> (dp &gt;= 0 &amp;&amp; dp &lt;= 2)</div><div class="line"><a name="l01464"></a><span class="lineno"> 1464</span>&#160;      opt = dp;</div><div class="line"><a name="l01465"></a><span class="lineno"> 1465</span>&#160;   <span class="comment">// Shutdown delay</span></div><div class="line"><a name="l01466"></a><span class="lineno"> 1466</span>&#160;   <span class="keywordflow">if</span> ((val = cfg-&gt;GetWord())) {</div><div class="line"><a name="l01467"></a><span class="lineno"> 1467</span>&#160;      <span class="keywordtype">int</span> <a class="code" href="textangle_8C.html#a3359d7f1aa9fe2f8bc884b02020e8d20">l</a> = strlen(val);</div><div class="line"><a name="l01468"></a><span class="lineno"> 1468</span>&#160;      <span class="keywordtype">int</span> <a class="code" href="RSha256_8hxx.html#a357394e0f6f88c8a57bd893ab28dc8f8">f</a> = 1;</div><div class="line"><a name="l01469"></a><span class="lineno"> 1469</span>&#160;      XrdOucString tval = val;</div><div class="line"><a name="l01470"></a><span class="lineno"> 1470</span>&#160;      <span class="comment">// Parse</span></div><div class="line"><a name="l01471"></a><span class="lineno"> 1471</span>&#160;      <span class="keywordflow">if</span> (val[<a class="code" href="textangle_8C.html#a3359d7f1aa9fe2f8bc884b02020e8d20">l</a>-1] == <span class="charliteral">&#39;s&#39;</span>) {</div><div class="line"><a name="l01472"></a><span class="lineno"> 1472</span>&#160;         val[<a class="code" href="textangle_8C.html#a3359d7f1aa9fe2f8bc884b02020e8d20">l</a>-1] = 0;</div><div class="line"><a name="l01473"></a><span class="lineno"> 1473</span>&#160;      } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (val[<a class="code" href="textangle_8C.html#a3359d7f1aa9fe2f8bc884b02020e8d20">l</a>-1] == <span class="charliteral">&#39;m&#39;</span>) {</div><div class="line"><a name="l01474"></a><span class="lineno"> 1474</span>&#160;         <a class="code" href="RSha256_8hxx.html#a357394e0f6f88c8a57bd893ab28dc8f8">f</a> = 60;</div><div class="line"><a name="l01475"></a><span class="lineno"> 1475</span>&#160;         val[<a class="code" href="textangle_8C.html#a3359d7f1aa9fe2f8bc884b02020e8d20">l</a>-1] = 0;</div><div class="line"><a name="l01476"></a><span class="lineno"> 1476</span>&#160;      } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (val[<a class="code" href="textangle_8C.html#a3359d7f1aa9fe2f8bc884b02020e8d20">l</a>-1] == <span class="charliteral">&#39;h&#39;</span>) {</div><div class="line"><a name="l01477"></a><span class="lineno"> 1477</span>&#160;         <a class="code" href="RSha256_8hxx.html#a357394e0f6f88c8a57bd893ab28dc8f8">f</a> = 3600;</div><div class="line"><a name="l01478"></a><span class="lineno"> 1478</span>&#160;         val[<a class="code" href="textangle_8C.html#a3359d7f1aa9fe2f8bc884b02020e8d20">l</a>-1] = 0;</div><div class="line"><a name="l01479"></a><span class="lineno"> 1479</span>&#160;      } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (val[<a class="code" href="textangle_8C.html#a3359d7f1aa9fe2f8bc884b02020e8d20">l</a>-1] &lt; 48 || val[<a class="code" href="textangle_8C.html#a3359d7f1aa9fe2f8bc884b02020e8d20">l</a>-1] &gt; 57) {</div><div class="line"><a name="l01480"></a><span class="lineno"> 1480</span>&#160;         <a class="code" href="RSha256_8hxx.html#a357394e0f6f88c8a57bd893ab28dc8f8">f</a> = -1;</div><div class="line"><a name="l01481"></a><span class="lineno"> 1481</span>&#160;      }</div><div class="line"><a name="l01482"></a><span class="lineno"> 1482</span>&#160;      <span class="keywordflow">if</span> (<a class="code" href="RSha256_8hxx.html#a357394e0f6f88c8a57bd893ab28dc8f8">f</a> &gt; 0) {</div><div class="line"><a name="l01483"></a><span class="lineno"> 1483</span>&#160;         <span class="keywordtype">int</span> de = strtol(val,0,10);</div><div class="line"><a name="l01484"></a><span class="lineno"> 1484</span>&#160;         <span class="keywordflow">if</span> (de &gt; 0)</div><div class="line"><a name="l01485"></a><span class="lineno"> 1485</span>&#160;            delay = de * <a class="code" href="RSha256_8hxx.html#a357394e0f6f88c8a57bd893ab28dc8f8">f</a>;</div><div class="line"><a name="l01486"></a><span class="lineno"> 1486</span>&#160;      }</div><div class="line"><a name="l01487"></a><span class="lineno"> 1487</span>&#160;   }</div><div class="line"><a name="l01488"></a><span class="lineno"> 1488</span>&#160;</div><div class="line"><a name="l01489"></a><span class="lineno"> 1489</span>&#160;   <span class="comment">// Check deprecated &#39;if&#39; directive</span></div><div class="line"><a name="l01490"></a><span class="lineno"> 1490</span>&#160;   <span class="keywordflow">if</span> (<a class="code" href="classXrdProofdProofServMgr.html#a86cac591a5646811e38ff6a2477f4da7">fMgr</a>-&gt;<a class="code" href="classXrdProofdManager.html#a3f8780d0a9d3fabe02aa01fe8ebbf5b5">Host</a>() &amp;&amp; cfg)</div><div class="line"><a name="l01491"></a><span class="lineno"> 1491</span>&#160;      <span class="keywordflow">if</span> (<a class="code" href="classXrdProofdAux.html#ae175d666f49fefdfb6e4e3fde1151ee4">XrdProofdAux::CheckIf</a>(cfg, <a class="code" href="classXrdProofdProofServMgr.html#a86cac591a5646811e38ff6a2477f4da7">fMgr</a>-&gt;<a class="code" href="classXrdProofdManager.html#a3f8780d0a9d3fabe02aa01fe8ebbf5b5">Host</a>()) == 0)</div><div class="line"><a name="l01492"></a><span class="lineno"> 1492</span>&#160;         <span class="keywordflow">return</span> 0;</div><div class="line"><a name="l01493"></a><span class="lineno"> 1493</span>&#160;</div><div class="line"><a name="l01494"></a><span class="lineno"> 1494</span>&#160;   <span class="comment">// Set the values</span></div><div class="line"><a name="l01495"></a><span class="lineno"> 1495</span>&#160;   <a class="code" href="classXrdProofdProofServMgr.html#aa10fdb50ded6eb18fbe118b0f8407027">fShutdownOpt</a> = (opt &gt; -1) ? opt : <a class="code" href="classXrdProofdProofServMgr.html#aa10fdb50ded6eb18fbe118b0f8407027">fShutdownOpt</a>;</div><div class="line"><a name="l01496"></a><span class="lineno"> 1496</span>&#160;   <a class="code" href="classXrdProofdProofServMgr.html#a4d745a9880deae66b89a3536e3d21cf0">fShutdownDelay</a> = (delay &gt; -1) ? delay : <a class="code" href="classXrdProofdProofServMgr.html#a4d745a9880deae66b89a3536e3d21cf0">fShutdownDelay</a>;</div><div class="line"><a name="l01497"></a><span class="lineno"> 1497</span>&#160;</div><div class="line"><a name="l01498"></a><span class="lineno"> 1498</span>&#160;   <span class="keywordflow">return</span> 0;</div><div class="line"><a name="l01499"></a><span class="lineno"> 1499</span>&#160;}</div><div class="line"><a name="l01500"></a><span class="lineno"> 1500</span>&#160;<span class="comment"></span></div><div class="line"><a name="l01501"></a><span class="lineno"> 1501</span>&#160;<span class="comment">////////////////////////////////////////////////////////////////////////////////</span></div><div class="line"><a name="l01502"></a><span class="lineno"> 1502</span>&#160;<span class="comment">/// Process manager request</span></div><div class="line"><a name="l01503"></a><span class="lineno"> 1503</span>&#160;<span class="comment"></span></div><div class="line"><a name="l01504"></a><span class="lineno"><a class="line" href="classXrdProofdProofServMgr.html#adca5540d7e00aac5e5e5e1438e3b02fc"> 1504</a></span>&#160;<span class="keywordtype">int</span> <a class="code" href="classXrdProofdProofServMgr.html#adca5540d7e00aac5e5e5e1438e3b02fc">XrdProofdProofServMgr::Process</a>(<a class="code" href="classXrdProofdProtocol.html">XrdProofdProtocol</a> *p)</div><div class="line"><a name="l01505"></a><span class="lineno"> 1505</span>&#160;{</div><div class="line"><a name="l01506"></a><span class="lineno"> 1506</span>&#160;   <a class="code" href="XrdProofdTrace_8h.html#a7c31822912a8d0dc9bfd544097b29e12">XPDLOC</a>(SMGR, <span class="stringliteral">&quot;ProofServMgr::Process&quot;</span>)</div><div class="line"><a name="l01507"></a><span class="lineno"> 1507</span>&#160;</div><div class="line"><a name="l01508"></a><span class="lineno"> 1508</span>&#160;   <span class="keywordtype">int</span> rc = 1;</div><div class="line"><a name="l01509"></a><span class="lineno"> 1509</span>&#160;   <a class="code" href="XrdProofdProtocol_8h.html#a877c158bc5a36171e7e5a4be25f6b4cb">XPD_SETRESP</a>(p, <span class="stringliteral">&quot;Process&quot;</span>);</div><div class="line"><a name="l01510"></a><span class="lineno"> 1510</span>&#160;</div><div class="line"><a name="l01511"></a><span class="lineno"> 1511</span>&#160;   <a class="code" href="XrdProofdTrace_8h.html#a83f50a6ac1ca86524725ed11340e3b26">TRACEP</a>(p, REQ, <span class="stringliteral">&quot;enter: req id: &quot;</span> &lt;&lt; p-&gt;<a class="code" href="classXrdProofdProtocol.html#a279527394516a18ef610489a4ab1ddfd">Request</a>()-&gt;<a class="code" href="unionXPClientRequest.html#a7875e257cdd4c874291d5a79d0370670">header</a>.requestid &lt;&lt; <span class="stringliteral">&quot; (&quot;</span> &lt;&lt;</div><div class="line"><a name="l01512"></a><span class="lineno"> 1512</span>&#160;                <a class="code" href="classXrdProofdAux.html#a6903e0e276399459b0a8d11b737ea0df">XrdProofdAux::ProofRequestTypes</a>(p-&gt;<a class="code" href="classXrdProofdProtocol.html#a279527394516a18ef610489a4ab1ddfd">Request</a>()-&gt;<a class="code" href="unionXPClientRequest.html#a7875e257cdd4c874291d5a79d0370670">header</a>.requestid) &lt;&lt; <span class="stringliteral">&quot;)&quot;</span>);</div><div class="line"><a name="l01513"></a><span class="lineno"> 1513</span>&#160;</div><div class="line"><a name="l01514"></a><span class="lineno"> 1514</span>&#160;   <a class="code" href="XrdSysToOuc_8h.html#a4ba18bedbb8a1a4367d57f49a4d773ce">XrdSysMutexHelper</a> mtxh(p-&gt;<a class="code" href="classXrdProofdProtocol.html#a80024c8f848d0eabe9f13d09f06c8d9d">Client</a>()-&gt;<a class="code" href="classXrdProofdClient.html#a4f2f5c7fba0cb2b985b58a73d8fd17d1">Mutex</a>());</div><div class="line"><a name="l01515"></a><span class="lineno"> 1515</span>&#160;</div><div class="line"><a name="l01516"></a><span class="lineno"> 1516</span>&#160;   <span class="comment">// Once logged-in, the user can request the real actions</span></div><div class="line"><a name="l01517"></a><span class="lineno"> 1517</span>&#160;   XrdOucString emsg(<span class="stringliteral">&quot;Invalid request code: &quot;</span>);</div><div class="line"><a name="l01518"></a><span class="lineno"> 1518</span>&#160;</div><div class="line"><a name="l01519"></a><span class="lineno"> 1519</span>&#160;   <span class="keywordtype">int</span> twait = 20;</div><div class="line"><a name="l01520"></a><span class="lineno"> 1520</span>&#160;</div><div class="line"><a name="l01521"></a><span class="lineno"> 1521</span>&#160;   <span class="keywordflow">if</span> (<a class="code" href="classXrdProofdProofServMgr.html#a2ad6176eb419d7edd51704580d006993">Pipe</a>()-&gt;Post(<a class="code" href="classXrdProofdProofServMgr.html#aaebdf9da139d40cf89c6c98f38941c97a75fd20e4a8f0ea218112713cd86648f1">XrdProofdProofServMgr::kProcessReq</a>, 0) != 0) {</div><div class="line"><a name="l01522"></a><span class="lineno"> 1522</span>&#160;      response-&gt;Send(kXR_ServerError,</div><div class="line"><a name="l01523"></a><span class="lineno"> 1523</span>&#160;                     <span class="stringliteral">&quot;ProofServMgr::Process: error posting internal pipe for authorization to proceed&quot;</span>);</div><div class="line"><a name="l01524"></a><span class="lineno"> 1524</span>&#160;      <span class="keywordflow">return</span> 0;</div><div class="line"><a name="l01525"></a><span class="lineno"> 1525</span>&#160;   }</div><div class="line"><a name="l01526"></a><span class="lineno"> 1526</span>&#160;   <span class="keywordflow">if</span> (<a class="code" href="classXrdProofdProofServMgr.html#a609c36fd5158c76f721bb519e4b088a2">fProcessSem</a>.Wait(twait) != 0) {</div><div class="line"><a name="l01527"></a><span class="lineno"> 1527</span>&#160;      response-&gt;Send(kXR_ServerError,</div><div class="line"><a name="l01528"></a><span class="lineno"> 1528</span>&#160;                     <span class="stringliteral">&quot;ProofServMgr::Process: timed-out waiting for authorization to proceed - retry later&quot;</span>);</div><div class="line"><a name="l01529"></a><span class="lineno"> 1529</span>&#160;      <span class="keywordflow">return</span> 0;</div><div class="line"><a name="l01530"></a><span class="lineno"> 1530</span>&#160;   }</div><div class="line"><a name="l01531"></a><span class="lineno"> 1531</span>&#160;</div><div class="line"><a name="l01532"></a><span class="lineno"> 1532</span>&#160;   <span class="comment">// This is needed to block the session checks</span></div><div class="line"><a name="l01533"></a><span class="lineno"> 1533</span>&#160;   <a class="code" href="classXpdSrvMgrCreateCnt.html">XpdSrvMgrCreateCnt</a> <a class="code" href="namespacexmlio.html#a7da9572bcb8815ae48bc1845efd235b5">cnt</a>(<span class="keyword">this</span>, <a class="code" href="classXrdProofdProofServMgr.html#a34c425cdb5ec334f7c3b7acc2fa335e5a0892adb84f4f6028803f0f2404b61eaf">kProcessCnt</a>);</div><div class="line"><a name="l01534"></a><span class="lineno"> 1534</span>&#160;</div><div class="line"><a name="l01535"></a><span class="lineno"> 1535</span>&#160;   <span class="keywordflow">switch</span>(p-&gt;<a class="code" href="classXrdProofdProtocol.html#a279527394516a18ef610489a4ab1ddfd">Request</a>()-&gt;<a class="code" href="unionXPClientRequest.html#a7875e257cdd4c874291d5a79d0370670">header</a>.requestid) {</div><div class="line"><a name="l01536"></a><span class="lineno"> 1536</span>&#160;   <span class="keywordflow">case</span> <a class="code" href="XProofProtocol_8h.html#a106fb425aa6ca0edb82300aeed56691ca0dcc7175d63b5e2a9dc9ff81333fc7ac">kXP_create</a>:</div><div class="line"><a name="l01537"></a><span class="lineno"> 1537</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="classXrdProofdProofServMgr.html#a06f01db3e2c065960fa5f7f6cd99e496">Create</a>(p);</div><div class="line"><a name="l01538"></a><span class="lineno"> 1538</span>&#160;   <span class="keywordflow">case</span> <a class="code" href="XProofProtocol_8h.html#a106fb425aa6ca0edb82300aeed56691ca143f9d85b3baf54ea98a183034caa868">kXP_destroy</a>:</div><div class="line"><a name="l01539"></a><span class="lineno"> 1539</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="classXrdProofdProofServMgr.html#a0e92367d300d1b4fb4ef15f06a565161">Destroy</a>(p);</div><div class="line"><a name="l01540"></a><span class="lineno"> 1540</span>&#160;   <span class="keywordflow">case</span> <a class="code" href="XProofProtocol_8h.html#a106fb425aa6ca0edb82300aeed56691ca76c907aca98007ff7c6563fddde22105">kXP_attach</a>:</div><div class="line"><a name="l01541"></a><span class="lineno"> 1541</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="classXrdProofdProofServMgr.html#a0624277b0d6c9aeecdbc3095b1471435">Attach</a>(p);</div><div class="line"><a name="l01542"></a><span class="lineno"> 1542</span>&#160;   <span class="keywordflow">case</span> <a class="code" href="XProofProtocol_8h.html#a106fb425aa6ca0edb82300aeed56691ca62ea20a1f97e416e18f07fad9f8339f8">kXP_detach</a>:</div><div class="line"><a name="l01543"></a><span class="lineno"> 1543</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="classXrdProofdProofServMgr.html#a21d2bc568b3bc3611b359d56e6f24da2">Detach</a>(p);</div><div class="line"><a name="l01544"></a><span class="lineno"> 1544</span>&#160;   <span class="keywordflow">default</span>:</div><div class="line"><a name="l01545"></a><span class="lineno"> 1545</span>&#160;      emsg += p-&gt;<a class="code" href="classXrdProofdProtocol.html#a279527394516a18ef610489a4ab1ddfd">Request</a>()-&gt;<a class="code" href="unionXPClientRequest.html#a7875e257cdd4c874291d5a79d0370670">header</a>.requestid;</div><div class="line"><a name="l01546"></a><span class="lineno"> 1546</span>&#160;      <span class="keywordflow">break</span>;</div><div class="line"><a name="l01547"></a><span class="lineno"> 1547</span>&#160;   }</div><div class="line"><a name="l01548"></a><span class="lineno"> 1548</span>&#160;</div><div class="line"><a name="l01549"></a><span class="lineno"> 1549</span>&#160;   <span class="comment">// Whatever we have, it&#39;s not valid</span></div><div class="line"><a name="l01550"></a><span class="lineno"> 1550</span>&#160;   response-&gt;Send(kXR_InvalidRequest, emsg.c_str());</div><div class="line"><a name="l01551"></a><span class="lineno"> 1551</span>&#160;   <span class="keywordflow">return</span> 0;</div><div class="line"><a name="l01552"></a><span class="lineno"> 1552</span>&#160;}</div><div class="line"><a name="l01553"></a><span class="lineno"> 1553</span>&#160;<span class="comment"></span></div><div class="line"><a name="l01554"></a><span class="lineno"> 1554</span>&#160;<span class="comment">////////////////////////////////////////////////////////////////////////////////</span></div><div class="line"><a name="l01555"></a><span class="lineno"> 1555</span>&#160;<span class="comment">/// Handle a request to attach to an existing session</span></div><div class="line"><a name="l01556"></a><span class="lineno"> 1556</span>&#160;<span class="comment"></span></div><div class="line"><a name="l01557"></a><span class="lineno"><a class="line" href="classXrdProofdProofServMgr.html#a0624277b0d6c9aeecdbc3095b1471435"> 1557</a></span>&#160;<span class="keywordtype">int</span> <a class="code" href="classXrdProofdProofServMgr.html#a0624277b0d6c9aeecdbc3095b1471435">XrdProofdProofServMgr::Attach</a>(<a class="code" href="classXrdProofdProtocol.html">XrdProofdProtocol</a> *p)</div><div class="line"><a name="l01558"></a><span class="lineno"> 1558</span>&#160;{</div><div class="line"><a name="l01559"></a><span class="lineno"> 1559</span>&#160;   <a class="code" href="XrdProofdTrace_8h.html#a7c31822912a8d0dc9bfd544097b29e12">XPDLOC</a>(SMGR, <span class="stringliteral">&quot;ProofServMgr::Attach&quot;</span>)</div><div class="line"><a name="l01560"></a><span class="lineno"> 1560</span>&#160;</div><div class="line"><a name="l01561"></a><span class="lineno"> 1561</span>&#160;   <span class="keywordtype">int</span> psid = -1, rc = 0;</div><div class="line"><a name="l01562"></a><span class="lineno"> 1562</span>&#160;   <a class="code" href="XrdProofdProtocol_8h.html#a877c158bc5a36171e7e5a4be25f6b4cb">XPD_SETRESP</a>(p, <span class="stringliteral">&quot;Attach&quot;</span>);</div><div class="line"><a name="l01563"></a><span class="lineno"> 1563</span>&#160;</div><div class="line"><a name="l01564"></a><span class="lineno"> 1564</span>&#160;   <span class="comment">// Unmarshall the data</span></div><div class="line"><a name="l01565"></a><span class="lineno"> 1565</span>&#160;   psid = ntohl(p-&gt;<a class="code" href="classXrdProofdProtocol.html#a279527394516a18ef610489a4ab1ddfd">Request</a>()-&gt;<a class="code" href="unionXPClientRequest.html#a86d728b0d38bc6ff0b92a9fb0b69bd0c">proof</a>.<a class="code" href="structXPClientProofRequest.html#a8aa8a8c9f18a796682b3ef3f787493fa">sid</a>);</div><div class="line"><a name="l01566"></a><span class="lineno"> 1566</span>&#160;   <a class="code" href="XrdProofdTrace_8h.html#a83f50a6ac1ca86524725ed11340e3b26">TRACEP</a>(p, REQ, <span class="stringliteral">&quot;psid: &quot;</span>&lt;&lt;psid&lt;&lt;<span class="stringliteral">&quot;, CID = &quot;</span>&lt;&lt;p-&gt;<a class="code" href="classXrdProofdProtocol.html#a934bd88037498a09c684297fca7b664f">CID</a>());</div><div class="line"><a name="l01567"></a><span class="lineno"> 1567</span>&#160;</div><div class="line"><a name="l01568"></a><span class="lineno"> 1568</span>&#160;   <span class="comment">// The client instance must be defined</span></div><div class="line"><a name="l01569"></a><span class="lineno"> 1569</span>&#160;   <a class="code" href="classXrdProofdClient.html">XrdProofdClient</a> *<a class="code" href="RSha256_8hxx.html#a63f410abde93141c9013b7d3f3971738">c</a> = p-&gt;<a class="code" href="classXrdProofdProtocol.html#a80024c8f848d0eabe9f13d09f06c8d9d">Client</a>();</div><div class="line"><a name="l01570"></a><span class="lineno"> 1570</span>&#160;   <span class="keywordflow">if</span> (!<a class="code" href="RSha256_8hxx.html#a63f410abde93141c9013b7d3f3971738">c</a>) {</div><div class="line"><a name="l01571"></a><span class="lineno"> 1571</span>&#160;      <a class="code" href="XrdProofdTrace_8h.html#a83f50a6ac1ca86524725ed11340e3b26">TRACEP</a>(p, XERR, <span class="stringliteral">&quot;client instance undefined&quot;</span>);</div><div class="line"><a name="l01572"></a><span class="lineno"> 1572</span>&#160;      response-&gt;Send(kXR_ServerError,<span class="stringliteral">&quot;client instance undefined&quot;</span>);</div><div class="line"><a name="l01573"></a><span class="lineno"> 1573</span>&#160;      <span class="keywordflow">return</span> 0;</div><div class="line"><a name="l01574"></a><span class="lineno"> 1574</span>&#160;   }</div><div class="line"><a name="l01575"></a><span class="lineno"> 1575</span>&#160;</div><div class="line"><a name="l01576"></a><span class="lineno"> 1576</span>&#160;   <span class="comment">// Find server session; sessions maybe recovering, so we need to take</span></div><div class="line"><a name="l01577"></a><span class="lineno"> 1577</span>&#160;   <span class="comment">// that into account</span></div><div class="line"><a name="l01578"></a><span class="lineno"> 1578</span>&#160;   <a class="code" href="classXrdProofdProofServ.html">XrdProofdProofServ</a> *xps = 0;</div><div class="line"><a name="l01579"></a><span class="lineno"> 1579</span>&#160;   <span class="keywordtype">int</span> now = time(0);</div><div class="line"><a name="l01580"></a><span class="lineno"> 1580</span>&#160;   <span class="keywordtype">int</span> deadline = -1, defdeadline = now + <a class="code" href="classXrdProofdProofServMgr.html#aa150146266359bec018e9b443e49818d">fRecoverTimeOut</a>;</div><div class="line"><a name="l01581"></a><span class="lineno"> 1581</span>&#160;   <span class="keywordflow">while</span> ((deadline &lt; 0) || (now &lt; deadline)) {</div><div class="line"><a name="l01582"></a><span class="lineno"> 1582</span>&#160;      <span class="keywordflow">if</span> (!(xps = <a class="code" href="RSha256_8hxx.html#a63f410abde93141c9013b7d3f3971738">c</a>-&gt;GetServer(psid)) || !xps-&gt;<a class="code" href="classXrdProofdProofServ.html#af67067c8b8f82303367b9307350c6e59">IsValid</a>()) {</div><div class="line"><a name="l01583"></a><span class="lineno"> 1583</span>&#160;         <span class="comment">// If the client is recovering start regular checks</span></div><div class="line"><a name="l01584"></a><span class="lineno"> 1584</span>&#160;         <span class="keywordflow">if</span> (!<a class="code" href="classXrdProofdProofServMgr.html#a3aef7efdf20b92f8db384ff26aa5f7fc">IsClientRecovering</a>(<a class="code" href="RSha256_8hxx.html#a63f410abde93141c9013b7d3f3971738">c</a>-&gt;User(), <a class="code" href="RSha256_8hxx.html#a63f410abde93141c9013b7d3f3971738">c</a>-&gt;Group(), deadline)) {</div><div class="line"><a name="l01585"></a><span class="lineno"> 1585</span>&#160;            <span class="comment">// Failure</span></div><div class="line"><a name="l01586"></a><span class="lineno"> 1586</span>&#160;            <a class="code" href="XrdProofdTrace_8h.html#a83f50a6ac1ca86524725ed11340e3b26">TRACEP</a>(p, XERR, <span class="stringliteral">&quot;session ID not found: &quot;</span>&lt;&lt;psid);</div><div class="line"><a name="l01587"></a><span class="lineno"> 1587</span>&#160;            response-&gt;Send(kXR_InvalidRequest,<span class="stringliteral">&quot;session ID not found&quot;</span>);</div><div class="line"><a name="l01588"></a><span class="lineno"> 1588</span>&#160;            <span class="keywordflow">return</span> 0;</div><div class="line"><a name="l01589"></a><span class="lineno"> 1589</span>&#160;         } <span class="keywordflow">else</span> {</div><div class="line"><a name="l01590"></a><span class="lineno"> 1590</span>&#160;            <span class="comment">// Make dure we do not enter an infinite loop</span></div><div class="line"><a name="l01591"></a><span class="lineno"> 1591</span>&#160;            deadline = (deadline &gt; 0) ? deadline : defdeadline;</div><div class="line"><a name="l01592"></a><span class="lineno"> 1592</span>&#160;            <span class="comment">// Wait until deadline in 1 sec steps</span></div><div class="line"><a name="l01593"></a><span class="lineno"> 1593</span>&#160;            <a class="code" href="TPosixThread_8h.html#ab708b36917a193216583824c37326042">sleep</a>(1);</div><div class="line"><a name="l01594"></a><span class="lineno"> 1594</span>&#160;            now++;</div><div class="line"><a name="l01595"></a><span class="lineno"> 1595</span>&#160;         }</div><div class="line"><a name="l01596"></a><span class="lineno"> 1596</span>&#160;      } <span class="keywordflow">else</span> {</div><div class="line"><a name="l01597"></a><span class="lineno"> 1597</span>&#160;         <span class="comment">// Found</span></div><div class="line"><a name="l01598"></a><span class="lineno"> 1598</span>&#160;         <span class="keywordflow">break</span>;</div><div class="line"><a name="l01599"></a><span class="lineno"> 1599</span>&#160;      }</div><div class="line"><a name="l01600"></a><span class="lineno"> 1600</span>&#160;   }</div><div class="line"><a name="l01601"></a><span class="lineno"> 1601</span>&#160;   <span class="comment">// If we deadline we should fail now</span></div><div class="line"><a name="l01602"></a><span class="lineno"> 1602</span>&#160;   <span class="keywordflow">if</span> (!xps || !xps-&gt;<a class="code" href="classXrdProofdProofServ.html#af67067c8b8f82303367b9307350c6e59">IsValid</a>()) {</div><div class="line"><a name="l01603"></a><span class="lineno"> 1603</span>&#160;      <a class="code" href="XrdProofdTrace_8h.html#a83f50a6ac1ca86524725ed11340e3b26">TRACEP</a>(p, XERR, <span class="stringliteral">&quot;session ID not found: &quot;</span>&lt;&lt;psid);</div><div class="line"><a name="l01604"></a><span class="lineno"> 1604</span>&#160;      response-&gt;Send(kXR_InvalidRequest,<span class="stringliteral">&quot;session ID not found&quot;</span>);</div><div class="line"><a name="l01605"></a><span class="lineno"> 1605</span>&#160;      <span class="keywordflow">return</span> 0;</div><div class="line"><a name="l01606"></a><span class="lineno"> 1606</span>&#160;   }</div><div class="line"><a name="l01607"></a><span class="lineno"> 1607</span>&#160;   <a class="code" href="XrdProofdTrace_8h.html#a83f50a6ac1ca86524725ed11340e3b26">TRACEP</a>(p, DBG, <span class="stringliteral">&quot;xps: &quot;</span>&lt;&lt;xps&lt;&lt;<span class="stringliteral">&quot;, status: &quot;</span>&lt;&lt; xps-&gt;<a class="code" href="classXrdProofdProofServ.html#a324107a325d536f3b3ff90057dbea63f">Status</a>());</div><div class="line"><a name="l01608"></a><span class="lineno"> 1608</span>&#160;</div><div class="line"><a name="l01609"></a><span class="lineno"> 1609</span>&#160;   <span class="comment">// Stream ID</span></div><div class="line"><a name="l01610"></a><span class="lineno"> 1610</span>&#160;   <span class="keywordtype">unsigned</span> <span class="keywordtype">short</span> sid;</div><div class="line"><a name="l01611"></a><span class="lineno"> 1611</span>&#160;   memcpy((<span class="keywordtype">void</span> *)&amp;sid, (<span class="keyword">const</span> <span class="keywordtype">void</span> *)&amp;(p-&gt;<a class="code" href="classXrdProofdProtocol.html#a279527394516a18ef610489a4ab1ddfd">Request</a>()-&gt;<a class="code" href="unionXPClientRequest.html#a7875e257cdd4c874291d5a79d0370670">header</a>.streamid[0]), 2);</div><div class="line"><a name="l01612"></a><span class="lineno"> 1612</span>&#160;</div><div class="line"><a name="l01613"></a><span class="lineno"> 1613</span>&#160;   <span class="comment">// We associate this instance to the corresponding slot in the</span></div><div class="line"><a name="l01614"></a><span class="lineno"> 1614</span>&#160;   <span class="comment">// session vector of attached clients</span></div><div class="line"><a name="l01615"></a><span class="lineno"> 1615</span>&#160;   <a class="code" href="classXrdClientID.html">XrdClientID</a> *csid = xps-&gt;<a class="code" href="classXrdProofdProofServ.html#a711a1ea4a1ce75e2b9b23674ad39b5cf">GetClientID</a>(p-&gt;<a class="code" href="classXrdProofdProtocol.html#a934bd88037498a09c684297fca7b664f">CID</a>());</div><div class="line"><a name="l01616"></a><span class="lineno"> 1616</span>&#160;   csid-&gt;<a class="code" href="classXrdClientID.html#a32d793141b4ff7145f4428e699c41c50">SetP</a>(p);</div><div class="line"><a name="l01617"></a><span class="lineno"> 1617</span>&#160;   csid-&gt;<a class="code" href="classXrdClientID.html#a55e95e912daffe7f70328f52ae6354a5">SetSid</a>(sid);</div><div class="line"><a name="l01618"></a><span class="lineno"> 1618</span>&#160;</div><div class="line"><a name="l01619"></a><span class="lineno"> 1619</span>&#160;   <span class="comment">// Take parentship, if orphalin</span></div><div class="line"><a name="l01620"></a><span class="lineno"> 1620</span>&#160;   <span class="keywordflow">if</span> (!(xps-&gt;<a class="code" href="classXrdProofdProofServ.html#afa65a2a39d7a18b03045d4c8ce664f21">Parent</a>()))</div><div class="line"><a name="l01621"></a><span class="lineno"> 1621</span>&#160;      xps-&gt;<a class="code" href="classXrdProofdProofServ.html#af3d27e79060c14989be2ee8728ea95cb">SetParent</a>(csid);</div><div class="line"><a name="l01622"></a><span class="lineno"> 1622</span>&#160;</div><div class="line"><a name="l01623"></a><span class="lineno"> 1623</span>&#160;   <span class="comment">// Notify to user</span></div><div class="line"><a name="l01624"></a><span class="lineno"> 1624</span>&#160;   <span class="keywordtype">int</span> protvers = (xps &amp;&amp; xps-&gt;<a class="code" href="classXrdProofdProofServ.html#a18e4a17f4e9ef07f923b654e2d000148">ROOT</a>()) ? xps-&gt;<a class="code" href="classXrdProofdProofServ.html#a18e4a17f4e9ef07f923b654e2d000148">ROOT</a>()-&gt;<a class="code" href="classXrdROOT.html#a9c3ee0a503928edaab2675dd4d6638b0">SrvProtVers</a>() : -1;</div><div class="line"><a name="l01625"></a><span class="lineno"> 1625</span>&#160;   <span class="keywordflow">if</span> (p-&gt;<a class="code" href="classXrdProofdProtocol.html#a71898b7c3788b133364db067d1f47c24">ConnType</a>() == <a class="code" href="XProofProtocol_8h.html#a288e0bf1dc365d01a746a4917afec0a1">kXPD_ClientMaster</a>) {</div><div class="line"><a name="l01626"></a><span class="lineno"> 1626</span>&#160;      <span class="comment">// Send also back the data pool url</span></div><div class="line"><a name="l01627"></a><span class="lineno"> 1627</span>&#160;      XrdOucString dpu = <a class="code" href="classXrdProofdProofServMgr.html#a86cac591a5646811e38ff6a2477f4da7">fMgr</a>-&gt;<a class="code" href="classXrdProofdManager.html#a42d408e2536d05e8713e2adf87689977">PoolURL</a>();</div><div class="line"><a name="l01628"></a><span class="lineno"> 1628</span>&#160;      <span class="keywordflow">if</span> (!dpu.endswith(<span class="charliteral">&#39;/&#39;</span>))</div><div class="line"><a name="l01629"></a><span class="lineno"> 1629</span>&#160;         dpu += <span class="charliteral">&#39;/&#39;</span>;</div><div class="line"><a name="l01630"></a><span class="lineno"> 1630</span>&#160;      dpu += <a class="code" href="classXrdProofdProofServMgr.html#a86cac591a5646811e38ff6a2477f4da7">fMgr</a>-&gt;<a class="code" href="classXrdProofdManager.html#ae598fde488562ef54ee12a3a3135848c">NameSpace</a>();</div><div class="line"><a name="l01631"></a><span class="lineno"> 1631</span>&#160;      response-&gt;SendI(psid, protvers, (kXR_int16)<a class="code" href="XrdProofdProtocol_8h.html#a0e4fcddb4216e202dd3e6517d1683c9b">XPROOFD_VERSBIN</a>,</div><div class="line"><a name="l01632"></a><span class="lineno"> 1632</span>&#160;                           (<span class="keywordtype">void</span> *) dpu.c_str(), dpu.length());</div><div class="line"><a name="l01633"></a><span class="lineno"> 1633</span>&#160;   } <span class="keywordflow">else</span></div><div class="line"><a name="l01634"></a><span class="lineno"> 1634</span>&#160;      response-&gt;SendI(psid, protvers, (kXR_int16)<a class="code" href="XrdProofdProtocol_8h.html#a0e4fcddb4216e202dd3e6517d1683c9b">XPROOFD_VERSBIN</a>);</div><div class="line"><a name="l01635"></a><span class="lineno"> 1635</span>&#160;</div><div class="line"><a name="l01636"></a><span class="lineno"> 1636</span>&#160;   <span class="comment">// Send saved start processing message, if not idle</span></div><div class="line"><a name="l01637"></a><span class="lineno"> 1637</span>&#160;   <span class="keywordflow">if</span> (xps-&gt;<a class="code" href="classXrdProofdProofServ.html#a324107a325d536f3b3ff90057dbea63f">Status</a>() == <a class="code" href="XProofProtocol_8h.html#a3a4503f87fa152df23df4d274f07b932a7bf0d5731cd0e6bf8fd0e26861b8c2af">kXPD_running</a> &amp;&amp; xps-&gt;<a class="code" href="classXrdProofdProofServ.html#abaa4ec219ac74d9b596cd2a95de1b3a0">StartMsg</a>()) {</div><div class="line"><a name="l01638"></a><span class="lineno"> 1638</span>&#160;      <a class="code" href="XrdProofdTrace_8h.html#a83f50a6ac1ca86524725ed11340e3b26">TRACEP</a>(p, XERR, <span class="stringliteral">&quot;sending start process message (&quot;</span>&lt;&lt;xps-&gt;<a class="code" href="classXrdProofdProofServ.html#abaa4ec219ac74d9b596cd2a95de1b3a0">StartMsg</a>()-&gt;<a class="code" href="classXrdSrvBuffer.html#a910c9b58a1a348e8de8d8c6e017618e5">fSize</a>&lt;&lt;<span class="stringliteral">&quot; bytes)&quot;</span>);</div><div class="line"><a name="l01639"></a><span class="lineno"> 1639</span>&#160;      response-&gt;Send(kXR_attn, <a class="code" href="XProofProtocol_8h.html#af90b47a2dd37c58ac6f67e16c279e27ba23e2cb17a38a083e0d2fc2744f167d79">kXPD_msg</a>,</div><div class="line"><a name="l01640"></a><span class="lineno"> 1640</span>&#160;                          xps-&gt;<a class="code" href="classXrdProofdProofServ.html#abaa4ec219ac74d9b596cd2a95de1b3a0">StartMsg</a>()-&gt;<a class="code" href="classXrdSrvBuffer.html#a35e9e522481d1e4104463e7a7b9798d6">fBuff</a>, xps-&gt;<a class="code" href="classXrdProofdProofServ.html#abaa4ec219ac74d9b596cd2a95de1b3a0">StartMsg</a>()-&gt;<a class="code" href="classXrdSrvBuffer.html#a910c9b58a1a348e8de8d8c6e017618e5">fSize</a>);</div><div class="line"><a name="l01641"></a><span class="lineno"> 1641</span>&#160;   }</div><div class="line"><a name="l01642"></a><span class="lineno"> 1642</span>&#160;</div><div class="line"><a name="l01643"></a><span class="lineno"> 1643</span>&#160;   <span class="comment">// Over</span></div><div class="line"><a name="l01644"></a><span class="lineno"> 1644</span>&#160;   <span class="keywordflow">return</span> 0;</div><div class="line"><a name="l01645"></a><span class="lineno"> 1645</span>&#160;}</div><div class="line"><a name="l01646"></a><span class="lineno"> 1646</span>&#160;<span class="comment"></span></div><div class="line"><a name="l01647"></a><span class="lineno"> 1647</span>&#160;<span class="comment">////////////////////////////////////////////////////////////////////////////////</span></div><div class="line"><a name="l01648"></a><span class="lineno"> 1648</span>&#160;<span class="comment">/// Allocate and prepare the XrdProofdProofServ object describing this session</span></div><div class="line"><a name="l01649"></a><span class="lineno"> 1649</span>&#160;<span class="comment"></span></div><div class="line"><a name="l01650"></a><span class="lineno"><a class="line" href="classXrdProofdProofServMgr.html#a0964e25c122bd4285174d91425e62cd3"> 1650</a></span>&#160;<a class="code" href="classXrdProofdProofServ.html">XrdProofdProofServ</a> *<a class="code" href="classXrdProofdProofServMgr.html#a0964e25c122bd4285174d91425e62cd3">XrdProofdProofServMgr::PrepareProofServ</a>(<a class="code" href="classXrdProofdProtocol.html">XrdProofdProtocol</a> *p,</div><div class="line"><a name="l01651"></a><span class="lineno"> 1651</span>&#160;                                                            <a class="code" href="classXrdProofdResponse.html">XrdProofdResponse</a> *<a class="code" href="Object_8C.html#ac15f01b9c6407e1312dfc196ad4e0870">r</a>,</div><div class="line"><a name="l01652"></a><span class="lineno"> 1652</span>&#160;                                                            <span class="keywordtype">unsigned</span> <span class="keywordtype">short</span> &amp;sid)</div><div class="line"><a name="l01653"></a><span class="lineno"> 1653</span>&#160;{</div><div class="line"><a name="l01654"></a><span class="lineno"> 1654</span>&#160;   <a class="code" href="XrdProofdTrace_8h.html#a7c31822912a8d0dc9bfd544097b29e12">XPDLOC</a>(SMGR, <span class="stringliteral">&quot;ProofServMgr::PrepareProofServ&quot;</span>)</div><div class="line"><a name="l01655"></a><span class="lineno"> 1655</span>&#160;</div><div class="line"><a name="l01656"></a><span class="lineno"> 1656</span>&#160;   <span class="comment">// Allocate next free server ID and fill in the basic stuff</span></div><div class="line"><a name="l01657"></a><span class="lineno"> 1657</span>&#160;   <a class="code" href="classXrdProofdProofServ.html">XrdProofdProofServ</a> *xps = p-&gt;<a class="code" href="classXrdProofdProtocol.html#a80024c8f848d0eabe9f13d09f06c8d9d">Client</a>()-&gt;<a class="code" href="classXrdProofdClient.html#a3ec412bd59e2569ddd1e76962174ffc6">GetFreeServObj</a>();</div><div class="line"><a name="l01658"></a><span class="lineno"> 1658</span>&#160;   xps-&gt;<a class="code" href="classXrdProofdProofServ.html#a27032cb1504f86124bb5c97a96826c86">SetClient</a>(p-&gt;<a class="code" href="classXrdProofdProtocol.html#a80024c8f848d0eabe9f13d09f06c8d9d">Client</a>()-&gt;<a class="code" href="classXrdProofdClient.html#a3cbe604999cdb44ae9d0ec833ffa5900">User</a>());</div><div class="line"><a name="l01659"></a><span class="lineno"> 1659</span>&#160;   xps-&gt;<a class="code" href="classXrdProofdProofServ.html#a70b3e722619f6b005fff6ed9937da178">SetSrvType</a>(p-&gt;<a class="code" href="classXrdProofdProtocol.html#a71898b7c3788b133364db067d1f47c24">ConnType</a>());</div><div class="line"><a name="l01660"></a><span class="lineno"> 1660</span>&#160;</div><div class="line"><a name="l01661"></a><span class="lineno"> 1661</span>&#160;   <span class="comment">// Prepare the stream identifier</span></div><div class="line"><a name="l01662"></a><span class="lineno"> 1662</span>&#160;   memcpy((<span class="keywordtype">void</span> *)&amp;sid, (<span class="keyword">const</span> <span class="keywordtype">void</span> *)&amp;(p-&gt;<a class="code" href="classXrdProofdProtocol.html#a279527394516a18ef610489a4ab1ddfd">Request</a>()-&gt;<a class="code" href="unionXPClientRequest.html#a7875e257cdd4c874291d5a79d0370670">header</a>.streamid[0]), 2);</div><div class="line"><a name="l01663"></a><span class="lineno"> 1663</span>&#160;   <span class="comment">// We associate this instance to the corresponding slot in the</span></div><div class="line"><a name="l01664"></a><span class="lineno"> 1664</span>&#160;   <span class="comment">// session vector of attached clients</span></div><div class="line"><a name="l01665"></a><span class="lineno"> 1665</span>&#160;   <a class="code" href="classXrdClientID.html">XrdClientID</a> *csid = xps-&gt;<a class="code" href="classXrdProofdProofServ.html#a711a1ea4a1ce75e2b9b23674ad39b5cf">GetClientID</a>(p-&gt;<a class="code" href="classXrdProofdProtocol.html#a934bd88037498a09c684297fca7b664f">CID</a>());</div><div class="line"><a name="l01666"></a><span class="lineno"> 1666</span>&#160;   csid-&gt;<a class="code" href="classXrdClientID.html#a55e95e912daffe7f70328f52ae6354a5">SetSid</a>(sid);</div><div class="line"><a name="l01667"></a><span class="lineno"> 1667</span>&#160;   csid-&gt;<a class="code" href="classXrdClientID.html#a32d793141b4ff7145f4428e699c41c50">SetP</a>(p);</div><div class="line"><a name="l01668"></a><span class="lineno"> 1668</span>&#160;   <span class="comment">// Take parentship, if orphalin</span></div><div class="line"><a name="l01669"></a><span class="lineno"> 1669</span>&#160;   xps-&gt;<a class="code" href="classXrdProofdProofServ.html#af3d27e79060c14989be2ee8728ea95cb">SetParent</a>(csid);</div><div class="line"><a name="l01670"></a><span class="lineno"> 1670</span>&#160;</div><div class="line"><a name="l01671"></a><span class="lineno"> 1671</span>&#160;   <span class="comment">// The ROOT version to be used</span></div><div class="line"><a name="l01672"></a><span class="lineno"> 1672</span>&#160;   xps-&gt;<a class="code" href="classXrdProofdProofServ.html#a3dbee8f1d9ea9677ef49ad0a01fa72db">SetROOT</a>(p-&gt;<a class="code" href="classXrdProofdProtocol.html#a80024c8f848d0eabe9f13d09f06c8d9d">Client</a>()-&gt;<a class="code" href="classXrdProofdClient.html#a55c0e73c9bca2a64fd6417d750db02e2">ROOT</a>());</div><div class="line"><a name="l01673"></a><span class="lineno"> 1673</span>&#160;   XrdOucString msg;</div><div class="line"><a name="l01674"></a><span class="lineno"> 1674</span>&#160;   <a class="code" href="XrdProofdAux_8h.html#a631cc8787af1a02d9e51c86117ae042e">XPDFORM</a>(msg, <span class="stringliteral">&quot;using ROOT version: %s&quot;</span>, xps-&gt;<a class="code" href="classXrdProofdProofServ.html#a18e4a17f4e9ef07f923b654e2d000148">ROOT</a>()-&gt;<a class="code" href="classXrdROOT.html#a81156bb540f240c237296609f3db8a91">Export</a>());</div><div class="line"><a name="l01675"></a><span class="lineno"> 1675</span>&#160;   <a class="code" href="XrdProofdTrace_8h.html#a83f50a6ac1ca86524725ed11340e3b26">TRACEP</a>(p, REQ, msg);</div><div class="line"><a name="l01676"></a><span class="lineno"> 1676</span>&#160;   <span class="keywordflow">if</span> (p-&gt;<a class="code" href="classXrdProofdProtocol.html#a71898b7c3788b133364db067d1f47c24">ConnType</a>() == <a class="code" href="XProofProtocol_8h.html#a288e0bf1dc365d01a746a4917afec0a1">kXPD_ClientMaster</a>) {</div><div class="line"><a name="l01677"></a><span class="lineno"> 1677</span>&#160;      <span class="comment">// Notify the client if using a version different from the default one</span></div><div class="line"><a name="l01678"></a><span class="lineno"> 1678</span>&#160;      <span class="keywordflow">if</span> (<a class="code" href="classXrdProofdProofServMgr.html#a86cac591a5646811e38ff6a2477f4da7">fMgr</a> &amp;&amp; p-&gt;<a class="code" href="classXrdProofdProtocol.html#a80024c8f848d0eabe9f13d09f06c8d9d">Client</a>()-&gt;<a class="code" href="classXrdProofdClient.html#a55c0e73c9bca2a64fd6417d750db02e2">ROOT</a>() != <a class="code" href="classXrdProofdProofServMgr.html#a86cac591a5646811e38ff6a2477f4da7">fMgr</a>-&gt;<a class="code" href="classXrdProofdManager.html#a2f5b5d64f2d6f4f3b0f6f003f6183468">ROOTMgr</a>()-&gt;<a class="code" href="classXrdROOTMgr.html#a80d29c16a1fc5046abdea1ac9bc72dc7">DefaultVersion</a>()) {</div><div class="line"><a name="l01679"></a><span class="lineno"> 1679</span>&#160;         <a class="code" href="XrdProofdAux_8h.html#a631cc8787af1a02d9e51c86117ae042e">XPDFORM</a>(msg, <span class="stringliteral">&quot;++++ Using NON-default ROOT version: %s ++++\n&quot;</span>, xps-&gt;<a class="code" href="classXrdProofdProofServ.html#a18e4a17f4e9ef07f923b654e2d000148">ROOT</a>()-&gt;<a class="code" href="classXrdROOT.html#a81156bb540f240c237296609f3db8a91">Export</a>());</div><div class="line"><a name="l01680"></a><span class="lineno"> 1680</span>&#160;         <a class="code" href="Object_8C.html#ac15f01b9c6407e1312dfc196ad4e0870">r</a>-&gt;Send(kXR_attn, <a class="code" href="XProofProtocol_8h.html#af90b47a2dd37c58ac6f67e16c279e27bafd3f389e5b30b994109c42a3c43d3c0c">kXPD_srvmsg</a>, (<span class="keywordtype">char</span> *) msg.c_str(), msg.length());</div><div class="line"><a name="l01681"></a><span class="lineno"> 1681</span>&#160;      }</div><div class="line"><a name="l01682"></a><span class="lineno"> 1682</span>&#160;   }</div><div class="line"><a name="l01683"></a><span class="lineno"> 1683</span>&#160;</div><div class="line"><a name="l01684"></a><span class="lineno"> 1684</span>&#160;   <span class="comment">// Done</span></div><div class="line"><a name="l01685"></a><span class="lineno"> 1685</span>&#160;   <span class="keywordflow">return</span> xps;</div><div class="line"><a name="l01686"></a><span class="lineno"> 1686</span>&#160;}</div><div class="line"><a name="l01687"></a><span class="lineno"> 1687</span>&#160;<span class="comment"></span></div><div class="line"><a name="l01688"></a><span class="lineno"> 1688</span>&#160;<span class="comment">////////////////////////////////////////////////////////////////////////////////</span></div><div class="line"><a name="l01689"></a><span class="lineno"> 1689</span>&#160;<span class="comment">/// Extract relevant quantities from the buffer received during a create request</span></div><div class="line"><a name="l01690"></a><span class="lineno"> 1690</span>&#160;<span class="comment"></span></div><div class="line"><a name="l01691"></a><span class="lineno"><a class="line" href="classXrdProofdProofServMgr.html#a319d93533e5c4eb94170e7837ee27ab9"> 1691</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="classXrdProofdProofServMgr.html#a319d93533e5c4eb94170e7837ee27ab9">XrdProofdProofServMgr::ParseCreateBuffer</a>(<a class="code" href="classXrdProofdProtocol.html">XrdProofdProtocol</a> *p,</div><div class="line"><a name="l01692"></a><span class="lineno"> 1692</span>&#160;                                              <a class="code" href="classXrdProofdProofServ.html">XrdProofdProofServ</a> *xps,</div><div class="line"><a name="l01693"></a><span class="lineno"> 1693</span>&#160;                                              XrdOucString &amp;tag, XrdOucString &amp;ord,</div><div class="line"><a name="l01694"></a><span class="lineno"> 1694</span>&#160;                                              XrdOucString &amp;cffile,</div><div class="line"><a name="l01695"></a><span class="lineno"> 1695</span>&#160;                                              XrdOucString &amp;uenvs, <span class="keywordtype">int</span> &amp;intwait)</div><div class="line"><a name="l01696"></a><span class="lineno"> 1696</span>&#160;{</div><div class="line"><a name="l01697"></a><span class="lineno"> 1697</span>&#160;   <a class="code" href="XrdProofdTrace_8h.html#a7c31822912a8d0dc9bfd544097b29e12">XPDLOC</a>(SMGR, <span class="stringliteral">&quot;ProofServMgr::ParseCreateBuffer&quot;</span>)</div><div class="line"><a name="l01698"></a><span class="lineno"> 1698</span>&#160;</div><div class="line"><a name="l01699"></a><span class="lineno"> 1699</span>&#160;   <span class="comment">// Parse buffer</span></div><div class="line"><a name="l01700"></a><span class="lineno"> 1700</span>&#160;   <span class="keywordtype">char</span> *buf = p-&gt;<a class="code" href="classXrdProofdProtocol.html#a239a481ea6f6e555d46e19a2e8675ec4">Argp</a>()-&gt;buff;</div><div class="line"><a name="l01701"></a><span class="lineno"> 1701</span>&#160;   <span class="keywordtype">int</span>   len = p-&gt;<a class="code" href="classXrdProofdProtocol.html#a279527394516a18ef610489a4ab1ddfd">Request</a>()-&gt;<a class="code" href="unionXPClientRequest.html#a86d728b0d38bc6ff0b92a9fb0b69bd0c">proof</a>.<a class="code" href="structXPClientProofRequest.html#ae99987529a8600f113df406f0ee08bc5">dlen</a>;</div><div class="line"><a name="l01702"></a><span class="lineno"> 1702</span>&#160;</div><div class="line"><a name="l01703"></a><span class="lineno"> 1703</span>&#160;   <span class="comment">// Extract session tag</span></div><div class="line"><a name="l01704"></a><span class="lineno"> 1704</span>&#160;   tag.assign(buf,0,len-1);</div><div class="line"><a name="l01705"></a><span class="lineno"> 1705</span>&#160;</div><div class="line"><a name="l01706"></a><span class="lineno"> 1706</span>&#160;   <a class="code" href="XrdProofdTrace_8h.html#a83f50a6ac1ca86524725ed11340e3b26">TRACEP</a>(p, DBG, <span class="stringliteral">&quot;received buf: &quot;</span>&lt;&lt;tag);</div><div class="line"><a name="l01707"></a><span class="lineno"> 1707</span>&#160;</div><div class="line"><a name="l01708"></a><span class="lineno"> 1708</span>&#160;   tag.erase(tag.find(<span class="charliteral">&#39;|&#39;</span>));</div><div class="line"><a name="l01709"></a><span class="lineno"> 1709</span>&#160;   xps-&gt;<a class="code" href="classXrdProofdProofServ.html#a4b99be0402107389bc029cc36aba8e07">SetTag</a>(tag.c_str());</div><div class="line"><a name="l01710"></a><span class="lineno"> 1710</span>&#160;   <a class="code" href="XrdProofdTrace_8h.html#a83f50a6ac1ca86524725ed11340e3b26">TRACEP</a>(p, DBG, <span class="stringliteral">&quot;tag: &quot;</span>&lt;&lt;tag);</div><div class="line"><a name="l01711"></a><span class="lineno"> 1711</span>&#160;</div><div class="line"><a name="l01712"></a><span class="lineno"> 1712</span>&#160;   <span class="comment">// Extract ordinal number</span></div><div class="line"><a name="l01713"></a><span class="lineno"> 1713</span>&#160;   ord = <span class="stringliteral">&quot;0&quot;</span>;</div><div class="line"><a name="l01714"></a><span class="lineno"> 1714</span>&#160;   <span class="keywordflow">if</span> ((p-&gt;<a class="code" href="classXrdProofdProtocol.html#a71898b7c3788b133364db067d1f47c24">ConnType</a>() == <a class="code" href="XProofProtocol_8h.html#ad7a933edf8c125412fd985f6f2bc771e">kXPD_MasterWorker</a>) || (p-&gt;<a class="code" href="classXrdProofdProtocol.html#a71898b7c3788b133364db067d1f47c24">ConnType</a>() == <a class="code" href="XProofProtocol_8h.html#aa5c5130daa268ee7fcf81faff68e7220">kXPD_MasterMaster</a>)) {</div><div class="line"><a name="l01715"></a><span class="lineno"> 1715</span>&#160;      ord.assign(buf,0,len-1);</div><div class="line"><a name="l01716"></a><span class="lineno"> 1716</span>&#160;      <span class="keywordtype">int</span> iord = ord.find(<span class="stringliteral">&quot;|ord:&quot;</span>);</div><div class="line"><a name="l01717"></a><span class="lineno"> 1717</span>&#160;      <span class="keywordflow">if</span> (iord != STR_NPOS) {</div><div class="line"><a name="l01718"></a><span class="lineno"> 1718</span>&#160;         ord.erase(0,iord+5);</div><div class="line"><a name="l01719"></a><span class="lineno"> 1719</span>&#160;         ord.erase(ord.find(<span class="stringliteral">&quot;|&quot;</span>));</div><div class="line"><a name="l01720"></a><span class="lineno"> 1720</span>&#160;      } <span class="keywordflow">else</span></div><div class="line"><a name="l01721"></a><span class="lineno"> 1721</span>&#160;         ord = <span class="stringliteral">&quot;0&quot;</span>;</div><div class="line"><a name="l01722"></a><span class="lineno"> 1722</span>&#160;   }</div><div class="line"><a name="l01723"></a><span class="lineno"> 1723</span>&#160;   xps-&gt;<a class="code" href="classXrdProofdProofServ.html#a1f9861959dae472d6a6d30416b38d0d9">SetOrdinal</a>(ord.c_str());</div><div class="line"><a name="l01724"></a><span class="lineno"> 1724</span>&#160;</div><div class="line"><a name="l01725"></a><span class="lineno"> 1725</span>&#160;   <span class="comment">// Extract config file, if any (for backward compatibility)</span></div><div class="line"><a name="l01726"></a><span class="lineno"> 1726</span>&#160;   cffile.assign(buf,0,len-1);</div><div class="line"><a name="l01727"></a><span class="lineno"> 1727</span>&#160;   <span class="keywordtype">int</span> icf = cffile.find(<span class="stringliteral">&quot;|cf:&quot;</span>);</div><div class="line"><a name="l01728"></a><span class="lineno"> 1728</span>&#160;   <span class="keywordflow">if</span> (icf != STR_NPOS) {</div><div class="line"><a name="l01729"></a><span class="lineno"> 1729</span>&#160;      cffile.erase(0,icf+4);</div><div class="line"><a name="l01730"></a><span class="lineno"> 1730</span>&#160;      cffile.erase(cffile.find(<span class="stringliteral">&quot;|&quot;</span>));</div><div class="line"><a name="l01731"></a><span class="lineno"> 1731</span>&#160;   } <span class="keywordflow">else</span></div><div class="line"><a name="l01732"></a><span class="lineno"> 1732</span>&#160;      cffile = <span class="stringliteral">&quot;&quot;</span>;</div><div class="line"><a name="l01733"></a><span class="lineno"> 1733</span>&#160;</div><div class="line"><a name="l01734"></a><span class="lineno"> 1734</span>&#160;   <span class="comment">// Extract # number of workers, if plite master</span></div><div class="line"><a name="l01735"></a><span class="lineno"> 1735</span>&#160;   XrdOucString plitenwk;</div><div class="line"><a name="l01736"></a><span class="lineno"> 1736</span>&#160;   plitenwk.assign(buf,0,len-1);</div><div class="line"><a name="l01737"></a><span class="lineno"> 1737</span>&#160;   <span class="keywordtype">int</span> inwk = plitenwk.find(<span class="stringliteral">&quot;|plite:&quot;</span>);</div><div class="line"><a name="l01738"></a><span class="lineno"> 1738</span>&#160;   <span class="keywordflow">if</span> (inwk != STR_NPOS) {</div><div class="line"><a name="l01739"></a><span class="lineno"> 1739</span>&#160;      plitenwk.erase(0,inwk+7);</div><div class="line"><a name="l01740"></a><span class="lineno"> 1740</span>&#160;      plitenwk.erase(plitenwk.find(<span class="stringliteral">&quot;|&quot;</span>));</div><div class="line"><a name="l01741"></a><span class="lineno"> 1741</span>&#160;      <span class="keywordtype">int</span> nwk = plitenwk.atoi();</div><div class="line"><a name="l01742"></a><span class="lineno"> 1742</span>&#160;      <span class="keywordflow">if</span> (nwk &gt; -1) {</div><div class="line"><a name="l01743"></a><span class="lineno"> 1743</span>&#160;         xps-&gt;<a class="code" href="classXrdProofdProofServ.html#a1be69abff69e78a8d01f1d0313f50c09">SetPLiteNWrks</a>(nwk);</div><div class="line"><a name="l01744"></a><span class="lineno"> 1744</span>&#160;         <a class="code" href="XrdProofdTrace_8h.html#a83f50a6ac1ca86524725ed11340e3b26">TRACEP</a>(p, DBG, <span class="stringliteral">&quot;P-Lite master with &quot;</span>&lt;&lt;nwk&lt;&lt;<span class="stringliteral">&quot; workers (0 means # or cores)&quot;</span>);</div><div class="line"><a name="l01745"></a><span class="lineno"> 1745</span>&#160;      }</div><div class="line"><a name="l01746"></a><span class="lineno"> 1746</span>&#160;   }</div><div class="line"><a name="l01747"></a><span class="lineno"> 1747</span>&#160;</div><div class="line"><a name="l01748"></a><span class="lineno"> 1748</span>&#160;   <span class="comment">// Extract user envs, if any</span></div><div class="line"><a name="l01749"></a><span class="lineno"> 1749</span>&#160;   uenvs.assign(buf,0,len-1);</div><div class="line"><a name="l01750"></a><span class="lineno"> 1750</span>&#160;   <span class="keywordtype">int</span> ienv = uenvs.find(<span class="stringliteral">&quot;|envs:&quot;</span>);</div><div class="line"><a name="l01751"></a><span class="lineno"> 1751</span>&#160;   <span class="keywordflow">if</span> (ienv != STR_NPOS) {</div><div class="line"><a name="l01752"></a><span class="lineno"> 1752</span>&#160;      uenvs.erase(0,ienv+6);</div><div class="line"><a name="l01753"></a><span class="lineno"> 1753</span>&#160;      uenvs.erase(uenvs.find(<span class="stringliteral">&quot;|&quot;</span>));</div><div class="line"><a name="l01754"></a><span class="lineno"> 1754</span>&#160;      xps-&gt;<a class="code" href="classXrdProofdProofServ.html#aaad4182d28bb3706fc53955cde5add30">SetUserEnvs</a>(uenvs.c_str());</div><div class="line"><a name="l01755"></a><span class="lineno"> 1755</span>&#160;   } <span class="keywordflow">else</span></div><div class="line"><a name="l01756"></a><span class="lineno"> 1756</span>&#160;      uenvs = <span class="stringliteral">&quot;&quot;</span>;</div><div class="line"><a name="l01757"></a><span class="lineno"> 1757</span>&#160;</div><div class="line"><a name="l01758"></a><span class="lineno"> 1758</span>&#160;   <span class="comment">// Check if the user wants to wait more for the session startup</span></div><div class="line"><a name="l01759"></a><span class="lineno"> 1759</span>&#160;   intwait = <a class="code" href="classXrdProofdProofServMgr.html#a3d7506e0fff1042ca99d77c2ad432f19">fInternalWait</a>;</div><div class="line"><a name="l01760"></a><span class="lineno"> 1760</span>&#160;   <span class="keywordflow">if</span> (uenvs.length() &gt; 0) {</div><div class="line"><a name="l01761"></a><span class="lineno"> 1761</span>&#160;      <a class="code" href="XrdProofdTrace_8h.html#a83f50a6ac1ca86524725ed11340e3b26">TRACEP</a>(p, DBG, <span class="stringliteral">&quot;user envs: &quot;</span>&lt;&lt;uenvs);</div><div class="line"><a name="l01762"></a><span class="lineno"> 1762</span>&#160;      <span class="keywordtype">int</span> iiw = STR_NPOS;</div><div class="line"><a name="l01763"></a><span class="lineno"> 1763</span>&#160;      <span class="keywordflow">if</span> ((iiw = uenvs.find(<span class="stringliteral">&quot;PROOF_INTWAIT=&quot;</span>)) !=  STR_NPOS) {</div><div class="line"><a name="l01764"></a><span class="lineno"> 1764</span>&#160;         XrdOucString <a class="code" href="namespaceTGeant4Unit.html#a5d450e80998065902b102dca2a69066a">s</a>(uenvs, iiw + strlen(<span class="stringliteral">&quot;PROOF_INTWAIT=&quot;</span>));</div><div class="line"><a name="l01765"></a><span class="lineno"> 1765</span>&#160;         <a class="code" href="namespaceTGeant4Unit.html#a5d450e80998065902b102dca2a69066a">s</a>.erase(<a class="code" href="namespaceTGeant4Unit.html#a5d450e80998065902b102dca2a69066a">s</a>.find(<span class="charliteral">&#39;,&#39;</span>));</div><div class="line"><a name="l01766"></a><span class="lineno"> 1766</span>&#160;         <span class="keywordflow">if</span> (<a class="code" href="namespaceTGeant4Unit.html#a5d450e80998065902b102dca2a69066a">s</a>.isdigit()) {</div><div class="line"><a name="l01767"></a><span class="lineno"> 1767</span>&#160;            intwait = <a class="code" href="namespaceTGeant4Unit.html#a5d450e80998065902b102dca2a69066a">s</a>.atoi();</div><div class="line"><a name="l01768"></a><span class="lineno"> 1768</span>&#160;            <a class="code" href="XrdProofdTrace_8h.html#a83f50a6ac1ca86524725ed11340e3b26">TRACEP</a>(p, ALL, <span class="stringliteral">&quot;startup internal wait set by user to &quot;</span>&lt;&lt;intwait);</div><div class="line"><a name="l01769"></a><span class="lineno"> 1769</span>&#160;         }</div><div class="line"><a name="l01770"></a><span class="lineno"> 1770</span>&#160;      }</div><div class="line"><a name="l01771"></a><span class="lineno"> 1771</span>&#160;   }</div><div class="line"><a name="l01772"></a><span class="lineno"> 1772</span>&#160;}</div><div class="line"><a name="l01773"></a><span class="lineno"> 1773</span>&#160;<span class="comment"></span></div><div class="line"><a name="l01774"></a><span class="lineno"> 1774</span>&#160;<span class="comment">////////////////////////////////////////////////////////////////////////////////</span></div><div class="line"><a name="l01775"></a><span class="lineno"> 1775</span>&#160;<span class="comment">/// Handle a request to create a new session</span></div><div class="line"><a name="l01776"></a><span class="lineno"> 1776</span>&#160;<span class="comment"></span></div><div class="line"><a name="l01777"></a><span class="lineno"><a class="line" href="classXrdProofdProofServMgr.html#a06f01db3e2c065960fa5f7f6cd99e496"> 1777</a></span>&#160;<span class="keywordtype">int</span> <a class="code" href="classXrdProofdProofServMgr.html#a06f01db3e2c065960fa5f7f6cd99e496">XrdProofdProofServMgr::Create</a>(<a class="code" href="classXrdProofdProtocol.html">XrdProofdProtocol</a> *p)</div><div class="line"><a name="l01778"></a><span class="lineno"> 1778</span>&#160;{</div><div class="line"><a name="l01779"></a><span class="lineno"> 1779</span>&#160;   <a class="code" href="XrdProofdTrace_8h.html#a7c31822912a8d0dc9bfd544097b29e12">XPDLOC</a>(SMGR, <span class="stringliteral">&quot;ProofServMgr::Create&quot;</span>)</div><div class="line"><a name="l01780"></a><span class="lineno"> 1780</span>&#160;</div><div class="line"><a name="l01781"></a><span class="lineno"> 1781</span>&#160;   <span class="keywordtype">int</span> psid = -1, rc = 0;</div><div class="line"><a name="l01782"></a><span class="lineno"> 1782</span>&#160;   <a class="code" href="XrdProofdProtocol_8h.html#a877c158bc5a36171e7e5a4be25f6b4cb">XPD_SETRESP</a>(p, <span class="stringliteral">&quot;Create&quot;</span>);</div><div class="line"><a name="l01783"></a><span class="lineno"> 1783</span>&#160;</div><div class="line"><a name="l01784"></a><span class="lineno"> 1784</span>&#160;   <a class="code" href="XrdProofdTrace_8h.html#a83f50a6ac1ca86524725ed11340e3b26">TRACEP</a>(p, DBG, <span class="stringliteral">&quot;enter&quot;</span>);</div><div class="line"><a name="l01785"></a><span class="lineno"> 1785</span>&#160;   XrdOucString msg;</div><div class="line"><a name="l01786"></a><span class="lineno"> 1786</span>&#160;</div><div class="line"><a name="l01787"></a><span class="lineno"> 1787</span>&#160;   <a class="code" href="classXpdSrvMgrCreateGuard.html">XpdSrvMgrCreateGuard</a> mcGuard;</div><div class="line"><a name="l01788"></a><span class="lineno"> 1788</span>&#160;</div><div class="line"><a name="l01789"></a><span class="lineno"> 1789</span>&#160;   <span class="comment">// Check if we are allowed to start a new session</span></div><div class="line"><a name="l01790"></a><span class="lineno"> 1790</span>&#160;   <span class="keywordtype">int</span> mxsess = (<a class="code" href="classXrdProofdProofServMgr.html#a86cac591a5646811e38ff6a2477f4da7">fMgr</a> &amp;&amp; <a class="code" href="classXrdProofdProofServMgr.html#a86cac591a5646811e38ff6a2477f4da7">fMgr</a>-&gt;<a class="code" href="classXrdProofdManager.html#aa1be6f6b31c8a496b4b301d9143f0de8">ProofSched</a>()) ? <a class="code" href="classXrdProofdProofServMgr.html#a86cac591a5646811e38ff6a2477f4da7">fMgr</a>-&gt;<a class="code" href="classXrdProofdManager.html#aa1be6f6b31c8a496b4b301d9143f0de8">ProofSched</a>()-&gt;<a class="code" href="classXrdProofSched.html#a164c4ca7a73bb3f8ebd06dce9ce11b1d">MaxSessions</a>() : -1;</div><div class="line"><a name="l01791"></a><span class="lineno"> 1791</span>&#160;   <span class="keywordflow">if</span> (p-&gt;<a class="code" href="classXrdProofdProtocol.html#a71898b7c3788b133364db067d1f47c24">ConnType</a>() == <a class="code" href="XProofProtocol_8h.html#a288e0bf1dc365d01a746a4917afec0a1">kXPD_ClientMaster</a> &amp;&amp; mxsess &gt; 0) {</div><div class="line"><a name="l01792"></a><span class="lineno"> 1792</span>&#160;      <a class="code" href="XrdSysToOuc_8h.html#a4ba18bedbb8a1a4367d57f49a4d773ce">XrdSysMutexHelper</a> mhp(<a class="code" href="classXrdProofdProofServMgr.html#ab90491b1fb65834e75bd46f6e09db87f">fMutex</a>);</div><div class="line"><a name="l01793"></a><span class="lineno"> 1793</span>&#160;      <span class="keywordtype">int</span> cursess = <a class="code" href="classXrdProofdProofServMgr.html#a112317944ba9a3b64b9f784a9ef8d6b8">CurrentSessions</a>();</div><div class="line"><a name="l01794"></a><span class="lineno"> 1794</span>&#160;      <a class="code" href="XrdProofdTrace_8h.html#a83f50a6ac1ca86524725ed11340e3b26">TRACEP</a>(p,ALL,<span class="stringliteral">&quot; cursess: &quot;</span>&lt;&lt;cursess);</div><div class="line"><a name="l01795"></a><span class="lineno"> 1795</span>&#160;      <span class="keywordflow">if</span> (mxsess &lt;= cursess) {</div><div class="line"><a name="l01796"></a><span class="lineno"> 1796</span>&#160;         <a class="code" href="XrdProofdAux_8h.html#a631cc8787af1a02d9e51c86117ae042e">XPDFORM</a>(msg, <span class="stringliteral">&quot; ++++ Max number of sessions reached (%d) - please retry later ++++ \n&quot;</span>, cursess);</div><div class="line"><a name="l01797"></a><span class="lineno"> 1797</span>&#160;         response-&gt;Send(kXR_attn, <a class="code" href="XProofProtocol_8h.html#af90b47a2dd37c58ac6f67e16c279e27bafd3f389e5b30b994109c42a3c43d3c0c">kXPD_srvmsg</a>, (<span class="keywordtype">char</span> *) msg.c_str(), msg.length());</div><div class="line"><a name="l01798"></a><span class="lineno"> 1798</span>&#160;         response-&gt;Send(<a class="code" href="XProofProtocol_8h.html#a81dc1edcb19adb12975b44e65a3c88f4a03ca20da4aca31fccadabaa00c653a92">kXP_TooManySess</a>, <span class="stringliteral">&quot;cannot start a new session&quot;</span>);</div><div class="line"><a name="l01799"></a><span class="lineno"> 1799</span>&#160;         <span class="keywordflow">return</span> 0;</div><div class="line"><a name="l01800"></a><span class="lineno"> 1800</span>&#160;      }</div><div class="line"><a name="l01801"></a><span class="lineno"> 1801</span>&#160;      <span class="comment">// If we fail this guarantees that the counters are decreased, if needed</span></div><div class="line"><a name="l01802"></a><span class="lineno"> 1802</span>&#160;      mcGuard.<a class="code" href="classXpdSrvMgrCreateGuard.html#a2f078a3888963c8a20d1529b437d07e9">Set</a>(&amp;<a class="code" href="classXrdProofdProofServMgr.html#afddc4c3251e7293b77ca5f8b4dbe0595">fCurrentSessions</a>);</div><div class="line"><a name="l01803"></a><span class="lineno"> 1803</span>&#160;   }</div><div class="line"><a name="l01804"></a><span class="lineno"> 1804</span>&#160;</div><div class="line"><a name="l01805"></a><span class="lineno"> 1805</span>&#160;   <span class="comment">// Update counter to control checks during creation</span></div><div class="line"><a name="l01806"></a><span class="lineno"> 1806</span>&#160;   <a class="code" href="classXpdSrvMgrCreateCnt.html">XpdSrvMgrCreateCnt</a> <a class="code" href="namespacexmlio.html#a7da9572bcb8815ae48bc1845efd235b5">cnt</a>(<span class="keyword">this</span>, <a class="code" href="classXrdProofdProofServMgr.html#a34c425cdb5ec334f7c3b7acc2fa335e5a9f76e372c8b07c5c30efe4616afb6724">kCreateCnt</a>);</div><div class="line"><a name="l01807"></a><span class="lineno"> 1807</span>&#160;   <span class="keywordflow">if</span> (<a class="code" href="XrdProofdTrace_8h.html#ae90cd8dc8bb9c2e23852350504b02e49">TRACING</a>(DBG)) {</div><div class="line"><a name="l01808"></a><span class="lineno"> 1808</span>&#160;      <span class="keywordtype">int</span> nc = <a class="code" href="classXrdProofdProofServMgr.html#a27dec7acd4252ca1e14bf50c654e66c2">CheckCounter</a>(<a class="code" href="classXrdProofdProofServMgr.html#a34c425cdb5ec334f7c3b7acc2fa335e5a9f76e372c8b07c5c30efe4616afb6724">kCreateCnt</a>);</div><div class="line"><a name="l01809"></a><span class="lineno"> 1809</span>&#160;      <a class="code" href="XrdProofdTrace_8h.html#a83f50a6ac1ca86524725ed11340e3b26">TRACEP</a>(p, DBG, nc &lt;&lt; <span class="stringliteral">&quot; threads are creating a new session&quot;</span>);</div><div class="line"><a name="l01810"></a><span class="lineno"> 1810</span>&#160;   }</div><div class="line"><a name="l01811"></a><span class="lineno"> 1811</span>&#160;</div><div class="line"><a name="l01812"></a><span class="lineno"> 1812</span>&#160;   <span class="comment">// Allocate and prepare the XrdProofdProofServ object describing this session</span></div><div class="line"><a name="l01813"></a><span class="lineno"> 1813</span>&#160;   <span class="keywordtype">unsigned</span> <span class="keywordtype">short</span> sid;</div><div class="line"><a name="l01814"></a><span class="lineno"> 1814</span>&#160;   <a class="code" href="classXrdProofdProofServ.html">XrdProofdProofServ</a> *xps = <a class="code" href="classXrdProofdProofServMgr.html#a0964e25c122bd4285174d91425e62cd3">PrepareProofServ</a>(p, response, sid);</div><div class="line"><a name="l01815"></a><span class="lineno"> 1815</span>&#160;   psid = xps-&gt;<a class="code" href="classXrdProofdProofServ.html#aed92a8d3a8b058f1dcf56862365f1939">ID</a>();</div><div class="line"><a name="l01816"></a><span class="lineno"> 1816</span>&#160;</div><div class="line"><a name="l01817"></a><span class="lineno"> 1817</span>&#160;   <span class="comment">// Unmarshall log level</span></div><div class="line"><a name="l01818"></a><span class="lineno"> 1818</span>&#160;   <span class="keywordtype">int</span> loglevel = ntohl(p-&gt;<a class="code" href="classXrdProofdProtocol.html#a279527394516a18ef610489a4ab1ddfd">Request</a>()-&gt;<a class="code" href="unionXPClientRequest.html#a86d728b0d38bc6ff0b92a9fb0b69bd0c">proof</a>.<a class="code" href="structXPClientProofRequest.html#a52ac878680aee8ecde1c97feb1ccfd87">int1</a>);</div><div class="line"><a name="l01819"></a><span class="lineno"> 1819</span>&#160;</div><div class="line"><a name="l01820"></a><span class="lineno"> 1820</span>&#160;   <span class="comment">// Parse buffer</span></div><div class="line"><a name="l01821"></a><span class="lineno"> 1821</span>&#160;   <span class="keywordtype">int</span> intwait;</div><div class="line"><a name="l01822"></a><span class="lineno"> 1822</span>&#160;   XrdOucString tag, ord, cffile, uenvs;</div><div class="line"><a name="l01823"></a><span class="lineno"> 1823</span>&#160;   <a class="code" href="classXrdProofdProofServMgr.html#a319d93533e5c4eb94170e7837ee27ab9">ParseCreateBuffer</a>(p, xps, tag, ord, cffile, uenvs, intwait);</div><div class="line"><a name="l01824"></a><span class="lineno"> 1824</span>&#160;</div><div class="line"><a name="l01825"></a><span class="lineno"> 1825</span>&#160;   <span class="comment">// Notify</span></div><div class="line"><a name="l01826"></a><span class="lineno"> 1826</span>&#160;   <a class="code" href="XrdProofdTrace_8h.html#a83f50a6ac1ca86524725ed11340e3b26">TRACEP</a>(p, DBG, <span class="stringliteral">&quot;{ord,cfg,psid,cid,log}: {&quot;</span>&lt;&lt;ord&lt;&lt;<span class="stringliteral">&quot;,&quot;</span>&lt;&lt;cffile&lt;&lt;<span class="stringliteral">&quot;,&quot;</span>&lt;&lt;psid</div><div class="line"><a name="l01827"></a><span class="lineno"> 1827</span>&#160;                                             &lt;&lt;<span class="stringliteral">&quot;,&quot;</span>&lt;&lt;p-&gt;<a class="code" href="classXrdProofdProtocol.html#a934bd88037498a09c684297fca7b664f">CID</a>()&lt;&lt;<span class="stringliteral">&quot;,&quot;</span>&lt;&lt;loglevel&lt;&lt;<span class="stringliteral">&quot;}&quot;</span>);</div><div class="line"><a name="l01828"></a><span class="lineno"> 1828</span>&#160;</div><div class="line"><a name="l01829"></a><span class="lineno"> 1829</span>&#160;   <span class="comment">// Here we fork: for some weird problem on SMP machines there is a</span></div><div class="line"><a name="l01830"></a><span class="lineno"> 1830</span>&#160;   <span class="comment">// non-zero probability for a deadlock situation in system mutexes.</span></div><div class="line"><a name="l01831"></a><span class="lineno"> 1831</span>&#160;   <span class="comment">// The semaphore seems to have solved the problem.</span></div><div class="line"><a name="l01832"></a><span class="lineno"> 1832</span>&#160;   <span class="keywordflow">if</span> (<a class="code" href="classXrdProofdProofServMgr.html#a4989c26817d0896a76f54fa9916229a3">fForkSem</a>.Wait(10) != 0) {</div><div class="line"><a name="l01833"></a><span class="lineno"> 1833</span>&#160;      xps-&gt;<a class="code" href="classXrdProofdProofServ.html#ac4953244f65634a9ee47299d408591d8">Reset</a>();</div><div class="line"><a name="l01834"></a><span class="lineno"> 1834</span>&#160;      <span class="comment">// Timeout acquire fork semaphore</span></div><div class="line"><a name="l01835"></a><span class="lineno"> 1835</span>&#160;      response-&gt;Send(<a class="code" href="XProofProtocol_8h.html#a81dc1edcb19adb12975b44e65a3c88f4afccd8aacc7086f7ef815d546a9336fe9">kXP_ServerError</a>, <span class="stringliteral">&quot;timed-out acquiring fork semaphore&quot;</span>);</div><div class="line"><a name="l01836"></a><span class="lineno"> 1836</span>&#160;      <span class="keywordflow">return</span> 0;</div><div class="line"><a name="l01837"></a><span class="lineno"> 1837</span>&#160;   }</div><div class="line"><a name="l01838"></a><span class="lineno"> 1838</span>&#160;</div><div class="line"><a name="l01839"></a><span class="lineno"> 1839</span>&#160;   <span class="comment">// Pipe for child-to-parent communications during setup</span></div><div class="line"><a name="l01840"></a><span class="lineno"> 1840</span>&#160;   <a class="code" href="classXrdProofdPipe.html">XrdProofdPipe</a> fpc, fcp;</div><div class="line"><a name="l01841"></a><span class="lineno"> 1841</span>&#160;   <span class="keywordflow">if</span> (!(fpc.<a class="code" href="classXrdProofdPipe.html#a28d8bcdda93fc3c8beb4eb4ee22f5aa0">IsValid</a>()) || !(fcp.<a class="code" href="classXrdProofdPipe.html#a28d8bcdda93fc3c8beb4eb4ee22f5aa0">IsValid</a>())) {</div><div class="line"><a name="l01842"></a><span class="lineno"> 1842</span>&#160;      xps-&gt;<a class="code" href="classXrdProofdProofServ.html#ac4953244f65634a9ee47299d408591d8">Reset</a>();</div><div class="line"><a name="l01843"></a><span class="lineno"> 1843</span>&#160;      <span class="comment">// Failure creating pipe</span></div><div class="line"><a name="l01844"></a><span class="lineno"> 1844</span>&#160;      response-&gt;Send(<a class="code" href="XProofProtocol_8h.html#a81dc1edcb19adb12975b44e65a3c88f4afccd8aacc7086f7ef815d546a9336fe9">kXP_ServerError</a>,</div><div class="line"><a name="l01845"></a><span class="lineno"> 1845</span>&#160;                     <span class="stringliteral">&quot;unable to create pipes for communication during setup&quot;</span>);</div><div class="line"><a name="l01846"></a><span class="lineno"> 1846</span>&#160;      <span class="keywordflow">return</span> 0;</div><div class="line"><a name="l01847"></a><span class="lineno"> 1847</span>&#160;   }</div><div class="line"><a name="l01848"></a><span class="lineno"> 1848</span>&#160;</div><div class="line"><a name="l01849"></a><span class="lineno"> 1849</span>&#160;   <span class="comment">// Start setting up the unique tag and relevant dirs for this session</span></div><div class="line"><a name="l01850"></a><span class="lineno"> 1850</span>&#160;   <a class="code" href="structProofServEnv__t.html">ProofServEnv_t</a> in = {xps, loglevel, cffile.c_str(), <span class="stringliteral">&quot;&quot;</span>, <span class="stringliteral">&quot;&quot;</span>, tag.c_str(), <span class="stringliteral">&quot;&quot;</span>, <span class="stringliteral">&quot;&quot;</span>, 1};</div><div class="line"><a name="l01851"></a><span class="lineno"> 1851</span>&#160;   <a class="code" href="classXrdProofdProofServMgr.html#aabf69cec905249efe3d8375a2ef382dc">GetTagDirs</a>(0, p, xps, in.<a class="code" href="structProofServEnv__t.html#af4140705c69b78b2c0fd55131a0844dd">fSessionTag</a>, in.<a class="code" href="structProofServEnv__t.html#a063361fdad238f075537682178fdd1b3">fTopSessionTag</a>, in.<a class="code" href="structProofServEnv__t.html#a3a5c4ac123b8f92ad80003958476afbb">fSessionDir</a>, in.<a class="code" href="structProofServEnv__t.html#a24e0948cb1405b0d8c8360500ef20707">fWrkDir</a>);</div><div class="line"><a name="l01852"></a><span class="lineno"> 1852</span>&#160;</div><div class="line"><a name="l01853"></a><span class="lineno"> 1853</span>&#160;   <span class="comment">// Fork an agent process to handle this session</span></div><div class="line"><a name="l01854"></a><span class="lineno"> 1854</span>&#160;   <span class="keywordtype">int</span> pid = -1;</div><div class="line"><a name="l01855"></a><span class="lineno"> 1855</span>&#160;   <a class="code" href="XrdProofdTrace_8h.html#a83f50a6ac1ca86524725ed11340e3b26">TRACEP</a>(p, FORK,<span class="stringliteral">&quot;Forking external proofsrv&quot;</span>);</div><div class="line"><a name="l01856"></a><span class="lineno"> 1856</span>&#160;   <span class="keywordflow">if</span> (!(pid = <a class="code" href="classXrdProofdProofServMgr.html#a86cac591a5646811e38ff6a2477f4da7">fMgr</a>-&gt;<a class="code" href="classXrdProofdManager.html#abd140a5d84efcad2bceb7fef7356d16e">Sched</a>()-&gt;Fork(<span class="stringliteral">&quot;proofsrv&quot;</span>))) {</div><div class="line"><a name="l01857"></a><span class="lineno"> 1857</span>&#160;</div><div class="line"><a name="l01858"></a><span class="lineno"> 1858</span>&#160;      <span class="comment">// Finalize unique tag and relevant dirs for this session</span></div><div class="line"><a name="l01859"></a><span class="lineno"> 1859</span>&#160;      <a class="code" href="classXrdProofdProofServMgr.html#aabf69cec905249efe3d8375a2ef382dc">GetTagDirs</a>((<span class="keywordtype">int</span>)getpid(),</div><div class="line"><a name="l01860"></a><span class="lineno"> 1860</span>&#160;                 p, xps, in.<a class="code" href="structProofServEnv__t.html#af4140705c69b78b2c0fd55131a0844dd">fSessionTag</a>, in.<a class="code" href="structProofServEnv__t.html#a063361fdad238f075537682178fdd1b3">fTopSessionTag</a>, in.<a class="code" href="structProofServEnv__t.html#a3a5c4ac123b8f92ad80003958476afbb">fSessionDir</a>, in.<a class="code" href="structProofServEnv__t.html#a24e0948cb1405b0d8c8360500ef20707">fWrkDir</a>);</div><div class="line"><a name="l01861"></a><span class="lineno"> 1861</span>&#160;</div><div class="line"><a name="l01862"></a><span class="lineno"> 1862</span>&#160;      <span class="comment">// Create log file path</span></div><div class="line"><a name="l01863"></a><span class="lineno"> 1863</span>&#160;      <a class="code" href="classXrdProofdProofServMgr.html#a43977fa295e3c2755edcb43dd95de1de">FormFileNameInSessionDir</a>(p, xps, in.<a class="code" href="structProofServEnv__t.html#a3a5c4ac123b8f92ad80003958476afbb">fSessionDir</a>.c_str(), <span class="stringliteral">&quot;log&quot;</span>, in.<a class="code" href="structProofServEnv__t.html#a88002c75764b173de52afd5f9b3c6c74">fLogFile</a>);</div><div class="line"><a name="l01864"></a><span class="lineno"> 1864</span>&#160;</div><div class="line"><a name="l01865"></a><span class="lineno"> 1865</span>&#160;      <span class="comment">// Log to the session log file from now on</span></div><div class="line"><a name="l01866"></a><span class="lineno"> 1866</span>&#160;      <span class="keywordflow">if</span> (<a class="code" href="classXrdProofdProofServMgr.html#a286409daa6699f599723fc5046c71c76">fLogger</a>) <a class="code" href="classXrdProofdProofServMgr.html#a286409daa6699f599723fc5046c71c76">fLogger</a>-&gt;Bind(in.<a class="code" href="structProofServEnv__t.html#a88002c75764b173de52afd5f9b3c6c74">fLogFile</a>.c_str());</div><div class="line"><a name="l01867"></a><span class="lineno"> 1867</span>&#160;      <a class="code" href="TGHtml_8h.html#ad5bb4a3d12fd54f29da2b924b29e652b">TRACE</a>(FORK, <span class="stringliteral">&quot;log file: &quot;</span>&lt;&lt;in.<a class="code" href="structProofServEnv__t.html#a88002c75764b173de52afd5f9b3c6c74">fLogFile</a>);</div><div class="line"><a name="l01868"></a><span class="lineno"> 1868</span>&#160;</div><div class="line"><a name="l01869"></a><span class="lineno"> 1869</span>&#160;      XrdOucString pmsg = <span class="stringliteral">&quot;*** spawned child process &quot;</span>;</div><div class="line"><a name="l01870"></a><span class="lineno"> 1870</span>&#160;      pmsg += (int) getpid();</div><div class="line"><a name="l01871"></a><span class="lineno"> 1871</span>&#160;      pmsg += <span class="stringliteral">&quot; ***&quot;</span>;</div><div class="line"><a name="l01872"></a><span class="lineno"> 1872</span>&#160;      <a class="code" href="TGHtml_8h.html#ad5bb4a3d12fd54f29da2b924b29e652b">TRACE</a>(ALL, pmsg);</div><div class="line"><a name="l01873"></a><span class="lineno"> 1873</span>&#160;</div><div class="line"><a name="l01874"></a><span class="lineno"> 1874</span>&#160;      <span class="comment">// These files belongs to the client</span></div><div class="line"><a name="l01875"></a><span class="lineno"> 1875</span>&#160;      <span class="keywordflow">if</span> (chown(in.<a class="code" href="structProofServEnv__t.html#a88002c75764b173de52afd5f9b3c6c74">fLogFile</a>.c_str(), p-&gt;<a class="code" href="classXrdProofdProtocol.html#a80024c8f848d0eabe9f13d09f06c8d9d">Client</a>()-&gt;<a class="code" href="classXrdProofdClient.html#a062a4396b4b8f0667f3a97a64c7f1c3d">UI</a>().<a class="code" href="classXrdProofUI.html#aa16ddd6d492cb4e498d5a94df6b037a9">fUid</a>, p-&gt;<a class="code" href="classXrdProofdProtocol.html#a80024c8f848d0eabe9f13d09f06c8d9d">Client</a>()-&gt;<a class="code" href="classXrdProofdClient.html#a062a4396b4b8f0667f3a97a64c7f1c3d">UI</a>().<a class="code" href="classXrdProofUI.html#a02d91475e698860e6cf2eb5a8e9c29ec">fGid</a>) != 0)</div><div class="line"><a name="l01876"></a><span class="lineno"> 1876</span>&#160;         <a class="code" href="TGHtml_8h.html#ad5bb4a3d12fd54f29da2b924b29e652b">TRACE</a>(XERR, <span class="stringliteral">&quot;chown on &#39;&quot;</span>&lt;&lt;in.<a class="code" href="structProofServEnv__t.html#a88002c75764b173de52afd5f9b3c6c74">fLogFile</a>.c_str()&lt;&lt;<span class="stringliteral">&quot;&#39;; errno: &quot;</span>&lt;&lt;errno);</div><div class="line"><a name="l01877"></a><span class="lineno"> 1877</span>&#160;</div><div class="line"><a name="l01878"></a><span class="lineno"> 1878</span>&#160;      <a class="code" href="classXpdMsg.html">XpdMsg</a> xmsg;</div><div class="line"><a name="l01879"></a><span class="lineno"> 1879</span>&#160;      XrdOucString path, sockpath, emsg;</div><div class="line"><a name="l01880"></a><span class="lineno"> 1880</span>&#160;</div><div class="line"><a name="l01881"></a><span class="lineno"> 1881</span>&#160;      <span class="comment">// Receive the admin path from the parent</span></div><div class="line"><a name="l01882"></a><span class="lineno"> 1882</span>&#160;      <span class="keywordflow">if</span> (fpc.<a class="code" href="classXrdProofdPipe.html#a51532896ac35adec6efe6840dcac0354">Poll</a>() &lt; 0) {</div><div class="line"><a name="l01883"></a><span class="lineno"> 1883</span>&#160;         <a class="code" href="TGHtml_8h.html#ad5bb4a3d12fd54f29da2b924b29e652b">TRACE</a>(XERR, <span class="stringliteral">&quot;error while polling to receive the admin path from parent - EXIT&quot;</span> );</div><div class="line"><a name="l01884"></a><span class="lineno"> 1884</span>&#160;         exit(1);</div><div class="line"><a name="l01885"></a><span class="lineno"> 1885</span>&#160;      }</div><div class="line"><a name="l01886"></a><span class="lineno"> 1886</span>&#160;      <span class="keywordflow">if</span> (fpc.<a class="code" href="classXrdProofdPipe.html#a4d40ad82fde9e49c25085779ad82c27c">Recv</a>(xmsg) != 0) {</div><div class="line"><a name="l01887"></a><span class="lineno"> 1887</span>&#160;         <a class="code" href="TGHtml_8h.html#ad5bb4a3d12fd54f29da2b924b29e652b">TRACE</a>(XERR, <span class="stringliteral">&quot;error reading message while waiting for the admin path from parent - EXIT&quot;</span> );</div><div class="line"><a name="l01888"></a><span class="lineno"> 1888</span>&#160;         exit(1);</div><div class="line"><a name="l01889"></a><span class="lineno"> 1889</span>&#160;      }</div><div class="line"><a name="l01890"></a><span class="lineno"> 1890</span>&#160;      <span class="keywordflow">if</span> (xmsg.Type() &lt; 0) {</div><div class="line"><a name="l01891"></a><span class="lineno"> 1891</span>&#160;         <a class="code" href="TGHtml_8h.html#ad5bb4a3d12fd54f29da2b924b29e652b">TRACE</a>(XERR, <span class="stringliteral">&quot;the parent failed to setup the admin path - EXIT&quot;</span> );</div><div class="line"><a name="l01892"></a><span class="lineno"> 1892</span>&#160;         exit(1);</div><div class="line"><a name="l01893"></a><span class="lineno"> 1893</span>&#160;      }</div><div class="line"><a name="l01894"></a><span class="lineno"> 1894</span>&#160;      <span class="comment">// Set the path w/o asserting the related files</span></div><div class="line"><a name="l01895"></a><span class="lineno"> 1895</span>&#160;      path = xmsg.Buf();</div><div class="line"><a name="l01896"></a><span class="lineno"> 1896</span>&#160;      xps-&gt;<a class="code" href="classXrdProofdProofServ.html#aa4580fce80e7fb2795eaa29a262cb309">SetAdminPath</a>(path.c_str(), 0, <a class="code" href="classXrdProofdProofServMgr.html#a86cac591a5646811e38ff6a2477f4da7">fMgr</a>-&gt;<a class="code" href="classXrdProofdManager.html#a15d2e414e67bfc0cc4304605a6b509ff">ChangeOwn</a>());</div><div class="line"><a name="l01897"></a><span class="lineno"> 1897</span>&#160;      <a class="code" href="TGHtml_8h.html#ad5bb4a3d12fd54f29da2b924b29e652b">TRACE</a>(FORK, <span class="stringliteral">&quot;admin path: &quot;</span>&lt;&lt;path);</div><div class="line"><a name="l01898"></a><span class="lineno"> 1898</span>&#160;</div><div class="line"><a name="l01899"></a><span class="lineno"> 1899</span>&#160;      xmsg.Reset();</div><div class="line"><a name="l01900"></a><span class="lineno"> 1900</span>&#160;      <span class="comment">// Receive the sock path from the parent</span></div><div class="line"><a name="l01901"></a><span class="lineno"> 1901</span>&#160;      <span class="keywordflow">if</span> (fpc.<a class="code" href="classXrdProofdPipe.html#a51532896ac35adec6efe6840dcac0354">Poll</a>() &lt; 0) {</div><div class="line"><a name="l01902"></a><span class="lineno"> 1902</span>&#160;         <a class="code" href="TGHtml_8h.html#ad5bb4a3d12fd54f29da2b924b29e652b">TRACE</a>(XERR, <span class="stringliteral">&quot;error while polling to receive the sock path from parent - EXIT&quot;</span> );</div><div class="line"><a name="l01903"></a><span class="lineno"> 1903</span>&#160;         exit(1);</div><div class="line"><a name="l01904"></a><span class="lineno"> 1904</span>&#160;      }</div><div class="line"><a name="l01905"></a><span class="lineno"> 1905</span>&#160;      <span class="keywordflow">if</span> (fpc.<a class="code" href="classXrdProofdPipe.html#a4d40ad82fde9e49c25085779ad82c27c">Recv</a>(xmsg) != 0) {</div><div class="line"><a name="l01906"></a><span class="lineno"> 1906</span>&#160;         <a class="code" href="TGHtml_8h.html#ad5bb4a3d12fd54f29da2b924b29e652b">TRACE</a>(XERR, <span class="stringliteral">&quot;error reading message while waiting for the sock path from parent - EXIT&quot;</span> );</div><div class="line"><a name="l01907"></a><span class="lineno"> 1907</span>&#160;         exit(1);</div><div class="line"><a name="l01908"></a><span class="lineno"> 1908</span>&#160;      }</div><div class="line"><a name="l01909"></a><span class="lineno"> 1909</span>&#160;      <span class="keywordflow">if</span> (xmsg.Type() &lt; 0) {</div><div class="line"><a name="l01910"></a><span class="lineno"> 1910</span>&#160;         <a class="code" href="TGHtml_8h.html#ad5bb4a3d12fd54f29da2b924b29e652b">TRACE</a>(XERR, <span class="stringliteral">&quot;the parent failed to setup the sock path - EXIT&quot;</span> );</div><div class="line"><a name="l01911"></a><span class="lineno"> 1911</span>&#160;         exit(1);</div><div class="line"><a name="l01912"></a><span class="lineno"> 1912</span>&#160;      }</div><div class="line"><a name="l01913"></a><span class="lineno"> 1913</span>&#160;      <span class="comment">// Set the UNIX sock path</span></div><div class="line"><a name="l01914"></a><span class="lineno"> 1914</span>&#160;      sockpath = xmsg.Buf();</div><div class="line"><a name="l01915"></a><span class="lineno"> 1915</span>&#160;      xps-&gt;<a class="code" href="classXrdProofdProofServ.html#ac4a8e8c6ff235136af0486340aced428">SetUNIXSockPath</a>(sockpath.c_str());</div><div class="line"><a name="l01916"></a><span class="lineno"> 1916</span>&#160;      <a class="code" href="TGHtml_8h.html#ad5bb4a3d12fd54f29da2b924b29e652b">TRACE</a>(FORK, <span class="stringliteral">&quot;UNIX sock path: &quot;</span>&lt;&lt;sockpath);</div><div class="line"><a name="l01917"></a><span class="lineno"> 1917</span>&#160;</div><div class="line"><a name="l01918"></a><span class="lineno"> 1918</span>&#160;      <span class="comment">// We set to the user ownerships and create relevant dirs</span></div><div class="line"><a name="l01919"></a><span class="lineno"> 1919</span>&#160;      <span class="keywordtype">bool</span> asserdatadir = 1;</div><div class="line"><a name="l01920"></a><span class="lineno"> 1920</span>&#160;      <span class="keywordtype">int</span> srvtype = xps-&gt;<a class="code" href="classXrdProofdProofServ.html#a52a25c22819b28395cc597a96676312c">SrvType</a>();</div><div class="line"><a name="l01921"></a><span class="lineno"> 1921</span>&#160;      <a class="code" href="TGHtml_8h.html#ad5bb4a3d12fd54f29da2b924b29e652b">TRACE</a>(ALL,<span class="stringliteral">&quot;srvtype = &quot;</span>&lt;&lt; srvtype);</div><div class="line"><a name="l01922"></a><span class="lineno"> 1922</span>&#160;      <span class="keywordflow">if</span> (xps-&gt;<a class="code" href="classXrdProofdProofServ.html#a52a25c22819b28395cc597a96676312c">SrvType</a>() != <a class="code" href="XProofProtocol_8h.html#ac8a8ea0eedefcf3ab8199ea996b3922c">kXPD_Worker</a> &amp;&amp; !strchr(<a class="code" href="classXrdProofdProofServMgr.html#a86cac591a5646811e38ff6a2477f4da7">fMgr</a>-&gt;<a class="code" href="classXrdProofdManager.html#a261fd4aaad8c8d64cc3ec18b8fdba69a">DataDirOpts</a>(), <span class="charliteral">&#39;M&#39;</span>)) {</div><div class="line"><a name="l01923"></a><span class="lineno"> 1923</span>&#160;         asserdatadir = 0;</div><div class="line"><a name="l01924"></a><span class="lineno"> 1924</span>&#160;      } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (xps-&gt;<a class="code" href="classXrdProofdProofServ.html#a52a25c22819b28395cc597a96676312c">SrvType</a>() == <a class="code" href="XProofProtocol_8h.html#ac8a8ea0eedefcf3ab8199ea996b3922c">kXPD_Worker</a> &amp;&amp; !strchr(<a class="code" href="classXrdProofdProofServMgr.html#a86cac591a5646811e38ff6a2477f4da7">fMgr</a>-&gt;<a class="code" href="classXrdProofdManager.html#a261fd4aaad8c8d64cc3ec18b8fdba69a">DataDirOpts</a>(), <span class="charliteral">&#39;W&#39;</span>)) {</div><div class="line"><a name="l01925"></a><span class="lineno"> 1925</span>&#160;         asserdatadir = 0;</div><div class="line"><a name="l01926"></a><span class="lineno"> 1926</span>&#160;      }</div><div class="line"><a name="l01927"></a><span class="lineno"> 1927</span>&#160;      <span class="keyword">const</span> <span class="keywordtype">char</span> *pord = asserdatadir ? ord.c_str() : 0;</div><div class="line"><a name="l01928"></a><span class="lineno"> 1928</span>&#160;      <span class="keyword">const</span> <span class="keywordtype">char</span> *ptag = asserdatadir ? in.<a class="code" href="structProofServEnv__t.html#af4140705c69b78b2c0fd55131a0844dd">fSessionTag</a>.c_str() : 0;</div><div class="line"><a name="l01929"></a><span class="lineno"> 1929</span>&#160;      <span class="keywordflow">if</span> (<a class="code" href="classXrdProofdProofServMgr.html#aab3b1838487f683e509be19e243ef02a">SetUserOwnerships</a>(p, pord, ptag) != 0) {</div><div class="line"><a name="l01930"></a><span class="lineno"> 1930</span>&#160;         emsg = <span class="stringliteral">&quot;SetUserOwnerships did not return OK - EXIT&quot;</span>;</div><div class="line"><a name="l01931"></a><span class="lineno"> 1931</span>&#160;         <a class="code" href="TGHtml_8h.html#ad5bb4a3d12fd54f29da2b924b29e652b">TRACE</a>(XERR, emsg);</div><div class="line"><a name="l01932"></a><span class="lineno"> 1932</span>&#160;         <span class="keywordflow">if</span> (fcp.<a class="code" href="classXrdProofdPipe.html#af3d2dbc5b021d794acc09bdc0aa3fa5e">Post</a>(0, emsg.c_str()) != 0)</div><div class="line"><a name="l01933"></a><span class="lineno"> 1933</span>&#160;            <a class="code" href="TGHtml_8h.html#ad5bb4a3d12fd54f29da2b924b29e652b">TRACE</a>(XERR, <span class="stringliteral">&quot;cannot write to internal pipe; errno: &quot;</span>&lt;&lt;errno);</div><div class="line"><a name="l01934"></a><span class="lineno"> 1934</span>&#160;         exit(1);</div><div class="line"><a name="l01935"></a><span class="lineno"> 1935</span>&#160;      }</div><div class="line"><a name="l01936"></a><span class="lineno"> 1936</span>&#160;</div><div class="line"><a name="l01937"></a><span class="lineno"> 1937</span>&#160;      <span class="comment">// We set to the user environment</span></div><div class="line"><a name="l01938"></a><span class="lineno"> 1938</span>&#160;      <span class="keywordflow">if</span> (<a class="code" href="classXrdProofdProofServMgr.html#a0cfe9bb436cf9dbcffd21d1821bc3d3f">SetUserEnvironment</a>(p) != 0) {</div><div class="line"><a name="l01939"></a><span class="lineno"> 1939</span>&#160;         emsg = <span class="stringliteral">&quot;SetUserEnvironment did not return OK - EXIT&quot;</span>;</div><div class="line"><a name="l01940"></a><span class="lineno"> 1940</span>&#160;         <a class="code" href="TGHtml_8h.html#ad5bb4a3d12fd54f29da2b924b29e652b">TRACE</a>(XERR, emsg);</div><div class="line"><a name="l01941"></a><span class="lineno"> 1941</span>&#160;         <span class="keywordflow">if</span> (fcp.<a class="code" href="classXrdProofdPipe.html#af3d2dbc5b021d794acc09bdc0aa3fa5e">Post</a>(0, emsg.c_str()) != 0)</div><div class="line"><a name="l01942"></a><span class="lineno"> 1942</span>&#160;            <a class="code" href="TGHtml_8h.html#ad5bb4a3d12fd54f29da2b924b29e652b">TRACE</a>(XERR, <span class="stringliteral">&quot;cannot write to internal pipe; errno: &quot;</span>&lt;&lt;errno);</div><div class="line"><a name="l01943"></a><span class="lineno"> 1943</span>&#160;         exit(1);</div><div class="line"><a name="l01944"></a><span class="lineno"> 1944</span>&#160;      }</div><div class="line"><a name="l01945"></a><span class="lineno"> 1945</span>&#160;</div><div class="line"><a name="l01946"></a><span class="lineno"> 1946</span>&#160;      <span class="keywordtype">char</span> *argvv[7] = {0};</div><div class="line"><a name="l01947"></a><span class="lineno"> 1947</span>&#160;</div><div class="line"><a name="l01948"></a><span class="lineno"> 1948</span>&#160;      <span class="comment">// We set to the user environment</span></div><div class="line"><a name="l01949"></a><span class="lineno"> 1949</span>&#160;      <span class="keywordflow">if</span> (!<a class="code" href="classXrdProofdProofServMgr.html#a86cac591a5646811e38ff6a2477f4da7">fMgr</a>) {</div><div class="line"><a name="l01950"></a><span class="lineno"> 1950</span>&#160;         emsg = <span class="stringliteral">&quot;XrdProofdManager instance undefined!&quot;</span>;</div><div class="line"><a name="l01951"></a><span class="lineno"> 1951</span>&#160;         <a class="code" href="TGHtml_8h.html#ad5bb4a3d12fd54f29da2b924b29e652b">TRACE</a>(XERR, emsg);</div><div class="line"><a name="l01952"></a><span class="lineno"> 1952</span>&#160;         <span class="keywordflow">if</span> (fcp.<a class="code" href="classXrdProofdPipe.html#af3d2dbc5b021d794acc09bdc0aa3fa5e">Post</a>(0, emsg.c_str()) != 0)</div><div class="line"><a name="l01953"></a><span class="lineno"> 1953</span>&#160;            <a class="code" href="TGHtml_8h.html#ad5bb4a3d12fd54f29da2b924b29e652b">TRACE</a>(XERR, <span class="stringliteral">&quot;cannot write to internal pipe; errno: &quot;</span>&lt;&lt;errno);</div><div class="line"><a name="l01954"></a><span class="lineno"> 1954</span>&#160;         exit(1);</div><div class="line"><a name="l01955"></a><span class="lineno"> 1955</span>&#160;      }</div><div class="line"><a name="l01956"></a><span class="lineno"> 1956</span>&#160;      <span class="keywordtype">char</span> *sxpd = 0;</div><div class="line"><a name="l01957"></a><span class="lineno"> 1957</span>&#160;      <span class="keywordflow">if</span> (<a class="code" href="classXrdProofdProofServMgr.html#a86cac591a5646811e38ff6a2477f4da7">fMgr</a>-&gt;<a class="code" href="classXrdProofdManager.html#a69bde6786ea2b81c63d7777a47f7ba5d">AdminPath</a>()) {</div><div class="line"><a name="l01958"></a><span class="lineno"> 1958</span>&#160;         <span class="comment">// We add our admin path to be able to identify processes coming from us</span></div><div class="line"><a name="l01959"></a><span class="lineno"> 1959</span>&#160;         <span class="keywordtype">size_t</span> len = strlen(<a class="code" href="classXrdProofdProofServMgr.html#a86cac591a5646811e38ff6a2477f4da7">fMgr</a>-&gt;<a class="code" href="classXrdProofdManager.html#a69bde6786ea2b81c63d7777a47f7ba5d">AdminPath</a>()) + strlen(<span class="stringliteral">&quot;xpdpath:&quot;</span>) + 1;</div><div class="line"><a name="l01960"></a><span class="lineno"> 1960</span>&#160;         sxpd = <span class="keyword">new</span> <span class="keywordtype">char</span>[len];</div><div class="line"><a name="l01961"></a><span class="lineno"> 1961</span>&#160;         <a class="code" href="civetweb_8c.html#aa367b75c5aed883fef5befbdf04835a4">snprintf</a>(sxpd, len, <span class="stringliteral">&quot;xpdpath:%s&quot;</span>, <a class="code" href="classXrdProofdProofServMgr.html#a86cac591a5646811e38ff6a2477f4da7">fMgr</a>-&gt;<a class="code" href="classXrdProofdManager.html#a69bde6786ea2b81c63d7777a47f7ba5d">AdminPath</a>());</div><div class="line"><a name="l01962"></a><span class="lineno"> 1962</span>&#160;      } <span class="keywordflow">else</span> {</div><div class="line"><a name="l01963"></a><span class="lineno"> 1963</span>&#160;         <span class="comment">// We add our PID to be able to identify processes coming from us</span></div><div class="line"><a name="l01964"></a><span class="lineno"> 1964</span>&#160;         sxpd = <span class="keyword">new</span> <span class="keywordtype">char</span>[10];</div><div class="line"><a name="l01965"></a><span class="lineno"> 1965</span>&#160;         <a class="code" href="civetweb_8c.html#aa367b75c5aed883fef5befbdf04835a4">snprintf</a>(sxpd, 10, <span class="stringliteral">&quot;%d&quot;</span>, getppid());</div><div class="line"><a name="l01966"></a><span class="lineno"> 1966</span>&#160;      }</div><div class="line"><a name="l01967"></a><span class="lineno"> 1967</span>&#160;</div><div class="line"><a name="l01968"></a><span class="lineno"> 1968</span>&#160;      <span class="comment">// Log level</span></div><div class="line"><a name="l01969"></a><span class="lineno"> 1969</span>&#160;      <span class="keywordtype">char</span> slog[10] = {0};</div><div class="line"><a name="l01970"></a><span class="lineno"> 1970</span>&#160;      <a class="code" href="civetweb_8c.html#aa367b75c5aed883fef5befbdf04835a4">snprintf</a>(slog, 10, <span class="stringliteral">&quot;%d&quot;</span>, loglevel);</div><div class="line"><a name="l01971"></a><span class="lineno"> 1971</span>&#160;</div><div class="line"><a name="l01972"></a><span class="lineno"> 1972</span>&#160;      <span class="comment">// Server type</span></div><div class="line"><a name="l01973"></a><span class="lineno"> 1973</span>&#160;      <span class="keywordtype">char</span> ssrv[10] = {0};</div><div class="line"><a name="l01974"></a><span class="lineno"> 1974</span>&#160;      <a class="code" href="civetweb_8c.html#aa367b75c5aed883fef5befbdf04835a4">snprintf</a>(ssrv, 10, <span class="stringliteral">&quot;%d&quot;</span>, xps-&gt;<a class="code" href="classXrdProofdProofServ.html#a52a25c22819b28395cc597a96676312c">SrvType</a>());</div><div class="line"><a name="l01975"></a><span class="lineno"> 1975</span>&#160;</div><div class="line"><a name="l01976"></a><span class="lineno"> 1976</span>&#160;      <span class="comment">// start server</span></div><div class="line"><a name="l01977"></a><span class="lineno"> 1977</span>&#160;      argvv[0] = (<span class="keywordtype">char</span> *) xps-&gt;<a class="code" href="classXrdProofdProofServ.html#a18e4a17f4e9ef07f923b654e2d000148">ROOT</a>()-&gt;<a class="code" href="classXrdROOT.html#a373e055dfbb0663d07da4ba0c423d0f4">PrgmSrv</a>();</div><div class="line"><a name="l01978"></a><span class="lineno"> 1978</span>&#160;      argvv[1] = (<span class="keywordtype">char</span> *)((p-&gt;<a class="code" href="classXrdProofdProtocol.html#a71898b7c3788b133364db067d1f47c24">ConnType</a>() == <a class="code" href="XProofProtocol_8h.html#ad7a933edf8c125412fd985f6f2bc771e">kXPD_MasterWorker</a>) ? <span class="stringliteral">&quot;proofslave&quot;</span></div><div class="line"><a name="l01979"></a><span class="lineno"> 1979</span>&#160;                       : <span class="stringliteral">&quot;proofserv&quot;</span>);</div><div class="line"><a name="l01980"></a><span class="lineno"> 1980</span>&#160;      argvv[2] = (<span class="keywordtype">char</span> *)<span class="stringliteral">&quot;xpd&quot;</span>;</div><div class="line"><a name="l01981"></a><span class="lineno"> 1981</span>&#160;      argvv[3] = (<span class="keywordtype">char</span> *)sxpd;</div><div class="line"><a name="l01982"></a><span class="lineno"> 1982</span>&#160;      argvv[4] = (<span class="keywordtype">char</span> *)slog;</div><div class="line"><a name="l01983"></a><span class="lineno"> 1983</span>&#160;      argvv[5] = (<span class="keywordtype">char</span> *)ssrv;</div><div class="line"><a name="l01984"></a><span class="lineno"> 1984</span>&#160;      argvv[6] = 0;</div><div class="line"><a name="l01985"></a><span class="lineno"> 1985</span>&#160;</div><div class="line"><a name="l01986"></a><span class="lineno"> 1986</span>&#160;      <span class="comment">// Set environment for proofserv</span></div><div class="line"><a name="l01987"></a><span class="lineno"> 1987</span>&#160;      <span class="keywordflow">if</span> (<a class="code" href="classXrdProofdProofServMgr.html#a4bb35d380da506fb49659f342b94ff55">SetProofServEnv</a>(p, (<span class="keywordtype">void</span> *)&amp;in) != 0) {</div><div class="line"><a name="l01988"></a><span class="lineno"> 1988</span>&#160;         emsg = <span class="stringliteral">&quot;SetProofServEnv did not return OK - EXIT&quot;</span>;</div><div class="line"><a name="l01989"></a><span class="lineno"> 1989</span>&#160;         <a class="code" href="TGHtml_8h.html#ad5bb4a3d12fd54f29da2b924b29e652b">TRACE</a>(XERR, emsg);</div><div class="line"><a name="l01990"></a><span class="lineno"> 1990</span>&#160;         <span class="keywordflow">if</span> (fcp.<a class="code" href="classXrdProofdPipe.html#af3d2dbc5b021d794acc09bdc0aa3fa5e">Post</a>(0, emsg.c_str()) != 0)</div><div class="line"><a name="l01991"></a><span class="lineno"> 1991</span>&#160;            <a class="code" href="TGHtml_8h.html#ad5bb4a3d12fd54f29da2b924b29e652b">TRACE</a>(XERR, <span class="stringliteral">&quot;cannot write to internal pipe; errno: &quot;</span>&lt;&lt;errno);</div><div class="line"><a name="l01992"></a><span class="lineno"> 1992</span>&#160;         exit(1);</div><div class="line"><a name="l01993"></a><span class="lineno"> 1993</span>&#160;      }</div><div class="line"><a name="l01994"></a><span class="lineno"> 1994</span>&#160;      <a class="code" href="TGHtml_8h.html#ad5bb4a3d12fd54f29da2b924b29e652b">TRACE</a>(FORK, (<span class="keywordtype">int</span>)getpid() &lt;&lt; <span class="stringliteral">&quot;: proofserv env set up&quot;</span>);</div><div class="line"><a name="l01995"></a><span class="lineno"> 1995</span>&#160;</div><div class="line"><a name="l01996"></a><span class="lineno"> 1996</span>&#160;      <span class="comment">// Setup OK: now we go</span></div><div class="line"><a name="l01997"></a><span class="lineno"> 1997</span>&#160;      <span class="comment">// Communicate the logfile path</span></div><div class="line"><a name="l01998"></a><span class="lineno"> 1998</span>&#160;      <span class="keywordflow">if</span> (fcp.<a class="code" href="classXrdProofdPipe.html#af3d2dbc5b021d794acc09bdc0aa3fa5e">Post</a>(1, xps-&gt;<a class="code" href="classXrdProofdProofServ.html#a3ffaac9d5a4472092b2a06ac05cebf13">Fileout</a>()) != 0) {</div><div class="line"><a name="l01999"></a><span class="lineno"> 1999</span>&#160;         <a class="code" href="TGHtml_8h.html#ad5bb4a3d12fd54f29da2b924b29e652b">TRACE</a>(XERR, <span class="stringliteral">&quot;cannot write log file path to internal pipe; errno: &quot;</span>&lt;&lt;errno);</div><div class="line"><a name="l02000"></a><span class="lineno"> 2000</span>&#160;         exit(1);</div><div class="line"><a name="l02001"></a><span class="lineno"> 2001</span>&#160;      }</div><div class="line"><a name="l02002"></a><span class="lineno"> 2002</span>&#160;      <a class="code" href="TGHtml_8h.html#ad5bb4a3d12fd54f29da2b924b29e652b">TRACE</a>(FORK, (<span class="keywordtype">int</span>)getpid()&lt;&lt; <span class="stringliteral">&quot;: log file path communicated&quot;</span>);</div><div class="line"><a name="l02003"></a><span class="lineno"> 2003</span>&#160;</div><div class="line"><a name="l02004"></a><span class="lineno"> 2004</span>&#160;      <span class="comment">// Unblock SIGUSR1 and SIGUSR2</span></div><div class="line"><a name="l02005"></a><span class="lineno"> 2005</span>&#160;      sigset_t myset;</div><div class="line"><a name="l02006"></a><span class="lineno"> 2006</span>&#160;      sigemptyset(&amp;myset);</div><div class="line"><a name="l02007"></a><span class="lineno"> 2007</span>&#160;      sigaddset(&amp;myset, SIGUSR1);</div><div class="line"><a name="l02008"></a><span class="lineno"> 2008</span>&#160;      sigaddset(&amp;myset, SIGUSR2);</div><div class="line"><a name="l02009"></a><span class="lineno"> 2009</span>&#160;      pthread_sigmask(SIG_UNBLOCK, &amp;myset, 0);</div><div class="line"><a name="l02010"></a><span class="lineno"> 2010</span>&#160;</div><div class="line"><a name="l02011"></a><span class="lineno"> 2011</span>&#160;      <span class="comment">// Close pipes</span></div><div class="line"><a name="l02012"></a><span class="lineno"> 2012</span>&#160;      fpc.<a class="code" href="classXrdProofdPipe.html#a5aa4739df39754c05bee043d99d74b00">Close</a>();</div><div class="line"><a name="l02013"></a><span class="lineno"> 2013</span>&#160;      fcp.<a class="code" href="classXrdProofdPipe.html#a5aa4739df39754c05bee043d99d74b00">Close</a>();</div><div class="line"><a name="l02014"></a><span class="lineno"> 2014</span>&#160;</div><div class="line"><a name="l02015"></a><span class="lineno"> 2015</span>&#160;      <a class="code" href="TGHtml_8h.html#ad5bb4a3d12fd54f29da2b924b29e652b">TRACE</a>(FORK, (<span class="keywordtype">int</span>)getpid()&lt;&lt;<span class="stringliteral">&quot;: user: &quot;</span>&lt;&lt;p-&gt;<a class="code" href="classXrdProofdProtocol.html#a80024c8f848d0eabe9f13d09f06c8d9d">Client</a>()-&gt;<a class="code" href="classXrdProofdClient.html#a3cbe604999cdb44ae9d0ec833ffa5900">User</a>()&lt;&lt;</div><div class="line"><a name="l02016"></a><span class="lineno"> 2016</span>&#160;                  <span class="stringliteral">&quot;, uid: &quot;</span>&lt;&lt;getuid()&lt;&lt;<span class="stringliteral">&quot;, euid:&quot;</span>&lt;&lt;geteuid()&lt;&lt;</div><div class="line"><a name="l02017"></a><span class="lineno"> 2017</span>&#160;                  <span class="stringliteral">&quot;, psrv: &quot;</span>&lt;&lt;xps-&gt;<a class="code" href="classXrdProofdProofServ.html#a18e4a17f4e9ef07f923b654e2d000148">ROOT</a>()-&gt;<a class="code" href="classXrdROOT.html#a373e055dfbb0663d07da4ba0c423d0f4">PrgmSrv</a>()&lt;&lt;<span class="stringliteral">&quot;, argvv[1]: &quot;</span>&lt;&lt;argvv[1]);</div><div class="line"><a name="l02018"></a><span class="lineno"> 2018</span>&#160;      <span class="comment">// Run the program</span></div><div class="line"><a name="l02019"></a><span class="lineno"> 2019</span>&#160;      execv(xps-&gt;<a class="code" href="classXrdProofdProofServ.html#a18e4a17f4e9ef07f923b654e2d000148">ROOT</a>()-&gt;<a class="code" href="classXrdROOT.html#a373e055dfbb0663d07da4ba0c423d0f4">PrgmSrv</a>(), argvv);</div><div class="line"><a name="l02020"></a><span class="lineno"> 2020</span>&#160;</div><div class="line"><a name="l02021"></a><span class="lineno"> 2021</span>&#160;      <span class="comment">// We should not be here!!!</span></div><div class="line"><a name="l02022"></a><span class="lineno"> 2022</span>&#160;      <a class="code" href="TGHtml_8h.html#ad5bb4a3d12fd54f29da2b924b29e652b">TRACE</a>(XERR, <span class="stringliteral">&quot;returned from execv: bad, bad sign !!! errno:&quot;</span> &lt;&lt; (<span class="keywordtype">int</span>)errno);</div><div class="line"><a name="l02023"></a><span class="lineno"> 2023</span>&#160;      exit(1);</div><div class="line"><a name="l02024"></a><span class="lineno"> 2024</span>&#160;   }</div><div class="line"><a name="l02025"></a><span class="lineno"> 2025</span>&#160;</div><div class="line"><a name="l02026"></a><span class="lineno"> 2026</span>&#160;   <span class="comment">// Wakeup colleagues</span></div><div class="line"><a name="l02027"></a><span class="lineno"> 2027</span>&#160;   <a class="code" href="classXrdProofdProofServMgr.html#a4989c26817d0896a76f54fa9916229a3">fForkSem</a>.Post();</div><div class="line"><a name="l02028"></a><span class="lineno"> 2028</span>&#160;</div><div class="line"><a name="l02029"></a><span class="lineno"> 2029</span>&#160;   <span class="comment">// parent process</span></div><div class="line"><a name="l02030"></a><span class="lineno"> 2030</span>&#160;   <span class="keywordflow">if</span> (pid &lt; 0) {</div><div class="line"><a name="l02031"></a><span class="lineno"> 2031</span>&#160;      xps-&gt;<a class="code" href="classXrdProofdProofServ.html#ac4953244f65634a9ee47299d408591d8">Reset</a>();</div><div class="line"><a name="l02032"></a><span class="lineno"> 2032</span>&#160;      <span class="comment">// Failure in forking</span></div><div class="line"><a name="l02033"></a><span class="lineno"> 2033</span>&#160;      response-&gt;Send(<a class="code" href="XProofProtocol_8h.html#a81dc1edcb19adb12975b44e65a3c88f4afccd8aacc7086f7ef815d546a9336fe9">kXP_ServerError</a>, <span class="stringliteral">&quot;could not fork agent&quot;</span>);</div><div class="line"><a name="l02034"></a><span class="lineno"> 2034</span>&#160;      <span class="keywordflow">return</span> 0;</div><div class="line"><a name="l02035"></a><span class="lineno"> 2035</span>&#160;   }</div><div class="line"><a name="l02036"></a><span class="lineno"> 2036</span>&#160;</div><div class="line"><a name="l02037"></a><span class="lineno"> 2037</span>&#160;   <a class="code" href="XrdProofdTrace_8h.html#a83f50a6ac1ca86524725ed11340e3b26">TRACEP</a>(p, FORK,<span class="stringliteral">&quot;Parent process: child is &quot;</span>&lt;&lt;pid);</div><div class="line"><a name="l02038"></a><span class="lineno"> 2038</span>&#160;   XrdOucString emsg;</div><div class="line"><a name="l02039"></a><span class="lineno"> 2039</span>&#160;</div><div class="line"><a name="l02040"></a><span class="lineno"> 2040</span>&#160;   <span class="comment">// Finalize unique tag and relevant dirs for this session</span></div><div class="line"><a name="l02041"></a><span class="lineno"> 2041</span>&#160;   <a class="code" href="classXrdProofdProofServMgr.html#aabf69cec905249efe3d8375a2ef382dc">GetTagDirs</a>((<span class="keywordtype">int</span>)pid, p, xps, in.<a class="code" href="structProofServEnv__t.html#af4140705c69b78b2c0fd55131a0844dd">fSessionTag</a>, in.<a class="code" href="structProofServEnv__t.html#a063361fdad238f075537682178fdd1b3">fTopSessionTag</a>, in.<a class="code" href="structProofServEnv__t.html#a3a5c4ac123b8f92ad80003958476afbb">fSessionDir</a>, in.<a class="code" href="structProofServEnv__t.html#a24e0948cb1405b0d8c8360500ef20707">fWrkDir</a>);</div><div class="line"><a name="l02042"></a><span class="lineno"> 2042</span>&#160;</div><div class="line"><a name="l02043"></a><span class="lineno"> 2043</span>&#160;   <span class="comment">// Create log file path</span></div><div class="line"><a name="l02044"></a><span class="lineno"> 2044</span>&#160;   <a class="code" href="classXrdProofdProofServMgr.html#a43977fa295e3c2755edcb43dd95de1de">FormFileNameInSessionDir</a>(p, xps, in.<a class="code" href="structProofServEnv__t.html#a3a5c4ac123b8f92ad80003958476afbb">fSessionDir</a>.c_str(), <span class="stringliteral">&quot;log&quot;</span>, in.<a class="code" href="structProofServEnv__t.html#a88002c75764b173de52afd5f9b3c6c74">fLogFile</a>);</div><div class="line"><a name="l02045"></a><span class="lineno"> 2045</span>&#160;</div><div class="line"><a name="l02046"></a><span class="lineno"> 2046</span>&#160;   <a class="code" href="XrdProofdTrace_8h.html#a83f50a6ac1ca86524725ed11340e3b26">TRACEP</a>(p, FORK, <span class="stringliteral">&quot;log file: &quot;</span>&lt;&lt;in.<a class="code" href="structProofServEnv__t.html#a88002c75764b173de52afd5f9b3c6c74">fLogFile</a>);</div><div class="line"><a name="l02047"></a><span class="lineno"> 2047</span>&#160;</div><div class="line"><a name="l02048"></a><span class="lineno"> 2048</span>&#160;   <span class="comment">// Log prefix</span></div><div class="line"><a name="l02049"></a><span class="lineno"> 2049</span>&#160;   XrdOucString npfx;</div><div class="line"><a name="l02050"></a><span class="lineno"> 2050</span>&#160;   <a class="code" href="XrdProofdAux_8h.html#a631cc8787af1a02d9e51c86117ae042e">XPDFORM</a>(npfx, <span class="stringliteral">&quot;%s-%s:&quot;</span>, (p-&gt;<a class="code" href="classXrdProofdProtocol.html#a71898b7c3788b133364db067d1f47c24">ConnType</a>() == <a class="code" href="XProofProtocol_8h.html#ad7a933edf8c125412fd985f6f2bc771e">kXPD_MasterWorker</a>) ? <span class="stringliteral">&quot;wrk&quot;</span> : <span class="stringliteral">&quot;mst&quot;</span>, xps-&gt;<a class="code" href="classXrdProofdProofServ.html#a85958cf8241aee02a376befe6ab98e98">Ordinal</a>());</div><div class="line"><a name="l02051"></a><span class="lineno"> 2051</span>&#160;</div><div class="line"><a name="l02052"></a><span class="lineno"> 2052</span>&#160;   <span class="comment">// Cleanup current socket, if any</span></div><div class="line"><a name="l02053"></a><span class="lineno"> 2053</span>&#160;   <span class="keywordflow">if</span> (xps-&gt;<a class="code" href="classXrdProofdProofServ.html#a6d021563fa5819a9d41720df41c54e7c">UNIXSock</a>()) {</div><div class="line"><a name="l02054"></a><span class="lineno"> 2054</span>&#160;      <a class="code" href="XrdProofdTrace_8h.html#a83f50a6ac1ca86524725ed11340e3b26">TRACEP</a>(p, FORK,<span class="stringliteral">&quot;current UNIX sock: &quot;</span>&lt;&lt;xps-&gt;<a class="code" href="classXrdProofdProofServ.html#a6d021563fa5819a9d41720df41c54e7c">UNIXSock</a>() &lt;&lt;<span class="stringliteral">&quot;, path: &quot;</span>&lt;&lt;xps-&gt;<a class="code" href="classXrdProofdProofServ.html#adbac6b3286754cb303806f8d70e58765">UNIXSockPath</a>());</div><div class="line"><a name="l02055"></a><span class="lineno"> 2055</span>&#160;      xps-&gt;<a class="code" href="classXrdProofdProofServ.html#a26e445b7ebf718988608f149309c6fa4">DeleteUNIXSock</a>();</div><div class="line"><a name="l02056"></a><span class="lineno"> 2056</span>&#160;   }</div><div class="line"><a name="l02057"></a><span class="lineno"> 2057</span>&#160;</div><div class="line"><a name="l02058"></a><span class="lineno"> 2058</span>&#160;   <span class="comment">// Admin and UNIX Socket Path (set path and create the socket); we need to</span></div><div class="line"><a name="l02059"></a><span class="lineno"> 2059</span>&#160;   <span class="comment">// set and create them in here, otherwise the cleaning may remove the socket</span></div><div class="line"><a name="l02060"></a><span class="lineno"> 2060</span>&#160;   XrdOucString path, sockpath;</div><div class="line"><a name="l02061"></a><span class="lineno"> 2061</span>&#160;   <a class="code" href="XrdProofdAux_8h.html#a631cc8787af1a02d9e51c86117ae042e">XPDFORM</a>(path, <span class="stringliteral">&quot;%s/%s.%s.%d&quot;</span>, <a class="code" href="classXrdProofdProofServMgr.html#aa7d4e4ec33be14cd70bbc3595332736e">fActiAdminPath</a>.c_str(),</div><div class="line"><a name="l02062"></a><span class="lineno"> 2062</span>&#160;                                p-&gt;<a class="code" href="classXrdProofdProtocol.html#a80024c8f848d0eabe9f13d09f06c8d9d">Client</a>()-&gt;<a class="code" href="classXrdProofdClient.html#a3cbe604999cdb44ae9d0ec833ffa5900">User</a>(), p-&gt;<a class="code" href="classXrdProofdProtocol.html#a80024c8f848d0eabe9f13d09f06c8d9d">Client</a>()-&gt;<a class="code" href="classXrdProofdClient.html#af82bc301c99dc688038ba2c771b5c49e">Group</a>(), pid);</div><div class="line"><a name="l02063"></a><span class="lineno"> 2063</span>&#160;   <span class="comment">// Sock path under dedicated directory to avoid problems related to its length</span></div><div class="line"><a name="l02064"></a><span class="lineno"> 2064</span>&#160;   <a class="code" href="XrdProofdAux_8h.html#a631cc8787af1a02d9e51c86117ae042e">XPDFORM</a>(sockpath, <span class="stringliteral">&quot;%s/xpd.%d.%d&quot;</span>, <a class="code" href="classXrdProofdProofServMgr.html#a86cac591a5646811e38ff6a2477f4da7">fMgr</a>-&gt;<a class="code" href="classXrdProofdManager.html#ae3b470855b0b39e2adaa8ae303e5b402">SockPathDir</a>(), <a class="code" href="classXrdProofdProofServMgr.html#a86cac591a5646811e38ff6a2477f4da7">fMgr</a>-&gt;<a class="code" href="classXrdProofdManager.html#a128a9af44f04fdbf956b893c7a16d45b">Port</a>(), pid);</div><div class="line"><a name="l02065"></a><span class="lineno"> 2065</span>&#160;   <span class="keyword">struct </span>sockaddr_un unserver;</div><div class="line"><a name="l02066"></a><span class="lineno"> 2066</span>&#160;   <span class="keywordflow">if</span> (sockpath.length() &gt; (int)(<span class="keyword">sizeof</span>(unserver.sun_path) - 1)) {</div><div class="line"><a name="l02067"></a><span class="lineno"> 2067</span>&#160;      emsg = <span class="stringliteral">&quot;socket path very long (&quot;</span>;</div><div class="line"><a name="l02068"></a><span class="lineno"> 2068</span>&#160;      emsg += sockpath.length();</div><div class="line"><a name="l02069"></a><span class="lineno"> 2069</span>&#160;      emsg += <span class="stringliteral">&quot;): this may lead to stack corruption!&quot;</span>;</div><div class="line"><a name="l02070"></a><span class="lineno"> 2070</span>&#160;      emsg += <span class="stringliteral">&quot; Use xpd.sockpathdir to change it&quot;</span>;</div><div class="line"><a name="l02071"></a><span class="lineno"> 2071</span>&#160;      <a class="code" href="XrdProofdTrace_8h.html#a83f50a6ac1ca86524725ed11340e3b26">TRACEP</a>(p, XERR, emsg.c_str());</div><div class="line"><a name="l02072"></a><span class="lineno"> 2072</span>&#160;   }</div><div class="line"><a name="l02073"></a><span class="lineno"> 2073</span>&#160;   <span class="keywordtype">int</span> pathrc = 0;</div><div class="line"><a name="l02074"></a><span class="lineno"> 2074</span>&#160;   <span class="keywordflow">if</span> (!pathrc &amp;&amp; !(pathrc = xps-&gt;<a class="code" href="classXrdProofdProofServ.html#aa4580fce80e7fb2795eaa29a262cb309">SetAdminPath</a>(path.c_str(), 1, <a class="code" href="classXrdProofdProofServMgr.html#a86cac591a5646811e38ff6a2477f4da7">fMgr</a>-&gt;<a class="code" href="classXrdProofdManager.html#a15d2e414e67bfc0cc4304605a6b509ff">ChangeOwn</a>()))) {</div><div class="line"><a name="l02075"></a><span class="lineno"> 2075</span>&#160;      <span class="comment">// Communicate the path to child</span></div><div class="line"><a name="l02076"></a><span class="lineno"> 2076</span>&#160;      <span class="keywordflow">if</span> ((pathrc = fpc.<a class="code" href="classXrdProofdPipe.html#af3d2dbc5b021d794acc09bdc0aa3fa5e">Post</a>(0, path.c_str())) != 0) {</div><div class="line"><a name="l02077"></a><span class="lineno"> 2077</span>&#160;         emsg = <span class="stringliteral">&quot;failed to communicating path to child&quot;</span>;</div><div class="line"><a name="l02078"></a><span class="lineno"> 2078</span>&#160;         <a class="code" href="classXrdProofdAux.html#acfae2dfa1609be5e19ff91b5d0ee5699">XrdProofdAux::LogEmsgToFile</a>(in.<a class="code" href="structProofServEnv__t.html#a88002c75764b173de52afd5f9b3c6c74">fLogFile</a>.c_str(), emsg.c_str(), npfx.c_str());</div><div class="line"><a name="l02079"></a><span class="lineno"> 2079</span>&#160;         <a class="code" href="XrdProofdTrace_8h.html#a83f50a6ac1ca86524725ed11340e3b26">TRACEP</a>(p, XERR, emsg.c_str());</div><div class="line"><a name="l02080"></a><span class="lineno"> 2080</span>&#160;      }</div><div class="line"><a name="l02081"></a><span class="lineno"> 2081</span>&#160;   } <span class="keywordflow">else</span> {</div><div class="line"><a name="l02082"></a><span class="lineno"> 2082</span>&#160;      emsg = <span class="stringliteral">&quot;failed to setup child admin path&quot;</span>;</div><div class="line"><a name="l02083"></a><span class="lineno"> 2083</span>&#160;      <span class="comment">// Communicate failure to child</span></div><div class="line"><a name="l02084"></a><span class="lineno"> 2084</span>&#160;      <span class="keywordflow">if</span> ((pathrc = fpc.<a class="code" href="classXrdProofdPipe.html#af3d2dbc5b021d794acc09bdc0aa3fa5e">Post</a>(-1, path.c_str())) != 0) {</div><div class="line"><a name="l02085"></a><span class="lineno"> 2085</span>&#160;         emsg += <span class="stringliteral">&quot;: failed communicating failure to child&quot;</span>;</div><div class="line"><a name="l02086"></a><span class="lineno"> 2086</span>&#160;         <a class="code" href="classXrdProofdAux.html#acfae2dfa1609be5e19ff91b5d0ee5699">XrdProofdAux::LogEmsgToFile</a>(in.<a class="code" href="structProofServEnv__t.html#a88002c75764b173de52afd5f9b3c6c74">fLogFile</a>.c_str(), emsg.c_str(), npfx.c_str());</div><div class="line"><a name="l02087"></a><span class="lineno"> 2087</span>&#160;         <a class="code" href="XrdProofdTrace_8h.html#a83f50a6ac1ca86524725ed11340e3b26">TRACEP</a>(p, XERR, emsg.c_str());</div><div class="line"><a name="l02088"></a><span class="lineno"> 2088</span>&#160;      }</div><div class="line"><a name="l02089"></a><span class="lineno"> 2089</span>&#160;   }</div><div class="line"><a name="l02090"></a><span class="lineno"> 2090</span>&#160;   <span class="comment">// Now create the UNIX sock path</span></div><div class="line"><a name="l02091"></a><span class="lineno"> 2091</span>&#160;   <span class="keywordflow">if</span> (!pathrc) {</div><div class="line"><a name="l02092"></a><span class="lineno"> 2092</span>&#160;      xps-&gt;<a class="code" href="classXrdProofdProofServ.html#ac4a8e8c6ff235136af0486340aced428">SetUNIXSockPath</a>(sockpath.c_str());</div><div class="line"><a name="l02093"></a><span class="lineno"> 2093</span>&#160;      <span class="keywordflow">if</span> ((pathrc = xps-&gt;<a class="code" href="classXrdProofdProofServ.html#a7ef7d888b3308f42fd4a90558851e55d">CreateUNIXSock</a>(<a class="code" href="classXrdProofdConfig.html#a604213f0bcb2d2a3494610fedda8e975">fEDest</a>)) != 0) {</div><div class="line"><a name="l02094"></a><span class="lineno"> 2094</span>&#160;         <span class="comment">// Failure</span></div><div class="line"><a name="l02095"></a><span class="lineno"> 2095</span>&#160;         emsg = <span class="stringliteral">&quot;failure creating UNIX socket on &quot;</span> ;</div><div class="line"><a name="l02096"></a><span class="lineno"> 2096</span>&#160;         emsg += sockpath;</div><div class="line"><a name="l02097"></a><span class="lineno"> 2097</span>&#160;         <a class="code" href="classXrdProofdAux.html#acfae2dfa1609be5e19ff91b5d0ee5699">XrdProofdAux::LogEmsgToFile</a>(in.<a class="code" href="structProofServEnv__t.html#a88002c75764b173de52afd5f9b3c6c74">fLogFile</a>.c_str(), emsg.c_str(), npfx.c_str());</div><div class="line"><a name="l02098"></a><span class="lineno"> 2098</span>&#160;         <a class="code" href="XrdProofdTrace_8h.html#a83f50a6ac1ca86524725ed11340e3b26">TRACEP</a>(p, XERR, emsg.c_str());</div><div class="line"><a name="l02099"></a><span class="lineno"> 2099</span>&#160;      }</div><div class="line"><a name="l02100"></a><span class="lineno"> 2100</span>&#160;   }</div><div class="line"><a name="l02101"></a><span class="lineno"> 2101</span>&#160;   <span class="keywordflow">if</span> (!pathrc) {</div><div class="line"><a name="l02102"></a><span class="lineno"> 2102</span>&#160;      <a class="code" href="XrdProofdTrace_8h.html#a83f50a6ac1ca86524725ed11340e3b26">TRACEP</a>(p, FORK,<span class="stringliteral">&quot;UNIX sock: &quot;</span>&lt;&lt;xps-&gt;<a class="code" href="classXrdProofdProofServ.html#adbac6b3286754cb303806f8d70e58765">UNIXSockPath</a>());</div><div class="line"><a name="l02103"></a><span class="lineno"> 2103</span>&#160;      <span class="keywordflow">if</span> ((pathrc = chown(sockpath.c_str(), p-&gt;<a class="code" href="classXrdProofdProtocol.html#a80024c8f848d0eabe9f13d09f06c8d9d">Client</a>()-&gt;<a class="code" href="classXrdProofdClient.html#a062a4396b4b8f0667f3a97a64c7f1c3d">UI</a>().<a class="code" href="classXrdProofUI.html#aa16ddd6d492cb4e498d5a94df6b037a9">fUid</a>, p-&gt;<a class="code" href="classXrdProofdProtocol.html#a80024c8f848d0eabe9f13d09f06c8d9d">Client</a>()-&gt;<a class="code" href="classXrdProofdClient.html#a062a4396b4b8f0667f3a97a64c7f1c3d">UI</a>().<a class="code" href="classXrdProofUI.html#a02d91475e698860e6cf2eb5a8e9c29ec">fGid</a>)) != 0) {</div><div class="line"><a name="l02104"></a><span class="lineno"> 2104</span>&#160;         emsg = <span class="stringliteral">&quot;failure changing ownership of the UNIX socket on &quot;</span> ;</div><div class="line"><a name="l02105"></a><span class="lineno"> 2105</span>&#160;         emsg += sockpath;</div><div class="line"><a name="l02106"></a><span class="lineno"> 2106</span>&#160;         emsg += <span class="stringliteral">&quot;; errno: &quot;</span> ;</div><div class="line"><a name="l02107"></a><span class="lineno"> 2107</span>&#160;         emsg += errno;</div><div class="line"><a name="l02108"></a><span class="lineno"> 2108</span>&#160;         <a class="code" href="classXrdProofdAux.html#acfae2dfa1609be5e19ff91b5d0ee5699">XrdProofdAux::LogEmsgToFile</a>(in.<a class="code" href="structProofServEnv__t.html#a88002c75764b173de52afd5f9b3c6c74">fLogFile</a>.c_str(), emsg.c_str(), npfx.c_str());</div><div class="line"><a name="l02109"></a><span class="lineno"> 2109</span>&#160;         <a class="code" href="XrdProofdTrace_8h.html#a83f50a6ac1ca86524725ed11340e3b26">TRACEP</a>(p, XERR, emsg.c_str());</div><div class="line"><a name="l02110"></a><span class="lineno"> 2110</span>&#160;      }</div><div class="line"><a name="l02111"></a><span class="lineno"> 2111</span>&#160;   }</div><div class="line"><a name="l02112"></a><span class="lineno"> 2112</span>&#160;   <span class="comment">// Communicate sockpath or failure, if any</span></div><div class="line"><a name="l02113"></a><span class="lineno"> 2113</span>&#160;   <span class="keywordflow">if</span> (!pathrc) {</div><div class="line"><a name="l02114"></a><span class="lineno"> 2114</span>&#160;      <span class="comment">// Communicate the path to child</span></div><div class="line"><a name="l02115"></a><span class="lineno"> 2115</span>&#160;      <span class="keywordflow">if</span> ((pathrc = fpc.<a class="code" href="classXrdProofdPipe.html#af3d2dbc5b021d794acc09bdc0aa3fa5e">Post</a>(0, sockpath.c_str())) != 0) {</div><div class="line"><a name="l02116"></a><span class="lineno"> 2116</span>&#160;         emsg = <span class="stringliteral">&quot;failed to communicating path to child&quot;</span>;</div><div class="line"><a name="l02117"></a><span class="lineno"> 2117</span>&#160;         <a class="code" href="classXrdProofdAux.html#acfae2dfa1609be5e19ff91b5d0ee5699">XrdProofdAux::LogEmsgToFile</a>(in.<a class="code" href="structProofServEnv__t.html#a88002c75764b173de52afd5f9b3c6c74">fLogFile</a>.c_str(), emsg.c_str(), npfx.c_str());</div><div class="line"><a name="l02118"></a><span class="lineno"> 2118</span>&#160;         <a class="code" href="XrdProofdTrace_8h.html#a83f50a6ac1ca86524725ed11340e3b26">TRACEP</a>(p, XERR, emsg.c_str());</div><div class="line"><a name="l02119"></a><span class="lineno"> 2119</span>&#160;      }</div><div class="line"><a name="l02120"></a><span class="lineno"> 2120</span>&#160;   } <span class="keywordflow">else</span> {</div><div class="line"><a name="l02121"></a><span class="lineno"> 2121</span>&#160;      emsg = <span class="stringliteral">&quot;failed to setup child admin path&quot;</span>;</div><div class="line"><a name="l02122"></a><span class="lineno"> 2122</span>&#160;      <span class="comment">// Communicate failure to child</span></div><div class="line"><a name="l02123"></a><span class="lineno"> 2123</span>&#160;      <span class="keywordflow">if</span> ((pathrc = fpc.<a class="code" href="classXrdProofdPipe.html#af3d2dbc5b021d794acc09bdc0aa3fa5e">Post</a>(-1, sockpath.c_str())) != 0) {</div><div class="line"><a name="l02124"></a><span class="lineno"> 2124</span>&#160;         emsg += <span class="stringliteral">&quot;: failed communicating failure to child&quot;</span>;</div><div class="line"><a name="l02125"></a><span class="lineno"> 2125</span>&#160;         <a class="code" href="classXrdProofdAux.html#acfae2dfa1609be5e19ff91b5d0ee5699">XrdProofdAux::LogEmsgToFile</a>(in.<a class="code" href="structProofServEnv__t.html#a88002c75764b173de52afd5f9b3c6c74">fLogFile</a>.c_str(), emsg.c_str(), npfx.c_str());</div><div class="line"><a name="l02126"></a><span class="lineno"> 2126</span>&#160;         <a class="code" href="XrdProofdTrace_8h.html#a83f50a6ac1ca86524725ed11340e3b26">TRACEP</a>(p, XERR, emsg.c_str());</div><div class="line"><a name="l02127"></a><span class="lineno"> 2127</span>&#160;      }</div><div class="line"><a name="l02128"></a><span class="lineno"> 2128</span>&#160;   }</div><div class="line"><a name="l02129"></a><span class="lineno"> 2129</span>&#160;</div><div class="line"><a name="l02130"></a><span class="lineno"> 2130</span>&#160;   <span class="keywordflow">if</span> (pathrc != 0) {</div><div class="line"><a name="l02131"></a><span class="lineno"> 2131</span>&#160;      <span class="comment">// Failure</span></div><div class="line"><a name="l02132"></a><span class="lineno"> 2132</span>&#160;      xps-&gt;<a class="code" href="classXrdProofdProofServ.html#ac4953244f65634a9ee47299d408591d8">Reset</a>();</div><div class="line"><a name="l02133"></a><span class="lineno"> 2133</span>&#160;      <a class="code" href="classXrdProofdAux.html#a6b1d64972dcdae69de7af68d43fdd5be">XrdProofdAux::KillProcess</a>(pid, 1, p-&gt;<a class="code" href="classXrdProofdProtocol.html#a80024c8f848d0eabe9f13d09f06c8d9d">Client</a>()-&gt;<a class="code" href="classXrdProofdClient.html#a062a4396b4b8f0667f3a97a64c7f1c3d">UI</a>(), <a class="code" href="classXrdProofdProofServMgr.html#a86cac591a5646811e38ff6a2477f4da7">fMgr</a>-&gt;<a class="code" href="classXrdProofdManager.html#a15d2e414e67bfc0cc4304605a6b509ff">ChangeOwn</a>());</div><div class="line"><a name="l02134"></a><span class="lineno"> 2134</span>&#160;      <span class="comment">// Make sure that the log file path reaches the caller</span></div><div class="line"><a name="l02135"></a><span class="lineno"> 2135</span>&#160;      emsg += <span class="stringliteral">&quot;|log:&quot;</span>;</div><div class="line"><a name="l02136"></a><span class="lineno"> 2136</span>&#160;      emsg += in.<a class="code" href="structProofServEnv__t.html#a88002c75764b173de52afd5f9b3c6c74">fLogFile</a>;</div><div class="line"><a name="l02137"></a><span class="lineno"> 2137</span>&#160;      emsg.insert(npfx, 0);</div><div class="line"><a name="l02138"></a><span class="lineno"> 2138</span>&#160;      response-&gt;Send(<a class="code" href="XProofProtocol_8h.html#a81dc1edcb19adb12975b44e65a3c88f4afccd8aacc7086f7ef815d546a9336fe9">kXP_ServerError</a>, emsg.c_str());</div><div class="line"><a name="l02139"></a><span class="lineno"> 2139</span>&#160;      <span class="keywordflow">return</span> 0;</div><div class="line"><a name="l02140"></a><span class="lineno"> 2140</span>&#160;   }</div><div class="line"><a name="l02141"></a><span class="lineno"> 2141</span>&#160;</div><div class="line"><a name="l02142"></a><span class="lineno"> 2142</span>&#160;   <a class="code" href="XrdProofdTrace_8h.html#a83f50a6ac1ca86524725ed11340e3b26">TRACEP</a>(p, FORK, <span class="stringliteral">&quot;waiting for client setup status ...&quot;</span>);</div><div class="line"><a name="l02143"></a><span class="lineno"> 2143</span>&#160;</div><div class="line"><a name="l02144"></a><span class="lineno"> 2144</span>&#160;   emsg = <span class="stringliteral">&quot;proofserv setup&quot;</span>;</div><div class="line"><a name="l02145"></a><span class="lineno"> 2145</span>&#160;   <span class="comment">// Wait for the setup process on the pipe, 20 secs max (10 x 2000 millisecs): this</span></div><div class="line"><a name="l02146"></a><span class="lineno"> 2146</span>&#160;   <span class="comment">// is enough to cover possible delays due to heavy load; the client will anyhow</span></div><div class="line"><a name="l02147"></a><span class="lineno"> 2147</span>&#160;   <span class="comment">// retry a few times</span></div><div class="line"><a name="l02148"></a><span class="lineno"> 2148</span>&#160;   <span class="keywordtype">int</span> ntry = 10, prc = 0, rst = -1;</div><div class="line"><a name="l02149"></a><span class="lineno"> 2149</span>&#160;   <span class="keywordflow">while</span> (prc == 0 &amp;&amp; ntry--) {</div><div class="line"><a name="l02150"></a><span class="lineno"> 2150</span>&#160;      <span class="comment">// Poll for 2 secs</span></div><div class="line"><a name="l02151"></a><span class="lineno"> 2151</span>&#160;      <span class="keywordflow">if</span> ((prc = fcp.<a class="code" href="classXrdProofdPipe.html#a51532896ac35adec6efe6840dcac0354">Poll</a>(2)) &gt; 0) {</div><div class="line"><a name="l02152"></a><span class="lineno"> 2152</span>&#160;         <span class="comment">// Got something: read the message out</span></div><div class="line"><a name="l02153"></a><span class="lineno"> 2153</span>&#160;         <a class="code" href="classXpdMsg.html">XpdMsg</a> xmsg;</div><div class="line"><a name="l02154"></a><span class="lineno"> 2154</span>&#160;         <span class="keywordflow">if</span> (fcp.<a class="code" href="classXrdProofdPipe.html#a4d40ad82fde9e49c25085779ad82c27c">Recv</a>(xmsg) != 0) {</div><div class="line"><a name="l02155"></a><span class="lineno"> 2155</span>&#160;            emsg = <span class="stringliteral">&quot;error receiving message from pipe&quot;</span>;</div><div class="line"><a name="l02156"></a><span class="lineno"> 2156</span>&#160;            <a class="code" href="classXrdProofdAux.html#acfae2dfa1609be5e19ff91b5d0ee5699">XrdProofdAux::LogEmsgToFile</a>(in.<a class="code" href="structProofServEnv__t.html#a88002c75764b173de52afd5f9b3c6c74">fLogFile</a>.c_str(), emsg.c_str(), npfx.c_str());</div><div class="line"><a name="l02157"></a><span class="lineno"> 2157</span>&#160;            <a class="code" href="XrdProofdTrace_8h.html#a83f50a6ac1ca86524725ed11340e3b26">TRACEP</a>(p, XERR, emsg.c_str());</div><div class="line"><a name="l02158"></a><span class="lineno"> 2158</span>&#160;            prc = -1;</div><div class="line"><a name="l02159"></a><span class="lineno"> 2159</span>&#160;            <span class="keywordflow">break</span>;</div><div class="line"><a name="l02160"></a><span class="lineno"> 2160</span>&#160;         }</div><div class="line"><a name="l02161"></a><span class="lineno"> 2161</span>&#160;         <span class="comment">// Status is the message type</span></div><div class="line"><a name="l02162"></a><span class="lineno"> 2162</span>&#160;         rst = xmsg.<a class="code" href="classXpdMsg.html#a29c82456ff1bc75ba72be288f96c7693">Type</a>();</div><div class="line"><a name="l02163"></a><span class="lineno"> 2163</span>&#160;         <span class="comment">// Read string, if any</span></div><div class="line"><a name="l02164"></a><span class="lineno"> 2164</span>&#160;         XrdOucString xbuf = xmsg.<a class="code" href="classXpdMsg.html#a76f23fb246000fb53707c441192776a7">Buf</a>();</div><div class="line"><a name="l02165"></a><span class="lineno"> 2165</span>&#160;         <span class="keywordflow">if</span> (xbuf.length() &lt;= 0) {</div><div class="line"><a name="l02166"></a><span class="lineno"> 2166</span>&#160;            emsg = <span class="stringliteral">&quot;error reading buffer {logfile, error message} from message received on the pipe&quot;</span>;</div><div class="line"><a name="l02167"></a><span class="lineno"> 2167</span>&#160;            <a class="code" href="classXrdProofdAux.html#acfae2dfa1609be5e19ff91b5d0ee5699">XrdProofdAux::LogEmsgToFile</a>(in.<a class="code" href="structProofServEnv__t.html#a88002c75764b173de52afd5f9b3c6c74">fLogFile</a>.c_str(), emsg.c_str(), npfx.c_str());</div><div class="line"><a name="l02168"></a><span class="lineno"> 2168</span>&#160;            <a class="code" href="XrdProofdTrace_8h.html#a83f50a6ac1ca86524725ed11340e3b26">TRACEP</a>(p, XERR, emsg.c_str());</div><div class="line"><a name="l02169"></a><span class="lineno"> 2169</span>&#160;            prc = -1;</div><div class="line"><a name="l02170"></a><span class="lineno"> 2170</span>&#160;            <span class="keywordflow">break</span>;</div><div class="line"><a name="l02171"></a><span class="lineno"> 2171</span>&#160;         }</div><div class="line"><a name="l02172"></a><span class="lineno"> 2172</span>&#160;         <span class="keywordflow">if</span> (rst &gt; 0) {</div><div class="line"><a name="l02173"></a><span class="lineno"> 2173</span>&#160;            <span class="comment">// Set the log file</span></div><div class="line"><a name="l02174"></a><span class="lineno"> 2174</span>&#160;            xps-&gt;<a class="code" href="classXrdProofdProofServ.html#aa48a1e58fb1d7a0c0cefdb9ded292d07">SetFileout</a>(xbuf.c_str());</div><div class="line"><a name="l02175"></a><span class="lineno"> 2175</span>&#160;            <span class="comment">// Set also the session tag</span></div><div class="line"><a name="l02176"></a><span class="lineno"> 2176</span>&#160;            XrdOucString stag(xbuf);</div><div class="line"><a name="l02177"></a><span class="lineno"> 2177</span>&#160;            stag.erase(stag.rfind(<span class="charliteral">&#39;/&#39;</span>));</div><div class="line"><a name="l02178"></a><span class="lineno"> 2178</span>&#160;            stag.erase(0, stag.find(<span class="stringliteral">&quot;session-&quot;</span>) + strlen(<span class="stringliteral">&quot;session-&quot;</span>));</div><div class="line"><a name="l02179"></a><span class="lineno"> 2179</span>&#160;            xps-&gt;<a class="code" href="classXrdProofdProofServ.html#a4b99be0402107389bc029cc36aba8e07">SetTag</a>(stag.c_str());</div><div class="line"><a name="l02180"></a><span class="lineno"> 2180</span>&#160;</div><div class="line"><a name="l02181"></a><span class="lineno"> 2181</span>&#160;         } <span class="keywordflow">else</span> {</div><div class="line"><a name="l02182"></a><span class="lineno"> 2182</span>&#160;            <span class="comment">// Setup failed: save the error</span></div><div class="line"><a name="l02183"></a><span class="lineno"> 2183</span>&#160;            prc = -1;</div><div class="line"><a name="l02184"></a><span class="lineno"> 2184</span>&#160;            emsg = <span class="stringliteral">&quot;failed: &quot;</span>;</div><div class="line"><a name="l02185"></a><span class="lineno"> 2185</span>&#160;            emsg += xbuf;</div><div class="line"><a name="l02186"></a><span class="lineno"> 2186</span>&#160;            <a class="code" href="classXrdProofdAux.html#acfae2dfa1609be5e19ff91b5d0ee5699">XrdProofdAux::LogEmsgToFile</a>(in.<a class="code" href="structProofServEnv__t.html#a88002c75764b173de52afd5f9b3c6c74">fLogFile</a>.c_str(), emsg.c_str(), npfx.c_str());</div><div class="line"><a name="l02187"></a><span class="lineno"> 2187</span>&#160;            <a class="code" href="XrdProofdTrace_8h.html#a83f50a6ac1ca86524725ed11340e3b26">TRACEP</a>(p, XERR, emsg.c_str());</div><div class="line"><a name="l02188"></a><span class="lineno"> 2188</span>&#160;            <span class="keywordflow">break</span>;</div><div class="line"><a name="l02189"></a><span class="lineno"> 2189</span>&#160;         }</div><div class="line"><a name="l02190"></a><span class="lineno"> 2190</span>&#160;</div><div class="line"><a name="l02191"></a><span class="lineno"> 2191</span>&#160;      } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (prc &lt; 0) {</div><div class="line"><a name="l02192"></a><span class="lineno"> 2192</span>&#160;         emsg = <span class="stringliteral">&quot;error receive status-of-setup from pipe&quot;</span>;</div><div class="line"><a name="l02193"></a><span class="lineno"> 2193</span>&#160;         <a class="code" href="classXrdProofdAux.html#acfae2dfa1609be5e19ff91b5d0ee5699">XrdProofdAux::LogEmsgToFile</a>(in.<a class="code" href="structProofServEnv__t.html#a88002c75764b173de52afd5f9b3c6c74">fLogFile</a>.c_str(), emsg.c_str(), npfx.c_str());</div><div class="line"><a name="l02194"></a><span class="lineno"> 2194</span>&#160;         <a class="code" href="XrdProofdTrace_8h.html#a83f50a6ac1ca86524725ed11340e3b26">TRACEP</a>(p, XERR, emsg.c_str());</div><div class="line"><a name="l02195"></a><span class="lineno"> 2195</span>&#160;         <span class="keywordflow">break</span>;</div><div class="line"><a name="l02196"></a><span class="lineno"> 2196</span>&#160;      } <span class="keywordflow">else</span> {</div><div class="line"><a name="l02197"></a><span class="lineno"> 2197</span>&#160;         <a class="code" href="XrdProofdTrace_8h.html#a83f50a6ac1ca86524725ed11340e3b26">TRACEP</a>(p, FORK, <span class="stringliteral">&quot;receiving status-of-setup from pipe: waiting 2 s ...&quot;</span>&lt;&lt;pid);</div><div class="line"><a name="l02198"></a><span class="lineno"> 2198</span>&#160;      }</div><div class="line"><a name="l02199"></a><span class="lineno"> 2199</span>&#160;   }</div><div class="line"><a name="l02200"></a><span class="lineno"> 2200</span>&#160;</div><div class="line"><a name="l02201"></a><span class="lineno"> 2201</span>&#160;   <span class="comment">// Close pipes</span></div><div class="line"><a name="l02202"></a><span class="lineno"> 2202</span>&#160;   fpc.<a class="code" href="classXrdProofdPipe.html#a5aa4739df39754c05bee043d99d74b00">Close</a>();</div><div class="line"><a name="l02203"></a><span class="lineno"> 2203</span>&#160;   fcp.<a class="code" href="classXrdProofdPipe.html#a5aa4739df39754c05bee043d99d74b00">Close</a>();</div><div class="line"><a name="l02204"></a><span class="lineno"> 2204</span>&#160;</div><div class="line"><a name="l02205"></a><span class="lineno"> 2205</span>&#160;   <a class="code" href="XrdProofdTrace_8h.html#a83f50a6ac1ca86524725ed11340e3b26">TRACEP</a>(p, FORK, <span class="stringliteral">&quot;tags: tag:&quot;</span>&lt;&lt;in.<a class="code" href="structProofServEnv__t.html#af4140705c69b78b2c0fd55131a0844dd">fSessionTag</a>&lt;&lt;<span class="stringliteral">&quot; top:&quot;</span>&lt;&lt;in.<a class="code" href="structProofServEnv__t.html#a063361fdad238f075537682178fdd1b3">fTopSessionTag</a>&lt;&lt;<span class="stringliteral">&quot; xps:&quot;</span>&lt;&lt;xps-&gt;<a class="code" href="classXrdProofdProofServ.html#af69a1e44057cb2b6b32fba74244c6ba1">Tag</a>());</div><div class="line"><a name="l02206"></a><span class="lineno"> 2206</span>&#160;</div><div class="line"><a name="l02207"></a><span class="lineno"> 2207</span>&#160;   <span class="comment">// Notify the user</span></div><div class="line"><a name="l02208"></a><span class="lineno"> 2208</span>&#160;   <span class="keywordflow">if</span> (prc &lt;= 0) {</div><div class="line"><a name="l02209"></a><span class="lineno"> 2209</span>&#160;      <span class="comment">// Timed-out or failed: we are done; if timed-out finalize the notification message</span></div><div class="line"><a name="l02210"></a><span class="lineno"> 2210</span>&#160;      emsg = <span class="stringliteral">&quot;failure setting up proofserv&quot;</span> ;</div><div class="line"><a name="l02211"></a><span class="lineno"> 2211</span>&#160;      <span class="keywordflow">if</span> (prc == 0) emsg += <span class="stringliteral">&quot;: timed-out receiving status-of-setup from pipe&quot;</span>;</div><div class="line"><a name="l02212"></a><span class="lineno"> 2212</span>&#160;      <span class="comment">// Dump to the log file</span></div><div class="line"><a name="l02213"></a><span class="lineno"> 2213</span>&#160;      <a class="code" href="classXrdProofdAux.html#acfae2dfa1609be5e19ff91b5d0ee5699">XrdProofdAux::LogEmsgToFile</a>(in.<a class="code" href="structProofServEnv__t.html#a88002c75764b173de52afd5f9b3c6c74">fLogFile</a>.c_str(), emsg.c_str(), npfx.c_str());</div><div class="line"><a name="l02214"></a><span class="lineno"> 2214</span>&#160;      <span class="comment">// Recycle the session object</span></div><div class="line"><a name="l02215"></a><span class="lineno"> 2215</span>&#160;      xps-&gt;<a class="code" href="classXrdProofdProofServ.html#ac4953244f65634a9ee47299d408591d8">Reset</a>();</div><div class="line"><a name="l02216"></a><span class="lineno"> 2216</span>&#160;      <a class="code" href="classXrdProofdAux.html#a6b1d64972dcdae69de7af68d43fdd5be">XrdProofdAux::KillProcess</a>(pid, 1, p-&gt;<a class="code" href="classXrdProofdProtocol.html#a80024c8f848d0eabe9f13d09f06c8d9d">Client</a>()-&gt;<a class="code" href="classXrdProofdClient.html#a062a4396b4b8f0667f3a97a64c7f1c3d">UI</a>(), <a class="code" href="classXrdProofdProofServMgr.html#a86cac591a5646811e38ff6a2477f4da7">fMgr</a>-&gt;<a class="code" href="classXrdProofdManager.html#a15d2e414e67bfc0cc4304605a6b509ff">ChangeOwn</a>());</div><div class="line"><a name="l02217"></a><span class="lineno"> 2217</span>&#160;      <span class="comment">// Make sure that the log file path reaches the caller</span></div><div class="line"><a name="l02218"></a><span class="lineno"> 2218</span>&#160;      emsg += <span class="stringliteral">&quot;|log:&quot;</span>;</div><div class="line"><a name="l02219"></a><span class="lineno"> 2219</span>&#160;      emsg += in.<a class="code" href="structProofServEnv__t.html#a88002c75764b173de52afd5f9b3c6c74">fLogFile</a>;</div><div class="line"><a name="l02220"></a><span class="lineno"> 2220</span>&#160;      <a class="code" href="XrdProofdTrace_8h.html#a83f50a6ac1ca86524725ed11340e3b26">TRACEP</a>(p, XERR, emsg.c_str());</div><div class="line"><a name="l02221"></a><span class="lineno"> 2221</span>&#160;      emsg.insert(npfx, 0);</div><div class="line"><a name="l02222"></a><span class="lineno"> 2222</span>&#160;      response-&gt;Send(<a class="code" href="XProofProtocol_8h.html#a81dc1edcb19adb12975b44e65a3c88f4afccd8aacc7086f7ef815d546a9336fe9">kXP_ServerError</a>, emsg.c_str());</div><div class="line"><a name="l02223"></a><span class="lineno"> 2223</span>&#160;      <span class="keywordflow">return</span> 0;</div><div class="line"><a name="l02224"></a><span class="lineno"> 2224</span>&#160;</div><div class="line"><a name="l02225"></a><span class="lineno"> 2225</span>&#160;   } <span class="keywordflow">else</span> {</div><div class="line"><a name="l02226"></a><span class="lineno"> 2226</span>&#160;      <span class="comment">// Setup was successful</span></div><div class="line"><a name="l02227"></a><span class="lineno"> 2227</span>&#160;      XrdOucString info;</div><div class="line"><a name="l02228"></a><span class="lineno"> 2228</span>&#160;      <span class="comment">// The log file path (so we do it independently of a successful session startup)</span></div><div class="line"><a name="l02229"></a><span class="lineno"> 2229</span>&#160;      info += <span class="stringliteral">&quot;|log:&quot;</span>;</div><div class="line"><a name="l02230"></a><span class="lineno"> 2230</span>&#160;      info += xps-&gt;<a class="code" href="classXrdProofdProofServ.html#a3ffaac9d5a4472092b2a06ac05cebf13">Fileout</a>();</div><div class="line"><a name="l02231"></a><span class="lineno"> 2231</span>&#160;      <span class="comment">// Send it back</span></div><div class="line"><a name="l02232"></a><span class="lineno"> 2232</span>&#160;      response-&gt;SendI(psid, xps-&gt;<a class="code" href="classXrdProofdProofServ.html#a18e4a17f4e9ef07f923b654e2d000148">ROOT</a>()-&gt;<a class="code" href="classXrdROOT.html#a9c3ee0a503928edaab2675dd4d6638b0">SrvProtVers</a>(), (kXR_int16)<a class="code" href="XrdProofdProtocol_8h.html#a0e4fcddb4216e202dd3e6517d1683c9b">XPROOFD_VERSBIN</a>,</div><div class="line"><a name="l02233"></a><span class="lineno"> 2233</span>&#160;                            (<span class="keywordtype">void</span> *) info.c_str(), info.length());</div><div class="line"><a name="l02234"></a><span class="lineno"> 2234</span>&#160;   }</div><div class="line"><a name="l02235"></a><span class="lineno"> 2235</span>&#160;</div><div class="line"><a name="l02236"></a><span class="lineno"> 2236</span>&#160;   <span class="comment">// now we wait for the callback to be (successfully) established</span></div><div class="line"><a name="l02237"></a><span class="lineno"> 2237</span>&#160;   <a class="code" href="XrdProofdTrace_8h.html#a83f50a6ac1ca86524725ed11340e3b26">TRACEP</a>(p, FORK, <span class="stringliteral">&quot;server launched: wait for callback &quot;</span>);</div><div class="line"><a name="l02238"></a><span class="lineno"> 2238</span>&#160;</div><div class="line"><a name="l02239"></a><span class="lineno"> 2239</span>&#160;   <span class="comment">// Set ID</span></div><div class="line"><a name="l02240"></a><span class="lineno"> 2240</span>&#160;   xps-&gt;<a class="code" href="classXrdProofdProofServ.html#a62c5781d3826ef714ed130ebc0992bb5">SetSrvPID</a>(pid);</div><div class="line"><a name="l02241"></a><span class="lineno"> 2241</span>&#160;</div><div class="line"><a name="l02242"></a><span class="lineno"> 2242</span>&#160;   <span class="comment">// Wait for the call back</span></div><div class="line"><a name="l02243"></a><span class="lineno"> 2243</span>&#160;   <span class="keywordflow">if</span> (<a class="code" href="classXrdProofdProofServMgr.html#a2f69ab8ab20f64f0ce7521dcf6be2952">AcceptPeer</a>(xps, intwait, emsg) != 0) {</div><div class="line"><a name="l02244"></a><span class="lineno"> 2244</span>&#160;      emsg = <span class="stringliteral">&quot;problems accepting callback: &quot;</span>;</div><div class="line"><a name="l02245"></a><span class="lineno"> 2245</span>&#160;      <span class="comment">// Failure: kill the child process</span></div><div class="line"><a name="l02246"></a><span class="lineno"> 2246</span>&#160;      <span class="keywordflow">if</span> (<a class="code" href="classXrdProofdAux.html#a6b1d64972dcdae69de7af68d43fdd5be">XrdProofdAux::KillProcess</a>(pid, 0, p-&gt;<a class="code" href="classXrdProofdProtocol.html#a80024c8f848d0eabe9f13d09f06c8d9d">Client</a>()-&gt;<a class="code" href="classXrdProofdClient.html#a062a4396b4b8f0667f3a97a64c7f1c3d">UI</a>(), <a class="code" href="classXrdProofdProofServMgr.html#a86cac591a5646811e38ff6a2477f4da7">fMgr</a>-&gt;<a class="code" href="classXrdProofdManager.html#a15d2e414e67bfc0cc4304605a6b509ff">ChangeOwn</a>()) != 0)</div><div class="line"><a name="l02247"></a><span class="lineno"> 2247</span>&#160;         emsg += <span class="stringliteral">&quot;process could not be killed - pid: &quot;</span>;</div><div class="line"><a name="l02248"></a><span class="lineno"> 2248</span>&#160;      <span class="keywordflow">else</span></div><div class="line"><a name="l02249"></a><span class="lineno"> 2249</span>&#160;         emsg += <span class="stringliteral">&quot;process killed - pid: &quot;</span>;</div><div class="line"><a name="l02250"></a><span class="lineno"> 2250</span>&#160;      emsg += (int)pid;</div><div class="line"><a name="l02251"></a><span class="lineno"> 2251</span>&#160;      <span class="comment">// Dump to the log file</span></div><div class="line"><a name="l02252"></a><span class="lineno"> 2252</span>&#160;      <a class="code" href="classXrdProofdAux.html#acfae2dfa1609be5e19ff91b5d0ee5699">XrdProofdAux::LogEmsgToFile</a>(in.<a class="code" href="structProofServEnv__t.html#a88002c75764b173de52afd5f9b3c6c74">fLogFile</a>.c_str(), emsg.c_str(), npfx.c_str());</div><div class="line"><a name="l02253"></a><span class="lineno"> 2253</span>&#160;      <span class="comment">// Reset the instance</span></div><div class="line"><a name="l02254"></a><span class="lineno"> 2254</span>&#160;      xps-&gt;<a class="code" href="classXrdProofdProofServ.html#ac4953244f65634a9ee47299d408591d8">Reset</a>();</div><div class="line"><a name="l02255"></a><span class="lineno"> 2255</span>&#160;      <span class="comment">// Notify</span></div><div class="line"><a name="l02256"></a><span class="lineno"> 2256</span>&#160;      <a class="code" href="XrdProofdTrace_8h.html#a83f50a6ac1ca86524725ed11340e3b26">TRACEP</a>(p, XERR, emsg.c_str());</div><div class="line"><a name="l02257"></a><span class="lineno"> 2257</span>&#160;      emsg.insert(npfx, 0);</div><div class="line"><a name="l02258"></a><span class="lineno"> 2258</span>&#160;      response-&gt;Send(kXR_attn, <a class="code" href="XProofProtocol_8h.html#af90b47a2dd37c58ac6f67e16c279e27baeac09efa4ebf488eb470242130c87f9f">kXPD_errmsg</a>, (<span class="keywordtype">char</span> *) emsg.c_str(), emsg.length());</div><div class="line"><a name="l02259"></a><span class="lineno"> 2259</span>&#160;      <span class="keywordflow">return</span> 0;</div><div class="line"><a name="l02260"></a><span class="lineno"> 2260</span>&#160;   }</div><div class="line"><a name="l02261"></a><span class="lineno"> 2261</span>&#160;   <span class="comment">// Set the group, if any</span></div><div class="line"><a name="l02262"></a><span class="lineno"> 2262</span>&#160;   xps-&gt;<a class="code" href="classXrdProofdProofServ.html#a26dbf31e4a3ab5dc7751b6773c45a5d7">SetGroup</a>(p-&gt;<a class="code" href="classXrdProofdProtocol.html#a80024c8f848d0eabe9f13d09f06c8d9d">Client</a>()-&gt;<a class="code" href="classXrdProofdClient.html#af82bc301c99dc688038ba2c771b5c49e">Group</a>());</div><div class="line"><a name="l02263"></a><span class="lineno"> 2263</span>&#160;</div><div class="line"><a name="l02264"></a><span class="lineno"> 2264</span>&#160;   <span class="comment">// Change child process priority, if required</span></div><div class="line"><a name="l02265"></a><span class="lineno"> 2265</span>&#160;   <span class="keywordtype">int</span> dp = 0;</div><div class="line"><a name="l02266"></a><span class="lineno"> 2266</span>&#160;   <span class="keywordflow">if</span> (<a class="code" href="classXrdProofdProofServMgr.html#a86cac591a5646811e38ff6a2477f4da7">fMgr</a>-&gt;<a class="code" href="classXrdProofdManager.html#a0b386ac846971e48a857fb3c8332fd0d">PriorityMgr</a>()-&gt;<a class="code" href="classXrdProofdPriorityMgr.html#a338dd700d8b1ce5d1cceb56e5b81ea43">SetProcessPriority</a>(xps-&gt;<a class="code" href="classXrdProofdProofServ.html#a82ce7d276f54e6b4bb25430b738f7767">SrvPID</a>(),</div><div class="line"><a name="l02267"></a><span class="lineno"> 2267</span>&#160;                                                        p-&gt;<a class="code" href="classXrdProofdProtocol.html#a80024c8f848d0eabe9f13d09f06c8d9d">Client</a>()-&gt;<a class="code" href="classXrdProofdClient.html#a3cbe604999cdb44ae9d0ec833ffa5900">User</a>(), dp) != 0) {</div><div class="line"><a name="l02268"></a><span class="lineno"> 2268</span>&#160;      <a class="code" href="XrdProofdTrace_8h.html#a83f50a6ac1ca86524725ed11340e3b26">TRACEP</a>(p, XERR, <span class="stringliteral">&quot;problems changing child process priority&quot;</span>);</div><div class="line"><a name="l02269"></a><span class="lineno"> 2269</span>&#160;   } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (dp &gt; 0) {</div><div class="line"><a name="l02270"></a><span class="lineno"> 2270</span>&#160;      <a class="code" href="XrdProofdTrace_8h.html#a83f50a6ac1ca86524725ed11340e3b26">TRACEP</a>(p, DBG, <span class="stringliteral">&quot;priority of the child process changed by &quot;</span> &lt;&lt; dp &lt;&lt; <span class="stringliteral">&quot; units&quot;</span>);</div><div class="line"><a name="l02271"></a><span class="lineno"> 2271</span>&#160;   }</div><div class="line"><a name="l02272"></a><span class="lineno"> 2272</span>&#160;</div><div class="line"><a name="l02273"></a><span class="lineno"> 2273</span>&#160;   <a class="code" href="classXrdClientID.html">XrdClientID</a> *cid = xps-&gt;<a class="code" href="classXrdProofdProofServ.html#afa65a2a39d7a18b03045d4c8ce664f21">Parent</a>();</div><div class="line"><a name="l02274"></a><span class="lineno"> 2274</span>&#160;   <a class="code" href="XrdProofdTrace_8h.html#a83f50a6ac1ca86524725ed11340e3b26">TRACEP</a>(p, FORK, <span class="stringliteral">&quot;xps: &quot;</span>&lt;&lt;xps&lt;&lt;<span class="stringliteral">&quot;, ClientID: &quot;</span>&lt;&lt;(<span class="keywordtype">int</span> *)cid&lt;&lt;<span class="stringliteral">&quot; (sid: &quot;</span>&lt;&lt;sid&lt;&lt;<span class="stringliteral">&quot;)&quot;</span>&lt;&lt;<span class="stringliteral">&quot; NClients: &quot;</span>&lt;&lt;xps-&gt;<a class="code" href="classXrdProofdProofServ.html#ac2996eb131d395518b59196e073fb83c">GetNClients</a>(1));</div><div class="line"><a name="l02275"></a><span class="lineno"> 2275</span>&#160;</div><div class="line"><a name="l02276"></a><span class="lineno"> 2276</span>&#160;   <span class="comment">// Record this session in the client sandbox</span></div><div class="line"><a name="l02277"></a><span class="lineno"> 2277</span>&#160;   <span class="keywordflow">if</span> (p-&gt;<a class="code" href="classXrdProofdProtocol.html#a80024c8f848d0eabe9f13d09f06c8d9d">Client</a>()-&gt;<a class="code" href="classXrdProofdClient.html#a8ea0bbb76949d36f85b223cab59db0d7">Sandbox</a>()-&gt;<a class="code" href="classXrdProofdSandbox.html#a98c8db62cad2ca475c2379777cf3a9c7">AddSession</a>(xps-&gt;<a class="code" href="classXrdProofdProofServ.html#af69a1e44057cb2b6b32fba74244c6ba1">Tag</a>()) == -1)</div><div class="line"><a name="l02278"></a><span class="lineno"> 2278</span>&#160;      <a class="code" href="XrdProofdTrace_8h.html#a83f50a6ac1ca86524725ed11340e3b26">TRACEP</a>(p, REQ, <span class="stringliteral">&quot;problems recording session in sandbox&quot;</span>);</div><div class="line"><a name="l02279"></a><span class="lineno"> 2279</span>&#160;</div><div class="line"><a name="l02280"></a><span class="lineno"> 2280</span>&#160;   <span class="comment">// Success; avoid that the global counter is decreased</span></div><div class="line"><a name="l02281"></a><span class="lineno"> 2281</span>&#160;   mcGuard.<a class="code" href="classXpdSrvMgrCreateGuard.html#a2f078a3888963c8a20d1529b437d07e9">Set</a>(0);</div><div class="line"><a name="l02282"></a><span class="lineno"> 2282</span>&#160;</div><div class="line"><a name="l02283"></a><span class="lineno"> 2283</span>&#160;   <span class="comment">// Update the global session handlers</span></div><div class="line"><a name="l02284"></a><span class="lineno"> 2284</span>&#160;   XrdOucString key; key += pid;</div><div class="line"><a name="l02285"></a><span class="lineno"> 2285</span>&#160;   {  <a class="code" href="XrdSysToOuc_8h.html#a4ba18bedbb8a1a4367d57f49a4d773ce">XrdSysMutexHelper</a> mh(<a class="code" href="classXrdProofdProofServMgr.html#ab90491b1fb65834e75bd46f6e09db87f">fMutex</a>);</div><div class="line"><a name="l02286"></a><span class="lineno"> 2286</span>&#160;      <a class="code" href="classXrdProofdProofServMgr.html#a4a8be4f347170c279824168597e16caa">fSessions</a>.Add(key.c_str(), xps, 0, Hash_keepdata);</div><div class="line"><a name="l02287"></a><span class="lineno"> 2287</span>&#160;      <a class="code" href="classXrdProofdProofServMgr.html#a909fb1d3452ad38d9cc83782f777d07c">fActiveSessions</a>.push_back(xps);</div><div class="line"><a name="l02288"></a><span class="lineno"> 2288</span>&#160;   }</div><div class="line"><a name="l02289"></a><span class="lineno"> 2289</span>&#160;   <a class="code" href="classXrdProofdProofServMgr.html#a9eb9a2df9609e14f677437aa115718a3">AddSession</a>(p, xps);</div><div class="line"><a name="l02290"></a><span class="lineno"> 2290</span>&#160;</div><div class="line"><a name="l02291"></a><span class="lineno"> 2291</span>&#160;   <span class="comment">// Check session validity</span></div><div class="line"><a name="l02292"></a><span class="lineno"> 2292</span>&#160;   <span class="keywordflow">if</span> (!xps-&gt;<a class="code" href="classXrdProofdProofServ.html#af67067c8b8f82303367b9307350c6e59">IsValid</a>()) {</div><div class="line"><a name="l02293"></a><span class="lineno"> 2293</span>&#160;      <span class="comment">// Notify</span></div><div class="line"><a name="l02294"></a><span class="lineno"> 2294</span>&#160;      <a class="code" href="XrdProofdTrace_8h.html#a83f50a6ac1ca86524725ed11340e3b26">TRACEP</a>(p, XERR, <span class="stringliteral">&quot;PROOF session is invalid: protocol error? &quot;</span> &lt;&lt;emsg);</div><div class="line"><a name="l02295"></a><span class="lineno"> 2295</span>&#160;   }</div><div class="line"><a name="l02296"></a><span class="lineno"> 2296</span>&#160;</div><div class="line"><a name="l02297"></a><span class="lineno"> 2297</span>&#160;   <span class="comment">// Over</span></div><div class="line"><a name="l02298"></a><span class="lineno"> 2298</span>&#160;   <span class="keywordflow">return</span> 0;</div><div class="line"><a name="l02299"></a><span class="lineno"> 2299</span>&#160;}<span class="comment"></span></div><div class="line"><a name="l02300"></a><span class="lineno"> 2300</span>&#160;<span class="comment">////////////////////////////////////////////////////////////////////////////////</span></div><div class="line"><a name="l02301"></a><span class="lineno"> 2301</span>&#160;<span class="comment">/// Create the admin path for the starting session</span></div><div class="line"><a name="l02302"></a><span class="lineno"> 2302</span>&#160;<span class="comment">/// Return 0 on success, -1 on error (error message in &#39;emsg&#39;)</span></div><div class="line"><a name="l02303"></a><span class="lineno"> 2303</span>&#160;<span class="comment"></span></div><div class="line"><a name="l02304"></a><span class="lineno"><a class="line" href="classXrdProofdProofServMgr.html#a816c7b460a1e393d9f5156af09169940"> 2304</a></span>&#160;<span class="keywordtype">int</span> <a class="code" href="classXrdProofdProofServMgr.html#a816c7b460a1e393d9f5156af09169940">XrdProofdProofServMgr::CreateAdminPath</a>(<a class="code" href="classXrdProofdProofServ.html">XrdProofdProofServ</a> *xps,</div><div class="line"><a name="l02305"></a><span class="lineno"> 2305</span>&#160;                                           <a class="code" href="classXrdProofdProtocol.html">XrdProofdProtocol</a> *p, <span class="keywordtype">int</span> pid,</div><div class="line"><a name="l02306"></a><span class="lineno"> 2306</span>&#160;                                           XrdOucString &amp;emsg)</div><div class="line"><a name="l02307"></a><span class="lineno"> 2307</span>&#160;{</div><div class="line"><a name="l02308"></a><span class="lineno"> 2308</span>&#160;   XrdOucString path;</div><div class="line"><a name="l02309"></a><span class="lineno"> 2309</span>&#160;   <span class="keywordtype">bool</span> assert = (pid &gt; 0) ? 1 : 0;</div><div class="line"><a name="l02310"></a><span class="lineno"> 2310</span>&#160;   <a class="code" href="XrdProofdAux_8h.html#a631cc8787af1a02d9e51c86117ae042e">XPDFORM</a>(path, <span class="stringliteral">&quot;%s/%s.%s.&quot;</span>, <a class="code" href="classXrdProofdProofServMgr.html#aa7d4e4ec33be14cd70bbc3595332736e">fActiAdminPath</a>.c_str(),</div><div class="line"><a name="l02311"></a><span class="lineno"> 2311</span>&#160;                              p-&gt;<a class="code" href="classXrdProofdProtocol.html#a80024c8f848d0eabe9f13d09f06c8d9d">Client</a>()-&gt;<a class="code" href="classXrdProofdClient.html#a3cbe604999cdb44ae9d0ec833ffa5900">User</a>(), p-&gt;<a class="code" href="classXrdProofdProtocol.html#a80024c8f848d0eabe9f13d09f06c8d9d">Client</a>()-&gt;<a class="code" href="classXrdProofdClient.html#af82bc301c99dc688038ba2c771b5c49e">Group</a>());</div><div class="line"><a name="l02312"></a><span class="lineno"> 2312</span>&#160;   <span class="keywordflow">if</span> (pid &gt; 0) path += pid;</div><div class="line"><a name="l02313"></a><span class="lineno"> 2313</span>&#160;   <span class="keywordflow">if</span> (xps-&gt;<a class="code" href="classXrdProofdProofServ.html#aa4580fce80e7fb2795eaa29a262cb309">SetAdminPath</a>(path.c_str(), assert, <a class="code" href="classXrdProofdProofServMgr.html#a86cac591a5646811e38ff6a2477f4da7">fMgr</a>-&gt;<a class="code" href="classXrdProofdManager.html#a15d2e414e67bfc0cc4304605a6b509ff">ChangeOwn</a>()) != 0) {</div><div class="line"><a name="l02314"></a><span class="lineno"> 2314</span>&#160;      <a class="code" href="XrdProofdAux_8h.html#a631cc8787af1a02d9e51c86117ae042e">XPDFORM</a>(emsg, <span class="stringliteral">&quot;failure setting admin path &#39;%s&#39;&quot;</span>, path.c_str());</div><div class="line"><a name="l02315"></a><span class="lineno"> 2315</span>&#160;      <span class="keywordflow">return</span> -1;</div><div class="line"><a name="l02316"></a><span class="lineno"> 2316</span>&#160;   }</div><div class="line"><a name="l02317"></a><span class="lineno"> 2317</span>&#160;   <span class="comment">// Done</span></div><div class="line"><a name="l02318"></a><span class="lineno"> 2318</span>&#160;   <span class="keywordflow">return</span> 0;</div><div class="line"><a name="l02319"></a><span class="lineno"> 2319</span>&#160;}</div><div class="line"><a name="l02320"></a><span class="lineno"> 2320</span>&#160;<span class="comment"></span></div><div class="line"><a name="l02321"></a><span class="lineno"> 2321</span>&#160;<span class="comment">////////////////////////////////////////////////////////////////////////////////</span></div><div class="line"><a name="l02322"></a><span class="lineno"> 2322</span>&#160;<span class="comment">/// Create the socket path for the starting session</span></div><div class="line"><a name="l02323"></a><span class="lineno"> 2323</span>&#160;<span class="comment">/// Return 0 on success, -1 on error (error message in &#39;emsg&#39;)</span></div><div class="line"><a name="l02324"></a><span class="lineno"> 2324</span>&#160;<span class="comment"></span></div><div class="line"><a name="l02325"></a><span class="lineno"><a class="line" href="classXrdProofdProofServMgr.html#a534ed8fb5f4032780795115c371945c8"> 2325</a></span>&#160;<span class="keywordtype">int</span> <a class="code" href="classXrdProofdProofServMgr.html#a534ed8fb5f4032780795115c371945c8">XrdProofdProofServMgr::CreateSockPath</a>(<a class="code" href="classXrdProofdProofServ.html">XrdProofdProofServ</a> *xps,</div><div class="line"><a name="l02326"></a><span class="lineno"> 2326</span>&#160;                                          <a class="code" href="classXrdProofdProtocol.html">XrdProofdProtocol</a> *p,</div><div class="line"><a name="l02327"></a><span class="lineno"> 2327</span>&#160;                                          <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> seq, XrdOucString &amp;emsg)</div><div class="line"><a name="l02328"></a><span class="lineno"> 2328</span>&#160;{</div><div class="line"><a name="l02329"></a><span class="lineno"> 2329</span>&#160;   <a class="code" href="XrdProofdTrace_8h.html#a7c31822912a8d0dc9bfd544097b29e12">XPDLOC</a>(SMGR, <span class="stringliteral">&quot;ProofServMgr::CreateSockPath&quot;</span>)</div><div class="line"><a name="l02330"></a><span class="lineno"> 2330</span>&#160;</div><div class="line"><a name="l02331"></a><span class="lineno"> 2331</span>&#160;   XrdOucString sockpath;</div><div class="line"><a name="l02332"></a><span class="lineno"> 2332</span>&#160;   <span class="comment">// Sock path under dedicated directory to avoid problems related to its length</span></div><div class="line"><a name="l02333"></a><span class="lineno"> 2333</span>&#160;   <a class="code" href="XrdProofdAux_8h.html#a631cc8787af1a02d9e51c86117ae042e">XPDFORM</a>(sockpath, <span class="stringliteral">&quot;%s/xpd.%d.%d.%u&quot;</span>, <a class="code" href="classXrdProofdProofServMgr.html#a86cac591a5646811e38ff6a2477f4da7">fMgr</a>-&gt;<a class="code" href="classXrdProofdManager.html#ae3b470855b0b39e2adaa8ae303e5b402">SockPathDir</a>(), <a class="code" href="classXrdProofdProofServMgr.html#a86cac591a5646811e38ff6a2477f4da7">fMgr</a>-&gt;<a class="code" href="classXrdProofdManager.html#a128a9af44f04fdbf956b893c7a16d45b">Port</a>(), getpid(), seq);</div><div class="line"><a name="l02334"></a><span class="lineno"> 2334</span>&#160;   <a class="code" href="XrdProofdTrace_8h.html#a83f50a6ac1ca86524725ed11340e3b26">TRACEP</a>(p, ALL, <span class="stringliteral">&quot;socket path: &quot;</span> &lt;&lt; sockpath);</div><div class="line"><a name="l02335"></a><span class="lineno"> 2335</span>&#160;   <span class="keyword">struct </span>sockaddr_un unserver;</div><div class="line"><a name="l02336"></a><span class="lineno"> 2336</span>&#160;   <span class="keywordflow">if</span> (sockpath.length() &gt; (int)(<span class="keyword">sizeof</span>(unserver.sun_path) - 1)) {</div><div class="line"><a name="l02337"></a><span class="lineno"> 2337</span>&#160;      <a class="code" href="XrdProofdAux_8h.html#a631cc8787af1a02d9e51c86117ae042e">XPDFORM</a>(emsg, <span class="stringliteral">&quot;socket path very long (%d): this may lead to stack corruption! &quot;</span>, sockpath.length());</div><div class="line"><a name="l02338"></a><span class="lineno"> 2338</span>&#160;      <span class="keywordflow">return</span> -1;</div><div class="line"><a name="l02339"></a><span class="lineno"> 2339</span>&#160;   }</div><div class="line"><a name="l02340"></a><span class="lineno"> 2340</span>&#160;   <span class="comment">// Now create the UNIX sock path and set its permissions</span></div><div class="line"><a name="l02341"></a><span class="lineno"> 2341</span>&#160;   xps-&gt;<a class="code" href="classXrdProofdProofServ.html#ac4a8e8c6ff235136af0486340aced428">SetUNIXSockPath</a>(sockpath.c_str());</div><div class="line"><a name="l02342"></a><span class="lineno"> 2342</span>&#160;   <span class="keywordflow">if</span> (xps-&gt;<a class="code" href="classXrdProofdProofServ.html#a7ef7d888b3308f42fd4a90558851e55d">CreateUNIXSock</a>(<a class="code" href="classXrdProofdConfig.html#a604213f0bcb2d2a3494610fedda8e975">fEDest</a>) != 0) {</div><div class="line"><a name="l02343"></a><span class="lineno"> 2343</span>&#160;      <span class="comment">// Failure</span></div><div class="line"><a name="l02344"></a><span class="lineno"> 2344</span>&#160;      <a class="code" href="XrdProofdAux_8h.html#a631cc8787af1a02d9e51c86117ae042e">XPDFORM</a>(emsg, <span class="stringliteral">&quot;failure creating UNIX socket on &#39;%s&#39;&quot;</span>, sockpath.c_str());</div><div class="line"><a name="l02345"></a><span class="lineno"> 2345</span>&#160;      <span class="keywordflow">return</span> -1;</div><div class="line"><a name="l02346"></a><span class="lineno"> 2346</span>&#160;   }</div><div class="line"><a name="l02347"></a><span class="lineno"> 2347</span>&#160;   <span class="keywordflow">if</span> (chmod(sockpath.c_str(), 0755) != 0) {</div><div class="line"><a name="l02348"></a><span class="lineno"> 2348</span>&#160;      <a class="code" href="XrdProofdAux_8h.html#a631cc8787af1a02d9e51c86117ae042e">XPDFORM</a>(emsg, <span class="stringliteral">&quot;failure changing permissions of the UNIX socket on &#39;%s&#39;; errno: %d&quot;</span>,</div><div class="line"><a name="l02349"></a><span class="lineno"> 2349</span>&#160;                    sockpath.c_str(), (int)errno);</div><div class="line"><a name="l02350"></a><span class="lineno"> 2350</span>&#160;      <span class="keywordflow">return</span> -1;</div><div class="line"><a name="l02351"></a><span class="lineno"> 2351</span>&#160;   }</div><div class="line"><a name="l02352"></a><span class="lineno"> 2352</span>&#160;</div><div class="line"><a name="l02353"></a><span class="lineno"> 2353</span>&#160;   <span class="comment">// Done</span></div><div class="line"><a name="l02354"></a><span class="lineno"> 2354</span>&#160;   <span class="keywordflow">return</span> 0;</div><div class="line"><a name="l02355"></a><span class="lineno"> 2355</span>&#160;}</div><div class="line"><a name="l02356"></a><span class="lineno"> 2356</span>&#160;<span class="comment"></span></div><div class="line"><a name="l02357"></a><span class="lineno"> 2357</span>&#160;<span class="comment">////////////////////////////////////////////////////////////////////////////////</span></div><div class="line"><a name="l02358"></a><span class="lineno"> 2358</span>&#160;<span class="comment">/// Send content of errlog upstream asynchronously</span></div><div class="line"><a name="l02359"></a><span class="lineno"> 2359</span>&#160;<span class="comment"></span></div><div class="line"><a name="l02360"></a><span class="lineno"><a class="line" href="classXrdProofdProofServMgr.html#ad4f70c3d45559272f158ab861a1db498"> 2360</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="classXrdProofdProofServMgr.html#ad4f70c3d45559272f158ab861a1db498">XrdProofdProofServMgr::SendErrLog</a>(<span class="keyword">const</span> <span class="keywordtype">char</span> *errlog, <a class="code" href="classXrdProofdResponse.html">XrdProofdResponse</a> *<a class="code" href="Object_8C.html#ac15f01b9c6407e1312dfc196ad4e0870">r</a>)</div><div class="line"><a name="l02361"></a><span class="lineno"> 2361</span>&#160;{</div><div class="line"><a name="l02362"></a><span class="lineno"> 2362</span>&#160;   <a class="code" href="XrdProofdTrace_8h.html#a7c31822912a8d0dc9bfd544097b29e12">XPDLOC</a>(SMGR, <span class="stringliteral">&quot;ProofServMgr::SendErrLog&quot;</span>)</div><div class="line"><a name="l02363"></a><span class="lineno"> 2363</span>&#160;</div><div class="line"><a name="l02364"></a><span class="lineno"> 2364</span>&#160;   XrdOucString emsg(<span class="stringliteral">&quot;An error occured: the content of errlog follows:&quot;</span>);</div><div class="line"><a name="l02365"></a><span class="lineno"> 2365</span>&#160;   <a class="code" href="Object_8C.html#ac15f01b9c6407e1312dfc196ad4e0870">r</a>-&gt;Send(kXR_attn, <a class="code" href="XProofProtocol_8h.html#af90b47a2dd37c58ac6f67e16c279e27bafd3f389e5b30b994109c42a3c43d3c0c">kXPD_srvmsg</a>, (<span class="keywordtype">char</span> *) emsg.c_str(), emsg.length());</div><div class="line"><a name="l02366"></a><span class="lineno"> 2366</span>&#160;   emsg = <span class="stringliteral">&quot;------------------------------------------------\n&quot;</span>;</div><div class="line"><a name="l02367"></a><span class="lineno"> 2367</span>&#160;   <a class="code" href="Object_8C.html#ac15f01b9c6407e1312dfc196ad4e0870">r</a>-&gt;Send(kXR_attn, <a class="code" href="XProofProtocol_8h.html#af90b47a2dd37c58ac6f67e16c279e27bafd3f389e5b30b994109c42a3c43d3c0c">kXPD_srvmsg</a>, 2, (<span class="keywordtype">char</span> *) emsg.c_str(), emsg.length());</div><div class="line"><a name="l02368"></a><span class="lineno"> 2368</span>&#160;</div><div class="line"><a name="l02369"></a><span class="lineno"> 2369</span>&#160;   <span class="keywordtype">int</span> ierr = <a class="code" href="namespaceROOT_1_1Math_1_1detail.html#af7bd9296f106e2e1402e539ca33bdf94a37cfce0c407fb91bb0b1d71b586841a3">open</a>(errlog, O_RDONLY);</div><div class="line"><a name="l02370"></a><span class="lineno"> 2370</span>&#160;   <span class="keywordflow">if</span> (ierr &lt; 0) {</div><div class="line"><a name="l02371"></a><span class="lineno"> 2371</span>&#160;      <a class="code" href="XrdProofdAux_8h.html#a631cc8787af1a02d9e51c86117ae042e">XPDFORM</a>(emsg, <span class="stringliteral">&quot;cannot open &#39;%s&#39; (errno: %d)&quot;</span>, errlog, errno);</div><div class="line"><a name="l02372"></a><span class="lineno"> 2372</span>&#160;      <a class="code" href="Object_8C.html#ac15f01b9c6407e1312dfc196ad4e0870">r</a>-&gt;Send(kXR_attn, <a class="code" href="XProofProtocol_8h.html#af90b47a2dd37c58ac6f67e16c279e27bafd3f389e5b30b994109c42a3c43d3c0c">kXPD_srvmsg</a>, 2, (<span class="keywordtype">char</span> *) emsg.c_str(), emsg.length());</div><div class="line"><a name="l02373"></a><span class="lineno"> 2373</span>&#160;      <span class="keywordflow">return</span>;</div><div class="line"><a name="l02374"></a><span class="lineno"> 2374</span>&#160;   }</div><div class="line"><a name="l02375"></a><span class="lineno"> 2375</span>&#160;   <span class="keyword">struct </span>stat st;</div><div class="line"><a name="l02376"></a><span class="lineno"> 2376</span>&#160;   <span class="keywordflow">if</span> (fstat(ierr, &amp;st) != 0) {</div><div class="line"><a name="l02377"></a><span class="lineno"> 2377</span>&#160;      <a class="code" href="XrdProofdAux_8h.html#a631cc8787af1a02d9e51c86117ae042e">XPDFORM</a>(emsg, <span class="stringliteral">&quot;cannot stat &#39;%s&#39; (errno: %d)&quot;</span>, errlog, errno);</div><div class="line"><a name="l02378"></a><span class="lineno"> 2378</span>&#160;      <a class="code" href="Object_8C.html#ac15f01b9c6407e1312dfc196ad4e0870">r</a>-&gt;Send(kXR_attn, <a class="code" href="XProofProtocol_8h.html#af90b47a2dd37c58ac6f67e16c279e27bafd3f389e5b30b994109c42a3c43d3c0c">kXPD_srvmsg</a>, 2, (<span class="keywordtype">char</span> *) emsg.c_str(), emsg.length());</div><div class="line"><a name="l02379"></a><span class="lineno"> 2379</span>&#160;      <a class="code" href="namespaceROOT_1_1Math_1_1detail.html#af7bd9296f106e2e1402e539ca33bdf94ab53b0352d838d5792986f47b2c72b787">close</a> (ierr);</div><div class="line"><a name="l02380"></a><span class="lineno"> 2380</span>&#160;      <span class="keywordflow">return</span>;</div><div class="line"><a name="l02381"></a><span class="lineno"> 2381</span>&#160;   }</div><div class="line"><a name="l02382"></a><span class="lineno"> 2382</span>&#160;   off_t len = st.st_size;</div><div class="line"><a name="l02383"></a><span class="lineno"> 2383</span>&#160;   <a class="code" href="TGHtml_8h.html#ad5bb4a3d12fd54f29da2b924b29e652b">TRACE</a>(ALL, <span class="stringliteral">&quot; reading &quot;</span>&lt;&lt;len&lt;&lt;<span class="stringliteral">&quot; bytes from &quot;</span>&lt;&lt;errlog);</div><div class="line"><a name="l02384"></a><span class="lineno"> 2384</span>&#160;   ssize_t chunk = 2048, nb, nr;</div><div class="line"><a name="l02385"></a><span class="lineno"> 2385</span>&#160;   <span class="keywordtype">char</span> buf[2048];</div><div class="line"><a name="l02386"></a><span class="lineno"> 2386</span>&#160;   ssize_t left = len;</div><div class="line"><a name="l02387"></a><span class="lineno"> 2387</span>&#160;   <span class="keywordflow">while</span> (left &gt; 0) {</div><div class="line"><a name="l02388"></a><span class="lineno"> 2388</span>&#160;      nb = (left &gt; chunk) ? chunk : left;</div><div class="line"><a name="l02389"></a><span class="lineno"> 2389</span>&#160;      <span class="keywordflow">if</span> ((nr = read(ierr, buf, nb)) &lt; 0) {</div><div class="line"><a name="l02390"></a><span class="lineno"> 2390</span>&#160;         <a class="code" href="XrdProofdAux_8h.html#a631cc8787af1a02d9e51c86117ae042e">XPDFORM</a>(emsg, <span class="stringliteral">&quot;problems reading from &#39;%s&#39; (errno: %d)&quot;</span>, errlog, errno);</div><div class="line"><a name="l02391"></a><span class="lineno"> 2391</span>&#160;         <a class="code" href="Object_8C.html#ac15f01b9c6407e1312dfc196ad4e0870">r</a>-&gt;Send(kXR_attn, <a class="code" href="XProofProtocol_8h.html#af90b47a2dd37c58ac6f67e16c279e27bafd3f389e5b30b994109c42a3c43d3c0c">kXPD_srvmsg</a>, 2, (<span class="keywordtype">char</span> *) emsg.c_str(), emsg.length());</div><div class="line"><a name="l02392"></a><span class="lineno"> 2392</span>&#160;         <a class="code" href="namespaceROOT_1_1Math_1_1detail.html#af7bd9296f106e2e1402e539ca33bdf94ab53b0352d838d5792986f47b2c72b787">close</a>(ierr);</div><div class="line"><a name="l02393"></a><span class="lineno"> 2393</span>&#160;         <span class="keywordflow">return</span>;</div><div class="line"><a name="l02394"></a><span class="lineno"> 2394</span>&#160;      }</div><div class="line"><a name="l02395"></a><span class="lineno"> 2395</span>&#160;      <a class="code" href="TGHtml_8h.html#ad5bb4a3d12fd54f29da2b924b29e652b">TRACE</a>(ALL, buf);</div><div class="line"><a name="l02396"></a><span class="lineno"> 2396</span>&#160;      <a class="code" href="Object_8C.html#ac15f01b9c6407e1312dfc196ad4e0870">r</a>-&gt;Send(kXR_attn, <a class="code" href="XProofProtocol_8h.html#af90b47a2dd37c58ac6f67e16c279e27bafd3f389e5b30b994109c42a3c43d3c0c">kXPD_srvmsg</a>, 2, buf, nr);</div><div class="line"><a name="l02397"></a><span class="lineno"> 2397</span>&#160;      left -= nr;</div><div class="line"><a name="l02398"></a><span class="lineno"> 2398</span>&#160;   }</div><div class="line"><a name="l02399"></a><span class="lineno"> 2399</span>&#160;   <a class="code" href="namespaceROOT_1_1Math_1_1detail.html#af7bd9296f106e2e1402e539ca33bdf94ab53b0352d838d5792986f47b2c72b787">close</a>(ierr);</div><div class="line"><a name="l02400"></a><span class="lineno"> 2400</span>&#160;   emsg = <span class="stringliteral">&quot;------------------------------------------------&quot;</span>;</div><div class="line"><a name="l02401"></a><span class="lineno"> 2401</span>&#160;   <a class="code" href="Object_8C.html#ac15f01b9c6407e1312dfc196ad4e0870">r</a>-&gt;Send(kXR_attn, <a class="code" href="XProofProtocol_8h.html#af90b47a2dd37c58ac6f67e16c279e27bafd3f389e5b30b994109c42a3c43d3c0c">kXPD_srvmsg</a>, 2, (<span class="keywordtype">char</span> *) emsg.c_str(), emsg.length());</div><div class="line"><a name="l02402"></a><span class="lineno"> 2402</span>&#160;</div><div class="line"><a name="l02403"></a><span class="lineno"> 2403</span>&#160;   <span class="comment">// Done</span></div><div class="line"><a name="l02404"></a><span class="lineno"> 2404</span>&#160;   <span class="keywordflow">return</span>;</div><div class="line"><a name="l02405"></a><span class="lineno"> 2405</span>&#160;}</div><div class="line"><a name="l02406"></a><span class="lineno"> 2406</span>&#160;<span class="comment"></span></div><div class="line"><a name="l02407"></a><span class="lineno"> 2407</span>&#160;<span class="comment">////////////////////////////////////////////////////////////////////////////////</span></div><div class="line"><a name="l02408"></a><span class="lineno"> 2408</span>&#160;<span class="comment">/// Handle a request to recover a session after stop&amp;restart</span></div><div class="line"><a name="l02409"></a><span class="lineno"> 2409</span>&#160;<span class="comment"></span></div><div class="line"><a name="l02410"></a><span class="lineno"><a class="line" href="classXrdProofdProofServMgr.html#af983b32d34ecd820a44c78cf1fa57a8a"> 2410</a></span>&#160;<span class="keywordtype">int</span> <a class="code" href="classXrdProofdProofServMgr.html#af983b32d34ecd820a44c78cf1fa57a8a">XrdProofdProofServMgr::ResolveSession</a>(<span class="keyword">const</span> <span class="keywordtype">char</span> *fpid)</div><div class="line"><a name="l02411"></a><span class="lineno"> 2411</span>&#160;{</div><div class="line"><a name="l02412"></a><span class="lineno"> 2412</span>&#160;   <a class="code" href="XrdProofdTrace_8h.html#a7c31822912a8d0dc9bfd544097b29e12">XPDLOC</a>(SMGR, <span class="stringliteral">&quot;ProofServMgr::ResolveSession&quot;</span>)</div><div class="line"><a name="l02413"></a><span class="lineno"> 2413</span>&#160;</div><div class="line"><a name="l02414"></a><span class="lineno"> 2414</span>&#160;   <a class="code" href="TGHtml_8h.html#ad5bb4a3d12fd54f29da2b924b29e652b">TRACE</a>(REQ,  <span class="stringliteral">&quot;resolving &quot;</span>&lt;&lt; (fpid ? fpid : <span class="stringliteral">&quot;&lt;nul&gt;&quot;</span>)&lt;&lt;<span class="stringliteral">&quot; ...&quot;</span>);</div><div class="line"><a name="l02415"></a><span class="lineno"> 2415</span>&#160;</div><div class="line"><a name="l02416"></a><span class="lineno"> 2416</span>&#160;   <span class="comment">// Check inputs</span></div><div class="line"><a name="l02417"></a><span class="lineno"> 2417</span>&#160;   <span class="keywordflow">if</span> (!fpid || strlen(fpid)&lt;= 0 || !(<a class="code" href="classXrdProofdProofServMgr.html#a86cac591a5646811e38ff6a2477f4da7">fMgr</a>-&gt;<a class="code" href="classXrdProofdManager.html#ac1aeacfd6edb71f9bc4ebe8e472d006b">ClientMgr</a>()) || !<a class="code" href="classXrdProofdProofServMgr.html#ab1e3069da69611967716f0cecd93dedc">fRecoverClients</a>) {</div><div class="line"><a name="l02418"></a><span class="lineno"> 2418</span>&#160;      <a class="code" href="TGHtml_8h.html#ad5bb4a3d12fd54f29da2b924b29e652b">TRACE</a>(XERR, <span class="stringliteral">&quot;invalid inputs: &quot;</span>&lt;&lt;(fpid ? fpid : <span class="stringliteral">&quot;&lt;nul&gt;&quot;</span>)&lt;&lt;<span class="stringliteral">&quot;, &quot;</span>&lt;&lt;<a class="code" href="classXrdProofdProofServMgr.html#a86cac591a5646811e38ff6a2477f4da7">fMgr</a>-&gt;<a class="code" href="classXrdProofdManager.html#ac1aeacfd6edb71f9bc4ebe8e472d006b">ClientMgr</a>()&lt;&lt;</div><div class="line"><a name="l02419"></a><span class="lineno"> 2419</span>&#160;                  <span class="stringliteral">&quot;, &quot;</span>&lt;&lt;<a class="code" href="classXrdProofdProofServMgr.html#ab1e3069da69611967716f0cecd93dedc">fRecoverClients</a>);</div><div class="line"><a name="l02420"></a><span class="lineno"> 2420</span>&#160;      <span class="keywordflow">return</span> -1;</div><div class="line"><a name="l02421"></a><span class="lineno"> 2421</span>&#160;   }</div><div class="line"><a name="l02422"></a><span class="lineno"> 2422</span>&#160;</div><div class="line"><a name="l02423"></a><span class="lineno"> 2423</span>&#160;   <span class="comment">// Path to the session file</span></div><div class="line"><a name="l02424"></a><span class="lineno"> 2424</span>&#160;   XrdOucString path;</div><div class="line"><a name="l02425"></a><span class="lineno"> 2425</span>&#160;   <a class="code" href="XrdProofdAux_8h.html#a631cc8787af1a02d9e51c86117ae042e">XPDFORM</a>(path, <span class="stringliteral">&quot;%s/%s&quot;</span>, <a class="code" href="classXrdProofdProofServMgr.html#aa7d4e4ec33be14cd70bbc3595332736e">fActiAdminPath</a>.c_str(), fpid);</div><div class="line"><a name="l02426"></a><span class="lineno"> 2426</span>&#160;</div><div class="line"><a name="l02427"></a><span class="lineno"> 2427</span>&#160;   <span class="comment">// Read info</span></div><div class="line"><a name="l02428"></a><span class="lineno"> 2428</span>&#160;   <a class="code" href="classXrdProofSessionInfo.html">XrdProofSessionInfo</a> si(path.c_str());</div><div class="line"><a name="l02429"></a><span class="lineno"> 2429</span>&#160;</div><div class="line"><a name="l02430"></a><span class="lineno"> 2430</span>&#160;   <span class="comment">// Check if recovering is supported</span></div><div class="line"><a name="l02431"></a><span class="lineno"> 2431</span>&#160;   <span class="keywordflow">if</span> (si.fSrvProtVers &lt; 18) {</div><div class="line"><a name="l02432"></a><span class="lineno"> 2432</span>&#160;      <a class="code" href="TGHtml_8h.html#ad5bb4a3d12fd54f29da2b924b29e652b">TRACE</a>(DBG, <span class="stringliteral">&quot;session does not support recovering: protocol &quot;</span></div><div class="line"><a name="l02433"></a><span class="lineno"> 2433</span>&#160;                 &lt;&lt;si.fSrvProtVers&lt;&lt;<span class="stringliteral">&quot; &lt; 18&quot;</span>);</div><div class="line"><a name="l02434"></a><span class="lineno"> 2434</span>&#160;      <span class="keywordflow">return</span> -1;</div><div class="line"><a name="l02435"></a><span class="lineno"> 2435</span>&#160;   }</div><div class="line"><a name="l02436"></a><span class="lineno"> 2436</span>&#160;</div><div class="line"><a name="l02437"></a><span class="lineno"> 2437</span>&#160;   <span class="comment">// Create client instance</span></div><div class="line"><a name="l02438"></a><span class="lineno"> 2438</span>&#160;   <a class="code" href="classXrdProofdClient.html">XrdProofdClient</a> *<a class="code" href="RSha256_8hxx.html#a63f410abde93141c9013b7d3f3971738">c</a> = <a class="code" href="classXrdProofdProofServMgr.html#a86cac591a5646811e38ff6a2477f4da7">fMgr</a>-&gt;<a class="code" href="classXrdProofdManager.html#ac1aeacfd6edb71f9bc4ebe8e472d006b">ClientMgr</a>()-&gt;<a class="code" href="classXrdProofdClientMgr.html#a412036bb15d081a0b77deb6ff778d197">GetClient</a>(si.fUser.c_str(), si.fGroup.c_str(),</div><div class="line"><a name="l02439"></a><span class="lineno"> 2439</span>&#160;                                                     si.fUnixPath.c_str());</div><div class="line"><a name="l02440"></a><span class="lineno"> 2440</span>&#160;   <span class="keywordflow">if</span> (!<a class="code" href="RSha256_8hxx.html#a63f410abde93141c9013b7d3f3971738">c</a>) {</div><div class="line"><a name="l02441"></a><span class="lineno"> 2441</span>&#160;      <a class="code" href="TGHtml_8h.html#ad5bb4a3d12fd54f29da2b924b29e652b">TRACE</a>(DBG, <span class="stringliteral">&quot;client instance not initialized&quot;</span>);</div><div class="line"><a name="l02442"></a><span class="lineno"> 2442</span>&#160;      <span class="keywordflow">return</span> -1;</div><div class="line"><a name="l02443"></a><span class="lineno"> 2443</span>&#160;   }</div><div class="line"><a name="l02444"></a><span class="lineno"> 2444</span>&#160;</div><div class="line"><a name="l02445"></a><span class="lineno"> 2445</span>&#160;   <span class="comment">// Allocate the server object</span></div><div class="line"><a name="l02446"></a><span class="lineno"> 2446</span>&#160;   <span class="keywordtype">int</span> psid = si.fID;</div><div class="line"><a name="l02447"></a><span class="lineno"> 2447</span>&#160;   <a class="code" href="classXrdProofdProofServ.html">XrdProofdProofServ</a> *xps = <a class="code" href="RSha256_8hxx.html#a63f410abde93141c9013b7d3f3971738">c</a>-&gt;GetServObj(psid);</div><div class="line"><a name="l02448"></a><span class="lineno"> 2448</span>&#160;   <span class="keywordflow">if</span> (!xps) {</div><div class="line"><a name="l02449"></a><span class="lineno"> 2449</span>&#160;      <a class="code" href="TGHtml_8h.html#ad5bb4a3d12fd54f29da2b924b29e652b">TRACE</a>(DBG, <span class="stringliteral">&quot;server object not initialized&quot;</span>);</div><div class="line"><a name="l02450"></a><span class="lineno"> 2450</span>&#160;      <span class="keywordflow">return</span> -1;</div><div class="line"><a name="l02451"></a><span class="lineno"> 2451</span>&#160;   }</div><div class="line"><a name="l02452"></a><span class="lineno"> 2452</span>&#160;</div><div class="line"><a name="l02453"></a><span class="lineno"> 2453</span>&#160;   <span class="comment">// Fill info for this session</span></div><div class="line"><a name="l02454"></a><span class="lineno"> 2454</span>&#160;   si.FillProofServ(*xps, <a class="code" href="classXrdProofdProofServMgr.html#a86cac591a5646811e38ff6a2477f4da7">fMgr</a>-&gt;<a class="code" href="classXrdProofdManager.html#a2f5b5d64f2d6f4f3b0f6f003f6183468">ROOTMgr</a>());</div><div class="line"><a name="l02455"></a><span class="lineno"> 2455</span>&#160;   <span class="keywordflow">if</span> (xps-&gt;<a class="code" href="classXrdProofdProofServ.html#a7ef7d888b3308f42fd4a90558851e55d">CreateUNIXSock</a>(<a class="code" href="classXrdProofdConfig.html#a604213f0bcb2d2a3494610fedda8e975">fEDest</a>) != 0) {</div><div class="line"><a name="l02456"></a><span class="lineno"> 2456</span>&#160;      <span class="comment">// Failure</span></div><div class="line"><a name="l02457"></a><span class="lineno"> 2457</span>&#160;      <a class="code" href="TGHtml_8h.html#ad5bb4a3d12fd54f29da2b924b29e652b">TRACE</a>(XERR,<span class="stringliteral">&quot;failure creating UNIX socket on &quot;</span> &lt;&lt; xps-&gt;<a class="code" href="classXrdProofdProofServ.html#adbac6b3286754cb303806f8d70e58765">UNIXSockPath</a>());</div><div class="line"><a name="l02458"></a><span class="lineno"> 2458</span>&#160;      xps-&gt;<a class="code" href="classXrdProofdProofServ.html#ac4953244f65634a9ee47299d408591d8">Reset</a>();</div><div class="line"><a name="l02459"></a><span class="lineno"> 2459</span>&#160;      <span class="keywordflow">return</span> -1;</div><div class="line"><a name="l02460"></a><span class="lineno"> 2460</span>&#160;   }</div><div class="line"><a name="l02461"></a><span class="lineno"> 2461</span>&#160;</div><div class="line"><a name="l02462"></a><span class="lineno"> 2462</span>&#160;   <span class="comment">// Set invalid as we are not yet connected</span></div><div class="line"><a name="l02463"></a><span class="lineno"> 2463</span>&#160;   xps-&gt;<a class="code" href="classXrdProofdProofServ.html#a40e6ddd8c50a760e4a40e7a8d4fe149a">SetValid</a>(0);</div><div class="line"><a name="l02464"></a><span class="lineno"> 2464</span>&#160;</div><div class="line"><a name="l02465"></a><span class="lineno"> 2465</span>&#160;   <span class="comment">// Add to the lists</span></div><div class="line"><a name="l02466"></a><span class="lineno"> 2466</span>&#160;   <a class="code" href="XrdSysToOuc_8h.html#a4ba18bedbb8a1a4367d57f49a4d773ce">XrdSysMutexHelper</a> mhp(<a class="code" href="classXrdProofdProofServMgr.html#a91f8131e123b4e864bdf0c9f069f0ebd">fRecoverMutex</a>);</div><div class="line"><a name="l02467"></a><span class="lineno"> 2467</span>&#160;   std::list&lt;XpdClientSessions *&gt;::iterator ii = <a class="code" href="classXrdProofdProofServMgr.html#ab1e3069da69611967716f0cecd93dedc">fRecoverClients</a>-&gt;begin();</div><div class="line"><a name="l02468"></a><span class="lineno"> 2468</span>&#160;   <span class="keywordflow">while</span> (ii != <a class="code" href="classXrdProofdProofServMgr.html#ab1e3069da69611967716f0cecd93dedc">fRecoverClients</a>-&gt;end()) {</div><div class="line"><a name="l02469"></a><span class="lineno"> 2469</span>&#160;      <span class="keywordflow">if</span> ((*ii)-&gt;fClient == <a class="code" href="RSha256_8hxx.html#a63f410abde93141c9013b7d3f3971738">c</a>)</div><div class="line"><a name="l02470"></a><span class="lineno"> 2470</span>&#160;         <span class="keywordflow">break</span>;</div><div class="line"><a name="l02471"></a><span class="lineno"> 2471</span>&#160;      ++ii;</div><div class="line"><a name="l02472"></a><span class="lineno"> 2472</span>&#160;   }</div><div class="line"><a name="l02473"></a><span class="lineno"> 2473</span>&#160;   <span class="keywordflow">if</span> (ii != <a class="code" href="classXrdProofdProofServMgr.html#ab1e3069da69611967716f0cecd93dedc">fRecoverClients</a>-&gt;end()) {</div><div class="line"><a name="l02474"></a><span class="lineno"> 2474</span>&#160;      (*ii)-&gt;fProofServs.push_back(xps);</div><div class="line"><a name="l02475"></a><span class="lineno"> 2475</span>&#160;   } <span class="keywordflow">else</span> {</div><div class="line"><a name="l02476"></a><span class="lineno"> 2476</span>&#160;      <a class="code" href="classXpdClientSessions.html">XpdClientSessions</a> *cl = <span class="keyword">new</span> <a class="code" href="classXpdClientSessions.html">XpdClientSessions</a>(<a class="code" href="RSha256_8hxx.html#a63f410abde93141c9013b7d3f3971738">c</a>);</div><div class="line"><a name="l02477"></a><span class="lineno"> 2477</span>&#160;      cl-&gt;<a class="code" href="classXpdClientSessions.html#ad416d664f0ee7bfcece4e30e0f796346">fProofServs</a>.push_back(xps);</div><div class="line"><a name="l02478"></a><span class="lineno"> 2478</span>&#160;      <a class="code" href="classXrdProofdProofServMgr.html#ab1e3069da69611967716f0cecd93dedc">fRecoverClients</a>-&gt;push_back(cl);</div><div class="line"><a name="l02479"></a><span class="lineno"> 2479</span>&#160;   }</div><div class="line"><a name="l02480"></a><span class="lineno"> 2480</span>&#160;</div><div class="line"><a name="l02481"></a><span class="lineno"> 2481</span>&#160;   <span class="comment">// Done</span></div><div class="line"><a name="l02482"></a><span class="lineno"> 2482</span>&#160;   <span class="keywordflow">return</span> 0;</div><div class="line"><a name="l02483"></a><span class="lineno"> 2483</span>&#160;}</div><div class="line"><a name="l02484"></a><span class="lineno"> 2484</span>&#160;<span class="comment"></span></div><div class="line"><a name="l02485"></a><span class="lineno"> 2485</span>&#160;<span class="comment">////////////////////////////////////////////////////////////////////////////////</span></div><div class="line"><a name="l02486"></a><span class="lineno"> 2486</span>&#160;<span class="comment">/// Handle a request to recover a session after stop&amp;restart for a specific client</span></div><div class="line"><a name="l02487"></a><span class="lineno"> 2487</span>&#160;<span class="comment"></span></div><div class="line"><a name="l02488"></a><span class="lineno"><a class="line" href="classXrdProofdProofServMgr.html#ac8b90ca558edf52af7b174c02aca89ac"> 2488</a></span>&#160;<span class="keywordtype">int</span> <a class="code" href="classXrdProofdProofServMgr.html#ac8b90ca558edf52af7b174c02aca89ac">XrdProofdProofServMgr::Recover</a>(<a class="code" href="classXpdClientSessions.html">XpdClientSessions</a> *cl)</div><div class="line"><a name="l02489"></a><span class="lineno"> 2489</span>&#160;{</div><div class="line"><a name="l02490"></a><span class="lineno"> 2490</span>&#160;   <a class="code" href="XrdProofdTrace_8h.html#a7c31822912a8d0dc9bfd544097b29e12">XPDLOC</a>(SMGR, <span class="stringliteral">&quot;ProofServMgr::Recover&quot;</span>)</div><div class="line"><a name="l02491"></a><span class="lineno"> 2491</span>&#160;</div><div class="line"><a name="l02492"></a><span class="lineno"> 2492</span>&#160;   <span class="keywordflow">if</span> (!cl) {</div><div class="line"><a name="l02493"></a><span class="lineno"> 2493</span>&#160;      <a class="code" href="TGHtml_8h.html#ad5bb4a3d12fd54f29da2b924b29e652b">TRACE</a>(XERR, <span class="stringliteral">&quot;invalid input!&quot;</span>);</div><div class="line"><a name="l02494"></a><span class="lineno"> 2494</span>&#160;      <span class="keywordflow">return</span> 0;</div><div class="line"><a name="l02495"></a><span class="lineno"> 2495</span>&#160;   }</div><div class="line"><a name="l02496"></a><span class="lineno"> 2496</span>&#160;</div><div class="line"><a name="l02497"></a><span class="lineno"> 2497</span>&#160;   <a class="code" href="TGHtml_8h.html#ad5bb4a3d12fd54f29da2b924b29e652b">TRACE</a>(DBG,  <span class="stringliteral">&quot;client: &quot;</span>&lt;&lt; cl-&gt;<a class="code" href="classXpdClientSessions.html#a1a8e490b7f7a55c7961dcc0089d215a0">fClient</a>-&gt;<a class="code" href="classXrdProofdClient.html#a3cbe604999cdb44ae9d0ec833ffa5900">User</a>());</div><div class="line"><a name="l02498"></a><span class="lineno"> 2498</span>&#160;</div><div class="line"><a name="l02499"></a><span class="lineno"> 2499</span>&#160;   <span class="keywordtype">int</span> nr = 0;</div><div class="line"><a name="l02500"></a><span class="lineno"> 2500</span>&#160;   XrdOucString emsg;</div><div class="line"><a name="l02501"></a><span class="lineno"> 2501</span>&#160;   <a class="code" href="classXrdProofdProofServ.html">XrdProofdProofServ</a> *xps = 0;</div><div class="line"><a name="l02502"></a><span class="lineno"> 2502</span>&#160;   <span class="keywordtype">int</span> nps = 0;</div><div class="line"><a name="l02503"></a><span class="lineno"> 2503</span>&#160;   { <a class="code" href="XrdSysToOuc_8h.html#a4ba18bedbb8a1a4367d57f49a4d773ce">XrdSysMutexHelper</a> mhp(cl-&gt;<a class="code" href="classXpdClientSessions.html#a45dc70ffd3df9c03fda9f63db865ee0d">fMutex</a>); nps = cl-&gt;<a class="code" href="classXpdClientSessions.html#ad416d664f0ee7bfcece4e30e0f796346">fProofServs</a>.size(); }</div><div class="line"><a name="l02504"></a><span class="lineno"> 2504</span>&#160;   <span class="keywordflow">while</span> (nps--) {</div><div class="line"><a name="l02505"></a><span class="lineno"> 2505</span>&#160;</div><div class="line"><a name="l02506"></a><span class="lineno"> 2506</span>&#160;      { <a class="code" href="XrdSysToOuc_8h.html#a4ba18bedbb8a1a4367d57f49a4d773ce">XrdSysMutexHelper</a> mhp(cl-&gt;<a class="code" href="classXpdClientSessions.html#a45dc70ffd3df9c03fda9f63db865ee0d">fMutex</a>); xps = cl-&gt;<a class="code" href="classXpdClientSessions.html#ad416d664f0ee7bfcece4e30e0f796346">fProofServs</a>.front();</div><div class="line"><a name="l02507"></a><span class="lineno"> 2507</span>&#160;        cl-&gt;<a class="code" href="classXpdClientSessions.html#ad416d664f0ee7bfcece4e30e0f796346">fProofServs</a>.remove(xps); cl-&gt;<a class="code" href="classXpdClientSessions.html#ad416d664f0ee7bfcece4e30e0f796346">fProofServs</a>.push_back(xps); }</div><div class="line"><a name="l02508"></a><span class="lineno"> 2508</span>&#160;</div><div class="line"><a name="l02509"></a><span class="lineno"> 2509</span>&#160;      <span class="comment">// Short steps of 1 sec</span></div><div class="line"><a name="l02510"></a><span class="lineno"> 2510</span>&#160;      <span class="keywordflow">if</span> (<a class="code" href="classXrdProofdProofServMgr.html#a2f69ab8ab20f64f0ce7521dcf6be2952">AcceptPeer</a>(xps, 1, emsg) != 0) {</div><div class="line"><a name="l02511"></a><span class="lineno"> 2511</span>&#160;         <span class="keywordflow">if</span> (emsg == <span class="stringliteral">&quot;timeout&quot;</span>) {</div><div class="line"><a name="l02512"></a><span class="lineno"> 2512</span>&#160;            <a class="code" href="TGHtml_8h.html#ad5bb4a3d12fd54f29da2b924b29e652b">TRACE</a>(DBG, <span class="stringliteral">&quot;timeout while accepting callback&quot;</span>);</div><div class="line"><a name="l02513"></a><span class="lineno"> 2513</span>&#160;         } <span class="keywordflow">else</span> {</div><div class="line"><a name="l02514"></a><span class="lineno"> 2514</span>&#160;            <a class="code" href="TGHtml_8h.html#ad5bb4a3d12fd54f29da2b924b29e652b">TRACE</a>(XERR, <span class="stringliteral">&quot;problems accepting callback: &quot;</span>&lt;&lt;emsg);</div><div class="line"><a name="l02515"></a><span class="lineno"> 2515</span>&#160;         }</div><div class="line"><a name="l02516"></a><span class="lineno"> 2516</span>&#160;      } <span class="keywordflow">else</span> {</div><div class="line"><a name="l02517"></a><span class="lineno"> 2517</span>&#160;         <span class="comment">// Update the global session handlers</span></div><div class="line"><a name="l02518"></a><span class="lineno"> 2518</span>&#160;         XrdOucString key; key += xps-&gt;<a class="code" href="classXrdProofdProofServ.html#a82ce7d276f54e6b4bb25430b738f7767">SrvPID</a>();</div><div class="line"><a name="l02519"></a><span class="lineno"> 2519</span>&#160;         <a class="code" href="classXrdProofdProofServMgr.html#a4a8be4f347170c279824168597e16caa">fSessions</a>.Add(key.c_str(), xps, 0, Hash_keepdata);</div><div class="line"><a name="l02520"></a><span class="lineno"> 2520</span>&#160;         <a class="code" href="classXrdProofdProofServMgr.html#a909fb1d3452ad38d9cc83782f777d07c">fActiveSessions</a>.push_back(xps);</div><div class="line"><a name="l02521"></a><span class="lineno"> 2521</span>&#160;         xps-&gt;<a class="code" href="classXrdProofdProofServ.html#a6ba086750a26352c640fb915d10b4b22">Protocol</a>()-&gt;<a class="code" href="classXrdProofdProtocol.html#adccd3922e9251ceea953ce15a7ddf09a">SetAdminPath</a>(xps-&gt;<a class="code" href="classXrdProofdProofServ.html#a25ba137320d90e008bd46533da88263c">AdminPath</a>());</div><div class="line"><a name="l02522"></a><span class="lineno"> 2522</span>&#160;         <span class="comment">// Remove from the temp list</span></div><div class="line"><a name="l02523"></a><span class="lineno"> 2523</span>&#160;         { <a class="code" href="XrdSysToOuc_8h.html#a4ba18bedbb8a1a4367d57f49a4d773ce">XrdSysMutexHelper</a> mhp(cl-&gt;<a class="code" href="classXpdClientSessions.html#a45dc70ffd3df9c03fda9f63db865ee0d">fMutex</a>); cl-&gt;<a class="code" href="classXpdClientSessions.html#ad416d664f0ee7bfcece4e30e0f796346">fProofServs</a>.remove(xps); }</div><div class="line"><a name="l02524"></a><span class="lineno"> 2524</span>&#160;         <span class="comment">// Count</span></div><div class="line"><a name="l02525"></a><span class="lineno"> 2525</span>&#160;         nr++;</div><div class="line"><a name="l02526"></a><span class="lineno"> 2526</span>&#160;         <span class="comment">// Notify</span></div><div class="line"><a name="l02527"></a><span class="lineno"> 2527</span>&#160;         <span class="keywordflow">if</span> (<a class="code" href="XrdProofdTrace_8h.html#ae90cd8dc8bb9c2e23852350504b02e49">TRACING</a>(REQ)) {</div><div class="line"><a name="l02528"></a><span class="lineno"> 2528</span>&#160;            <span class="keywordtype">int</span> pid = xps-&gt;<a class="code" href="classXrdProofdProofServ.html#a82ce7d276f54e6b4bb25430b738f7767">SrvPID</a>();</div><div class="line"><a name="l02529"></a><span class="lineno"> 2529</span>&#160;            <span class="keywordtype">int</span> left = -1;</div><div class="line"><a name="l02530"></a><span class="lineno"> 2530</span>&#160;            { <a class="code" href="XrdSysToOuc_8h.html#a4ba18bedbb8a1a4367d57f49a4d773ce">XrdSysMutexHelper</a> mhp(cl-&gt;<a class="code" href="classXpdClientSessions.html#a45dc70ffd3df9c03fda9f63db865ee0d">fMutex</a>); left = cl-&gt;<a class="code" href="classXpdClientSessions.html#ad416d664f0ee7bfcece4e30e0f796346">fProofServs</a>.size(); }</div><div class="line"><a name="l02531"></a><span class="lineno"> 2531</span>&#160;            <a class="code" href="XrdProofdTrace_8h.html#a16e6f602476f24a2b61f420a39b38527">XPDPRT</a>(<span class="stringliteral">&quot;session for &quot;</span>&lt;&lt;cl-&gt;<a class="code" href="classXpdClientSessions.html#a1a8e490b7f7a55c7961dcc0089d215a0">fClient</a>-&gt;<a class="code" href="classXrdProofdClient.html#a3cbe604999cdb44ae9d0ec833ffa5900">User</a>()&lt;&lt;<span class="stringliteral">&quot;.&quot;</span>&lt;&lt;cl-&gt;<a class="code" href="classXpdClientSessions.html#a1a8e490b7f7a55c7961dcc0089d215a0">fClient</a>-&gt;<a class="code" href="classXrdProofdClient.html#af82bc301c99dc688038ba2c771b5c49e">Group</a>()&lt;&lt;</div><div class="line"><a name="l02532"></a><span class="lineno"> 2532</span>&#160;                   <span class="stringliteral">&quot; successfully recovered (&quot;</span>&lt;&lt;left&lt;&lt;<span class="stringliteral">&quot; left); pid: &quot;</span>&lt;&lt;pid);</div><div class="line"><a name="l02533"></a><span class="lineno"> 2533</span>&#160;         }</div><div class="line"><a name="l02534"></a><span class="lineno"> 2534</span>&#160;      }</div><div class="line"><a name="l02535"></a><span class="lineno"> 2535</span>&#160;   }</div><div class="line"><a name="l02536"></a><span class="lineno"> 2536</span>&#160;</div><div class="line"><a name="l02537"></a><span class="lineno"> 2537</span>&#160;   <span class="comment">// Over</span></div><div class="line"><a name="l02538"></a><span class="lineno"> 2538</span>&#160;   <span class="keywordflow">return</span> nr;</div><div class="line"><a name="l02539"></a><span class="lineno"> 2539</span>&#160;}</div><div class="line"><a name="l02540"></a><span class="lineno"> 2540</span>&#160;</div><div class="line"><a name="l02541"></a><span class="lineno"> 2541</span>&#160;<span class="preprocessor">#ifndef ROOT_XrdFour</span></div><div class="line"><a name="l02542"></a><span class="lineno"> 2542</span>&#160;<span class="comment">////////////////////////////////////////////////////////////////////////////////</span></div><div class="line"><a name="l02543"></a><span class="lineno"> 2543</span>&#160;<span class="comment"></span><span class="comment">/// Accept a callback from a starting-up server and setup the related protocol</span></div><div class="line"><a name="l02544"></a><span class="lineno"> 2544</span>&#160;<span class="comment"></span><span class="comment">/// object. Used for old servers.</span></div><div class="line"><a name="l02545"></a><span class="lineno"> 2545</span>&#160;<span class="comment"></span><span class="comment">/// Return 0 if successful or -1 in case of failure.</span></div><div class="line"><a name="l02546"></a><span class="lineno"> 2546</span>&#160;<span class="comment"></span></div><div class="line"><a name="l02547"></a><span class="lineno"><a class="line" href="classXrdProofdProofServMgr.html#a2f69ab8ab20f64f0ce7521dcf6be2952"> 2547</a></span>&#160;<span class="keywordtype">int</span> <a class="code" href="classXrdProofdProofServMgr.html#a2f69ab8ab20f64f0ce7521dcf6be2952">XrdProofdProofServMgr::AcceptPeer</a>(<a class="code" href="classXrdProofdProofServ.html">XrdProofdProofServ</a> *xps,</div><div class="line"><a name="l02548"></a><span class="lineno"> 2548</span>&#160;                                      <span class="keywordtype">int</span> to, XrdOucString &amp;msg)</div><div class="line"><a name="l02549"></a><span class="lineno"> 2549</span>&#160;{</div><div class="line"><a name="l02550"></a><span class="lineno"> 2550</span>&#160;   <a class="code" href="XrdProofdTrace_8h.html#a7c31822912a8d0dc9bfd544097b29e12">XPDLOC</a>(SMGR, <span class="stringliteral">&quot;ProofServMgr::AcceptPeer&quot;</span>)</div><div class="line"><a name="l02551"></a><span class="lineno"> 2551</span>&#160;</div><div class="line"><a name="l02552"></a><span class="lineno"> 2552</span>&#160;   <span class="comment">// We will get back a peer to initialize a link</span></div><div class="line"><a name="l02553"></a><span class="lineno"> 2553</span>&#160;   XrdNetPeer peerpsrv;</div><div class="line"><a name="l02554"></a><span class="lineno"> 2554</span>&#160;</div><div class="line"><a name="l02555"></a><span class="lineno"> 2555</span>&#160;   <span class="comment">// Check inputs</span></div><div class="line"><a name="l02556"></a><span class="lineno"> 2556</span>&#160;   <span class="keywordflow">if</span> (!xps || !xps-&gt;<a class="code" href="classXrdProofdProofServ.html#a6d021563fa5819a9d41720df41c54e7c">UNIXSock</a>()) {</div><div class="line"><a name="l02557"></a><span class="lineno"> 2557</span>&#160;      <a class="code" href="XrdProofdAux_8h.html#a631cc8787af1a02d9e51c86117ae042e">XPDFORM</a>(msg, <span class="stringliteral">&quot;session pointer undefined or socket invalid: %p&quot;</span>, xps);</div><div class="line"><a name="l02558"></a><span class="lineno"> 2558</span>&#160;      <span class="keywordflow">return</span> -1;</div><div class="line"><a name="l02559"></a><span class="lineno"> 2559</span>&#160;   }</div><div class="line"><a name="l02560"></a><span class="lineno"> 2560</span>&#160;   <a class="code" href="TGHtml_8h.html#ad5bb4a3d12fd54f29da2b924b29e652b">TRACE</a>(REQ, <span class="stringliteral">&quot;waiting for server callback for &quot;</span>&lt;&lt;to&lt;&lt;<span class="stringliteral">&quot; secs ... on &quot;</span>&lt;&lt;xps-&gt;<a class="code" href="classXrdProofdProofServ.html#adbac6b3286754cb303806f8d70e58765">UNIXSockPath</a>());</div><div class="line"><a name="l02561"></a><span class="lineno"> 2561</span>&#160;</div><div class="line"><a name="l02562"></a><span class="lineno"> 2562</span>&#160;   <span class="comment">// Perform regular accept</span></div><div class="line"><a name="l02563"></a><span class="lineno"> 2563</span>&#160;   <span class="keywordflow">if</span> (!(xps-&gt;<a class="code" href="classXrdProofdProofServ.html#a6d021563fa5819a9d41720df41c54e7c">UNIXSock</a>()-&gt;Accept(peerpsrv, XRDNET_NODNTRIM, to))) {</div><div class="line"><a name="l02564"></a><span class="lineno"> 2564</span>&#160;      msg = <span class="stringliteral">&quot;timeout&quot;</span>;</div><div class="line"><a name="l02565"></a><span class="lineno"> 2565</span>&#160;      <span class="keywordflow">return</span> -1;</div><div class="line"><a name="l02566"></a><span class="lineno"> 2566</span>&#160;   }</div><div class="line"><a name="l02567"></a><span class="lineno"> 2567</span>&#160;</div><div class="line"><a name="l02568"></a><span class="lineno"> 2568</span>&#160;   <span class="comment">// Setup the protocol serving this peer</span></div><div class="line"><a name="l02569"></a><span class="lineno"> 2569</span>&#160;   <span class="keywordflow">if</span> (<a class="code" href="classXrdProofdProofServMgr.html#aa5a2736acc4831626327d1c5e37ebf29">SetupProtocol</a>(peerpsrv, xps, msg) != 0) {</div><div class="line"><a name="l02570"></a><span class="lineno"> 2570</span>&#160;      msg = <span class="stringliteral">&quot;could not assert connected peer: &quot;</span>;</div><div class="line"><a name="l02571"></a><span class="lineno"> 2571</span>&#160;      <span class="keywordflow">return</span> -1;</div><div class="line"><a name="l02572"></a><span class="lineno"> 2572</span>&#160;   }</div><div class="line"><a name="l02573"></a><span class="lineno"> 2573</span>&#160;</div><div class="line"><a name="l02574"></a><span class="lineno"> 2574</span>&#160;   <span class="comment">// Done</span></div><div class="line"><a name="l02575"></a><span class="lineno"> 2575</span>&#160;   <span class="keywordflow">return</span> 0;</div><div class="line"><a name="l02576"></a><span class="lineno"> 2576</span>&#160;}</div><div class="line"><a name="l02577"></a><span class="lineno"> 2577</span>&#160;<span class="comment"></span></div><div class="line"><a name="l02578"></a><span class="lineno"> 2578</span>&#160;<span class="comment">////////////////////////////////////////////////////////////////////////////////</span></div><div class="line"><a name="l02579"></a><span class="lineno"> 2579</span>&#160;<span class="comment">/// Setup the protocol object serving the peer described by &#39;peerpsrv&#39;</span></div><div class="line"><a name="l02580"></a><span class="lineno"> 2580</span>&#160;<span class="comment"></span></div><div class="line"><a name="l02581"></a><span class="lineno"><a class="line" href="classXrdProofdProofServMgr.html#aa5a2736acc4831626327d1c5e37ebf29"> 2581</a></span>&#160;<span class="keywordtype">int</span> <a class="code" href="classXrdProofdProofServMgr.html#aa5a2736acc4831626327d1c5e37ebf29">XrdProofdProofServMgr::SetupProtocol</a>(XrdNetPeer &amp;peerpsrv,</div><div class="line"><a name="l02582"></a><span class="lineno"> 2582</span>&#160;                                         <a class="code" href="classXrdProofdProofServ.html">XrdProofdProofServ</a> *xps, XrdOucString &amp;msg)</div><div class="line"><a name="l02583"></a><span class="lineno"> 2583</span>&#160;{</div><div class="line"><a name="l02584"></a><span class="lineno"> 2584</span>&#160;   <a class="code" href="XrdProofdTrace_8h.html#a7c31822912a8d0dc9bfd544097b29e12">XPDLOC</a>(SMGR, <span class="stringliteral">&quot;ProofServMgr::SetupProtocol&quot;</span>)</div><div class="line"><a name="l02585"></a><span class="lineno"> 2585</span>&#160;</div><div class="line"><a name="l02586"></a><span class="lineno"> 2586</span>&#160;   <span class="comment">// We will get back a peer to initialize a link</span></div><div class="line"><a name="l02587"></a><span class="lineno"> 2587</span>&#160;   XrdLink   *linkpsrv = 0;</div><div class="line"><a name="l02588"></a><span class="lineno"> 2588</span>&#160;   XrdProtocol *xp = 0;</div><div class="line"><a name="l02589"></a><span class="lineno"> 2589</span>&#160;   <span class="keywordtype">int</span> lnkopts = 0;</div><div class="line"><a name="l02590"></a><span class="lineno"> 2590</span>&#160;   <span class="keywordtype">bool</span> go = 1;</div><div class="line"><a name="l02591"></a><span class="lineno"> 2591</span>&#160;</div><div class="line"><a name="l02592"></a><span class="lineno"> 2592</span>&#160;   <span class="comment">// Make sure we have the full host name</span></div><div class="line"><a name="l02593"></a><span class="lineno"> 2593</span>&#160;   <span class="keywordflow">if</span> (peerpsrv.InetName) <a class="code" href="civetweb_8c.html#a2c6efa7679f8cd9f61af96e105017560">free</a>(peerpsrv.InetName);</div><div class="line"><a name="l02594"></a><span class="lineno"> 2594</span>&#160;   peerpsrv.InetName = XrdSysDNS::getHostName(<span class="stringliteral">&quot;localhost&quot;</span>);</div><div class="line"><a name="l02595"></a><span class="lineno"> 2595</span>&#160;</div><div class="line"><a name="l02596"></a><span class="lineno"> 2596</span>&#160;   <span class="comment">// Allocate a new network object</span></div><div class="line"><a name="l02597"></a><span class="lineno"> 2597</span>&#160;   <span class="keywordflow">if</span> (!(linkpsrv = XrdLink::Alloc(peerpsrv, lnkopts))) {</div><div class="line"><a name="l02598"></a><span class="lineno"> 2598</span>&#160;      msg = <span class="stringliteral">&quot;could not allocate network object: &quot;</span>;</div><div class="line"><a name="l02599"></a><span class="lineno"> 2599</span>&#160;      go = 0;</div><div class="line"><a name="l02600"></a><span class="lineno"> 2600</span>&#160;   }</div><div class="line"><a name="l02601"></a><span class="lineno"> 2601</span>&#160;</div><div class="line"><a name="l02602"></a><span class="lineno"> 2602</span>&#160;   <span class="keywordflow">if</span> (go) {</div><div class="line"><a name="l02603"></a><span class="lineno"> 2603</span>&#160;      <span class="comment">// Keep buffer after object goes away</span></div><div class="line"><a name="l02604"></a><span class="lineno"> 2604</span>&#160;      peerpsrv.InetBuff = 0;</div><div class="line"><a name="l02605"></a><span class="lineno"> 2605</span>&#160;      <a class="code" href="TGHtml_8h.html#ad5bb4a3d12fd54f29da2b924b29e652b">TRACE</a>(DBG, <span class="stringliteral">&quot;connection accepted: matching protocol ... &quot;</span>);</div><div class="line"><a name="l02606"></a><span class="lineno"> 2606</span>&#160;      <span class="comment">// Get a protocol object off the stack (if none, allocate a new one)</span></div><div class="line"><a name="l02607"></a><span class="lineno"> 2607</span>&#160;      <a class="code" href="classXrdProofdProtocol.html">XrdProofdProtocol</a> *p = <span class="keyword">new</span> <a class="code" href="classXrdProofdProtocol.html">XrdProofdProtocol</a>();</div><div class="line"><a name="l02608"></a><span class="lineno"> 2608</span>&#160;      <span class="keywordflow">if</span> (!(xp = p-&gt;<a class="code" href="classXrdProofdProtocol.html#a5f4f44ef5012ad3a1b11c46e68fb060c">Match</a>(linkpsrv))) {</div><div class="line"><a name="l02609"></a><span class="lineno"> 2609</span>&#160;         msg = <span class="stringliteral">&quot;match failed: protocol error: &quot;</span>;</div><div class="line"><a name="l02610"></a><span class="lineno"> 2610</span>&#160;         go = 0;</div><div class="line"><a name="l02611"></a><span class="lineno"> 2611</span>&#160;      }</div><div class="line"><a name="l02612"></a><span class="lineno"> 2612</span>&#160;      <span class="keyword">delete</span> p;</div><div class="line"><a name="l02613"></a><span class="lineno"> 2613</span>&#160;   }</div><div class="line"><a name="l02614"></a><span class="lineno"> 2614</span>&#160;</div><div class="line"><a name="l02615"></a><span class="lineno"> 2615</span>&#160;   <span class="keywordflow">if</span> (go) {</div><div class="line"><a name="l02616"></a><span class="lineno"> 2616</span>&#160;      <span class="comment">// Save path into the protocol instance: it may be needed during Process</span></div><div class="line"><a name="l02617"></a><span class="lineno"> 2617</span>&#160;      XrdOucString apath(xps-&gt;<a class="code" href="classXrdProofdProofServ.html#a25ba137320d90e008bd46533da88263c">AdminPath</a>());</div><div class="line"><a name="l02618"></a><span class="lineno"> 2618</span>&#160;      apath += <span class="stringliteral">&quot;.status&quot;</span>;</div><div class="line"><a name="l02619"></a><span class="lineno"> 2619</span>&#160;      ((<a class="code" href="classXrdProofdProtocol.html">XrdProofdProtocol</a> *)xp)-&gt;<a class="code" href="classXrdProofdProtocol.html#adccd3922e9251ceea953ce15a7ddf09a">SetAdminPath</a>(apath.c_str());</div><div class="line"><a name="l02620"></a><span class="lineno"> 2620</span>&#160;      <span class="comment">// Take a short-cut and process the initial request as a sticky request</span></div><div class="line"><a name="l02621"></a><span class="lineno"> 2621</span>&#160;      <span class="keywordflow">if</span> (xp-&gt;Process(linkpsrv) != 0) {</div><div class="line"><a name="l02622"></a><span class="lineno"> 2622</span>&#160;         msg = <span class="stringliteral">&quot;handshake with internal link failed: &quot;</span>;</div><div class="line"><a name="l02623"></a><span class="lineno"> 2623</span>&#160;         go = 0;</div><div class="line"><a name="l02624"></a><span class="lineno"> 2624</span>&#160;      }</div><div class="line"><a name="l02625"></a><span class="lineno"> 2625</span>&#160;   }</div><div class="line"><a name="l02626"></a><span class="lineno"> 2626</span>&#160;</div><div class="line"><a name="l02627"></a><span class="lineno"> 2627</span>&#160;   <span class="comment">// Attach this link to the appropriate poller and enable it.</span></div><div class="line"><a name="l02628"></a><span class="lineno"> 2628</span>&#160;   <span class="keywordflow">if</span> (go &amp;&amp; !<a class="code" href="classXrdPoll.html#aadc5e217147581760a9c4e74cedea8cf">XrdPoll::Attach</a>(linkpsrv)) {</div><div class="line"><a name="l02629"></a><span class="lineno"> 2629</span>&#160;      msg = <span class="stringliteral">&quot;could not attach new internal link to poller: &quot;</span>;</div><div class="line"><a name="l02630"></a><span class="lineno"> 2630</span>&#160;      go = 0;</div><div class="line"><a name="l02631"></a><span class="lineno"> 2631</span>&#160;   }</div><div class="line"><a name="l02632"></a><span class="lineno"> 2632</span>&#160;</div><div class="line"><a name="l02633"></a><span class="lineno"> 2633</span>&#160;   <span class="keywordflow">if</span> (!go) {</div><div class="line"><a name="l02634"></a><span class="lineno"> 2634</span>&#160;      <span class="comment">// Close the link</span></div><div class="line"><a name="l02635"></a><span class="lineno"> 2635</span>&#160;      <span class="keywordflow">if</span> (linkpsrv)</div><div class="line"><a name="l02636"></a><span class="lineno"> 2636</span>&#160;         linkpsrv-&gt;Close();</div><div class="line"><a name="l02637"></a><span class="lineno"> 2637</span>&#160;      <span class="keywordflow">return</span> -1;</div><div class="line"><a name="l02638"></a><span class="lineno"> 2638</span>&#160;   }</div><div class="line"><a name="l02639"></a><span class="lineno"> 2639</span>&#160;</div><div class="line"><a name="l02640"></a><span class="lineno"> 2640</span>&#160;   <span class="comment">// Tight this protocol instance to the link</span></div><div class="line"><a name="l02641"></a><span class="lineno"> 2641</span>&#160;   linkpsrv-&gt;setProtocol(xp);</div><div class="line"><a name="l02642"></a><span class="lineno"> 2642</span>&#160;</div><div class="line"><a name="l02643"></a><span class="lineno"> 2643</span>&#160;   <a class="code" href="TGHtml_8h.html#ad5bb4a3d12fd54f29da2b924b29e652b">TRACE</a>(REQ, <span class="stringliteral">&quot;Protocol &quot;</span>&lt;&lt;xp&lt;&lt;<span class="stringliteral">&quot; attached to link &quot;</span>&lt;&lt;linkpsrv&lt;&lt;<span class="stringliteral">&quot; (&quot;</span>&lt;&lt; peerpsrv.InetName &lt;&lt;<span class="stringliteral">&quot;)&quot;</span>);</div><div class="line"><a name="l02644"></a><span class="lineno"> 2644</span>&#160;</div><div class="line"><a name="l02645"></a><span class="lineno"> 2645</span>&#160;   <span class="comment">// Schedule it</span></div><div class="line"><a name="l02646"></a><span class="lineno"> 2646</span>&#160;   <a class="code" href="classXrdProofdProofServMgr.html#a86cac591a5646811e38ff6a2477f4da7">fMgr</a>-&gt;<a class="code" href="classXrdProofdManager.html#abd140a5d84efcad2bceb7fef7356d16e">Sched</a>()-&gt;Schedule((XrdJob *)linkpsrv);</div><div class="line"><a name="l02647"></a><span class="lineno"> 2647</span>&#160;</div><div class="line"><a name="l02648"></a><span class="lineno"> 2648</span>&#160;   <span class="comment">// Save the protocol in the session instance</span></div><div class="line"><a name="l02649"></a><span class="lineno"> 2649</span>&#160;   xps-&gt;<a class="code" href="classXrdProofdProofServ.html#a70449875c8de76c6ac32f14020c0f94b">SetProtocol</a>((<a class="code" href="classXrdProofdProtocol.html">XrdProofdProtocol</a> *)xp);</div><div class="line"><a name="l02650"></a><span class="lineno"> 2650</span>&#160;</div><div class="line"><a name="l02651"></a><span class="lineno"> 2651</span>&#160;   <span class="comment">// Done</span></div><div class="line"><a name="l02652"></a><span class="lineno"> 2652</span>&#160;   <span class="keywordflow">return</span> 0;</div><div class="line"><a name="l02653"></a><span class="lineno"> 2653</span>&#160;}</div><div class="line"><a name="l02654"></a><span class="lineno"> 2654</span>&#160;</div><div class="line"><a name="l02655"></a><span class="lineno"> 2655</span>&#160;<span class="preprocessor">#else</span></div><div class="line"><a name="l02656"></a><span class="lineno"> 2656</span>&#160;<span class="comment"></span></div><div class="line"><a name="l02657"></a><span class="lineno"> 2657</span>&#160;<span class="comment">////////////////////////////////////////////////////////////////////////////////</span></div><div class="line"><a name="l02658"></a><span class="lineno"> 2658</span>&#160;<span class="comment">/// Accept a callback from a starting-up server and setup the related protocol</span></div><div class="line"><a name="l02659"></a><span class="lineno"> 2659</span>&#160;<span class="comment">/// object. Used for old servers.</span></div><div class="line"><a name="l02660"></a><span class="lineno"> 2660</span>&#160;<span class="comment">/// Return 0 if successful or -1 in case of failure.</span></div><div class="line"><a name="l02661"></a><span class="lineno"> 2661</span>&#160;<span class="comment"></span></div><div class="line"><a name="l02662"></a><span class="lineno"> 2662</span>&#160;<span class="keywordtype">int</span> <a class="code" href="classXrdProofdProofServMgr.html#a2f69ab8ab20f64f0ce7521dcf6be2952">XrdProofdProofServMgr::AcceptPeer</a>(<a class="code" href="classXrdProofdProofServ.html">XrdProofdProofServ</a> *xps,</div><div class="line"><a name="l02663"></a><span class="lineno"> 2663</span>&#160;                                      <span class="keywordtype">int</span> to, XrdOucString &amp;msg)</div><div class="line"><a name="l02664"></a><span class="lineno"> 2664</span>&#160;{</div><div class="line"><a name="l02665"></a><span class="lineno"> 2665</span>&#160;   <a class="code" href="XrdProofdTrace_8h.html#a7c31822912a8d0dc9bfd544097b29e12">XPDLOC</a>(SMGR, <span class="stringliteral">&quot;ProofServMgr::AcceptPeer&quot;</span>)</div><div class="line"><a name="l02666"></a><span class="lineno"> 2666</span>&#160;</div><div class="line"><a name="l02667"></a><span class="lineno"> 2667</span>&#160;   <span class="comment">// We will get back a peer to initialize a link</span></div><div class="line"><a name="l02668"></a><span class="lineno"> 2668</span>&#160;   XrdNetAddr netaddr;</div><div class="line"><a name="l02669"></a><span class="lineno"> 2669</span>&#160;</div><div class="line"><a name="l02670"></a><span class="lineno"> 2670</span>&#160;   <span class="comment">// Check inputs</span></div><div class="line"><a name="l02671"></a><span class="lineno"> 2671</span>&#160;   if (!xps || !xps-&gt;UNIXSock()) {</div><div class="line"><a name="l02672"></a><span class="lineno"> 2672</span>&#160;      <a class="code" href="XrdProofdAux_8h.html#a631cc8787af1a02d9e51c86117ae042e">XPDFORM</a>(msg, <span class="stringliteral">&quot;session pointer undefined or socket invalid: %p&quot;</span>, xps);</div><div class="line"><a name="l02673"></a><span class="lineno"> 2673</span>&#160;      <span class="keywordflow">return</span> -1;</div><div class="line"><a name="l02674"></a><span class="lineno"> 2674</span>&#160;   }</div><div class="line"><a name="l02675"></a><span class="lineno"> 2675</span>&#160;   <a class="code" href="TGHtml_8h.html#ad5bb4a3d12fd54f29da2b924b29e652b">TRACE</a>(REQ, <span class="stringliteral">&quot;waiting for server callback for &quot;</span>&lt;&lt;to&lt;&lt;<span class="stringliteral">&quot; secs ... on &quot;</span>&lt;&lt;xps-&gt;<a class="code" href="classXrdProofdProofServ.html#adbac6b3286754cb303806f8d70e58765">UNIXSockPath</a>());</div><div class="line"><a name="l02676"></a><span class="lineno"> 2676</span>&#160;</div><div class="line"><a name="l02677"></a><span class="lineno"> 2677</span>&#160;   <span class="comment">// Perform regular accept</span></div><div class="line"><a name="l02678"></a><span class="lineno"> 2678</span>&#160;   <span class="keywordflow">if</span> (!(xps-&gt;<a class="code" href="classXrdProofdProofServ.html#a6d021563fa5819a9d41720df41c54e7c">UNIXSock</a>()-&gt;Accept(netaddr, 0, to))) {</div><div class="line"><a name="l02679"></a><span class="lineno"> 2679</span>&#160;      msg = <span class="stringliteral">&quot;timeout&quot;</span>;</div><div class="line"><a name="l02680"></a><span class="lineno"> 2680</span>&#160;      <span class="keywordflow">return</span> -1;</div><div class="line"><a name="l02681"></a><span class="lineno"> 2681</span>&#160;   }</div><div class="line"><a name="l02682"></a><span class="lineno"> 2682</span>&#160;</div><div class="line"><a name="l02683"></a><span class="lineno"> 2683</span>&#160;   <span class="comment">// Setup the protocol serving this peer</span></div><div class="line"><a name="l02684"></a><span class="lineno"> 2684</span>&#160;   <span class="keywordflow">if</span> (<a class="code" href="classXrdProofdProofServMgr.html#aa5a2736acc4831626327d1c5e37ebf29">SetupProtocol</a>(netaddr, xps, msg) != 0) {</div><div class="line"><a name="l02685"></a><span class="lineno"> 2685</span>&#160;      msg = <span class="stringliteral">&quot;could not assert connected peer: &quot;</span>;</div><div class="line"><a name="l02686"></a><span class="lineno"> 2686</span>&#160;      <span class="keywordflow">return</span> -1;</div><div class="line"><a name="l02687"></a><span class="lineno"> 2687</span>&#160;   }</div><div class="line"><a name="l02688"></a><span class="lineno"> 2688</span>&#160;</div><div class="line"><a name="l02689"></a><span class="lineno"> 2689</span>&#160;   <span class="comment">// Done</span></div><div class="line"><a name="l02690"></a><span class="lineno"> 2690</span>&#160;   <span class="keywordflow">return</span> 0;</div><div class="line"><a name="l02691"></a><span class="lineno"> 2691</span>&#160;}</div><div class="line"><a name="l02692"></a><span class="lineno"> 2692</span>&#160;<span class="comment"></span></div><div class="line"><a name="l02693"></a><span class="lineno"> 2693</span>&#160;<span class="comment">////////////////////////////////////////////////////////////////////////////////</span></div><div class="line"><a name="l02694"></a><span class="lineno"> 2694</span>&#160;<span class="comment">/// Setup the protocol object serving the peer described by &#39;peerpsrv&#39;</span></div><div class="line"><a name="l02695"></a><span class="lineno"> 2695</span>&#160;<span class="comment"></span></div><div class="line"><a name="l02696"></a><span class="lineno"> 2696</span>&#160;<span class="keywordtype">int</span> <a class="code" href="classXrdProofdProofServMgr.html#aa5a2736acc4831626327d1c5e37ebf29">XrdProofdProofServMgr::SetupProtocol</a>(XrdNetAddr &amp;netaddr,</div><div class="line"><a name="l02697"></a><span class="lineno"> 2697</span>&#160;                                         <a class="code" href="classXrdProofdProofServ.html">XrdProofdProofServ</a> *xps, XrdOucString &amp;msg)</div><div class="line"><a name="l02698"></a><span class="lineno"> 2698</span>&#160;{</div><div class="line"><a name="l02699"></a><span class="lineno"> 2699</span>&#160;   <a class="code" href="XrdProofdTrace_8h.html#a7c31822912a8d0dc9bfd544097b29e12">XPDLOC</a>(SMGR, <span class="stringliteral">&quot;ProofServMgr::SetupProtocol&quot;</span>)</div><div class="line"><a name="l02700"></a><span class="lineno"> 2700</span>&#160;</div><div class="line"><a name="l02701"></a><span class="lineno"> 2701</span>&#160;   <span class="comment">// We will get back a peer to initialize a link</span></div><div class="line"><a name="l02702"></a><span class="lineno"> 2702</span>&#160;   XrdLink   *linkpsrv = 0;</div><div class="line"><a name="l02703"></a><span class="lineno"> 2703</span>&#160;   XrdProtocol *xp = 0;</div><div class="line"><a name="l02704"></a><span class="lineno"> 2704</span>&#160;   <span class="keywordtype">int</span> lnkopts = 0;</div><div class="line"><a name="l02705"></a><span class="lineno"> 2705</span>&#160;   <span class="keywordtype">bool</span> go = 1;</div><div class="line"><a name="l02706"></a><span class="lineno"> 2706</span>&#160;</div><div class="line"><a name="l02707"></a><span class="lineno"> 2707</span>&#160;   <span class="comment">// Allocate a new network object</span></div><div class="line"><a name="l02708"></a><span class="lineno"> 2708</span>&#160;   if (!(linkpsrv = XrdLink::Alloc(netaddr, lnkopts))) {</div><div class="line"><a name="l02709"></a><span class="lineno"> 2709</span>&#160;      msg = <span class="stringliteral">&quot;could not allocate network object: &quot;</span>;</div><div class="line"><a name="l02710"></a><span class="lineno"> 2710</span>&#160;      go = 0;</div><div class="line"><a name="l02711"></a><span class="lineno"> 2711</span>&#160;   }</div><div class="line"><a name="l02712"></a><span class="lineno"> 2712</span>&#160;</div><div class="line"><a name="l02713"></a><span class="lineno"> 2713</span>&#160;   <span class="keywordflow">if</span> (go) {</div><div class="line"><a name="l02714"></a><span class="lineno"> 2714</span>&#160;      <a class="code" href="TGHtml_8h.html#ad5bb4a3d12fd54f29da2b924b29e652b">TRACE</a>(DBG, <span class="stringliteral">&quot;connection accepted: matching protocol ... &quot;</span>);</div><div class="line"><a name="l02715"></a><span class="lineno"> 2715</span>&#160;      <span class="comment">// Get a protocol object off the stack (if none, allocate a new one)</span></div><div class="line"><a name="l02716"></a><span class="lineno"> 2716</span>&#160;      <a class="code" href="classXrdProofdProtocol.html">XrdProofdProtocol</a> *p = <span class="keyword">new</span> <a class="code" href="classXrdProofdProtocol.html">XrdProofdProtocol</a>();</div><div class="line"><a name="l02717"></a><span class="lineno"> 2717</span>&#160;      <span class="keywordflow">if</span> (!(xp = p-&gt;<a class="code" href="classXrdProofdProtocol.html#a5f4f44ef5012ad3a1b11c46e68fb060c">Match</a>(linkpsrv))) {</div><div class="line"><a name="l02718"></a><span class="lineno"> 2718</span>&#160;         msg = <span class="stringliteral">&quot;match failed: protocol error: &quot;</span>;</div><div class="line"><a name="l02719"></a><span class="lineno"> 2719</span>&#160;         go = 0;</div><div class="line"><a name="l02720"></a><span class="lineno"> 2720</span>&#160;      }</div><div class="line"><a name="l02721"></a><span class="lineno"> 2721</span>&#160;      <span class="keyword">delete</span> p;</div><div class="line"><a name="l02722"></a><span class="lineno"> 2722</span>&#160;   }</div><div class="line"><a name="l02723"></a><span class="lineno"> 2723</span>&#160;</div><div class="line"><a name="l02724"></a><span class="lineno"> 2724</span>&#160;   <span class="keywordflow">if</span> (go) {</div><div class="line"><a name="l02725"></a><span class="lineno"> 2725</span>&#160;      <span class="comment">// Save path into the protocol instance: it may be needed during Process</span></div><div class="line"><a name="l02726"></a><span class="lineno"> 2726</span>&#160;      XrdOucString apath(xps-&gt;<a class="code" href="classXrdProofdProofServ.html#a25ba137320d90e008bd46533da88263c">AdminPath</a>());</div><div class="line"><a name="l02727"></a><span class="lineno"> 2727</span>&#160;      apath += <span class="stringliteral">&quot;.status&quot;</span>;</div><div class="line"><a name="l02728"></a><span class="lineno"> 2728</span>&#160;      ((<a class="code" href="classXrdProofdProtocol.html">XrdProofdProtocol</a> *)xp)-&gt;<a class="code" href="classXrdProofdProtocol.html#adccd3922e9251ceea953ce15a7ddf09a">SetAdminPath</a>(apath.c_str());</div><div class="line"><a name="l02729"></a><span class="lineno"> 2729</span>&#160;      <span class="comment">// Take a short-cut and process the initial request as a sticky request</span></div><div class="line"><a name="l02730"></a><span class="lineno"> 2730</span>&#160;      <span class="keywordflow">if</span> (xp-&gt;Process(linkpsrv) != 0) {</div><div class="line"><a name="l02731"></a><span class="lineno"> 2731</span>&#160;         msg = <span class="stringliteral">&quot;handshake with internal link failed: &quot;</span>;</div><div class="line"><a name="l02732"></a><span class="lineno"> 2732</span>&#160;         go = 0;</div><div class="line"><a name="l02733"></a><span class="lineno"> 2733</span>&#160;      }</div><div class="line"><a name="l02734"></a><span class="lineno"> 2734</span>&#160;   }</div><div class="line"><a name="l02735"></a><span class="lineno"> 2735</span>&#160;</div><div class="line"><a name="l02736"></a><span class="lineno"> 2736</span>&#160;   <span class="comment">// Attach this link to the appropriate poller and enable it.</span></div><div class="line"><a name="l02737"></a><span class="lineno"> 2737</span>&#160;   <span class="keywordflow">if</span> (go &amp;&amp; !<a class="code" href="classXrdPoll.html#aadc5e217147581760a9c4e74cedea8cf">XrdPoll::Attach</a>(linkpsrv)) {</div><div class="line"><a name="l02738"></a><span class="lineno"> 2738</span>&#160;      msg = <span class="stringliteral">&quot;could not attach new internal link to poller: &quot;</span>;</div><div class="line"><a name="l02739"></a><span class="lineno"> 2739</span>&#160;      go = 0;</div><div class="line"><a name="l02740"></a><span class="lineno"> 2740</span>&#160;   }</div><div class="line"><a name="l02741"></a><span class="lineno"> 2741</span>&#160;</div><div class="line"><a name="l02742"></a><span class="lineno"> 2742</span>&#160;   <span class="keywordflow">if</span> (!go) {</div><div class="line"><a name="l02743"></a><span class="lineno"> 2743</span>&#160;      <span class="comment">// Close the link</span></div><div class="line"><a name="l02744"></a><span class="lineno"> 2744</span>&#160;      <span class="keywordflow">if</span> (linkpsrv)</div><div class="line"><a name="l02745"></a><span class="lineno"> 2745</span>&#160;         linkpsrv-&gt;Close();</div><div class="line"><a name="l02746"></a><span class="lineno"> 2746</span>&#160;      <span class="keywordflow">return</span> -1;</div><div class="line"><a name="l02747"></a><span class="lineno"> 2747</span>&#160;   }</div><div class="line"><a name="l02748"></a><span class="lineno"> 2748</span>&#160;</div><div class="line"><a name="l02749"></a><span class="lineno"> 2749</span>&#160;   <span class="comment">// Tight this protocol instance to the link</span></div><div class="line"><a name="l02750"></a><span class="lineno"> 2750</span>&#160;   linkpsrv-&gt;setProtocol(xp);</div><div class="line"><a name="l02751"></a><span class="lineno"> 2751</span>&#160;</div><div class="line"><a name="l02752"></a><span class="lineno"> 2752</span>&#160;   <a class="code" href="TGHtml_8h.html#ad5bb4a3d12fd54f29da2b924b29e652b">TRACE</a>(REQ, <span class="stringliteral">&quot;Protocol &quot;</span>&lt;&lt;xp&lt;&lt;<span class="stringliteral">&quot; attached to link &quot;</span>&lt;&lt;linkpsrv&lt;&lt;<span class="stringliteral">&quot; (&quot;</span>&lt;&lt; netaddr.Name() &lt;&lt;<span class="stringliteral">&quot;)&quot;</span>);</div><div class="line"><a name="l02753"></a><span class="lineno"> 2753</span>&#160;</div><div class="line"><a name="l02754"></a><span class="lineno"> 2754</span>&#160;   <span class="comment">// Schedule it</span></div><div class="line"><a name="l02755"></a><span class="lineno"> 2755</span>&#160;   <a class="code" href="classXrdProofdProofServMgr.html#a86cac591a5646811e38ff6a2477f4da7">fMgr</a>-&gt;<a class="code" href="classXrdProofdManager.html#abd140a5d84efcad2bceb7fef7356d16e">Sched</a>()-&gt;Schedule((XrdJob *)linkpsrv);</div><div class="line"><a name="l02756"></a><span class="lineno"> 2756</span>&#160;</div><div class="line"><a name="l02757"></a><span class="lineno"> 2757</span>&#160;   <span class="comment">// Save the protocol in the session instance</span></div><div class="line"><a name="l02758"></a><span class="lineno"> 2758</span>&#160;   xps-&gt;<a class="code" href="classXrdProofdProofServ.html#a70449875c8de76c6ac32f14020c0f94b">SetProtocol</a>((<a class="code" href="classXrdProofdProtocol.html">XrdProofdProtocol</a> *)xp);</div><div class="line"><a name="l02759"></a><span class="lineno"> 2759</span>&#160;</div><div class="line"><a name="l02760"></a><span class="lineno"> 2760</span>&#160;   <span class="comment">// Done</span></div><div class="line"><a name="l02761"></a><span class="lineno"> 2761</span>&#160;   <span class="keywordflow">return</span> 0;</div><div class="line"><a name="l02762"></a><span class="lineno"> 2762</span>&#160;}</div><div class="line"><a name="l02763"></a><span class="lineno"> 2763</span>&#160;</div><div class="line"><a name="l02764"></a><span class="lineno"> 2764</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l02765"></a><span class="lineno"> 2765</span>&#160;<span class="comment"></span></div><div class="line"><a name="l02766"></a><span class="lineno"> 2766</span>&#160;<span class="comment">////////////////////////////////////////////////////////////////////////////////</span></div><div class="line"><a name="l02767"></a><span class="lineno"> 2767</span>&#160;<span class="comment">/// Handle a request to detach from an existing session</span></div><div class="line"><a name="l02768"></a><span class="lineno"> 2768</span>&#160;<span class="comment"></span></div><div class="line"><a name="l02769"></a><span class="lineno"><a class="line" href="classXrdProofdProofServMgr.html#a21d2bc568b3bc3611b359d56e6f24da2"> 2769</a></span>&#160;<span class="keywordtype">int</span> <a class="code" href="classXrdProofdProofServMgr.html#a21d2bc568b3bc3611b359d56e6f24da2">XrdProofdProofServMgr::Detach</a>(<a class="code" href="classXrdProofdProtocol.html">XrdProofdProtocol</a> *p)</div><div class="line"><a name="l02770"></a><span class="lineno"> 2770</span>&#160;{</div><div class="line"><a name="l02771"></a><span class="lineno"> 2771</span>&#160;   <a class="code" href="XrdProofdTrace_8h.html#a7c31822912a8d0dc9bfd544097b29e12">XPDLOC</a>(SMGR, <span class="stringliteral">&quot;ProofServMgr::Detach&quot;</span>)</div><div class="line"><a name="l02772"></a><span class="lineno"> 2772</span>&#160;</div><div class="line"><a name="l02773"></a><span class="lineno"> 2773</span>&#160;   <span class="keywordtype">int</span> psid = -1, rc = 0;</div><div class="line"><a name="l02774"></a><span class="lineno"> 2774</span>&#160;   <a class="code" href="XrdProofdProtocol_8h.html#a877c158bc5a36171e7e5a4be25f6b4cb">XPD_SETRESP</a>(p, <span class="stringliteral">&quot;Detach&quot;</span>);</div><div class="line"><a name="l02775"></a><span class="lineno"> 2775</span>&#160;</div><div class="line"><a name="l02776"></a><span class="lineno"> 2776</span>&#160;   <span class="comment">// Unmarshall the data</span></div><div class="line"><a name="l02777"></a><span class="lineno"> 2777</span>&#160;   psid = ntohl(p-&gt;<a class="code" href="classXrdProofdProtocol.html#a279527394516a18ef610489a4ab1ddfd">Request</a>()-&gt;<a class="code" href="unionXPClientRequest.html#a86d728b0d38bc6ff0b92a9fb0b69bd0c">proof</a>.<a class="code" href="structXPClientProofRequest.html#a8aa8a8c9f18a796682b3ef3f787493fa">sid</a>);</div><div class="line"><a name="l02778"></a><span class="lineno"> 2778</span>&#160;   <a class="code" href="XrdProofdTrace_8h.html#a83f50a6ac1ca86524725ed11340e3b26">TRACEP</a>(p, REQ, <span class="stringliteral">&quot;psid: &quot;</span>&lt;&lt;psid);</div><div class="line"><a name="l02779"></a><span class="lineno"> 2779</span>&#160;</div><div class="line"><a name="l02780"></a><span class="lineno"> 2780</span>&#160;   <span class="comment">// Find server session</span></div><div class="line"><a name="l02781"></a><span class="lineno"> 2781</span>&#160;   <a class="code" href="classXrdProofdProofServ.html">XrdProofdProofServ</a> *xps = 0;</div><div class="line"><a name="l02782"></a><span class="lineno"> 2782</span>&#160;   <span class="keywordflow">if</span> (!p-&gt;<a class="code" href="classXrdProofdProtocol.html#a80024c8f848d0eabe9f13d09f06c8d9d">Client</a>() || !(xps = p-&gt;<a class="code" href="classXrdProofdProtocol.html#a80024c8f848d0eabe9f13d09f06c8d9d">Client</a>()-&gt;<a class="code" href="classXrdProofdClient.html#aa9d71c8c1536b1998a8d28e9cfb3b363">GetServer</a>(psid))) {</div><div class="line"><a name="l02783"></a><span class="lineno"> 2783</span>&#160;      <a class="code" href="XrdProofdTrace_8h.html#a83f50a6ac1ca86524725ed11340e3b26">TRACEP</a>(p, XERR, <span class="stringliteral">&quot;session ID not found: &quot;</span>&lt;&lt;psid);</div><div class="line"><a name="l02784"></a><span class="lineno"> 2784</span>&#160;      response-&gt;Send(kXR_InvalidRequest,<span class="stringliteral">&quot;session ID not found&quot;</span>);</div><div class="line"><a name="l02785"></a><span class="lineno"> 2785</span>&#160;      <span class="keywordflow">return</span> 0;</div><div class="line"><a name="l02786"></a><span class="lineno"> 2786</span>&#160;   }</div><div class="line"><a name="l02787"></a><span class="lineno"> 2787</span>&#160;   xps-&gt;<a class="code" href="classXrdProofdProofServ.html#a99d955e6c5f17b28834e881be71b1f79">FreeClientID</a>(p-&gt;<a class="code" href="classXrdProofdProtocol.html#afa853dd9e1f2cfca4d3e7650cbd42a98">Pid</a>());</div><div class="line"><a name="l02788"></a><span class="lineno"> 2788</span>&#160;</div><div class="line"><a name="l02789"></a><span class="lineno"> 2789</span>&#160;   <span class="comment">// Notify to user</span></div><div class="line"><a name="l02790"></a><span class="lineno"> 2790</span>&#160;   response-&gt;Send();</div><div class="line"><a name="l02791"></a><span class="lineno"> 2791</span>&#160;</div><div class="line"><a name="l02792"></a><span class="lineno"> 2792</span>&#160;   <span class="keywordflow">return</span> 0;</div><div class="line"><a name="l02793"></a><span class="lineno"> 2793</span>&#160;}</div><div class="line"><a name="l02794"></a><span class="lineno"> 2794</span>&#160;<span class="comment"></span></div><div class="line"><a name="l02795"></a><span class="lineno"> 2795</span>&#160;<span class="comment">////////////////////////////////////////////////////////////////////////////////</span></div><div class="line"><a name="l02796"></a><span class="lineno"> 2796</span>&#160;<span class="comment">/// Handle a request to shutdown an existing session</span></div><div class="line"><a name="l02797"></a><span class="lineno"> 2797</span>&#160;<span class="comment"></span></div><div class="line"><a name="l02798"></a><span class="lineno"><a class="line" href="classXrdProofdProofServMgr.html#a0e92367d300d1b4fb4ef15f06a565161"> 2798</a></span>&#160;<span class="keywordtype">int</span> <a class="code" href="classXrdProofdProofServMgr.html#a0e92367d300d1b4fb4ef15f06a565161">XrdProofdProofServMgr::Destroy</a>(<a class="code" href="classXrdProofdProtocol.html">XrdProofdProtocol</a> *p)</div><div class="line"><a name="l02799"></a><span class="lineno"> 2799</span>&#160;{</div><div class="line"><a name="l02800"></a><span class="lineno"> 2800</span>&#160;   <a class="code" href="XrdProofdTrace_8h.html#a7c31822912a8d0dc9bfd544097b29e12">XPDLOC</a>(SMGR, <span class="stringliteral">&quot;ProofServMgr::Destroy&quot;</span>)</div><div class="line"><a name="l02801"></a><span class="lineno"> 2801</span>&#160;</div><div class="line"><a name="l02802"></a><span class="lineno"> 2802</span>&#160;   <span class="keywordtype">int</span> psid = -1, rc = 0;</div><div class="line"><a name="l02803"></a><span class="lineno"> 2803</span>&#160;   <a class="code" href="XrdProofdProtocol_8h.html#a877c158bc5a36171e7e5a4be25f6b4cb">XPD_SETRESP</a>(p, <span class="stringliteral">&quot;Destroy&quot;</span>);</div><div class="line"><a name="l02804"></a><span class="lineno"> 2804</span>&#160;</div><div class="line"><a name="l02805"></a><span class="lineno"> 2805</span>&#160;   <span class="comment">// Unmarshall the data</span></div><div class="line"><a name="l02806"></a><span class="lineno"> 2806</span>&#160;   psid = ntohl(p-&gt;<a class="code" href="classXrdProofdProtocol.html#a279527394516a18ef610489a4ab1ddfd">Request</a>()-&gt;<a class="code" href="unionXPClientRequest.html#a86d728b0d38bc6ff0b92a9fb0b69bd0c">proof</a>.<a class="code" href="structXPClientProofRequest.html#a8aa8a8c9f18a796682b3ef3f787493fa">sid</a>);</div><div class="line"><a name="l02807"></a><span class="lineno"> 2807</span>&#160;   <a class="code" href="XrdProofdTrace_8h.html#a83f50a6ac1ca86524725ed11340e3b26">TRACEP</a>(p, REQ, <span class="stringliteral">&quot;psid: &quot;</span>&lt;&lt;psid);</div><div class="line"><a name="l02808"></a><span class="lineno"> 2808</span>&#160;</div><div class="line"><a name="l02809"></a><span class="lineno"> 2809</span>&#160;   XrdOucString msg;</div><div class="line"><a name="l02810"></a><span class="lineno"> 2810</span>&#160;</div><div class="line"><a name="l02811"></a><span class="lineno"> 2811</span>&#160;   <span class="comment">// Find server session</span></div><div class="line"><a name="l02812"></a><span class="lineno"> 2812</span>&#160;   <a class="code" href="classXrdProofdProofServ.html">XrdProofdProofServ</a> *xpsref = 0;</div><div class="line"><a name="l02813"></a><span class="lineno"> 2813</span>&#160;   <span class="keywordflow">if</span> (psid &gt; -1) {</div><div class="line"><a name="l02814"></a><span class="lineno"> 2814</span>&#160;      <span class="comment">// Request for a specific session</span></div><div class="line"><a name="l02815"></a><span class="lineno"> 2815</span>&#160;      <span class="keywordflow">if</span> (!p-&gt;<a class="code" href="classXrdProofdProtocol.html#a80024c8f848d0eabe9f13d09f06c8d9d">Client</a>() || !(xpsref = p-&gt;<a class="code" href="classXrdProofdProtocol.html#a80024c8f848d0eabe9f13d09f06c8d9d">Client</a>()-&gt;<a class="code" href="classXrdProofdClient.html#aa9d71c8c1536b1998a8d28e9cfb3b363">GetServer</a>(psid))) {</div><div class="line"><a name="l02816"></a><span class="lineno"> 2816</span>&#160;         <a class="code" href="XrdProofdTrace_8h.html#a83f50a6ac1ca86524725ed11340e3b26">TRACEP</a>(p, XERR, <span class="stringliteral">&quot;reference session ID not found&quot;</span>);</div><div class="line"><a name="l02817"></a><span class="lineno"> 2817</span>&#160;         response-&gt;Send(kXR_InvalidRequest,<span class="stringliteral">&quot;reference session ID not found&quot;</span>);</div><div class="line"><a name="l02818"></a><span class="lineno"> 2818</span>&#160;         <span class="keywordflow">return</span> 0;</div><div class="line"><a name="l02819"></a><span class="lineno"> 2819</span>&#160;      }</div><div class="line"><a name="l02820"></a><span class="lineno"> 2820</span>&#160;      <a class="code" href="XrdProofdAux_8h.html#a631cc8787af1a02d9e51c86117ae042e">XPDFORM</a>(msg, <span class="stringliteral">&quot;session %d destroyed by %s&quot;</span>, xpsref-&gt;<a class="code" href="classXrdProofdProofServ.html#a82ce7d276f54e6b4bb25430b738f7767">SrvPID</a>(), p-&gt;<a class="code" href="classXrdProofdProtocol.html#aff71b1d49b22d2453ed2a7302599de14">Link</a>()-&gt;ID);</div><div class="line"><a name="l02821"></a><span class="lineno"> 2821</span>&#160;   } <span class="keywordflow">else</span> {</div><div class="line"><a name="l02822"></a><span class="lineno"> 2822</span>&#160;      <a class="code" href="XrdProofdAux_8h.html#a631cc8787af1a02d9e51c86117ae042e">XPDFORM</a>(msg, <span class="stringliteral">&quot;all sessions destroyed by %s&quot;</span>, p-&gt;<a class="code" href="classXrdProofdProtocol.html#aff71b1d49b22d2453ed2a7302599de14">Link</a>()-&gt;ID);</div><div class="line"><a name="l02823"></a><span class="lineno"> 2823</span>&#160;   }</div><div class="line"><a name="l02824"></a><span class="lineno"> 2824</span>&#160;</div><div class="line"><a name="l02825"></a><span class="lineno"> 2825</span>&#160;   <span class="comment">// Terminate the servers</span></div><div class="line"><a name="l02826"></a><span class="lineno"> 2826</span>&#160;   p-&gt;<a class="code" href="classXrdProofdProtocol.html#a80024c8f848d0eabe9f13d09f06c8d9d">Client</a>()-&gt;<a class="code" href="classXrdProofdClient.html#a1ee033555eb136fd4b65d218bca1ad22">TerminateSessions</a>(<a class="code" href="XProofProtocol_8h.html#a727fb77180370df43315288005e23b99">kXPD_AnyServer</a>, xpsref,</div><div class="line"><a name="l02827"></a><span class="lineno"> 2827</span>&#160;                                  msg.c_str(), <a class="code" href="classXrdProofdProofServMgr.html#a2ad6176eb419d7edd51704580d006993">Pipe</a>(), <a class="code" href="classXrdProofdProofServMgr.html#a86cac591a5646811e38ff6a2477f4da7">fMgr</a>-&gt;<a class="code" href="classXrdProofdManager.html#a15d2e414e67bfc0cc4304605a6b509ff">ChangeOwn</a>());</div><div class="line"><a name="l02828"></a><span class="lineno"> 2828</span>&#160;</div><div class="line"><a name="l02829"></a><span class="lineno"> 2829</span>&#160;   <span class="comment">// Add to destroyed list</span></div><div class="line"><a name="l02830"></a><span class="lineno"> 2830</span>&#160;   <a class="code" href="classXrdProofdProofServMgr.html#aa105a86a4bc5264a668e0362164a3052">fDestroyTimes</a>[p] = time(0);</div><div class="line"><a name="l02831"></a><span class="lineno"> 2831</span>&#160;</div><div class="line"><a name="l02832"></a><span class="lineno"> 2832</span>&#160;   <span class="comment">// Notify to user</span></div><div class="line"><a name="l02833"></a><span class="lineno"> 2833</span>&#160;   response-&gt;Send();</div><div class="line"><a name="l02834"></a><span class="lineno"> 2834</span>&#160;</div><div class="line"><a name="l02835"></a><span class="lineno"> 2835</span>&#160;   <span class="comment">// Over</span></div><div class="line"><a name="l02836"></a><span class="lineno"> 2836</span>&#160;   <span class="keywordflow">return</span> 0;</div><div class="line"><a name="l02837"></a><span class="lineno"> 2837</span>&#160;}</div><div class="line"><a name="l02838"></a><span class="lineno"> 2838</span>&#160;<span class="comment"></span></div><div class="line"><a name="l02839"></a><span class="lineno"> 2839</span>&#160;<span class="comment">////////////////////////////////////////////////////////////////////////////////</span></div><div class="line"><a name="l02840"></a><span class="lineno"> 2840</span>&#160;<span class="comment">/// Run thorugh entries to broadcast the relevant priority</span></div><div class="line"><a name="l02841"></a><span class="lineno"> 2841</span>&#160;<span class="comment"></span></div><div class="line"><a name="l02842"></a><span class="lineno"><a class="line" href="XrdProofdProofServMgr_8cxx.html#a7f323ce62c469b18c22fc22f735b1bcb"> 2842</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="XrdProofdProofServMgr_8cxx.html#a7f323ce62c469b18c22fc22f735b1bcb">WriteSessEnvs</a>(<span class="keyword">const</span> <span class="keywordtype">char</span> *, <a class="code" href="classXpdEnv.html">XpdEnv</a> *env, <span class="keywordtype">void</span> *<a class="code" href="namespaceTGeant4Unit.html#a5d450e80998065902b102dca2a69066a">s</a>)</div><div class="line"><a name="l02843"></a><span class="lineno"> 2843</span>&#160;{</div><div class="line"><a name="l02844"></a><span class="lineno"> 2844</span>&#160;   <a class="code" href="XrdProofdTrace_8h.html#a7c31822912a8d0dc9bfd544097b29e12">XPDLOC</a>(SMGR, <span class="stringliteral">&quot;WriteSessEnvs&quot;</span>)</div><div class="line"><a name="l02845"></a><span class="lineno"> 2845</span>&#160;</div><div class="line"><a name="l02846"></a><span class="lineno"> 2846</span>&#160;   XrdOucString emsg;</div><div class="line"><a name="l02847"></a><span class="lineno"> 2847</span>&#160;</div><div class="line"><a name="l02848"></a><span class="lineno"> 2848</span>&#160;   XpdWriteEnv_t *xwe = (XpdWriteEnv_t *)<a class="code" href="namespaceTGeant4Unit.html#a5d450e80998065902b102dca2a69066a">s</a>;</div><div class="line"><a name="l02849"></a><span class="lineno"> 2849</span>&#160;</div><div class="line"><a name="l02850"></a><span class="lineno"> 2850</span>&#160;   <span class="keywordflow">if</span> (env &amp;&amp; xwe &amp;&amp; xwe-&gt;fMgr &amp;&amp; xwe-&gt;fClient &amp;&amp;  xwe-&gt;<a class="code" href="classXpdEnv.html#aff870adeeda5a3260f3b714db0467090">fEnv</a>) {</div><div class="line"><a name="l02851"></a><span class="lineno"> 2851</span>&#160;      <span class="keywordflow">if</span> (env-&gt;<a class="code" href="classXpdEnv.html#aff870adeeda5a3260f3b714db0467090">fEnv</a>.length() &gt; 0) {</div><div class="line"><a name="l02852"></a><span class="lineno"> 2852</span>&#160;         <span class="comment">// Resolve keywords</span></div><div class="line"><a name="l02853"></a><span class="lineno"> 2853</span>&#160;         xwe-&gt;fMgr-&gt;ResolveKeywords(env-&gt;<a class="code" href="classXpdEnv.html#aff870adeeda5a3260f3b714db0467090">fEnv</a>, xwe-&gt;fClient);</div><div class="line"><a name="l02854"></a><span class="lineno"> 2854</span>&#160;         <span class="comment">// Set the env now</span></div><div class="line"><a name="l02855"></a><span class="lineno"> 2855</span>&#160;         <span class="keywordtype">char</span> *ev = <span class="keyword">new</span> <span class="keywordtype">char</span>[env-&gt;<a class="code" href="classXpdEnv.html#aff870adeeda5a3260f3b714db0467090">fEnv</a>.length()+1];</div><div class="line"><a name="l02856"></a><span class="lineno"> 2856</span>&#160;         strncpy(ev, env-&gt;<a class="code" href="classXpdEnv.html#aff870adeeda5a3260f3b714db0467090">fEnv</a>.c_str(), env-&gt;<a class="code" href="classXpdEnv.html#aff870adeeda5a3260f3b714db0467090">fEnv</a>.length());</div><div class="line"><a name="l02857"></a><span class="lineno"> 2857</span>&#160;         ev[env-&gt;<a class="code" href="classXpdEnv.html#aff870adeeda5a3260f3b714db0467090">fEnv</a>.length()] = 0;</div><div class="line"><a name="l02858"></a><span class="lineno"> 2858</span>&#160;         fprintf(xwe-&gt;fEnv, <span class="stringliteral">&quot;%s\n&quot;</span>, ev);</div><div class="line"><a name="l02859"></a><span class="lineno"> 2859</span>&#160;         <a class="code" href="TGHtml_8h.html#ad5bb4a3d12fd54f29da2b924b29e652b">TRACE</a>(DBG, ev);</div><div class="line"><a name="l02860"></a><span class="lineno"> 2860</span>&#160;         <a class="code" href="XrdProofdProofServMgr_8cxx.html#a7cfa47f520ffb28d614134a05dc8cb14">PutEnv</a>(ev, xwe-&gt;fExport);</div><div class="line"><a name="l02861"></a><span class="lineno"> 2861</span>&#160;      }</div><div class="line"><a name="l02862"></a><span class="lineno"> 2862</span>&#160;      <span class="comment">// Go to next</span></div><div class="line"><a name="l02863"></a><span class="lineno"> 2863</span>&#160;      <span class="keywordflow">return</span> 0;</div><div class="line"><a name="l02864"></a><span class="lineno"> 2864</span>&#160;   } <span class="keywordflow">else</span> {</div><div class="line"><a name="l02865"></a><span class="lineno"> 2865</span>&#160;      emsg = <span class="stringliteral">&quot;some input undefined&quot;</span>;</div><div class="line"><a name="l02866"></a><span class="lineno"> 2866</span>&#160;   }</div><div class="line"><a name="l02867"></a><span class="lineno"> 2867</span>&#160;</div><div class="line"><a name="l02868"></a><span class="lineno"> 2868</span>&#160;   <span class="comment">// Some problem</span></div><div class="line"><a name="l02869"></a><span class="lineno"> 2869</span>&#160;   <a class="code" href="TGHtml_8h.html#ad5bb4a3d12fd54f29da2b924b29e652b">TRACE</a>(XERR,<span class="stringliteral">&quot;protocol error: &quot;</span>&lt;&lt;emsg);</div><div class="line"><a name="l02870"></a><span class="lineno"> 2870</span>&#160;   <span class="keywordflow">return</span> 1;</div><div class="line"><a name="l02871"></a><span class="lineno"> 2871</span>&#160;}</div><div class="line"><a name="l02872"></a><span class="lineno"> 2872</span>&#160;<span class="comment"></span></div><div class="line"><a name="l02873"></a><span class="lineno"> 2873</span>&#160;<span class="comment">////////////////////////////////////////////////////////////////////////////////</span></div><div class="line"><a name="l02874"></a><span class="lineno"> 2874</span>&#160;<span class="comment">/// Set environment for proofserv; old version preparing the environment for</span></div><div class="line"><a name="l02875"></a><span class="lineno"> 2875</span>&#160;<span class="comment">/// proofserv protocol version &lt;= 13. Needed for backward compatibility.</span></div><div class="line"><a name="l02876"></a><span class="lineno"> 2876</span>&#160;<span class="comment"></span></div><div class="line"><a name="l02877"></a><span class="lineno"><a class="line" href="classXrdProofdProofServMgr.html#a80371def99b5d2ca3f1bdf811aa6b2d8"> 2877</a></span>&#160;<span class="keywordtype">int</span> <a class="code" href="classXrdProofdProofServMgr.html#a80371def99b5d2ca3f1bdf811aa6b2d8">XrdProofdProofServMgr::SetProofServEnvOld</a>(<a class="code" href="classXrdProofdProtocol.html">XrdProofdProtocol</a> *p, <span class="keywordtype">void</span> *input)</div><div class="line"><a name="l02878"></a><span class="lineno"> 2878</span>&#160;{</div><div class="line"><a name="l02879"></a><span class="lineno"> 2879</span>&#160;   <a class="code" href="XrdProofdTrace_8h.html#a7c31822912a8d0dc9bfd544097b29e12">XPDLOC</a>(SMGR, <span class="stringliteral">&quot;ProofServMgr::SetProofServEnvOld&quot;</span>)</div><div class="line"><a name="l02880"></a><span class="lineno"> 2880</span>&#160;</div><div class="line"><a name="l02881"></a><span class="lineno"> 2881</span>&#160;   <span class="keywordtype">char</span> *ev = 0;</div><div class="line"><a name="l02882"></a><span class="lineno"> 2882</span>&#160;</div><div class="line"><a name="l02883"></a><span class="lineno"> 2883</span>&#160;   <span class="comment">// Check inputs</span></div><div class="line"><a name="l02884"></a><span class="lineno"> 2884</span>&#160;   <span class="keywordflow">if</span> (!p || !p-&gt;<a class="code" href="classXrdProofdProtocol.html#a80024c8f848d0eabe9f13d09f06c8d9d">Client</a>() || !input) {</div><div class="line"><a name="l02885"></a><span class="lineno"> 2885</span>&#160;      <a class="code" href="TGHtml_8h.html#ad5bb4a3d12fd54f29da2b924b29e652b">TRACE</a>(XERR, <span class="stringliteral">&quot;at leat one input is invalid - cannot continue&quot;</span>);</div><div class="line"><a name="l02886"></a><span class="lineno"> 2886</span>&#160;      <span class="keywordflow">return</span> -1;</div><div class="line"><a name="l02887"></a><span class="lineno"> 2887</span>&#160;   }</div><div class="line"><a name="l02888"></a><span class="lineno"> 2888</span>&#160;</div><div class="line"><a name="l02889"></a><span class="lineno"> 2889</span>&#160;   <span class="comment">// Set basic environment for proofserv</span></div><div class="line"><a name="l02890"></a><span class="lineno"> 2890</span>&#160;   <span class="keywordflow">if</span> (<a class="code" href="classXrdProofdProofServMgr.html#a4bb35d380da506fb49659f342b94ff55">SetProofServEnv</a>(<a class="code" href="classXrdProofdProofServMgr.html#a86cac591a5646811e38ff6a2477f4da7">fMgr</a>, p-&gt;<a class="code" href="classXrdProofdProtocol.html#a80024c8f848d0eabe9f13d09f06c8d9d">Client</a>()-&gt;<a class="code" href="classXrdProofdClient.html#a55c0e73c9bca2a64fd6417d750db02e2">ROOT</a>()) != 0) {</div><div class="line"><a name="l02891"></a><span class="lineno"> 2891</span>&#160;      <a class="code" href="TGHtml_8h.html#ad5bb4a3d12fd54f29da2b924b29e652b">TRACE</a>(XERR, <span class="stringliteral">&quot;problems setting basic environment - exit&quot;</span>);</div><div class="line"><a name="l02892"></a><span class="lineno"> 2892</span>&#160;      <span class="keywordflow">return</span> -1;</div><div class="line"><a name="l02893"></a><span class="lineno"> 2893</span>&#160;   }</div><div class="line"><a name="l02894"></a><span class="lineno"> 2894</span>&#160;</div><div class="line"><a name="l02895"></a><span class="lineno"> 2895</span>&#160;   <a class="code" href="structProofServEnv__t.html">ProofServEnv_t</a> *in = (<a class="code" href="structProofServEnv__t.html">ProofServEnv_t</a> *)input;</div><div class="line"><a name="l02896"></a><span class="lineno"> 2896</span>&#160;</div><div class="line"><a name="l02897"></a><span class="lineno"> 2897</span>&#160;   <span class="comment">// Session proxy</span></div><div class="line"><a name="l02898"></a><span class="lineno"> 2898</span>&#160;   <a class="code" href="classXrdProofdProofServ.html">XrdProofdProofServ</a> *xps = in-&gt;<a class="code" href="structProofServEnv__t.html#aefb8c17473f66fe63376b1956ba7ebfa">fPS</a>;</div><div class="line"><a name="l02899"></a><span class="lineno"> 2899</span>&#160;   <span class="keywordflow">if</span> (!xps) {</div><div class="line"><a name="l02900"></a><span class="lineno"> 2900</span>&#160;      <a class="code" href="TGHtml_8h.html#ad5bb4a3d12fd54f29da2b924b29e652b">TRACE</a>(XERR, <span class="stringliteral">&quot;unable to get instance of proofserv proxy&quot;</span>);</div><div class="line"><a name="l02901"></a><span class="lineno"> 2901</span>&#160;      <span class="keywordflow">return</span> -1;</div><div class="line"><a name="l02902"></a><span class="lineno"> 2902</span>&#160;   }</div><div class="line"><a name="l02903"></a><span class="lineno"> 2903</span>&#160;   <span class="keywordtype">int</span> psid = xps-&gt;<a class="code" href="classXrdProofdProofServ.html#aed92a8d3a8b058f1dcf56862365f1939">ID</a>();</div><div class="line"><a name="l02904"></a><span class="lineno"> 2904</span>&#160;   <a class="code" href="TGHtml_8h.html#ad5bb4a3d12fd54f29da2b924b29e652b">TRACE</a>(REQ,  <span class="stringliteral">&quot;psid: &quot;</span>&lt;&lt;psid&lt;&lt;<span class="stringliteral">&quot;, log: &quot;</span>&lt;&lt;in-&gt;<a class="code" href="structProofServEnv__t.html#ae56c69243c25974348f800a355305960">fLogLevel</a>);</div><div class="line"><a name="l02905"></a><span class="lineno"> 2905</span>&#160;</div><div class="line"><a name="l02906"></a><span class="lineno"> 2906</span>&#160;   <span class="comment">// Work directory</span></div><div class="line"><a name="l02907"></a><span class="lineno"> 2907</span>&#160;   XrdOucString udir = p-&gt;<a class="code" href="classXrdProofdProtocol.html#a80024c8f848d0eabe9f13d09f06c8d9d">Client</a>()-&gt;<a class="code" href="classXrdProofdClient.html#a8ea0bbb76949d36f85b223cab59db0d7">Sandbox</a>()-&gt;<a class="code" href="classXrdProofdSandbox.html#ad067010c4a92eee6dac2aa0dbc679bf4">Dir</a>();</div><div class="line"><a name="l02908"></a><span class="lineno"> 2908</span>&#160;   <a class="code" href="TGHtml_8h.html#ad5bb4a3d12fd54f29da2b924b29e652b">TRACE</a>(DBG, <span class="stringliteral">&quot;working dir for &quot;</span>&lt;&lt;p-&gt;<a class="code" href="classXrdProofdProtocol.html#a80024c8f848d0eabe9f13d09f06c8d9d">Client</a>()-&gt;<a class="code" href="classXrdProofdClient.html#a3cbe604999cdb44ae9d0ec833ffa5900">User</a>()&lt;&lt;<span class="stringliteral">&quot; is: &quot;</span>&lt;&lt;udir);</div><div class="line"><a name="l02909"></a><span class="lineno"> 2909</span>&#160;</div><div class="line"><a name="l02910"></a><span class="lineno"> 2910</span>&#160;   <span class="keywordtype">size_t</span> len = strlen(<span class="stringliteral">&quot;ROOTPROOFSESSDIR=&quot;</span>) + in-&gt;<a class="code" href="structProofServEnv__t.html#a24e0948cb1405b0d8c8360500ef20707">fWrkDir</a>.length() + 2;</div><div class="line"><a name="l02911"></a><span class="lineno"> 2911</span>&#160;   ev = <span class="keyword">new</span> <span class="keywordtype">char</span>[len];</div><div class="line"><a name="l02912"></a><span class="lineno"> 2912</span>&#160;   <a class="code" href="civetweb_8c.html#aa367b75c5aed883fef5befbdf04835a4">snprintf</a>(ev, len, <span class="stringliteral">&quot;ROOTPROOFSESSDIR=%s&quot;</span>, in-&gt;<a class="code" href="structProofServEnv__t.html#a24e0948cb1405b0d8c8360500ef20707">fWrkDir</a>.c_str());</div><div class="line"><a name="l02913"></a><span class="lineno"> 2913</span>&#160;   putenv(ev);</div><div class="line"><a name="l02914"></a><span class="lineno"> 2914</span>&#160;   <a class="code" href="TGHtml_8h.html#ad5bb4a3d12fd54f29da2b924b29e652b">TRACE</a>(DBG, ev);</div><div class="line"><a name="l02915"></a><span class="lineno"> 2915</span>&#160;</div><div class="line"><a name="l02916"></a><span class="lineno"> 2916</span>&#160;   <span class="comment">// Log level</span></div><div class="line"><a name="l02917"></a><span class="lineno"> 2917</span>&#160;   len = strlen(<span class="stringliteral">&quot;ROOTPROOFLOGLEVEL=&quot;</span>) + 5;</div><div class="line"><a name="l02918"></a><span class="lineno"> 2918</span>&#160;   ev = <span class="keyword">new</span> <span class="keywordtype">char</span>[len];</div><div class="line"><a name="l02919"></a><span class="lineno"> 2919</span>&#160;   <a class="code" href="civetweb_8c.html#aa367b75c5aed883fef5befbdf04835a4">snprintf</a>(ev, len, <span class="stringliteral">&quot;ROOTPROOFLOGLEVEL=%d&quot;</span>, in-&gt;<a class="code" href="structProofServEnv__t.html#ae56c69243c25974348f800a355305960">fLogLevel</a>);</div><div class="line"><a name="l02920"></a><span class="lineno"> 2920</span>&#160;   putenv(ev);</div><div class="line"><a name="l02921"></a><span class="lineno"> 2921</span>&#160;   <a class="code" href="TGHtml_8h.html#ad5bb4a3d12fd54f29da2b924b29e652b">TRACE</a>(DBG, ev);</div><div class="line"><a name="l02922"></a><span class="lineno"> 2922</span>&#160;</div><div class="line"><a name="l02923"></a><span class="lineno"> 2923</span>&#160;   <span class="comment">// Ordinal number</span></div><div class="line"><a name="l02924"></a><span class="lineno"> 2924</span>&#160;   len = strlen(<span class="stringliteral">&quot;ROOTPROOFORDINAL=&quot;</span>)+strlen(xps-&gt;<a class="code" href="classXrdProofdProofServ.html#a85958cf8241aee02a376befe6ab98e98">Ordinal</a>()) + 2;</div><div class="line"><a name="l02925"></a><span class="lineno"> 2925</span>&#160;   ev = <span class="keyword">new</span> <span class="keywordtype">char</span>[len];</div><div class="line"><a name="l02926"></a><span class="lineno"> 2926</span>&#160;   <a class="code" href="civetweb_8c.html#aa367b75c5aed883fef5befbdf04835a4">snprintf</a>(ev, len, <span class="stringliteral">&quot;ROOTPROOFORDINAL=%s&quot;</span>, xps-&gt;<a class="code" href="classXrdProofdProofServ.html#a85958cf8241aee02a376befe6ab98e98">Ordinal</a>());</div><div class="line"><a name="l02927"></a><span class="lineno"> 2927</span>&#160;   putenv(ev);</div><div class="line"><a name="l02928"></a><span class="lineno"> 2928</span>&#160;   <a class="code" href="TGHtml_8h.html#ad5bb4a3d12fd54f29da2b924b29e652b">TRACE</a>(DBG, ev);</div><div class="line"><a name="l02929"></a><span class="lineno"> 2929</span>&#160;</div><div class="line"><a name="l02930"></a><span class="lineno"> 2930</span>&#160;   <span class="comment">// ROOT Version tag if not the default one</span></div><div class="line"><a name="l02931"></a><span class="lineno"> 2931</span>&#160;   len = strlen(<span class="stringliteral">&quot;ROOTVERSIONTAG=&quot;</span>)+strlen(p-&gt;<a class="code" href="classXrdProofdProtocol.html#a80024c8f848d0eabe9f13d09f06c8d9d">Client</a>()-&gt;<a class="code" href="classXrdProofdClient.html#a55c0e73c9bca2a64fd6417d750db02e2">ROOT</a>()-&gt;<a class="code" href="classXrdROOT.html#a3b1e4b60cbd1b7fcd87a583a9e664b24">Tag</a>())+2;</div><div class="line"><a name="l02932"></a><span class="lineno"> 2932</span>&#160;   ev = <span class="keyword">new</span> <span class="keywordtype">char</span>[len];</div><div class="line"><a name="l02933"></a><span class="lineno"> 2933</span>&#160;   <a class="code" href="civetweb_8c.html#aa367b75c5aed883fef5befbdf04835a4">snprintf</a>(ev, len, <span class="stringliteral">&quot;ROOTVERSIONTAG=%s&quot;</span>, p-&gt;<a class="code" href="classXrdProofdProtocol.html#a80024c8f848d0eabe9f13d09f06c8d9d">Client</a>()-&gt;<a class="code" href="classXrdProofdClient.html#a55c0e73c9bca2a64fd6417d750db02e2">ROOT</a>()-&gt;<a class="code" href="classXrdROOT.html#a3b1e4b60cbd1b7fcd87a583a9e664b24">Tag</a>());</div><div class="line"><a name="l02934"></a><span class="lineno"> 2934</span>&#160;   putenv(ev);</div><div class="line"><a name="l02935"></a><span class="lineno"> 2935</span>&#160;   <a class="code" href="TGHtml_8h.html#ad5bb4a3d12fd54f29da2b924b29e652b">TRACE</a>(DBG, ev);</div><div class="line"><a name="l02936"></a><span class="lineno"> 2936</span>&#160;</div><div class="line"><a name="l02937"></a><span class="lineno"> 2937</span>&#160;   <span class="comment">// Create the env file</span></div><div class="line"><a name="l02938"></a><span class="lineno"> 2938</span>&#160;   <a class="code" href="TGHtml_8h.html#ad5bb4a3d12fd54f29da2b924b29e652b">TRACE</a>(DBG, <span class="stringliteral">&quot;creating env file&quot;</span>);</div><div class="line"><a name="l02939"></a><span class="lineno"> 2939</span>&#160;   XrdOucString envfile = in-&gt;<a class="code" href="structProofServEnv__t.html#a24e0948cb1405b0d8c8360500ef20707">fWrkDir</a>;</div><div class="line"><a name="l02940"></a><span class="lineno"> 2940</span>&#160;   envfile += <span class="stringliteral">&quot;.env&quot;</span>;</div><div class="line"><a name="l02941"></a><span class="lineno"> 2941</span>&#160;   FILE *fenv = fopen(envfile.c_str(), <span class="stringliteral">&quot;w&quot;</span>);</div><div class="line"><a name="l02942"></a><span class="lineno"> 2942</span>&#160;   <span class="keywordflow">if</span> (!fenv) {</div><div class="line"><a name="l02943"></a><span class="lineno"> 2943</span>&#160;      <a class="code" href="TGHtml_8h.html#ad5bb4a3d12fd54f29da2b924b29e652b">TRACE</a>(XERR,</div><div class="line"><a name="l02944"></a><span class="lineno"> 2944</span>&#160;                  <span class="stringliteral">&quot;unable to open env file: &quot;</span>&lt;&lt;envfile);</div><div class="line"><a name="l02945"></a><span class="lineno"> 2945</span>&#160;      <span class="keywordflow">return</span> -1;</div><div class="line"><a name="l02946"></a><span class="lineno"> 2946</span>&#160;   }</div><div class="line"><a name="l02947"></a><span class="lineno"> 2947</span>&#160;   <a class="code" href="TGHtml_8h.html#ad5bb4a3d12fd54f29da2b924b29e652b">TRACE</a>(DBG, <span class="stringliteral">&quot;environment file: &quot;</span>&lt;&lt; envfile);</div><div class="line"><a name="l02948"></a><span class="lineno"> 2948</span>&#160;</div><div class="line"><a name="l02949"></a><span class="lineno"> 2949</span>&#160;   <span class="comment">// Forwarded sec credentials, if any</span></div><div class="line"><a name="l02950"></a><span class="lineno"> 2950</span>&#160;   <span class="keywordflow">if</span> (p-&gt;<a class="code" href="classXrdProofdProtocol.html#a7aba904b9dbafda64fc01f1280eee7db">AuthProt</a>()) {</div><div class="line"><a name="l02951"></a><span class="lineno"> 2951</span>&#160;</div><div class="line"><a name="l02952"></a><span class="lineno"> 2952</span>&#160;      <span class="comment">// Additional envs possibly set by the protocol for next application</span></div><div class="line"><a name="l02953"></a><span class="lineno"> 2953</span>&#160;      XrdOucString secenvs(getenv(<span class="stringliteral">&quot;XrdSecENVS&quot;</span>));</div><div class="line"><a name="l02954"></a><span class="lineno"> 2954</span>&#160;      <span class="keywordflow">if</span> (secenvs.length() &gt; 0) {</div><div class="line"><a name="l02955"></a><span class="lineno"> 2955</span>&#160;         <span class="comment">// Go through the list</span></div><div class="line"><a name="l02956"></a><span class="lineno"> 2956</span>&#160;         XrdOucString env;</div><div class="line"><a name="l02957"></a><span class="lineno"> 2957</span>&#160;         <span class="keywordtype">int</span> from = 0;</div><div class="line"><a name="l02958"></a><span class="lineno"> 2958</span>&#160;         <span class="keywordflow">while</span> ((from = secenvs.tokenize(env, from, <span class="charliteral">&#39;,&#39;</span>)) != -1) {</div><div class="line"><a name="l02959"></a><span class="lineno"> 2959</span>&#160;            <span class="keywordflow">if</span> (env.length() &gt; 0) {</div><div class="line"><a name="l02960"></a><span class="lineno"> 2960</span>&#160;               <span class="comment">// Set the env now</span></div><div class="line"><a name="l02961"></a><span class="lineno"> 2961</span>&#160;               ev = <span class="keyword">new</span> <span class="keywordtype">char</span>[env.length()+1];</div><div class="line"><a name="l02962"></a><span class="lineno"> 2962</span>&#160;               strncpy(ev, env.c_str(), env.length());</div><div class="line"><a name="l02963"></a><span class="lineno"> 2963</span>&#160;               ev[env.length()] = 0;</div><div class="line"><a name="l02964"></a><span class="lineno"> 2964</span>&#160;               putenv(ev);</div><div class="line"><a name="l02965"></a><span class="lineno"> 2965</span>&#160;               fprintf(fenv, <span class="stringliteral">&quot;%s\n&quot;</span>, ev);</div><div class="line"><a name="l02966"></a><span class="lineno"> 2966</span>&#160;               <a class="code" href="TGHtml_8h.html#ad5bb4a3d12fd54f29da2b924b29e652b">TRACE</a>(DBG, ev);</div><div class="line"><a name="l02967"></a><span class="lineno"> 2967</span>&#160;            }</div><div class="line"><a name="l02968"></a><span class="lineno"> 2968</span>&#160;         }</div><div class="line"><a name="l02969"></a><span class="lineno"> 2969</span>&#160;      }</div><div class="line"><a name="l02970"></a><span class="lineno"> 2970</span>&#160;</div><div class="line"><a name="l02971"></a><span class="lineno"> 2971</span>&#160;      <span class="comment">// The credential buffer, if any</span></div><div class="line"><a name="l02972"></a><span class="lineno"> 2972</span>&#160;      XrdSecCredentials *creds = p-&gt;<a class="code" href="classXrdProofdProtocol.html#a7aba904b9dbafda64fc01f1280eee7db">AuthProt</a>()-&gt;getCredentials();</div><div class="line"><a name="l02973"></a><span class="lineno"> 2973</span>&#160;      <span class="keywordflow">if</span> (creds) {</div><div class="line"><a name="l02974"></a><span class="lineno"> 2974</span>&#160;         len = strlen(<span class="stringliteral">&quot;XrdSecCREDS=&quot;</span>)+creds-&gt;size;</div><div class="line"><a name="l02975"></a><span class="lineno"> 2975</span>&#160;         ev = <span class="keyword">new</span> <span class="keywordtype">char</span>[len + 1];</div><div class="line"><a name="l02976"></a><span class="lineno"> 2976</span>&#160;         strcpy(ev, <span class="stringliteral">&quot;XrdSecCREDS=&quot;</span>);</div><div class="line"><a name="l02977"></a><span class="lineno"> 2977</span>&#160;         memcpy(ev + strlen(<span class="stringliteral">&quot;XrdSecCREDS=&quot;</span>), creds-&gt;buffer, creds-&gt;size);</div><div class="line"><a name="l02978"></a><span class="lineno"> 2978</span>&#160;         ev[len] = 0;</div><div class="line"><a name="l02979"></a><span class="lineno"> 2979</span>&#160;         putenv(ev);</div><div class="line"><a name="l02980"></a><span class="lineno"> 2980</span>&#160;         <a class="code" href="TGHtml_8h.html#ad5bb4a3d12fd54f29da2b924b29e652b">TRACE</a>(DBG, <span class="stringliteral">&quot;XrdSecCREDS set&quot;</span>);</div><div class="line"><a name="l02981"></a><span class="lineno"> 2981</span>&#160;         <span class="keywordflow">if</span> (<a class="code" href="classXrdProofdProofServMgr.html#a7cb3d5c0d8bcb814202a15e354a5d92b">fCredsSaver</a>) {</div><div class="line"><a name="l02982"></a><span class="lineno"> 2982</span>&#160;            XrdOucString credsdir = udir;</div><div class="line"><a name="l02983"></a><span class="lineno"> 2983</span>&#160;            credsdir += <span class="stringliteral">&quot;/.creds&quot;</span>;</div><div class="line"><a name="l02984"></a><span class="lineno"> 2984</span>&#160;            <span class="comment">// Make sure the directory exists</span></div><div class="line"><a name="l02985"></a><span class="lineno"> 2985</span>&#160;            <span class="keywordflow">if</span> (!<a class="code" href="classXrdProofdAux.html#a3918ddc5c3912b017a3f7695ba5f3a40">XrdProofdAux::AssertDir</a>(credsdir.c_str(), p-&gt;<a class="code" href="classXrdProofdProtocol.html#a80024c8f848d0eabe9f13d09f06c8d9d">Client</a>()-&gt;<a class="code" href="classXrdProofdClient.html#a062a4396b4b8f0667f3a97a64c7f1c3d">UI</a>(), <a class="code" href="classXrdProofdProofServMgr.html#a86cac591a5646811e38ff6a2477f4da7">fMgr</a>-&gt;<a class="code" href="classXrdProofdManager.html#a15d2e414e67bfc0cc4304605a6b509ff">ChangeOwn</a>())) {</div><div class="line"><a name="l02986"></a><span class="lineno"> 2986</span>&#160;               <span class="keywordflow">if</span> ((*<a class="code" href="classXrdProofdProofServMgr.html#a7cb3d5c0d8bcb814202a15e354a5d92b">fCredsSaver</a>)(creds, credsdir.c_str(), p-&gt;<a class="code" href="classXrdProofdProtocol.html#a80024c8f848d0eabe9f13d09f06c8d9d">Client</a>()-&gt;<a class="code" href="classXrdProofdClient.html#a062a4396b4b8f0667f3a97a64c7f1c3d">UI</a>()) != 0) {</div><div class="line"><a name="l02987"></a><span class="lineno"> 2987</span>&#160;                  <a class="code" href="TGHtml_8h.html#ad5bb4a3d12fd54f29da2b924b29e652b">TRACE</a>(DBG, <span class="stringliteral">&quot;problems in saving authentication creds under &quot;</span>&lt;&lt;credsdir);</div><div class="line"><a name="l02988"></a><span class="lineno"> 2988</span>&#160;               }</div><div class="line"><a name="l02989"></a><span class="lineno"> 2989</span>&#160;            } <span class="keywordflow">else</span> {</div><div class="line"><a name="l02990"></a><span class="lineno"> 2990</span>&#160;               <a class="code" href="TGHtml_8h.html#ad5bb4a3d12fd54f29da2b924b29e652b">TRACE</a>(XERR, <span class="stringliteral">&quot;unable to create creds dir: &quot;</span>&lt;&lt;credsdir);</div><div class="line"><a name="l02991"></a><span class="lineno"> 2991</span>&#160;               fclose(fenv);</div><div class="line"><a name="l02992"></a><span class="lineno"> 2992</span>&#160;               <span class="keywordflow">return</span> -1;</div><div class="line"><a name="l02993"></a><span class="lineno"> 2993</span>&#160;            }</div><div class="line"><a name="l02994"></a><span class="lineno"> 2994</span>&#160;         }</div><div class="line"><a name="l02995"></a><span class="lineno"> 2995</span>&#160;      }</div><div class="line"><a name="l02996"></a><span class="lineno"> 2996</span>&#160;   }</div><div class="line"><a name="l02997"></a><span class="lineno"> 2997</span>&#160;</div><div class="line"><a name="l02998"></a><span class="lineno"> 2998</span>&#160;   <span class="comment">// Set ROOTSYS</span></div><div class="line"><a name="l02999"></a><span class="lineno"> 2999</span>&#160;   fprintf(fenv, <span class="stringliteral">&quot;ROOTSYS=%s\n&quot;</span>, xps-&gt;<a class="code" href="classXrdProofdProofServ.html#a18e4a17f4e9ef07f923b654e2d000148">ROOT</a>()-&gt;<a class="code" href="classXrdROOT.html#a51a773d135799c7a2604d8789f37f562">Dir</a>());</div><div class="line"><a name="l03000"></a><span class="lineno"> 3000</span>&#160;</div><div class="line"><a name="l03001"></a><span class="lineno"> 3001</span>&#160;   <span class="comment">// Set conf dir</span></div><div class="line"><a name="l03002"></a><span class="lineno"> 3002</span>&#160;   fprintf(fenv, <span class="stringliteral">&quot;ROOTCONFDIR=%s\n&quot;</span>, xps-&gt;<a class="code" href="classXrdProofdProofServ.html#a18e4a17f4e9ef07f923b654e2d000148">ROOT</a>()-&gt;<a class="code" href="classXrdROOT.html#a51a773d135799c7a2604d8789f37f562">Dir</a>());</div><div class="line"><a name="l03003"></a><span class="lineno"> 3003</span>&#160;</div><div class="line"><a name="l03004"></a><span class="lineno"> 3004</span>&#160;   <span class="comment">// Set TMPDIR</span></div><div class="line"><a name="l03005"></a><span class="lineno"> 3005</span>&#160;   fprintf(fenv, <span class="stringliteral">&quot;ROOTTMPDIR=%s\n&quot;</span>, <a class="code" href="classXrdProofdProofServMgr.html#a86cac591a5646811e38ff6a2477f4da7">fMgr</a>-&gt;<a class="code" href="classXrdProofdManager.html#a90aa36d30901b6766ef4a88be6610b6d">TMPdir</a>());</div><div class="line"><a name="l03006"></a><span class="lineno"> 3006</span>&#160;</div><div class="line"><a name="l03007"></a><span class="lineno"> 3007</span>&#160;   <span class="comment">// Port (really needed?)</span></div><div class="line"><a name="l03008"></a><span class="lineno"> 3008</span>&#160;   fprintf(fenv, <span class="stringliteral">&quot;ROOTXPDPORT=%d\n&quot;</span>, <a class="code" href="classXrdProofdProofServMgr.html#a86cac591a5646811e38ff6a2477f4da7">fMgr</a>-&gt;<a class="code" href="classXrdProofdManager.html#a128a9af44f04fdbf956b893c7a16d45b">Port</a>());</div><div class="line"><a name="l03009"></a><span class="lineno"> 3009</span>&#160;</div><div class="line"><a name="l03010"></a><span class="lineno"> 3010</span>&#160;   <span class="comment">// Work dir</span></div><div class="line"><a name="l03011"></a><span class="lineno"> 3011</span>&#160;   fprintf(fenv, <span class="stringliteral">&quot;ROOTPROOFWORKDIR=%s\n&quot;</span>, udir.c_str());</div><div class="line"><a name="l03012"></a><span class="lineno"> 3012</span>&#160;</div><div class="line"><a name="l03013"></a><span class="lineno"> 3013</span>&#160;   <span class="comment">// Session tag</span></div><div class="line"><a name="l03014"></a><span class="lineno"> 3014</span>&#160;   fprintf(fenv, <span class="stringliteral">&quot;ROOTPROOFSESSIONTAG=%s\n&quot;</span>, in-&gt;<a class="code" href="structProofServEnv__t.html#af4140705c69b78b2c0fd55131a0844dd">fSessionTag</a>.c_str());</div><div class="line"><a name="l03015"></a><span class="lineno"> 3015</span>&#160;</div><div class="line"><a name="l03016"></a><span class="lineno"> 3016</span>&#160;   <span class="comment">// Whether user specific config files are enabled</span></div><div class="line"><a name="l03017"></a><span class="lineno"> 3017</span>&#160;   <span class="keywordflow">if</span> (<a class="code" href="classXrdProofdProofServMgr.html#a86cac591a5646811e38ff6a2477f4da7">fMgr</a>-&gt;<a class="code" href="classXrdProofdManager.html#a597b5254d01ca1a0ad35e6e3b968426d">NetMgr</a>()-&gt;<a class="code" href="classXrdProofdNetMgr.html#a1bf0698adc9754833d617a1b2d7361ca">WorkerUsrCfg</a>())</div><div class="line"><a name="l03018"></a><span class="lineno"> 3018</span>&#160;      fprintf(fenv, <span class="stringliteral">&quot;ROOTUSEUSERCFG=1\n&quot;</span>);</div><div class="line"><a name="l03019"></a><span class="lineno"> 3019</span>&#160;</div><div class="line"><a name="l03020"></a><span class="lineno"> 3020</span>&#160;   <span class="comment">// Set Open socket</span></div><div class="line"><a name="l03021"></a><span class="lineno"> 3021</span>&#160;   fprintf(fenv, <span class="stringliteral">&quot;ROOTOPENSOCK=%s\n&quot;</span>, xps-&gt;<a class="code" href="classXrdProofdProofServ.html#adbac6b3286754cb303806f8d70e58765">UNIXSockPath</a>());</div><div class="line"><a name="l03022"></a><span class="lineno"> 3022</span>&#160;</div><div class="line"><a name="l03023"></a><span class="lineno"> 3023</span>&#160;   <span class="comment">// Entity</span></div><div class="line"><a name="l03024"></a><span class="lineno"> 3024</span>&#160;   fprintf(fenv, <span class="stringliteral">&quot;ROOTENTITY=%s@%s\n&quot;</span>, p-&gt;<a class="code" href="classXrdProofdProtocol.html#a80024c8f848d0eabe9f13d09f06c8d9d">Client</a>()-&gt;<a class="code" href="classXrdProofdClient.html#a3cbe604999cdb44ae9d0ec833ffa5900">User</a>(), p-&gt;<a class="code" href="classXrdProofdProtocol.html#aff71b1d49b22d2453ed2a7302599de14">Link</a>()-&gt;Host());</div><div class="line"><a name="l03025"></a><span class="lineno"> 3025</span>&#160;</div><div class="line"><a name="l03026"></a><span class="lineno"> 3026</span>&#160;   <span class="comment">// Session ID</span></div><div class="line"><a name="l03027"></a><span class="lineno"> 3027</span>&#160;   fprintf(fenv, <span class="stringliteral">&quot;ROOTSESSIONID=%d\n&quot;</span>, psid);</div><div class="line"><a name="l03028"></a><span class="lineno"> 3028</span>&#160;</div><div class="line"><a name="l03029"></a><span class="lineno"> 3029</span>&#160;   <span class="comment">// Client ID</span></div><div class="line"><a name="l03030"></a><span class="lineno"> 3030</span>&#160;   fprintf(fenv, <span class="stringliteral">&quot;ROOTCLIENTID=%d\n&quot;</span>, p-&gt;<a class="code" href="classXrdProofdProtocol.html#a934bd88037498a09c684297fca7b664f">CID</a>());</div><div class="line"><a name="l03031"></a><span class="lineno"> 3031</span>&#160;</div><div class="line"><a name="l03032"></a><span class="lineno"> 3032</span>&#160;   <span class="comment">// Client Protocol</span></div><div class="line"><a name="l03033"></a><span class="lineno"> 3033</span>&#160;   fprintf(fenv, <span class="stringliteral">&quot;ROOTPROOFCLNTVERS=%d\n&quot;</span>, p-&gt;<a class="code" href="classXrdProofdProtocol.html#a40b8bfa9e731284a08eee0d419b6ffd5">ProofProtocol</a>());</div><div class="line"><a name="l03034"></a><span class="lineno"> 3034</span>&#160;</div><div class="line"><a name="l03035"></a><span class="lineno"> 3035</span>&#160;   <span class="comment">// Ordinal number</span></div><div class="line"><a name="l03036"></a><span class="lineno"> 3036</span>&#160;   fprintf(fenv, <span class="stringliteral">&quot;ROOTPROOFORDINAL=%s\n&quot;</span>, xps-&gt;<a class="code" href="classXrdProofdProofServ.html#a85958cf8241aee02a376befe6ab98e98">Ordinal</a>());</div><div class="line"><a name="l03037"></a><span class="lineno"> 3037</span>&#160;</div><div class="line"><a name="l03038"></a><span class="lineno"> 3038</span>&#160;   <span class="comment">// ROOT version tag if different from the default one</span></div><div class="line"><a name="l03039"></a><span class="lineno"> 3039</span>&#160;   <span class="keywordflow">if</span> (getenv(<span class="stringliteral">&quot;ROOTVERSIONTAG&quot;</span>))</div><div class="line"><a name="l03040"></a><span class="lineno"> 3040</span>&#160;      fprintf(fenv, <span class="stringliteral">&quot;ROOTVERSIONTAG=%s\n&quot;</span>, getenv(<span class="stringliteral">&quot;ROOTVERSIONTAG&quot;</span>));</div><div class="line"><a name="l03041"></a><span class="lineno"> 3041</span>&#160;</div><div class="line"><a name="l03042"></a><span class="lineno"> 3042</span>&#160;   <span class="comment">// Config file</span></div><div class="line"><a name="l03043"></a><span class="lineno"> 3043</span>&#160;   <span class="keywordflow">if</span> (in-&gt;<a class="code" href="structProofServEnv__t.html#a68a3d979f6cccf40aaf61893f48461c1">fCfg</a>.length() &gt; 0)</div><div class="line"><a name="l03044"></a><span class="lineno"> 3044</span>&#160;      fprintf(fenv, <span class="stringliteral">&quot;ROOTPROOFCFGFILE=%s\n&quot;</span>, in-&gt;<a class="code" href="structProofServEnv__t.html#a68a3d979f6cccf40aaf61893f48461c1">fCfg</a>.c_str());</div><div class="line"><a name="l03045"></a><span class="lineno"> 3045</span>&#160;</div><div class="line"><a name="l03046"></a><span class="lineno"> 3046</span>&#160;   <span class="comment">// Log file in the log dir</span></div><div class="line"><a name="l03047"></a><span class="lineno"> 3047</span>&#160;   fprintf(fenv, <span class="stringliteral">&quot;ROOTPROOFLOGFILE=%s\n&quot;</span>, in-&gt;<a class="code" href="structProofServEnv__t.html#a88002c75764b173de52afd5f9b3c6c74">fLogFile</a>.c_str());</div><div class="line"><a name="l03048"></a><span class="lineno"> 3048</span>&#160;   xps-&gt;<a class="code" href="classXrdProofdProofServ.html#aa48a1e58fb1d7a0c0cefdb9ded292d07">SetFileout</a>(in-&gt;<a class="code" href="structProofServEnv__t.html#a88002c75764b173de52afd5f9b3c6c74">fLogFile</a>.c_str());</div><div class="line"><a name="l03049"></a><span class="lineno"> 3049</span>&#160;</div><div class="line"><a name="l03050"></a><span class="lineno"> 3050</span>&#160;   <span class="comment">// Additional envs (xpd.putenv directive)</span></div><div class="line"><a name="l03051"></a><span class="lineno"> 3051</span>&#160;   {  <a class="code" href="XrdSysToOuc_8h.html#a4ba18bedbb8a1a4367d57f49a4d773ce">XrdSysMutexHelper</a> mhp(<a class="code" href="classXrdProofdProofServMgr.html#af244f1c4fd9592313e3cfc4bdeb64aaf">fEnvsMutex</a>);</div><div class="line"><a name="l03052"></a><span class="lineno"> 3052</span>&#160;      <span class="keywordflow">if</span> (<a class="code" href="classXrdProofdProofServMgr.html#af99918358c943b44bb636cf70b97671e">fProofServEnvs</a>.size() &gt; 0) {</div><div class="line"><a name="l03053"></a><span class="lineno"> 3053</span>&#160;         <span class="comment">// Hash list of the directives applying to this {user, group, svn, version}</span></div><div class="line"><a name="l03054"></a><span class="lineno"> 3054</span>&#160;         XrdOucHash&lt;XpdEnv&gt; sessenvs;</div><div class="line"><a name="l03055"></a><span class="lineno"> 3055</span>&#160;         std::list&lt;XpdEnv&gt;::iterator ienvs = <a class="code" href="classXrdProofdProofServMgr.html#af99918358c943b44bb636cf70b97671e">fProofServEnvs</a>.begin();</div><div class="line"><a name="l03056"></a><span class="lineno"> 3056</span>&#160;         <span class="keywordflow">for</span> ( ; ienvs != <a class="code" href="classXrdProofdProofServMgr.html#af99918358c943b44bb636cf70b97671e">fProofServEnvs</a>.end(); ++ienvs) {</div><div class="line"><a name="l03057"></a><span class="lineno"> 3057</span>&#160;            <span class="keywordtype">int</span> envmatch = (*ienvs).Matches(p-&gt;<a class="code" href="classXrdProofdProtocol.html#a80024c8f848d0eabe9f13d09f06c8d9d">Client</a>()-&gt;<a class="code" href="classXrdProofdClient.html#a3cbe604999cdb44ae9d0ec833ffa5900">User</a>(), p-&gt;<a class="code" href="classXrdProofdProtocol.html#a80024c8f848d0eabe9f13d09f06c8d9d">Client</a>()-&gt;<a class="code" href="classXrdProofdClient.html#af82bc301c99dc688038ba2c771b5c49e">Group</a>(),</div><div class="line"><a name="l03058"></a><span class="lineno"> 3058</span>&#160;                                            p-&gt;<a class="code" href="classXrdProofdProtocol.html#a80024c8f848d0eabe9f13d09f06c8d9d">Client</a>()-&gt;<a class="code" href="classXrdProofdClient.html#a55c0e73c9bca2a64fd6417d750db02e2">ROOT</a>()-&gt;<a class="code" href="classXrdROOT.html#a8d85b526df3fbd35ee5d4daee3d6ab0b">VersionCode</a>());</div><div class="line"><a name="l03059"></a><span class="lineno"> 3059</span>&#160;            <span class="keywordflow">if</span> (envmatch &gt;= 0) {</div><div class="line"><a name="l03060"></a><span class="lineno"> 3060</span>&#160;               <a class="code" href="classXpdEnv.html">XpdEnv</a> *env = sessenvs.Find((*ienvs).fName.c_str());</div><div class="line"><a name="l03061"></a><span class="lineno"> 3061</span>&#160;               <span class="keywordflow">if</span> (env) {</div><div class="line"><a name="l03062"></a><span class="lineno"> 3062</span>&#160;                  <span class="keywordtype">int</span> envmtcex = env-&gt;<a class="code" href="classXpdEnv.html#a6bc4c90b8cc7074d6a8ee356c5de481d">Matches</a>(p-&gt;<a class="code" href="classXrdProofdProtocol.html#a80024c8f848d0eabe9f13d09f06c8d9d">Client</a>()-&gt;<a class="code" href="classXrdProofdClient.html#a3cbe604999cdb44ae9d0ec833ffa5900">User</a>(), p-&gt;<a class="code" href="classXrdProofdProtocol.html#a80024c8f848d0eabe9f13d09f06c8d9d">Client</a>()-&gt;<a class="code" href="classXrdProofdClient.html#af82bc301c99dc688038ba2c771b5c49e">Group</a>(),</div><div class="line"><a name="l03063"></a><span class="lineno"> 3063</span>&#160;                                              p-&gt;<a class="code" href="classXrdProofdProtocol.html#a80024c8f848d0eabe9f13d09f06c8d9d">Client</a>()-&gt;<a class="code" href="classXrdProofdClient.html#a55c0e73c9bca2a64fd6417d750db02e2">ROOT</a>()-&gt;<a class="code" href="classXrdROOT.html#a8d85b526df3fbd35ee5d4daee3d6ab0b">VersionCode</a>());</div><div class="line"><a name="l03064"></a><span class="lineno"> 3064</span>&#160;                  <span class="keywordflow">if</span> (envmatch &gt; envmtcex) {</div><div class="line"><a name="l03065"></a><span class="lineno"> 3065</span>&#160;                     <span class="comment">// Replace the entry</span></div><div class="line"><a name="l03066"></a><span class="lineno"> 3066</span>&#160;                     env = &amp;(*ienvs);</div><div class="line"><a name="l03067"></a><span class="lineno"> 3067</span>&#160;                     sessenvs.Rep(env-&gt;<a class="code" href="classXpdEnv.html#abe05770535de8187358d757e532da911">fName</a>.c_str(), env, 0, Hash_keepdata);</div><div class="line"><a name="l03068"></a><span class="lineno"> 3068</span>&#160;                  }</div><div class="line"><a name="l03069"></a><span class="lineno"> 3069</span>&#160;               } <span class="keywordflow">else</span> {</div><div class="line"><a name="l03070"></a><span class="lineno"> 3070</span>&#160;                  <span class="comment">// Add an entry</span></div><div class="line"><a name="l03071"></a><span class="lineno"> 3071</span>&#160;                  env = &amp;(*ienvs);</div><div class="line"><a name="l03072"></a><span class="lineno"> 3072</span>&#160;                  sessenvs.Add(env-&gt;<a class="code" href="classXpdEnv.html#abe05770535de8187358d757e532da911">fName</a>.c_str(), env, 0, Hash_keepdata);</div><div class="line"><a name="l03073"></a><span class="lineno"> 3073</span>&#160;               }</div><div class="line"><a name="l03074"></a><span class="lineno"> 3074</span>&#160;               <a class="code" href="TGHtml_8h.html#ad5bb4a3d12fd54f29da2b924b29e652b">TRACE</a>(HDBG, <span class="stringliteral">&quot;Adding: &quot;</span>&lt;&lt;(*ienvs).fEnv);</div><div class="line"><a name="l03075"></a><span class="lineno"> 3075</span>&#160;            }</div><div class="line"><a name="l03076"></a><span class="lineno"> 3076</span>&#160;         }</div><div class="line"><a name="l03077"></a><span class="lineno"> 3077</span>&#160;         XpdWriteEnv_t xpwe = {<a class="code" href="classXrdProofdProofServMgr.html#a86cac591a5646811e38ff6a2477f4da7">fMgr</a>, p-&gt;<a class="code" href="classXrdProofdProtocol.html#a80024c8f848d0eabe9f13d09f06c8d9d">Client</a>(), fenv, in-&gt;<a class="code" href="structProofServEnv__t.html#ac49c6760896eeec21cf83929ab709b92">fOld</a>};</div><div class="line"><a name="l03078"></a><span class="lineno"> 3078</span>&#160;         sessenvs.Apply(<a class="code" href="XrdProofdProofServMgr_8cxx.html#a7f323ce62c469b18c22fc22f735b1bcb">WriteSessEnvs</a>, (<span class="keywordtype">void</span> *)&amp;xpwe);</div><div class="line"><a name="l03079"></a><span class="lineno"> 3079</span>&#160;      }</div><div class="line"><a name="l03080"></a><span class="lineno"> 3080</span>&#160;   }</div><div class="line"><a name="l03081"></a><span class="lineno"> 3081</span>&#160;</div><div class="line"><a name="l03082"></a><span class="lineno"> 3082</span>&#160;   <span class="comment">// Set the user envs</span></div><div class="line"><a name="l03083"></a><span class="lineno"> 3083</span>&#160;   <span class="keywordflow">if</span> (xps-&gt;<a class="code" href="classXrdProofdProofServ.html#a065f2c13e9cec3b03b332003573f00b0">UserEnvs</a>() &amp;&amp;</div><div class="line"><a name="l03084"></a><span class="lineno"> 3084</span>&#160;       strlen(xps-&gt;<a class="code" href="classXrdProofdProofServ.html#a065f2c13e9cec3b03b332003573f00b0">UserEnvs</a>()) &amp;&amp; strstr(xps-&gt;<a class="code" href="classXrdProofdProofServ.html#a065f2c13e9cec3b03b332003573f00b0">UserEnvs</a>(),<span class="stringliteral">&quot;=&quot;</span>)) {</div><div class="line"><a name="l03085"></a><span class="lineno"> 3085</span>&#160;      <span class="comment">// The single components</span></div><div class="line"><a name="l03086"></a><span class="lineno"> 3086</span>&#160;      XrdOucString ue = xps-&gt;<a class="code" href="classXrdProofdProofServ.html#a065f2c13e9cec3b03b332003573f00b0">UserEnvs</a>();</div><div class="line"><a name="l03087"></a><span class="lineno"> 3087</span>&#160;      XrdOucString env, namelist;</div><div class="line"><a name="l03088"></a><span class="lineno"> 3088</span>&#160;      <span class="keywordtype">int</span> from = 0, ieq = -1;</div><div class="line"><a name="l03089"></a><span class="lineno"> 3089</span>&#160;      <span class="keywordflow">while</span> ((from = ue.tokenize(env, from, <span class="charliteral">&#39;,&#39;</span>)) != -1) {</div><div class="line"><a name="l03090"></a><span class="lineno"> 3090</span>&#160;         <span class="keywordflow">if</span> (env.length() &gt; 0 &amp;&amp; (ieq = env.find(<span class="charliteral">&#39;=&#39;</span>)) != -1) {</div><div class="line"><a name="l03091"></a><span class="lineno"> 3091</span>&#160;            <span class="comment">// Resolve keywords</span></div><div class="line"><a name="l03092"></a><span class="lineno"> 3092</span>&#160;            <a class="code" href="classXrdProofdProofServMgr.html#aefd6e4127ea5c75d9007762cb375adea">ResolveKeywords</a>(env, in);</div><div class="line"><a name="l03093"></a><span class="lineno"> 3093</span>&#160;            ev = <span class="keyword">new</span> <span class="keywordtype">char</span>[env.length()+1];</div><div class="line"><a name="l03094"></a><span class="lineno"> 3094</span>&#160;            strncpy(ev, env.c_str(), env.length());</div><div class="line"><a name="l03095"></a><span class="lineno"> 3095</span>&#160;            ev[env.length()] = 0;</div><div class="line"><a name="l03096"></a><span class="lineno"> 3096</span>&#160;            putenv(ev);</div><div class="line"><a name="l03097"></a><span class="lineno"> 3097</span>&#160;            fprintf(fenv, <span class="stringliteral">&quot;%s\n&quot;</span>, ev);</div><div class="line"><a name="l03098"></a><span class="lineno"> 3098</span>&#160;            <a class="code" href="TGHtml_8h.html#ad5bb4a3d12fd54f29da2b924b29e652b">TRACE</a>(DBG, ev);</div><div class="line"><a name="l03099"></a><span class="lineno"> 3099</span>&#160;            env.erase(ieq);</div><div class="line"><a name="l03100"></a><span class="lineno"> 3100</span>&#160;            <span class="keywordflow">if</span> (namelist.length() &gt; 0)</div><div class="line"><a name="l03101"></a><span class="lineno"> 3101</span>&#160;               namelist += <span class="charliteral">&#39;,&#39;</span>;</div><div class="line"><a name="l03102"></a><span class="lineno"> 3102</span>&#160;            namelist += env;</div><div class="line"><a name="l03103"></a><span class="lineno"> 3103</span>&#160;         }</div><div class="line"><a name="l03104"></a><span class="lineno"> 3104</span>&#160;      }</div><div class="line"><a name="l03105"></a><span class="lineno"> 3105</span>&#160;      <span class="comment">// The list of names, &#39;,&#39;-separated</span></div><div class="line"><a name="l03106"></a><span class="lineno"> 3106</span>&#160;      len = strlen(<span class="stringliteral">&quot;PROOF_ALLVARS=&quot;</span>) + namelist.length() + 2;</div><div class="line"><a name="l03107"></a><span class="lineno"> 3107</span>&#160;      ev = <span class="keyword">new</span> <span class="keywordtype">char</span>[len];</div><div class="line"><a name="l03108"></a><span class="lineno"> 3108</span>&#160;      <a class="code" href="civetweb_8c.html#aa367b75c5aed883fef5befbdf04835a4">snprintf</a>(ev, len, <span class="stringliteral">&quot;PROOF_ALLVARS=%s&quot;</span>, namelist.c_str());</div><div class="line"><a name="l03109"></a><span class="lineno"> 3109</span>&#160;      putenv(ev);</div><div class="line"><a name="l03110"></a><span class="lineno"> 3110</span>&#160;      fprintf(fenv, <span class="stringliteral">&quot;%s\n&quot;</span>, ev);</div><div class="line"><a name="l03111"></a><span class="lineno"> 3111</span>&#160;      <a class="code" href="TGHtml_8h.html#ad5bb4a3d12fd54f29da2b924b29e652b">TRACE</a>(DBG, ev);</div><div class="line"><a name="l03112"></a><span class="lineno"> 3112</span>&#160;   }</div><div class="line"><a name="l03113"></a><span class="lineno"> 3113</span>&#160;</div><div class="line"><a name="l03114"></a><span class="lineno"> 3114</span>&#160;   <span class="comment">// Close file</span></div><div class="line"><a name="l03115"></a><span class="lineno"> 3115</span>&#160;   fclose(fenv);</div><div class="line"><a name="l03116"></a><span class="lineno"> 3116</span>&#160;</div><div class="line"><a name="l03117"></a><span class="lineno"> 3117</span>&#160;   <span class="comment">// Create or Update symlink to last session</span></div><div class="line"><a name="l03118"></a><span class="lineno"> 3118</span>&#160;   <a class="code" href="TGHtml_8h.html#ad5bb4a3d12fd54f29da2b924b29e652b">TRACE</a>(DBG, <span class="stringliteral">&quot;creating symlink&quot;</span>);</div><div class="line"><a name="l03119"></a><span class="lineno"> 3119</span>&#160;   XrdOucString syml = udir;</div><div class="line"><a name="l03120"></a><span class="lineno"> 3120</span>&#160;   <span class="keywordflow">if</span> (p-&gt;<a class="code" href="classXrdProofdProtocol.html#a71898b7c3788b133364db067d1f47c24">ConnType</a>() == <a class="code" href="XProofProtocol_8h.html#ad7a933edf8c125412fd985f6f2bc771e">kXPD_MasterWorker</a>)</div><div class="line"><a name="l03121"></a><span class="lineno"> 3121</span>&#160;      syml += <span class="stringliteral">&quot;/last-worker-session&quot;</span>;</div><div class="line"><a name="l03122"></a><span class="lineno"> 3122</span>&#160;   <span class="keywordflow">else</span></div><div class="line"><a name="l03123"></a><span class="lineno"> 3123</span>&#160;      syml += <span class="stringliteral">&quot;/last-master-session&quot;</span>;</div><div class="line"><a name="l03124"></a><span class="lineno"> 3124</span>&#160;   <span class="keywordflow">if</span> (<a class="code" href="classXrdProofdAux.html#ad76b79992c4bb4774856074413f591c5">XrdProofdAux::SymLink</a>(in-&gt;<a class="code" href="structProofServEnv__t.html#a3a5c4ac123b8f92ad80003958476afbb">fSessionDir</a>.c_str(), syml.c_str()) != 0) {</div><div class="line"><a name="l03125"></a><span class="lineno"> 3125</span>&#160;      <a class="code" href="TGHtml_8h.html#ad5bb4a3d12fd54f29da2b924b29e652b">TRACE</a>(XERR, <span class="stringliteral">&quot;problems creating symlink to last session (errno: &quot;</span>&lt;&lt;errno&lt;&lt;<span class="stringliteral">&quot;)&quot;</span>);</div><div class="line"><a name="l03126"></a><span class="lineno"> 3126</span>&#160;   }</div><div class="line"><a name="l03127"></a><span class="lineno"> 3127</span>&#160;</div><div class="line"><a name="l03128"></a><span class="lineno"> 3128</span>&#160;   <span class="comment">// We are done</span></div><div class="line"><a name="l03129"></a><span class="lineno"> 3129</span>&#160;   <a class="code" href="TGHtml_8h.html#ad5bb4a3d12fd54f29da2b924b29e652b">TRACE</a>(DBG, <span class="stringliteral">&quot;done&quot;</span>);</div><div class="line"><a name="l03130"></a><span class="lineno"> 3130</span>&#160;   <span class="keywordflow">return</span> 0;</div><div class="line"><a name="l03131"></a><span class="lineno"> 3131</span>&#160;}</div><div class="line"><a name="l03132"></a><span class="lineno"> 3132</span>&#160;<span class="comment"></span></div><div class="line"><a name="l03133"></a><span class="lineno"> 3133</span>&#160;<span class="comment">////////////////////////////////////////////////////////////////////////////////</span></div><div class="line"><a name="l03134"></a><span class="lineno"> 3134</span>&#160;<span class="comment">/// Set basic environment accordingly to &#39;r&#39;</span></div><div class="line"><a name="l03135"></a><span class="lineno"> 3135</span>&#160;<span class="comment"></span></div><div class="line"><a name="l03136"></a><span class="lineno"><a class="line" href="classXrdProofdProofServMgr.html#afd9cf0339ec1a032d1b812487fa431eb"> 3136</a></span>&#160;<span class="keywordtype">int</span> <a class="code" href="classXrdProofdProofServMgr.html#a4bb35d380da506fb49659f342b94ff55">XrdProofdProofServMgr::SetProofServEnv</a>(<a class="code" href="classXrdProofdManager.html">XrdProofdManager</a> *mgr, <a class="code" href="classXrdROOT.html">XrdROOT</a> *<a class="code" href="Object_8C.html#ac15f01b9c6407e1312dfc196ad4e0870">r</a>)</div><div class="line"><a name="l03137"></a><span class="lineno"> 3137</span>&#160;{</div><div class="line"><a name="l03138"></a><span class="lineno"> 3138</span>&#160;   <a class="code" href="XrdProofdTrace_8h.html#a7c31822912a8d0dc9bfd544097b29e12">XPDLOC</a>(SMGR, <span class="stringliteral">&quot;ProofServMgr::SetProofServEnv&quot;</span>)</div><div class="line"><a name="l03139"></a><span class="lineno"> 3139</span>&#160;</div><div class="line"><a name="l03140"></a><span class="lineno"> 3140</span>&#160;   <span class="keywordtype">char</span> *ev = 0;</div><div class="line"><a name="l03141"></a><span class="lineno"> 3141</span>&#160;   <span class="keywordtype">size_t</span> len = 0;</div><div class="line"><a name="l03142"></a><span class="lineno"> 3142</span>&#160;</div><div class="line"><a name="l03143"></a><span class="lineno"> 3143</span>&#160;   <a class="code" href="TGHtml_8h.html#ad5bb4a3d12fd54f29da2b924b29e652b">TRACE</a>(REQ,  <span class="stringliteral">&quot;ROOT dir: &quot;</span>&lt;&lt; (<a class="code" href="Object_8C.html#ac15f01b9c6407e1312dfc196ad4e0870">r</a> ? <a class="code" href="Object_8C.html#ac15f01b9c6407e1312dfc196ad4e0870">r</a>-&gt;Dir() : <span class="stringliteral">&quot;*** undef ***&quot;</span>));</div><div class="line"><a name="l03144"></a><span class="lineno"> 3144</span>&#160;</div><div class="line"><a name="l03145"></a><span class="lineno"> 3145</span>&#160;   <span class="keywordflow">if</span> (<a class="code" href="Object_8C.html#ac15f01b9c6407e1312dfc196ad4e0870">r</a>) {</div><div class="line"><a name="l03146"></a><span class="lineno"> 3146</span>&#160;      <span class="keywordtype">char</span> *libdir = (<span class="keywordtype">char</span> *) <a class="code" href="Object_8C.html#ac15f01b9c6407e1312dfc196ad4e0870">r</a>-&gt;LibDir();</div><div class="line"><a name="l03147"></a><span class="lineno"> 3147</span>&#160;      <span class="keywordtype">char</span> *ldpath = 0;</div><div class="line"><a name="l03148"></a><span class="lineno"> 3148</span>&#160;      <span class="keywordflow">if</span> (mgr-&gt;<a class="code" href="classXrdProofdManager.html#a50da74836ad3c1b1e98e42209206f037">BareLibPath</a>() &amp;&amp; strlen(mgr-&gt;<a class="code" href="classXrdProofdManager.html#a50da74836ad3c1b1e98e42209206f037">BareLibPath</a>()) &gt; 0) {</div><div class="line"><a name="l03149"></a><span class="lineno"> 3149</span>&#160;         len = 32 + strlen(libdir) + strlen(mgr-&gt;<a class="code" href="classXrdProofdManager.html#a50da74836ad3c1b1e98e42209206f037">BareLibPath</a>());</div><div class="line"><a name="l03150"></a><span class="lineno"> 3150</span>&#160;         ldpath = <span class="keyword">new</span> <span class="keywordtype">char</span>[len];</div><div class="line"><a name="l03151"></a><span class="lineno"> 3151</span>&#160;         <a class="code" href="civetweb_8c.html#aa367b75c5aed883fef5befbdf04835a4">snprintf</a>(ldpath, len, <span class="stringliteral">&quot;%s=%s:%s&quot;</span>, <a class="code" href="XrdProofdPlatform_8h.html#aa5bbba6e125e30ab938354892fa73c30">XPD_LIBPATH</a>, libdir, mgr-&gt;<a class="code" href="classXrdProofdManager.html#a50da74836ad3c1b1e98e42209206f037">BareLibPath</a>());</div><div class="line"><a name="l03152"></a><span class="lineno"> 3152</span>&#160;      } <span class="keywordflow">else</span> {</div><div class="line"><a name="l03153"></a><span class="lineno"> 3153</span>&#160;         len = 32 + strlen(libdir);</div><div class="line"><a name="l03154"></a><span class="lineno"> 3154</span>&#160;         ldpath = <span class="keyword">new</span> <span class="keywordtype">char</span>[len];</div><div class="line"><a name="l03155"></a><span class="lineno"> 3155</span>&#160;         <a class="code" href="civetweb_8c.html#aa367b75c5aed883fef5befbdf04835a4">snprintf</a>(ldpath, len, <span class="stringliteral">&quot;%s=%s&quot;</span>, <a class="code" href="XrdProofdPlatform_8h.html#aa5bbba6e125e30ab938354892fa73c30">XPD_LIBPATH</a>, libdir);</div><div class="line"><a name="l03156"></a><span class="lineno"> 3156</span>&#160;      }</div><div class="line"><a name="l03157"></a><span class="lineno"> 3157</span>&#160;      putenv(ldpath);</div><div class="line"><a name="l03158"></a><span class="lineno"> 3158</span>&#160;      <span class="comment">// Set ROOTSYS</span></div><div class="line"><a name="l03159"></a><span class="lineno"> 3159</span>&#160;      <span class="keywordtype">char</span> *rootsys = (<span class="keywordtype">char</span> *) <a class="code" href="Object_8C.html#ac15f01b9c6407e1312dfc196ad4e0870">r</a>-&gt;Dir();</div><div class="line"><a name="l03160"></a><span class="lineno"> 3160</span>&#160;      len = 15 + strlen(rootsys);</div><div class="line"><a name="l03161"></a><span class="lineno"> 3161</span>&#160;      ev = <span class="keyword">new</span> <span class="keywordtype">char</span>[len];</div><div class="line"><a name="l03162"></a><span class="lineno"> 3162</span>&#160;      <a class="code" href="civetweb_8c.html#aa367b75c5aed883fef5befbdf04835a4">snprintf</a>(ev, len, <span class="stringliteral">&quot;ROOTSYS=%s&quot;</span>, rootsys);</div><div class="line"><a name="l03163"></a><span class="lineno"> 3163</span>&#160;      putenv(ev);</div><div class="line"><a name="l03164"></a><span class="lineno"> 3164</span>&#160;</div><div class="line"><a name="l03165"></a><span class="lineno"> 3165</span>&#160;      <span class="comment">// Set bin directory</span></div><div class="line"><a name="l03166"></a><span class="lineno"> 3166</span>&#160;      <span class="keywordtype">char</span> *bindir = (<span class="keywordtype">char</span> *) <a class="code" href="Object_8C.html#ac15f01b9c6407e1312dfc196ad4e0870">r</a>-&gt;BinDir();</div><div class="line"><a name="l03167"></a><span class="lineno"> 3167</span>&#160;      len = 15 + strlen(bindir);</div><div class="line"><a name="l03168"></a><span class="lineno"> 3168</span>&#160;      ev = <span class="keyword">new</span> <span class="keywordtype">char</span>[len];</div><div class="line"><a name="l03169"></a><span class="lineno"> 3169</span>&#160;      <a class="code" href="civetweb_8c.html#aa367b75c5aed883fef5befbdf04835a4">snprintf</a>(ev, len, <span class="stringliteral">&quot;ROOTBINDIR=%s&quot;</span>, bindir);</div><div class="line"><a name="l03170"></a><span class="lineno"> 3170</span>&#160;      putenv(ev);</div><div class="line"><a name="l03171"></a><span class="lineno"> 3171</span>&#160;</div><div class="line"><a name="l03172"></a><span class="lineno"> 3172</span>&#160;      <span class="comment">// Set conf dir</span></div><div class="line"><a name="l03173"></a><span class="lineno"> 3173</span>&#160;      <span class="keywordtype">char</span> *confdir = (<span class="keywordtype">char</span> *) <a class="code" href="Object_8C.html#ac15f01b9c6407e1312dfc196ad4e0870">r</a>-&gt;DataDir();</div><div class="line"><a name="l03174"></a><span class="lineno"> 3174</span>&#160;      len = 20 + strlen(confdir);</div><div class="line"><a name="l03175"></a><span class="lineno"> 3175</span>&#160;      ev = <span class="keyword">new</span> <span class="keywordtype">char</span>[len];</div><div class="line"><a name="l03176"></a><span class="lineno"> 3176</span>&#160;      <a class="code" href="civetweb_8c.html#aa367b75c5aed883fef5befbdf04835a4">snprintf</a>(ev, len, <span class="stringliteral">&quot;ROOTCONFDIR=%s&quot;</span>, confdir);</div><div class="line"><a name="l03177"></a><span class="lineno"> 3177</span>&#160;      putenv(ev);</div><div class="line"><a name="l03178"></a><span class="lineno"> 3178</span>&#160;</div><div class="line"><a name="l03179"></a><span class="lineno"> 3179</span>&#160;      <span class="comment">// Set TMPDIR</span></div><div class="line"><a name="l03180"></a><span class="lineno"> 3180</span>&#160;      len = 20 + strlen(mgr-&gt;<a class="code" href="classXrdProofdManager.html#a90aa36d30901b6766ef4a88be6610b6d">TMPdir</a>());</div><div class="line"><a name="l03181"></a><span class="lineno"> 3181</span>&#160;      ev = <span class="keyword">new</span> <span class="keywordtype">char</span>[len];</div><div class="line"><a name="l03182"></a><span class="lineno"> 3182</span>&#160;      <a class="code" href="civetweb_8c.html#aa367b75c5aed883fef5befbdf04835a4">snprintf</a>(ev, len, <span class="stringliteral">&quot;TMPDIR=%s&quot;</span>, mgr-&gt;<a class="code" href="classXrdProofdManager.html#a90aa36d30901b6766ef4a88be6610b6d">TMPdir</a>());</div><div class="line"><a name="l03183"></a><span class="lineno"> 3183</span>&#160;      putenv(ev);</div><div class="line"><a name="l03184"></a><span class="lineno"> 3184</span>&#160;</div><div class="line"><a name="l03185"></a><span class="lineno"> 3185</span>&#160;      <span class="comment">// Done</span></div><div class="line"><a name="l03186"></a><span class="lineno"> 3186</span>&#160;      <span class="keywordflow">return</span> 0;</div><div class="line"><a name="l03187"></a><span class="lineno"> 3187</span>&#160;   }</div><div class="line"><a name="l03188"></a><span class="lineno"> 3188</span>&#160;</div><div class="line"><a name="l03189"></a><span class="lineno"> 3189</span>&#160;   <span class="comment">// Bad input</span></div><div class="line"><a name="l03190"></a><span class="lineno"> 3190</span>&#160;   <a class="code" href="TGHtml_8h.html#ad5bb4a3d12fd54f29da2b924b29e652b">TRACE</a>(XERR, <span class="stringliteral">&quot;XrdROOT instance undefined!&quot;</span>);</div><div class="line"><a name="l03191"></a><span class="lineno"> 3191</span>&#160;   <span class="keywordflow">return</span> -1;</div><div class="line"><a name="l03192"></a><span class="lineno"> 3192</span>&#160;}</div><div class="line"><a name="l03193"></a><span class="lineno"> 3193</span>&#160;<span class="comment"></span></div><div class="line"><a name="l03194"></a><span class="lineno"> 3194</span>&#160;<span class="comment">////////////////////////////////////////////////////////////////////////////////</span></div><div class="line"><a name="l03195"></a><span class="lineno"> 3195</span>&#160;<span class="comment"></span></div><div class="line"><a name="l03196"></a><span class="lineno"><a class="line" href="classXrdProofdProofServMgr.html#a43977fa295e3c2755edcb43dd95de1de"> 3196</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="classXrdProofdProofServMgr.html#a43977fa295e3c2755edcb43dd95de1de">XrdProofdProofServMgr::FormFileNameInSessionDir</a>(<a class="code" href="classXrdProofdProtocol.html">XrdProofdProtocol</a> *p,</div><div class="line"><a name="l03197"></a><span class="lineno"> 3197</span>&#160;                                                     <a class="code" href="classXrdProofdProofServ.html">XrdProofdProofServ</a> *xps,</div><div class="line"><a name="l03198"></a><span class="lineno"> 3198</span>&#160;                                                     <span class="keyword">const</span> <span class="keywordtype">char</span> *sessiondir,</div><div class="line"><a name="l03199"></a><span class="lineno"> 3199</span>&#160;                                                     <span class="keyword">const</span> <span class="keywordtype">char</span> *<a class="code" href="civetweb_8c.html#a3a21b674a056eab8a11436300ae02d00">extension</a>,</div><div class="line"><a name="l03200"></a><span class="lineno"> 3200</span>&#160;                                                     XrdOucString &amp;outfn)</div><div class="line"><a name="l03201"></a><span class="lineno"> 3201</span>&#160;{</div><div class="line"><a name="l03202"></a><span class="lineno"> 3202</span>&#160;   XrdOucString host   = <a class="code" href="classXrdProofdProofServMgr.html#a86cac591a5646811e38ff6a2477f4da7">fMgr</a>-&gt;<a class="code" href="classXrdProofdManager.html#a3f8780d0a9d3fabe02aa01fe8ebbf5b5">Host</a>();</div><div class="line"><a name="l03203"></a><span class="lineno"> 3203</span>&#160;   XrdOucString ord    = xps-&gt;<a class="code" href="classXrdProofdProofServ.html#a85958cf8241aee02a376befe6ab98e98">Ordinal</a>();</div><div class="line"><a name="l03204"></a><span class="lineno"> 3204</span>&#160;   XrdOucString role;</div><div class="line"><a name="l03205"></a><span class="lineno"> 3205</span>&#160;</div><div class="line"><a name="l03206"></a><span class="lineno"> 3206</span>&#160;   <span class="comment">// Shorten host name</span></div><div class="line"><a name="l03207"></a><span class="lineno"> 3207</span>&#160;   <span class="keywordflow">if</span> (host.find(<span class="stringliteral">&quot;.&quot;</span>) != STR_NPOS)</div><div class="line"><a name="l03208"></a><span class="lineno"> 3208</span>&#160;      host.erase(host.find(<span class="stringliteral">&quot;.&quot;</span>));</div><div class="line"><a name="l03209"></a><span class="lineno"> 3209</span>&#160;</div><div class="line"><a name="l03210"></a><span class="lineno"> 3210</span>&#160;   <span class="keywordflow">if</span> (p-&gt;<a class="code" href="classXrdProofdProtocol.html#a71898b7c3788b133364db067d1f47c24">ConnType</a>() == <a class="code" href="XProofProtocol_8h.html#ad7a933edf8c125412fd985f6f2bc771e">kXPD_MasterWorker</a>) role = <span class="stringliteral">&quot;worker&quot;</span>;</div><div class="line"><a name="l03211"></a><span class="lineno"> 3211</span>&#160;   <span class="keywordflow">else</span> role = <span class="stringliteral">&quot;master&quot;</span>;</div><div class="line"><a name="l03212"></a><span class="lineno"> 3212</span>&#160;</div><div class="line"><a name="l03213"></a><span class="lineno"> 3213</span>&#160;   <span class="comment">// File name format:</span></div><div class="line"><a name="l03214"></a><span class="lineno"> 3214</span>&#160;   <span class="comment">// &lt;sessiondir&gt;/[master|worker]-&lt;ordinal&gt;-&lt;host&gt;.&lt;ext&gt;</span></div><div class="line"><a name="l03215"></a><span class="lineno"> 3215</span>&#160;   <span class="comment">// No PID is contained</span></div><div class="line"><a name="l03216"></a><span class="lineno"> 3216</span>&#160;   <a class="code" href="XrdProofdAux_8h.html#a631cc8787af1a02d9e51c86117ae042e">XPDFORM</a>(outfn, <span class="stringliteral">&quot;%s/%s-%s-%s.%s&quot;</span>,</div><div class="line"><a name="l03217"></a><span class="lineno"> 3217</span>&#160;      sessiondir,</div><div class="line"><a name="l03218"></a><span class="lineno"> 3218</span>&#160;      role.c_str(),</div><div class="line"><a name="l03219"></a><span class="lineno"> 3219</span>&#160;      ord.c_str(),</div><div class="line"><a name="l03220"></a><span class="lineno"> 3220</span>&#160;      host.c_str(),</div><div class="line"><a name="l03221"></a><span class="lineno"> 3221</span>&#160;      <a class="code" href="civetweb_8c.html#a3a21b674a056eab8a11436300ae02d00">extension</a></div><div class="line"><a name="l03222"></a><span class="lineno"> 3222</span>&#160;   );</div><div class="line"><a name="l03223"></a><span class="lineno"> 3223</span>&#160;}</div><div class="line"><a name="l03224"></a><span class="lineno"> 3224</span>&#160;<span class="comment"></span></div><div class="line"><a name="l03225"></a><span class="lineno"> 3225</span>&#160;<span class="comment">////////////////////////////////////////////////////////////////////////////////</span></div><div class="line"><a name="l03226"></a><span class="lineno"> 3226</span>&#160;<span class="comment">/// Determine the unique tag and relevant dirs for this session</span></div><div class="line"><a name="l03227"></a><span class="lineno"> 3227</span>&#160;<span class="comment"></span></div><div class="line"><a name="l03228"></a><span class="lineno"><a class="line" href="classXrdProofdProofServMgr.html#aabf69cec905249efe3d8375a2ef382dc"> 3228</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="classXrdProofdProofServMgr.html#aabf69cec905249efe3d8375a2ef382dc">XrdProofdProofServMgr::GetTagDirs</a>(<span class="keywordtype">int</span> pid,</div><div class="line"><a name="l03229"></a><span class="lineno"> 3229</span>&#160;                                       <a class="code" href="classXrdProofdProtocol.html">XrdProofdProtocol</a> *p, <a class="code" href="classXrdProofdProofServ.html">XrdProofdProofServ</a> *xps,</div><div class="line"><a name="l03230"></a><span class="lineno"> 3230</span>&#160;                                       XrdOucString &amp;sesstag, XrdOucString &amp;topsesstag,</div><div class="line"><a name="l03231"></a><span class="lineno"> 3231</span>&#160;                                       XrdOucString &amp;sessiondir, XrdOucString &amp;sesswrkdir)</div><div class="line"><a name="l03232"></a><span class="lineno"> 3232</span>&#160;{</div><div class="line"><a name="l03233"></a><span class="lineno"> 3233</span>&#160;   <a class="code" href="XrdProofdTrace_8h.html#a7c31822912a8d0dc9bfd544097b29e12">XPDLOC</a>(SMGR, <span class="stringliteral">&quot;GetTagDirs&quot;</span>)</div><div class="line"><a name="l03234"></a><span class="lineno"> 3234</span>&#160;</div><div class="line"><a name="l03235"></a><span class="lineno"> 3235</span>&#160;   <span class="comment">// Client sandbox</span></div><div class="line"><a name="l03236"></a><span class="lineno"> 3236</span>&#160;   XrdOucString udir = p-&gt;<a class="code" href="classXrdProofdProtocol.html#a80024c8f848d0eabe9f13d09f06c8d9d">Client</a>()-&gt;<a class="code" href="classXrdProofdClient.html#a8ea0bbb76949d36f85b223cab59db0d7">Sandbox</a>()-&gt;<a class="code" href="classXrdProofdSandbox.html#ad067010c4a92eee6dac2aa0dbc679bf4">Dir</a>();</div><div class="line"><a name="l03237"></a><span class="lineno"> 3237</span>&#160;</div><div class="line"><a name="l03238"></a><span class="lineno"> 3238</span>&#160;   <span class="keywordflow">if</span> (pid == 0) {</div><div class="line"><a name="l03239"></a><span class="lineno"> 3239</span>&#160;</div><div class="line"><a name="l03240"></a><span class="lineno"> 3240</span>&#160;      <span class="comment">// Create the unique tag identify this session</span></div><div class="line"><a name="l03241"></a><span class="lineno"> 3241</span>&#160;      XrdOucString host = <a class="code" href="classXrdProofdProofServMgr.html#a86cac591a5646811e38ff6a2477f4da7">fMgr</a>-&gt;<a class="code" href="classXrdProofdManager.html#a3f8780d0a9d3fabe02aa01fe8ebbf5b5">Host</a>();</div><div class="line"><a name="l03242"></a><span class="lineno"> 3242</span>&#160;      <span class="keywordflow">if</span> (host.find(<span class="stringliteral">&quot;.&quot;</span>) != STR_NPOS)</div><div class="line"><a name="l03243"></a><span class="lineno"> 3243</span>&#160;         host.erase(host.find(<span class="stringliteral">&quot;.&quot;</span>));</div><div class="line"><a name="l03244"></a><span class="lineno"> 3244</span>&#160;      <a class="code" href="XrdProofdAux_8h.html#a631cc8787af1a02d9e51c86117ae042e">XPDFORM</a>(sesstag, <span class="stringliteral">&quot;%s-%d-&quot;</span>, host.c_str(), (int)time(0));</div><div class="line"><a name="l03245"></a><span class="lineno"> 3245</span>&#160;</div><div class="line"><a name="l03246"></a><span class="lineno"> 3246</span>&#160;      <span class="comment">// Session dir</span></div><div class="line"><a name="l03247"></a><span class="lineno"> 3247</span>&#160;      sessiondir = udir;</div><div class="line"><a name="l03248"></a><span class="lineno"> 3248</span>&#160;      <span class="keywordflow">if</span> (p-&gt;<a class="code" href="classXrdProofdProtocol.html#a71898b7c3788b133364db067d1f47c24">ConnType</a>() == <a class="code" href="XProofProtocol_8h.html#a288e0bf1dc365d01a746a4917afec0a1">kXPD_ClientMaster</a>) {</div><div class="line"><a name="l03249"></a><span class="lineno"> 3249</span>&#160;         sessiondir += <span class="stringliteral">&quot;/session-&quot;</span>;</div><div class="line"><a name="l03250"></a><span class="lineno"> 3250</span>&#160;         sessiondir += sesstag;</div><div class="line"><a name="l03251"></a><span class="lineno"> 3251</span>&#160;         topsesstag = sesstag;</div><div class="line"><a name="l03252"></a><span class="lineno"> 3252</span>&#160;      } <span class="keywordflow">else</span> {</div><div class="line"><a name="l03253"></a><span class="lineno"> 3253</span>&#160;         sessiondir += <span class="stringliteral">&quot;/&quot;</span>;</div><div class="line"><a name="l03254"></a><span class="lineno"> 3254</span>&#160;         sessiondir += xps-&gt;<a class="code" href="classXrdProofdProofServ.html#af69a1e44057cb2b6b32fba74244c6ba1">Tag</a>();</div><div class="line"><a name="l03255"></a><span class="lineno"> 3255</span>&#160;         topsesstag = xps-&gt;<a class="code" href="classXrdProofdProofServ.html#af69a1e44057cb2b6b32fba74244c6ba1">Tag</a>();</div><div class="line"><a name="l03256"></a><span class="lineno"> 3256</span>&#160;         topsesstag.replace(<span class="stringliteral">&quot;session-&quot;</span>,<span class="stringliteral">&quot;&quot;</span>);</div><div class="line"><a name="l03257"></a><span class="lineno"> 3257</span>&#160;         <span class="comment">// If the child, make sure the directory exists ...</span></div><div class="line"><a name="l03258"></a><span class="lineno"> 3258</span>&#160;         <span class="keywordflow">if</span> (<a class="code" href="classXrdProofdAux.html#a3918ddc5c3912b017a3f7695ba5f3a40">XrdProofdAux::AssertDir</a>(sessiondir.c_str(), p-&gt;<a class="code" href="classXrdProofdProtocol.html#a80024c8f848d0eabe9f13d09f06c8d9d">Client</a>()-&gt;<a class="code" href="classXrdProofdClient.html#a062a4396b4b8f0667f3a97a64c7f1c3d">UI</a>(),</div><div class="line"><a name="l03259"></a><span class="lineno"> 3259</span>&#160;                                    <a class="code" href="classXrdProofdProofServMgr.html#a86cac591a5646811e38ff6a2477f4da7">fMgr</a>-&gt;<a class="code" href="classXrdProofdManager.html#a15d2e414e67bfc0cc4304605a6b509ff">ChangeOwn</a>()) == -1) {</div><div class="line"><a name="l03260"></a><span class="lineno"> 3260</span>&#160;            <a class="code" href="TGHtml_8h.html#ad5bb4a3d12fd54f29da2b924b29e652b">TRACE</a>(XERR, <span class="stringliteral">&quot;problems asserting dir &#39;&quot;</span>&lt;&lt;sessiondir&lt;&lt;<span class="stringliteral">&quot;&#39; - errno: &quot;</span>&lt;&lt;errno);</div><div class="line"><a name="l03261"></a><span class="lineno"> 3261</span>&#160;            <span class="keywordflow">return</span>;</div><div class="line"><a name="l03262"></a><span class="lineno"> 3262</span>&#160;         }</div><div class="line"><a name="l03263"></a><span class="lineno"> 3263</span>&#160;      }</div><div class="line"><a name="l03264"></a><span class="lineno"> 3264</span>&#160;</div><div class="line"><a name="l03265"></a><span class="lineno"> 3265</span>&#160;   } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (pid &gt; 0) {</div><div class="line"><a name="l03266"></a><span class="lineno"> 3266</span>&#160;</div><div class="line"><a name="l03267"></a><span class="lineno"> 3267</span>&#160;      <span class="comment">// Finalize unique tag identifying this session</span></div><div class="line"><a name="l03268"></a><span class="lineno"> 3268</span>&#160;      sesstag += pid;</div><div class="line"><a name="l03269"></a><span class="lineno"> 3269</span>&#160;</div><div class="line"><a name="l03270"></a><span class="lineno"> 3270</span>&#160;      <span class="comment">// Session dir</span></div><div class="line"><a name="l03271"></a><span class="lineno"> 3271</span>&#160;      <span class="keywordflow">if</span> (p-&gt;<a class="code" href="classXrdProofdProtocol.html#a71898b7c3788b133364db067d1f47c24">ConnType</a>() == <a class="code" href="XProofProtocol_8h.html#a288e0bf1dc365d01a746a4917afec0a1">kXPD_ClientMaster</a>) {</div><div class="line"><a name="l03272"></a><span class="lineno"> 3272</span>&#160;         topsesstag = sesstag;</div><div class="line"><a name="l03273"></a><span class="lineno"> 3273</span>&#160;         sessiondir += pid;</div><div class="line"><a name="l03274"></a><span class="lineno"> 3274</span>&#160;         xps-&gt;<a class="code" href="classXrdProofdProofServ.html#a4b99be0402107389bc029cc36aba8e07">SetTag</a>(sesstag.c_str());</div><div class="line"><a name="l03275"></a><span class="lineno"> 3275</span>&#160;      }</div><div class="line"><a name="l03276"></a><span class="lineno"> 3276</span>&#160;</div><div class="line"><a name="l03277"></a><span class="lineno"> 3277</span>&#160;      <span class="comment">// If the child, make sure the directory exists ...</span></div><div class="line"><a name="l03278"></a><span class="lineno"> 3278</span>&#160;      <span class="keywordflow">if</span> (pid == (<span class="keywordtype">int</span>) getpid()) {</div><div class="line"><a name="l03279"></a><span class="lineno"> 3279</span>&#160;         <span class="keywordflow">if</span> (<a class="code" href="classXrdProofdAux.html#a3918ddc5c3912b017a3f7695ba5f3a40">XrdProofdAux::AssertDir</a>(sessiondir.c_str(), p-&gt;<a class="code" href="classXrdProofdProtocol.html#a80024c8f848d0eabe9f13d09f06c8d9d">Client</a>()-&gt;<a class="code" href="classXrdProofdClient.html#a062a4396b4b8f0667f3a97a64c7f1c3d">UI</a>(),</div><div class="line"><a name="l03280"></a><span class="lineno"> 3280</span>&#160;                                    <a class="code" href="classXrdProofdProofServMgr.html#a86cac591a5646811e38ff6a2477f4da7">fMgr</a>-&gt;<a class="code" href="classXrdProofdManager.html#a15d2e414e67bfc0cc4304605a6b509ff">ChangeOwn</a>()) == -1) {</div><div class="line"><a name="l03281"></a><span class="lineno"> 3281</span>&#160;            <span class="keywordflow">return</span>;</div><div class="line"><a name="l03282"></a><span class="lineno"> 3282</span>&#160;         }</div><div class="line"><a name="l03283"></a><span class="lineno"> 3283</span>&#160;      }</div><div class="line"><a name="l03284"></a><span class="lineno"> 3284</span>&#160;</div><div class="line"><a name="l03285"></a><span class="lineno"> 3285</span>&#160;      <span class="comment">// The session working dir depends on the role</span></div><div class="line"><a name="l03286"></a><span class="lineno"> 3286</span>&#160;      sesswrkdir = sessiondir;</div><div class="line"><a name="l03287"></a><span class="lineno"> 3287</span>&#160;      <span class="keywordflow">if</span> (p-&gt;<a class="code" href="classXrdProofdProtocol.html#a71898b7c3788b133364db067d1f47c24">ConnType</a>() == <a class="code" href="XProofProtocol_8h.html#ad7a933edf8c125412fd985f6f2bc771e">kXPD_MasterWorker</a>) {</div><div class="line"><a name="l03288"></a><span class="lineno"> 3288</span>&#160;         <a class="code" href="XrdProofdAux_8h.html#a631cc8787af1a02d9e51c86117ae042e">XPDFORM</a>(sesswrkdir, <span class="stringliteral">&quot;%s/worker-%s-%s&quot;</span>, sessiondir.c_str(), xps-&gt;<a class="code" href="classXrdProofdProofServ.html#a85958cf8241aee02a376befe6ab98e98">Ordinal</a>(), sesstag.c_str());</div><div class="line"><a name="l03289"></a><span class="lineno"> 3289</span>&#160;      } <span class="keywordflow">else</span> {</div><div class="line"><a name="l03290"></a><span class="lineno"> 3290</span>&#160;         <a class="code" href="XrdProofdAux_8h.html#a631cc8787af1a02d9e51c86117ae042e">XPDFORM</a>(sesswrkdir, <span class="stringliteral">&quot;%s/master-%s-%s&quot;</span>, sessiondir.c_str(), xps-&gt;<a class="code" href="classXrdProofdProofServ.html#a85958cf8241aee02a376befe6ab98e98">Ordinal</a>(), sesstag.c_str());</div><div class="line"><a name="l03291"></a><span class="lineno"> 3291</span>&#160;      }</div><div class="line"><a name="l03292"></a><span class="lineno"> 3292</span>&#160;   } <span class="keywordflow">else</span> {</div><div class="line"><a name="l03293"></a><span class="lineno"> 3293</span>&#160;      <a class="code" href="TGHtml_8h.html#ad5bb4a3d12fd54f29da2b924b29e652b">TRACE</a>(XERR, <span class="stringliteral">&quot;negative pid (&quot;</span>&lt;&lt;pid&lt;&lt;<span class="stringliteral">&quot;): should not have got here!&quot;</span>);</div><div class="line"><a name="l03294"></a><span class="lineno"> 3294</span>&#160;   }</div><div class="line"><a name="l03295"></a><span class="lineno"> 3295</span>&#160;</div><div class="line"><a name="l03296"></a><span class="lineno"> 3296</span>&#160;   <span class="comment">// Done</span></div><div class="line"><a name="l03297"></a><span class="lineno"> 3297</span>&#160;   <span class="keywordflow">return</span>;</div><div class="line"><a name="l03298"></a><span class="lineno"> 3298</span>&#160;}</div><div class="line"><a name="l03299"></a><span class="lineno"> 3299</span>&#160;<span class="comment"></span></div><div class="line"><a name="l03300"></a><span class="lineno"> 3300</span>&#160;<span class="comment">////////////////////////////////////////////////////////////////////////////////</span></div><div class="line"><a name="l03301"></a><span class="lineno"> 3301</span>&#160;<span class="comment">/// Run thorugh entries to broadcast the relevant priority</span></div><div class="line"><a name="l03302"></a><span class="lineno"> 3302</span>&#160;<span class="comment"></span></div><div class="line"><a name="l03303"></a><span class="lineno"><a class="line" href="XrdProofdProofServMgr_8cxx.html#a161fcc2ffe02d9e7e5fe72497b75f9a2"> 3303</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="XrdProofdProofServMgr_8cxx.html#a161fcc2ffe02d9e7e5fe72497b75f9a2">WriteSessRCs</a>(<span class="keyword">const</span> <span class="keywordtype">char</span> *, <a class="code" href="classXpdEnv.html">XpdEnv</a> *erc, <span class="keywordtype">void</span> *<a class="code" href="RSha256_8hxx.html#a357394e0f6f88c8a57bd893ab28dc8f8">f</a>)</div><div class="line"><a name="l03304"></a><span class="lineno"> 3304</span>&#160;{</div><div class="line"><a name="l03305"></a><span class="lineno"> 3305</span>&#160;   <a class="code" href="XrdProofdTrace_8h.html#a7c31822912a8d0dc9bfd544097b29e12">XPDLOC</a>(SMGR, <span class="stringliteral">&quot;WriteSessRCs&quot;</span>)</div><div class="line"><a name="l03306"></a><span class="lineno"> 3306</span>&#160;</div><div class="line"><a name="l03307"></a><span class="lineno"> 3307</span>&#160;   XrdOucString emsg;</div><div class="line"><a name="l03308"></a><span class="lineno"> 3308</span>&#160;   FILE *frc = (FILE *)<a class="code" href="RSha256_8hxx.html#a357394e0f6f88c8a57bd893ab28dc8f8">f</a>;</div><div class="line"><a name="l03309"></a><span class="lineno"> 3309</span>&#160;   <span class="keywordflow">if</span> (frc &amp;&amp; erc) {</div><div class="line"><a name="l03310"></a><span class="lineno"> 3310</span>&#160;      XrdOucString rc = erc-&gt;<a class="code" href="classXpdEnv.html#aff870adeeda5a3260f3b714db0467090">fEnv</a>;</div><div class="line"><a name="l03311"></a><span class="lineno"> 3311</span>&#160;      <span class="keywordflow">if</span> (rc.length() &gt; 0) {</div><div class="line"><a name="l03312"></a><span class="lineno"> 3312</span>&#160;         <span class="keywordflow">if</span> (rc.find(<span class="stringliteral">&quot;Proof.DataSetManager&quot;</span>) != STR_NPOS) {</div><div class="line"><a name="l03313"></a><span class="lineno"> 3313</span>&#160;            <a class="code" href="TGHtml_8h.html#ad5bb4a3d12fd54f29da2b924b29e652b">TRACE</a>(ALL,<span class="stringliteral">&quot;Proof.DataSetManager ignored: use xpd.datasetsrc to define dataset managers&quot;</span>);</div><div class="line"><a name="l03314"></a><span class="lineno"> 3314</span>&#160;         } <span class="keywordflow">else</span> {</div><div class="line"><a name="l03315"></a><span class="lineno"> 3315</span>&#160;            fprintf(frc, <span class="stringliteral">&quot;%s\n&quot;</span>, rc.c_str());</div><div class="line"><a name="l03316"></a><span class="lineno"> 3316</span>&#160;         }</div><div class="line"><a name="l03317"></a><span class="lineno"> 3317</span>&#160;      }</div><div class="line"><a name="l03318"></a><span class="lineno"> 3318</span>&#160;      <span class="comment">// Go to next</span></div><div class="line"><a name="l03319"></a><span class="lineno"> 3319</span>&#160;      <span class="keywordflow">return</span> 0;</div><div class="line"><a name="l03320"></a><span class="lineno"> 3320</span>&#160;   } <span class="keywordflow">else</span> {</div><div class="line"><a name="l03321"></a><span class="lineno"> 3321</span>&#160;      emsg = <span class="stringliteral">&quot;file or input entry undefined&quot;</span>;</div><div class="line"><a name="l03322"></a><span class="lineno"> 3322</span>&#160;   }</div><div class="line"><a name="l03323"></a><span class="lineno"> 3323</span>&#160;</div><div class="line"><a name="l03324"></a><span class="lineno"> 3324</span>&#160;   <span class="comment">// Some problem</span></div><div class="line"><a name="l03325"></a><span class="lineno"> 3325</span>&#160;   <a class="code" href="TGHtml_8h.html#ad5bb4a3d12fd54f29da2b924b29e652b">TRACE</a>(XERR,<span class="stringliteral">&quot;protocol error: &quot;</span>&lt;&lt;emsg);</div><div class="line"><a name="l03326"></a><span class="lineno"> 3326</span>&#160;   <span class="keywordflow">return</span> 1;</div><div class="line"><a name="l03327"></a><span class="lineno"> 3327</span>&#160;}</div><div class="line"><a name="l03328"></a><span class="lineno"> 3328</span>&#160;<span class="comment"></span></div><div class="line"><a name="l03329"></a><span class="lineno"> 3329</span>&#160;<span class="comment">////////////////////////////////////////////////////////////////////////////////</span></div><div class="line"><a name="l03330"></a><span class="lineno"> 3330</span>&#160;<span class="comment">/// Set environment for proofserv</span></div><div class="line"><a name="l03331"></a><span class="lineno"> 3331</span>&#160;<span class="comment"></span></div><div class="line"><a name="l03332"></a><span class="lineno"><a class="line" href="classXrdProofdProofServMgr.html#a4bb35d380da506fb49659f342b94ff55"> 3332</a></span>&#160;<span class="keywordtype">int</span> <a class="code" href="classXrdProofdProofServMgr.html#a4bb35d380da506fb49659f342b94ff55">XrdProofdProofServMgr::SetProofServEnv</a>(<a class="code" href="classXrdProofdProtocol.html">XrdProofdProtocol</a> *p, <span class="keywordtype">void</span> *input)</div><div class="line"><a name="l03333"></a><span class="lineno"> 3333</span>&#160;{</div><div class="line"><a name="l03334"></a><span class="lineno"> 3334</span>&#160;   <a class="code" href="XrdProofdTrace_8h.html#a7c31822912a8d0dc9bfd544097b29e12">XPDLOC</a>(SMGR, <span class="stringliteral">&quot;ProofServMgr::SetProofServEnv&quot;</span>)</div><div class="line"><a name="l03335"></a><span class="lineno"> 3335</span>&#160;</div><div class="line"><a name="l03336"></a><span class="lineno"> 3336</span>&#160;   <span class="comment">// Check inputs</span></div><div class="line"><a name="l03337"></a><span class="lineno"> 3337</span>&#160;   <span class="keywordflow">if</span> (!p || !p-&gt;<a class="code" href="classXrdProofdProtocol.html#a80024c8f848d0eabe9f13d09f06c8d9d">Client</a>() || !input) {</div><div class="line"><a name="l03338"></a><span class="lineno"> 3338</span>&#160;      <a class="code" href="TGHtml_8h.html#ad5bb4a3d12fd54f29da2b924b29e652b">TRACE</a>(XERR, <span class="stringliteral">&quot;at leat one input is invalid - cannot continue&quot;</span>);</div><div class="line"><a name="l03339"></a><span class="lineno"> 3339</span>&#160;      <span class="keywordflow">return</span> -1;</div><div class="line"><a name="l03340"></a><span class="lineno"> 3340</span>&#160;   }</div><div class="line"><a name="l03341"></a><span class="lineno"> 3341</span>&#160;</div><div class="line"><a name="l03342"></a><span class="lineno"> 3342</span>&#160;   <span class="comment">// Old proofservs expect different settings</span></div><div class="line"><a name="l03343"></a><span class="lineno"> 3343</span>&#160;   <span class="keywordtype">int</span> rootvers = p-&gt;<a class="code" href="classXrdProofdProtocol.html#a80024c8f848d0eabe9f13d09f06c8d9d">Client</a>()-&gt;<a class="code" href="classXrdProofdClient.html#a55c0e73c9bca2a64fd6417d750db02e2">ROOT</a>() ? p-&gt;<a class="code" href="classXrdProofdProtocol.html#a80024c8f848d0eabe9f13d09f06c8d9d">Client</a>()-&gt;<a class="code" href="classXrdProofdClient.html#a55c0e73c9bca2a64fd6417d750db02e2">ROOT</a>()-&gt;<a class="code" href="classXrdROOT.html#a9c3ee0a503928edaab2675dd4d6638b0">SrvProtVers</a>() : -1;</div><div class="line"><a name="l03344"></a><span class="lineno"> 3344</span>&#160;   <a class="code" href="TGHtml_8h.html#ad5bb4a3d12fd54f29da2b924b29e652b">TRACE</a>(DBG, <span class="stringliteral">&quot;rootvers: &quot;</span>&lt;&lt; rootvers);</div><div class="line"><a name="l03345"></a><span class="lineno"> 3345</span>&#160;   <span class="keywordflow">if</span> (rootvers &lt; 14 &amp;&amp; rootvers &gt; -1)</div><div class="line"><a name="l03346"></a><span class="lineno"> 3346</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="classXrdProofdProofServMgr.html#a80371def99b5d2ca3f1bdf811aa6b2d8">SetProofServEnvOld</a>(p, input);</div><div class="line"><a name="l03347"></a><span class="lineno"> 3347</span>&#160;</div><div class="line"><a name="l03348"></a><span class="lineno"> 3348</span>&#160;   <a class="code" href="structProofServEnv__t.html">ProofServEnv_t</a> *in = (<a class="code" href="structProofServEnv__t.html">ProofServEnv_t</a> *)input;</div><div class="line"><a name="l03349"></a><span class="lineno"> 3349</span>&#160;</div><div class="line"><a name="l03350"></a><span class="lineno"> 3350</span>&#160;   <span class="comment">// Session proxy</span></div><div class="line"><a name="l03351"></a><span class="lineno"> 3351</span>&#160;   <a class="code" href="classXrdProofdProofServ.html">XrdProofdProofServ</a> *xps = in-&gt;<a class="code" href="structProofServEnv__t.html#aefb8c17473f66fe63376b1956ba7ebfa">fPS</a>;</div><div class="line"><a name="l03352"></a><span class="lineno"> 3352</span>&#160;   <span class="keywordflow">if</span> (!xps) {</div><div class="line"><a name="l03353"></a><span class="lineno"> 3353</span>&#160;      <a class="code" href="TGHtml_8h.html#ad5bb4a3d12fd54f29da2b924b29e652b">TRACE</a>(XERR, <span class="stringliteral">&quot;unable to get instance of proofserv proxy&quot;</span>);</div><div class="line"><a name="l03354"></a><span class="lineno"> 3354</span>&#160;      <span class="keywordflow">return</span> -1;</div><div class="line"><a name="l03355"></a><span class="lineno"> 3355</span>&#160;   }</div><div class="line"><a name="l03356"></a><span class="lineno"> 3356</span>&#160;   <span class="keywordtype">int</span> psid = xps-&gt;<a class="code" href="classXrdProofdProofServ.html#aed92a8d3a8b058f1dcf56862365f1939">ID</a>();</div><div class="line"><a name="l03357"></a><span class="lineno"> 3357</span>&#160;   <a class="code" href="TGHtml_8h.html#ad5bb4a3d12fd54f29da2b924b29e652b">TRACE</a>(REQ,  <span class="stringliteral">&quot;psid: &quot;</span>&lt;&lt;psid&lt;&lt;<span class="stringliteral">&quot;, log: &quot;</span>&lt;&lt;in-&gt;<a class="code" href="structProofServEnv__t.html#ae56c69243c25974348f800a355305960">fLogLevel</a>);</div><div class="line"><a name="l03358"></a><span class="lineno"> 3358</span>&#160;</div><div class="line"><a name="l03359"></a><span class="lineno"> 3359</span>&#160;   <span class="comment">// Client sandbox</span></div><div class="line"><a name="l03360"></a><span class="lineno"> 3360</span>&#160;   XrdOucString udir = p-&gt;<a class="code" href="classXrdProofdProtocol.html#a80024c8f848d0eabe9f13d09f06c8d9d">Client</a>()-&gt;<a class="code" href="classXrdProofdClient.html#a8ea0bbb76949d36f85b223cab59db0d7">Sandbox</a>()-&gt;<a class="code" href="classXrdProofdSandbox.html#ad067010c4a92eee6dac2aa0dbc679bf4">Dir</a>();</div><div class="line"><a name="l03361"></a><span class="lineno"> 3361</span>&#160;   <a class="code" href="TGHtml_8h.html#ad5bb4a3d12fd54f29da2b924b29e652b">TRACE</a>(DBG, <span class="stringliteral">&quot;sandbox for &quot;</span>&lt;&lt;p-&gt;<a class="code" href="classXrdProofdProtocol.html#a80024c8f848d0eabe9f13d09f06c8d9d">Client</a>()-&gt;<a class="code" href="classXrdProofdClient.html#a3cbe604999cdb44ae9d0ec833ffa5900">User</a>()&lt;&lt;<span class="stringliteral">&quot; is: &quot;</span>&lt;&lt;udir);</div><div class="line"><a name="l03362"></a><span class="lineno"> 3362</span>&#160;   <a class="code" href="TGHtml_8h.html#ad5bb4a3d12fd54f29da2b924b29e652b">TRACE</a>(DBG, <span class="stringliteral">&quot;session unique tag &quot;</span>&lt;&lt;in-&gt;<a class="code" href="structProofServEnv__t.html#af4140705c69b78b2c0fd55131a0844dd">fSessionTag</a>);</div><div class="line"><a name="l03363"></a><span class="lineno"> 3363</span>&#160;   <a class="code" href="TGHtml_8h.html#ad5bb4a3d12fd54f29da2b924b29e652b">TRACE</a>(DBG, <span class="stringliteral">&quot;session dir &quot;</span> &lt;&lt; in-&gt;<a class="code" href="structProofServEnv__t.html#a3a5c4ac123b8f92ad80003958476afbb">fSessionDir</a>);</div><div class="line"><a name="l03364"></a><span class="lineno"> 3364</span>&#160;   <a class="code" href="TGHtml_8h.html#ad5bb4a3d12fd54f29da2b924b29e652b">TRACE</a>(DBG, <span class="stringliteral">&quot;session working dir:&quot;</span> &lt;&lt; in-&gt;<a class="code" href="structProofServEnv__t.html#a24e0948cb1405b0d8c8360500ef20707">fWrkDir</a>);</div><div class="line"><a name="l03365"></a><span class="lineno"> 3365</span>&#160;</div><div class="line"><a name="l03366"></a><span class="lineno"> 3366</span>&#160;   <span class="comment">// Log into the session it</span></div><div class="line"><a name="l03367"></a><span class="lineno"> 3367</span>&#160;   <span class="keywordflow">if</span> (<a class="code" href="classXrdProofdAux.html#a7a63defb9a91e1c09541856982af6d59">XrdProofdAux::ChangeToDir</a>(in-&gt;<a class="code" href="structProofServEnv__t.html#a3a5c4ac123b8f92ad80003958476afbb">fSessionDir</a>.c_str(), p-&gt;<a class="code" href="classXrdProofdProtocol.html#a80024c8f848d0eabe9f13d09f06c8d9d">Client</a>()-&gt;<a class="code" href="classXrdProofdClient.html#a062a4396b4b8f0667f3a97a64c7f1c3d">UI</a>(),</div><div class="line"><a name="l03368"></a><span class="lineno"> 3368</span>&#160;                                 <a class="code" href="classXrdProofdProofServMgr.html#a86cac591a5646811e38ff6a2477f4da7">fMgr</a>-&gt;<a class="code" href="classXrdProofdManager.html#a15d2e414e67bfc0cc4304605a6b509ff">ChangeOwn</a>()) != 0) {</div><div class="line"><a name="l03369"></a><span class="lineno"> 3369</span>&#160;      <a class="code" href="TGHtml_8h.html#ad5bb4a3d12fd54f29da2b924b29e652b">TRACE</a>(XERR, <span class="stringliteral">&quot;couldn&#39;t change directory to &quot;</span> &lt;&lt; in-&gt;<a class="code" href="structProofServEnv__t.html#a3a5c4ac123b8f92ad80003958476afbb">fSessionDir</a>);</div><div class="line"><a name="l03370"></a><span class="lineno"> 3370</span>&#160;      <span class="keywordflow">return</span> -1;</div><div class="line"><a name="l03371"></a><span class="lineno"> 3371</span>&#160;   }</div><div class="line"><a name="l03372"></a><span class="lineno"> 3372</span>&#160;</div><div class="line"><a name="l03373"></a><span class="lineno"> 3373</span>&#160;   <span class="comment">// Set basic environment for proofserv</span></div><div class="line"><a name="l03374"></a><span class="lineno"> 3374</span>&#160;   <span class="keywordflow">if</span> (<a class="code" href="classXrdProofdProofServMgr.html#a4bb35d380da506fb49659f342b94ff55">SetProofServEnv</a>(<a class="code" href="classXrdProofdProofServMgr.html#a86cac591a5646811e38ff6a2477f4da7">fMgr</a>, p-&gt;<a class="code" href="classXrdProofdProtocol.html#a80024c8f848d0eabe9f13d09f06c8d9d">Client</a>()-&gt;<a class="code" href="classXrdProofdClient.html#a55c0e73c9bca2a64fd6417d750db02e2">ROOT</a>()) != 0) {</div><div class="line"><a name="l03375"></a><span class="lineno"> 3375</span>&#160;      <a class="code" href="TGHtml_8h.html#ad5bb4a3d12fd54f29da2b924b29e652b">TRACE</a>(XERR, <span class="stringliteral">&quot;problems setting basic environment - exit&quot;</span>);</div><div class="line"><a name="l03376"></a><span class="lineno"> 3376</span>&#160;      <span class="keywordflow">return</span> -1;</div><div class="line"><a name="l03377"></a><span class="lineno"> 3377</span>&#160;   }</div><div class="line"><a name="l03378"></a><span class="lineno"> 3378</span>&#160;</div><div class="line"><a name="l03379"></a><span class="lineno"> 3379</span>&#160;   <span class="comment">// Create .rootrc and .env files</span></div><div class="line"><a name="l03380"></a><span class="lineno"> 3380</span>&#160;   <a class="code" href="TGHtml_8h.html#ad5bb4a3d12fd54f29da2b924b29e652b">TRACE</a>(DBG, <span class="stringliteral">&quot;creating rc and env files&quot;</span>);</div><div class="line"><a name="l03381"></a><span class="lineno"> 3381</span>&#160;   XrdOucString rcfile, envfile;</div><div class="line"><a name="l03382"></a><span class="lineno"> 3382</span>&#160;   <a class="code" href="classXrdProofdProofServMgr.html#a43977fa295e3c2755edcb43dd95de1de">FormFileNameInSessionDir</a>(p, xps, in-&gt;<a class="code" href="structProofServEnv__t.html#a3a5c4ac123b8f92ad80003958476afbb">fSessionDir</a>.c_str(), <span class="stringliteral">&quot;rootrc&quot;</span>, rcfile);</div><div class="line"><a name="l03383"></a><span class="lineno"> 3383</span>&#160;   <span class="keywordflow">if</span> (<a class="code" href="classXrdProofdProofServMgr.html#ae701527462f37bde60cef71f5570375f">CreateProofServRootRc</a>(p, in, rcfile.c_str()) != 0) {</div><div class="line"><a name="l03384"></a><span class="lineno"> 3384</span>&#160;      <a class="code" href="TGHtml_8h.html#ad5bb4a3d12fd54f29da2b924b29e652b">TRACE</a>(XERR, <span class="stringliteral">&quot;problems creating RC file &quot;</span>&lt;&lt;rcfile.c_str());</div><div class="line"><a name="l03385"></a><span class="lineno"> 3385</span>&#160;      <span class="keywordflow">return</span> -1;</div><div class="line"><a name="l03386"></a><span class="lineno"> 3386</span>&#160;   }</div><div class="line"><a name="l03387"></a><span class="lineno"> 3387</span>&#160;</div><div class="line"><a name="l03388"></a><span class="lineno"> 3388</span>&#160;   <a class="code" href="classXrdProofdProofServMgr.html#a43977fa295e3c2755edcb43dd95de1de">FormFileNameInSessionDir</a>(p, xps, in-&gt;<a class="code" href="structProofServEnv__t.html#a3a5c4ac123b8f92ad80003958476afbb">fSessionDir</a>.c_str(), <span class="stringliteral">&quot;env&quot;</span>, envfile);</div><div class="line"><a name="l03389"></a><span class="lineno"> 3389</span>&#160;   <span class="keywordflow">if</span> (<a class="code" href="classXrdProofdProofServMgr.html#a908238ada084a7362b6083e42c5b62f7">CreateProofServEnvFile</a>(p, in, envfile.c_str(), rcfile.c_str()) != 0) {</div><div class="line"><a name="l03390"></a><span class="lineno"> 3390</span>&#160;      <a class="code" href="TGHtml_8h.html#ad5bb4a3d12fd54f29da2b924b29e652b">TRACE</a>(XERR, <span class="stringliteral">&quot;problems creating environment file &quot;</span>&lt;&lt;envfile.c_str());</div><div class="line"><a name="l03391"></a><span class="lineno"> 3391</span>&#160;      <span class="keywordflow">return</span> -1;</div><div class="line"><a name="l03392"></a><span class="lineno"> 3392</span>&#160;   }</div><div class="line"><a name="l03393"></a><span class="lineno"> 3393</span>&#160;</div><div class="line"><a name="l03394"></a><span class="lineno"> 3394</span>&#160;   <span class="comment">// Create or Update symlink to last session</span></div><div class="line"><a name="l03395"></a><span class="lineno"> 3395</span>&#160;   <span class="keywordflow">if</span> (in-&gt;<a class="code" href="structProofServEnv__t.html#ac49c6760896eeec21cf83929ab709b92">fOld</a>) {</div><div class="line"><a name="l03396"></a><span class="lineno"> 3396</span>&#160;      <a class="code" href="TGHtml_8h.html#ad5bb4a3d12fd54f29da2b924b29e652b">TRACE</a>(REQ, <span class="stringliteral">&quot;creating symlink&quot;</span>);</div><div class="line"><a name="l03397"></a><span class="lineno"> 3397</span>&#160;      XrdOucString syml = udir;</div><div class="line"><a name="l03398"></a><span class="lineno"> 3398</span>&#160;      <span class="keywordflow">if</span> (p-&gt;<a class="code" href="classXrdProofdProtocol.html#a71898b7c3788b133364db067d1f47c24">ConnType</a>() == <a class="code" href="XProofProtocol_8h.html#ad7a933edf8c125412fd985f6f2bc771e">kXPD_MasterWorker</a>)</div><div class="line"><a name="l03399"></a><span class="lineno"> 3399</span>&#160;         syml += <span class="stringliteral">&quot;/last-worker-session&quot;</span>;</div><div class="line"><a name="l03400"></a><span class="lineno"> 3400</span>&#160;      <span class="keywordflow">else</span></div><div class="line"><a name="l03401"></a><span class="lineno"> 3401</span>&#160;         syml += <span class="stringliteral">&quot;/last-master-session&quot;</span>;</div><div class="line"><a name="l03402"></a><span class="lineno"> 3402</span>&#160;      <span class="keywordflow">if</span> (<a class="code" href="classXrdProofdAux.html#ad76b79992c4bb4774856074413f591c5">XrdProofdAux::SymLink</a>(in-&gt;<a class="code" href="structProofServEnv__t.html#a3a5c4ac123b8f92ad80003958476afbb">fSessionDir</a>.c_str(), syml.c_str()) != 0) {</div><div class="line"><a name="l03403"></a><span class="lineno"> 3403</span>&#160;         <a class="code" href="TGHtml_8h.html#ad5bb4a3d12fd54f29da2b924b29e652b">TRACE</a>(XERR, <span class="stringliteral">&quot;problems creating symlink to &quot;</span></div><div class="line"><a name="l03404"></a><span class="lineno"> 3404</span>&#160;                     <span class="stringliteral">&quot; last session (errno: &quot;</span>&lt;&lt;errno&lt;&lt;<span class="stringliteral">&quot;)&quot;</span>);</div><div class="line"><a name="l03405"></a><span class="lineno"> 3405</span>&#160;      }</div><div class="line"><a name="l03406"></a><span class="lineno"> 3406</span>&#160;   }</div><div class="line"><a name="l03407"></a><span class="lineno"> 3407</span>&#160;</div><div class="line"><a name="l03408"></a><span class="lineno"> 3408</span>&#160;   <span class="comment">// We are done</span></div><div class="line"><a name="l03409"></a><span class="lineno"> 3409</span>&#160;   <a class="code" href="TGHtml_8h.html#ad5bb4a3d12fd54f29da2b924b29e652b">TRACE</a>(REQ, <span class="stringliteral">&quot;done&quot;</span>);</div><div class="line"><a name="l03410"></a><span class="lineno"> 3410</span>&#160;   <span class="keywordflow">return</span> 0;</div><div class="line"><a name="l03411"></a><span class="lineno"> 3411</span>&#160;}</div><div class="line"><a name="l03412"></a><span class="lineno"> 3412</span>&#160;<span class="comment"></span></div><div class="line"><a name="l03413"></a><span class="lineno"> 3413</span>&#160;<span class="comment">////////////////////////////////////////////////////////////////////////////////</span></div><div class="line"><a name="l03414"></a><span class="lineno"> 3414</span>&#160;<span class="comment">/// Create in &#39;rcfn&#39; the rootrc file for the proofserv being created</span></div><div class="line"><a name="l03415"></a><span class="lineno"> 3415</span>&#160;<span class="comment">/// return 0 on success, -1 on error</span></div><div class="line"><a name="l03416"></a><span class="lineno"> 3416</span>&#160;<span class="comment"></span></div><div class="line"><a name="l03417"></a><span class="lineno"><a class="line" href="classXrdProofdProofServMgr.html#a908238ada084a7362b6083e42c5b62f7"> 3417</a></span>&#160;<span class="keywordtype">int</span> <a class="code" href="classXrdProofdProofServMgr.html#a908238ada084a7362b6083e42c5b62f7">XrdProofdProofServMgr::CreateProofServEnvFile</a>(<a class="code" href="classXrdProofdProtocol.html">XrdProofdProtocol</a> *p, <span class="keywordtype">void</span> *input,</div><div class="line"><a name="l03418"></a><span class="lineno"> 3418</span>&#160;                                                  <span class="keyword">const</span> <span class="keywordtype">char</span> *envfn, <span class="keyword">const</span> <span class="keywordtype">char</span> *rcfn)</div><div class="line"><a name="l03419"></a><span class="lineno"> 3419</span>&#160;{</div><div class="line"><a name="l03420"></a><span class="lineno"> 3420</span>&#160;   <a class="code" href="XrdProofdTrace_8h.html#a7c31822912a8d0dc9bfd544097b29e12">XPDLOC</a>(SMGR, <span class="stringliteral">&quot;ProofServMgr::CreateProofServEnvFile&quot;</span>)</div><div class="line"><a name="l03421"></a><span class="lineno"> 3421</span>&#160;</div><div class="line"><a name="l03422"></a><span class="lineno"> 3422</span>&#160;   <span class="comment">// Check inputs</span></div><div class="line"><a name="l03423"></a><span class="lineno"> 3423</span>&#160;   <span class="keywordflow">if</span> (!p || !input || (!envfn ||</div><div class="line"><a name="l03424"></a><span class="lineno"> 3424</span>&#160;      (envfn &amp;&amp; strlen(envfn) &lt;= 0)) || (!rcfn || (rcfn &amp;&amp; strlen(rcfn) &lt;= 0))) {</div><div class="line"><a name="l03425"></a><span class="lineno"> 3425</span>&#160;      <a class="code" href="TGHtml_8h.html#ad5bb4a3d12fd54f29da2b924b29e652b">TRACE</a>(XERR, <span class="stringliteral">&quot;invalid inputs!&quot;</span>);</div><div class="line"><a name="l03426"></a><span class="lineno"> 3426</span>&#160;      <span class="keywordflow">return</span> -1;</div><div class="line"><a name="l03427"></a><span class="lineno"> 3427</span>&#160;   }</div><div class="line"><a name="l03428"></a><span class="lineno"> 3428</span>&#160;</div><div class="line"><a name="l03429"></a><span class="lineno"> 3429</span>&#160;   <span class="comment">// Attach the structure</span></div><div class="line"><a name="l03430"></a><span class="lineno"> 3430</span>&#160;   <a class="code" href="structProofServEnv__t.html">ProofServEnv_t</a> *in = (<a class="code" href="structProofServEnv__t.html">ProofServEnv_t</a> *)input;</div><div class="line"><a name="l03431"></a><span class="lineno"> 3431</span>&#160;</div><div class="line"><a name="l03432"></a><span class="lineno"> 3432</span>&#160;   <span class="comment">// Session proxy</span></div><div class="line"><a name="l03433"></a><span class="lineno"> 3433</span>&#160;   <a class="code" href="classXrdProofdProofServ.html">XrdProofdProofServ</a> *xps = in-&gt;<a class="code" href="structProofServEnv__t.html#aefb8c17473f66fe63376b1956ba7ebfa">fPS</a>;</div><div class="line"><a name="l03434"></a><span class="lineno"> 3434</span>&#160;   <span class="keywordflow">if</span> (!xps) {</div><div class="line"><a name="l03435"></a><span class="lineno"> 3435</span>&#160;      <a class="code" href="TGHtml_8h.html#ad5bb4a3d12fd54f29da2b924b29e652b">TRACE</a>(XERR, <span class="stringliteral">&quot;unable to get instance of proofserv proxy&quot;</span>);</div><div class="line"><a name="l03436"></a><span class="lineno"> 3436</span>&#160;      <span class="keywordflow">return</span> -1;</div><div class="line"><a name="l03437"></a><span class="lineno"> 3437</span>&#160;   }</div><div class="line"><a name="l03438"></a><span class="lineno"> 3438</span>&#160;</div><div class="line"><a name="l03439"></a><span class="lineno"> 3439</span>&#160;   FILE *fenv = fopen(envfn, <span class="stringliteral">&quot;w&quot;</span>);</div><div class="line"><a name="l03440"></a><span class="lineno"> 3440</span>&#160;   <span class="keywordflow">if</span> (!fenv) {</div><div class="line"><a name="l03441"></a><span class="lineno"> 3441</span>&#160;      <a class="code" href="TGHtml_8h.html#ad5bb4a3d12fd54f29da2b924b29e652b">TRACE</a>(XERR, <span class="stringliteral">&quot;unable to open env file: &quot;</span>&lt;&lt;envfn);</div><div class="line"><a name="l03442"></a><span class="lineno"> 3442</span>&#160;      <span class="keywordflow">return</span> -1;</div><div class="line"><a name="l03443"></a><span class="lineno"> 3443</span>&#160;   }</div><div class="line"><a name="l03444"></a><span class="lineno"> 3444</span>&#160;   <a class="code" href="TGHtml_8h.html#ad5bb4a3d12fd54f29da2b924b29e652b">TRACE</a>(REQ, <span class="stringliteral">&quot;environment file: &quot;</span>&lt;&lt; envfn);</div><div class="line"><a name="l03445"></a><span class="lineno"> 3445</span>&#160;</div><div class="line"><a name="l03446"></a><span class="lineno"> 3446</span>&#160;   <span class="keywordtype">char</span> *ev = 0;</div><div class="line"><a name="l03447"></a><span class="lineno"> 3447</span>&#160;   <span class="keywordtype">size_t</span> len = 0;</div><div class="line"><a name="l03448"></a><span class="lineno"> 3448</span>&#160;   <span class="comment">// Forwarded sec credentials, if any</span></div><div class="line"><a name="l03449"></a><span class="lineno"> 3449</span>&#160;   <span class="keywordflow">if</span> (p-&gt;<a class="code" href="classXrdProofdProtocol.html#a7aba904b9dbafda64fc01f1280eee7db">AuthProt</a>()) {</div><div class="line"><a name="l03450"></a><span class="lineno"> 3450</span>&#160;</div><div class="line"><a name="l03451"></a><span class="lineno"> 3451</span>&#160;      <span class="comment">// Additional envs possibly set by the protocol for next application</span></div><div class="line"><a name="l03452"></a><span class="lineno"> 3452</span>&#160;      XrdOucString secenvs(getenv(<span class="stringliteral">&quot;XrdSecENVS&quot;</span>));</div><div class="line"><a name="l03453"></a><span class="lineno"> 3453</span>&#160;      <span class="keywordflow">if</span> (secenvs.length() &gt; 0) {</div><div class="line"><a name="l03454"></a><span class="lineno"> 3454</span>&#160;         <span class="comment">// Go through the list</span></div><div class="line"><a name="l03455"></a><span class="lineno"> 3455</span>&#160;         XrdOucString env;</div><div class="line"><a name="l03456"></a><span class="lineno"> 3456</span>&#160;         <span class="keywordtype">int</span> from = 0;</div><div class="line"><a name="l03457"></a><span class="lineno"> 3457</span>&#160;         <span class="keywordflow">while</span> ((from = secenvs.tokenize(env, from, <span class="charliteral">&#39;,&#39;</span>)) != -1) {</div><div class="line"><a name="l03458"></a><span class="lineno"> 3458</span>&#160;            <span class="keywordflow">if</span> (env.length() &gt; 0) {</div><div class="line"><a name="l03459"></a><span class="lineno"> 3459</span>&#160;               <span class="comment">// Set the env now</span></div><div class="line"><a name="l03460"></a><span class="lineno"> 3460</span>&#160;               ev = <span class="keyword">new</span> <span class="keywordtype">char</span>[env.length()+1];</div><div class="line"><a name="l03461"></a><span class="lineno"> 3461</span>&#160;               strncpy(ev, env.c_str(), env.length());</div><div class="line"><a name="l03462"></a><span class="lineno"> 3462</span>&#160;               ev[env.length()] = 0;</div><div class="line"><a name="l03463"></a><span class="lineno"> 3463</span>&#160;               fprintf(fenv, <span class="stringliteral">&quot;%s\n&quot;</span>, ev);</div><div class="line"><a name="l03464"></a><span class="lineno"> 3464</span>&#160;               <a class="code" href="TGHtml_8h.html#ad5bb4a3d12fd54f29da2b924b29e652b">TRACE</a>(DBG, ev);</div><div class="line"><a name="l03465"></a><span class="lineno"> 3465</span>&#160;               <a class="code" href="XrdProofdProofServMgr_8cxx.html#a7cfa47f520ffb28d614134a05dc8cb14">PutEnv</a>(ev, in-&gt;<a class="code" href="structProofServEnv__t.html#ac49c6760896eeec21cf83929ab709b92">fOld</a>);</div><div class="line"><a name="l03466"></a><span class="lineno"> 3466</span>&#160;            }</div><div class="line"><a name="l03467"></a><span class="lineno"> 3467</span>&#160;         }</div><div class="line"><a name="l03468"></a><span class="lineno"> 3468</span>&#160;      }</div><div class="line"><a name="l03469"></a><span class="lineno"> 3469</span>&#160;</div><div class="line"><a name="l03470"></a><span class="lineno"> 3470</span>&#160;      <span class="comment">// The credential buffer, if any</span></div><div class="line"><a name="l03471"></a><span class="lineno"> 3471</span>&#160;      XrdSecCredentials *creds = p-&gt;<a class="code" href="classXrdProofdProtocol.html#a7aba904b9dbafda64fc01f1280eee7db">AuthProt</a>()-&gt;getCredentials();</div><div class="line"><a name="l03472"></a><span class="lineno"> 3472</span>&#160;      <span class="keywordflow">if</span> (creds) {</div><div class="line"><a name="l03473"></a><span class="lineno"> 3473</span>&#160;         <span class="keywordtype">int</span> lev = strlen(<span class="stringliteral">&quot;XrdSecCREDS=&quot;</span>) + creds-&gt;size;</div><div class="line"><a name="l03474"></a><span class="lineno"> 3474</span>&#160;         ev = <span class="keyword">new</span> <span class="keywordtype">char</span>[lev+1];</div><div class="line"><a name="l03475"></a><span class="lineno"> 3475</span>&#160;         strncpy(ev, <span class="stringliteral">&quot;XrdSecCREDS=&quot;</span>, lev);</div><div class="line"><a name="l03476"></a><span class="lineno"> 3476</span>&#160;         memcpy(ev+strlen(<span class="stringliteral">&quot;XrdSecCREDS=&quot;</span>), creds-&gt;buffer, creds-&gt;size);</div><div class="line"><a name="l03477"></a><span class="lineno"> 3477</span>&#160;         ev[lev] = 0;</div><div class="line"><a name="l03478"></a><span class="lineno"> 3478</span>&#160;         <a class="code" href="XrdProofdProofServMgr_8cxx.html#a7cfa47f520ffb28d614134a05dc8cb14">PutEnv</a>(ev, in-&gt;<a class="code" href="structProofServEnv__t.html#ac49c6760896eeec21cf83929ab709b92">fOld</a>);</div><div class="line"><a name="l03479"></a><span class="lineno"> 3479</span>&#160;         <a class="code" href="TGHtml_8h.html#ad5bb4a3d12fd54f29da2b924b29e652b">TRACE</a>(DBG, <span class="stringliteral">&quot;XrdSecCREDS set&quot;</span>);</div><div class="line"><a name="l03480"></a><span class="lineno"> 3480</span>&#160;</div><div class="line"><a name="l03481"></a><span class="lineno"> 3481</span>&#160;         <span class="keywordflow">if</span> (<a class="code" href="classXrdProofdProofServMgr.html#a7cb3d5c0d8bcb814202a15e354a5d92b">fCredsSaver</a>) {</div><div class="line"><a name="l03482"></a><span class="lineno"> 3482</span>&#160;            XrdOucString credsdir = p-&gt;<a class="code" href="classXrdProofdProtocol.html#a80024c8f848d0eabe9f13d09f06c8d9d">Client</a>()-&gt;<a class="code" href="classXrdProofdClient.html#a8ea0bbb76949d36f85b223cab59db0d7">Sandbox</a>()-&gt;<a class="code" href="classXrdProofdSandbox.html#ad067010c4a92eee6dac2aa0dbc679bf4">Dir</a>();</div><div class="line"><a name="l03483"></a><span class="lineno"> 3483</span>&#160;            credsdir += <span class="stringliteral">&quot;/.creds&quot;</span>;</div><div class="line"><a name="l03484"></a><span class="lineno"> 3484</span>&#160;            <span class="comment">// Make sure the directory exists</span></div><div class="line"><a name="l03485"></a><span class="lineno"> 3485</span>&#160;            <span class="keywordflow">if</span> (!<a class="code" href="classXrdProofdAux.html#a3918ddc5c3912b017a3f7695ba5f3a40">XrdProofdAux::AssertDir</a>(credsdir.c_str(), p-&gt;<a class="code" href="classXrdProofdProtocol.html#a80024c8f848d0eabe9f13d09f06c8d9d">Client</a>()-&gt;<a class="code" href="classXrdProofdClient.html#a062a4396b4b8f0667f3a97a64c7f1c3d">UI</a>(), <a class="code" href="classXrdProofdProofServMgr.html#a86cac591a5646811e38ff6a2477f4da7">fMgr</a>-&gt;<a class="code" href="classXrdProofdManager.html#a15d2e414e67bfc0cc4304605a6b509ff">ChangeOwn</a>())) {</div><div class="line"><a name="l03486"></a><span class="lineno"> 3486</span>&#160;               <span class="keywordflow">if</span> ((*<a class="code" href="classXrdProofdProofServMgr.html#a7cb3d5c0d8bcb814202a15e354a5d92b">fCredsSaver</a>)(creds, credsdir.c_str(), p-&gt;<a class="code" href="classXrdProofdProtocol.html#a80024c8f848d0eabe9f13d09f06c8d9d">Client</a>()-&gt;<a class="code" href="classXrdProofdClient.html#a062a4396b4b8f0667f3a97a64c7f1c3d">UI</a>()) != 0) {</div><div class="line"><a name="l03487"></a><span class="lineno"> 3487</span>&#160;                  <a class="code" href="TGHtml_8h.html#ad5bb4a3d12fd54f29da2b924b29e652b">TRACE</a>(DBG, <span class="stringliteral">&quot;problems in saving authentication creds under &quot;</span>&lt;&lt;credsdir);</div><div class="line"><a name="l03488"></a><span class="lineno"> 3488</span>&#160;               }</div><div class="line"><a name="l03489"></a><span class="lineno"> 3489</span>&#160;            } <span class="keywordflow">else</span> {</div><div class="line"><a name="l03490"></a><span class="lineno"> 3490</span>&#160;               <a class="code" href="TGHtml_8h.html#ad5bb4a3d12fd54f29da2b924b29e652b">TRACE</a>(XERR, <span class="stringliteral">&quot;unable to create creds dir: &quot;</span>&lt;&lt;credsdir);</div><div class="line"><a name="l03491"></a><span class="lineno"> 3491</span>&#160;               fclose(fenv);</div><div class="line"><a name="l03492"></a><span class="lineno"> 3492</span>&#160;               <span class="keywordflow">return</span> -1;</div><div class="line"><a name="l03493"></a><span class="lineno"> 3493</span>&#160;            }</div><div class="line"><a name="l03494"></a><span class="lineno"> 3494</span>&#160;         }</div><div class="line"><a name="l03495"></a><span class="lineno"> 3495</span>&#160;      }</div><div class="line"><a name="l03496"></a><span class="lineno"> 3496</span>&#160;   }</div><div class="line"><a name="l03497"></a><span class="lineno"> 3497</span>&#160;</div><div class="line"><a name="l03498"></a><span class="lineno"> 3498</span>&#160;   <span class="comment">// Library path</span></div><div class="line"><a name="l03499"></a><span class="lineno"> 3499</span>&#160;   fprintf(fenv, <span class="stringliteral">&quot;%s=%s\n&quot;</span>, <a class="code" href="XrdProofdPlatform_8h.html#aa5bbba6e125e30ab938354892fa73c30">XPD_LIBPATH</a>, getenv(<a class="code" href="XrdProofdPlatform_8h.html#aa5bbba6e125e30ab938354892fa73c30">XPD_LIBPATH</a>));</div><div class="line"><a name="l03500"></a><span class="lineno"> 3500</span>&#160;</div><div class="line"><a name="l03501"></a><span class="lineno"> 3501</span>&#160;   <span class="comment">// ROOTSYS</span></div><div class="line"><a name="l03502"></a><span class="lineno"> 3502</span>&#160;   fprintf(fenv, <span class="stringliteral">&quot;ROOTSYS=%s\n&quot;</span>, xps-&gt;<a class="code" href="classXrdProofdProofServ.html#a18e4a17f4e9ef07f923b654e2d000148">ROOT</a>()-&gt;<a class="code" href="classXrdROOT.html#a51a773d135799c7a2604d8789f37f562">Dir</a>());</div><div class="line"><a name="l03503"></a><span class="lineno"> 3503</span>&#160;</div><div class="line"><a name="l03504"></a><span class="lineno"> 3504</span>&#160;   <span class="comment">// Conf dir</span></div><div class="line"><a name="l03505"></a><span class="lineno"> 3505</span>&#160;   fprintf(fenv, <span class="stringliteral">&quot;ROOTCONFDIR=%s\n&quot;</span>, xps-&gt;<a class="code" href="classXrdProofdProofServ.html#a18e4a17f4e9ef07f923b654e2d000148">ROOT</a>()-&gt;<a class="code" href="classXrdROOT.html#a51a773d135799c7a2604d8789f37f562">Dir</a>());</div><div class="line"><a name="l03506"></a><span class="lineno"> 3506</span>&#160;</div><div class="line"><a name="l03507"></a><span class="lineno"> 3507</span>&#160;   <span class="comment">// TMPDIR</span></div><div class="line"><a name="l03508"></a><span class="lineno"> 3508</span>&#160;   fprintf(fenv, <span class="stringliteral">&quot;TMPDIR=%s\n&quot;</span>, <a class="code" href="classXrdProofdProofServMgr.html#a86cac591a5646811e38ff6a2477f4da7">fMgr</a>-&gt;<a class="code" href="classXrdProofdManager.html#a90aa36d30901b6766ef4a88be6610b6d">TMPdir</a>());</div><div class="line"><a name="l03509"></a><span class="lineno"> 3509</span>&#160;</div><div class="line"><a name="l03510"></a><span class="lineno"> 3510</span>&#160;   <span class="comment">// RC file</span></div><div class="line"><a name="l03511"></a><span class="lineno"> 3511</span>&#160;   <span class="keywordflow">if</span> (in-&gt;<a class="code" href="structProofServEnv__t.html#ac49c6760896eeec21cf83929ab709b92">fOld</a>) {</div><div class="line"><a name="l03512"></a><span class="lineno"> 3512</span>&#160;      len = strlen(<span class="stringliteral">&quot;ROOTRCFILE=&quot;</span>) + strlen(rcfn) + 2;</div><div class="line"><a name="l03513"></a><span class="lineno"> 3513</span>&#160;      ev = <span class="keyword">new</span> <span class="keywordtype">char</span>[len];</div><div class="line"><a name="l03514"></a><span class="lineno"> 3514</span>&#160;      <a class="code" href="civetweb_8c.html#aa367b75c5aed883fef5befbdf04835a4">snprintf</a>(ev, len, <span class="stringliteral">&quot;ROOTRCFILE=%s&quot;</span>, rcfn);</div><div class="line"><a name="l03515"></a><span class="lineno"> 3515</span>&#160;      fprintf(fenv, <span class="stringliteral">&quot;%s\n&quot;</span>, ev);</div><div class="line"><a name="l03516"></a><span class="lineno"> 3516</span>&#160;      <a class="code" href="TGHtml_8h.html#ad5bb4a3d12fd54f29da2b924b29e652b">TRACE</a>(DBG, ev);</div><div class="line"><a name="l03517"></a><span class="lineno"> 3517</span>&#160;      <a class="code" href="XrdProofdProofServMgr_8cxx.html#a7cfa47f520ffb28d614134a05dc8cb14">PutEnv</a>(ev, in-&gt;<a class="code" href="structProofServEnv__t.html#ac49c6760896eeec21cf83929ab709b92">fOld</a>);</div><div class="line"><a name="l03518"></a><span class="lineno"> 3518</span>&#160;   }</div><div class="line"><a name="l03519"></a><span class="lineno"> 3519</span>&#160;</div><div class="line"><a name="l03520"></a><span class="lineno"> 3520</span>&#160;   <span class="comment">// ROOT version tag (needed in building packages)</span></div><div class="line"><a name="l03521"></a><span class="lineno"> 3521</span>&#160;   len = strlen(<span class="stringliteral">&quot;ROOTVERSIONTAG=&quot;</span>) + strlen(p-&gt;<a class="code" href="classXrdProofdProtocol.html#a80024c8f848d0eabe9f13d09f06c8d9d">Client</a>()-&gt;<a class="code" href="classXrdProofdClient.html#a55c0e73c9bca2a64fd6417d750db02e2">ROOT</a>()-&gt;<a class="code" href="classXrdROOT.html#a3b1e4b60cbd1b7fcd87a583a9e664b24">Tag</a>()) + 2;</div><div class="line"><a name="l03522"></a><span class="lineno"> 3522</span>&#160;   ev = <span class="keyword">new</span> <span class="keywordtype">char</span>[len];</div><div class="line"><a name="l03523"></a><span class="lineno"> 3523</span>&#160;   <a class="code" href="civetweb_8c.html#aa367b75c5aed883fef5befbdf04835a4">snprintf</a>(ev, len, <span class="stringliteral">&quot;ROOTVERSIONTAG=%s&quot;</span>, p-&gt;<a class="code" href="classXrdProofdProtocol.html#a80024c8f848d0eabe9f13d09f06c8d9d">Client</a>()-&gt;<a class="code" href="classXrdProofdClient.html#a55c0e73c9bca2a64fd6417d750db02e2">ROOT</a>()-&gt;<a class="code" href="classXrdROOT.html#a3b1e4b60cbd1b7fcd87a583a9e664b24">Tag</a>());</div><div class="line"><a name="l03524"></a><span class="lineno"> 3524</span>&#160;   fprintf(fenv, <span class="stringliteral">&quot;%s\n&quot;</span>, ev);</div><div class="line"><a name="l03525"></a><span class="lineno"> 3525</span>&#160;   <a class="code" href="TGHtml_8h.html#ad5bb4a3d12fd54f29da2b924b29e652b">TRACE</a>(DBG, ev);</div><div class="line"><a name="l03526"></a><span class="lineno"> 3526</span>&#160;   <a class="code" href="XrdProofdProofServMgr_8cxx.html#a7cfa47f520ffb28d614134a05dc8cb14">PutEnv</a>(ev, in-&gt;<a class="code" href="structProofServEnv__t.html#ac49c6760896eeec21cf83929ab709b92">fOld</a>);</div><div class="line"><a name="l03527"></a><span class="lineno"> 3527</span>&#160;</div><div class="line"><a name="l03528"></a><span class="lineno"> 3528</span>&#160;   <span class="comment">// Log file in the log dir</span></div><div class="line"><a name="l03529"></a><span class="lineno"> 3529</span>&#160;   <span class="keywordflow">if</span> (in-&gt;<a class="code" href="structProofServEnv__t.html#ac49c6760896eeec21cf83929ab709b92">fOld</a>) {</div><div class="line"><a name="l03530"></a><span class="lineno"> 3530</span>&#160;      len = strlen(<span class="stringliteral">&quot;ROOTPROOFLOGFILE=&quot;</span>) + in-&gt;<a class="code" href="structProofServEnv__t.html#a88002c75764b173de52afd5f9b3c6c74">fLogFile</a>.length() + 2;</div><div class="line"><a name="l03531"></a><span class="lineno"> 3531</span>&#160;      ev = <span class="keyword">new</span> <span class="keywordtype">char</span>[len];</div><div class="line"><a name="l03532"></a><span class="lineno"> 3532</span>&#160;      <a class="code" href="civetweb_8c.html#aa367b75c5aed883fef5befbdf04835a4">snprintf</a>(ev, len, <span class="stringliteral">&quot;ROOTPROOFLOGFILE=%s&quot;</span>, in-&gt;<a class="code" href="structProofServEnv__t.html#a88002c75764b173de52afd5f9b3c6c74">fLogFile</a>.c_str());</div><div class="line"><a name="l03533"></a><span class="lineno"> 3533</span>&#160;      fprintf(fenv, <span class="stringliteral">&quot;%s\n&quot;</span>, ev);</div><div class="line"><a name="l03534"></a><span class="lineno"> 3534</span>&#160;      xps-&gt;<a class="code" href="classXrdProofdProofServ.html#aa48a1e58fb1d7a0c0cefdb9ded292d07">SetFileout</a>(in-&gt;<a class="code" href="structProofServEnv__t.html#a88002c75764b173de52afd5f9b3c6c74">fLogFile</a>.c_str());</div><div class="line"><a name="l03535"></a><span class="lineno"> 3535</span>&#160;      <a class="code" href="TGHtml_8h.html#ad5bb4a3d12fd54f29da2b924b29e652b">TRACE</a>(DBG, ev);</div><div class="line"><a name="l03536"></a><span class="lineno"> 3536</span>&#160;      <a class="code" href="XrdProofdProofServMgr_8cxx.html#a7cfa47f520ffb28d614134a05dc8cb14">PutEnv</a>(ev, in-&gt;<a class="code" href="structProofServEnv__t.html#ac49c6760896eeec21cf83929ab709b92">fOld</a>);</div><div class="line"><a name="l03537"></a><span class="lineno"> 3537</span>&#160;   }</div><div class="line"><a name="l03538"></a><span class="lineno"> 3538</span>&#160;</div><div class="line"><a name="l03539"></a><span class="lineno"> 3539</span>&#160;   <span class="comment">// Local data server</span></div><div class="line"><a name="l03540"></a><span class="lineno"> 3540</span>&#160;   XrdOucString locdatasrv;</div><div class="line"><a name="l03541"></a><span class="lineno"> 3541</span>&#160;   <a class="code" href="XrdProofdAux_8h.html#a631cc8787af1a02d9e51c86117ae042e">XPDFORM</a>(locdatasrv, <span class="stringliteral">&quot;root://%s&quot;</span>, <a class="code" href="classXrdProofdProofServMgr.html#a86cac591a5646811e38ff6a2477f4da7">fMgr</a>-&gt;<a class="code" href="classXrdProofdManager.html#a3f8780d0a9d3fabe02aa01fe8ebbf5b5">Host</a>());</div><div class="line"><a name="l03542"></a><span class="lineno"> 3542</span>&#160;</div><div class="line"><a name="l03543"></a><span class="lineno"> 3543</span>&#160;   <span class="keywordtype">int</span> nrk = <a class="code" href="classXrdProofdProofServMgr.html#a86cac591a5646811e38ff6a2477f4da7">fMgr</a>-&gt;<a class="code" href="classXrdProofdManager.html#afff1cbbe9ce1f522c001f196271d71b7">ResolveKeywords</a>(locdatasrv, p-&gt;<a class="code" href="classXrdProofdProtocol.html#a80024c8f848d0eabe9f13d09f06c8d9d">Client</a>());</div><div class="line"><a name="l03544"></a><span class="lineno"> 3544</span>&#160;   <a class="code" href="TGHtml_8h.html#ad5bb4a3d12fd54f29da2b924b29e652b">TRACE</a>(HDBG, nrk &lt;&lt; <span class="stringliteral">&quot; placeholders resolved for LOCALDATASERVER&quot;</span>);</div><div class="line"><a name="l03545"></a><span class="lineno"> 3545</span>&#160;   len = strlen(<span class="stringliteral">&quot;LOCALDATASERVER=&quot;</span>) + locdatasrv.length() + 2;</div><div class="line"><a name="l03546"></a><span class="lineno"> 3546</span>&#160;   ev = <span class="keyword">new</span> <span class="keywordtype">char</span>[len];</div><div class="line"><a name="l03547"></a><span class="lineno"> 3547</span>&#160;   <a class="code" href="civetweb_8c.html#aa367b75c5aed883fef5befbdf04835a4">snprintf</a>(ev, len, <span class="stringliteral">&quot;LOCALDATASERVER=%s&quot;</span>, locdatasrv.c_str());</div><div class="line"><a name="l03548"></a><span class="lineno"> 3548</span>&#160;   fprintf(fenv, <span class="stringliteral">&quot;%s\n&quot;</span>, ev);</div><div class="line"><a name="l03549"></a><span class="lineno"> 3549</span>&#160;   <a class="code" href="TGHtml_8h.html#ad5bb4a3d12fd54f29da2b924b29e652b">TRACE</a>(DBG, ev);</div><div class="line"><a name="l03550"></a><span class="lineno"> 3550</span>&#160;   <a class="code" href="XrdProofdProofServMgr_8cxx.html#a7cfa47f520ffb28d614134a05dc8cb14">PutEnv</a>(ev, in-&gt;<a class="code" href="structProofServEnv__t.html#ac49c6760896eeec21cf83929ab709b92">fOld</a>);</div><div class="line"><a name="l03551"></a><span class="lineno"> 3551</span>&#160;</div><div class="line"><a name="l03552"></a><span class="lineno"> 3552</span>&#160;   <span class="comment">// Xrootd config file</span></div><div class="line"><a name="l03553"></a><span class="lineno"> 3553</span>&#160;   <span class="keywordflow">if</span> (<a class="code" href="classXrdProofdConfig.html#ab2163674ebfd3801ee81e6ee720151bf">CfgFile</a>()) {</div><div class="line"><a name="l03554"></a><span class="lineno"> 3554</span>&#160;      len = strlen(<span class="stringliteral">&quot;XRDCF=&quot;</span>) + strlen(<a class="code" href="classXrdProofdConfig.html#ab2163674ebfd3801ee81e6ee720151bf">CfgFile</a>()) + 2;</div><div class="line"><a name="l03555"></a><span class="lineno"> 3555</span>&#160;      ev = <span class="keyword">new</span> <span class="keywordtype">char</span>[len];</div><div class="line"><a name="l03556"></a><span class="lineno"> 3556</span>&#160;      <a class="code" href="civetweb_8c.html#aa367b75c5aed883fef5befbdf04835a4">snprintf</a>(ev, len, <span class="stringliteral">&quot;XRDCF=%s&quot;</span>, <a class="code" href="classXrdProofdConfig.html#ab2163674ebfd3801ee81e6ee720151bf">CfgFile</a>());</div><div class="line"><a name="l03557"></a><span class="lineno"> 3557</span>&#160;      fprintf(fenv, <span class="stringliteral">&quot;%s\n&quot;</span>, ev);</div><div class="line"><a name="l03558"></a><span class="lineno"> 3558</span>&#160;      <a class="code" href="TGHtml_8h.html#ad5bb4a3d12fd54f29da2b924b29e652b">TRACE</a>(DBG, ev);</div><div class="line"><a name="l03559"></a><span class="lineno"> 3559</span>&#160;      <a class="code" href="XrdProofdProofServMgr_8cxx.html#a7cfa47f520ffb28d614134a05dc8cb14">PutEnv</a>(ev, in-&gt;<a class="code" href="structProofServEnv__t.html#ac49c6760896eeec21cf83929ab709b92">fOld</a>);</div><div class="line"><a name="l03560"></a><span class="lineno"> 3560</span>&#160;   }</div><div class="line"><a name="l03561"></a><span class="lineno"> 3561</span>&#160;</div><div class="line"><a name="l03562"></a><span class="lineno"> 3562</span>&#160;   <span class="comment">// Additional envs (xpd.putenv directive)</span></div><div class="line"><a name="l03563"></a><span class="lineno"> 3563</span>&#160;   {  <a class="code" href="XrdSysToOuc_8h.html#a4ba18bedbb8a1a4367d57f49a4d773ce">XrdSysMutexHelper</a> mhp(<a class="code" href="classXrdProofdProofServMgr.html#af244f1c4fd9592313e3cfc4bdeb64aaf">fEnvsMutex</a>);</div><div class="line"><a name="l03564"></a><span class="lineno"> 3564</span>&#160;      <span class="keywordflow">if</span> (<a class="code" href="classXrdProofdProofServMgr.html#af99918358c943b44bb636cf70b97671e">fProofServEnvs</a>.size() &gt; 0) {</div><div class="line"><a name="l03565"></a><span class="lineno"> 3565</span>&#160;         <span class="comment">// Hash list of the directives applying to this {user, group, svn, version}</span></div><div class="line"><a name="l03566"></a><span class="lineno"> 3566</span>&#160;         XrdOucHash&lt;XpdEnv&gt; sessenvs;</div><div class="line"><a name="l03567"></a><span class="lineno"> 3567</span>&#160;         std::list&lt;XpdEnv&gt;::iterator ienvs = <a class="code" href="classXrdProofdProofServMgr.html#af99918358c943b44bb636cf70b97671e">fProofServEnvs</a>.begin();</div><div class="line"><a name="l03568"></a><span class="lineno"> 3568</span>&#160;         <span class="keywordflow">for</span> ( ; ienvs != <a class="code" href="classXrdProofdProofServMgr.html#af99918358c943b44bb636cf70b97671e">fProofServEnvs</a>.end(); ++ienvs) {</div><div class="line"><a name="l03569"></a><span class="lineno"> 3569</span>&#160;            <span class="keywordtype">int</span> envmatch = (*ienvs).Matches(p-&gt;<a class="code" href="classXrdProofdProtocol.html#a80024c8f848d0eabe9f13d09f06c8d9d">Client</a>()-&gt;<a class="code" href="classXrdProofdClient.html#a3cbe604999cdb44ae9d0ec833ffa5900">User</a>(), p-&gt;<a class="code" href="classXrdProofdProtocol.html#a80024c8f848d0eabe9f13d09f06c8d9d">Client</a>()-&gt;<a class="code" href="classXrdProofdClient.html#af82bc301c99dc688038ba2c771b5c49e">Group</a>(),</div><div class="line"><a name="l03570"></a><span class="lineno"> 3570</span>&#160;                                            p-&gt;<a class="code" href="classXrdProofdProtocol.html#a80024c8f848d0eabe9f13d09f06c8d9d">Client</a>()-&gt;<a class="code" href="classXrdProofdClient.html#a55c0e73c9bca2a64fd6417d750db02e2">ROOT</a>()-&gt;<a class="code" href="classXrdROOT.html#a8d85b526df3fbd35ee5d4daee3d6ab0b">VersionCode</a>());</div><div class="line"><a name="l03571"></a><span class="lineno"> 3571</span>&#160;            <span class="keywordflow">if</span> (envmatch &gt;= 0) {</div><div class="line"><a name="l03572"></a><span class="lineno"> 3572</span>&#160;               <a class="code" href="classXpdEnv.html">XpdEnv</a> *env = sessenvs.Find((*ienvs).fName.c_str());</div><div class="line"><a name="l03573"></a><span class="lineno"> 3573</span>&#160;               <span class="keywordflow">if</span> (env) {</div><div class="line"><a name="l03574"></a><span class="lineno"> 3574</span>&#160;                  <span class="keywordtype">int</span> envmtcex = env-&gt;<a class="code" href="classXpdEnv.html#a6bc4c90b8cc7074d6a8ee356c5de481d">Matches</a>(p-&gt;<a class="code" href="classXrdProofdProtocol.html#a80024c8f848d0eabe9f13d09f06c8d9d">Client</a>()-&gt;<a class="code" href="classXrdProofdClient.html#a3cbe604999cdb44ae9d0ec833ffa5900">User</a>(), p-&gt;<a class="code" href="classXrdProofdProtocol.html#a80024c8f848d0eabe9f13d09f06c8d9d">Client</a>()-&gt;<a class="code" href="classXrdProofdClient.html#af82bc301c99dc688038ba2c771b5c49e">Group</a>(),</div><div class="line"><a name="l03575"></a><span class="lineno"> 3575</span>&#160;                                              p-&gt;<a class="code" href="classXrdProofdProtocol.html#a80024c8f848d0eabe9f13d09f06c8d9d">Client</a>()-&gt;<a class="code" href="classXrdProofdClient.html#a55c0e73c9bca2a64fd6417d750db02e2">ROOT</a>()-&gt;<a class="code" href="classXrdROOT.html#a8d85b526df3fbd35ee5d4daee3d6ab0b">VersionCode</a>());</div><div class="line"><a name="l03576"></a><span class="lineno"> 3576</span>&#160;                  <span class="keywordflow">if</span> (envmatch &gt; envmtcex) {</div><div class="line"><a name="l03577"></a><span class="lineno"> 3577</span>&#160;                     <span class="comment">// Replace the entry</span></div><div class="line"><a name="l03578"></a><span class="lineno"> 3578</span>&#160;                     env = &amp;(*ienvs);</div><div class="line"><a name="l03579"></a><span class="lineno"> 3579</span>&#160;                     sessenvs.Rep(env-&gt;<a class="code" href="classXpdEnv.html#abe05770535de8187358d757e532da911">fName</a>.c_str(), env, 0, Hash_keepdata);</div><div class="line"><a name="l03580"></a><span class="lineno"> 3580</span>&#160;                  }</div><div class="line"><a name="l03581"></a><span class="lineno"> 3581</span>&#160;               } <span class="keywordflow">else</span> {</div><div class="line"><a name="l03582"></a><span class="lineno"> 3582</span>&#160;                  <span class="comment">// Add an entry</span></div><div class="line"><a name="l03583"></a><span class="lineno"> 3583</span>&#160;                  env = &amp;(*ienvs);</div><div class="line"><a name="l03584"></a><span class="lineno"> 3584</span>&#160;                  sessenvs.Add(env-&gt;<a class="code" href="classXpdEnv.html#abe05770535de8187358d757e532da911">fName</a>.c_str(), env, 0, Hash_keepdata);</div><div class="line"><a name="l03585"></a><span class="lineno"> 3585</span>&#160;               }</div><div class="line"><a name="l03586"></a><span class="lineno"> 3586</span>&#160;               <a class="code" href="TGHtml_8h.html#ad5bb4a3d12fd54f29da2b924b29e652b">TRACE</a>(HDBG, <span class="stringliteral">&quot;Adding: &quot;</span>&lt;&lt;(*ienvs).fEnv);</div><div class="line"><a name="l03587"></a><span class="lineno"> 3587</span>&#160;            }</div><div class="line"><a name="l03588"></a><span class="lineno"> 3588</span>&#160;         }</div><div class="line"><a name="l03589"></a><span class="lineno"> 3589</span>&#160;         XpdWriteEnv_t xpwe = {<a class="code" href="classXrdProofdProofServMgr.html#a86cac591a5646811e38ff6a2477f4da7">fMgr</a>, p-&gt;<a class="code" href="classXrdProofdProtocol.html#a80024c8f848d0eabe9f13d09f06c8d9d">Client</a>(), fenv, in-&gt;<a class="code" href="structProofServEnv__t.html#ac49c6760896eeec21cf83929ab709b92">fOld</a>};</div><div class="line"><a name="l03590"></a><span class="lineno"> 3590</span>&#160;         sessenvs.Apply(<a class="code" href="XrdProofdProofServMgr_8cxx.html#a7f323ce62c469b18c22fc22f735b1bcb">WriteSessEnvs</a>, (<span class="keywordtype">void</span> *)&amp;xpwe);</div><div class="line"><a name="l03591"></a><span class="lineno"> 3591</span>&#160;      }</div><div class="line"><a name="l03592"></a><span class="lineno"> 3592</span>&#160;   }</div><div class="line"><a name="l03593"></a><span class="lineno"> 3593</span>&#160;   <span class="comment">// Set the user envs</span></div><div class="line"><a name="l03594"></a><span class="lineno"> 3594</span>&#160;   <span class="keywordflow">if</span> (xps-&gt;<a class="code" href="classXrdProofdProofServ.html#a065f2c13e9cec3b03b332003573f00b0">UserEnvs</a>() &amp;&amp;</div><div class="line"><a name="l03595"></a><span class="lineno"> 3595</span>&#160;       strlen(xps-&gt;<a class="code" href="classXrdProofdProofServ.html#a065f2c13e9cec3b03b332003573f00b0">UserEnvs</a>()) &amp;&amp; strstr(xps-&gt;<a class="code" href="classXrdProofdProofServ.html#a065f2c13e9cec3b03b332003573f00b0">UserEnvs</a>(),<span class="stringliteral">&quot;=&quot;</span>)) {</div><div class="line"><a name="l03596"></a><span class="lineno"> 3596</span>&#160;      <span class="comment">// The single components</span></div><div class="line"><a name="l03597"></a><span class="lineno"> 3597</span>&#160;      XrdOucString ue = xps-&gt;<a class="code" href="classXrdProofdProofServ.html#a065f2c13e9cec3b03b332003573f00b0">UserEnvs</a>();</div><div class="line"><a name="l03598"></a><span class="lineno"> 3598</span>&#160;      XrdOucString env, namelist;</div><div class="line"><a name="l03599"></a><span class="lineno"> 3599</span>&#160;      <span class="keywordtype">int</span> from = 0, ieq = -1;</div><div class="line"><a name="l03600"></a><span class="lineno"> 3600</span>&#160;      <span class="keywordflow">while</span> ((from = ue.tokenize(env, from, <span class="charliteral">&#39;,&#39;</span>)) != -1) {</div><div class="line"><a name="l03601"></a><span class="lineno"> 3601</span>&#160;         <span class="keywordflow">if</span> (env.length() &gt; 0 &amp;&amp; (ieq = env.find(<span class="charliteral">&#39;=&#39;</span>)) != -1) {</div><div class="line"><a name="l03602"></a><span class="lineno"> 3602</span>&#160;            <span class="comment">// Resolve keywords</span></div><div class="line"><a name="l03603"></a><span class="lineno"> 3603</span>&#160;            <a class="code" href="classXrdProofdProofServMgr.html#aefd6e4127ea5c75d9007762cb375adea">ResolveKeywords</a>(env, in);</div><div class="line"><a name="l03604"></a><span class="lineno"> 3604</span>&#160;            ev = <span class="keyword">new</span> <span class="keywordtype">char</span>[env.length()+1];</div><div class="line"><a name="l03605"></a><span class="lineno"> 3605</span>&#160;            strncpy(ev, env.c_str(), env.length());</div><div class="line"><a name="l03606"></a><span class="lineno"> 3606</span>&#160;            ev[env.length()] = 0;</div><div class="line"><a name="l03607"></a><span class="lineno"> 3607</span>&#160;            <span class="keywordflow">if</span> (env.find(<span class="stringliteral">&quot;WRAPPERCMD&quot;</span>) == STR_NPOS || !xps-&gt;<a class="code" href="classXrdProofdProofServ.html#a4531e00216dd973a625c6d6b27c5f0a9">IsPLite</a>())</div><div class="line"><a name="l03608"></a><span class="lineno"> 3608</span>&#160;               fprintf(fenv, <span class="stringliteral">&quot;%s\n&quot;</span>, ev);</div><div class="line"><a name="l03609"></a><span class="lineno"> 3609</span>&#160;            <a class="code" href="TGHtml_8h.html#ad5bb4a3d12fd54f29da2b924b29e652b">TRACE</a>(DBG, ev);</div><div class="line"><a name="l03610"></a><span class="lineno"> 3610</span>&#160;            <a class="code" href="XrdProofdProofServMgr_8cxx.html#a7cfa47f520ffb28d614134a05dc8cb14">PutEnv</a>(ev, in-&gt;<a class="code" href="structProofServEnv__t.html#ac49c6760896eeec21cf83929ab709b92">fOld</a>);</div><div class="line"><a name="l03611"></a><span class="lineno"> 3611</span>&#160;            <span class="keywordflow">if</span> (env.find(<span class="stringliteral">&quot;WRAPPERCMD&quot;</span>) == STR_NPOS || !xps-&gt;<a class="code" href="classXrdProofdProofServ.html#a4531e00216dd973a625c6d6b27c5f0a9">IsPLite</a>()) {</div><div class="line"><a name="l03612"></a><span class="lineno"> 3612</span>&#160;               env.erase(ieq);</div><div class="line"><a name="l03613"></a><span class="lineno"> 3613</span>&#160;               <span class="keywordflow">if</span> (namelist.length() &gt; 0)</div><div class="line"><a name="l03614"></a><span class="lineno"> 3614</span>&#160;                  namelist += <span class="charliteral">&#39;,&#39;</span>;</div><div class="line"><a name="l03615"></a><span class="lineno"> 3615</span>&#160;               namelist += env;</div><div class="line"><a name="l03616"></a><span class="lineno"> 3616</span>&#160;            }</div><div class="line"><a name="l03617"></a><span class="lineno"> 3617</span>&#160;         }</div><div class="line"><a name="l03618"></a><span class="lineno"> 3618</span>&#160;      }</div><div class="line"><a name="l03619"></a><span class="lineno"> 3619</span>&#160;      <span class="comment">// The list of names, &#39;,&#39;-separated</span></div><div class="line"><a name="l03620"></a><span class="lineno"> 3620</span>&#160;      len = strlen(<span class="stringliteral">&quot;PROOF_ALLVARS=&quot;</span>) + namelist.length() + 2;</div><div class="line"><a name="l03621"></a><span class="lineno"> 3621</span>&#160;      ev = <span class="keyword">new</span> <span class="keywordtype">char</span>[len];</div><div class="line"><a name="l03622"></a><span class="lineno"> 3622</span>&#160;      <a class="code" href="civetweb_8c.html#aa367b75c5aed883fef5befbdf04835a4">snprintf</a>(ev, len, <span class="stringliteral">&quot;PROOF_ALLVARS=%s&quot;</span>, namelist.c_str());</div><div class="line"><a name="l03623"></a><span class="lineno"> 3623</span>&#160;      fprintf(fenv, <span class="stringliteral">&quot;%s\n&quot;</span>, ev);</div><div class="line"><a name="l03624"></a><span class="lineno"> 3624</span>&#160;      <a class="code" href="TGHtml_8h.html#ad5bb4a3d12fd54f29da2b924b29e652b">TRACE</a>(DBG, ev);</div><div class="line"><a name="l03625"></a><span class="lineno"> 3625</span>&#160;      <a class="code" href="XrdProofdProofServMgr_8cxx.html#a7cfa47f520ffb28d614134a05dc8cb14">PutEnv</a>(ev, in-&gt;<a class="code" href="structProofServEnv__t.html#ac49c6760896eeec21cf83929ab709b92">fOld</a>);</div><div class="line"><a name="l03626"></a><span class="lineno"> 3626</span>&#160;   }</div><div class="line"><a name="l03627"></a><span class="lineno"> 3627</span>&#160;</div><div class="line"><a name="l03628"></a><span class="lineno"> 3628</span>&#160;   <span class="comment">// Close file</span></div><div class="line"><a name="l03629"></a><span class="lineno"> 3629</span>&#160;   fclose(fenv);</div><div class="line"><a name="l03630"></a><span class="lineno"> 3630</span>&#160;</div><div class="line"><a name="l03631"></a><span class="lineno"> 3631</span>&#160;   <span class="comment">// We are done</span></div><div class="line"><a name="l03632"></a><span class="lineno"> 3632</span>&#160;   <span class="keywordflow">return</span> 0;</div><div class="line"><a name="l03633"></a><span class="lineno"> 3633</span>&#160;}</div><div class="line"><a name="l03634"></a><span class="lineno"> 3634</span>&#160;<span class="comment"></span></div><div class="line"><a name="l03635"></a><span class="lineno"> 3635</span>&#160;<span class="comment">////////////////////////////////////////////////////////////////////////////////</span></div><div class="line"><a name="l03636"></a><span class="lineno"> 3636</span>&#160;<span class="comment">/// Create in &#39;rcfn&#39; the rootrc file for the proofserv being created</span></div><div class="line"><a name="l03637"></a><span class="lineno"> 3637</span>&#160;<span class="comment">/// return 0 on success, -1 on error</span></div><div class="line"><a name="l03638"></a><span class="lineno"> 3638</span>&#160;<span class="comment"></span></div><div class="line"><a name="l03639"></a><span class="lineno"><a class="line" href="classXrdProofdProofServMgr.html#ae701527462f37bde60cef71f5570375f"> 3639</a></span>&#160;<span class="keywordtype">int</span> <a class="code" href="classXrdProofdProofServMgr.html#ae701527462f37bde60cef71f5570375f">XrdProofdProofServMgr::CreateProofServRootRc</a>(<a class="code" href="classXrdProofdProtocol.html">XrdProofdProtocol</a> *p,</div><div class="line"><a name="l03640"></a><span class="lineno"> 3640</span>&#160;                                                 <span class="keywordtype">void</span> *input, <span class="keyword">const</span> <span class="keywordtype">char</span> *rcfn)</div><div class="line"><a name="l03641"></a><span class="lineno"> 3641</span>&#160;{</div><div class="line"><a name="l03642"></a><span class="lineno"> 3642</span>&#160;   <a class="code" href="XrdProofdTrace_8h.html#a7c31822912a8d0dc9bfd544097b29e12">XPDLOC</a>(SMGR, <span class="stringliteral">&quot;ProofServMgr::CreateProofServRootRc&quot;</span>)</div><div class="line"><a name="l03643"></a><span class="lineno"> 3643</span>&#160;</div><div class="line"><a name="l03644"></a><span class="lineno"> 3644</span>&#160;   <span class="comment">// Check inputs</span></div><div class="line"><a name="l03645"></a><span class="lineno"> 3645</span>&#160;   <span class="keywordflow">if</span> (!p || !input || (!rcfn || (rcfn &amp;&amp; strlen(rcfn) &lt;= 0))) {</div><div class="line"><a name="l03646"></a><span class="lineno"> 3646</span>&#160;      <a class="code" href="TGHtml_8h.html#ad5bb4a3d12fd54f29da2b924b29e652b">TRACE</a>(XERR, <span class="stringliteral">&quot;invalid inputs!&quot;</span>);</div><div class="line"><a name="l03647"></a><span class="lineno"> 3647</span>&#160;      <span class="keywordflow">return</span> -1;</div><div class="line"><a name="l03648"></a><span class="lineno"> 3648</span>&#160;   }</div><div class="line"><a name="l03649"></a><span class="lineno"> 3649</span>&#160;</div><div class="line"><a name="l03650"></a><span class="lineno"> 3650</span>&#160;   <span class="comment">// Attach the structure</span></div><div class="line"><a name="l03651"></a><span class="lineno"> 3651</span>&#160;   <a class="code" href="structProofServEnv__t.html">ProofServEnv_t</a> *in = (<a class="code" href="structProofServEnv__t.html">ProofServEnv_t</a> *)input;</div><div class="line"><a name="l03652"></a><span class="lineno"> 3652</span>&#160;</div><div class="line"><a name="l03653"></a><span class="lineno"> 3653</span>&#160;   <span class="comment">// Session proxy</span></div><div class="line"><a name="l03654"></a><span class="lineno"> 3654</span>&#160;   <a class="code" href="classXrdProofdProofServ.html">XrdProofdProofServ</a> *xps = in-&gt;<a class="code" href="structProofServEnv__t.html#aefb8c17473f66fe63376b1956ba7ebfa">fPS</a>;</div><div class="line"><a name="l03655"></a><span class="lineno"> 3655</span>&#160;   <span class="keywordflow">if</span> (!xps) {</div><div class="line"><a name="l03656"></a><span class="lineno"> 3656</span>&#160;      <a class="code" href="TGHtml_8h.html#ad5bb4a3d12fd54f29da2b924b29e652b">TRACE</a>(XERR, <span class="stringliteral">&quot;unable to get instance of proofserv proxy&quot;</span>);</div><div class="line"><a name="l03657"></a><span class="lineno"> 3657</span>&#160;      <span class="keywordflow">return</span> -1;</div><div class="line"><a name="l03658"></a><span class="lineno"> 3658</span>&#160;   }</div><div class="line"><a name="l03659"></a><span class="lineno"> 3659</span>&#160;   <span class="keywordtype">int</span> psid = xps-&gt;<a class="code" href="classXrdProofdProofServ.html#aed92a8d3a8b058f1dcf56862365f1939">ID</a>();</div><div class="line"><a name="l03660"></a><span class="lineno"> 3660</span>&#160;</div><div class="line"><a name="l03661"></a><span class="lineno"> 3661</span>&#160;   FILE *frc = fopen(rcfn, <span class="stringliteral">&quot;w&quot;</span>);</div><div class="line"><a name="l03662"></a><span class="lineno"> 3662</span>&#160;   <span class="keywordflow">if</span> (!frc) {</div><div class="line"><a name="l03663"></a><span class="lineno"> 3663</span>&#160;      <a class="code" href="TGHtml_8h.html#ad5bb4a3d12fd54f29da2b924b29e652b">TRACE</a>(XERR, <span class="stringliteral">&quot;unable to open rootrc file: &quot;</span>&lt;&lt;rcfn);</div><div class="line"><a name="l03664"></a><span class="lineno"> 3664</span>&#160;      <span class="keywordflow">return</span> -1;</div><div class="line"><a name="l03665"></a><span class="lineno"> 3665</span>&#160;   }</div><div class="line"><a name="l03666"></a><span class="lineno"> 3666</span>&#160;   <span class="comment">// Symlink to session.rootrc</span></div><div class="line"><a name="l03667"></a><span class="lineno"> 3667</span>&#160;   <span class="keywordflow">if</span> (in-&gt;<a class="code" href="structProofServEnv__t.html#ac49c6760896eeec21cf83929ab709b92">fOld</a>) {</div><div class="line"><a name="l03668"></a><span class="lineno"> 3668</span>&#160;      <span class="keywordflow">if</span> (<a class="code" href="classXrdProofdAux.html#ad76b79992c4bb4774856074413f591c5">XrdProofdAux::SymLink</a>(rcfn, <span class="stringliteral">&quot;session.rootrc&quot;</span>) != 0) {</div><div class="line"><a name="l03669"></a><span class="lineno"> 3669</span>&#160;         <a class="code" href="TGHtml_8h.html#ad5bb4a3d12fd54f29da2b924b29e652b">TRACE</a>(XERR, <span class="stringliteral">&quot;problems creating symlink to &#39;session.rootrc&#39; (errno: &quot;</span>&lt;&lt;errno&lt;&lt;<span class="stringliteral">&quot;)&quot;</span>);</div><div class="line"><a name="l03670"></a><span class="lineno"> 3670</span>&#160;      }</div><div class="line"><a name="l03671"></a><span class="lineno"> 3671</span>&#160;   }</div><div class="line"><a name="l03672"></a><span class="lineno"> 3672</span>&#160;   <a class="code" href="TGHtml_8h.html#ad5bb4a3d12fd54f29da2b924b29e652b">TRACE</a>(REQ, <span class="stringliteral">&quot;session rootrc file: &quot;</span>&lt;&lt; rcfn);</div><div class="line"><a name="l03673"></a><span class="lineno"> 3673</span>&#160;</div><div class="line"><a name="l03674"></a><span class="lineno"> 3674</span>&#160;   <span class="comment">// Port</span></div><div class="line"><a name="l03675"></a><span class="lineno"> 3675</span>&#160;   fprintf(frc, <span class="stringliteral">&quot;# XrdProofdProtocol listening port\n&quot;</span>);</div><div class="line"><a name="l03676"></a><span class="lineno"> 3676</span>&#160;   fprintf(frc, <span class="stringliteral">&quot;ProofServ.XpdPort: %d\n&quot;</span>, <a class="code" href="classXrdProofdProofServMgr.html#a86cac591a5646811e38ff6a2477f4da7">fMgr</a>-&gt;<a class="code" href="classXrdProofdManager.html#a128a9af44f04fdbf956b893c7a16d45b">Port</a>());</div><div class="line"><a name="l03677"></a><span class="lineno"> 3677</span>&#160;</div><div class="line"><a name="l03678"></a><span class="lineno"> 3678</span>&#160;   <span class="comment">// Local root prefix</span></div><div class="line"><a name="l03679"></a><span class="lineno"> 3679</span>&#160;   <span class="keywordflow">if</span> (<a class="code" href="classXrdProofdProofServMgr.html#a86cac591a5646811e38ff6a2477f4da7">fMgr</a>-&gt;<a class="code" href="classXrdProofdManager.html#a032b537f0bbb2fed392e7dd10e8b68e1">LocalROOT</a>() &amp;&amp; strlen(<a class="code" href="classXrdProofdProofServMgr.html#a86cac591a5646811e38ff6a2477f4da7">fMgr</a>-&gt;<a class="code" href="classXrdProofdManager.html#a032b537f0bbb2fed392e7dd10e8b68e1">LocalROOT</a>()) &gt; 0) {</div><div class="line"><a name="l03680"></a><span class="lineno"> 3680</span>&#160;      fprintf(frc, <span class="stringliteral">&quot;# Prefix to be prepended to local paths\n&quot;</span>);</div><div class="line"><a name="l03681"></a><span class="lineno"> 3681</span>&#160;      fprintf(frc, <span class="stringliteral">&quot;Path.Localroot: %s\n&quot;</span>, <a class="code" href="classXrdProofdProofServMgr.html#a86cac591a5646811e38ff6a2477f4da7">fMgr</a>-&gt;<a class="code" href="classXrdProofdManager.html#a032b537f0bbb2fed392e7dd10e8b68e1">LocalROOT</a>());</div><div class="line"><a name="l03682"></a><span class="lineno"> 3682</span>&#160;   }</div><div class="line"><a name="l03683"></a><span class="lineno"> 3683</span>&#160;</div><div class="line"><a name="l03684"></a><span class="lineno"> 3684</span>&#160;   <span class="comment">// Data pool entry-point URL</span></div><div class="line"><a name="l03685"></a><span class="lineno"> 3685</span>&#160;   <span class="keywordflow">if</span> (<a class="code" href="classXrdProofdProofServMgr.html#a86cac591a5646811e38ff6a2477f4da7">fMgr</a>-&gt;<a class="code" href="classXrdProofdManager.html#a42d408e2536d05e8713e2adf87689977">PoolURL</a>() &amp;&amp; strlen(<a class="code" href="classXrdProofdProofServMgr.html#a86cac591a5646811e38ff6a2477f4da7">fMgr</a>-&gt;<a class="code" href="classXrdProofdManager.html#a42d408e2536d05e8713e2adf87689977">PoolURL</a>()) &gt; 0) {</div><div class="line"><a name="l03686"></a><span class="lineno"> 3686</span>&#160;      XrdOucString purl(<a class="code" href="classXrdProofdProofServMgr.html#a86cac591a5646811e38ff6a2477f4da7">fMgr</a>-&gt;<a class="code" href="classXrdProofdManager.html#a42d408e2536d05e8713e2adf87689977">PoolURL</a>());</div><div class="line"><a name="l03687"></a><span class="lineno"> 3687</span>&#160;      <span class="keywordflow">if</span> (!purl.endswith(<span class="stringliteral">&quot;/&quot;</span>))</div><div class="line"><a name="l03688"></a><span class="lineno"> 3688</span>&#160;         purl += <span class="stringliteral">&quot;/&quot;</span>;</div><div class="line"><a name="l03689"></a><span class="lineno"> 3689</span>&#160;      fprintf(frc, <span class="stringliteral">&quot;# URL for the data pool entry-point\n&quot;</span>);</div><div class="line"><a name="l03690"></a><span class="lineno"> 3690</span>&#160;      fprintf(frc, <span class="stringliteral">&quot;ProofServ.PoolUrl: %s\n&quot;</span>, purl.c_str());</div><div class="line"><a name="l03691"></a><span class="lineno"> 3691</span>&#160;   }</div><div class="line"><a name="l03692"></a><span class="lineno"> 3692</span>&#160;</div><div class="line"><a name="l03693"></a><span class="lineno"> 3693</span>&#160;   <span class="comment">// The session working dir depends on the role</span></div><div class="line"><a name="l03694"></a><span class="lineno"> 3694</span>&#160;   <span class="keywordflow">if</span> (in-&gt;<a class="code" href="structProofServEnv__t.html#ac49c6760896eeec21cf83929ab709b92">fOld</a>) {</div><div class="line"><a name="l03695"></a><span class="lineno"> 3695</span>&#160;      fprintf(frc, <span class="stringliteral">&quot;# The session working dir\n&quot;</span>);</div><div class="line"><a name="l03696"></a><span class="lineno"> 3696</span>&#160;      fprintf(frc, <span class="stringliteral">&quot;ProofServ.SessionDir: %s\n&quot;</span>, in-&gt;<a class="code" href="structProofServEnv__t.html#a24e0948cb1405b0d8c8360500ef20707">fWrkDir</a>.c_str());</div><div class="line"><a name="l03697"></a><span class="lineno"> 3697</span>&#160;   }</div><div class="line"><a name="l03698"></a><span class="lineno"> 3698</span>&#160;</div><div class="line"><a name="l03699"></a><span class="lineno"> 3699</span>&#160;   <span class="comment">// Log / Debug level</span></div><div class="line"><a name="l03700"></a><span class="lineno"> 3700</span>&#160;   fprintf(frc, <span class="stringliteral">&quot;# Proof Log/Debug level\n&quot;</span>);</div><div class="line"><a name="l03701"></a><span class="lineno"> 3701</span>&#160;   fprintf(frc, <span class="stringliteral">&quot;Proof.DebugLevel: %d\n&quot;</span>, in-&gt;<a class="code" href="structProofServEnv__t.html#ae56c69243c25974348f800a355305960">fLogLevel</a>);</div><div class="line"><a name="l03702"></a><span class="lineno"> 3702</span>&#160;</div><div class="line"><a name="l03703"></a><span class="lineno"> 3703</span>&#160;   <span class="comment">// Ordinal number</span></div><div class="line"><a name="l03704"></a><span class="lineno"> 3704</span>&#160;   fprintf(frc, <span class="stringliteral">&quot;# Ordinal number\n&quot;</span>);</div><div class="line"><a name="l03705"></a><span class="lineno"> 3705</span>&#160;   fprintf(frc, <span class="stringliteral">&quot;ProofServ.Ordinal: %s\n&quot;</span>, xps-&gt;<a class="code" href="classXrdProofdProofServ.html#a85958cf8241aee02a376befe6ab98e98">Ordinal</a>());</div><div class="line"><a name="l03706"></a><span class="lineno"> 3706</span>&#160;</div><div class="line"><a name="l03707"></a><span class="lineno"> 3707</span>&#160;   <span class="comment">// ROOT Version tag</span></div><div class="line"><a name="l03708"></a><span class="lineno"> 3708</span>&#160;   <span class="keywordflow">if</span> (p-&gt;<a class="code" href="classXrdProofdProtocol.html#a80024c8f848d0eabe9f13d09f06c8d9d">Client</a>()-&gt;<a class="code" href="classXrdProofdClient.html#a55c0e73c9bca2a64fd6417d750db02e2">ROOT</a>()) {</div><div class="line"><a name="l03709"></a><span class="lineno"> 3709</span>&#160;      fprintf(frc, <span class="stringliteral">&quot;# ROOT Version tag\n&quot;</span>);</div><div class="line"><a name="l03710"></a><span class="lineno"> 3710</span>&#160;      fprintf(frc, <span class="stringliteral">&quot;ProofServ.RootVersionTag: %s\n&quot;</span>, p-&gt;<a class="code" href="classXrdProofdProtocol.html#a80024c8f848d0eabe9f13d09f06c8d9d">Client</a>()-&gt;<a class="code" href="classXrdProofdClient.html#a55c0e73c9bca2a64fd6417d750db02e2">ROOT</a>()-&gt;<a class="code" href="classXrdROOT.html#a3b1e4b60cbd1b7fcd87a583a9e664b24">Tag</a>());</div><div class="line"><a name="l03711"></a><span class="lineno"> 3711</span>&#160;   }</div><div class="line"><a name="l03712"></a><span class="lineno"> 3712</span>&#160;   <span class="comment">// Proof group</span></div><div class="line"><a name="l03713"></a><span class="lineno"> 3713</span>&#160;   <span class="keywordflow">if</span> (p-&gt;<a class="code" href="classXrdProofdProtocol.html#a80024c8f848d0eabe9f13d09f06c8d9d">Client</a>()-&gt;<a class="code" href="classXrdProofdClient.html#af82bc301c99dc688038ba2c771b5c49e">Group</a>()) {</div><div class="line"><a name="l03714"></a><span class="lineno"> 3714</span>&#160;      fprintf(frc, <span class="stringliteral">&quot;# Proof group\n&quot;</span>);</div><div class="line"><a name="l03715"></a><span class="lineno"> 3715</span>&#160;      fprintf(frc, <span class="stringliteral">&quot;ProofServ.ProofGroup: %s\n&quot;</span>, p-&gt;<a class="code" href="classXrdProofdProtocol.html#a80024c8f848d0eabe9f13d09f06c8d9d">Client</a>()-&gt;<a class="code" href="classXrdProofdClient.html#af82bc301c99dc688038ba2c771b5c49e">Group</a>());</div><div class="line"><a name="l03716"></a><span class="lineno"> 3716</span>&#160;   }</div><div class="line"><a name="l03717"></a><span class="lineno"> 3717</span>&#160;</div><div class="line"><a name="l03718"></a><span class="lineno"> 3718</span>&#160;   <span class="comment">//  Path to file with group information</span></div><div class="line"><a name="l03719"></a><span class="lineno"> 3719</span>&#160;   <span class="keywordflow">if</span> (<a class="code" href="classXrdProofdProofServMgr.html#a86cac591a5646811e38ff6a2477f4da7">fMgr</a>-&gt;<a class="code" href="classXrdProofdManager.html#adef641b27f2dc86766634d156cb82476">GroupsMgr</a>() &amp;&amp; <a class="code" href="classXrdProofdProofServMgr.html#a86cac591a5646811e38ff6a2477f4da7">fMgr</a>-&gt;<a class="code" href="classXrdProofdManager.html#adef641b27f2dc86766634d156cb82476">GroupsMgr</a>()-&gt;<a class="code" href="classXrdProofGroupMgr.html#af8c3bc68c9a7100f752c9c4e536c2f03">GetCfgFile</a>()) {</div><div class="line"><a name="l03720"></a><span class="lineno"> 3720</span>&#160;      fprintf(frc, <span class="stringliteral">&quot;# File with group information\n&quot;</span>);</div><div class="line"><a name="l03721"></a><span class="lineno"> 3721</span>&#160;      fprintf(frc, <span class="stringliteral">&quot;Proof.GroupFile: %s\n&quot;</span>, <a class="code" href="classXrdProofdProofServMgr.html#a86cac591a5646811e38ff6a2477f4da7">fMgr</a>-&gt;<a class="code" href="classXrdProofdManager.html#adef641b27f2dc86766634d156cb82476">GroupsMgr</a>()-&gt;<a class="code" href="classXrdProofGroupMgr.html#af8c3bc68c9a7100f752c9c4e536c2f03">GetCfgFile</a>());</div><div class="line"><a name="l03722"></a><span class="lineno"> 3722</span>&#160;   }</div><div class="line"><a name="l03723"></a><span class="lineno"> 3723</span>&#160;</div><div class="line"><a name="l03724"></a><span class="lineno"> 3724</span>&#160;   <span class="comment">// Work dir</span></div><div class="line"><a name="l03725"></a><span class="lineno"> 3725</span>&#160;   XrdOucString udir = p-&gt;<a class="code" href="classXrdProofdProtocol.html#a80024c8f848d0eabe9f13d09f06c8d9d">Client</a>()-&gt;<a class="code" href="classXrdProofdClient.html#a8ea0bbb76949d36f85b223cab59db0d7">Sandbox</a>()-&gt;<a class="code" href="classXrdProofdSandbox.html#ad067010c4a92eee6dac2aa0dbc679bf4">Dir</a>();</div><div class="line"><a name="l03726"></a><span class="lineno"> 3726</span>&#160;   fprintf(frc, <span class="stringliteral">&quot;# Users sandbox\n&quot;</span>);</div><div class="line"><a name="l03727"></a><span class="lineno"> 3727</span>&#160;   fprintf(frc, <span class="stringliteral">&quot;ProofServ.Sandbox: %s\n&quot;</span>, udir.c_str());</div><div class="line"><a name="l03728"></a><span class="lineno"> 3728</span>&#160;</div><div class="line"><a name="l03729"></a><span class="lineno"> 3729</span>&#160;   <span class="comment">// Image</span></div><div class="line"><a name="l03730"></a><span class="lineno"> 3730</span>&#160;   <span class="keywordflow">if</span> (<a class="code" href="classXrdProofdProofServMgr.html#a86cac591a5646811e38ff6a2477f4da7">fMgr</a>-&gt;<a class="code" href="classXrdProofdManager.html#ad0515f5873ad4e10c35f7b7dc1ec885f">Image</a>() &amp;&amp; strlen(<a class="code" href="classXrdProofdProofServMgr.html#a86cac591a5646811e38ff6a2477f4da7">fMgr</a>-&gt;<a class="code" href="classXrdProofdManager.html#ad0515f5873ad4e10c35f7b7dc1ec885f">Image</a>()) &gt; 0) {</div><div class="line"><a name="l03731"></a><span class="lineno"> 3731</span>&#160;      fprintf(frc, <span class="stringliteral">&quot;# Server image\n&quot;</span>);</div><div class="line"><a name="l03732"></a><span class="lineno"> 3732</span>&#160;      fprintf(frc, <span class="stringliteral">&quot;ProofServ.Image: %s\n&quot;</span>, <a class="code" href="classXrdProofdProofServMgr.html#a86cac591a5646811e38ff6a2477f4da7">fMgr</a>-&gt;<a class="code" href="classXrdProofdManager.html#ad0515f5873ad4e10c35f7b7dc1ec885f">Image</a>());</div><div class="line"><a name="l03733"></a><span class="lineno"> 3733</span>&#160;   }</div><div class="line"><a name="l03734"></a><span class="lineno"> 3734</span>&#160;</div><div class="line"><a name="l03735"></a><span class="lineno"> 3735</span>&#160;   <span class="comment">// Session tags</span></div><div class="line"><a name="l03736"></a><span class="lineno"> 3736</span>&#160;   <span class="keywordflow">if</span> (in-&gt;<a class="code" href="structProofServEnv__t.html#ac49c6760896eeec21cf83929ab709b92">fOld</a>) {</div><div class="line"><a name="l03737"></a><span class="lineno"> 3737</span>&#160;      fprintf(frc, <span class="stringliteral">&quot;# Session tag\n&quot;</span>);</div><div class="line"><a name="l03738"></a><span class="lineno"> 3738</span>&#160;      fprintf(frc, <span class="stringliteral">&quot;ProofServ.SessionTag: %s\n&quot;</span>, in-&gt;<a class="code" href="structProofServEnv__t.html#af4140705c69b78b2c0fd55131a0844dd">fSessionTag</a>.c_str());</div><div class="line"><a name="l03739"></a><span class="lineno"> 3739</span>&#160;      fprintf(frc, <span class="stringliteral">&quot;# Top Session tag\n&quot;</span>);</div><div class="line"><a name="l03740"></a><span class="lineno"> 3740</span>&#160;      fprintf(frc, <span class="stringliteral">&quot;ProofServ.TopSessionTag: %s\n&quot;</span>, in-&gt;<a class="code" href="structProofServEnv__t.html#a063361fdad238f075537682178fdd1b3">fTopSessionTag</a>.c_str());</div><div class="line"><a name="l03741"></a><span class="lineno"> 3741</span>&#160;   }</div><div class="line"><a name="l03742"></a><span class="lineno"> 3742</span>&#160;</div><div class="line"><a name="l03743"></a><span class="lineno"> 3743</span>&#160;   <span class="comment">// Session admin path</span></div><div class="line"><a name="l03744"></a><span class="lineno"> 3744</span>&#160;   fprintf(frc, <span class="stringliteral">&quot;# Session admin path\n&quot;</span>);</div><div class="line"><a name="l03745"></a><span class="lineno"> 3745</span>&#160;   <span class="keywordtype">int</span> proofvrs = (p-&gt;<a class="code" href="classXrdProofdProtocol.html#a80024c8f848d0eabe9f13d09f06c8d9d">Client</a>()-&gt;<a class="code" href="classXrdProofdClient.html#a55c0e73c9bca2a64fd6417d750db02e2">ROOT</a>()) ? p-&gt;<a class="code" href="classXrdProofdProtocol.html#a80024c8f848d0eabe9f13d09f06c8d9d">Client</a>()-&gt;<a class="code" href="classXrdProofdClient.html#a55c0e73c9bca2a64fd6417d750db02e2">ROOT</a>()-&gt;<a class="code" href="classXrdROOT.html#a9c3ee0a503928edaab2675dd4d6638b0">SrvProtVers</a>() : -1;</div><div class="line"><a name="l03746"></a><span class="lineno"> 3746</span>&#160;   <span class="keywordflow">if</span> (proofvrs &lt; 0 || proofvrs &lt; 27) {</div><div class="line"><a name="l03747"></a><span class="lineno"> 3747</span>&#160;      <span class="comment">// Use the first version of the session status file</span></div><div class="line"><a name="l03748"></a><span class="lineno"> 3748</span>&#160;      fprintf(frc, <span class="stringliteral">&quot;ProofServ.AdminPath: %s\n&quot;</span>, xps-&gt;<a class="code" href="classXrdProofdProofServ.html#a25ba137320d90e008bd46533da88263c">AdminPath</a>());</div><div class="line"><a name="l03749"></a><span class="lineno"> 3749</span>&#160;   } <span class="keywordflow">else</span> {</div><div class="line"><a name="l03750"></a><span class="lineno"> 3750</span>&#160;      <span class="keywordflow">if</span> (in-&gt;<a class="code" href="structProofServEnv__t.html#ac49c6760896eeec21cf83929ab709b92">fOld</a>) {</div><div class="line"><a name="l03751"></a><span class="lineno"> 3751</span>&#160;         <span class="comment">// New version with updated status</span></div><div class="line"><a name="l03752"></a><span class="lineno"> 3752</span>&#160;         fprintf(frc, <span class="stringliteral">&quot;ProofServ.AdminPath: %s.status\n&quot;</span>, xps-&gt;<a class="code" href="classXrdProofdProofServ.html#a25ba137320d90e008bd46533da88263c">AdminPath</a>());</div><div class="line"><a name="l03753"></a><span class="lineno"> 3753</span>&#160;      }</div><div class="line"><a name="l03754"></a><span class="lineno"> 3754</span>&#160;   }</div><div class="line"><a name="l03755"></a><span class="lineno"> 3755</span>&#160;</div><div class="line"><a name="l03756"></a><span class="lineno"> 3756</span>&#160;   <span class="comment">// Whether user specific config files are enabled</span></div><div class="line"><a name="l03757"></a><span class="lineno"> 3757</span>&#160;   <span class="keywordflow">if</span> (<a class="code" href="classXrdProofdProofServMgr.html#a86cac591a5646811e38ff6a2477f4da7">fMgr</a>-&gt;<a class="code" href="classXrdProofdManager.html#a597b5254d01ca1a0ad35e6e3b968426d">NetMgr</a>()-&gt;<a class="code" href="classXrdProofdNetMgr.html#a1bf0698adc9754833d617a1b2d7361ca">WorkerUsrCfg</a>()) {</div><div class="line"><a name="l03758"></a><span class="lineno"> 3758</span>&#160;      fprintf(frc, <span class="stringliteral">&quot;# Whether user specific config files are enabled\n&quot;</span>);</div><div class="line"><a name="l03759"></a><span class="lineno"> 3759</span>&#160;      fprintf(frc, <span class="stringliteral">&quot;ProofServ.UseUserCfg: 1\n&quot;</span>);</div><div class="line"><a name="l03760"></a><span class="lineno"> 3760</span>&#160;   }</div><div class="line"><a name="l03761"></a><span class="lineno"> 3761</span>&#160;   <span class="comment">// Set Open socket</span></div><div class="line"><a name="l03762"></a><span class="lineno"> 3762</span>&#160;   fprintf(frc, <span class="stringliteral">&quot;# Open socket\n&quot;</span>);</div><div class="line"><a name="l03763"></a><span class="lineno"> 3763</span>&#160;   fprintf(frc, <span class="stringliteral">&quot;ProofServ.OpenSock: %s\n&quot;</span>, xps-&gt;<a class="code" href="classXrdProofdProofServ.html#adbac6b3286754cb303806f8d70e58765">UNIXSockPath</a>());</div><div class="line"><a name="l03764"></a><span class="lineno"> 3764</span>&#160;   <span class="comment">// Entity</span></div><div class="line"><a name="l03765"></a><span class="lineno"> 3765</span>&#160;   fprintf(frc, <span class="stringliteral">&quot;# Entity\n&quot;</span>);</div><div class="line"><a name="l03766"></a><span class="lineno"> 3766</span>&#160;   <span class="keywordflow">if</span> (p-&gt;<a class="code" href="classXrdProofdProtocol.html#a80024c8f848d0eabe9f13d09f06c8d9d">Client</a>()-&gt;<a class="code" href="classXrdProofdClient.html#a062a4396b4b8f0667f3a97a64c7f1c3d">UI</a>().<a class="code" href="classXrdProofUI.html#a8ddfeaa660ae3a4798b11e9222c7a742">fGroup</a>.length() &gt; 0)</div><div class="line"><a name="l03767"></a><span class="lineno"> 3767</span>&#160;      fprintf(frc, <span class="stringliteral">&quot;ProofServ.Entity: %s:%s@%s\n&quot;</span>,</div><div class="line"><a name="l03768"></a><span class="lineno"> 3768</span>&#160;              p-&gt;<a class="code" href="classXrdProofdProtocol.html#a80024c8f848d0eabe9f13d09f06c8d9d">Client</a>()-&gt;<a class="code" href="classXrdProofdClient.html#a3cbe604999cdb44ae9d0ec833ffa5900">User</a>(), p-&gt;<a class="code" href="classXrdProofdProtocol.html#a80024c8f848d0eabe9f13d09f06c8d9d">Client</a>()-&gt;<a class="code" href="classXrdProofdClient.html#a062a4396b4b8f0667f3a97a64c7f1c3d">UI</a>().<a class="code" href="classXrdProofUI.html#a8ddfeaa660ae3a4798b11e9222c7a742">fGroup</a>.c_str(), p-&gt;<a class="code" href="classXrdProofdProtocol.html#aff71b1d49b22d2453ed2a7302599de14">Link</a>()-&gt;Host());</div><div class="line"><a name="l03769"></a><span class="lineno"> 3769</span>&#160;   <span class="keywordflow">else</span></div><div class="line"><a name="l03770"></a><span class="lineno"> 3770</span>&#160;      fprintf(frc, <span class="stringliteral">&quot;ProofServ.Entity: %s@%s\n&quot;</span>, p-&gt;<a class="code" href="classXrdProofdProtocol.html#a80024c8f848d0eabe9f13d09f06c8d9d">Client</a>()-&gt;<a class="code" href="classXrdProofdClient.html#a3cbe604999cdb44ae9d0ec833ffa5900">User</a>(), p-&gt;<a class="code" href="classXrdProofdProtocol.html#aff71b1d49b22d2453ed2a7302599de14">Link</a>()-&gt;Host());</div><div class="line"><a name="l03771"></a><span class="lineno"> 3771</span>&#160;</div><div class="line"><a name="l03772"></a><span class="lineno"> 3772</span>&#160;</div><div class="line"><a name="l03773"></a><span class="lineno"> 3773</span>&#160;   <span class="comment">// Session ID</span></div><div class="line"><a name="l03774"></a><span class="lineno"> 3774</span>&#160;   fprintf(frc, <span class="stringliteral">&quot;# Session ID\n&quot;</span>);</div><div class="line"><a name="l03775"></a><span class="lineno"> 3775</span>&#160;   fprintf(frc, <span class="stringliteral">&quot;ProofServ.SessionID: %d\n&quot;</span>, psid);</div><div class="line"><a name="l03776"></a><span class="lineno"> 3776</span>&#160;</div><div class="line"><a name="l03777"></a><span class="lineno"> 3777</span>&#160;   <span class="comment">// Client ID</span></div><div class="line"><a name="l03778"></a><span class="lineno"> 3778</span>&#160;   fprintf(frc, <span class="stringliteral">&quot;# Client ID\n&quot;</span>);</div><div class="line"><a name="l03779"></a><span class="lineno"> 3779</span>&#160;   fprintf(frc, <span class="stringliteral">&quot;ProofServ.ClientID: %d\n&quot;</span>, p-&gt;<a class="code" href="classXrdProofdProtocol.html#a934bd88037498a09c684297fca7b664f">CID</a>());</div><div class="line"><a name="l03780"></a><span class="lineno"> 3780</span>&#160;</div><div class="line"><a name="l03781"></a><span class="lineno"> 3781</span>&#160;   <span class="comment">// Client Protocol</span></div><div class="line"><a name="l03782"></a><span class="lineno"> 3782</span>&#160;   fprintf(frc, <span class="stringliteral">&quot;# Client Protocol\n&quot;</span>);</div><div class="line"><a name="l03783"></a><span class="lineno"> 3783</span>&#160;   fprintf(frc, <span class="stringliteral">&quot;ProofServ.ClientVersion: %d\n&quot;</span>, p-&gt;<a class="code" href="classXrdProofdProtocol.html#a40b8bfa9e731284a08eee0d419b6ffd5">ProofProtocol</a>());</div><div class="line"><a name="l03784"></a><span class="lineno"> 3784</span>&#160;</div><div class="line"><a name="l03785"></a><span class="lineno"> 3785</span>&#160;   <span class="comment">// Config file</span></div><div class="line"><a name="l03786"></a><span class="lineno"> 3786</span>&#160;   <span class="keywordflow">if</span> (in-&gt;<a class="code" href="structProofServEnv__t.html#a68a3d979f6cccf40aaf61893f48461c1">fCfg</a>.length() &gt; 0) {</div><div class="line"><a name="l03787"></a><span class="lineno"> 3787</span>&#160;      <span class="keywordflow">if</span> (in-&gt;<a class="code" href="structProofServEnv__t.html#a68a3d979f6cccf40aaf61893f48461c1">fCfg</a> == <span class="stringliteral">&quot;masteronly&quot;</span>) {</div><div class="line"><a name="l03788"></a><span class="lineno"> 3788</span>&#160;         fprintf(frc, <span class="stringliteral">&quot;# MasterOnly option\n&quot;</span>);</div><div class="line"><a name="l03789"></a><span class="lineno"> 3789</span>&#160;         <span class="comment">// Master Only setup</span></div><div class="line"><a name="l03790"></a><span class="lineno"> 3790</span>&#160;         fprintf(frc, <span class="stringliteral">&quot;Proof.MasterOnly: 1\n&quot;</span>);</div><div class="line"><a name="l03791"></a><span class="lineno"> 3791</span>&#160;      } <span class="keywordflow">else</span> {</div><div class="line"><a name="l03792"></a><span class="lineno"> 3792</span>&#160;         fprintf(frc, <span class="stringliteral">&quot;# Config file\n&quot;</span>);</div><div class="line"><a name="l03793"></a><span class="lineno"> 3793</span>&#160;         <span class="comment">// User defined</span></div><div class="line"><a name="l03794"></a><span class="lineno"> 3794</span>&#160;         fprintf(frc, <span class="stringliteral">&quot;ProofServ.ProofConfFile: %s\n&quot;</span>, in-&gt;<a class="code" href="structProofServEnv__t.html#a68a3d979f6cccf40aaf61893f48461c1">fCfg</a>.c_str());</div><div class="line"><a name="l03795"></a><span class="lineno"> 3795</span>&#160;      }</div><div class="line"><a name="l03796"></a><span class="lineno"> 3796</span>&#160;   } <span class="keywordflow">else</span> {</div><div class="line"><a name="l03797"></a><span class="lineno"> 3797</span>&#160;      fprintf(frc, <span class="stringliteral">&quot;# Config file\n&quot;</span>);</div><div class="line"><a name="l03798"></a><span class="lineno"> 3798</span>&#160;      <span class="keywordflow">if</span> (<a class="code" href="classXrdProofdProofServMgr.html#a86cac591a5646811e38ff6a2477f4da7">fMgr</a>-&gt;<a class="code" href="classXrdProofdManager.html#a4f68981d1bc8bd7a567a2404c47fa7c4">IsSuperMst</a>()) {</div><div class="line"><a name="l03799"></a><span class="lineno"> 3799</span>&#160;         fprintf(frc, <span class="stringliteral">&quot;ProofServ.ProofConfFile: sm:\n&quot;</span>);</div><div class="line"><a name="l03800"></a><span class="lineno"> 3800</span>&#160;      } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (xps-&gt;<a class="code" href="classXrdProofdProofServ.html#a4531e00216dd973a625c6d6b27c5f0a9">IsPLite</a>()) {</div><div class="line"><a name="l03801"></a><span class="lineno"> 3801</span>&#160;         fprintf(frc, <span class="stringliteral">&quot;ProofServ.ProofConfFile: lite:\n&quot;</span>);</div><div class="line"><a name="l03802"></a><span class="lineno"> 3802</span>&#160;         fprintf(frc, <span class="stringliteral">&quot;# Number of ProofLite workers\n&quot;</span>);</div><div class="line"><a name="l03803"></a><span class="lineno"> 3803</span>&#160;         fprintf(frc, <span class="stringliteral">&quot;ProofLite.Workers: %d\n&quot;</span>, xps-&gt;<a class="code" href="classXrdProofdProofServ.html#abe2e0f70032b4113cf16bd9554335bb7">PLiteNWrks</a>());</div><div class="line"><a name="l03804"></a><span class="lineno"> 3804</span>&#160;         fprintf(frc, <span class="stringliteral">&quot;# Users sandbox\n&quot;</span>);</div><div class="line"><a name="l03805"></a><span class="lineno"> 3805</span>&#160;         fprintf(frc, <span class="stringliteral">&quot;ProofLite.Sandbox: %s\n&quot;</span>, udir.c_str());</div><div class="line"><a name="l03806"></a><span class="lineno"> 3806</span>&#160;         fprintf(frc, <span class="stringliteral">&quot;# No subpaths\n&quot;</span>);</div><div class="line"><a name="l03807"></a><span class="lineno"> 3807</span>&#160;         fprintf(frc, <span class="stringliteral">&quot;ProofLite.SubPath: 0\n&quot;</span>);</div><div class="line"><a name="l03808"></a><span class="lineno"> 3808</span>&#160;      } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="classXrdProofdProofServMgr.html#ad8126ec253b738adc2ae64a95354edec">fProofPlugin</a>.length() &gt; 0) {</div><div class="line"><a name="l03809"></a><span class="lineno"> 3809</span>&#160;         fprintf(frc, <span class="stringliteral">&quot;ProofServ.ProofConfFile: %s\n&quot;</span>, <a class="code" href="classXrdProofdProofServMgr.html#ad8126ec253b738adc2ae64a95354edec">fProofPlugin</a>.c_str());</div><div class="line"><a name="l03810"></a><span class="lineno"> 3810</span>&#160;      }</div><div class="line"><a name="l03811"></a><span class="lineno"> 3811</span>&#160;   }</div><div class="line"><a name="l03812"></a><span class="lineno"> 3812</span>&#160;</div><div class="line"><a name="l03813"></a><span class="lineno"> 3813</span>&#160;   <span class="comment">// We set this to avoid blocking to much on xrdclient actions; they can be</span></div><div class="line"><a name="l03814"></a><span class="lineno"> 3814</span>&#160;   <span class="comment">// oevrwritten with explicit putrc directives</span></div><div class="line"><a name="l03815"></a><span class="lineno"> 3815</span>&#160;   fprintf(frc, <span class="stringliteral">&quot;# Default settings for XrdClient\n&quot;</span>);</div><div class="line"><a name="l03816"></a><span class="lineno"> 3816</span>&#160;   fprintf(frc, <span class="stringliteral">&quot;XNet.FirstConnectMaxCnt 3\n&quot;</span>);</div><div class="line"><a name="l03817"></a><span class="lineno"> 3817</span>&#160;   fprintf(frc, <span class="stringliteral">&quot;XNet.ConnectTimeout     5\n&quot;</span>);</div><div class="line"><a name="l03818"></a><span class="lineno"> 3818</span>&#160;</div><div class="line"><a name="l03819"></a><span class="lineno"> 3819</span>&#160;   <span class="comment">// This is a workaround for a problem fixed in 5.24/00</span></div><div class="line"><a name="l03820"></a><span class="lineno"> 3820</span>&#160;   <span class="keywordtype">int</span> vrscode = (p-&gt;<a class="code" href="classXrdProofdProtocol.html#a80024c8f848d0eabe9f13d09f06c8d9d">Client</a>()-&gt;<a class="code" href="classXrdProofdClient.html#a55c0e73c9bca2a64fd6417d750db02e2">ROOT</a>()) ? p-&gt;<a class="code" href="classXrdProofdProtocol.html#a80024c8f848d0eabe9f13d09f06c8d9d">Client</a>()-&gt;<a class="code" href="classXrdProofdClient.html#a55c0e73c9bca2a64fd6417d750db02e2">ROOT</a>()-&gt;<a class="code" href="classXrdROOT.html#a8d85b526df3fbd35ee5d4daee3d6ab0b">VersionCode</a>() : -1;</div><div class="line"><a name="l03821"></a><span class="lineno"> 3821</span>&#160;   <span class="keywordflow">if</span> (vrscode &gt; 0 &amp;&amp; vrscode &lt; <a class="code" href="classXrdROOT.html#a49b703e609515a9b0fdbf90066edac8d">XrdROOT::GetVersionCode</a>(5,24,0)) {</div><div class="line"><a name="l03822"></a><span class="lineno"> 3822</span>&#160;      fprintf(frc, <span class="stringliteral">&quot;# Force remote reading also for local files to avoid a wrong TTreeCache initialization\n&quot;</span>);</div><div class="line"><a name="l03823"></a><span class="lineno"> 3823</span>&#160;      fprintf(frc, <span class="stringliteral">&quot;Path.ForceRemote 1\n&quot;</span>);</div><div class="line"><a name="l03824"></a><span class="lineno"> 3824</span>&#160;   }</div><div class="line"><a name="l03825"></a><span class="lineno"> 3825</span>&#160;</div><div class="line"><a name="l03826"></a><span class="lineno"> 3826</span>&#160;   <span class="comment">// Additional rootrcs (xpd.putrc directive)</span></div><div class="line"><a name="l03827"></a><span class="lineno"> 3827</span>&#160;   {  <a class="code" href="XrdSysToOuc_8h.html#a4ba18bedbb8a1a4367d57f49a4d773ce">XrdSysMutexHelper</a> mhp(<a class="code" href="classXrdProofdProofServMgr.html#af244f1c4fd9592313e3cfc4bdeb64aaf">fEnvsMutex</a>);</div><div class="line"><a name="l03828"></a><span class="lineno"> 3828</span>&#160;      <span class="keywordflow">if</span> (<a class="code" href="classXrdProofdProofServMgr.html#acaa26797a7f4b194dd8f3f5d39be11af">fProofServRCs</a>.size() &gt; 0) {</div><div class="line"><a name="l03829"></a><span class="lineno"> 3829</span>&#160;         fprintf(frc, <span class="stringliteral">&quot;# Additional rootrcs (xpd.putrc directives)\n&quot;</span>);</div><div class="line"><a name="l03830"></a><span class="lineno"> 3830</span>&#160;         <span class="comment">// Hash list of the directives applying to this {user, group, svn, version}</span></div><div class="line"><a name="l03831"></a><span class="lineno"> 3831</span>&#160;         XrdOucHash&lt;XpdEnv&gt; sessrcs;</div><div class="line"><a name="l03832"></a><span class="lineno"> 3832</span>&#160;         std::list&lt;XpdEnv&gt;::iterator ircs = <a class="code" href="classXrdProofdProofServMgr.html#acaa26797a7f4b194dd8f3f5d39be11af">fProofServRCs</a>.begin();</div><div class="line"><a name="l03833"></a><span class="lineno"> 3833</span>&#160;         <span class="keywordflow">for</span> ( ; ircs != <a class="code" href="classXrdProofdProofServMgr.html#acaa26797a7f4b194dd8f3f5d39be11af">fProofServRCs</a>.end(); ++ircs) {</div><div class="line"><a name="l03834"></a><span class="lineno"> 3834</span>&#160;            <span class="keywordtype">int</span> rcmatch = (*ircs).Matches(p-&gt;<a class="code" href="classXrdProofdProtocol.html#a80024c8f848d0eabe9f13d09f06c8d9d">Client</a>()-&gt;<a class="code" href="classXrdProofdClient.html#a3cbe604999cdb44ae9d0ec833ffa5900">User</a>(), p-&gt;<a class="code" href="classXrdProofdProtocol.html#a80024c8f848d0eabe9f13d09f06c8d9d">Client</a>()-&gt;<a class="code" href="classXrdProofdClient.html#af82bc301c99dc688038ba2c771b5c49e">Group</a>(),</div><div class="line"><a name="l03835"></a><span class="lineno"> 3835</span>&#160;                                          p-&gt;<a class="code" href="classXrdProofdProtocol.html#a80024c8f848d0eabe9f13d09f06c8d9d">Client</a>()-&gt;<a class="code" href="classXrdProofdClient.html#a55c0e73c9bca2a64fd6417d750db02e2">ROOT</a>()-&gt;<a class="code" href="classXrdROOT.html#a8d85b526df3fbd35ee5d4daee3d6ab0b">VersionCode</a>());</div><div class="line"><a name="l03836"></a><span class="lineno"> 3836</span>&#160;            <span class="keywordflow">if</span> (rcmatch &gt;= 0) {</div><div class="line"><a name="l03837"></a><span class="lineno"> 3837</span>&#160;               <a class="code" href="classXpdEnv.html">XpdEnv</a> *rcenv = sessrcs.Find((*ircs).fName.c_str());</div><div class="line"><a name="l03838"></a><span class="lineno"> 3838</span>&#160;               <span class="keywordflow">if</span> (rcenv) {</div><div class="line"><a name="l03839"></a><span class="lineno"> 3839</span>&#160;                  <span class="keywordtype">int</span> rcmtcex = rcenv-&gt;<a class="code" href="classXpdEnv.html#a6bc4c90b8cc7074d6a8ee356c5de481d">Matches</a>(p-&gt;<a class="code" href="classXrdProofdProtocol.html#a80024c8f848d0eabe9f13d09f06c8d9d">Client</a>()-&gt;<a class="code" href="classXrdProofdClient.html#a3cbe604999cdb44ae9d0ec833ffa5900">User</a>(), p-&gt;<a class="code" href="classXrdProofdProtocol.html#a80024c8f848d0eabe9f13d09f06c8d9d">Client</a>()-&gt;<a class="code" href="classXrdProofdClient.html#af82bc301c99dc688038ba2c771b5c49e">Group</a>(),</div><div class="line"><a name="l03840"></a><span class="lineno"> 3840</span>&#160;                                               p-&gt;<a class="code" href="classXrdProofdProtocol.html#a80024c8f848d0eabe9f13d09f06c8d9d">Client</a>()-&gt;<a class="code" href="classXrdProofdClient.html#a55c0e73c9bca2a64fd6417d750db02e2">ROOT</a>()-&gt;<a class="code" href="classXrdROOT.html#a8d85b526df3fbd35ee5d4daee3d6ab0b">VersionCode</a>());</div><div class="line"><a name="l03841"></a><span class="lineno"> 3841</span>&#160;                  <span class="keywordflow">if</span> (rcmatch &gt; rcmtcex) {</div><div class="line"><a name="l03842"></a><span class="lineno"> 3842</span>&#160;                     <span class="comment">// Replace the entry</span></div><div class="line"><a name="l03843"></a><span class="lineno"> 3843</span>&#160;                     rcenv = &amp;(*ircs);</div><div class="line"><a name="l03844"></a><span class="lineno"> 3844</span>&#160;                     sessrcs.Rep(rcenv-&gt;<a class="code" href="classXpdEnv.html#abe05770535de8187358d757e532da911">fName</a>.c_str(), rcenv, 0, Hash_keepdata);</div><div class="line"><a name="l03845"></a><span class="lineno"> 3845</span>&#160;                  }</div><div class="line"><a name="l03846"></a><span class="lineno"> 3846</span>&#160;               } <span class="keywordflow">else</span> {</div><div class="line"><a name="l03847"></a><span class="lineno"> 3847</span>&#160;                  <span class="comment">// Add an entry</span></div><div class="line"><a name="l03848"></a><span class="lineno"> 3848</span>&#160;                  rcenv = &amp;(*ircs);</div><div class="line"><a name="l03849"></a><span class="lineno"> 3849</span>&#160;                  sessrcs.Add(rcenv-&gt;<a class="code" href="classXpdEnv.html#abe05770535de8187358d757e532da911">fName</a>.c_str(), rcenv, 0, Hash_keepdata);</div><div class="line"><a name="l03850"></a><span class="lineno"> 3850</span>&#160;               }</div><div class="line"><a name="l03851"></a><span class="lineno"> 3851</span>&#160;               <a class="code" href="TGHtml_8h.html#ad5bb4a3d12fd54f29da2b924b29e652b">TRACE</a>(HDBG, <span class="stringliteral">&quot;Adding: &quot;</span>&lt;&lt;(*ircs).fEnv);</div><div class="line"><a name="l03852"></a><span class="lineno"> 3852</span>&#160;            }</div><div class="line"><a name="l03853"></a><span class="lineno"> 3853</span>&#160;         }</div><div class="line"><a name="l03854"></a><span class="lineno"> 3854</span>&#160;         sessrcs.Apply(<a class="code" href="XrdProofdProofServMgr_8cxx.html#a161fcc2ffe02d9e7e5fe72497b75f9a2">WriteSessRCs</a>, (<span class="keywordtype">void</span> *)frc);</div><div class="line"><a name="l03855"></a><span class="lineno"> 3855</span>&#160;      }</div><div class="line"><a name="l03856"></a><span class="lineno"> 3856</span>&#160;   }</div><div class="line"><a name="l03857"></a><span class="lineno"> 3857</span>&#160;   <span class="comment">// If applicable, add dataset managers initiators</span></div><div class="line"><a name="l03858"></a><span class="lineno"> 3858</span>&#160;   <span class="keywordflow">if</span> (<a class="code" href="classXrdProofdProofServMgr.html#a86cac591a5646811e38ff6a2477f4da7">fMgr</a>-&gt;<a class="code" href="classXrdProofdManager.html#a4a2a77a074ead8e9c504a7fa758d2e9d">DataSetSrcs</a>()-&gt;size() &gt; 0) {</div><div class="line"><a name="l03859"></a><span class="lineno"> 3859</span>&#160;      fprintf(frc, <span class="stringliteral">&quot;# Dataset sources\n&quot;</span>);</div><div class="line"><a name="l03860"></a><span class="lineno"> 3860</span>&#160;      XrdOucString rc(<span class="stringliteral">&quot;Proof.DataSetManager: &quot;</span>);</div><div class="line"><a name="l03861"></a><span class="lineno"> 3861</span>&#160;      std::list&lt;XrdProofdDSInfo *&gt;::iterator ii;</div><div class="line"><a name="l03862"></a><span class="lineno"> 3862</span>&#160;      <span class="keywordflow">for</span> (ii = <a class="code" href="classXrdProofdProofServMgr.html#a86cac591a5646811e38ff6a2477f4da7">fMgr</a>-&gt;<a class="code" href="classXrdProofdManager.html#a4a2a77a074ead8e9c504a7fa758d2e9d">DataSetSrcs</a>()-&gt;begin(); ii != <a class="code" href="classXrdProofdProofServMgr.html#a86cac591a5646811e38ff6a2477f4da7">fMgr</a>-&gt;<a class="code" href="classXrdProofdManager.html#a4a2a77a074ead8e9c504a7fa758d2e9d">DataSetSrcs</a>()-&gt;end(); ++ii) {</div><div class="line"><a name="l03863"></a><span class="lineno"> 3863</span>&#160;         <span class="keywordflow">if</span> (ii != <a class="code" href="classXrdProofdProofServMgr.html#a86cac591a5646811e38ff6a2477f4da7">fMgr</a>-&gt;<a class="code" href="classXrdProofdManager.html#a4a2a77a074ead8e9c504a7fa758d2e9d">DataSetSrcs</a>()-&gt;begin()) rc += <span class="stringliteral">&quot;, &quot;</span>;</div><div class="line"><a name="l03864"></a><span class="lineno"> 3864</span>&#160;         rc += (*ii)-&gt;fType;</div><div class="line"><a name="l03865"></a><span class="lineno"> 3865</span>&#160;         rc += <span class="stringliteral">&quot; dir:&quot;</span>;</div><div class="line"><a name="l03866"></a><span class="lineno"> 3866</span>&#160;         rc += (*ii)-&gt;fUrl;</div><div class="line"><a name="l03867"></a><span class="lineno"> 3867</span>&#160;         rc += <span class="stringliteral">&quot; opt:&quot;</span>;</div><div class="line"><a name="l03868"></a><span class="lineno"> 3868</span>&#160;         rc += (*ii)-&gt;fOpts;</div><div class="line"><a name="l03869"></a><span class="lineno"> 3869</span>&#160;         rc += <span class="stringliteral">&quot; &quot;</span>;</div><div class="line"><a name="l03870"></a><span class="lineno"> 3870</span>&#160;         rc += (*ii)-&gt;fObscure;</div><div class="line"><a name="l03871"></a><span class="lineno"> 3871</span>&#160;      }</div><div class="line"><a name="l03872"></a><span class="lineno"> 3872</span>&#160;      fprintf(frc, <span class="stringliteral">&quot;%s\n&quot;</span>, rc.c_str());</div><div class="line"><a name="l03873"></a><span class="lineno"> 3873</span>&#160;   }</div><div class="line"><a name="l03874"></a><span class="lineno"> 3874</span>&#160;</div><div class="line"><a name="l03875"></a><span class="lineno"> 3875</span>&#160;   <span class="comment">// If applicable, add staging requests repository directive initiator</span></div><div class="line"><a name="l03876"></a><span class="lineno"> 3876</span>&#160;   <span class="keywordflow">if</span> (strlen(<a class="code" href="classXrdProofdProofServMgr.html#a86cac591a5646811e38ff6a2477f4da7">fMgr</a>-&gt;<a class="code" href="classXrdProofdManager.html#a630444a90ac06ef93449f6db64a5b6de">StageReqRepo</a>()) &gt; 0) {</div><div class="line"><a name="l03877"></a><span class="lineno"> 3877</span>&#160;      fprintf(frc, <span class="stringliteral">&quot;# Dataset staging requests repository\n&quot;</span>);</div><div class="line"><a name="l03878"></a><span class="lineno"> 3878</span>&#160;      fprintf(frc, <span class="stringliteral">&quot;Proof.DataSetStagingRequests: %s\n&quot;</span>, <a class="code" href="classXrdProofdProofServMgr.html#a86cac591a5646811e38ff6a2477f4da7">fMgr</a>-&gt;<a class="code" href="classXrdProofdManager.html#a630444a90ac06ef93449f6db64a5b6de">StageReqRepo</a>());</div><div class="line"><a name="l03879"></a><span class="lineno"> 3879</span>&#160;   }</div><div class="line"><a name="l03880"></a><span class="lineno"> 3880</span>&#160;</div><div class="line"><a name="l03881"></a><span class="lineno"> 3881</span>&#160;   <span class="comment">// If applicable, add datadir location</span></div><div class="line"><a name="l03882"></a><span class="lineno"> 3882</span>&#160;   <span class="keywordflow">if</span> (<a class="code" href="classXrdProofdProofServMgr.html#a86cac591a5646811e38ff6a2477f4da7">fMgr</a>-&gt;<a class="code" href="classXrdProofdManager.html#a77fa4018184954055ab7e17027b4834c">DataDir</a>() &amp;&amp; strlen(<a class="code" href="classXrdProofdProofServMgr.html#a86cac591a5646811e38ff6a2477f4da7">fMgr</a>-&gt;<a class="code" href="classXrdProofdManager.html#a77fa4018184954055ab7e17027b4834c">DataDir</a>()) &gt; 0) {</div><div class="line"><a name="l03883"></a><span class="lineno"> 3883</span>&#160;      fprintf(frc, <span class="stringliteral">&quot;# Data directory\n&quot;</span>);</div><div class="line"><a name="l03884"></a><span class="lineno"> 3884</span>&#160;      XrdOucString rc;</div><div class="line"><a name="l03885"></a><span class="lineno"> 3885</span>&#160;      <a class="code" href="XrdProofdAux_8h.html#a631cc8787af1a02d9e51c86117ae042e">XPDFORM</a>(rc, <span class="stringliteral">&quot;ProofServ.DataDir: %s/%s/%s/%s/%s&quot;</span>, <a class="code" href="classXrdProofdProofServMgr.html#a86cac591a5646811e38ff6a2477f4da7">fMgr</a>-&gt;<a class="code" href="classXrdProofdManager.html#a77fa4018184954055ab7e17027b4834c">DataDir</a>(),</div><div class="line"><a name="l03886"></a><span class="lineno"> 3886</span>&#160;                  p-&gt;<a class="code" href="classXrdProofdProtocol.html#a80024c8f848d0eabe9f13d09f06c8d9d">Client</a>()-&gt;<a class="code" href="classXrdProofdClient.html#af82bc301c99dc688038ba2c771b5c49e">Group</a>(), p-&gt;<a class="code" href="classXrdProofdProtocol.html#a80024c8f848d0eabe9f13d09f06c8d9d">Client</a>()-&gt;<a class="code" href="classXrdProofdClient.html#a3cbe604999cdb44ae9d0ec833ffa5900">User</a>(), xps-&gt;<a class="code" href="classXrdProofdProofServ.html#a85958cf8241aee02a376befe6ab98e98">Ordinal</a>(),</div><div class="line"><a name="l03887"></a><span class="lineno"> 3887</span>&#160;                  in-&gt;<a class="code" href="structProofServEnv__t.html#af4140705c69b78b2c0fd55131a0844dd">fSessionTag</a>.c_str());</div><div class="line"><a name="l03888"></a><span class="lineno"> 3888</span>&#160;      <span class="keywordflow">if</span> (<a class="code" href="classXrdProofdProofServMgr.html#a86cac591a5646811e38ff6a2477f4da7">fMgr</a>-&gt;<a class="code" href="classXrdProofdManager.html#a49e1d44d005669a286deca814586dcea">DataDirUrlOpts</a>() &amp;&amp; strlen(<a class="code" href="classXrdProofdProofServMgr.html#a86cac591a5646811e38ff6a2477f4da7">fMgr</a>-&gt;<a class="code" href="classXrdProofdManager.html#a49e1d44d005669a286deca814586dcea">DataDirUrlOpts</a>()) &gt; 0) {</div><div class="line"><a name="l03889"></a><span class="lineno"> 3889</span>&#160;         fprintf(frc, <span class="stringliteral">&quot;%s %s\n&quot;</span>, rc.c_str(), <a class="code" href="classXrdProofdProofServMgr.html#a86cac591a5646811e38ff6a2477f4da7">fMgr</a>-&gt;<a class="code" href="classXrdProofdManager.html#a49e1d44d005669a286deca814586dcea">DataDirUrlOpts</a>());</div><div class="line"><a name="l03890"></a><span class="lineno"> 3890</span>&#160;      } <span class="keywordflow">else</span> {</div><div class="line"><a name="l03891"></a><span class="lineno"> 3891</span>&#160;         fprintf(frc, <span class="stringliteral">&quot;%s\n&quot;</span>, rc.c_str());</div><div class="line"><a name="l03892"></a><span class="lineno"> 3892</span>&#160;      }</div><div class="line"><a name="l03893"></a><span class="lineno"> 3893</span>&#160;   }</div><div class="line"><a name="l03894"></a><span class="lineno"> 3894</span>&#160;</div><div class="line"><a name="l03895"></a><span class="lineno"> 3895</span>&#160;   <span class="comment">// Done with this</span></div><div class="line"><a name="l03896"></a><span class="lineno"> 3896</span>&#160;   fclose(frc);</div><div class="line"><a name="l03897"></a><span class="lineno"> 3897</span>&#160;</div><div class="line"><a name="l03898"></a><span class="lineno"> 3898</span>&#160;   <span class="comment">// Done</span></div><div class="line"><a name="l03899"></a><span class="lineno"> 3899</span>&#160;   <span class="keywordflow">return</span> 0;</div><div class="line"><a name="l03900"></a><span class="lineno"> 3900</span>&#160;}</div><div class="line"><a name="l03901"></a><span class="lineno"> 3901</span>&#160;<span class="comment"></span></div><div class="line"><a name="l03902"></a><span class="lineno"> 3902</span>&#160;<span class="comment">////////////////////////////////////////////////////////////////////////////////</span></div><div class="line"><a name="l03903"></a><span class="lineno"> 3903</span>&#160;<span class="comment">/// Cleanup (kill) all &#39;proofserv&#39; processes which lost control from their</span></div><div class="line"><a name="l03904"></a><span class="lineno"> 3904</span>&#160;<span class="comment">/// creator or controller daemon. We rely here on the information in the admin</span></div><div class="line"><a name="l03905"></a><span class="lineno"> 3905</span>&#160;<span class="comment">/// path(s) (&lt;xrd_admin&gt;/.xproof.&lt;port&gt;).</span></div><div class="line"><a name="l03906"></a><span class="lineno"> 3906</span>&#160;<span class="comment">/// This is called regurarly by the cron job to avoid having proofservs around.</span></div><div class="line"><a name="l03907"></a><span class="lineno"> 3907</span>&#160;<span class="comment">/// Return number of process killed or -1 in case of any error.</span></div><div class="line"><a name="l03908"></a><span class="lineno"> 3908</span>&#160;<span class="comment"></span></div><div class="line"><a name="l03909"></a><span class="lineno"><a class="line" href="classXrdProofdProofServMgr.html#a235180ac7d5ec759ee1f6c924b9b85dc"> 3909</a></span>&#160;<span class="keywordtype">int</span> <a class="code" href="classXrdProofdProofServMgr.html#a235180ac7d5ec759ee1f6c924b9b85dc">XrdProofdProofServMgr::CleanupLostProofServ</a>()</div><div class="line"><a name="l03910"></a><span class="lineno"> 3910</span>&#160;{</div><div class="line"><a name="l03911"></a><span class="lineno"> 3911</span>&#160;   <a class="code" href="XrdProofdTrace_8h.html#a7c31822912a8d0dc9bfd544097b29e12">XPDLOC</a>(SMGR, <span class="stringliteral">&quot;ProofServMgr::CleanupLostProofServ&quot;</span>)</div><div class="line"><a name="l03912"></a><span class="lineno"> 3912</span>&#160;</div><div class="line"><a name="l03913"></a><span class="lineno"> 3913</span>&#160;   <span class="keywordflow">if</span> (!<a class="code" href="classXrdProofdProofServMgr.html#a001151ea555c7e0d21298d831452665f">fCheckLost</a>) {</div><div class="line"><a name="l03914"></a><span class="lineno"> 3914</span>&#160;      <a class="code" href="TGHtml_8h.html#ad5bb4a3d12fd54f29da2b924b29e652b">TRACE</a>(REQ,  <span class="stringliteral">&quot;disabled ...&quot;</span>);</div><div class="line"><a name="l03915"></a><span class="lineno"> 3915</span>&#160;      <span class="keywordflow">return</span> 0;</div><div class="line"><a name="l03916"></a><span class="lineno"> 3916</span>&#160;   }</div><div class="line"><a name="l03917"></a><span class="lineno"> 3917</span>&#160;</div><div class="line"><a name="l03918"></a><span class="lineno"> 3918</span>&#160;   <a class="code" href="TGHtml_8h.html#ad5bb4a3d12fd54f29da2b924b29e652b">TRACE</a>(REQ,  <span class="stringliteral">&quot;checking for orphalin proofserv processes ...&quot;</span>);</div><div class="line"><a name="l03919"></a><span class="lineno"> 3919</span>&#160;   <span class="keywordtype">int</span> nk = 0;</div><div class="line"><a name="l03920"></a><span class="lineno"> 3920</span>&#160;</div><div class="line"><a name="l03921"></a><span class="lineno"> 3921</span>&#160;   <span class="comment">// Get the list of existing proofserv processes from the process table</span></div><div class="line"><a name="l03922"></a><span class="lineno"> 3922</span>&#160;   std::map&lt;int,XrdOucString&gt; procs;</div><div class="line"><a name="l03923"></a><span class="lineno"> 3923</span>&#160;   <span class="keywordflow">if</span> (<a class="code" href="classXrdProofdAux.html#a8d7c2c117a8f570eff5ffd8e98a12033">XrdProofdAux::GetProcesses</a>(<span class="stringliteral">&quot;proofserv&quot;</span>, &amp;procs) &lt;= 0) {</div><div class="line"><a name="l03924"></a><span class="lineno"> 3924</span>&#160;      <a class="code" href="TGHtml_8h.html#ad5bb4a3d12fd54f29da2b924b29e652b">TRACE</a>(DBG, <span class="stringliteral">&quot; no proofservs around: nothing to do&quot;</span>);</div><div class="line"><a name="l03925"></a><span class="lineno"> 3925</span>&#160;      <span class="keywordflow">return</span> 0;</div><div class="line"><a name="l03926"></a><span class="lineno"> 3926</span>&#160;   }</div><div class="line"><a name="l03927"></a><span class="lineno"> 3927</span>&#160;</div><div class="line"><a name="l03928"></a><span class="lineno"> 3928</span>&#160;   <a class="code" href="classXrdProofUI.html">XrdProofUI</a> ui;</div><div class="line"><a name="l03929"></a><span class="lineno"> 3929</span>&#160;   <span class="keywordflow">if</span> (<a class="code" href="classXrdProofdAux.html#a0230423581c62e4fabf4fda6538fd4a7">XrdProofdAux::GetUserInfo</a>(<a class="code" href="classXrdProofdProofServMgr.html#a86cac591a5646811e38ff6a2477f4da7">fMgr</a>-&gt;<a class="code" href="classXrdProofdManager.html#a0f1457620cc4e2de56258bf553843634">EffectiveUser</a>(), ui) != 0) {</div><div class="line"><a name="l03930"></a><span class="lineno"> 3930</span>&#160;      <a class="code" href="TGHtml_8h.html#ad5bb4a3d12fd54f29da2b924b29e652b">TRACE</a>(DBG, <span class="stringliteral">&quot;problems getting info for user &quot;</span> &lt;&lt; <a class="code" href="classXrdProofdProofServMgr.html#a86cac591a5646811e38ff6a2477f4da7">fMgr</a>-&gt;<a class="code" href="classXrdProofdManager.html#a0f1457620cc4e2de56258bf553843634">EffectiveUser</a>());</div><div class="line"><a name="l03931"></a><span class="lineno"> 3931</span>&#160;      <span class="keywordflow">return</span> -1;</div><div class="line"><a name="l03932"></a><span class="lineno"> 3932</span>&#160;   }</div><div class="line"><a name="l03933"></a><span class="lineno"> 3933</span>&#160;</div><div class="line"><a name="l03934"></a><span class="lineno"> 3934</span>&#160;   <span class="comment">// Hash list of controlled and xrootd process</span></div><div class="line"><a name="l03935"></a><span class="lineno"> 3935</span>&#160;   XrdOucRash&lt;int, int&gt; controlled, xrdproc;</div><div class="line"><a name="l03936"></a><span class="lineno"> 3936</span>&#160;</div><div class="line"><a name="l03937"></a><span class="lineno"> 3937</span>&#160;   <span class="comment">// Hash list of sessions files loaded</span></div><div class="line"><a name="l03938"></a><span class="lineno"> 3938</span>&#160;   XrdOucHash&lt;XrdOucString&gt; sessionspaths;</div><div class="line"><a name="l03939"></a><span class="lineno"> 3939</span>&#160;</div><div class="line"><a name="l03940"></a><span class="lineno"> 3940</span>&#160;   <span class="comment">// For each process extract the information about the daemon supposed to be in control</span></div><div class="line"><a name="l03941"></a><span class="lineno"> 3941</span>&#160;   <span class="keywordtype">int</span> pid, ia, <a class="code" href="textangle_8C.html#a655a1c2a1ec25e8fcfb713772281e8f5">a</a>;</div><div class="line"><a name="l03942"></a><span class="lineno"> 3942</span>&#160;   XrdOucString cmd, apath, pidpath, sessiondir, emsg, rest, after;</div><div class="line"><a name="l03943"></a><span class="lineno"> 3943</span>&#160;   std::map&lt;int,XrdOucString&gt;::iterator ip;</div><div class="line"><a name="l03944"></a><span class="lineno"> 3944</span>&#160;   <span class="keywordflow">for</span> (ip = procs.begin(); ip != procs.end(); ++ip) {</div><div class="line"><a name="l03945"></a><span class="lineno"> 3945</span>&#160;      pid = ip-&gt;first;</div><div class="line"><a name="l03946"></a><span class="lineno"> 3946</span>&#160;      cmd = ip-&gt;second;</div><div class="line"><a name="l03947"></a><span class="lineno"> 3947</span>&#160;      <span class="keywordflow">if</span> ((ia = cmd.find(<span class="stringliteral">&quot;xpdpath:&quot;</span>)) != STR_NPOS) {</div><div class="line"><a name="l03948"></a><span class="lineno"> 3948</span>&#160;         cmd.tokenize(apath, ia, <span class="charliteral">&#39; &#39;</span>);</div><div class="line"><a name="l03949"></a><span class="lineno"> 3949</span>&#160;         apath.replace(<span class="stringliteral">&quot;xpdpath:&quot;</span>, <span class="stringliteral">&quot;&quot;</span>);</div><div class="line"><a name="l03950"></a><span class="lineno"> 3950</span>&#160;         <span class="keywordflow">if</span> (apath.length() &lt;= 0) {</div><div class="line"><a name="l03951"></a><span class="lineno"> 3951</span>&#160;            <a class="code" href="TGHtml_8h.html#ad5bb4a3d12fd54f29da2b924b29e652b">TRACE</a>(ALL, <span class="stringliteral">&quot;admin path not found; initial cmd line: &quot;</span>&lt;&lt;cmd);</div><div class="line"><a name="l03952"></a><span class="lineno"> 3952</span>&#160;            <span class="keywordflow">continue</span>;</div><div class="line"><a name="l03953"></a><span class="lineno"> 3953</span>&#160;         }</div><div class="line"><a name="l03954"></a><span class="lineno"> 3954</span>&#160;         <span class="comment">// Extract daemon PID and check that it is alive</span></div><div class="line"><a name="l03955"></a><span class="lineno"> 3955</span>&#160;         <a class="code" href="XrdProofdAux_8h.html#a631cc8787af1a02d9e51c86117ae042e">XPDFORM</a>(pidpath, <span class="stringliteral">&quot;%s/xrootd.pid&quot;</span>, apath.c_str());</div><div class="line"><a name="l03956"></a><span class="lineno"> 3956</span>&#160;         <a class="code" href="TGHtml_8h.html#ad5bb4a3d12fd54f29da2b924b29e652b">TRACE</a>(ALL, <span class="stringliteral">&quot;pidpath: &quot;</span>&lt;&lt;pidpath);</div><div class="line"><a name="l03957"></a><span class="lineno"> 3957</span>&#160;         <span class="keywordtype">int</span> xpid = <a class="code" href="classXrdProofdAux.html#ab89f8e6e7860469ea0c610cd11f38114">XrdProofdAux::GetIDFromPath</a>(pidpath.c_str(), emsg);</div><div class="line"><a name="l03958"></a><span class="lineno"> 3958</span>&#160;         <span class="keywordtype">int</span> *alive = xrdproc.Find(xpid);</div><div class="line"><a name="l03959"></a><span class="lineno"> 3959</span>&#160;         <span class="keywordflow">if</span> (!alive) {</div><div class="line"><a name="l03960"></a><span class="lineno"> 3960</span>&#160;            <a class="code" href="textangle_8C.html#a655a1c2a1ec25e8fcfb713772281e8f5">a</a> = (<a class="code" href="classXrdProofdAux.html#a44927170bd725bb1476300e603bb9332">XrdProofdAux::VerifyProcessByID</a>(xpid, <a class="code" href="classXrdProofdProofServMgr.html#a0dab770ad59dea7bbfceb63d345af63b">fParentExecs</a>.c_str())) ? 1 : 0;</div><div class="line"><a name="l03961"></a><span class="lineno"> 3961</span>&#160;            xrdproc.Add(xpid, <a class="code" href="textangle_8C.html#a655a1c2a1ec25e8fcfb713772281e8f5">a</a>);</div><div class="line"><a name="l03962"></a><span class="lineno"> 3962</span>&#160;         } <span class="keywordflow">else</span> {</div><div class="line"><a name="l03963"></a><span class="lineno"> 3963</span>&#160;            <a class="code" href="textangle_8C.html#a655a1c2a1ec25e8fcfb713772281e8f5">a</a> = *alive;</div><div class="line"><a name="l03964"></a><span class="lineno"> 3964</span>&#160;         }</div><div class="line"><a name="l03965"></a><span class="lineno"> 3965</span>&#160;         <span class="comment">// If the daemon is still there check that the process has its entry in the</span></div><div class="line"><a name="l03966"></a><span class="lineno"> 3966</span>&#160;         <span class="comment">// session path(s);</span></div><div class="line"><a name="l03967"></a><span class="lineno"> 3967</span>&#160;         <span class="keywordtype">bool</span> ok = 0;</div><div class="line"><a name="l03968"></a><span class="lineno"> 3968</span>&#160;         <span class="keywordflow">if</span> (<a class="code" href="textangle_8C.html#a655a1c2a1ec25e8fcfb713772281e8f5">a</a> == 1) {</div><div class="line"><a name="l03969"></a><span class="lineno"> 3969</span>&#160;            <span class="keyword">const</span> <span class="keywordtype">char</span> *subdir[2] = {<span class="stringliteral">&quot;activesessions&quot;</span>, <span class="stringliteral">&quot;terminatedsessions&quot;</span>};</div><div class="line"><a name="l03970"></a><span class="lineno"> 3970</span>&#160;            <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; 2; i++) {</div><div class="line"><a name="l03971"></a><span class="lineno"> 3971</span>&#160;               <a class="code" href="XrdProofdAux_8h.html#a631cc8787af1a02d9e51c86117ae042e">XPDFORM</a>(sessiondir, <span class="stringliteral">&quot;%s/%s&quot;</span>, apath.c_str(), subdir[i]);</div><div class="line"><a name="l03972"></a><span class="lineno"> 3972</span>&#160;               <span class="keywordflow">if</span> (!sessionspaths.Find(sessiondir.c_str())) {</div><div class="line"><a name="l03973"></a><span class="lineno"> 3973</span>&#160;                  DIR *sdir = opendir(sessiondir.c_str());</div><div class="line"><a name="l03974"></a><span class="lineno"> 3974</span>&#160;                  <span class="keywordflow">if</span> (!sdir) {</div><div class="line"><a name="l03975"></a><span class="lineno"> 3975</span>&#160;                     <a class="code" href="XrdProofdAux_8h.html#a631cc8787af1a02d9e51c86117ae042e">XPDFORM</a>(emsg, <span class="stringliteral">&quot;cannot open &#39;%s&#39; - errno: %d&quot;</span>, apath.c_str(), errno);</div><div class="line"><a name="l03976"></a><span class="lineno"> 3976</span>&#160;                     <a class="code" href="TGHtml_8h.html#ad5bb4a3d12fd54f29da2b924b29e652b">TRACE</a>(XERR, emsg.c_str());</div><div class="line"><a name="l03977"></a><span class="lineno"> 3977</span>&#160;                     <span class="keywordflow">continue</span>;</div><div class="line"><a name="l03978"></a><span class="lineno"> 3978</span>&#160;                  }</div><div class="line"><a name="l03979"></a><span class="lineno"> 3979</span>&#160;                  <span class="keyword">struct </span>dirent *sent = 0;</div><div class="line"><a name="l03980"></a><span class="lineno"> 3980</span>&#160;                  <span class="keywordflow">while</span> ((sent = readdir(sdir))) {</div><div class="line"><a name="l03981"></a><span class="lineno"> 3981</span>&#160;                     <span class="keywordflow">if</span> (!strncmp(sent-&gt;d_name, <span class="stringliteral">&quot;.&quot;</span>, 1) || !strncmp(sent-&gt;d_name, <span class="stringliteral">&quot;..&quot;</span>, 2))</div><div class="line"><a name="l03982"></a><span class="lineno"> 3982</span>&#160;                        <span class="keywordflow">continue</span>;</div><div class="line"><a name="l03983"></a><span class="lineno"> 3983</span>&#160;                     <span class="comment">// Get the pid</span></div><div class="line"><a name="l03984"></a><span class="lineno"> 3984</span>&#160;                     <span class="keywordtype">int</span> ppid = <a class="code" href="classXrdProofdAux.html#ae5801323b51316b641483f41dde67aa5">XrdProofdAux::ParsePidPath</a>(sent-&gt;d_name, rest, after);</div><div class="line"><a name="l03985"></a><span class="lineno"> 3985</span>&#160;                     <span class="comment">// Add to the list</span></div><div class="line"><a name="l03986"></a><span class="lineno"> 3986</span>&#160;                     controlled.Add(ppid, ppid);</div><div class="line"><a name="l03987"></a><span class="lineno"> 3987</span>&#160;                  }</div><div class="line"><a name="l03988"></a><span class="lineno"> 3988</span>&#160;                  closedir(sdir);</div><div class="line"><a name="l03989"></a><span class="lineno"> 3989</span>&#160;                  sessionspaths.Add(sessiondir.c_str(), 0, 0, Hash_data_is_key);</div><div class="line"><a name="l03990"></a><span class="lineno"> 3990</span>&#160;               }</div><div class="line"><a name="l03991"></a><span class="lineno"> 3991</span>&#160;               ok = (controlled.Find(pid)) ? 1 : ok;</div><div class="line"><a name="l03992"></a><span class="lineno"> 3992</span>&#160;               <span class="comment">// We are done, if the process is controlled</span></div><div class="line"><a name="l03993"></a><span class="lineno"> 3993</span>&#160;               <span class="keywordflow">if</span> (ok) <span class="keywordflow">break</span>;</div><div class="line"><a name="l03994"></a><span class="lineno"> 3994</span>&#160;            }</div><div class="line"><a name="l03995"></a><span class="lineno"> 3995</span>&#160;         }</div><div class="line"><a name="l03996"></a><span class="lineno"> 3996</span>&#160;         <span class="comment">// If the process is not controlled we have to kill it</span></div><div class="line"><a name="l03997"></a><span class="lineno"> 3997</span>&#160;         <span class="keywordflow">if</span> (!ok) {</div><div class="line"><a name="l03998"></a><span class="lineno"> 3998</span>&#160;            <a class="code" href="TGHtml_8h.html#ad5bb4a3d12fd54f29da2b924b29e652b">TRACE</a>(ALL,<span class="stringliteral">&quot;process: &quot;</span>&lt;&lt;pid&lt;&lt;<span class="stringliteral">&quot; lost its controller: killing&quot;</span>);</div><div class="line"><a name="l03999"></a><span class="lineno"> 3999</span>&#160;            <span class="keywordflow">if</span> (<a class="code" href="classXrdProofdAux.html#a6b1d64972dcdae69de7af68d43fdd5be">XrdProofdAux::KillProcess</a>(pid, 1, ui, <a class="code" href="classXrdProofdProofServMgr.html#a86cac591a5646811e38ff6a2477f4da7">fMgr</a>-&gt;<a class="code" href="classXrdProofdManager.html#a15d2e414e67bfc0cc4304605a6b509ff">ChangeOwn</a>()) == 0)</div><div class="line"><a name="l04000"></a><span class="lineno"> 4000</span>&#160;               nk++;</div><div class="line"><a name="l04001"></a><span class="lineno"> 4001</span>&#160;         }</div><div class="line"><a name="l04002"></a><span class="lineno"> 4002</span>&#160;      }</div><div class="line"><a name="l04003"></a><span class="lineno"> 4003</span>&#160;</div><div class="line"><a name="l04004"></a><span class="lineno"> 4004</span>&#160;   }</div><div class="line"><a name="l04005"></a><span class="lineno"> 4005</span>&#160;</div><div class="line"><a name="l04006"></a><span class="lineno"> 4006</span>&#160;   <span class="comment">// Done</span></div><div class="line"><a name="l04007"></a><span class="lineno"> 4007</span>&#160;   <span class="keywordflow">return</span> nk;</div><div class="line"><a name="l04008"></a><span class="lineno"> 4008</span>&#160;}</div><div class="line"><a name="l04009"></a><span class="lineno"> 4009</span>&#160;<span class="comment"></span></div><div class="line"><a name="l04010"></a><span class="lineno"> 4010</span>&#160;<span class="comment">////////////////////////////////////////////////////////////////////////////////</span></div><div class="line"><a name="l04011"></a><span class="lineno"> 4011</span>&#160;<span class="comment">/// Cleanup (kill) all &#39;proofserv&#39; processes from the process table.</span></div><div class="line"><a name="l04012"></a><span class="lineno"> 4012</span>&#160;<span class="comment">/// Only the processes associated with &#39;usr&#39; are killed,</span></div><div class="line"><a name="l04013"></a><span class="lineno"> 4013</span>&#160;<span class="comment">/// unless &#39;all&#39; is TRUE, in which case all &#39;proofserv&#39; instances are</span></div><div class="line"><a name="l04014"></a><span class="lineno"> 4014</span>&#160;<span class="comment">/// terminated (this requires superuser privileges).</span></div><div class="line"><a name="l04015"></a><span class="lineno"> 4015</span>&#160;<span class="comment">/// Super users can also terminated all processes fo another user (specified</span></div><div class="line"><a name="l04016"></a><span class="lineno"> 4016</span>&#160;<span class="comment">/// via usr).</span></div><div class="line"><a name="l04017"></a><span class="lineno"> 4017</span>&#160;<span class="comment">/// Return number of process notified for termination on success, -1 otherwise</span></div><div class="line"><a name="l04018"></a><span class="lineno"> 4018</span>&#160;<span class="comment"></span></div><div class="line"><a name="l04019"></a><span class="lineno"><a class="line" href="classXrdProofdProofServMgr.html#a2d3abc89a2ad6def35f0b9bc927377b8"> 4019</a></span>&#160;<span class="keywordtype">int</span> <a class="code" href="classXrdProofdProofServMgr.html#a2d3abc89a2ad6def35f0b9bc927377b8">XrdProofdProofServMgr::CleanupProofServ</a>(<span class="keywordtype">bool</span> all, <span class="keyword">const</span> <span class="keywordtype">char</span> *usr)</div><div class="line"><a name="l04020"></a><span class="lineno"> 4020</span>&#160;{</div><div class="line"><a name="l04021"></a><span class="lineno"> 4021</span>&#160;   <a class="code" href="XrdProofdTrace_8h.html#a7c31822912a8d0dc9bfd544097b29e12">XPDLOC</a>(SMGR, <span class="stringliteral">&quot;ProofServMgr::CleanupProofServ&quot;</span>)</div><div class="line"><a name="l04022"></a><span class="lineno"> 4022</span>&#160;</div><div class="line"><a name="l04023"></a><span class="lineno"> 4023</span>&#160;   <a class="code" href="TGHtml_8h.html#ad5bb4a3d12fd54f29da2b924b29e652b">TRACE</a>(REQ,  <span class="stringliteral">&quot;all: &quot;</span>&lt;&lt;all&lt;&lt;<span class="stringliteral">&quot;, usr: &quot;</span> &lt;&lt; (usr ? usr : <span class="stringliteral">&quot;undef&quot;</span>));</div><div class="line"><a name="l04024"></a><span class="lineno"> 4024</span>&#160;   <span class="keywordtype">int</span> nk = 0;</div><div class="line"><a name="l04025"></a><span class="lineno"> 4025</span>&#160;</div><div class="line"><a name="l04026"></a><span class="lineno"> 4026</span>&#160;   <span class="comment">// Name</span></div><div class="line"><a name="l04027"></a><span class="lineno"> 4027</span>&#160;   <span class="keyword">const</span> <span class="keywordtype">char</span> *pn = <span class="stringliteral">&quot;proofserv&quot;</span>;</div><div class="line"><a name="l04028"></a><span class="lineno"> 4028</span>&#160;</div><div class="line"><a name="l04029"></a><span class="lineno"> 4029</span>&#160;   <span class="comment">// Uid</span></div><div class="line"><a name="l04030"></a><span class="lineno"> 4030</span>&#160;   <a class="code" href="classXrdProofUI.html">XrdProofUI</a> ui;</div><div class="line"><a name="l04031"></a><span class="lineno"> 4031</span>&#160;   <span class="keywordtype">int</span> refuid = -1;</div><div class="line"><a name="l04032"></a><span class="lineno"> 4032</span>&#160;   <span class="keywordflow">if</span> (!all) {</div><div class="line"><a name="l04033"></a><span class="lineno"> 4033</span>&#160;      <span class="keywordflow">if</span> (!usr) {</div><div class="line"><a name="l04034"></a><span class="lineno"> 4034</span>&#160;         <a class="code" href="TGHtml_8h.html#ad5bb4a3d12fd54f29da2b924b29e652b">TRACE</a>(DBG, <span class="stringliteral">&quot;usr must be defined for all = FALSE&quot;</span>);</div><div class="line"><a name="l04035"></a><span class="lineno"> 4035</span>&#160;         <span class="keywordflow">return</span> -1;</div><div class="line"><a name="l04036"></a><span class="lineno"> 4036</span>&#160;      }</div><div class="line"><a name="l04037"></a><span class="lineno"> 4037</span>&#160;      <span class="keywordflow">if</span> (<a class="code" href="classXrdProofdAux.html#a0230423581c62e4fabf4fda6538fd4a7">XrdProofdAux::GetUserInfo</a>(usr, ui) != 0) {</div><div class="line"><a name="l04038"></a><span class="lineno"> 4038</span>&#160;         <a class="code" href="TGHtml_8h.html#ad5bb4a3d12fd54f29da2b924b29e652b">TRACE</a>(DBG, <span class="stringliteral">&quot;problems getting info for user &quot;</span> &lt;&lt; usr);</div><div class="line"><a name="l04039"></a><span class="lineno"> 4039</span>&#160;         <span class="keywordflow">return</span> -1;</div><div class="line"><a name="l04040"></a><span class="lineno"> 4040</span>&#160;      }</div><div class="line"><a name="l04041"></a><span class="lineno"> 4041</span>&#160;      refuid = ui.<a class="code" href="classXrdProofUI.html#aa16ddd6d492cb4e498d5a94df6b037a9">fUid</a>;</div><div class="line"><a name="l04042"></a><span class="lineno"> 4042</span>&#160;   }</div><div class="line"><a name="l04043"></a><span class="lineno"> 4043</span>&#160;</div><div class="line"><a name="l04044"></a><span class="lineno"> 4044</span>&#160;<span class="preprocessor">#if defined(linux)</span></div><div class="line"><a name="l04045"></a><span class="lineno"> 4045</span>&#160;   <span class="comment">// Loop over the &quot;/proc&quot; dir</span></div><div class="line"><a name="l04046"></a><span class="lineno"> 4046</span>&#160;   DIR *dir = opendir(<span class="stringliteral">&quot;/proc&quot;</span>);</div><div class="line"><a name="l04047"></a><span class="lineno"> 4047</span>&#160;   <span class="keywordflow">if</span> (!dir) {</div><div class="line"><a name="l04048"></a><span class="lineno"> 4048</span>&#160;      XrdOucString emsg(<span class="stringliteral">&quot;cannot open /proc - errno: &quot;</span>);</div><div class="line"><a name="l04049"></a><span class="lineno"> 4049</span>&#160;      emsg += errno;</div><div class="line"><a name="l04050"></a><span class="lineno"> 4050</span>&#160;      <a class="code" href="TGHtml_8h.html#ad5bb4a3d12fd54f29da2b924b29e652b">TRACE</a>(DBG, emsg.c_str());</div><div class="line"><a name="l04051"></a><span class="lineno"> 4051</span>&#160;      <span class="keywordflow">return</span> -1;</div><div class="line"><a name="l04052"></a><span class="lineno"> 4052</span>&#160;   }</div><div class="line"><a name="l04053"></a><span class="lineno"> 4053</span>&#160;</div><div class="line"><a name="l04054"></a><span class="lineno"> 4054</span>&#160;   <span class="keyword">struct </span>dirent *ent = 0;</div><div class="line"><a name="l04055"></a><span class="lineno"> 4055</span>&#160;   <span class="keywordflow">while</span> ((ent = readdir(dir))) {</div><div class="line"><a name="l04056"></a><span class="lineno"> 4056</span>&#160;      <span class="keywordflow">if</span> (!strncmp(ent-&gt;d_name, <span class="stringliteral">&quot;.&quot;</span>, 1) || !strncmp(ent-&gt;d_name, <span class="stringliteral">&quot;..&quot;</span>, 2)) <span class="keywordflow">continue</span>;</div><div class="line"><a name="l04057"></a><span class="lineno"> 4057</span>&#160;      <span class="keywordflow">if</span> (<a class="code" href="XrdProofdAux_8h.html#a0ef73da06cb8a7145a87bdef7d1a9dc3">DIGIT</a>(ent-&gt;d_name[0])) {</div><div class="line"><a name="l04058"></a><span class="lineno"> 4058</span>&#160;         XrdOucString fn(<span class="stringliteral">&quot;/proc/&quot;</span>, 256);</div><div class="line"><a name="l04059"></a><span class="lineno"> 4059</span>&#160;         fn += ent-&gt;d_name;</div><div class="line"><a name="l04060"></a><span class="lineno"> 4060</span>&#160;         fn += <span class="stringliteral">&quot;/status&quot;</span>;</div><div class="line"><a name="l04061"></a><span class="lineno"> 4061</span>&#160;         <span class="comment">// Open file</span></div><div class="line"><a name="l04062"></a><span class="lineno"> 4062</span>&#160;         FILE *ffn = fopen(fn.c_str(), <span class="stringliteral">&quot;r&quot;</span>);</div><div class="line"><a name="l04063"></a><span class="lineno"> 4063</span>&#160;         <span class="keywordflow">if</span> (!ffn) {</div><div class="line"><a name="l04064"></a><span class="lineno"> 4064</span>&#160;            XrdOucString emsg(<span class="stringliteral">&quot;cannot open file &quot;</span>);</div><div class="line"><a name="l04065"></a><span class="lineno"> 4065</span>&#160;            emsg += fn; emsg += <span class="stringliteral">&quot; - errno: &quot;</span>; emsg += errno;</div><div class="line"><a name="l04066"></a><span class="lineno"> 4066</span>&#160;            <a class="code" href="TGHtml_8h.html#ad5bb4a3d12fd54f29da2b924b29e652b">TRACE</a>(HDBG, emsg);</div><div class="line"><a name="l04067"></a><span class="lineno"> 4067</span>&#160;            <span class="keywordflow">continue</span>;</div><div class="line"><a name="l04068"></a><span class="lineno"> 4068</span>&#160;         }</div><div class="line"><a name="l04069"></a><span class="lineno"> 4069</span>&#160;         <span class="comment">// Read info</span></div><div class="line"><a name="l04070"></a><span class="lineno"> 4070</span>&#160;         <span class="keywordtype">bool</span> xname = 1, xpid = 1, xppid = 1;</div><div class="line"><a name="l04071"></a><span class="lineno"> 4071</span>&#160;         <span class="keywordtype">bool</span> xuid = (all) ? 0 : 1;</div><div class="line"><a name="l04072"></a><span class="lineno"> 4072</span>&#160;         <span class="keywordtype">int</span> pid = -1;</div><div class="line"><a name="l04073"></a><span class="lineno"> 4073</span>&#160;         <span class="keywordtype">int</span> ppid = -1;</div><div class="line"><a name="l04074"></a><span class="lineno"> 4074</span>&#160;         <span class="keywordtype">char</span> <a class="code" href="entrylistblock__figure1_8C.html#a4fa05b1f00fcde100685cc887554b93b">line</a>[2048] = { 0 };</div><div class="line"><a name="l04075"></a><span class="lineno"> 4075</span>&#160;         <span class="keywordflow">while</span> (fgets(<a class="code" href="entrylistblock__figure1_8C.html#a4fa05b1f00fcde100685cc887554b93b">line</a>, <span class="keyword">sizeof</span>(<a class="code" href="entrylistblock__figure1_8C.html#a4fa05b1f00fcde100685cc887554b93b">line</a>), ffn) &amp;&amp;</div><div class="line"><a name="l04076"></a><span class="lineno"> 4076</span>&#160;               (xname || xpid || xppid || xuid)) {</div><div class="line"><a name="l04077"></a><span class="lineno"> 4077</span>&#160;            <span class="comment">// Check name</span></div><div class="line"><a name="l04078"></a><span class="lineno"> 4078</span>&#160;            <span class="keywordflow">if</span> (xname &amp;&amp; strstr(<a class="code" href="entrylistblock__figure1_8C.html#a4fa05b1f00fcde100685cc887554b93b">line</a>, <span class="stringliteral">&quot;Name:&quot;</span>)) {</div><div class="line"><a name="l04079"></a><span class="lineno"> 4079</span>&#160;               <span class="keywordflow">if</span> (!strstr(<a class="code" href="entrylistblock__figure1_8C.html#a4fa05b1f00fcde100685cc887554b93b">line</a>, pn))</div><div class="line"><a name="l04080"></a><span class="lineno"> 4080</span>&#160;                  <span class="keywordflow">break</span>;</div><div class="line"><a name="l04081"></a><span class="lineno"> 4081</span>&#160;               xname = 0;</div><div class="line"><a name="l04082"></a><span class="lineno"> 4082</span>&#160;            }</div><div class="line"><a name="l04083"></a><span class="lineno"> 4083</span>&#160;            <span class="keywordflow">if</span> (xpid &amp;&amp; strstr(<a class="code" href="entrylistblock__figure1_8C.html#a4fa05b1f00fcde100685cc887554b93b">line</a>, <span class="stringliteral">&quot;Pid:&quot;</span>)) {</div><div class="line"><a name="l04084"></a><span class="lineno"> 4084</span>&#160;               pid = (int) <a class="code" href="classXrdProofdAux.html#a5776beb694ac4e6b2279707629d58fca">XrdProofdAux::GetLong</a>(&amp;<a class="code" href="entrylistblock__figure1_8C.html#a4fa05b1f00fcde100685cc887554b93b">line</a>[strlen(<span class="stringliteral">&quot;Pid:&quot;</span>)]);</div><div class="line"><a name="l04085"></a><span class="lineno"> 4085</span>&#160;               xpid = 0;</div><div class="line"><a name="l04086"></a><span class="lineno"> 4086</span>&#160;            }</div><div class="line"><a name="l04087"></a><span class="lineno"> 4087</span>&#160;            <span class="keywordflow">if</span> (xppid &amp;&amp; strstr(<a class="code" href="entrylistblock__figure1_8C.html#a4fa05b1f00fcde100685cc887554b93b">line</a>, <span class="stringliteral">&quot;PPid:&quot;</span>)) {</div><div class="line"><a name="l04088"></a><span class="lineno"> 4088</span>&#160;               ppid = (int) <a class="code" href="classXrdProofdAux.html#a5776beb694ac4e6b2279707629d58fca">XrdProofdAux::GetLong</a>(&amp;<a class="code" href="entrylistblock__figure1_8C.html#a4fa05b1f00fcde100685cc887554b93b">line</a>[strlen(<span class="stringliteral">&quot;PPid:&quot;</span>)]);</div><div class="line"><a name="l04089"></a><span class="lineno"> 4089</span>&#160;               <span class="comment">// Parent process must be us or be dead</span></div><div class="line"><a name="l04090"></a><span class="lineno"> 4090</span>&#160;               <span class="keywordflow">if</span> (ppid != getpid() &amp;&amp; <a class="code" href="classXrdProofdAux.html#a44927170bd725bb1476300e603bb9332">XrdProofdAux::VerifyProcessByID</a>(ppid, <a class="code" href="classXrdProofdProofServMgr.html#a0dab770ad59dea7bbfceb63d345af63b">fParentExecs</a>.c_str()))</div><div class="line"><a name="l04091"></a><span class="lineno"> 4091</span>&#160;                  <span class="comment">// Process created by another running xrootd</span></div><div class="line"><a name="l04092"></a><span class="lineno"> 4092</span>&#160;                  <span class="keywordflow">break</span>;</div><div class="line"><a name="l04093"></a><span class="lineno"> 4093</span>&#160;               xppid = 0;</div><div class="line"><a name="l04094"></a><span class="lineno"> 4094</span>&#160;            }</div><div class="line"><a name="l04095"></a><span class="lineno"> 4095</span>&#160;            <span class="keywordflow">if</span> (xuid &amp;&amp; strstr(<a class="code" href="entrylistblock__figure1_8C.html#a4fa05b1f00fcde100685cc887554b93b">line</a>, <span class="stringliteral">&quot;Uid:&quot;</span>)) {</div><div class="line"><a name="l04096"></a><span class="lineno"> 4096</span>&#160;               <span class="keywordtype">int</span> uid = (int) <a class="code" href="classXrdProofdAux.html#a5776beb694ac4e6b2279707629d58fca">XrdProofdAux::GetLong</a>(&amp;<a class="code" href="entrylistblock__figure1_8C.html#a4fa05b1f00fcde100685cc887554b93b">line</a>[strlen(<span class="stringliteral">&quot;Uid:&quot;</span>)]);</div><div class="line"><a name="l04097"></a><span class="lineno"> 4097</span>&#160;               <span class="keywordflow">if</span> (refuid == uid)</div><div class="line"><a name="l04098"></a><span class="lineno"> 4098</span>&#160;                  xuid = 0;</div><div class="line"><a name="l04099"></a><span class="lineno"> 4099</span>&#160;            }</div><div class="line"><a name="l04100"></a><span class="lineno"> 4100</span>&#160;         }</div><div class="line"><a name="l04101"></a><span class="lineno"> 4101</span>&#160;         <span class="comment">// Close the file</span></div><div class="line"><a name="l04102"></a><span class="lineno"> 4102</span>&#160;         fclose(ffn);</div><div class="line"><a name="l04103"></a><span class="lineno"> 4103</span>&#160;         <span class="comment">// If this is a good candidate, kill it</span></div><div class="line"><a name="l04104"></a><span class="lineno"> 4104</span>&#160;         <span class="keywordflow">if</span> (!xname &amp;&amp; !xpid &amp;&amp; !xppid &amp;&amp; !xuid) {</div><div class="line"><a name="l04105"></a><span class="lineno"> 4105</span>&#160;</div><div class="line"><a name="l04106"></a><span class="lineno"> 4106</span>&#160;            <span class="keywordtype">bool</span> muok = 1;</div><div class="line"><a name="l04107"></a><span class="lineno"> 4107</span>&#160;            <span class="keywordflow">if</span> (<a class="code" href="classXrdProofdProofServMgr.html#a86cac591a5646811e38ff6a2477f4da7">fMgr</a>-&gt;<a class="code" href="classXrdProofdManager.html#a53f135f499c3ce6f653c118a400df741">MultiUser</a>() &amp;&amp; !all) {</div><div class="line"><a name="l04108"></a><span class="lineno"> 4108</span>&#160;               <span class="comment">// We need to check the user name: we may be the owner of somebody</span></div><div class="line"><a name="l04109"></a><span class="lineno"> 4109</span>&#160;               <span class="comment">// else process; if not session is attached, we kill it</span></div><div class="line"><a name="l04110"></a><span class="lineno"> 4110</span>&#160;               muok = 0;</div><div class="line"><a name="l04111"></a><span class="lineno"> 4111</span>&#160;               <a class="code" href="classXrdProofdProofServ.html">XrdProofdProofServ</a> *srv = <a class="code" href="classXrdProofdProofServMgr.html#a01b123203cef2462de822fabff1f2e11">GetActiveSession</a>(pid);</div><div class="line"><a name="l04112"></a><span class="lineno"> 4112</span>&#160;               <span class="keywordflow">if</span> (!srv || (srv &amp;&amp; !strcmp(usr, srv-&gt;<a class="code" href="classXrdProofdProofServ.html#a62e28c60bd4b82ddb9204185c3a41fc2">Client</a>())))</div><div class="line"><a name="l04113"></a><span class="lineno"> 4113</span>&#160;                  muok = 1;</div><div class="line"><a name="l04114"></a><span class="lineno"> 4114</span>&#160;            }</div><div class="line"><a name="l04115"></a><span class="lineno"> 4115</span>&#160;            <span class="keywordflow">if</span> (muok)</div><div class="line"><a name="l04116"></a><span class="lineno"> 4116</span>&#160;               <span class="keywordflow">if</span> (<a class="code" href="classXrdProofdAux.html#a6b1d64972dcdae69de7af68d43fdd5be">XrdProofdAux::KillProcess</a>(pid, 1, ui, <a class="code" href="classXrdProofdProofServMgr.html#a86cac591a5646811e38ff6a2477f4da7">fMgr</a>-&gt;<a class="code" href="classXrdProofdManager.html#a15d2e414e67bfc0cc4304605a6b509ff">ChangeOwn</a>()) == 0)</div><div class="line"><a name="l04117"></a><span class="lineno"> 4117</span>&#160;                  nk++;</div><div class="line"><a name="l04118"></a><span class="lineno"> 4118</span>&#160;         }</div><div class="line"><a name="l04119"></a><span class="lineno"> 4119</span>&#160;      }</div><div class="line"><a name="l04120"></a><span class="lineno"> 4120</span>&#160;   }</div><div class="line"><a name="l04121"></a><span class="lineno"> 4121</span>&#160;   <span class="comment">// Close the directory</span></div><div class="line"><a name="l04122"></a><span class="lineno"> 4122</span>&#160;   closedir(dir);</div><div class="line"><a name="l04123"></a><span class="lineno"> 4123</span>&#160;</div><div class="line"><a name="l04124"></a><span class="lineno"> 4124</span>&#160;<span class="preprocessor">#elif defined(__sun)</span></div><div class="line"><a name="l04125"></a><span class="lineno"> 4125</span>&#160;</div><div class="line"><a name="l04126"></a><span class="lineno"> 4126</span>&#160;   <span class="comment">// Loop over the &quot;/proc&quot; dir</span></div><div class="line"><a name="l04127"></a><span class="lineno"> 4127</span>&#160;   DIR *dir = opendir(<span class="stringliteral">&quot;/proc&quot;</span>);</div><div class="line"><a name="l04128"></a><span class="lineno"> 4128</span>&#160;   <span class="keywordflow">if</span> (!dir) {</div><div class="line"><a name="l04129"></a><span class="lineno"> 4129</span>&#160;      XrdOucString emsg(<span class="stringliteral">&quot;cannot open /proc - errno: &quot;</span>);</div><div class="line"><a name="l04130"></a><span class="lineno"> 4130</span>&#160;      emsg += errno;</div><div class="line"><a name="l04131"></a><span class="lineno"> 4131</span>&#160;      <a class="code" href="TGHtml_8h.html#ad5bb4a3d12fd54f29da2b924b29e652b">TRACE</a>(DBG, emsg);</div><div class="line"><a name="l04132"></a><span class="lineno"> 4132</span>&#160;      <span class="keywordflow">return</span> -1;</div><div class="line"><a name="l04133"></a><span class="lineno"> 4133</span>&#160;   }</div><div class="line"><a name="l04134"></a><span class="lineno"> 4134</span>&#160;</div><div class="line"><a name="l04135"></a><span class="lineno"> 4135</span>&#160;   <span class="keyword">struct </span>dirent *ent = 0;</div><div class="line"><a name="l04136"></a><span class="lineno"> 4136</span>&#160;   <span class="keywordflow">while</span> ((ent = readdir(dir))) {</div><div class="line"><a name="l04137"></a><span class="lineno"> 4137</span>&#160;      <span class="keywordflow">if</span> (!strncmp(ent-&gt;d_name, <span class="stringliteral">&quot;.&quot;</span>, 1) || !strncmp(ent-&gt;d_name, <span class="stringliteral">&quot;..&quot;</span>, 2)) <span class="keywordflow">continue</span>;</div><div class="line"><a name="l04138"></a><span class="lineno"> 4138</span>&#160;      <span class="keywordflow">if</span> (<a class="code" href="XrdProofdAux_8h.html#a0ef73da06cb8a7145a87bdef7d1a9dc3">DIGIT</a>(ent-&gt;d_name[0])) {</div><div class="line"><a name="l04139"></a><span class="lineno"> 4139</span>&#160;         XrdOucString fn(<span class="stringliteral">&quot;/proc/&quot;</span>, 256);</div><div class="line"><a name="l04140"></a><span class="lineno"> 4140</span>&#160;         fn += ent-&gt;d_name;</div><div class="line"><a name="l04141"></a><span class="lineno"> 4141</span>&#160;         fn += <span class="stringliteral">&quot;/psinfo&quot;</span>;</div><div class="line"><a name="l04142"></a><span class="lineno"> 4142</span>&#160;         <span class="comment">// Open file</span></div><div class="line"><a name="l04143"></a><span class="lineno"> 4143</span>&#160;         <span class="keywordtype">int</span> ffd = <a class="code" href="namespaceROOT_1_1Math_1_1detail.html#af7bd9296f106e2e1402e539ca33bdf94a37cfce0c407fb91bb0b1d71b586841a3">open</a>(fn.c_str(), O_RDONLY);</div><div class="line"><a name="l04144"></a><span class="lineno"> 4144</span>&#160;         <span class="keywordflow">if</span> (ffd &lt;= 0) {</div><div class="line"><a name="l04145"></a><span class="lineno"> 4145</span>&#160;            XrdOucString emsg(<span class="stringliteral">&quot;cannot open file &quot;</span>);</div><div class="line"><a name="l04146"></a><span class="lineno"> 4146</span>&#160;            emsg += fn; emsg += <span class="stringliteral">&quot; - errno: &quot;</span>; emsg += errno;</div><div class="line"><a name="l04147"></a><span class="lineno"> 4147</span>&#160;            <a class="code" href="TGHtml_8h.html#ad5bb4a3d12fd54f29da2b924b29e652b">TRACE</a>(HDBG, emsg);</div><div class="line"><a name="l04148"></a><span class="lineno"> 4148</span>&#160;            <span class="keywordflow">continue</span>;</div><div class="line"><a name="l04149"></a><span class="lineno"> 4149</span>&#160;         }</div><div class="line"><a name="l04150"></a><span class="lineno"> 4150</span>&#160;         <span class="comment">// Read info</span></div><div class="line"><a name="l04151"></a><span class="lineno"> 4151</span>&#160;         <span class="keywordtype">bool</span> xname = 1;</div><div class="line"><a name="l04152"></a><span class="lineno"> 4152</span>&#160;         <span class="keywordtype">bool</span> xuid = (all) ? 0 : 1;</div><div class="line"><a name="l04153"></a><span class="lineno"> 4153</span>&#160;         <span class="keywordtype">bool</span> xppid = 1;</div><div class="line"><a name="l04154"></a><span class="lineno"> 4154</span>&#160;         <span class="comment">// Get the information</span></div><div class="line"><a name="l04155"></a><span class="lineno"> 4155</span>&#160;         psinfo_t psi;</div><div class="line"><a name="l04156"></a><span class="lineno"> 4156</span>&#160;         <span class="keywordflow">if</span> (read(ffd, &amp;psi, <span class="keyword">sizeof</span>(psinfo_t)) != <span class="keyword">sizeof</span>(psinfo_t)) {</div><div class="line"><a name="l04157"></a><span class="lineno"> 4157</span>&#160;            XrdOucString emsg(<span class="stringliteral">&quot;cannot read &quot;</span>);</div><div class="line"><a name="l04158"></a><span class="lineno"> 4158</span>&#160;            emsg += fn; emsg += <span class="stringliteral">&quot;: errno: &quot;</span>; emsg += errno;</div><div class="line"><a name="l04159"></a><span class="lineno"> 4159</span>&#160;            <a class="code" href="TGHtml_8h.html#ad5bb4a3d12fd54f29da2b924b29e652b">TRACE</a>(XERR, emsg);</div><div class="line"><a name="l04160"></a><span class="lineno"> 4160</span>&#160;            <a class="code" href="namespaceROOT_1_1Math_1_1detail.html#af7bd9296f106e2e1402e539ca33bdf94ab53b0352d838d5792986f47b2c72b787">close</a>(ffd);</div><div class="line"><a name="l04161"></a><span class="lineno"> 4161</span>&#160;            <span class="keywordflow">continue</span>;</div><div class="line"><a name="l04162"></a><span class="lineno"> 4162</span>&#160;         }</div><div class="line"><a name="l04163"></a><span class="lineno"> 4163</span>&#160;         <span class="comment">// Close the file</span></div><div class="line"><a name="l04164"></a><span class="lineno"> 4164</span>&#160;         <a class="code" href="namespaceROOT_1_1Math_1_1detail.html#af7bd9296f106e2e1402e539ca33bdf94ab53b0352d838d5792986f47b2c72b787">close</a>(ffd);</div><div class="line"><a name="l04165"></a><span class="lineno"> 4165</span>&#160;</div><div class="line"><a name="l04166"></a><span class="lineno"> 4166</span>&#160;         <span class="comment">// Check name</span></div><div class="line"><a name="l04167"></a><span class="lineno"> 4167</span>&#160;         <span class="keywordflow">if</span> (xname) {</div><div class="line"><a name="l04168"></a><span class="lineno"> 4168</span>&#160;            <span class="keywordflow">if</span> (!strstr(psi.pr_fname, pn))</div><div class="line"><a name="l04169"></a><span class="lineno"> 4169</span>&#160;               <span class="keywordflow">continue</span>;</div><div class="line"><a name="l04170"></a><span class="lineno"> 4170</span>&#160;            xname = 0;</div><div class="line"><a name="l04171"></a><span class="lineno"> 4171</span>&#160;         }</div><div class="line"><a name="l04172"></a><span class="lineno"> 4172</span>&#160;         <span class="comment">// Check uid, if required</span></div><div class="line"><a name="l04173"></a><span class="lineno"> 4173</span>&#160;         <span class="keywordflow">if</span> (xuid) {</div><div class="line"><a name="l04174"></a><span class="lineno"> 4174</span>&#160;            <span class="keywordflow">if</span> (refuid == psi.pr_uid)</div><div class="line"><a name="l04175"></a><span class="lineno"> 4175</span>&#160;               xuid = 0;</div><div class="line"><a name="l04176"></a><span class="lineno"> 4176</span>&#160;         }</div><div class="line"><a name="l04177"></a><span class="lineno"> 4177</span>&#160;         <span class="comment">// Parent process must be us or be dead</span></div><div class="line"><a name="l04178"></a><span class="lineno"> 4178</span>&#160;         <span class="keywordtype">int</span> ppid = psi.pr_ppid;</div><div class="line"><a name="l04179"></a><span class="lineno"> 4179</span>&#160;         <span class="keywordflow">if</span> (ppid != getpid() &amp;&amp; <a class="code" href="classXrdProofdAux.html#a44927170bd725bb1476300e603bb9332">XrdProofdAux::VerifyProcessByID</a>(ppid, <a class="code" href="classXrdProofdProofServMgr.html#a0dab770ad59dea7bbfceb63d345af63b">fParentExecs</a>.c_str())) {</div><div class="line"><a name="l04180"></a><span class="lineno"> 4180</span>&#160;            <span class="comment">// Process created by another running xrootd</span></div><div class="line"><a name="l04181"></a><span class="lineno"> 4181</span>&#160;            <span class="keywordflow">continue</span>;</div><div class="line"><a name="l04182"></a><span class="lineno"> 4182</span>&#160;            xppid = 0;</div><div class="line"><a name="l04183"></a><span class="lineno"> 4183</span>&#160;         }</div><div class="line"><a name="l04184"></a><span class="lineno"> 4184</span>&#160;</div><div class="line"><a name="l04185"></a><span class="lineno"> 4185</span>&#160;         <span class="comment">// If this is a good candidate, kill it</span></div><div class="line"><a name="l04186"></a><span class="lineno"> 4186</span>&#160;         <span class="keywordflow">if</span> (!xname &amp;&amp; !xppid &amp;&amp; !xuid) {</div><div class="line"><a name="l04187"></a><span class="lineno"> 4187</span>&#160;            <span class="keywordtype">bool</span> muok = 1;</div><div class="line"><a name="l04188"></a><span class="lineno"> 4188</span>&#160;            <span class="keywordflow">if</span> (<a class="code" href="classXrdProofdProofServMgr.html#a86cac591a5646811e38ff6a2477f4da7">fMgr</a>-&gt;<a class="code" href="classXrdProofdManager.html#a53f135f499c3ce6f653c118a400df741">MultiUser</a>() &amp;&amp; !all) {</div><div class="line"><a name="l04189"></a><span class="lineno"> 4189</span>&#160;               <span class="comment">// We need to check the user name: we may be the owner of somebody</span></div><div class="line"><a name="l04190"></a><span class="lineno"> 4190</span>&#160;               <span class="comment">// else process; if no session is attached , we kill it</span></div><div class="line"><a name="l04191"></a><span class="lineno"> 4191</span>&#160;               muok = 0;</div><div class="line"><a name="l04192"></a><span class="lineno"> 4192</span>&#160;               <a class="code" href="classXrdProofdProofServ.html">XrdProofdProofServ</a> *srv = <a class="code" href="classXrdProofdProofServMgr.html#a01b123203cef2462de822fabff1f2e11">GetActiveSession</a>(psi.pr_pid);</div><div class="line"><a name="l04193"></a><span class="lineno"> 4193</span>&#160;               <span class="keywordflow">if</span> (!srv || (srv &amp;&amp; !strcmp(usr, srv-&gt;<a class="code" href="classXrdProofdProofServ.html#a62e28c60bd4b82ddb9204185c3a41fc2">Client</a>())))</div><div class="line"><a name="l04194"></a><span class="lineno"> 4194</span>&#160;                  muok = 1;</div><div class="line"><a name="l04195"></a><span class="lineno"> 4195</span>&#160;            }</div><div class="line"><a name="l04196"></a><span class="lineno"> 4196</span>&#160;            <span class="keywordflow">if</span> (muok)</div><div class="line"><a name="l04197"></a><span class="lineno"> 4197</span>&#160;               <span class="keywordflow">if</span> (<a class="code" href="classXrdProofdAux.html#a6b1d64972dcdae69de7af68d43fdd5be">XrdProofdAux::KillProcess</a>(psi.pr_pid, 1, ui, <a class="code" href="classXrdProofdProofServMgr.html#a86cac591a5646811e38ff6a2477f4da7">fMgr</a>-&gt;<a class="code" href="classXrdProofdManager.html#a15d2e414e67bfc0cc4304605a6b509ff">ChangeOwn</a>()) == 0)</div><div class="line"><a name="l04198"></a><span class="lineno"> 4198</span>&#160;                  nk++;</div><div class="line"><a name="l04199"></a><span class="lineno"> 4199</span>&#160;         }</div><div class="line"><a name="l04200"></a><span class="lineno"> 4200</span>&#160;      }</div><div class="line"><a name="l04201"></a><span class="lineno"> 4201</span>&#160;   }</div><div class="line"><a name="l04202"></a><span class="lineno"> 4202</span>&#160;   <span class="comment">// Close the directory</span></div><div class="line"><a name="l04203"></a><span class="lineno"> 4203</span>&#160;   closedir(dir);</div><div class="line"><a name="l04204"></a><span class="lineno"> 4204</span>&#160;</div><div class="line"><a name="l04205"></a><span class="lineno"> 4205</span>&#160;<span class="preprocessor">#elif defined(__FreeBSD__) || defined(__OpenBSD__) || defined(__APPLE__)</span></div><div class="line"><a name="l04206"></a><span class="lineno"> 4206</span>&#160;</div><div class="line"><a name="l04207"></a><span class="lineno"> 4207</span>&#160;   <span class="comment">// Get the proclist</span></div><div class="line"><a name="l04208"></a><span class="lineno"> 4208</span>&#160;   kinfo_proc *pl = 0;</div><div class="line"><a name="l04209"></a><span class="lineno"> 4209</span>&#160;   <span class="keywordtype">int</span> np;</div><div class="line"><a name="l04210"></a><span class="lineno"> 4210</span>&#160;   <span class="keywordtype">int</span> ern = 0;</div><div class="line"><a name="l04211"></a><span class="lineno"> 4211</span>&#160;   <span class="keywordflow">if</span> ((ern = XrdProofdAux::GetMacProcList(&amp;pl, np)) != 0) {</div><div class="line"><a name="l04212"></a><span class="lineno"> 4212</span>&#160;      XrdOucString emsg(<span class="stringliteral">&quot;cannot get the process list: errno: &quot;</span>);</div><div class="line"><a name="l04213"></a><span class="lineno"> 4213</span>&#160;      emsg += ern;</div><div class="line"><a name="l04214"></a><span class="lineno"> 4214</span>&#160;      <a class="code" href="TGHtml_8h.html#ad5bb4a3d12fd54f29da2b924b29e652b">TRACE</a>(XERR, emsg);</div><div class="line"><a name="l04215"></a><span class="lineno"> 4215</span>&#160;      <span class="keywordflow">return</span> -1;</div><div class="line"><a name="l04216"></a><span class="lineno"> 4216</span>&#160;   }</div><div class="line"><a name="l04217"></a><span class="lineno"> 4217</span>&#160;</div><div class="line"><a name="l04218"></a><span class="lineno"> 4218</span>&#160;   <span class="comment">// Loop over the list</span></div><div class="line"><a name="l04219"></a><span class="lineno"> 4219</span>&#160;   <span class="keywordtype">int</span> ii = np;</div><div class="line"><a name="l04220"></a><span class="lineno"> 4220</span>&#160;   <span class="keywordflow">while</span> (ii--) {</div><div class="line"><a name="l04221"></a><span class="lineno"> 4221</span>&#160;      <span class="keywordflow">if</span> (strstr(pl[ii].kp_proc.p_comm, pn)) {</div><div class="line"><a name="l04222"></a><span class="lineno"> 4222</span>&#160;         <span class="keywordflow">if</span> (all || (<span class="keywordtype">int</span>)(pl[ii].kp_eproc.e_ucred.cr_uid) == refuid) {</div><div class="line"><a name="l04223"></a><span class="lineno"> 4223</span>&#160;            <span class="comment">// Parent process must be us or be dead</span></div><div class="line"><a name="l04224"></a><span class="lineno"> 4224</span>&#160;            <span class="keywordtype">int</span> ppid = pl[ii].kp_eproc.e_ppid;</div><div class="line"><a name="l04225"></a><span class="lineno"> 4225</span>&#160;            <span class="keywordtype">bool</span> xppid = 0;</div><div class="line"><a name="l04226"></a><span class="lineno"> 4226</span>&#160;            <span class="keywordflow">if</span> (ppid != getpid()) {</div><div class="line"><a name="l04227"></a><span class="lineno"> 4227</span>&#160;               <span class="keywordtype">int</span> jj = np;</div><div class="line"><a name="l04228"></a><span class="lineno"> 4228</span>&#160;               <span class="keywordflow">while</span> (jj--) {</div><div class="line"><a name="l04229"></a><span class="lineno"> 4229</span>&#160;                  <span class="keywordflow">if</span> (strstr(pl[jj].kp_proc.p_comm, <span class="stringliteral">&quot;xrootd&quot;</span>) &amp;&amp;</div><div class="line"><a name="l04230"></a><span class="lineno"> 4230</span>&#160;                      pl[jj].kp_proc.p_pid == ppid) {</div><div class="line"><a name="l04231"></a><span class="lineno"> 4231</span>&#160;                      xppid = 1;</div><div class="line"><a name="l04232"></a><span class="lineno"> 4232</span>&#160;                      <span class="keywordflow">break</span>;</div><div class="line"><a name="l04233"></a><span class="lineno"> 4233</span>&#160;                  }</div><div class="line"><a name="l04234"></a><span class="lineno"> 4234</span>&#160;               }</div><div class="line"><a name="l04235"></a><span class="lineno"> 4235</span>&#160;            }</div><div class="line"><a name="l04236"></a><span class="lineno"> 4236</span>&#160;            <span class="keywordflow">if</span> (!xppid) {</div><div class="line"><a name="l04237"></a><span class="lineno"> 4237</span>&#160;               <span class="keywordtype">bool</span> muok = 1;</div><div class="line"><a name="l04238"></a><span class="lineno"> 4238</span>&#160;               <span class="keywordflow">if</span> (<a class="code" href="classXrdProofdProofServMgr.html#a86cac591a5646811e38ff6a2477f4da7">fMgr</a>-&gt;<a class="code" href="classXrdProofdManager.html#a53f135f499c3ce6f653c118a400df741">MultiUser</a>() &amp;&amp; !all) {</div><div class="line"><a name="l04239"></a><span class="lineno"> 4239</span>&#160;                  <span class="comment">// We need to check the user name: we may be the owner of somebody</span></div><div class="line"><a name="l04240"></a><span class="lineno"> 4240</span>&#160;                  <span class="comment">// else process; if no session is attached, we kill it</span></div><div class="line"><a name="l04241"></a><span class="lineno"> 4241</span>&#160;                  muok = 0;</div><div class="line"><a name="l04242"></a><span class="lineno"> 4242</span>&#160;                  <a class="code" href="classXrdProofdProofServ.html">XrdProofdProofServ</a> *srv = <a class="code" href="classXrdProofdProofServMgr.html#a01b123203cef2462de822fabff1f2e11">GetActiveSession</a>(pl[np].kp_proc.p_pid);</div><div class="line"><a name="l04243"></a><span class="lineno"> 4243</span>&#160;                  <span class="keywordflow">if</span> (!srv || (srv &amp;&amp; !strcmp(usr, srv-&gt;<a class="code" href="classXrdProofdProofServ.html#a62e28c60bd4b82ddb9204185c3a41fc2">Client</a>())))</div><div class="line"><a name="l04244"></a><span class="lineno"> 4244</span>&#160;                     muok = 1;</div><div class="line"><a name="l04245"></a><span class="lineno"> 4245</span>&#160;               }</div><div class="line"><a name="l04246"></a><span class="lineno"> 4246</span>&#160;               <span class="keywordflow">if</span> (muok)</div><div class="line"><a name="l04247"></a><span class="lineno"> 4247</span>&#160;                  <span class="comment">// Good candidate to be shot</span></div><div class="line"><a name="l04248"></a><span class="lineno"> 4248</span>&#160;                  <span class="keywordflow">if</span> (<a class="code" href="classXrdProofdAux.html#a6b1d64972dcdae69de7af68d43fdd5be">XrdProofdAux::KillProcess</a>(pl[np].kp_proc.p_pid, 1, ui, <a class="code" href="classXrdProofdProofServMgr.html#a86cac591a5646811e38ff6a2477f4da7">fMgr</a>-&gt;<a class="code" href="classXrdProofdManager.html#a15d2e414e67bfc0cc4304605a6b509ff">ChangeOwn</a>()))</div><div class="line"><a name="l04249"></a><span class="lineno"> 4249</span>&#160;                     nk++;</div><div class="line"><a name="l04250"></a><span class="lineno"> 4250</span>&#160;            }</div><div class="line"><a name="l04251"></a><span class="lineno"> 4251</span>&#160;         }</div><div class="line"><a name="l04252"></a><span class="lineno"> 4252</span>&#160;      }</div><div class="line"><a name="l04253"></a><span class="lineno"> 4253</span>&#160;   }</div><div class="line"><a name="l04254"></a><span class="lineno"> 4254</span>&#160;   <span class="comment">// Cleanup</span></div><div class="line"><a name="l04255"></a><span class="lineno"> 4255</span>&#160;   <a class="code" href="civetweb_8c.html#a2c6efa7679f8cd9f61af96e105017560">free</a>(pl);</div><div class="line"><a name="l04256"></a><span class="lineno"> 4256</span>&#160;<span class="preprocessor">#else</span></div><div class="line"><a name="l04257"></a><span class="lineno"> 4257</span>&#160;   <span class="comment">// For the remaining cases we use &#39;ps&#39; via popen to localize the processes</span></div><div class="line"><a name="l04258"></a><span class="lineno"> 4258</span>&#160;</div><div class="line"><a name="l04259"></a><span class="lineno"> 4259</span>&#160;   <span class="comment">// Build command</span></div><div class="line"><a name="l04260"></a><span class="lineno"> 4260</span>&#160;   XrdOucString cmd = <span class="stringliteral">&quot;ps &quot;</span>;</div><div class="line"><a name="l04261"></a><span class="lineno"> 4261</span>&#160;   <span class="keywordtype">bool</span> busr = 0;</div><div class="line"><a name="l04262"></a><span class="lineno"> 4262</span>&#160;<span class="preprocessor">#if 0</span></div><div class="line"><a name="l04263"></a><span class="lineno"> 4263</span>&#160;   <span class="comment">// Left over of some previous implementation; but here fSuperUser is not defined: to be checked</span></div><div class="line"><a name="l04264"></a><span class="lineno"> 4264</span>&#160;   <span class="keyword">const</span> <span class="keywordtype">char</span> *cusr = (usr &amp;&amp; strlen(usr) &amp;&amp; fSuperUser) ? usr : fPClient-&gt;ID();</div><div class="line"><a name="l04265"></a><span class="lineno"> 4265</span>&#160;<span class="preprocessor">#else</span></div><div class="line"><a name="l04266"></a><span class="lineno"> 4266</span>&#160;   <span class="keyword">const</span> <span class="keywordtype">char</span> *cusr = (usr &amp;&amp; strlen(usr)) ? usr : 0;</div><div class="line"><a name="l04267"></a><span class="lineno"> 4267</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l04268"></a><span class="lineno"> 4268</span>&#160;   <span class="keywordflow">if</span> (all) {</div><div class="line"><a name="l04269"></a><span class="lineno"> 4269</span>&#160;      cmd += <span class="stringliteral">&quot;ax&quot;</span>;</div><div class="line"><a name="l04270"></a><span class="lineno"> 4270</span>&#160;   } <span class="keywordflow">else</span> {</div><div class="line"><a name="l04271"></a><span class="lineno"> 4271</span>&#160;      <span class="keywordflow">if</span> (cusr) {</div><div class="line"><a name="l04272"></a><span class="lineno"> 4272</span>&#160;         cmd += <span class="stringliteral">&quot;-U &quot;</span>;</div><div class="line"><a name="l04273"></a><span class="lineno"> 4273</span>&#160;         cmd += cusr;</div><div class="line"><a name="l04274"></a><span class="lineno"> 4274</span>&#160;         cmd += <span class="stringliteral">&quot; -u &quot;</span>;</div><div class="line"><a name="l04275"></a><span class="lineno"> 4275</span>&#160;         cmd += cusr;</div><div class="line"><a name="l04276"></a><span class="lineno"> 4276</span>&#160;      }</div><div class="line"><a name="l04277"></a><span class="lineno"> 4277</span>&#160;      cmd += <span class="stringliteral">&quot; -f&quot;</span>;</div><div class="line"><a name="l04278"></a><span class="lineno"> 4278</span>&#160;      busr = 1;</div><div class="line"><a name="l04279"></a><span class="lineno"> 4279</span>&#160;   }</div><div class="line"><a name="l04280"></a><span class="lineno"> 4280</span>&#160;   cmd += <span class="stringliteral">&quot; | grep proofserv 2&gt;/dev/null&quot;</span>;</div><div class="line"><a name="l04281"></a><span class="lineno"> 4281</span>&#160;</div><div class="line"><a name="l04282"></a><span class="lineno"> 4282</span>&#160;   <span class="comment">// Our parent ID as a string</span></div><div class="line"><a name="l04283"></a><span class="lineno"> 4283</span>&#160;   <span class="keywordtype">char</span> cpid[10];</div><div class="line"><a name="l04284"></a><span class="lineno"> 4284</span>&#160;   <a class="code" href="civetweb_8c.html#aa367b75c5aed883fef5befbdf04835a4">snprintf</a>(cpid, 10, <span class="stringliteral">&quot;%d&quot;</span>, getpid());</div><div class="line"><a name="l04285"></a><span class="lineno"> 4285</span>&#160;</div><div class="line"><a name="l04286"></a><span class="lineno"> 4286</span>&#160;   <span class="comment">// Run it ...</span></div><div class="line"><a name="l04287"></a><span class="lineno"> 4287</span>&#160;   XrdOucString pids = <span class="stringliteral">&quot;:&quot;</span>;</div><div class="line"><a name="l04288"></a><span class="lineno"> 4288</span>&#160;   FILE *fp = popen(cmd.c_str(), <span class="stringliteral">&quot;r&quot;</span>);</div><div class="line"><a name="l04289"></a><span class="lineno"> 4289</span>&#160;   <span class="keywordflow">if</span> (fp != 0) {</div><div class="line"><a name="l04290"></a><span class="lineno"> 4290</span>&#160;      <span class="keywordtype">char</span> <a class="code" href="entrylistblock__figure1_8C.html#a4fa05b1f00fcde100685cc887554b93b">line</a>[2048] = { 0 };</div><div class="line"><a name="l04291"></a><span class="lineno"> 4291</span>&#160;      <span class="keywordflow">while</span> (fgets(<a class="code" href="entrylistblock__figure1_8C.html#a4fa05b1f00fcde100685cc887554b93b">line</a>, <span class="keyword">sizeof</span>(<a class="code" href="entrylistblock__figure1_8C.html#a4fa05b1f00fcde100685cc887554b93b">line</a>), fp)) {</div><div class="line"><a name="l04292"></a><span class="lineno"> 4292</span>&#160;         <span class="comment">// Parse line: make sure that we are the parent</span></div><div class="line"><a name="l04293"></a><span class="lineno"> 4293</span>&#160;         <span class="keywordtype">char</span> *px = strstr(<a class="code" href="entrylistblock__figure1_8C.html#a4fa05b1f00fcde100685cc887554b93b">line</a>, <span class="stringliteral">&quot;xpd&quot;</span>);</div><div class="line"><a name="l04294"></a><span class="lineno"> 4294</span>&#160;         <span class="keywordflow">if</span> (!px)</div><div class="line"><a name="l04295"></a><span class="lineno"> 4295</span>&#160;            <span class="comment">// Not xpd: old proofd ?</span></div><div class="line"><a name="l04296"></a><span class="lineno"> 4296</span>&#160;            <span class="keywordflow">continue</span>;</div><div class="line"><a name="l04297"></a><span class="lineno"> 4297</span>&#160;         <span class="keywordtype">char</span> *<a class="code" href="namespaceTGeant4Unit.html#a61aca601fa057e4f7601210bcc81d478">pi</a> = strstr(px+3, cpid);</div><div class="line"><a name="l04298"></a><span class="lineno"> 4298</span>&#160;         <span class="keywordflow">if</span> (!<a class="code" href="namespaceTGeant4Unit.html#a61aca601fa057e4f7601210bcc81d478">pi</a>) {</div><div class="line"><a name="l04299"></a><span class="lineno"> 4299</span>&#160;            <span class="comment">// Not started by us: check if the parent is still running</span></div><div class="line"><a name="l04300"></a><span class="lineno"> 4300</span>&#160;            <a class="code" href="namespaceTGeant4Unit.html#a61aca601fa057e4f7601210bcc81d478">pi</a> = px + 3;</div><div class="line"><a name="l04301"></a><span class="lineno"> 4301</span>&#160;            <span class="keywordtype">int</span> ppid = (int) <a class="code" href="classXrdProofdAux.html#a5776beb694ac4e6b2279707629d58fca">XrdProofdAux::GetLong</a>(<a class="code" href="namespaceTGeant4Unit.html#a61aca601fa057e4f7601210bcc81d478">pi</a>);</div><div class="line"><a name="l04302"></a><span class="lineno"> 4302</span>&#160;            <a class="code" href="TGHtml_8h.html#ad5bb4a3d12fd54f29da2b924b29e652b">TRACE</a>(HDBG, <span class="stringliteral">&quot;found alternative parent ID: &quot;</span>&lt;&lt; ppid);</div><div class="line"><a name="l04303"></a><span class="lineno"> 4303</span>&#160;            <span class="comment">// If still running then skip</span></div><div class="line"><a name="l04304"></a><span class="lineno"> 4304</span>&#160;            <span class="keywordflow">if</span> (<a class="code" href="classXrdProofdAux.html#a44927170bd725bb1476300e603bb9332">XrdProofdAux::VerifyProcessByID</a>(ppid, <a class="code" href="classXrdProofdProofServMgr.html#a0dab770ad59dea7bbfceb63d345af63b">fParentExecs</a>.c_str()))</div><div class="line"><a name="l04305"></a><span class="lineno"> 4305</span>&#160;               <span class="keywordflow">continue</span>;</div><div class="line"><a name="l04306"></a><span class="lineno"> 4306</span>&#160;         }</div><div class="line"><a name="l04307"></a><span class="lineno"> 4307</span>&#160;         <span class="comment">// Get pid now</span></div><div class="line"><a name="l04308"></a><span class="lineno"> 4308</span>&#160;         <span class="keywordtype">int</span> from = 0;</div><div class="line"><a name="l04309"></a><span class="lineno"> 4309</span>&#160;         <span class="keywordflow">if</span> (busr)</div><div class="line"><a name="l04310"></a><span class="lineno"> 4310</span>&#160;            from += strlen(cusr);</div><div class="line"><a name="l04311"></a><span class="lineno"> 4311</span>&#160;         <span class="keywordtype">int</span> pid = (int) <a class="code" href="classXrdProofdAux.html#a5776beb694ac4e6b2279707629d58fca">XrdProofdAux::GetLong</a>(&amp;<a class="code" href="entrylistblock__figure1_8C.html#a4fa05b1f00fcde100685cc887554b93b">line</a>[from]);</div><div class="line"><a name="l04312"></a><span class="lineno"> 4312</span>&#160;         <span class="keywordtype">bool</span> muok = 1;</div><div class="line"><a name="l04313"></a><span class="lineno"> 4313</span>&#160;         <span class="keywordflow">if</span> (<a class="code" href="classXrdProofdProofServMgr.html#a86cac591a5646811e38ff6a2477f4da7">fMgr</a>-&gt;<a class="code" href="classXrdProofdManager.html#a53f135f499c3ce6f653c118a400df741">MultiUser</a>() &amp;&amp; !all) {</div><div class="line"><a name="l04314"></a><span class="lineno"> 4314</span>&#160;            <span class="comment">// We need to check the user name: we may be the owner of somebody</span></div><div class="line"><a name="l04315"></a><span class="lineno"> 4315</span>&#160;            <span class="comment">// else process; if no session is attached, we kill it</span></div><div class="line"><a name="l04316"></a><span class="lineno"> 4316</span>&#160;            muok = 0;</div><div class="line"><a name="l04317"></a><span class="lineno"> 4317</span>&#160;            <a class="code" href="classXrdProofdProofServ.html">XrdProofdProofServ</a> *srv = <a class="code" href="classXrdProofdProofServMgr.html#a01b123203cef2462de822fabff1f2e11">GetActiveSession</a>(pid);</div><div class="line"><a name="l04318"></a><span class="lineno"> 4318</span>&#160;            <span class="keywordflow">if</span> (!srv || (srv &amp;&amp; !strcmp(usr, srv-&gt;<a class="code" href="classXrdProofdProofServ.html#a62e28c60bd4b82ddb9204185c3a41fc2">Client</a>())))</div><div class="line"><a name="l04319"></a><span class="lineno"> 4319</span>&#160;               muok = 1;</div><div class="line"><a name="l04320"></a><span class="lineno"> 4320</span>&#160;         }</div><div class="line"><a name="l04321"></a><span class="lineno"> 4321</span>&#160;         <span class="keywordflow">if</span> (muok)</div><div class="line"><a name="l04322"></a><span class="lineno"> 4322</span>&#160;            <span class="comment">// Kill it</span></div><div class="line"><a name="l04323"></a><span class="lineno"> 4323</span>&#160;            <span class="keywordflow">if</span> (<a class="code" href="classXrdProofdAux.html#a6b1d64972dcdae69de7af68d43fdd5be">XrdProofdAux::KillProcess</a>(pid, 1, ui, <a class="code" href="classXrdProofdProofServMgr.html#a86cac591a5646811e38ff6a2477f4da7">fMgr</a>-&gt;<a class="code" href="classXrdProofdManager.html#a15d2e414e67bfc0cc4304605a6b509ff">ChangeOwn</a>()) == 0)</div><div class="line"><a name="l04324"></a><span class="lineno"> 4324</span>&#160;               nk++;</div><div class="line"><a name="l04325"></a><span class="lineno"> 4325</span>&#160;      }</div><div class="line"><a name="l04326"></a><span class="lineno"> 4326</span>&#160;      pclose(fp);</div><div class="line"><a name="l04327"></a><span class="lineno"> 4327</span>&#160;   } <span class="keywordflow">else</span> {</div><div class="line"><a name="l04328"></a><span class="lineno"> 4328</span>&#160;      <span class="comment">// Error executing the command</span></div><div class="line"><a name="l04329"></a><span class="lineno"> 4329</span>&#160;      <span class="keywordflow">return</span> -1;</div><div class="line"><a name="l04330"></a><span class="lineno"> 4330</span>&#160;   }</div><div class="line"><a name="l04331"></a><span class="lineno"> 4331</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l04332"></a><span class="lineno"> 4332</span>&#160;</div><div class="line"><a name="l04333"></a><span class="lineno"> 4333</span>&#160;   <span class="comment">// Done</span></div><div class="line"><a name="l04334"></a><span class="lineno"> 4334</span>&#160;   <span class="keywordflow">return</span> nk;</div><div class="line"><a name="l04335"></a><span class="lineno"> 4335</span>&#160;}</div><div class="line"><a name="l04336"></a><span class="lineno"> 4336</span>&#160;<span class="comment"></span></div><div class="line"><a name="l04337"></a><span class="lineno"> 4337</span>&#160;<span class="comment">////////////////////////////////////////////////////////////////////////////////</span></div><div class="line"><a name="l04338"></a><span class="lineno"> 4338</span>&#160;<span class="comment">/// Set user ownerships on some critical files or directories.</span></div><div class="line"><a name="l04339"></a><span class="lineno"> 4339</span>&#160;<span class="comment">/// Return 0 on success, -1 if enything goes wrong.</span></div><div class="line"><a name="l04340"></a><span class="lineno"> 4340</span>&#160;<span class="comment"></span></div><div class="line"><a name="l04341"></a><span class="lineno"><a class="line" href="classXrdProofdProofServMgr.html#aab3b1838487f683e509be19e243ef02a"> 4341</a></span>&#160;<span class="keywordtype">int</span> <a class="code" href="classXrdProofdProofServMgr.html#aab3b1838487f683e509be19e243ef02a">XrdProofdProofServMgr::SetUserOwnerships</a>(<a class="code" href="classXrdProofdProtocol.html">XrdProofdProtocol</a> *p,</div><div class="line"><a name="l04342"></a><span class="lineno"> 4342</span>&#160;                                             <span class="keyword">const</span> <span class="keywordtype">char</span> *ord, <span class="keyword">const</span> <span class="keywordtype">char</span> *stag)</div><div class="line"><a name="l04343"></a><span class="lineno"> 4343</span>&#160;{</div><div class="line"><a name="l04344"></a><span class="lineno"> 4344</span>&#160;   <a class="code" href="XrdProofdTrace_8h.html#a7c31822912a8d0dc9bfd544097b29e12">XPDLOC</a>(SMGR, <span class="stringliteral">&quot;ProofServMgr::SetUserOwnerships&quot;</span>)</div><div class="line"><a name="l04345"></a><span class="lineno"> 4345</span>&#160;</div><div class="line"><a name="l04346"></a><span class="lineno"> 4346</span>&#160;   <a class="code" href="TGHtml_8h.html#ad5bb4a3d12fd54f29da2b924b29e652b">TRACE</a>(REQ, <span class="stringliteral">&quot;enter&quot;</span>);</div><div class="line"><a name="l04347"></a><span class="lineno"> 4347</span>&#160;</div><div class="line"><a name="l04348"></a><span class="lineno"> 4348</span>&#160;   <span class="comment">// If applicable, make sure that the private dataset dir for this user exists</span></div><div class="line"><a name="l04349"></a><span class="lineno"> 4349</span>&#160;   <span class="comment">// and has the right permissions</span></div><div class="line"><a name="l04350"></a><span class="lineno"> 4350</span>&#160;   <span class="keywordflow">if</span> (<a class="code" href="classXrdProofdProofServMgr.html#a86cac591a5646811e38ff6a2477f4da7">fMgr</a>-&gt;<a class="code" href="classXrdProofdManager.html#a4a2a77a074ead8e9c504a7fa758d2e9d">DataSetSrcs</a>()-&gt;size() &gt; 0) {</div><div class="line"><a name="l04351"></a><span class="lineno"> 4351</span>&#160;      <a class="code" href="classXrdProofUI.html">XrdProofUI</a> ui;</div><div class="line"><a name="l04352"></a><span class="lineno"> 4352</span>&#160;      <a class="code" href="classXrdProofdAux.html#a0230423581c62e4fabf4fda6538fd4a7">XrdProofdAux::GetUserInfo</a>(<a class="code" href="classXrdProofdProtocol.html#a5b43be3ebd590059db344b327508fe77">XrdProofdProtocol::EUidAtStartup</a>(), ui);</div><div class="line"><a name="l04353"></a><span class="lineno"> 4353</span>&#160;      std::list&lt;XrdProofdDSInfo *&gt;::iterator ii;</div><div class="line"><a name="l04354"></a><span class="lineno"> 4354</span>&#160;      <span class="keywordflow">for</span> (ii = <a class="code" href="classXrdProofdProofServMgr.html#a86cac591a5646811e38ff6a2477f4da7">fMgr</a>-&gt;<a class="code" href="classXrdProofdManager.html#a4a2a77a074ead8e9c504a7fa758d2e9d">DataSetSrcs</a>()-&gt;begin(); ii != <a class="code" href="classXrdProofdProofServMgr.html#a86cac591a5646811e38ff6a2477f4da7">fMgr</a>-&gt;<a class="code" href="classXrdProofdManager.html#a4a2a77a074ead8e9c504a7fa758d2e9d">DataSetSrcs</a>()-&gt;end(); ++ii) {</div><div class="line"><a name="l04355"></a><span class="lineno"> 4355</span>&#160;         <a class="code" href="TGHtml_8h.html#ad5bb4a3d12fd54f29da2b924b29e652b">TRACE</a>(ALL, <span class="stringliteral">&quot;Checking dataset source: url:&quot;</span>&lt;&lt;(*ii)-&gt;fUrl&lt;&lt;<span class="stringliteral">&quot;, local:&quot;</span></div><div class="line"><a name="l04356"></a><span class="lineno"> 4356</span>&#160;                                                   &lt;&lt;(*ii)-&gt;fLocal&lt;&lt;<span class="stringliteral">&quot;, rw:&quot;</span>&lt;&lt;(*ii)-&gt;fRW);</div><div class="line"><a name="l04357"></a><span class="lineno"> 4357</span>&#160;         <span class="keywordflow">if</span> ((*ii)-&gt;fLocal &amp;&amp; (*ii)-&gt;fRW) {</div><div class="line"><a name="l04358"></a><span class="lineno"> 4358</span>&#160;            XrdOucString <a class="code" href="RSha256_8hxx.html#a23b5b0a85bf5762c93a855f40c0343ce">d</a>;</div><div class="line"><a name="l04359"></a><span class="lineno"> 4359</span>&#160;            <a class="code" href="XrdProofdAux_8h.html#a631cc8787af1a02d9e51c86117ae042e">XPDFORM</a>(<a class="code" href="RSha256_8hxx.html#a23b5b0a85bf5762c93a855f40c0343ce">d</a>, <span class="stringliteral">&quot;%s/%s&quot;</span>, ((*ii)-&gt;fUrl).c_str(), p-&gt;<a class="code" href="classXrdProofdProtocol.html#a80024c8f848d0eabe9f13d09f06c8d9d">Client</a>()-&gt;<a class="code" href="classXrdProofdClient.html#a062a4396b4b8f0667f3a97a64c7f1c3d">UI</a>().<a class="code" href="classXrdProofUI.html#a8ddfeaa660ae3a4798b11e9222c7a742">fGroup</a>.c_str());</div><div class="line"><a name="l04360"></a><span class="lineno"> 4360</span>&#160;            <span class="keywordflow">if</span> (<a class="code" href="classXrdProofdAux.html#a3918ddc5c3912b017a3f7695ba5f3a40">XrdProofdAux::AssertDir</a>(<a class="code" href="RSha256_8hxx.html#a23b5b0a85bf5762c93a855f40c0343ce">d</a>.c_str(), ui, <a class="code" href="classXrdProofdProofServMgr.html#a86cac591a5646811e38ff6a2477f4da7">fMgr</a>-&gt;<a class="code" href="classXrdProofdManager.html#a15d2e414e67bfc0cc4304605a6b509ff">ChangeOwn</a>()) == 0) {</div><div class="line"><a name="l04361"></a><span class="lineno"> 4361</span>&#160;               <span class="keywordflow">if</span> (<a class="code" href="classXrdProofdAux.html#a7b07291c516f749a8cb7f8adef43a207">XrdProofdAux::ChangeMod</a>(<a class="code" href="RSha256_8hxx.html#a23b5b0a85bf5762c93a855f40c0343ce">d</a>.c_str(), 0777) == 0) {</div><div class="line"><a name="l04362"></a><span class="lineno"> 4362</span>&#160;                  <a class="code" href="XrdProofdAux_8h.html#a631cc8787af1a02d9e51c86117ae042e">XPDFORM</a>(<a class="code" href="RSha256_8hxx.html#a23b5b0a85bf5762c93a855f40c0343ce">d</a>, <span class="stringliteral">&quot;%s/%s/%s&quot;</span>, ((*ii)-&gt;fUrl).c_str(), p-&gt;<a class="code" href="classXrdProofdProtocol.html#a80024c8f848d0eabe9f13d09f06c8d9d">Client</a>()-&gt;<a class="code" href="classXrdProofdClient.html#a062a4396b4b8f0667f3a97a64c7f1c3d">UI</a>().<a class="code" href="classXrdProofUI.html#a8ddfeaa660ae3a4798b11e9222c7a742">fGroup</a>.c_str(),</div><div class="line"><a name="l04363"></a><span class="lineno"> 4363</span>&#160;                                                                p-&gt;<a class="code" href="classXrdProofdProtocol.html#a80024c8f848d0eabe9f13d09f06c8d9d">Client</a>()-&gt;<a class="code" href="classXrdProofdClient.html#a062a4396b4b8f0667f3a97a64c7f1c3d">UI</a>().<a class="code" href="classXrdProofUI.html#a37a60d9bb41f26a8a79bb1eab51c78f0">fUser</a>.c_str());</div><div class="line"><a name="l04364"></a><span class="lineno"> 4364</span>&#160;                  <span class="keywordflow">if</span> (<a class="code" href="classXrdProofdAux.html#a3918ddc5c3912b017a3f7695ba5f3a40">XrdProofdAux::AssertDir</a>(<a class="code" href="RSha256_8hxx.html#a23b5b0a85bf5762c93a855f40c0343ce">d</a>.c_str(), p-&gt;<a class="code" href="classXrdProofdProtocol.html#a80024c8f848d0eabe9f13d09f06c8d9d">Client</a>()-&gt;<a class="code" href="classXrdProofdClient.html#a062a4396b4b8f0667f3a97a64c7f1c3d">UI</a>(), <a class="code" href="classXrdProofdProofServMgr.html#a86cac591a5646811e38ff6a2477f4da7">fMgr</a>-&gt;<a class="code" href="classXrdProofdManager.html#a15d2e414e67bfc0cc4304605a6b509ff">ChangeOwn</a>()) == 0) {</div><div class="line"><a name="l04365"></a><span class="lineno"> 4365</span>&#160;                     <span class="keywordflow">if</span> (<a class="code" href="classXrdProofdAux.html#a7b07291c516f749a8cb7f8adef43a207">XrdProofdAux::ChangeMod</a>(<a class="code" href="RSha256_8hxx.html#a23b5b0a85bf5762c93a855f40c0343ce">d</a>.c_str(), 0755) != 0) {</div><div class="line"><a name="l04366"></a><span class="lineno"> 4366</span>&#160;                        <a class="code" href="TGHtml_8h.html#ad5bb4a3d12fd54f29da2b924b29e652b">TRACE</a>(XERR, <span class="stringliteral">&quot;problems setting permissions 0755 on: &quot;</span>&lt;&lt;<a class="code" href="RSha256_8hxx.html#a23b5b0a85bf5762c93a855f40c0343ce">d</a>);</div><div class="line"><a name="l04367"></a><span class="lineno"> 4367</span>&#160;                     }</div><div class="line"><a name="l04368"></a><span class="lineno"> 4368</span>&#160;                  } <span class="keywordflow">else</span> {</div><div class="line"><a name="l04369"></a><span class="lineno"> 4369</span>&#160;                     <a class="code" href="TGHtml_8h.html#ad5bb4a3d12fd54f29da2b924b29e652b">TRACE</a>(XERR, <span class="stringliteral">&quot;problems asserting: &quot;</span>&lt;&lt;<a class="code" href="RSha256_8hxx.html#a23b5b0a85bf5762c93a855f40c0343ce">d</a>);</div><div class="line"><a name="l04370"></a><span class="lineno"> 4370</span>&#160;                  }</div><div class="line"><a name="l04371"></a><span class="lineno"> 4371</span>&#160;               } <span class="keywordflow">else</span> {</div><div class="line"><a name="l04372"></a><span class="lineno"> 4372</span>&#160;                  <a class="code" href="TGHtml_8h.html#ad5bb4a3d12fd54f29da2b924b29e652b">TRACE</a>(XERR, <span class="stringliteral">&quot;problems setting permissions 0777 on: &quot;</span>&lt;&lt;<a class="code" href="RSha256_8hxx.html#a23b5b0a85bf5762c93a855f40c0343ce">d</a>);</div><div class="line"><a name="l04373"></a><span class="lineno"> 4373</span>&#160;               }</div><div class="line"><a name="l04374"></a><span class="lineno"> 4374</span>&#160;            } <span class="keywordflow">else</span> {</div><div class="line"><a name="l04375"></a><span class="lineno"> 4375</span>&#160;               <a class="code" href="TGHtml_8h.html#ad5bb4a3d12fd54f29da2b924b29e652b">TRACE</a>(XERR, <span class="stringliteral">&quot;problems asserting: &quot;</span>&lt;&lt;<a class="code" href="RSha256_8hxx.html#a23b5b0a85bf5762c93a855f40c0343ce">d</a>);</div><div class="line"><a name="l04376"></a><span class="lineno"> 4376</span>&#160;            }</div><div class="line"><a name="l04377"></a><span class="lineno"> 4377</span>&#160;         }</div><div class="line"><a name="l04378"></a><span class="lineno"> 4378</span>&#160;      }</div><div class="line"><a name="l04379"></a><span class="lineno"> 4379</span>&#160;   }</div><div class="line"><a name="l04380"></a><span class="lineno"> 4380</span>&#160;</div><div class="line"><a name="l04381"></a><span class="lineno"> 4381</span>&#160;   <span class="comment">// If applicable, make sure that the private data dir for this user exists</span></div><div class="line"><a name="l04382"></a><span class="lineno"> 4382</span>&#160;   <span class="comment">// and has the right permissions</span></div><div class="line"><a name="l04383"></a><span class="lineno"> 4383</span>&#160;   <span class="keywordflow">if</span> (<a class="code" href="classXrdProofdProofServMgr.html#a86cac591a5646811e38ff6a2477f4da7">fMgr</a>-&gt;<a class="code" href="classXrdProofdManager.html#a77fa4018184954055ab7e17027b4834c">DataDir</a>() &amp;&amp; strlen(<a class="code" href="classXrdProofdProofServMgr.html#a86cac591a5646811e38ff6a2477f4da7">fMgr</a>-&gt;<a class="code" href="classXrdProofdManager.html#a77fa4018184954055ab7e17027b4834c">DataDir</a>()) &gt; 0 &amp;&amp;</div><div class="line"><a name="l04384"></a><span class="lineno"> 4384</span>&#160;       <a class="code" href="classXrdProofdProofServMgr.html#a86cac591a5646811e38ff6a2477f4da7">fMgr</a>-&gt;<a class="code" href="classXrdProofdManager.html#a261fd4aaad8c8d64cc3ec18b8fdba69a">DataDirOpts</a>() &amp;&amp; strlen(<a class="code" href="classXrdProofdProofServMgr.html#a86cac591a5646811e38ff6a2477f4da7">fMgr</a>-&gt;<a class="code" href="classXrdProofdManager.html#a261fd4aaad8c8d64cc3ec18b8fdba69a">DataDirOpts</a>()) &gt; 0 &amp;&amp; ord &amp;&amp; stag) {</div><div class="line"><a name="l04385"></a><span class="lineno"> 4385</span>&#160;      <a class="code" href="classXrdProofUI.html">XrdProofUI</a> ui;</div><div class="line"><a name="l04386"></a><span class="lineno"> 4386</span>&#160;      <a class="code" href="classXrdProofdAux.html#a0230423581c62e4fabf4fda6538fd4a7">XrdProofdAux::GetUserInfo</a>(<a class="code" href="classXrdProofdProtocol.html#a5b43be3ebd590059db344b327508fe77">XrdProofdProtocol::EUidAtStartup</a>(), ui);</div><div class="line"><a name="l04387"></a><span class="lineno"> 4387</span>&#160;      XrdOucString dgr, dus[3];</div><div class="line"><a name="l04388"></a><span class="lineno"> 4388</span>&#160;      <a class="code" href="XrdProofdAux_8h.html#a631cc8787af1a02d9e51c86117ae042e">XPDFORM</a>(dgr, <span class="stringliteral">&quot;%s/%s&quot;</span>, <a class="code" href="classXrdProofdProofServMgr.html#a86cac591a5646811e38ff6a2477f4da7">fMgr</a>-&gt;<a class="code" href="classXrdProofdManager.html#a77fa4018184954055ab7e17027b4834c">DataDir</a>(), p-&gt;<a class="code" href="classXrdProofdProtocol.html#a80024c8f848d0eabe9f13d09f06c8d9d">Client</a>()-&gt;<a class="code" href="classXrdProofdClient.html#a062a4396b4b8f0667f3a97a64c7f1c3d">UI</a>().<a class="code" href="classXrdProofUI.html#a8ddfeaa660ae3a4798b11e9222c7a742">fGroup</a>.c_str());</div><div class="line"><a name="l04389"></a><span class="lineno"> 4389</span>&#160;      <span class="keywordflow">if</span> (<a class="code" href="classXrdProofdAux.html#a3918ddc5c3912b017a3f7695ba5f3a40">XrdProofdAux::AssertDir</a>(dgr.c_str(), ui, <a class="code" href="classXrdProofdProofServMgr.html#a86cac591a5646811e38ff6a2477f4da7">fMgr</a>-&gt;<a class="code" href="classXrdProofdManager.html#a15d2e414e67bfc0cc4304605a6b509ff">ChangeOwn</a>()) == 0) {</div><div class="line"><a name="l04390"></a><span class="lineno"> 4390</span>&#160;         <span class="keywordflow">if</span> (<a class="code" href="classXrdProofdAux.html#a7b07291c516f749a8cb7f8adef43a207">XrdProofdAux::ChangeMod</a>(dgr.c_str(), 0777) == 0) {</div><div class="line"><a name="l04391"></a><span class="lineno"> 4391</span>&#160;            <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> mode = 0755;</div><div class="line"><a name="l04392"></a><span class="lineno"> 4392</span>&#160;            <span class="keywordflow">if</span> (strchr(<a class="code" href="classXrdProofdProofServMgr.html#a86cac591a5646811e38ff6a2477f4da7">fMgr</a>-&gt;<a class="code" href="classXrdProofdManager.html#a261fd4aaad8c8d64cc3ec18b8fdba69a">DataDirOpts</a>(), <span class="charliteral">&#39;g&#39;</span>)) mode = 0775;</div><div class="line"><a name="l04393"></a><span class="lineno"> 4393</span>&#160;            <span class="keywordflow">if</span> (strchr(<a class="code" href="classXrdProofdProofServMgr.html#a86cac591a5646811e38ff6a2477f4da7">fMgr</a>-&gt;<a class="code" href="classXrdProofdManager.html#a261fd4aaad8c8d64cc3ec18b8fdba69a">DataDirOpts</a>(), <span class="charliteral">&#39;a&#39;</span>) || strchr(<a class="code" href="classXrdProofdProofServMgr.html#a86cac591a5646811e38ff6a2477f4da7">fMgr</a>-&gt;<a class="code" href="classXrdProofdManager.html#a261fd4aaad8c8d64cc3ec18b8fdba69a">DataDirOpts</a>(), <span class="charliteral">&#39;o&#39;</span>)) mode = 0777;</div><div class="line"><a name="l04394"></a><span class="lineno"> 4394</span>&#160;            <a class="code" href="XrdProofdAux_8h.html#a631cc8787af1a02d9e51c86117ae042e">XPDFORM</a>(dus[0], <span class="stringliteral">&quot;%s/%s&quot;</span>, dgr.c_str(), p-&gt;<a class="code" href="classXrdProofdProtocol.html#a80024c8f848d0eabe9f13d09f06c8d9d">Client</a>()-&gt;<a class="code" href="classXrdProofdClient.html#a062a4396b4b8f0667f3a97a64c7f1c3d">UI</a>().<a class="code" href="classXrdProofUI.html#a37a60d9bb41f26a8a79bb1eab51c78f0">fUser</a>.c_str());</div><div class="line"><a name="l04395"></a><span class="lineno"> 4395</span>&#160;            <a class="code" href="XrdProofdAux_8h.html#a631cc8787af1a02d9e51c86117ae042e">XPDFORM</a>(dus[1], <span class="stringliteral">&quot;%s/%s&quot;</span>, dus[0].c_str(), ord);</div><div class="line"><a name="l04396"></a><span class="lineno"> 4396</span>&#160;            <a class="code" href="XrdProofdAux_8h.html#a631cc8787af1a02d9e51c86117ae042e">XPDFORM</a>(dus[2], <span class="stringliteral">&quot;%s/%s&quot;</span>, dus[1].c_str(), stag);</div><div class="line"><a name="l04397"></a><span class="lineno"> 4397</span>&#160;            <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; 3; i++) {</div><div class="line"><a name="l04398"></a><span class="lineno"> 4398</span>&#160;               <span class="keywordflow">if</span> (<a class="code" href="classXrdProofdAux.html#a3918ddc5c3912b017a3f7695ba5f3a40">XrdProofdAux::AssertDir</a>(dus[i].c_str(), p-&gt;<a class="code" href="classXrdProofdProtocol.html#a80024c8f848d0eabe9f13d09f06c8d9d">Client</a>()-&gt;<a class="code" href="classXrdProofdClient.html#a062a4396b4b8f0667f3a97a64c7f1c3d">UI</a>(), <a class="code" href="classXrdProofdProofServMgr.html#a86cac591a5646811e38ff6a2477f4da7">fMgr</a>-&gt;<a class="code" href="classXrdProofdManager.html#a15d2e414e67bfc0cc4304605a6b509ff">ChangeOwn</a>()) == 0) {</div><div class="line"><a name="l04399"></a><span class="lineno"> 4399</span>&#160;                  <span class="keywordflow">if</span> (<a class="code" href="classXrdProofdAux.html#a7b07291c516f749a8cb7f8adef43a207">XrdProofdAux::ChangeMod</a>(dus[i].c_str(), mode) != 0) {</div><div class="line"><a name="l04400"></a><span class="lineno"> 4400</span>&#160;                     std::ios_base::fmtflags oflags = std::cerr.flags();</div><div class="line"><a name="l04401"></a><span class="lineno"> 4401</span>&#160;                     <a class="code" href="TGHtml_8h.html#ad5bb4a3d12fd54f29da2b924b29e652b">TRACE</a>(XERR, <span class="stringliteral">&quot;problems setting permissions &quot;</span>&lt;&lt; oct &lt;&lt; mode&lt;&lt;<span class="stringliteral">&quot; on: &quot;</span>&lt;&lt;dus[i]);</div><div class="line"><a name="l04402"></a><span class="lineno"> 4402</span>&#160;                     std::cerr.flags(oflags);</div><div class="line"><a name="l04403"></a><span class="lineno"> 4403</span>&#160;                  }</div><div class="line"><a name="l04404"></a><span class="lineno"> 4404</span>&#160;               } <span class="keywordflow">else</span> {</div><div class="line"><a name="l04405"></a><span class="lineno"> 4405</span>&#160;                  <a class="code" href="TGHtml_8h.html#ad5bb4a3d12fd54f29da2b924b29e652b">TRACE</a>(XERR, <span class="stringliteral">&quot;problems asserting: &quot;</span>&lt;&lt;dus[i]);</div><div class="line"><a name="l04406"></a><span class="lineno"> 4406</span>&#160;                  <span class="keywordflow">break</span>;</div><div class="line"><a name="l04407"></a><span class="lineno"> 4407</span>&#160;               }</div><div class="line"><a name="l04408"></a><span class="lineno"> 4408</span>&#160;            }</div><div class="line"><a name="l04409"></a><span class="lineno"> 4409</span>&#160;         } <span class="keywordflow">else</span> {</div><div class="line"><a name="l04410"></a><span class="lineno"> 4410</span>&#160;            <a class="code" href="TGHtml_8h.html#ad5bb4a3d12fd54f29da2b924b29e652b">TRACE</a>(XERR, <span class="stringliteral">&quot;problems setting permissions 0777 on: &quot;</span>&lt;&lt;dgr);</div><div class="line"><a name="l04411"></a><span class="lineno"> 4411</span>&#160;         }</div><div class="line"><a name="l04412"></a><span class="lineno"> 4412</span>&#160;      } <span class="keywordflow">else</span> {</div><div class="line"><a name="l04413"></a><span class="lineno"> 4413</span>&#160;         <a class="code" href="TGHtml_8h.html#ad5bb4a3d12fd54f29da2b924b29e652b">TRACE</a>(XERR, <span class="stringliteral">&quot;problems asserting: &quot;</span>&lt;&lt;dgr);</div><div class="line"><a name="l04414"></a><span class="lineno"> 4414</span>&#160;      }</div><div class="line"><a name="l04415"></a><span class="lineno"> 4415</span>&#160;   }</div><div class="line"><a name="l04416"></a><span class="lineno"> 4416</span>&#160;</div><div class="line"><a name="l04417"></a><span class="lineno"> 4417</span>&#160;   <span class="keywordflow">if</span> (<a class="code" href="classXrdProofdProofServMgr.html#a86cac591a5646811e38ff6a2477f4da7">fMgr</a>-&gt;<a class="code" href="classXrdProofdManager.html#a15d2e414e67bfc0cc4304605a6b509ff">ChangeOwn</a>()) {</div><div class="line"><a name="l04418"></a><span class="lineno"> 4418</span>&#160;      <span class="comment">// Change ownership of &#39;.creds&#39;</span></div><div class="line"><a name="l04419"></a><span class="lineno"> 4419</span>&#160;      XrdOucString creds(p-&gt;<a class="code" href="classXrdProofdProtocol.html#a80024c8f848d0eabe9f13d09f06c8d9d">Client</a>()-&gt;<a class="code" href="classXrdProofdClient.html#a8ea0bbb76949d36f85b223cab59db0d7">Sandbox</a>()-&gt;<a class="code" href="classXrdProofdSandbox.html#ad067010c4a92eee6dac2aa0dbc679bf4">Dir</a>());</div><div class="line"><a name="l04420"></a><span class="lineno"> 4420</span>&#160;      creds += <span class="stringliteral">&quot;/.creds&quot;</span>;</div><div class="line"><a name="l04421"></a><span class="lineno"> 4421</span>&#160;      <span class="keywordflow">if</span> (<a class="code" href="classXrdProofdAux.html#a01fd3ef6927e3bab19848e23bc61c904">XrdProofdAux::ChangeOwn</a>(creds.c_str(), p-&gt;<a class="code" href="classXrdProofdProtocol.html#a80024c8f848d0eabe9f13d09f06c8d9d">Client</a>()-&gt;<a class="code" href="classXrdProofdClient.html#a062a4396b4b8f0667f3a97a64c7f1c3d">UI</a>()) != 0) {</div><div class="line"><a name="l04422"></a><span class="lineno"> 4422</span>&#160;         <a class="code" href="TGHtml_8h.html#ad5bb4a3d12fd54f29da2b924b29e652b">TRACE</a>(XERR, <span class="stringliteral">&quot;can&#39;t change ownership of &quot;</span>&lt;&lt;creds);</div><div class="line"><a name="l04423"></a><span class="lineno"> 4423</span>&#160;         <span class="keywordflow">return</span> -1;</div><div class="line"><a name="l04424"></a><span class="lineno"> 4424</span>&#160;      }</div><div class="line"><a name="l04425"></a><span class="lineno"> 4425</span>&#160;   }</div><div class="line"><a name="l04426"></a><span class="lineno"> 4426</span>&#160;</div><div class="line"><a name="l04427"></a><span class="lineno"> 4427</span>&#160;   <span class="comment">// We are done</span></div><div class="line"><a name="l04428"></a><span class="lineno"> 4428</span>&#160;   <a class="code" href="TGHtml_8h.html#ad5bb4a3d12fd54f29da2b924b29e652b">TRACE</a>(REQ, <span class="stringliteral">&quot;done&quot;</span>);</div><div class="line"><a name="l04429"></a><span class="lineno"> 4429</span>&#160;   <span class="keywordflow">return</span> 0;</div><div class="line"><a name="l04430"></a><span class="lineno"> 4430</span>&#160;}</div><div class="line"><a name="l04431"></a><span class="lineno"> 4431</span>&#160;<span class="comment"></span></div><div class="line"><a name="l04432"></a><span class="lineno"> 4432</span>&#160;<span class="comment">////////////////////////////////////////////////////////////////////////////////</span></div><div class="line"><a name="l04433"></a><span class="lineno"> 4433</span>&#160;<span class="comment">/// Set user environment: set effective user and group ID of the process</span></div><div class="line"><a name="l04434"></a><span class="lineno"> 4434</span>&#160;<span class="comment">/// to the ones of the owner of this protocol instnace and change working</span></div><div class="line"><a name="l04435"></a><span class="lineno"> 4435</span>&#160;<span class="comment">/// dir to the sandbox.</span></div><div class="line"><a name="l04436"></a><span class="lineno"> 4436</span>&#160;<span class="comment">/// Return 0 on success, -1 if enything goes wrong.</span></div><div class="line"><a name="l04437"></a><span class="lineno"> 4437</span>&#160;<span class="comment"></span></div><div class="line"><a name="l04438"></a><span class="lineno"><a class="line" href="classXrdProofdProofServMgr.html#a0cfe9bb436cf9dbcffd21d1821bc3d3f"> 4438</a></span>&#160;<span class="keywordtype">int</span> <a class="code" href="classXrdProofdProofServMgr.html#a0cfe9bb436cf9dbcffd21d1821bc3d3f">XrdProofdProofServMgr::SetUserEnvironment</a>(<a class="code" href="classXrdProofdProtocol.html">XrdProofdProtocol</a> *p)</div><div class="line"><a name="l04439"></a><span class="lineno"> 4439</span>&#160;{</div><div class="line"><a name="l04440"></a><span class="lineno"> 4440</span>&#160;   <a class="code" href="XrdProofdTrace_8h.html#a7c31822912a8d0dc9bfd544097b29e12">XPDLOC</a>(SMGR, <span class="stringliteral">&quot;ProofServMgr::SetUserEnvironment&quot;</span>)</div><div class="line"><a name="l04441"></a><span class="lineno"> 4441</span>&#160;</div><div class="line"><a name="l04442"></a><span class="lineno"> 4442</span>&#160;   <a class="code" href="TGHtml_8h.html#ad5bb4a3d12fd54f29da2b924b29e652b">TRACE</a>(REQ, <span class="stringliteral">&quot;enter&quot;</span>);</div><div class="line"><a name="l04443"></a><span class="lineno"> 4443</span>&#160;</div><div class="line"><a name="l04444"></a><span class="lineno"> 4444</span>&#160;   <span class="keywordflow">if</span> (<a class="code" href="classXrdProofdAux.html#a7a63defb9a91e1c09541856982af6d59">XrdProofdAux::ChangeToDir</a>(p-&gt;<a class="code" href="classXrdProofdProtocol.html#a80024c8f848d0eabe9f13d09f06c8d9d">Client</a>()-&gt;<a class="code" href="classXrdProofdClient.html#a8ea0bbb76949d36f85b223cab59db0d7">Sandbox</a>()-&gt;<a class="code" href="classXrdProofdSandbox.html#ad067010c4a92eee6dac2aa0dbc679bf4">Dir</a>(),</div><div class="line"><a name="l04445"></a><span class="lineno"> 4445</span>&#160;                                 p-&gt;<a class="code" href="classXrdProofdProtocol.html#a80024c8f848d0eabe9f13d09f06c8d9d">Client</a>()-&gt;<a class="code" href="classXrdProofdClient.html#a062a4396b4b8f0667f3a97a64c7f1c3d">UI</a>(), <a class="code" href="classXrdProofdProofServMgr.html#a86cac591a5646811e38ff6a2477f4da7">fMgr</a>-&gt;<a class="code" href="classXrdProofdManager.html#a15d2e414e67bfc0cc4304605a6b509ff">ChangeOwn</a>()) != 0) {</div><div class="line"><a name="l04446"></a><span class="lineno"> 4446</span>&#160;      <a class="code" href="TGHtml_8h.html#ad5bb4a3d12fd54f29da2b924b29e652b">TRACE</a>(XERR, <span class="stringliteral">&quot;couldn&#39;t change directory to &quot;</span>&lt;&lt; p-&gt;<a class="code" href="classXrdProofdProtocol.html#a80024c8f848d0eabe9f13d09f06c8d9d">Client</a>()-&gt;<a class="code" href="classXrdProofdClient.html#a8ea0bbb76949d36f85b223cab59db0d7">Sandbox</a>()-&gt;<a class="code" href="classXrdProofdSandbox.html#ad067010c4a92eee6dac2aa0dbc679bf4">Dir</a>());</div><div class="line"><a name="l04447"></a><span class="lineno"> 4447</span>&#160;      <span class="keywordflow">return</span> -1;</div><div class="line"><a name="l04448"></a><span class="lineno"> 4448</span>&#160;   }</div><div class="line"><a name="l04449"></a><span class="lineno"> 4449</span>&#160;</div><div class="line"><a name="l04450"></a><span class="lineno"> 4450</span>&#160;   <span class="keywordtype">size_t</span> len = 0;</div><div class="line"><a name="l04451"></a><span class="lineno"> 4451</span>&#160;   <span class="comment">// set HOME env</span></div><div class="line"><a name="l04452"></a><span class="lineno"> 4452</span>&#160;   len = 8 + strlen(p-&gt;<a class="code" href="classXrdProofdProtocol.html#a80024c8f848d0eabe9f13d09f06c8d9d">Client</a>()-&gt;<a class="code" href="classXrdProofdClient.html#a8ea0bbb76949d36f85b223cab59db0d7">Sandbox</a>()-&gt;<a class="code" href="classXrdProofdSandbox.html#ad067010c4a92eee6dac2aa0dbc679bf4">Dir</a>());</div><div class="line"><a name="l04453"></a><span class="lineno"> 4453</span>&#160;   <span class="keywordtype">char</span> *<a class="code" href="RSha256_8hxx.html#acf9942d15f0dd0ac4fc5ca66096a3f6d">h</a> = <span class="keyword">new</span> <span class="keywordtype">char</span>[len];</div><div class="line"><a name="l04454"></a><span class="lineno"> 4454</span>&#160;   <a class="code" href="civetweb_8c.html#aa367b75c5aed883fef5befbdf04835a4">snprintf</a>(<a class="code" href="RSha256_8hxx.html#acf9942d15f0dd0ac4fc5ca66096a3f6d">h</a>, len, <span class="stringliteral">&quot;HOME=%s&quot;</span>, p-&gt;<a class="code" href="classXrdProofdProtocol.html#a80024c8f848d0eabe9f13d09f06c8d9d">Client</a>()-&gt;<a class="code" href="classXrdProofdClient.html#a8ea0bbb76949d36f85b223cab59db0d7">Sandbox</a>()-&gt;<a class="code" href="classXrdProofdSandbox.html#ad067010c4a92eee6dac2aa0dbc679bf4">Dir</a>());</div><div class="line"><a name="l04455"></a><span class="lineno"> 4455</span>&#160;   putenv(<a class="code" href="RSha256_8hxx.html#acf9942d15f0dd0ac4fc5ca66096a3f6d">h</a>);</div><div class="line"><a name="l04456"></a><span class="lineno"> 4456</span>&#160;   <a class="code" href="TGHtml_8h.html#ad5bb4a3d12fd54f29da2b924b29e652b">TRACE</a>(DBG, <span class="stringliteral">&quot;set &quot;</span>&lt;&lt;<a class="code" href="RSha256_8hxx.html#acf9942d15f0dd0ac4fc5ca66096a3f6d">h</a>);</div><div class="line"><a name="l04457"></a><span class="lineno"> 4457</span>&#160;</div><div class="line"><a name="l04458"></a><span class="lineno"> 4458</span>&#160;   <span class="comment">// set USER env</span></div><div class="line"><a name="l04459"></a><span class="lineno"> 4459</span>&#160;   len = 8 + strlen(p-&gt;<a class="code" href="classXrdProofdProtocol.html#a80024c8f848d0eabe9f13d09f06c8d9d">Client</a>()-&gt;<a class="code" href="classXrdProofdClient.html#a3cbe604999cdb44ae9d0ec833ffa5900">User</a>());</div><div class="line"><a name="l04460"></a><span class="lineno"> 4460</span>&#160;   <span class="keywordtype">char</span> *u = <span class="keyword">new</span> <span class="keywordtype">char</span>[len];</div><div class="line"><a name="l04461"></a><span class="lineno"> 4461</span>&#160;   <a class="code" href="civetweb_8c.html#aa367b75c5aed883fef5befbdf04835a4">snprintf</a>(u, len, <span class="stringliteral">&quot;USER=%s&quot;</span>, p-&gt;<a class="code" href="classXrdProofdProtocol.html#a80024c8f848d0eabe9f13d09f06c8d9d">Client</a>()-&gt;<a class="code" href="classXrdProofdClient.html#a3cbe604999cdb44ae9d0ec833ffa5900">User</a>());</div><div class="line"><a name="l04462"></a><span class="lineno"> 4462</span>&#160;   putenv(u);</div><div class="line"><a name="l04463"></a><span class="lineno"> 4463</span>&#160;   <a class="code" href="TGHtml_8h.html#ad5bb4a3d12fd54f29da2b924b29e652b">TRACE</a>(DBG, <span class="stringliteral">&quot;set &quot;</span>&lt;&lt;u);</div><div class="line"><a name="l04464"></a><span class="lineno"> 4464</span>&#160;</div><div class="line"><a name="l04465"></a><span class="lineno"> 4465</span>&#160;   <span class="comment">// Set access control list from /etc/initgroup</span></div><div class="line"><a name="l04466"></a><span class="lineno"> 4466</span>&#160;   <span class="comment">// (super-user privileges required)</span></div><div class="line"><a name="l04467"></a><span class="lineno"> 4467</span>&#160;   <a class="code" href="TGHtml_8h.html#ad5bb4a3d12fd54f29da2b924b29e652b">TRACE</a>(DBG, <span class="stringliteral">&quot;setting ACLs&quot;</span>);</div><div class="line"><a name="l04468"></a><span class="lineno"> 4468</span>&#160;   <span class="keywordflow">if</span> (<a class="code" href="classXrdProofdProofServMgr.html#a86cac591a5646811e38ff6a2477f4da7">fMgr</a>-&gt;<a class="code" href="classXrdProofdManager.html#a15d2e414e67bfc0cc4304605a6b509ff">ChangeOwn</a>() &amp;&amp; (int) geteuid() != p-&gt;<a class="code" href="classXrdProofdProtocol.html#a80024c8f848d0eabe9f13d09f06c8d9d">Client</a>()-&gt;<a class="code" href="classXrdProofdClient.html#a062a4396b4b8f0667f3a97a64c7f1c3d">UI</a>().<a class="code" href="classXrdProofUI.html#aa16ddd6d492cb4e498d5a94df6b037a9">fUid</a>) {</div><div class="line"><a name="l04469"></a><span class="lineno"> 4469</span>&#160;</div><div class="line"><a name="l04470"></a><span class="lineno"> 4470</span>&#160;      <a class="code" href="classXrdSysPrivGuard.html">XrdSysPrivGuard</a> pGuard((uid_t)0, (gid_t)0);</div><div class="line"><a name="l04471"></a><span class="lineno"> 4471</span>&#160;      <span class="keywordflow">if</span> (<a class="code" href="XrdProofdAux_8h.html#ad77bf9042235eb97fbdca181c591ef79">XpdBadPGuard</a>(pGuard, p-&gt;<a class="code" href="classXrdProofdProtocol.html#a80024c8f848d0eabe9f13d09f06c8d9d">Client</a>()-&gt;<a class="code" href="classXrdProofdClient.html#a062a4396b4b8f0667f3a97a64c7f1c3d">UI</a>().<a class="code" href="classXrdProofUI.html#aa16ddd6d492cb4e498d5a94df6b037a9">fUid</a>)) {</div><div class="line"><a name="l04472"></a><span class="lineno"> 4472</span>&#160;         <a class="code" href="TGHtml_8h.html#ad5bb4a3d12fd54f29da2b924b29e652b">TRACE</a>(XERR, <span class="stringliteral">&quot;could not get privileges&quot;</span>);</div><div class="line"><a name="l04473"></a><span class="lineno"> 4473</span>&#160;         <span class="keywordflow">return</span> -1;</div><div class="line"><a name="l04474"></a><span class="lineno"> 4474</span>&#160;      }</div><div class="line"><a name="l04475"></a><span class="lineno"> 4475</span>&#160;</div><div class="line"><a name="l04476"></a><span class="lineno"> 4476</span>&#160;      initgroups(p-&gt;<a class="code" href="classXrdProofdProtocol.html#a80024c8f848d0eabe9f13d09f06c8d9d">Client</a>()-&gt;<a class="code" href="classXrdProofdClient.html#a062a4396b4b8f0667f3a97a64c7f1c3d">UI</a>().<a class="code" href="classXrdProofUI.html#a37a60d9bb41f26a8a79bb1eab51c78f0">fUser</a>.c_str(), p-&gt;<a class="code" href="classXrdProofdProtocol.html#a80024c8f848d0eabe9f13d09f06c8d9d">Client</a>()-&gt;<a class="code" href="classXrdProofdClient.html#a062a4396b4b8f0667f3a97a64c7f1c3d">UI</a>().<a class="code" href="classXrdProofUI.html#a02d91475e698860e6cf2eb5a8e9c29ec">fGid</a>);</div><div class="line"><a name="l04477"></a><span class="lineno"> 4477</span>&#160;   }</div><div class="line"><a name="l04478"></a><span class="lineno"> 4478</span>&#160;</div><div class="line"><a name="l04479"></a><span class="lineno"> 4479</span>&#160;   <span class="keywordflow">if</span> (<a class="code" href="classXrdProofdProofServMgr.html#a86cac591a5646811e38ff6a2477f4da7">fMgr</a>-&gt;<a class="code" href="classXrdProofdManager.html#a15d2e414e67bfc0cc4304605a6b509ff">ChangeOwn</a>()) {</div><div class="line"><a name="l04480"></a><span class="lineno"> 4480</span>&#160;      <span class="comment">// acquire permanently target user privileges</span></div><div class="line"><a name="l04481"></a><span class="lineno"> 4481</span>&#160;      <a class="code" href="TGHtml_8h.html#ad5bb4a3d12fd54f29da2b924b29e652b">TRACE</a>(DBG, <span class="stringliteral">&quot;acquiring target user identity: &quot;</span>&lt;&lt;(uid_t)p-&gt;<a class="code" href="classXrdProofdProtocol.html#a80024c8f848d0eabe9f13d09f06c8d9d">Client</a>()-&gt;<a class="code" href="classXrdProofdClient.html#a062a4396b4b8f0667f3a97a64c7f1c3d">UI</a>().<a class="code" href="classXrdProofUI.html#aa16ddd6d492cb4e498d5a94df6b037a9">fUid</a>&lt;&lt;</div><div class="line"><a name="l04482"></a><span class="lineno"> 4482</span>&#160;                                               <span class="stringliteral">&quot;, &quot;</span>&lt;&lt;(gid_t)p-&gt;<a class="code" href="classXrdProofdProtocol.html#a80024c8f848d0eabe9f13d09f06c8d9d">Client</a>()-&gt;<a class="code" href="classXrdProofdClient.html#a062a4396b4b8f0667f3a97a64c7f1c3d">UI</a>().<a class="code" href="classXrdProofUI.html#a02d91475e698860e6cf2eb5a8e9c29ec">fGid</a>);</div><div class="line"><a name="l04483"></a><span class="lineno"> 4483</span>&#160;      <span class="keywordflow">if</span> (<a class="code" href="classXrdSysPriv.html#aeed545d16718c243d97145085beb8e48">XrdSysPriv::ChangePerm</a>((uid_t)p-&gt;<a class="code" href="classXrdProofdProtocol.html#a80024c8f848d0eabe9f13d09f06c8d9d">Client</a>()-&gt;<a class="code" href="classXrdProofdClient.html#a062a4396b4b8f0667f3a97a64c7f1c3d">UI</a>().<a class="code" href="classXrdProofUI.html#aa16ddd6d492cb4e498d5a94df6b037a9">fUid</a>,</div><div class="line"><a name="l04484"></a><span class="lineno"> 4484</span>&#160;                                 (gid_t)p-&gt;<a class="code" href="classXrdProofdProtocol.html#a80024c8f848d0eabe9f13d09f06c8d9d">Client</a>()-&gt;<a class="code" href="classXrdProofdClient.html#a062a4396b4b8f0667f3a97a64c7f1c3d">UI</a>().<a class="code" href="classXrdProofUI.html#a02d91475e698860e6cf2eb5a8e9c29ec">fGid</a>) != 0) {</div><div class="line"><a name="l04485"></a><span class="lineno"> 4485</span>&#160;         <a class="code" href="TGHtml_8h.html#ad5bb4a3d12fd54f29da2b924b29e652b">TRACE</a>(XERR, <span class="stringliteral">&quot;can&#39;t acquire &quot;</span>&lt;&lt; p-&gt;<a class="code" href="classXrdProofdProtocol.html#a80024c8f848d0eabe9f13d09f06c8d9d">Client</a>()-&gt;<a class="code" href="classXrdProofdClient.html#a062a4396b4b8f0667f3a97a64c7f1c3d">UI</a>().<a class="code" href="classXrdProofUI.html#a37a60d9bb41f26a8a79bb1eab51c78f0">fUser</a> &lt;&lt;<span class="stringliteral">&quot; identity&quot;</span>);</div><div class="line"><a name="l04486"></a><span class="lineno"> 4486</span>&#160;         <span class="keywordflow">return</span> -1;</div><div class="line"><a name="l04487"></a><span class="lineno"> 4487</span>&#160;      }</div><div class="line"><a name="l04488"></a><span class="lineno"> 4488</span>&#160;   }</div><div class="line"><a name="l04489"></a><span class="lineno"> 4489</span>&#160;</div><div class="line"><a name="l04490"></a><span class="lineno"> 4490</span>&#160;   <span class="comment">// We are done</span></div><div class="line"><a name="l04491"></a><span class="lineno"> 4491</span>&#160;   <a class="code" href="TGHtml_8h.html#ad5bb4a3d12fd54f29da2b924b29e652b">TRACE</a>(REQ, <span class="stringliteral">&quot;done&quot;</span>);</div><div class="line"><a name="l04492"></a><span class="lineno"> 4492</span>&#160;   <span class="keywordflow">return</span> 0;</div><div class="line"><a name="l04493"></a><span class="lineno"> 4493</span>&#160;}</div><div class="line"><a name="l04494"></a><span class="lineno"> 4494</span>&#160;<span class="comment"></span></div><div class="line"><a name="l04495"></a><span class="lineno"> 4495</span>&#160;<span class="comment">////////////////////////////////////////////////////////////////////////////////</span></div><div class="line"><a name="l04496"></a><span class="lineno"> 4496</span>&#160;<span class="comment">/// Return active session with process ID pid, if any.</span></div><div class="line"><a name="l04497"></a><span class="lineno"> 4497</span>&#160;<span class="comment"></span></div><div class="line"><a name="l04498"></a><span class="lineno"><a class="line" href="classXrdProofdProofServMgr.html#a01b123203cef2462de822fabff1f2e11"> 4498</a></span>&#160;<a class="code" href="classXrdProofdProofServ.html">XrdProofdProofServ</a> *<a class="code" href="classXrdProofdProofServMgr.html#a01b123203cef2462de822fabff1f2e11">XrdProofdProofServMgr::GetActiveSession</a>(<span class="keywordtype">int</span> pid)</div><div class="line"><a name="l04499"></a><span class="lineno"> 4499</span>&#160;{</div><div class="line"><a name="l04500"></a><span class="lineno"> 4500</span>&#160;   XrdOucString key; key += pid;</div><div class="line"><a name="l04501"></a><span class="lineno"> 4501</span>&#160;   <span class="keywordflow">return</span> <a class="code" href="classXrdProofdProofServMgr.html#a4a8be4f347170c279824168597e16caa">fSessions</a>.Find(key.c_str());</div><div class="line"><a name="l04502"></a><span class="lineno"> 4502</span>&#160;}</div><div class="line"><a name="l04503"></a><span class="lineno"> 4503</span>&#160;<span class="comment"></span></div><div class="line"><a name="l04504"></a><span class="lineno"> 4504</span>&#160;<span class="comment">////////////////////////////////////////////////////////////////////////////////</span></div><div class="line"><a name="l04505"></a><span class="lineno"> 4505</span>&#160;<span class="comment">/// Run thorugh entries to broadcast the relevant priority</span></div><div class="line"><a name="l04506"></a><span class="lineno"> 4506</span>&#160;<span class="comment"></span></div><div class="line"><a name="l04507"></a><span class="lineno"><a class="line" href="XrdProofdProofServMgr_8cxx.html#ac25e7156ff6e5bbf5ee3ed7faffde40d"> 4507</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="XrdProofdProofServMgr_8cxx.html#ac25e7156ff6e5bbf5ee3ed7faffde40d">BroadcastPriority</a>(<span class="keyword">const</span> <span class="keywordtype">char</span> *, <a class="code" href="classXrdProofdProofServ.html">XrdProofdProofServ</a> *<a class="code" href="namespaceTGeant4Unit.html#acf9c078cf6febce70e282acd7f5dff9b">ps</a>, <span class="keywordtype">void</span> *<a class="code" href="namespaceTGeant4Unit.html#a5d450e80998065902b102dca2a69066a">s</a>)</div><div class="line"><a name="l04508"></a><span class="lineno"> 4508</span>&#160;{</div><div class="line"><a name="l04509"></a><span class="lineno"> 4509</span>&#160;   <a class="code" href="XrdProofdTrace_8h.html#a7c31822912a8d0dc9bfd544097b29e12">XPDLOC</a>(SMGR, <span class="stringliteral">&quot;BroadcastPriority&quot;</span>)</div><div class="line"><a name="l04510"></a><span class="lineno"> 4510</span>&#160;</div><div class="line"><a name="l04511"></a><span class="lineno"> 4511</span>&#160;   XpdBroadcastPriority_t *bp = (XpdBroadcastPriority_t *)<a class="code" href="namespaceTGeant4Unit.html#a5d450e80998065902b102dca2a69066a">s</a>;</div><div class="line"><a name="l04512"></a><span class="lineno"> 4512</span>&#160;</div><div class="line"><a name="l04513"></a><span class="lineno"> 4513</span>&#160;   <span class="keywordtype">int</span> nb = *(bp-&gt;fNBroadcast);</div><div class="line"><a name="l04514"></a><span class="lineno"> 4514</span>&#160;</div><div class="line"><a name="l04515"></a><span class="lineno"> 4515</span>&#160;   XrdOucString emsg;</div><div class="line"><a name="l04516"></a><span class="lineno"> 4516</span>&#160;   <span class="keywordflow">if</span> (<a class="code" href="namespaceTGeant4Unit.html#acf9c078cf6febce70e282acd7f5dff9b">ps</a>) {</div><div class="line"><a name="l04517"></a><span class="lineno"> 4517</span>&#160;      <span class="keywordflow">if</span> (<a class="code" href="namespaceTGeant4Unit.html#acf9c078cf6febce70e282acd7f5dff9b">ps</a>-&gt;IsValid() &amp;&amp; (<a class="code" href="namespaceTGeant4Unit.html#acf9c078cf6febce70e282acd7f5dff9b">ps</a>-&gt;Status() == <a class="code" href="XProofProtocol_8h.html#a3a4503f87fa152df23df4d274f07b932a7bf0d5731cd0e6bf8fd0e26861b8c2af">kXPD_running</a>) &amp;&amp;</div><div class="line"><a name="l04518"></a><span class="lineno"> 4518</span>&#160;        !(<a class="code" href="namespaceTGeant4Unit.html#acf9c078cf6febce70e282acd7f5dff9b">ps</a>-&gt;SrvType() == <a class="code" href="XProofProtocol_8h.html#a239aaf631ff9e4c6ebece4a2362d3f75">kXPD_Master</a>)) {</div><div class="line"><a name="l04519"></a><span class="lineno"> 4519</span>&#160;         <a class="code" href="classXrdProofGroup.html">XrdProofGroup</a> *<a class="code" href="RSha256_8hxx.html#a9608045402267746965fa49d90bbada4">g</a> = (<a class="code" href="namespaceTGeant4Unit.html#acf9c078cf6febce70e282acd7f5dff9b">ps</a>-&gt;Group() &amp;&amp; bp-&gt;fGroupMgr)</div><div class="line"><a name="l04520"></a><span class="lineno"> 4520</span>&#160;                          ? bp-&gt;fGroupMgr-&gt;GetGroup(<a class="code" href="namespaceTGeant4Unit.html#acf9c078cf6febce70e282acd7f5dff9b">ps</a>-&gt;Group()) : 0;</div><div class="line"><a name="l04521"></a><span class="lineno"> 4521</span>&#160;         <a class="code" href="TGHtml_8h.html#ad5bb4a3d12fd54f29da2b924b29e652b">TRACE</a>(DBG, <span class="stringliteral">&quot;group: &quot;</span>&lt;&lt;  <a class="code" href="RSha256_8hxx.html#a9608045402267746965fa49d90bbada4">g</a>&lt;&lt;<span class="stringliteral">&quot;, client: &quot;</span>&lt;&lt;<a class="code" href="namespaceTGeant4Unit.html#acf9c078cf6febce70e282acd7f5dff9b">ps</a>-&gt;Client());</div><div class="line"><a name="l04522"></a><span class="lineno"> 4522</span>&#160;         <span class="keywordflow">if</span> (<a class="code" href="RSha256_8hxx.html#a9608045402267746965fa49d90bbada4">g</a> &amp;&amp; <a class="code" href="RSha256_8hxx.html#a9608045402267746965fa49d90bbada4">g</a>-&gt;Active() &gt; 0) {</div><div class="line"><a name="l04523"></a><span class="lineno"> 4523</span>&#160;            <a class="code" href="TGHtml_8h.html#ad5bb4a3d12fd54f29da2b924b29e652b">TRACE</a>(DBG, <span class="stringliteral">&quot;priority: &quot;</span>&lt;&lt; <a class="code" href="RSha256_8hxx.html#a9608045402267746965fa49d90bbada4">g</a>-&gt;Priority()&lt;&lt;<span class="stringliteral">&quot; active: &quot;</span>&lt;&lt;<a class="code" href="RSha256_8hxx.html#a9608045402267746965fa49d90bbada4">g</a>-&gt;Active());</div><div class="line"><a name="l04524"></a><span class="lineno"> 4524</span>&#160;            <span class="keywordtype">int</span> prio = (int) (<a class="code" href="RSha256_8hxx.html#a9608045402267746965fa49d90bbada4">g</a>-&gt;Priority() * 100);</div><div class="line"><a name="l04525"></a><span class="lineno"> 4525</span>&#160;            <a class="code" href="namespaceTGeant4Unit.html#acf9c078cf6febce70e282acd7f5dff9b">ps</a>-&gt;BroadcastPriority(prio);</div><div class="line"><a name="l04526"></a><span class="lineno"> 4526</span>&#160;            nb++;</div><div class="line"><a name="l04527"></a><span class="lineno"> 4527</span>&#160;         }</div><div class="line"><a name="l04528"></a><span class="lineno"> 4528</span>&#160;      }</div><div class="line"><a name="l04529"></a><span class="lineno"> 4529</span>&#160;      <span class="comment">// Go to next</span></div><div class="line"><a name="l04530"></a><span class="lineno"> 4530</span>&#160;      <span class="keywordflow">return</span> 0;</div><div class="line"><a name="l04531"></a><span class="lineno"> 4531</span>&#160;   } <span class="keywordflow">else</span> {</div><div class="line"><a name="l04532"></a><span class="lineno"> 4532</span>&#160;      emsg = <span class="stringliteral">&quot;input entry undefined&quot;</span>;</div><div class="line"><a name="l04533"></a><span class="lineno"> 4533</span>&#160;   }</div><div class="line"><a name="l04534"></a><span class="lineno"> 4534</span>&#160;</div><div class="line"><a name="l04535"></a><span class="lineno"> 4535</span>&#160;   <span class="comment">// Some problem</span></div><div class="line"><a name="l04536"></a><span class="lineno"> 4536</span>&#160;   <a class="code" href="TGHtml_8h.html#ad5bb4a3d12fd54f29da2b924b29e652b">TRACE</a>(XERR,<span class="stringliteral">&quot;protocol error: &quot;</span>&lt;&lt;emsg);</div><div class="line"><a name="l04537"></a><span class="lineno"> 4537</span>&#160;   <span class="keywordflow">return</span> 1;</div><div class="line"><a name="l04538"></a><span class="lineno"> 4538</span>&#160;}</div><div class="line"><a name="l04539"></a><span class="lineno"> 4539</span>&#160;<span class="comment"></span></div><div class="line"><a name="l04540"></a><span class="lineno"> 4540</span>&#160;<span class="comment">////////////////////////////////////////////////////////////////////////////////</span></div><div class="line"><a name="l04541"></a><span class="lineno"> 4541</span>&#160;<span class="comment">/// Broadcast cluster info to the active sessions</span></div><div class="line"><a name="l04542"></a><span class="lineno"> 4542</span>&#160;<span class="comment"></span></div><div class="line"><a name="l04543"></a><span class="lineno"><a class="line" href="classXrdProofdProofServMgr.html#a08f16bc02f1e60847b83eddb9c012bc0"> 4543</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="classXrdProofdProofServMgr.html#a08f16bc02f1e60847b83eddb9c012bc0">XrdProofdProofServMgr::BroadcastClusterInfo</a>()</div><div class="line"><a name="l04544"></a><span class="lineno"> 4544</span>&#160;{</div><div class="line"><a name="l04545"></a><span class="lineno"> 4545</span>&#160;   <a class="code" href="XrdProofdTrace_8h.html#a7c31822912a8d0dc9bfd544097b29e12">XPDLOC</a>(SMGR, <span class="stringliteral">&quot;ProofServMgr::BroadcastClusterInfo&quot;</span>)</div><div class="line"><a name="l04546"></a><span class="lineno"> 4546</span>&#160;</div><div class="line"><a name="l04547"></a><span class="lineno"> 4547</span>&#160;   <a class="code" href="TGHtml_8h.html#ad5bb4a3d12fd54f29da2b924b29e652b">TRACE</a>(REQ, <span class="stringliteral">&quot;enter&quot;</span>);</div><div class="line"><a name="l04548"></a><span class="lineno"> 4548</span>&#160;</div><div class="line"><a name="l04549"></a><span class="lineno"> 4549</span>&#160;   <span class="keywordtype">int</span> tot = 0, act = 0;</div><div class="line"><a name="l04550"></a><span class="lineno"> 4550</span>&#160;   std::list&lt;XrdProofdProofServ *&gt;::iterator si = <a class="code" href="classXrdProofdProofServMgr.html#a909fb1d3452ad38d9cc83782f777d07c">fActiveSessions</a>.begin();</div><div class="line"><a name="l04551"></a><span class="lineno"> 4551</span>&#160;   <span class="keywordflow">while</span> (si != <a class="code" href="classXrdProofdProofServMgr.html#a909fb1d3452ad38d9cc83782f777d07c">fActiveSessions</a>.end()) {</div><div class="line"><a name="l04552"></a><span class="lineno"> 4552</span>&#160;      <span class="keywordflow">if</span> ((*si)-&gt;SrvType() != <a class="code" href="XProofProtocol_8h.html#ac8a8ea0eedefcf3ab8199ea996b3922c">kXPD_Worker</a>) {</div><div class="line"><a name="l04553"></a><span class="lineno"> 4553</span>&#160;         tot++;</div><div class="line"><a name="l04554"></a><span class="lineno"> 4554</span>&#160;         <span class="keywordflow">if</span> ((*si)-&gt;Status() == <a class="code" href="XProofProtocol_8h.html#a3a4503f87fa152df23df4d274f07b932a7bf0d5731cd0e6bf8fd0e26861b8c2af">kXPD_running</a>) act++;</div><div class="line"><a name="l04555"></a><span class="lineno"> 4555</span>&#160;      }</div><div class="line"><a name="l04556"></a><span class="lineno"> 4556</span>&#160;      ++si;</div><div class="line"><a name="l04557"></a><span class="lineno"> 4557</span>&#160;   }</div><div class="line"><a name="l04558"></a><span class="lineno"> 4558</span>&#160;   <span class="keywordflow">if</span> (tot &gt; 0) {</div><div class="line"><a name="l04559"></a><span class="lineno"> 4559</span>&#160;      <a class="code" href="XrdProofdTrace_8h.html#a16e6f602476f24a2b61f420a39b38527">XPDPRT</a>(<span class="stringliteral">&quot;tot: &quot;</span>&lt;&lt;tot&lt;&lt;<span class="stringliteral">&quot;, act: &quot;</span>&lt;&lt;act);</div><div class="line"><a name="l04560"></a><span class="lineno"> 4560</span>&#160;      <span class="comment">// Now propagate to master or sub-masters</span></div><div class="line"><a name="l04561"></a><span class="lineno"> 4561</span>&#160;      si = <a class="code" href="classXrdProofdProofServMgr.html#a909fb1d3452ad38d9cc83782f777d07c">fActiveSessions</a>.begin();</div><div class="line"><a name="l04562"></a><span class="lineno"> 4562</span>&#160;      <span class="keywordflow">while</span> (si != <a class="code" href="classXrdProofdProofServMgr.html#a909fb1d3452ad38d9cc83782f777d07c">fActiveSessions</a>.end()) {</div><div class="line"><a name="l04563"></a><span class="lineno"> 4563</span>&#160;         <span class="keywordflow">if</span> ((*si)-&gt;Status() == <a class="code" href="XProofProtocol_8h.html#a3a4503f87fa152df23df4d274f07b932a7bf0d5731cd0e6bf8fd0e26861b8c2af">kXPD_running</a> &amp;&amp;</div><div class="line"><a name="l04564"></a><span class="lineno"> 4564</span>&#160;            (*si)-&gt;SrvType() != <a class="code" href="XProofProtocol_8h.html#ac8a8ea0eedefcf3ab8199ea996b3922c">kXPD_Worker</a>) (*si)-&gt;SendClusterInfo(tot, act);</div><div class="line"><a name="l04565"></a><span class="lineno"> 4565</span>&#160;         ++si;</div><div class="line"><a name="l04566"></a><span class="lineno"> 4566</span>&#160;      }</div><div class="line"><a name="l04567"></a><span class="lineno"> 4567</span>&#160;   } <span class="keywordflow">else</span> {</div><div class="line"><a name="l04568"></a><span class="lineno"> 4568</span>&#160;      <a class="code" href="TGHtml_8h.html#ad5bb4a3d12fd54f29da2b924b29e652b">TRACE</a>(DBG, <span class="stringliteral">&quot;No master or submaster controlled by this manager&quot;</span>);</div><div class="line"><a name="l04569"></a><span class="lineno"> 4569</span>&#160;   }</div><div class="line"><a name="l04570"></a><span class="lineno"> 4570</span>&#160;}</div><div class="line"><a name="l04571"></a><span class="lineno"> 4571</span>&#160;<span class="comment"></span></div><div class="line"><a name="l04572"></a><span class="lineno"> 4572</span>&#160;<span class="comment">////////////////////////////////////////////////////////////////////////////////</span></div><div class="line"><a name="l04573"></a><span class="lineno"> 4573</span>&#160;<span class="comment">/// Broadcast priorities to the active sessions.</span></div><div class="line"><a name="l04574"></a><span class="lineno"> 4574</span>&#160;<span class="comment">/// Returns the number of sessions contacted.</span></div><div class="line"><a name="l04575"></a><span class="lineno"> 4575</span>&#160;<span class="comment"></span></div><div class="line"><a name="l04576"></a><span class="lineno"><a class="line" href="classXrdProofdProofServMgr.html#a252fbbc0e7d412c6488c2b0eab66c1b0"> 4576</a></span>&#160;<span class="keywordtype">int</span> <a class="code" href="classXrdProofdProofServMgr.html#a252fbbc0e7d412c6488c2b0eab66c1b0">XrdProofdProofServMgr::BroadcastPriorities</a>()</div><div class="line"><a name="l04577"></a><span class="lineno"> 4577</span>&#160;{</div><div class="line"><a name="l04578"></a><span class="lineno"> 4578</span>&#160;   <a class="code" href="XrdProofdTrace_8h.html#a7c31822912a8d0dc9bfd544097b29e12">XPDLOC</a>(SMGR, <span class="stringliteral">&quot;ProofServMgr::BroadcastPriorities&quot;</span>)</div><div class="line"><a name="l04579"></a><span class="lineno"> 4579</span>&#160;</div><div class="line"><a name="l04580"></a><span class="lineno"> 4580</span>&#160;   <a class="code" href="TGHtml_8h.html#ad5bb4a3d12fd54f29da2b924b29e652b">TRACE</a>(REQ, <span class="stringliteral">&quot;enter&quot;</span>);</div><div class="line"><a name="l04581"></a><span class="lineno"> 4581</span>&#160;</div><div class="line"><a name="l04582"></a><span class="lineno"> 4582</span>&#160;   <span class="keywordtype">int</span> nb = 0;</div><div class="line"><a name="l04583"></a><span class="lineno"> 4583</span>&#160;   XpdBroadcastPriority_t bp = { (<a class="code" href="classXrdProofdProofServMgr.html#a86cac591a5646811e38ff6a2477f4da7">fMgr</a> ? <a class="code" href="classXrdProofdProofServMgr.html#a86cac591a5646811e38ff6a2477f4da7">fMgr</a>-&gt;<a class="code" href="classXrdProofdManager.html#adef641b27f2dc86766634d156cb82476">GroupsMgr</a>() : 0), &amp;nb };</div><div class="line"><a name="l04584"></a><span class="lineno"> 4584</span>&#160;   <a class="code" href="classXrdProofdProofServMgr.html#a4a8be4f347170c279824168597e16caa">fSessions</a>.Apply(<a class="code" href="XrdProofdProofServMgr_8cxx.html#ac25e7156ff6e5bbf5ee3ed7faffde40d">BroadcastPriority</a>, (<span class="keywordtype">void</span> *)&amp;bp);</div><div class="line"><a name="l04585"></a><span class="lineno"> 4585</span>&#160;   <span class="comment">// Done</span></div><div class="line"><a name="l04586"></a><span class="lineno"> 4586</span>&#160;   <span class="keywordflow">return</span> nb;</div><div class="line"><a name="l04587"></a><span class="lineno"> 4587</span>&#160;}</div><div class="line"><a name="l04588"></a><span class="lineno"> 4588</span>&#160;<span class="comment"></span></div><div class="line"><a name="l04589"></a><span class="lineno"> 4589</span>&#160;<span class="comment">////////////////////////////////////////////////////////////////////////////////</span></div><div class="line"><a name="l04590"></a><span class="lineno"> 4590</span>&#160;<span class="comment">/// Return true if in reconnection state, i.e. during</span></div><div class="line"><a name="l04591"></a><span class="lineno"> 4591</span>&#160;<span class="comment">/// that period during which clients are expected to reconnect.</span></div><div class="line"><a name="l04592"></a><span class="lineno"> 4592</span>&#160;<span class="comment">/// Return false if the session is fully effective</span></div><div class="line"><a name="l04593"></a><span class="lineno"> 4593</span>&#160;<span class="comment"></span></div><div class="line"><a name="l04594"></a><span class="lineno"><a class="line" href="classXrdProofdProofServMgr.html#a5543f787eb99df299babf19e0194835d"> 4594</a></span>&#160;<span class="keywordtype">bool</span> <a class="code" href="classXrdProofdProofServMgr.html#a5543f787eb99df299babf19e0194835d">XrdProofdProofServMgr::IsReconnecting</a>()</div><div class="line"><a name="l04595"></a><span class="lineno"> 4595</span>&#160;{</div><div class="line"><a name="l04596"></a><span class="lineno"> 4596</span>&#160;   <span class="keywordtype">int</span> rect = -1;</div><div class="line"><a name="l04597"></a><span class="lineno"> 4597</span>&#160;   <span class="keywordflow">if</span> (<a class="code" href="classXrdProofdProofServMgr.html#ad9f61f67fd36511fe72bea2334260176">fReconnectTime</a> &gt;= 0) {</div><div class="line"><a name="l04598"></a><span class="lineno"> 4598</span>&#160;      rect = time(0) - <a class="code" href="classXrdProofdProofServMgr.html#ad9f61f67fd36511fe72bea2334260176">fReconnectTime</a>;</div><div class="line"><a name="l04599"></a><span class="lineno"> 4599</span>&#160;      <span class="keywordflow">if</span> (rect &lt; <a class="code" href="classXrdProofdProofServMgr.html#a6dea65be9cfafa463f8d8200e3d02ecc">fReconnectTimeOut</a>)</div><div class="line"><a name="l04600"></a><span class="lineno"> 4600</span>&#160;         <span class="keywordflow">return</span> <span class="keyword">true</span>;</div><div class="line"><a name="l04601"></a><span class="lineno"> 4601</span>&#160;   }</div><div class="line"><a name="l04602"></a><span class="lineno"> 4602</span>&#160;   <span class="comment">// Not reconnecting</span></div><div class="line"><a name="l04603"></a><span class="lineno"> 4603</span>&#160;   <span class="keywordflow">return</span> <span class="keyword">false</span>;</div><div class="line"><a name="l04604"></a><span class="lineno"> 4604</span>&#160;}</div><div class="line"><a name="l04605"></a><span class="lineno"> 4605</span>&#160;<span class="comment"></span></div><div class="line"><a name="l04606"></a><span class="lineno"> 4606</span>&#160;<span class="comment">////////////////////////////////////////////////////////////////////////////////</span></div><div class="line"><a name="l04607"></a><span class="lineno"> 4607</span>&#160;<span class="comment">/// Change reconnecting status</span></div><div class="line"><a name="l04608"></a><span class="lineno"> 4608</span>&#160;<span class="comment">///</span></div><div class="line"><a name="l04609"></a><span class="lineno"> 4609</span>&#160;<span class="comment"></span></div><div class="line"><a name="l04610"></a><span class="lineno"><a class="line" href="classXrdProofdProofServMgr.html#ae4a26a2ec9dc1e8b510ba16d5bbd809b"> 4610</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="classXrdProofdProofServMgr.html#ae4a26a2ec9dc1e8b510ba16d5bbd809b">XrdProofdProofServMgr::SetReconnectTime</a>(<span class="keywordtype">bool</span> on)</div><div class="line"><a name="l04611"></a><span class="lineno"> 4611</span>&#160;{</div><div class="line"><a name="l04612"></a><span class="lineno"> 4612</span>&#160;   <a class="code" href="XrdSysToOuc_8h.html#a4ba18bedbb8a1a4367d57f49a4d773ce">XrdSysMutexHelper</a> mhp(<a class="code" href="classXrdProofdProofServMgr.html#ab90491b1fb65834e75bd46f6e09db87f">fMutex</a>);</div><div class="line"><a name="l04613"></a><span class="lineno"> 4613</span>&#160;</div><div class="line"><a name="l04614"></a><span class="lineno"> 4614</span>&#160;   <span class="keywordflow">if</span> (on) {</div><div class="line"><a name="l04615"></a><span class="lineno"> 4615</span>&#160;      <a class="code" href="classXrdProofdProofServMgr.html#ad9f61f67fd36511fe72bea2334260176">fReconnectTime</a> = time(0);</div><div class="line"><a name="l04616"></a><span class="lineno"> 4616</span>&#160;   } <span class="keywordflow">else</span> {</div><div class="line"><a name="l04617"></a><span class="lineno"> 4617</span>&#160;      <a class="code" href="classXrdProofdProofServMgr.html#ad9f61f67fd36511fe72bea2334260176">fReconnectTime</a> = -1;</div><div class="line"><a name="l04618"></a><span class="lineno"> 4618</span>&#160;   }</div><div class="line"><a name="l04619"></a><span class="lineno"> 4619</span>&#160;}</div><div class="line"><a name="l04620"></a><span class="lineno"> 4620</span>&#160;<span class="comment"></span></div><div class="line"><a name="l04621"></a><span class="lineno"> 4621</span>&#160;<span class="comment">////////////////////////////////////////////////////////////////////////////////</span></div><div class="line"><a name="l04622"></a><span class="lineno"> 4622</span>&#160;<span class="comment">/// Check destroyed status</span></div><div class="line"><a name="l04623"></a><span class="lineno"> 4623</span>&#160;<span class="comment">///</span></div><div class="line"><a name="l04624"></a><span class="lineno"> 4624</span>&#160;<span class="comment"></span></div><div class="line"><a name="l04625"></a><span class="lineno"><a class="line" href="classXrdProofdProofServMgr.html#ab587d74e7ada5a2ffcaca340799d9cb8"> 4625</a></span>&#160;<span class="keywordtype">bool</span> <a class="code" href="classXrdProofdProofServMgr.html#ab587d74e7ada5a2ffcaca340799d9cb8">XrdProofdProofServMgr::Alive</a>(<a class="code" href="classXrdProofdProtocol.html">XrdProofdProtocol</a>* p)</div><div class="line"><a name="l04626"></a><span class="lineno"> 4626</span>&#160;{</div><div class="line"><a name="l04627"></a><span class="lineno"> 4627</span>&#160;   <a class="code" href="XrdSysToOuc_8h.html#a4ba18bedbb8a1a4367d57f49a4d773ce">XrdSysMutexHelper</a> mhp(<a class="code" href="classXrdProofdProofServMgr.html#ab90491b1fb65834e75bd46f6e09db87f">fMutex</a>);</div><div class="line"><a name="l04628"></a><span class="lineno"> 4628</span>&#160;</div><div class="line"><a name="l04629"></a><span class="lineno"> 4629</span>&#160;   <span class="keywordtype">bool</span> alive = <span class="keyword">true</span>;</div><div class="line"><a name="l04630"></a><span class="lineno"> 4630</span>&#160;   <span class="keywordtype">int</span> now = time(0);</div><div class="line"><a name="l04631"></a><span class="lineno"> 4631</span>&#160;   std::map&lt;XrdProofdProtocol*,int&gt;::iterator iter = <a class="code" href="classXrdProofdProofServMgr.html#aa105a86a4bc5264a668e0362164a3052">fDestroyTimes</a>.begin();</div><div class="line"><a name="l04632"></a><span class="lineno"> 4632</span>&#160;   <span class="keywordflow">while</span> (iter != <a class="code" href="classXrdProofdProofServMgr.html#aa105a86a4bc5264a668e0362164a3052">fDestroyTimes</a>.end()) {</div><div class="line"><a name="l04633"></a><span class="lineno"> 4633</span>&#160;      <span class="keywordtype">int</span> rect = now - iter-&gt;second;</div><div class="line"><a name="l04634"></a><span class="lineno"> 4634</span>&#160;      <span class="keywordflow">if</span> (rect &lt; <a class="code" href="classXrdProofdProofServMgr.html#a6dea65be9cfafa463f8d8200e3d02ecc">fReconnectTimeOut</a>) {</div><div class="line"><a name="l04635"></a><span class="lineno"> 4635</span>&#160;         <span class="keywordflow">if</span> (p == iter-&gt;first) alive = <span class="keyword">false</span>;</div><div class="line"><a name="l04636"></a><span class="lineno"> 4636</span>&#160;         ++iter;</div><div class="line"><a name="l04637"></a><span class="lineno"> 4637</span>&#160;      } <span class="keywordflow">else</span> {</div><div class="line"><a name="l04638"></a><span class="lineno"> 4638</span>&#160;         iter = <a class="code" href="classXrdProofdProofServMgr.html#aa105a86a4bc5264a668e0362164a3052">fDestroyTimes</a>.erase(iter);</div><div class="line"><a name="l04639"></a><span class="lineno"> 4639</span>&#160;      }</div><div class="line"><a name="l04640"></a><span class="lineno"> 4640</span>&#160;   }</div><div class="line"><a name="l04641"></a><span class="lineno"> 4641</span>&#160;</div><div class="line"><a name="l04642"></a><span class="lineno"> 4642</span>&#160;   <span class="keywordflow">return</span> alive;</div><div class="line"><a name="l04643"></a><span class="lineno"> 4643</span>&#160;}</div><div class="line"><a name="l04644"></a><span class="lineno"> 4644</span>&#160;<span class="comment"></span></div><div class="line"><a name="l04645"></a><span class="lineno"> 4645</span>&#160;<span class="comment">////////////////////////////////////////////////////////////////////////////////</span></div><div class="line"><a name="l04646"></a><span class="lineno"> 4646</span>&#160;<span class="comment">/// Run through entries to reset the disconnecting client slots</span></div><div class="line"><a name="l04647"></a><span class="lineno"> 4647</span>&#160;<span class="comment"></span></div><div class="line"><a name="l04648"></a><span class="lineno"><a class="line" href="XrdProofdProofServMgr_8cxx.html#a1aa25ceda2f238b99cc43d7b0229a6b3"> 4648</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="XrdProofdProofServMgr_8cxx.html#a1aa25ceda2f238b99cc43d7b0229a6b3">FreeClientID</a>(<span class="keyword">const</span> <span class="keywordtype">char</span> *, <a class="code" href="classXrdProofdProofServ.html">XrdProofdProofServ</a> *<a class="code" href="namespaceTGeant4Unit.html#acf9c078cf6febce70e282acd7f5dff9b">ps</a>, <span class="keywordtype">void</span> *<a class="code" href="namespaceTGeant4Unit.html#a5d450e80998065902b102dca2a69066a">s</a>)</div><div class="line"><a name="l04649"></a><span class="lineno"> 4649</span>&#160;{</div><div class="line"><a name="l04650"></a><span class="lineno"> 4650</span>&#160;   <a class="code" href="XrdProofdTrace_8h.html#a7c31822912a8d0dc9bfd544097b29e12">XPDLOC</a>(SMGR, <span class="stringliteral">&quot;FreeClientID&quot;</span>)</div><div class="line"><a name="l04651"></a><span class="lineno"> 4651</span>&#160;</div><div class="line"><a name="l04652"></a><span class="lineno"> 4652</span>&#160;   <span class="keywordtype">int</span> pid = *((<span class="keywordtype">int</span> *)<a class="code" href="namespaceTGeant4Unit.html#a5d450e80998065902b102dca2a69066a">s</a>);</div><div class="line"><a name="l04653"></a><span class="lineno"> 4653</span>&#160;</div><div class="line"><a name="l04654"></a><span class="lineno"> 4654</span>&#160;   <span class="keywordflow">if</span> (<a class="code" href="namespaceTGeant4Unit.html#acf9c078cf6febce70e282acd7f5dff9b">ps</a>) {</div><div class="line"><a name="l04655"></a><span class="lineno"> 4655</span>&#160;      <a class="code" href="namespaceTGeant4Unit.html#acf9c078cf6febce70e282acd7f5dff9b">ps</a>-&gt;FreeClientID(pid);</div><div class="line"><a name="l04656"></a><span class="lineno"> 4656</span>&#160;      <span class="comment">// Go to next</span></div><div class="line"><a name="l04657"></a><span class="lineno"> 4657</span>&#160;      <span class="keywordflow">return</span> 0;</div><div class="line"><a name="l04658"></a><span class="lineno"> 4658</span>&#160;   }</div><div class="line"><a name="l04659"></a><span class="lineno"> 4659</span>&#160;</div><div class="line"><a name="l04660"></a><span class="lineno"> 4660</span>&#160;   <span class="comment">// Some problem</span></div><div class="line"><a name="l04661"></a><span class="lineno"> 4661</span>&#160;   <a class="code" href="TGHtml_8h.html#ad5bb4a3d12fd54f29da2b924b29e652b">TRACE</a>(XERR, <span class="stringliteral">&quot;protocol error: undefined session!&quot;</span>);</div><div class="line"><a name="l04662"></a><span class="lineno"> 4662</span>&#160;   <span class="keywordflow">return</span> 1;</div><div class="line"><a name="l04663"></a><span class="lineno"> 4663</span>&#160;}</div><div class="line"><a name="l04664"></a><span class="lineno"> 4664</span>&#160;<span class="comment"></span></div><div class="line"><a name="l04665"></a><span class="lineno"> 4665</span>&#160;<span class="comment">////////////////////////////////////////////////////////////////////////////////</span></div><div class="line"><a name="l04666"></a><span class="lineno"> 4666</span>&#160;<span class="comment">/// Change reconnecting status</span></div><div class="line"><a name="l04667"></a><span class="lineno"> 4667</span>&#160;<span class="comment">///</span></div><div class="line"><a name="l04668"></a><span class="lineno"> 4668</span>&#160;<span class="comment"></span></div><div class="line"><a name="l04669"></a><span class="lineno"><a class="line" href="classXrdProofdProofServMgr.html#a44783c0d21e69a49e703e689238714e7"> 4669</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="classXrdProofdProofServMgr.html#a44783c0d21e69a49e703e689238714e7">XrdProofdProofServMgr::DisconnectFromProofServ</a>(<span class="keywordtype">int</span> pid)</div><div class="line"><a name="l04670"></a><span class="lineno"> 4670</span>&#160;{</div><div class="line"><a name="l04671"></a><span class="lineno"> 4671</span>&#160;   <a class="code" href="XrdSysToOuc_8h.html#a4ba18bedbb8a1a4367d57f49a4d773ce">XrdSysMutexHelper</a> mhp(<a class="code" href="classXrdProofdProofServMgr.html#ab90491b1fb65834e75bd46f6e09db87f">fMutex</a>);</div><div class="line"><a name="l04672"></a><span class="lineno"> 4672</span>&#160;</div><div class="line"><a name="l04673"></a><span class="lineno"> 4673</span>&#160;   <a class="code" href="classXrdProofdProofServMgr.html#a4a8be4f347170c279824168597e16caa">fSessions</a>.Apply(<a class="code" href="XrdProofdProofServMgr_8cxx.html#a1aa25ceda2f238b99cc43d7b0229a6b3">FreeClientID</a>, (<span class="keywordtype">void</span> *)&amp;pid);</div><div class="line"><a name="l04674"></a><span class="lineno"> 4674</span>&#160;}</div><div class="line"><a name="l04675"></a><span class="lineno"> 4675</span>&#160;<span class="comment"></span></div><div class="line"><a name="l04676"></a><span class="lineno"> 4676</span>&#160;<span class="comment">////////////////////////////////////////////////////////////////////////////////</span></div><div class="line"><a name="l04677"></a><span class="lineno"> 4677</span>&#160;<span class="comment">/// Run thorugh entries to count top-masters</span></div><div class="line"><a name="l04678"></a><span class="lineno"> 4678</span>&#160;<span class="comment"></span></div><div class="line"><a name="l04679"></a><span class="lineno"><a class="line" href="XrdProofdProofServMgr_8cxx.html#ab8209323c5ebddb0edaa25f4f6531505"> 4679</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="XrdProofdProofServMgr_8cxx.html#ab8209323c5ebddb0edaa25f4f6531505">CountTopMasters</a>(<span class="keyword">const</span> <span class="keywordtype">char</span> *, <a class="code" href="classXrdProofdProofServ.html">XrdProofdProofServ</a> *<a class="code" href="namespaceTGeant4Unit.html#acf9c078cf6febce70e282acd7f5dff9b">ps</a>, <span class="keywordtype">void</span> *<a class="code" href="namespaceTGeant4Unit.html#a5d450e80998065902b102dca2a69066a">s</a>)</div><div class="line"><a name="l04680"></a><span class="lineno"> 4680</span>&#160;{</div><div class="line"><a name="l04681"></a><span class="lineno"> 4681</span>&#160;   <a class="code" href="XrdProofdTrace_8h.html#a7c31822912a8d0dc9bfd544097b29e12">XPDLOC</a>(SMGR, <span class="stringliteral">&quot;CountTopMasters&quot;</span>)</div><div class="line"><a name="l04682"></a><span class="lineno"> 4682</span>&#160;</div><div class="line"><a name="l04683"></a><span class="lineno"> 4683</span>&#160;   <span class="keywordtype">int</span> *ntm = (<span class="keywordtype">int</span> *)<a class="code" href="namespaceTGeant4Unit.html#a5d450e80998065902b102dca2a69066a">s</a>;</div><div class="line"><a name="l04684"></a><span class="lineno"> 4684</span>&#160;</div><div class="line"><a name="l04685"></a><span class="lineno"> 4685</span>&#160;   XrdOucString emsg;</div><div class="line"><a name="l04686"></a><span class="lineno"> 4686</span>&#160;   <span class="keywordflow">if</span> (<a class="code" href="namespaceTGeant4Unit.html#acf9c078cf6febce70e282acd7f5dff9b">ps</a>) {</div><div class="line"><a name="l04687"></a><span class="lineno"> 4687</span>&#160;      <span class="keywordflow">if</span> (<a class="code" href="namespaceTGeant4Unit.html#acf9c078cf6febce70e282acd7f5dff9b">ps</a>-&gt;SrvType() == <a class="code" href="XProofProtocol_8h.html#a4914ebd84de85ce2387929f1808f673a">kXPD_TopMaster</a>) (*ntm)++;</div><div class="line"><a name="l04688"></a><span class="lineno"> 4688</span>&#160;      <span class="comment">// Go to next</span></div><div class="line"><a name="l04689"></a><span class="lineno"> 4689</span>&#160;      <span class="keywordflow">return</span> 0;</div><div class="line"><a name="l04690"></a><span class="lineno"> 4690</span>&#160;   } <span class="keywordflow">else</span> {</div><div class="line"><a name="l04691"></a><span class="lineno"> 4691</span>&#160;      emsg = <span class="stringliteral">&quot;input entry undefined&quot;</span>;</div><div class="line"><a name="l04692"></a><span class="lineno"> 4692</span>&#160;   }</div><div class="line"><a name="l04693"></a><span class="lineno"> 4693</span>&#160;</div><div class="line"><a name="l04694"></a><span class="lineno"> 4694</span>&#160;   <span class="comment">// Some problem</span></div><div class="line"><a name="l04695"></a><span class="lineno"> 4695</span>&#160;   <a class="code" href="TGHtml_8h.html#ad5bb4a3d12fd54f29da2b924b29e652b">TRACE</a>(XERR,<span class="stringliteral">&quot;protocol error: &quot;</span>&lt;&lt;emsg);</div><div class="line"><a name="l04696"></a><span class="lineno"> 4696</span>&#160;   <span class="keywordflow">return</span> 1;</div><div class="line"><a name="l04697"></a><span class="lineno"> 4697</span>&#160;}</div><div class="line"><a name="l04698"></a><span class="lineno"> 4698</span>&#160;<span class="comment"></span></div><div class="line"><a name="l04699"></a><span class="lineno"> 4699</span>&#160;<span class="comment">////////////////////////////////////////////////////////////////////////////////</span></div><div class="line"><a name="l04700"></a><span class="lineno"> 4700</span>&#160;<span class="comment">/// Return the number of current sessions (top masters)</span></div><div class="line"><a name="l04701"></a><span class="lineno"> 4701</span>&#160;<span class="comment"></span></div><div class="line"><a name="l04702"></a><span class="lineno"><a class="line" href="classXrdProofdProofServMgr.html#a112317944ba9a3b64b9f784a9ef8d6b8"> 4702</a></span>&#160;<span class="keywordtype">int</span> <a class="code" href="classXrdProofdProofServMgr.html#a112317944ba9a3b64b9f784a9ef8d6b8">XrdProofdProofServMgr::CurrentSessions</a>(<span class="keywordtype">bool</span> recalculate)</div><div class="line"><a name="l04703"></a><span class="lineno"> 4703</span>&#160;{</div><div class="line"><a name="l04704"></a><span class="lineno"> 4704</span>&#160;   <a class="code" href="XrdProofdTrace_8h.html#a7c31822912a8d0dc9bfd544097b29e12">XPDLOC</a>(SMGR, <span class="stringliteral">&quot;ProofServMgr::CurrentSessions&quot;</span>)</div><div class="line"><a name="l04705"></a><span class="lineno"> 4705</span>&#160;</div><div class="line"><a name="l04706"></a><span class="lineno"> 4706</span>&#160;   <a class="code" href="TGHtml_8h.html#ad5bb4a3d12fd54f29da2b924b29e652b">TRACE</a>(REQ, <span class="stringliteral">&quot;enter&quot;</span>);</div><div class="line"><a name="l04707"></a><span class="lineno"> 4707</span>&#160;</div><div class="line"><a name="l04708"></a><span class="lineno"> 4708</span>&#160;   <a class="code" href="XrdSysToOuc_8h.html#a4ba18bedbb8a1a4367d57f49a4d773ce">XrdSysMutexHelper</a> mhp(<a class="code" href="classXrdProofdProofServMgr.html#ab90491b1fb65834e75bd46f6e09db87f">fMutex</a>);</div><div class="line"><a name="l04709"></a><span class="lineno"> 4709</span>&#160;   <span class="keywordflow">if</span> (recalculate) {</div><div class="line"><a name="l04710"></a><span class="lineno"> 4710</span>&#160;      <a class="code" href="classXrdProofdProofServMgr.html#afddc4c3251e7293b77ca5f8b4dbe0595">fCurrentSessions</a> = 0;</div><div class="line"><a name="l04711"></a><span class="lineno"> 4711</span>&#160;      <a class="code" href="classXrdProofdProofServMgr.html#a4a8be4f347170c279824168597e16caa">fSessions</a>.Apply(<a class="code" href="XrdProofdProofServMgr_8cxx.html#ab8209323c5ebddb0edaa25f4f6531505">CountTopMasters</a>, (<span class="keywordtype">void</span> *)&amp;<a class="code" href="classXrdProofdProofServMgr.html#afddc4c3251e7293b77ca5f8b4dbe0595">fCurrentSessions</a>);</div><div class="line"><a name="l04712"></a><span class="lineno"> 4712</span>&#160;   }</div><div class="line"><a name="l04713"></a><span class="lineno"> 4713</span>&#160;</div><div class="line"><a name="l04714"></a><span class="lineno"> 4714</span>&#160;   <span class="comment">// Done</span></div><div class="line"><a name="l04715"></a><span class="lineno"> 4715</span>&#160;   <span class="keywordflow">return</span> <a class="code" href="classXrdProofdProofServMgr.html#afddc4c3251e7293b77ca5f8b4dbe0595">fCurrentSessions</a>;</div><div class="line"><a name="l04716"></a><span class="lineno"> 4716</span>&#160;}</div><div class="line"><a name="l04717"></a><span class="lineno"> 4717</span>&#160;<span class="comment"></span></div><div class="line"><a name="l04718"></a><span class="lineno"> 4718</span>&#160;<span class="comment">////////////////////////////////////////////////////////////////////////////////</span></div><div class="line"><a name="l04719"></a><span class="lineno"> 4719</span>&#160;<span class="comment">/// Resolve some keywords in &#39;s&#39;</span></div><div class="line"><a name="l04720"></a><span class="lineno"> 4720</span>&#160;<span class="comment">///    &lt;logfileroot&gt;, &lt;user&gt;, &lt;rootsys&gt;</span></div><div class="line"><a name="l04721"></a><span class="lineno"> 4721</span>&#160;<span class="comment"></span></div><div class="line"><a name="l04722"></a><span class="lineno"><a class="line" href="classXrdProofdProofServMgr.html#aefd6e4127ea5c75d9007762cb375adea"> 4722</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="classXrdProofdProofServMgr.html#aefd6e4127ea5c75d9007762cb375adea">XrdProofdProofServMgr::ResolveKeywords</a>(XrdOucString &amp;<a class="code" href="namespaceTGeant4Unit.html#a5d450e80998065902b102dca2a69066a">s</a>, <a class="code" href="structProofServEnv__t.html">ProofServEnv_t</a> *in)</div><div class="line"><a name="l04723"></a><span class="lineno"> 4723</span>&#160;{</div><div class="line"><a name="l04724"></a><span class="lineno"> 4724</span>&#160;   <span class="keywordflow">if</span> (!in) <span class="keywordflow">return</span>;</div><div class="line"><a name="l04725"></a><span class="lineno"> 4725</span>&#160;</div><div class="line"><a name="l04726"></a><span class="lineno"> 4726</span>&#160;   <span class="keywordtype">bool</span> isWorker = 0;</div><div class="line"><a name="l04727"></a><span class="lineno"> 4727</span>&#160;   <span class="keywordflow">if</span> (in-&gt;<a class="code" href="structProofServEnv__t.html#aefb8c17473f66fe63376b1956ba7ebfa">fPS</a>-&gt;<a class="code" href="classXrdProofdProofServ.html#a52a25c22819b28395cc597a96676312c">SrvType</a>() == <a class="code" href="XProofProtocol_8h.html#ac8a8ea0eedefcf3ab8199ea996b3922c">kXPD_Worker</a>) isWorker = 1;</div><div class="line"><a name="l04728"></a><span class="lineno"> 4728</span>&#160;</div><div class="line"><a name="l04729"></a><span class="lineno"> 4729</span>&#160;   <span class="comment">// Log file</span></div><div class="line"><a name="l04730"></a><span class="lineno"> 4730</span>&#160;   <span class="keywordflow">if</span> (!isWorker &amp;&amp; <a class="code" href="namespaceTGeant4Unit.html#a5d450e80998065902b102dca2a69066a">s</a>.find(<span class="stringliteral">&quot;&lt;logfilemst&gt;&quot;</span>) != STR_NPOS) {</div><div class="line"><a name="l04731"></a><span class="lineno"> 4731</span>&#160;      XrdOucString lfr(in-&gt;<a class="code" href="structProofServEnv__t.html#a88002c75764b173de52afd5f9b3c6c74">fLogFile</a>);</div><div class="line"><a name="l04732"></a><span class="lineno"> 4732</span>&#160;      <span class="keywordflow">if</span> (lfr.endswith(<span class="stringliteral">&quot;.log&quot;</span>)) lfr.erase(lfr.rfind(<span class="stringliteral">&quot;.log&quot;</span>));</div><div class="line"><a name="l04733"></a><span class="lineno"> 4733</span>&#160;      <a class="code" href="namespaceTGeant4Unit.html#a5d450e80998065902b102dca2a69066a">s</a>.replace(<span class="stringliteral">&quot;&lt;logfilemst&gt;&quot;</span>, lfr);</div><div class="line"><a name="l04734"></a><span class="lineno"> 4734</span>&#160;   } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (isWorker &amp;&amp; <a class="code" href="namespaceTGeant4Unit.html#a5d450e80998065902b102dca2a69066a">s</a>.find(<span class="stringliteral">&quot;&lt;logfilewrk&gt;&quot;</span>) != STR_NPOS) {</div><div class="line"><a name="l04735"></a><span class="lineno"> 4735</span>&#160;      XrdOucString lfr(in-&gt;<a class="code" href="structProofServEnv__t.html#a88002c75764b173de52afd5f9b3c6c74">fLogFile</a>);</div><div class="line"><a name="l04736"></a><span class="lineno"> 4736</span>&#160;      <span class="keywordflow">if</span> (lfr.endswith(<span class="stringliteral">&quot;.log&quot;</span>)) lfr.erase(lfr.rfind(<span class="stringliteral">&quot;.log&quot;</span>));</div><div class="line"><a name="l04737"></a><span class="lineno"> 4737</span>&#160;      <a class="code" href="namespaceTGeant4Unit.html#a5d450e80998065902b102dca2a69066a">s</a>.replace(<span class="stringliteral">&quot;&lt;logfilewrk&gt;&quot;</span>, lfr);</div><div class="line"><a name="l04738"></a><span class="lineno"> 4738</span>&#160;   }</div><div class="line"><a name="l04739"></a><span class="lineno"> 4739</span>&#160;</div><div class="line"><a name="l04740"></a><span class="lineno"> 4740</span>&#160;   <span class="comment">// user</span></div><div class="line"><a name="l04741"></a><span class="lineno"> 4741</span>&#160;   <span class="keywordflow">if</span> (getenv(<span class="stringliteral">&quot;USER&quot;</span>) &amp;&amp; <a class="code" href="namespaceTGeant4Unit.html#a5d450e80998065902b102dca2a69066a">s</a>.find(<span class="stringliteral">&quot;&lt;user&gt;&quot;</span>) != STR_NPOS) {</div><div class="line"><a name="l04742"></a><span class="lineno"> 4742</span>&#160;      XrdOucString usr(getenv(<span class="stringliteral">&quot;USER&quot;</span>));</div><div class="line"><a name="l04743"></a><span class="lineno"> 4743</span>&#160;      <a class="code" href="namespaceTGeant4Unit.html#a5d450e80998065902b102dca2a69066a">s</a>.replace(<span class="stringliteral">&quot;&lt;user&gt;&quot;</span>, usr);</div><div class="line"><a name="l04744"></a><span class="lineno"> 4744</span>&#160;   }</div><div class="line"><a name="l04745"></a><span class="lineno"> 4745</span>&#160;</div><div class="line"><a name="l04746"></a><span class="lineno"> 4746</span>&#160;   <span class="comment">// rootsys</span></div><div class="line"><a name="l04747"></a><span class="lineno"> 4747</span>&#160;   <span class="keywordflow">if</span> (getenv(<span class="stringliteral">&quot;ROOTSYS&quot;</span>) &amp;&amp; <a class="code" href="namespaceTGeant4Unit.html#a5d450e80998065902b102dca2a69066a">s</a>.find(<span class="stringliteral">&quot;&lt;rootsys&gt;&quot;</span>) != STR_NPOS) {</div><div class="line"><a name="l04748"></a><span class="lineno"> 4748</span>&#160;      XrdOucString rootsys(getenv(<span class="stringliteral">&quot;ROOTSYS&quot;</span>));</div><div class="line"><a name="l04749"></a><span class="lineno"> 4749</span>&#160;      <a class="code" href="namespaceTGeant4Unit.html#a5d450e80998065902b102dca2a69066a">s</a>.replace(<span class="stringliteral">&quot;&lt;rootsys&gt;&quot;</span>, rootsys);</div><div class="line"><a name="l04750"></a><span class="lineno"> 4750</span>&#160;   }</div><div class="line"><a name="l04751"></a><span class="lineno"> 4751</span>&#160;}</div><div class="line"><a name="l04752"></a><span class="lineno"> 4752</span>&#160;</div><div class="line"><a name="l04753"></a><span class="lineno"> 4753</span>&#160;<span class="comment">//</span></div><div class="line"><a name="l04754"></a><span class="lineno"> 4754</span>&#160;<span class="comment">// Auxilliary class to handle session pid files</span></div><div class="line"><a name="l04755"></a><span class="lineno"> 4755</span>&#160;<span class="comment">//</span></div><div class="line"><a name="l04756"></a><span class="lineno"> 4756</span>&#160;<span class="comment"></span></div><div class="line"><a name="l04757"></a><span class="lineno"> 4757</span>&#160;<span class="comment">////////////////////////////////////////////////////////////////////////////////</span></div><div class="line"><a name="l04758"></a><span class="lineno"> 4758</span>&#160;<span class="comment">/// Construct from &#39;c&#39; and &#39;s&#39;</span></div><div class="line"><a name="l04759"></a><span class="lineno"> 4759</span>&#160;<span class="comment"></span></div><div class="line"><a name="l04760"></a><span class="lineno"><a class="line" href="classXrdProofSessionInfo.html#ad7e7a2c24051c1bb8d19291035232782"> 4760</a></span>&#160;<a class="code" href="classXrdProofSessionInfo.html#ad7e7a2c24051c1bb8d19291035232782">XrdProofSessionInfo::XrdProofSessionInfo</a>(<a class="code" href="classXrdProofdClient.html">XrdProofdClient</a> *<a class="code" href="RSha256_8hxx.html#a63f410abde93141c9013b7d3f3971738">c</a>, <a class="code" href="classXrdProofdProofServ.html">XrdProofdProofServ</a> *<a class="code" href="namespaceTGeant4Unit.html#a5d450e80998065902b102dca2a69066a">s</a>)</div><div class="line"><a name="l04761"></a><span class="lineno"> 4761</span>&#160;{</div><div class="line"><a name="l04762"></a><span class="lineno"> 4762</span>&#160;   <a class="code" href="classXrdProofSessionInfo.html#ad3e62b6ba7bfe0bdba1bfe9aa5baa2ab">fLastAccess</a> = 0;</div><div class="line"><a name="l04763"></a><span class="lineno"> 4763</span>&#160;</div><div class="line"><a name="l04764"></a><span class="lineno"> 4764</span>&#160;   <span class="comment">// Fill from the client instance</span></div><div class="line"><a name="l04765"></a><span class="lineno"> 4765</span>&#160;   <a class="code" href="classXrdProofSessionInfo.html#a54094db8d9c75cbd7822532d026ebc61">fUser</a> = <a class="code" href="RSha256_8hxx.html#a63f410abde93141c9013b7d3f3971738">c</a> ? <a class="code" href="RSha256_8hxx.html#a63f410abde93141c9013b7d3f3971738">c</a>-&gt;User() : <span class="stringliteral">&quot;&quot;</span>;</div><div class="line"><a name="l04766"></a><span class="lineno"> 4766</span>&#160;   <a class="code" href="classXrdProofSessionInfo.html#a535c612dd0e50fd92671e630e59e64df">fGroup</a> = <a class="code" href="RSha256_8hxx.html#a63f410abde93141c9013b7d3f3971738">c</a> ? <a class="code" href="RSha256_8hxx.html#a63f410abde93141c9013b7d3f3971738">c</a>-&gt;Group() : <span class="stringliteral">&quot;&quot;</span>;</div><div class="line"><a name="l04767"></a><span class="lineno"> 4767</span>&#160;</div><div class="line"><a name="l04768"></a><span class="lineno"> 4768</span>&#160;   <span class="comment">// Fill from the server instance</span></div><div class="line"><a name="l04769"></a><span class="lineno"> 4769</span>&#160;   <a class="code" href="classXrdProofSessionInfo.html#ae6ed70e85425161698b98ea8b38ce41f">fPid</a> = <a class="code" href="namespaceTGeant4Unit.html#a5d450e80998065902b102dca2a69066a">s</a> ? <a class="code" href="namespaceTGeant4Unit.html#a5d450e80998065902b102dca2a69066a">s</a>-&gt;SrvPID() : -1;</div><div class="line"><a name="l04770"></a><span class="lineno"> 4770</span>&#160;   <a class="code" href="classXrdProofSessionInfo.html#a78d843cbc3b32c1e19250359ef46b35f">fID</a> = <a class="code" href="namespaceTGeant4Unit.html#a5d450e80998065902b102dca2a69066a">s</a> ? <a class="code" href="namespaceTGeant4Unit.html#a5d450e80998065902b102dca2a69066a">s</a>-&gt;ID() : -1;</div><div class="line"><a name="l04771"></a><span class="lineno"> 4771</span>&#160;   <a class="code" href="classXrdProofSessionInfo.html#a5cafed559ea3c880d42d364a8d8e5d95">fSrvType</a> = <a class="code" href="namespaceTGeant4Unit.html#a5d450e80998065902b102dca2a69066a">s</a> ? <a class="code" href="namespaceTGeant4Unit.html#a5d450e80998065902b102dca2a69066a">s</a>-&gt;SrvType() : -1;</div><div class="line"><a name="l04772"></a><span class="lineno"> 4772</span>&#160;   <a class="code" href="classXrdProofSessionInfo.html#acc3e0d8bd1c848656ca48e29822f7974">fPLiteNWrks</a> = <a class="code" href="namespaceTGeant4Unit.html#a5d450e80998065902b102dca2a69066a">s</a> ? <a class="code" href="namespaceTGeant4Unit.html#a5d450e80998065902b102dca2a69066a">s</a>-&gt;PLiteNWrks() : -1;</div><div class="line"><a name="l04773"></a><span class="lineno"> 4773</span>&#160;   <a class="code" href="classXrdProofSessionInfo.html#a8e4f80e00d76ce9d2aab4063dd6d85dc">fStatus</a> = <a class="code" href="namespaceTGeant4Unit.html#a5d450e80998065902b102dca2a69066a">s</a> ? <a class="code" href="namespaceTGeant4Unit.html#a5d450e80998065902b102dca2a69066a">s</a>-&gt;Status() : <a class="code" href="XProofProtocol_8h.html#a3a4503f87fa152df23df4d274f07b932a83fc8da1cd00c3b598709425884d37fb">kXPD_unknown</a>;</div><div class="line"><a name="l04774"></a><span class="lineno"> 4774</span>&#160;   <a class="code" href="classXrdProofSessionInfo.html#a923614a4a79e6a824ea27b3a1cdaad59">fOrdinal</a> = <a class="code" href="namespaceTGeant4Unit.html#a5d450e80998065902b102dca2a69066a">s</a> ? <a class="code" href="namespaceTGeant4Unit.html#a5d450e80998065902b102dca2a69066a">s</a>-&gt;Ordinal() : <span class="stringliteral">&quot;&quot;</span>;</div><div class="line"><a name="l04775"></a><span class="lineno"> 4775</span>&#160;   <a class="code" href="classXrdProofSessionInfo.html#a518ae82246ac2f8d3db9159f72056411">fTag</a> = <a class="code" href="namespaceTGeant4Unit.html#a5d450e80998065902b102dca2a69066a">s</a> ? <a class="code" href="namespaceTGeant4Unit.html#a5d450e80998065902b102dca2a69066a">s</a>-&gt;Tag() : <span class="stringliteral">&quot;&quot;</span>;</div><div class="line"><a name="l04776"></a><span class="lineno"> 4776</span>&#160;   <a class="code" href="classXrdProofSessionInfo.html#a07eaeda3939341c7c9c34ffbda48b3cd">fAlias</a> = <a class="code" href="namespaceTGeant4Unit.html#a5d450e80998065902b102dca2a69066a">s</a> ? <a class="code" href="namespaceTGeant4Unit.html#a5d450e80998065902b102dca2a69066a">s</a>-&gt;Alias() : <span class="stringliteral">&quot;&quot;</span>;</div><div class="line"><a name="l04777"></a><span class="lineno"> 4777</span>&#160;   <a class="code" href="classXrdProofSessionInfo.html#ad1081533106098435cdc37c6ab670ae3">fLogFile</a> = <a class="code" href="namespaceTGeant4Unit.html#a5d450e80998065902b102dca2a69066a">s</a> ? <a class="code" href="namespaceTGeant4Unit.html#a5d450e80998065902b102dca2a69066a">s</a>-&gt;Fileout() : <span class="stringliteral">&quot;&quot;</span>;</div><div class="line"><a name="l04778"></a><span class="lineno"> 4778</span>&#160;   <a class="code" href="classXrdProofSessionInfo.html#a4b9aa50df5859d41d334e30d2a4f832e">fROOTTag</a> = (<a class="code" href="namespaceTGeant4Unit.html#a5d450e80998065902b102dca2a69066a">s</a> &amp;&amp; <a class="code" href="namespaceTGeant4Unit.html#a5d450e80998065902b102dca2a69066a">s</a>-&gt;ROOT())? <a class="code" href="namespaceTGeant4Unit.html#a5d450e80998065902b102dca2a69066a">s</a>-&gt;ROOT()-&gt;Tag() : <span class="stringliteral">&quot;&quot;</span>;</div><div class="line"><a name="l04779"></a><span class="lineno"> 4779</span>&#160;   <a class="code" href="classXrdProofSessionInfo.html#aff265c0a3cfd2f5c5fdf081a7bc3f067">fSrvProtVers</a> = (<a class="code" href="namespaceTGeant4Unit.html#a5d450e80998065902b102dca2a69066a">s</a> &amp;&amp; <a class="code" href="namespaceTGeant4Unit.html#a5d450e80998065902b102dca2a69066a">s</a>-&gt;ROOT()) ? <a class="code" href="namespaceTGeant4Unit.html#a5d450e80998065902b102dca2a69066a">s</a>-&gt;ROOT()-&gt;SrvProtVers() : -1;</div><div class="line"><a name="l04780"></a><span class="lineno"> 4780</span>&#160;   <a class="code" href="classXrdProofSessionInfo.html#aa7c5425c9469c9ced6f83eedb0bb6a31">fUserEnvs</a> = <a class="code" href="namespaceTGeant4Unit.html#a5d450e80998065902b102dca2a69066a">s</a> ? <a class="code" href="namespaceTGeant4Unit.html#a5d450e80998065902b102dca2a69066a">s</a>-&gt;UserEnvs() : <span class="stringliteral">&quot;&quot;</span>;</div><div class="line"><a name="l04781"></a><span class="lineno"> 4781</span>&#160;   <a class="code" href="classXrdProofSessionInfo.html#a7bdc7f6cb43cec3b52c7abab064e0432">fAdminPath</a> = <a class="code" href="namespaceTGeant4Unit.html#a5d450e80998065902b102dca2a69066a">s</a> ? <a class="code" href="namespaceTGeant4Unit.html#a5d450e80998065902b102dca2a69066a">s</a>-&gt;AdminPath() : <span class="stringliteral">&quot;&quot;</span>;</div><div class="line"><a name="l04782"></a><span class="lineno"> 4782</span>&#160;   <a class="code" href="classXrdProofSessionInfo.html#ac78bc3dfceb59dba00cc3ceed97ce1ed">fUnixPath</a> = <a class="code" href="namespaceTGeant4Unit.html#a5d450e80998065902b102dca2a69066a">s</a> ? <a class="code" href="namespaceTGeant4Unit.html#a5d450e80998065902b102dca2a69066a">s</a>-&gt;UNIXSockPath() : <span class="stringliteral">&quot;&quot;</span>;</div><div class="line"><a name="l04783"></a><span class="lineno"> 4783</span>&#160;}</div><div class="line"><a name="l04784"></a><span class="lineno"> 4784</span>&#160;<span class="comment"></span></div><div class="line"><a name="l04785"></a><span class="lineno"> 4785</span>&#160;<span class="comment">////////////////////////////////////////////////////////////////////////////////</span></div><div class="line"><a name="l04786"></a><span class="lineno"> 4786</span>&#160;<span class="comment">/// Fill &#39;s&#39; fields using the stored info</span></div><div class="line"><a name="l04787"></a><span class="lineno"> 4787</span>&#160;<span class="comment"></span></div><div class="line"><a name="l04788"></a><span class="lineno"><a class="line" href="classXrdProofSessionInfo.html#a00cec64eca20031f79114f737918563f"> 4788</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="classXrdProofSessionInfo.html#a00cec64eca20031f79114f737918563f">XrdProofSessionInfo::FillProofServ</a>(<a class="code" href="classXrdProofdProofServ.html">XrdProofdProofServ</a> &amp;<a class="code" href="namespaceTGeant4Unit.html#a5d450e80998065902b102dca2a69066a">s</a>, <a class="code" href="classXrdROOTMgr.html">XrdROOTMgr</a> *rmgr)</div><div class="line"><a name="l04789"></a><span class="lineno"> 4789</span>&#160;{</div><div class="line"><a name="l04790"></a><span class="lineno"> 4790</span>&#160;   <a class="code" href="XrdProofdTrace_8h.html#a7c31822912a8d0dc9bfd544097b29e12">XPDLOC</a>(SMGR, <span class="stringliteral">&quot;SessionInfo::FillProofServ&quot;</span>)</div><div class="line"><a name="l04791"></a><span class="lineno"> 4791</span>&#160;</div><div class="line"><a name="l04792"></a><span class="lineno"> 4792</span>&#160;   <a class="code" href="namespaceTGeant4Unit.html#a5d450e80998065902b102dca2a69066a">s</a>.SetClient(<a class="code" href="classXrdProofSessionInfo.html#a54094db8d9c75cbd7822532d026ebc61">fUser</a>.c_str());</div><div class="line"><a name="l04793"></a><span class="lineno"> 4793</span>&#160;   <a class="code" href="namespaceTGeant4Unit.html#a5d450e80998065902b102dca2a69066a">s</a>.SetGroup(<a class="code" href="classXrdProofSessionInfo.html#a535c612dd0e50fd92671e630e59e64df">fGroup</a>.c_str());</div><div class="line"><a name="l04794"></a><span class="lineno"> 4794</span>&#160;   <span class="keywordflow">if</span> (<a class="code" href="classXrdProofSessionInfo.html#ae6ed70e85425161698b98ea8b38ce41f">fPid</a> &gt; 0)</div><div class="line"><a name="l04795"></a><span class="lineno"> 4795</span>&#160;      <a class="code" href="namespaceTGeant4Unit.html#a5d450e80998065902b102dca2a69066a">s</a>.SetSrvPID(<a class="code" href="classXrdProofSessionInfo.html#ae6ed70e85425161698b98ea8b38ce41f">fPid</a>);</div><div class="line"><a name="l04796"></a><span class="lineno"> 4796</span>&#160;   <span class="keywordflow">if</span> (<a class="code" href="classXrdProofSessionInfo.html#a78d843cbc3b32c1e19250359ef46b35f">fID</a> &gt;= 0)</div><div class="line"><a name="l04797"></a><span class="lineno"> 4797</span>&#160;      <a class="code" href="namespaceTGeant4Unit.html#a5d450e80998065902b102dca2a69066a">s</a>.SetID(<a class="code" href="classXrdProofSessionInfo.html#a78d843cbc3b32c1e19250359ef46b35f">fID</a>);</div><div class="line"><a name="l04798"></a><span class="lineno"> 4798</span>&#160;   <a class="code" href="namespaceTGeant4Unit.html#a5d450e80998065902b102dca2a69066a">s</a>.SetSrvType(<a class="code" href="classXrdProofSessionInfo.html#a5cafed559ea3c880d42d364a8d8e5d95">fSrvType</a>);</div><div class="line"><a name="l04799"></a><span class="lineno"> 4799</span>&#160;   <a class="code" href="namespaceTGeant4Unit.html#a5d450e80998065902b102dca2a69066a">s</a>.SetPLiteNWrks(<a class="code" href="classXrdProofSessionInfo.html#acc3e0d8bd1c848656ca48e29822f7974">fPLiteNWrks</a>);</div><div class="line"><a name="l04800"></a><span class="lineno"> 4800</span>&#160;   <a class="code" href="namespaceTGeant4Unit.html#a5d450e80998065902b102dca2a69066a">s</a>.SetStatus(<a class="code" href="classXrdProofSessionInfo.html#a8e4f80e00d76ce9d2aab4063dd6d85dc">fStatus</a>);</div><div class="line"><a name="l04801"></a><span class="lineno"> 4801</span>&#160;   <a class="code" href="namespaceTGeant4Unit.html#a5d450e80998065902b102dca2a69066a">s</a>.SetOrdinal(<a class="code" href="classXrdProofSessionInfo.html#a923614a4a79e6a824ea27b3a1cdaad59">fOrdinal</a>.c_str());</div><div class="line"><a name="l04802"></a><span class="lineno"> 4802</span>&#160;   <a class="code" href="namespaceTGeant4Unit.html#a5d450e80998065902b102dca2a69066a">s</a>.SetTag(<a class="code" href="classXrdProofSessionInfo.html#a518ae82246ac2f8d3db9159f72056411">fTag</a>.c_str());</div><div class="line"><a name="l04803"></a><span class="lineno"> 4803</span>&#160;   <a class="code" href="namespaceTGeant4Unit.html#a5d450e80998065902b102dca2a69066a">s</a>.SetAlias(<a class="code" href="classXrdProofSessionInfo.html#a07eaeda3939341c7c9c34ffbda48b3cd">fAlias</a>.c_str());</div><div class="line"><a name="l04804"></a><span class="lineno"> 4804</span>&#160;   <a class="code" href="namespaceTGeant4Unit.html#a5d450e80998065902b102dca2a69066a">s</a>.SetFileout(<a class="code" href="classXrdProofSessionInfo.html#ad1081533106098435cdc37c6ab670ae3">fLogFile</a>.c_str());</div><div class="line"><a name="l04805"></a><span class="lineno"> 4805</span>&#160;   <span class="keywordflow">if</span> (rmgr) {</div><div class="line"><a name="l04806"></a><span class="lineno"> 4806</span>&#160;      <span class="keywordflow">if</span> (rmgr-&gt;<a class="code" href="classXrdROOTMgr.html#a16cd051cf991939382d44a9f8623a61f">GetVersion</a>(<a class="code" href="classXrdProofSessionInfo.html#a4b9aa50df5859d41d334e30d2a4f832e">fROOTTag</a>.c_str())) {</div><div class="line"><a name="l04807"></a><span class="lineno"> 4807</span>&#160;         <a class="code" href="namespaceTGeant4Unit.html#a5d450e80998065902b102dca2a69066a">s</a>.SetROOT(rmgr-&gt;<a class="code" href="classXrdROOTMgr.html#a16cd051cf991939382d44a9f8623a61f">GetVersion</a>(<a class="code" href="classXrdProofSessionInfo.html#a4b9aa50df5859d41d334e30d2a4f832e">fROOTTag</a>.c_str()));</div><div class="line"><a name="l04808"></a><span class="lineno"> 4808</span>&#160;      } <span class="keywordflow">else</span> {</div><div class="line"><a name="l04809"></a><span class="lineno"> 4809</span>&#160;         <a class="code" href="TGHtml_8h.html#ad5bb4a3d12fd54f29da2b924b29e652b">TRACE</a>(ALL, <span class="stringliteral">&quot;ROOT version &#39;&quot;</span>&lt;&lt; <a class="code" href="classXrdProofSessionInfo.html#a4b9aa50df5859d41d334e30d2a4f832e">fROOTTag</a> &lt;&lt;</div><div class="line"><a name="l04810"></a><span class="lineno"> 4810</span>&#160;                    <span class="stringliteral">&quot;&#39; not availabe anymore: setting the default&quot;</span>);</div><div class="line"><a name="l04811"></a><span class="lineno"> 4811</span>&#160;         <a class="code" href="namespaceTGeant4Unit.html#a5d450e80998065902b102dca2a69066a">s</a>.SetROOT(rmgr-&gt;<a class="code" href="classXrdROOTMgr.html#a80d29c16a1fc5046abdea1ac9bc72dc7">DefaultVersion</a>());</div><div class="line"><a name="l04812"></a><span class="lineno"> 4812</span>&#160;      }</div><div class="line"><a name="l04813"></a><span class="lineno"> 4813</span>&#160;   }</div><div class="line"><a name="l04814"></a><span class="lineno"> 4814</span>&#160;   <a class="code" href="namespaceTGeant4Unit.html#a5d450e80998065902b102dca2a69066a">s</a>.SetUserEnvs(<a class="code" href="classXrdProofSessionInfo.html#aa7c5425c9469c9ced6f83eedb0bb6a31">fUserEnvs</a>.c_str());</div><div class="line"><a name="l04815"></a><span class="lineno"> 4815</span>&#160;   <a class="code" href="namespaceTGeant4Unit.html#a5d450e80998065902b102dca2a69066a">s</a>.SetAdminPath(<a class="code" href="classXrdProofSessionInfo.html#a7bdc7f6cb43cec3b52c7abab064e0432">fAdminPath</a>.c_str(), 0, 0);</div><div class="line"><a name="l04816"></a><span class="lineno"> 4816</span>&#160;   <a class="code" href="namespaceTGeant4Unit.html#a5d450e80998065902b102dca2a69066a">s</a>.SetUNIXSockPath(<a class="code" href="classXrdProofSessionInfo.html#ac78bc3dfceb59dba00cc3ceed97ce1ed">fUnixPath</a>.c_str());</div><div class="line"><a name="l04817"></a><span class="lineno"> 4817</span>&#160;}</div><div class="line"><a name="l04818"></a><span class="lineno"> 4818</span>&#160;<span class="comment"></span></div><div class="line"><a name="l04819"></a><span class="lineno"> 4819</span>&#160;<span class="comment">////////////////////////////////////////////////////////////////////////////////</span></div><div class="line"><a name="l04820"></a><span class="lineno"> 4820</span>&#160;<span class="comment">/// Save content to &#39;file&#39;</span></div><div class="line"><a name="l04821"></a><span class="lineno"> 4821</span>&#160;<span class="comment"></span></div><div class="line"><a name="l04822"></a><span class="lineno"><a class="line" href="classXrdProofSessionInfo.html#a8f6f72c571943c1d973141cfaa9817ed"> 4822</a></span>&#160;<span class="keywordtype">int</span> <a class="code" href="classXrdProofSessionInfo.html#a8f6f72c571943c1d973141cfaa9817ed">XrdProofSessionInfo::SaveToFile</a>(<span class="keyword">const</span> <span class="keywordtype">char</span> *<a class="code" href="namespacefile.html">file</a>)</div><div class="line"><a name="l04823"></a><span class="lineno"> 4823</span>&#160;{</div><div class="line"><a name="l04824"></a><span class="lineno"> 4824</span>&#160;   <a class="code" href="XrdProofdTrace_8h.html#a7c31822912a8d0dc9bfd544097b29e12">XPDLOC</a>(SMGR, <span class="stringliteral">&quot;SessionInfo::SaveToFile&quot;</span>)</div><div class="line"><a name="l04825"></a><span class="lineno"> 4825</span>&#160;</div><div class="line"><a name="l04826"></a><span class="lineno"> 4826</span>&#160;   <span class="comment">// Check inputs</span></div><div class="line"><a name="l04827"></a><span class="lineno"> 4827</span>&#160;   <span class="keywordflow">if</span> (!<a class="code" href="namespacefile.html">file</a> || strlen(<a class="code" href="namespacefile.html">file</a>) &lt;= 0) {</div><div class="line"><a name="l04828"></a><span class="lineno"> 4828</span>&#160;      <a class="code" href="TGHtml_8h.html#ad5bb4a3d12fd54f29da2b924b29e652b">TRACE</a>(XERR,<span class="stringliteral">&quot;invalid input: &quot;</span>&lt;&lt; (<a class="code" href="namespacefile.html">file</a> ? <a class="code" href="namespacefile.html">file</a> : <span class="stringliteral">&quot;&lt;nul&gt;&quot;</span>));</div><div class="line"><a name="l04829"></a><span class="lineno"> 4829</span>&#160;      <span class="keywordflow">return</span> -1;</div><div class="line"><a name="l04830"></a><span class="lineno"> 4830</span>&#160;   }</div><div class="line"><a name="l04831"></a><span class="lineno"> 4831</span>&#160;   <a class="code" href="TGHtml_8h.html#ad5bb4a3d12fd54f29da2b924b29e652b">TRACE</a>(HDBG,<span class="stringliteral">&quot;session saved to file: &quot;</span>&lt;&lt;<a class="code" href="namespacefile.html">file</a>);</div><div class="line"><a name="l04832"></a><span class="lineno"> 4832</span>&#160;</div><div class="line"><a name="l04833"></a><span class="lineno"> 4833</span>&#160;   <span class="comment">// Create the file</span></div><div class="line"><a name="l04834"></a><span class="lineno"> 4834</span>&#160;   FILE *fpid = fopen(<a class="code" href="namespacefile.html">file</a>, <span class="stringliteral">&quot;w&quot;</span>);</div><div class="line"><a name="l04835"></a><span class="lineno"> 4835</span>&#160;   <span class="keywordflow">if</span> (fpid) {</div><div class="line"><a name="l04836"></a><span class="lineno"> 4836</span>&#160;      fprintf(fpid, <span class="stringliteral">&quot;%s %s\n&quot;</span>, <a class="code" href="classXrdProofSessionInfo.html#a54094db8d9c75cbd7822532d026ebc61">fUser</a>.c_str(), <a class="code" href="classXrdProofSessionInfo.html#a535c612dd0e50fd92671e630e59e64df">fGroup</a>.c_str());</div><div class="line"><a name="l04837"></a><span class="lineno"> 4837</span>&#160;      fprintf(fpid, <span class="stringliteral">&quot;%s\n&quot;</span>, <a class="code" href="classXrdProofSessionInfo.html#ac78bc3dfceb59dba00cc3ceed97ce1ed">fUnixPath</a>.c_str());</div><div class="line"><a name="l04838"></a><span class="lineno"> 4838</span>&#160;      fprintf(fpid, <span class="stringliteral">&quot;%d %d %d %d\n&quot;</span>, <a class="code" href="classXrdProofSessionInfo.html#ae6ed70e85425161698b98ea8b38ce41f">fPid</a>, <a class="code" href="classXrdProofSessionInfo.html#a78d843cbc3b32c1e19250359ef46b35f">fID</a>, <a class="code" href="classXrdProofSessionInfo.html#a5cafed559ea3c880d42d364a8d8e5d95">fSrvType</a>, <a class="code" href="classXrdProofSessionInfo.html#acc3e0d8bd1c848656ca48e29822f7974">fPLiteNWrks</a>);</div><div class="line"><a name="l04839"></a><span class="lineno"> 4839</span>&#160;      fprintf(fpid, <span class="stringliteral">&quot;%s %s %s\n&quot;</span>, <a class="code" href="classXrdProofSessionInfo.html#a923614a4a79e6a824ea27b3a1cdaad59">fOrdinal</a>.c_str(), <a class="code" href="classXrdProofSessionInfo.html#a518ae82246ac2f8d3db9159f72056411">fTag</a>.c_str(), <a class="code" href="classXrdProofSessionInfo.html#a07eaeda3939341c7c9c34ffbda48b3cd">fAlias</a>.c_str());</div><div class="line"><a name="l04840"></a><span class="lineno"> 4840</span>&#160;      fprintf(fpid, <span class="stringliteral">&quot;%s\n&quot;</span>, <a class="code" href="classXrdProofSessionInfo.html#ad1081533106098435cdc37c6ab670ae3">fLogFile</a>.c_str());</div><div class="line"><a name="l04841"></a><span class="lineno"> 4841</span>&#160;      fprintf(fpid, <span class="stringliteral">&quot;%d %s\n&quot;</span>, <a class="code" href="classXrdProofSessionInfo.html#aff265c0a3cfd2f5c5fdf081a7bc3f067">fSrvProtVers</a>, <a class="code" href="classXrdProofSessionInfo.html#a4b9aa50df5859d41d334e30d2a4f832e">fROOTTag</a>.c_str());</div><div class="line"><a name="l04842"></a><span class="lineno"> 4842</span>&#160;      <span class="keywordflow">if</span> (<a class="code" href="classXrdProofSessionInfo.html#aa7c5425c9469c9ced6f83eedb0bb6a31">fUserEnvs</a>.length() &gt; 0)</div><div class="line"><a name="l04843"></a><span class="lineno"> 4843</span>&#160;         fprintf(fpid, <span class="stringliteral">&quot;\n%s&quot;</span>, <a class="code" href="classXrdProofSessionInfo.html#aa7c5425c9469c9ced6f83eedb0bb6a31">fUserEnvs</a>.c_str());</div><div class="line"><a name="l04844"></a><span class="lineno"> 4844</span>&#160;      fclose(fpid);</div><div class="line"><a name="l04845"></a><span class="lineno"> 4845</span>&#160;</div><div class="line"><a name="l04846"></a><span class="lineno"> 4846</span>&#160;      <span class="comment">// Make it writable by anyone (to allow the corresponding proofserv</span></div><div class="line"><a name="l04847"></a><span class="lineno"> 4847</span>&#160;      <span class="comment">// to touch it for the asynchronous ping request)</span></div><div class="line"><a name="l04848"></a><span class="lineno"> 4848</span>&#160;      <span class="keywordflow">if</span> (chmod(<a class="code" href="namespacefile.html">file</a>, 0666) != 0) {</div><div class="line"><a name="l04849"></a><span class="lineno"> 4849</span>&#160;         <a class="code" href="TGHtml_8h.html#ad5bb4a3d12fd54f29da2b924b29e652b">TRACE</a>(XERR, <span class="stringliteral">&quot;could not change mode to 0666 on file &quot;</span>&lt;&lt;</div><div class="line"><a name="l04850"></a><span class="lineno"> 4850</span>&#160;                     <a class="code" href="namespacefile.html">file</a>&lt;&lt;<span class="stringliteral">&quot;; error: &quot;</span>&lt;&lt;errno);</div><div class="line"><a name="l04851"></a><span class="lineno"> 4851</span>&#160;      }</div><div class="line"><a name="l04852"></a><span class="lineno"> 4852</span>&#160;</div><div class="line"><a name="l04853"></a><span class="lineno"> 4853</span>&#160;      <span class="keywordflow">return</span> 0;</div><div class="line"><a name="l04854"></a><span class="lineno"> 4854</span>&#160;   }</div><div class="line"><a name="l04855"></a><span class="lineno"> 4855</span>&#160;</div><div class="line"><a name="l04856"></a><span class="lineno"> 4856</span>&#160;   <a class="code" href="TGHtml_8h.html#ad5bb4a3d12fd54f29da2b924b29e652b">TRACE</a>(XERR,<span class="stringliteral">&quot;session pid file cannot be (re-)created: &quot;</span>&lt;&lt;</div><div class="line"><a name="l04857"></a><span class="lineno"> 4857</span>&#160;              <a class="code" href="namespacefile.html">file</a>&lt;&lt;<span class="stringliteral">&quot;; error: &quot;</span>&lt;&lt;errno);</div><div class="line"><a name="l04858"></a><span class="lineno"> 4858</span>&#160;   <span class="keywordflow">return</span> -1;</div><div class="line"><a name="l04859"></a><span class="lineno"> 4859</span>&#160;}</div><div class="line"><a name="l04860"></a><span class="lineno"> 4860</span>&#160;<span class="comment"></span></div><div class="line"><a name="l04861"></a><span class="lineno"> 4861</span>&#160;<span class="comment">////////////////////////////////////////////////////////////////////////////////</span></div><div class="line"><a name="l04862"></a><span class="lineno"> 4862</span>&#160;<span class="comment">/// Reset the content</span></div><div class="line"><a name="l04863"></a><span class="lineno"> 4863</span>&#160;<span class="comment"></span></div><div class="line"><a name="l04864"></a><span class="lineno"><a class="line" href="classXrdProofSessionInfo.html#abd08a281fd0a0761e31111b77b6fb6e2"> 4864</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="classXrdProofSessionInfo.html#abd08a281fd0a0761e31111b77b6fb6e2">XrdProofSessionInfo::Reset</a>()</div><div class="line"><a name="l04865"></a><span class="lineno"> 4865</span>&#160;{</div><div class="line"><a name="l04866"></a><span class="lineno"> 4866</span>&#160;   <a class="code" href="classXrdProofSessionInfo.html#ad3e62b6ba7bfe0bdba1bfe9aa5baa2ab">fLastAccess</a> = 0;</div><div class="line"><a name="l04867"></a><span class="lineno"> 4867</span>&#160;   <a class="code" href="classXrdProofSessionInfo.html#a54094db8d9c75cbd7822532d026ebc61">fUser</a> = <span class="stringliteral">&quot;&quot;</span>;</div><div class="line"><a name="l04868"></a><span class="lineno"> 4868</span>&#160;   <a class="code" href="classXrdProofSessionInfo.html#a535c612dd0e50fd92671e630e59e64df">fGroup</a> = <span class="stringliteral">&quot;&quot;</span>;</div><div class="line"><a name="l04869"></a><span class="lineno"> 4869</span>&#160;   <a class="code" href="classXrdProofSessionInfo.html#a7bdc7f6cb43cec3b52c7abab064e0432">fAdminPath</a> = <span class="stringliteral">&quot;&quot;</span>;</div><div class="line"><a name="l04870"></a><span class="lineno"> 4870</span>&#160;   <a class="code" href="classXrdProofSessionInfo.html#ac78bc3dfceb59dba00cc3ceed97ce1ed">fUnixPath</a> = <span class="stringliteral">&quot;&quot;</span>;</div><div class="line"><a name="l04871"></a><span class="lineno"> 4871</span>&#160;   <a class="code" href="classXrdProofSessionInfo.html#ae6ed70e85425161698b98ea8b38ce41f">fPid</a> = -1;</div><div class="line"><a name="l04872"></a><span class="lineno"> 4872</span>&#160;   <a class="code" href="classXrdProofSessionInfo.html#a8e4f80e00d76ce9d2aab4063dd6d85dc">fStatus</a> = <a class="code" href="XProofProtocol_8h.html#a3a4503f87fa152df23df4d274f07b932a83fc8da1cd00c3b598709425884d37fb">kXPD_unknown</a>;</div><div class="line"><a name="l04873"></a><span class="lineno"> 4873</span>&#160;   <a class="code" href="classXrdProofSessionInfo.html#a78d843cbc3b32c1e19250359ef46b35f">fID</a> = -1;</div><div class="line"><a name="l04874"></a><span class="lineno"> 4874</span>&#160;   <a class="code" href="classXrdProofSessionInfo.html#a5cafed559ea3c880d42d364a8d8e5d95">fSrvType</a> = -1;</div><div class="line"><a name="l04875"></a><span class="lineno"> 4875</span>&#160;   <a class="code" href="classXrdProofSessionInfo.html#acc3e0d8bd1c848656ca48e29822f7974">fPLiteNWrks</a> = -1;</div><div class="line"><a name="l04876"></a><span class="lineno"> 4876</span>&#160;   <a class="code" href="classXrdProofSessionInfo.html#a923614a4a79e6a824ea27b3a1cdaad59">fOrdinal</a> = <span class="stringliteral">&quot;&quot;</span>;</div><div class="line"><a name="l04877"></a><span class="lineno"> 4877</span>&#160;   <a class="code" href="classXrdProofSessionInfo.html#a518ae82246ac2f8d3db9159f72056411">fTag</a> = <span class="stringliteral">&quot;&quot;</span>;</div><div class="line"><a name="l04878"></a><span class="lineno"> 4878</span>&#160;   <a class="code" href="classXrdProofSessionInfo.html#a07eaeda3939341c7c9c34ffbda48b3cd">fAlias</a> = <span class="stringliteral">&quot;&quot;</span>;</div><div class="line"><a name="l04879"></a><span class="lineno"> 4879</span>&#160;   <a class="code" href="classXrdProofSessionInfo.html#ad1081533106098435cdc37c6ab670ae3">fLogFile</a> = <span class="stringliteral">&quot;&quot;</span>;</div><div class="line"><a name="l04880"></a><span class="lineno"> 4880</span>&#160;   <a class="code" href="classXrdProofSessionInfo.html#a4b9aa50df5859d41d334e30d2a4f832e">fROOTTag</a> = <span class="stringliteral">&quot;&quot;</span>;</div><div class="line"><a name="l04881"></a><span class="lineno"> 4881</span>&#160;   <a class="code" href="classXrdProofSessionInfo.html#aff265c0a3cfd2f5c5fdf081a7bc3f067">fSrvProtVers</a> = -1;</div><div class="line"><a name="l04882"></a><span class="lineno"> 4882</span>&#160;   <a class="code" href="classXrdProofSessionInfo.html#aa7c5425c9469c9ced6f83eedb0bb6a31">fUserEnvs</a> = <span class="stringliteral">&quot;&quot;</span>;</div><div class="line"><a name="l04883"></a><span class="lineno"> 4883</span>&#160;}</div><div class="line"><a name="l04884"></a><span class="lineno"> 4884</span>&#160;<span class="comment"></span></div><div class="line"><a name="l04885"></a><span class="lineno"> 4885</span>&#160;<span class="comment">////////////////////////////////////////////////////////////////////////////////</span></div><div class="line"><a name="l04886"></a><span class="lineno"> 4886</span>&#160;<span class="comment">/// Read content from &#39;file&#39;</span></div><div class="line"><a name="l04887"></a><span class="lineno"> 4887</span>&#160;<span class="comment"></span></div><div class="line"><a name="l04888"></a><span class="lineno"><a class="line" href="classXrdProofSessionInfo.html#aeae35e545621570f63e10ea17fedbcb9"> 4888</a></span>&#160;<span class="keywordtype">int</span> <a class="code" href="classXrdProofSessionInfo.html#aeae35e545621570f63e10ea17fedbcb9">XrdProofSessionInfo::ReadFromFile</a>(<span class="keyword">const</span> <span class="keywordtype">char</span> *<a class="code" href="namespacefile.html">file</a>)</div><div class="line"><a name="l04889"></a><span class="lineno"> 4889</span>&#160;{</div><div class="line"><a name="l04890"></a><span class="lineno"> 4890</span>&#160;   <a class="code" href="XrdProofdTrace_8h.html#a7c31822912a8d0dc9bfd544097b29e12">XPDLOC</a>(SMGR, <span class="stringliteral">&quot;SessionInfo::ReadFromFile&quot;</span>)</div><div class="line"><a name="l04891"></a><span class="lineno"> 4891</span>&#160;</div><div class="line"><a name="l04892"></a><span class="lineno"> 4892</span>&#160;   <a class="code" href="classXrdProofSessionInfo.html#abd08a281fd0a0761e31111b77b6fb6e2">Reset</a>();</div><div class="line"><a name="l04893"></a><span class="lineno"> 4893</span>&#160;</div><div class="line"><a name="l04894"></a><span class="lineno"> 4894</span>&#160;   <span class="comment">// Check inputs</span></div><div class="line"><a name="l04895"></a><span class="lineno"> 4895</span>&#160;   <span class="keywordflow">if</span> (!<a class="code" href="namespacefile.html">file</a> || strlen(<a class="code" href="namespacefile.html">file</a>) &lt;= 0) {</div><div class="line"><a name="l04896"></a><span class="lineno"> 4896</span>&#160;      <a class="code" href="TGHtml_8h.html#ad5bb4a3d12fd54f29da2b924b29e652b">TRACE</a>(XERR,<span class="stringliteral">&quot;invalid input: &quot;</span>&lt;&lt;(<a class="code" href="namespacefile.html">file</a> ? <a class="code" href="namespacefile.html">file</a> : <span class="stringliteral">&quot;&lt;nul&gt;&quot;</span>));</div><div class="line"><a name="l04897"></a><span class="lineno"> 4897</span>&#160;      <span class="keywordflow">return</span> -1;</div><div class="line"><a name="l04898"></a><span class="lineno"> 4898</span>&#160;   }</div><div class="line"><a name="l04899"></a><span class="lineno"> 4899</span>&#160;</div><div class="line"><a name="l04900"></a><span class="lineno"> 4900</span>&#160;   <span class="comment">// Open the session file</span></div><div class="line"><a name="l04901"></a><span class="lineno"> 4901</span>&#160;   FILE *fpid = fopen(<a class="code" href="namespacefile.html">file</a>,<span class="stringliteral">&quot;r&quot;</span>);</div><div class="line"><a name="l04902"></a><span class="lineno"> 4902</span>&#160;   <span class="keywordflow">if</span> (fpid) {</div><div class="line"><a name="l04903"></a><span class="lineno"> 4903</span>&#160;      <span class="keywordtype">char</span> <a class="code" href="entrylistblock__figure1_8C.html#a4fa05b1f00fcde100685cc887554b93b">line</a>[4096];</div><div class="line"><a name="l04904"></a><span class="lineno"> 4904</span>&#160;      XrdOucString sline, t;</div><div class="line"><a name="l04905"></a><span class="lineno"> 4905</span>&#160;      <span class="keywordtype">int</span> from  = 0;</div><div class="line"><a name="l04906"></a><span class="lineno"> 4906</span>&#160;      <span class="keywordflow">if</span> (fgets(<a class="code" href="entrylistblock__figure1_8C.html#a4fa05b1f00fcde100685cc887554b93b">line</a>, <span class="keyword">sizeof</span>(<a class="code" href="entrylistblock__figure1_8C.html#a4fa05b1f00fcde100685cc887554b93b">line</a>), fpid)) {</div><div class="line"><a name="l04907"></a><span class="lineno"> 4907</span>&#160;         <span class="keywordflow">if</span> (<a class="code" href="entrylistblock__figure1_8C.html#a4fa05b1f00fcde100685cc887554b93b">line</a>[strlen(<a class="code" href="entrylistblock__figure1_8C.html#a4fa05b1f00fcde100685cc887554b93b">line</a>)-1] == <span class="charliteral">&#39;\n&#39;</span>) <a class="code" href="entrylistblock__figure1_8C.html#a4fa05b1f00fcde100685cc887554b93b">line</a>[strlen(<a class="code" href="entrylistblock__figure1_8C.html#a4fa05b1f00fcde100685cc887554b93b">line</a>)-1] = <span class="charliteral">&#39;\0&#39;</span>;</div><div class="line"><a name="l04908"></a><span class="lineno"> 4908</span>&#160;         sline = <a class="code" href="entrylistblock__figure1_8C.html#a4fa05b1f00fcde100685cc887554b93b">line</a>;</div><div class="line"><a name="l04909"></a><span class="lineno"> 4909</span>&#160;         <span class="keywordflow">if</span> ((from = sline.tokenize(<a class="code" href="classXrdProofSessionInfo.html#a54094db8d9c75cbd7822532d026ebc61">fUser</a>, from, <span class="charliteral">&#39; &#39;</span>)) == -1)</div><div class="line"><a name="l04910"></a><span class="lineno"> 4910</span>&#160;            <a class="code" href="TGHtml_8h.html#ad5bb4a3d12fd54f29da2b924b29e652b">TRACE</a>(XERR,<span class="stringliteral">&quot;warning: fUser: corrupted line? &quot;</span>&lt;&lt;<a class="code" href="entrylistblock__figure1_8C.html#a4fa05b1f00fcde100685cc887554b93b">line</a>&lt;&lt;<span class="stringliteral">&quot; (file: &quot;</span>&lt;&lt;<a class="code" href="namespacefile.html">file</a>&lt;&lt;<span class="stringliteral">&quot;)&quot;</span>);</div><div class="line"><a name="l04911"></a><span class="lineno"> 4911</span>&#160;         <span class="keywordflow">if</span> ((from = sline.tokenize(<a class="code" href="classXrdProofSessionInfo.html#a535c612dd0e50fd92671e630e59e64df">fGroup</a>, from, <span class="charliteral">&#39; &#39;</span>)) == -1)</div><div class="line"><a name="l04912"></a><span class="lineno"> 4912</span>&#160;            <a class="code" href="TGHtml_8h.html#ad5bb4a3d12fd54f29da2b924b29e652b">TRACE</a>(XERR,<span class="stringliteral">&quot;warning: fGroup: corrupted line? &quot;</span>&lt;&lt;<a class="code" href="entrylistblock__figure1_8C.html#a4fa05b1f00fcde100685cc887554b93b">line</a>&lt;&lt;<span class="stringliteral">&quot; (file: &quot;</span>&lt;&lt;<a class="code" href="namespacefile.html">file</a>&lt;&lt;<span class="stringliteral">&quot;)&quot;</span>);</div><div class="line"><a name="l04913"></a><span class="lineno"> 4913</span>&#160;      }</div><div class="line"><a name="l04914"></a><span class="lineno"> 4914</span>&#160;      <span class="keywordflow">if</span> (fgets(<a class="code" href="entrylistblock__figure1_8C.html#a4fa05b1f00fcde100685cc887554b93b">line</a>, <span class="keyword">sizeof</span>(<a class="code" href="entrylistblock__figure1_8C.html#a4fa05b1f00fcde100685cc887554b93b">line</a>), fpid)) {</div><div class="line"><a name="l04915"></a><span class="lineno"> 4915</span>&#160;         <span class="keywordflow">if</span> (<a class="code" href="entrylistblock__figure1_8C.html#a4fa05b1f00fcde100685cc887554b93b">line</a>[strlen(<a class="code" href="entrylistblock__figure1_8C.html#a4fa05b1f00fcde100685cc887554b93b">line</a>)-1] == <span class="charliteral">&#39;\n&#39;</span>) <a class="code" href="entrylistblock__figure1_8C.html#a4fa05b1f00fcde100685cc887554b93b">line</a>[strlen(<a class="code" href="entrylistblock__figure1_8C.html#a4fa05b1f00fcde100685cc887554b93b">line</a>)-1] = <span class="charliteral">&#39;\0&#39;</span>;</div><div class="line"><a name="l04916"></a><span class="lineno"> 4916</span>&#160;         <a class="code" href="classXrdProofSessionInfo.html#ac78bc3dfceb59dba00cc3ceed97ce1ed">fUnixPath</a> = <a class="code" href="entrylistblock__figure1_8C.html#a4fa05b1f00fcde100685cc887554b93b">line</a>;</div><div class="line"><a name="l04917"></a><span class="lineno"> 4917</span>&#160;      }</div><div class="line"><a name="l04918"></a><span class="lineno"> 4918</span>&#160;      <span class="keywordflow">if</span> (fgets(<a class="code" href="entrylistblock__figure1_8C.html#a4fa05b1f00fcde100685cc887554b93b">line</a>, <span class="keyword">sizeof</span>(<a class="code" href="entrylistblock__figure1_8C.html#a4fa05b1f00fcde100685cc887554b93b">line</a>), fpid)) {</div><div class="line"><a name="l04919"></a><span class="lineno"> 4919</span>&#160;         <span class="keywordflow">if</span> (<a class="code" href="entrylistblock__figure1_8C.html#a4fa05b1f00fcde100685cc887554b93b">line</a>[strlen(<a class="code" href="entrylistblock__figure1_8C.html#a4fa05b1f00fcde100685cc887554b93b">line</a>)-1] == <span class="charliteral">&#39;\n&#39;</span>) <a class="code" href="entrylistblock__figure1_8C.html#a4fa05b1f00fcde100685cc887554b93b">line</a>[strlen(<a class="code" href="entrylistblock__figure1_8C.html#a4fa05b1f00fcde100685cc887554b93b">line</a>)-1] = <span class="charliteral">&#39;\0&#39;</span>;</div><div class="line"><a name="l04920"></a><span class="lineno"> 4920</span>&#160;         sline = <a class="code" href="entrylistblock__figure1_8C.html#a4fa05b1f00fcde100685cc887554b93b">line</a>;</div><div class="line"><a name="l04921"></a><span class="lineno"> 4921</span>&#160;         from = 0;</div><div class="line"><a name="l04922"></a><span class="lineno"> 4922</span>&#160;         <span class="keywordflow">if</span> ((from = sline.tokenize(t, from, <span class="charliteral">&#39; &#39;</span>)) == -1)</div><div class="line"><a name="l04923"></a><span class="lineno"> 4923</span>&#160;            <a class="code" href="TGHtml_8h.html#ad5bb4a3d12fd54f29da2b924b29e652b">TRACE</a>(XERR,<span class="stringliteral">&quot;warning: fPid: corrupted line? &quot;</span>&lt;&lt;<a class="code" href="entrylistblock__figure1_8C.html#a4fa05b1f00fcde100685cc887554b93b">line</a>&lt;&lt;<span class="stringliteral">&quot; (file: &quot;</span>&lt;&lt;<a class="code" href="namespacefile.html">file</a>&lt;&lt;<span class="stringliteral">&quot;)&quot;</span>);</div><div class="line"><a name="l04924"></a><span class="lineno"> 4924</span>&#160;         <a class="code" href="classXrdProofSessionInfo.html#ae6ed70e85425161698b98ea8b38ce41f">fPid</a> = t.atoi();</div><div class="line"><a name="l04925"></a><span class="lineno"> 4925</span>&#160;         <span class="keywordflow">if</span> ((from = sline.tokenize(t, from, <span class="charliteral">&#39; &#39;</span>)) == -1)</div><div class="line"><a name="l04926"></a><span class="lineno"> 4926</span>&#160;            <a class="code" href="TGHtml_8h.html#ad5bb4a3d12fd54f29da2b924b29e652b">TRACE</a>(XERR,<span class="stringliteral">&quot;warning: fID: corrupted line? &quot;</span>&lt;&lt;<a class="code" href="entrylistblock__figure1_8C.html#a4fa05b1f00fcde100685cc887554b93b">line</a>&lt;&lt;<span class="stringliteral">&quot; (file: &quot;</span>&lt;&lt;<a class="code" href="namespacefile.html">file</a>&lt;&lt;<span class="stringliteral">&quot;)&quot;</span>);</div><div class="line"><a name="l04927"></a><span class="lineno"> 4927</span>&#160;         <a class="code" href="classXrdProofSessionInfo.html#a78d843cbc3b32c1e19250359ef46b35f">fID</a> = t.atoi();</div><div class="line"><a name="l04928"></a><span class="lineno"> 4928</span>&#160;         <span class="keywordflow">if</span> ((from = sline.tokenize(t, from, <span class="charliteral">&#39; &#39;</span>)) == -1)</div><div class="line"><a name="l04929"></a><span class="lineno"> 4929</span>&#160;            <a class="code" href="TGHtml_8h.html#ad5bb4a3d12fd54f29da2b924b29e652b">TRACE</a>(XERR,<span class="stringliteral">&quot;warning: fSrvType: corrupted line? &quot;</span>&lt;&lt;<a class="code" href="entrylistblock__figure1_8C.html#a4fa05b1f00fcde100685cc887554b93b">line</a>&lt;&lt;<span class="stringliteral">&quot; (file: &quot;</span>&lt;&lt;<a class="code" href="namespacefile.html">file</a>&lt;&lt;<span class="stringliteral">&quot;)&quot;</span>);</div><div class="line"><a name="l04930"></a><span class="lineno"> 4930</span>&#160;         <a class="code" href="classXrdProofSessionInfo.html#a5cafed559ea3c880d42d364a8d8e5d95">fSrvType</a> = t.atoi();</div><div class="line"><a name="l04931"></a><span class="lineno"> 4931</span>&#160;      }</div><div class="line"><a name="l04932"></a><span class="lineno"> 4932</span>&#160;      <span class="keywordflow">if</span> (fgets(<a class="code" href="entrylistblock__figure1_8C.html#a4fa05b1f00fcde100685cc887554b93b">line</a>, <span class="keyword">sizeof</span>(<a class="code" href="entrylistblock__figure1_8C.html#a4fa05b1f00fcde100685cc887554b93b">line</a>), fpid)) {</div><div class="line"><a name="l04933"></a><span class="lineno"> 4933</span>&#160;         <span class="keywordflow">if</span> (<a class="code" href="entrylistblock__figure1_8C.html#a4fa05b1f00fcde100685cc887554b93b">line</a>[strlen(<a class="code" href="entrylistblock__figure1_8C.html#a4fa05b1f00fcde100685cc887554b93b">line</a>)-1] == <span class="charliteral">&#39;\n&#39;</span>) <a class="code" href="entrylistblock__figure1_8C.html#a4fa05b1f00fcde100685cc887554b93b">line</a>[strlen(<a class="code" href="entrylistblock__figure1_8C.html#a4fa05b1f00fcde100685cc887554b93b">line</a>)-1] = <span class="charliteral">&#39;\0&#39;</span>;</div><div class="line"><a name="l04934"></a><span class="lineno"> 4934</span>&#160;         sline = <a class="code" href="entrylistblock__figure1_8C.html#a4fa05b1f00fcde100685cc887554b93b">line</a>;</div><div class="line"><a name="l04935"></a><span class="lineno"> 4935</span>&#160;         from = 0;</div><div class="line"><a name="l04936"></a><span class="lineno"> 4936</span>&#160;         <span class="keywordflow">if</span> ((from = sline.tokenize(<a class="code" href="classXrdProofSessionInfo.html#a923614a4a79e6a824ea27b3a1cdaad59">fOrdinal</a>, from, <span class="charliteral">&#39; &#39;</span>)) == -1)</div><div class="line"><a name="l04937"></a><span class="lineno"> 4937</span>&#160;            <a class="code" href="TGHtml_8h.html#ad5bb4a3d12fd54f29da2b924b29e652b">TRACE</a>(XERR,<span class="stringliteral">&quot;warning: fOrdinal: corrupted line? &quot;</span>&lt;&lt;<a class="code" href="entrylistblock__figure1_8C.html#a4fa05b1f00fcde100685cc887554b93b">line</a>&lt;&lt;<span class="stringliteral">&quot; (file: &quot;</span>&lt;&lt;<a class="code" href="namespacefile.html">file</a>&lt;&lt;<span class="stringliteral">&quot;)&quot;</span>);</div><div class="line"><a name="l04938"></a><span class="lineno"> 4938</span>&#160;         <span class="keywordflow">if</span> ((from = sline.tokenize(<a class="code" href="classXrdProofSessionInfo.html#a518ae82246ac2f8d3db9159f72056411">fTag</a>, from, <span class="charliteral">&#39; &#39;</span>)) == -1)</div><div class="line"><a name="l04939"></a><span class="lineno"> 4939</span>&#160;            <a class="code" href="TGHtml_8h.html#ad5bb4a3d12fd54f29da2b924b29e652b">TRACE</a>(XERR,<span class="stringliteral">&quot;warning: fTag: corrupted line? &quot;</span>&lt;&lt;<a class="code" href="entrylistblock__figure1_8C.html#a4fa05b1f00fcde100685cc887554b93b">line</a>&lt;&lt;<span class="stringliteral">&quot; (file: &quot;</span>&lt;&lt;<a class="code" href="namespacefile.html">file</a>&lt;&lt;<span class="stringliteral">&quot;)&quot;</span>);</div><div class="line"><a name="l04940"></a><span class="lineno"> 4940</span>&#160;         <span class="keywordflow">if</span> ((from = sline.tokenize(<a class="code" href="classXrdProofSessionInfo.html#a07eaeda3939341c7c9c34ffbda48b3cd">fAlias</a>, from, <span class="charliteral">&#39; &#39;</span>)) == -1)</div><div class="line"><a name="l04941"></a><span class="lineno"> 4941</span>&#160;            <a class="code" href="TGHtml_8h.html#ad5bb4a3d12fd54f29da2b924b29e652b">TRACE</a>(HDBG,<span class="stringliteral">&quot;fAlias undefined &quot;</span>&lt;&lt;<a class="code" href="entrylistblock__figure1_8C.html#a4fa05b1f00fcde100685cc887554b93b">line</a>);</div><div class="line"><a name="l04942"></a><span class="lineno"> 4942</span>&#160;      }</div><div class="line"><a name="l04943"></a><span class="lineno"> 4943</span>&#160;      <span class="keywordflow">if</span> (fgets(<a class="code" href="entrylistblock__figure1_8C.html#a4fa05b1f00fcde100685cc887554b93b">line</a>, <span class="keyword">sizeof</span>(<a class="code" href="entrylistblock__figure1_8C.html#a4fa05b1f00fcde100685cc887554b93b">line</a>), fpid)) {</div><div class="line"><a name="l04944"></a><span class="lineno"> 4944</span>&#160;         <span class="keywordflow">if</span> (<a class="code" href="entrylistblock__figure1_8C.html#a4fa05b1f00fcde100685cc887554b93b">line</a>[strlen(<a class="code" href="entrylistblock__figure1_8C.html#a4fa05b1f00fcde100685cc887554b93b">line</a>)-1] == <span class="charliteral">&#39;\n&#39;</span>) <a class="code" href="entrylistblock__figure1_8C.html#a4fa05b1f00fcde100685cc887554b93b">line</a>[strlen(<a class="code" href="entrylistblock__figure1_8C.html#a4fa05b1f00fcde100685cc887554b93b">line</a>)-1] = <span class="charliteral">&#39;\0&#39;</span>;</div><div class="line"><a name="l04945"></a><span class="lineno"> 4945</span>&#160;         <a class="code" href="classXrdProofSessionInfo.html#ad1081533106098435cdc37c6ab670ae3">fLogFile</a> = <a class="code" href="entrylistblock__figure1_8C.html#a4fa05b1f00fcde100685cc887554b93b">line</a>;</div><div class="line"><a name="l04946"></a><span class="lineno"> 4946</span>&#160;      }</div><div class="line"><a name="l04947"></a><span class="lineno"> 4947</span>&#160;      <span class="keywordflow">if</span> (fgets(<a class="code" href="entrylistblock__figure1_8C.html#a4fa05b1f00fcde100685cc887554b93b">line</a>, <span class="keyword">sizeof</span>(<a class="code" href="entrylistblock__figure1_8C.html#a4fa05b1f00fcde100685cc887554b93b">line</a>), fpid)) {</div><div class="line"><a name="l04948"></a><span class="lineno"> 4948</span>&#160;         <span class="keywordflow">if</span> (<a class="code" href="entrylistblock__figure1_8C.html#a4fa05b1f00fcde100685cc887554b93b">line</a>[strlen(<a class="code" href="entrylistblock__figure1_8C.html#a4fa05b1f00fcde100685cc887554b93b">line</a>)-1] == <span class="charliteral">&#39;\n&#39;</span>) <a class="code" href="entrylistblock__figure1_8C.html#a4fa05b1f00fcde100685cc887554b93b">line</a>[strlen(<a class="code" href="entrylistblock__figure1_8C.html#a4fa05b1f00fcde100685cc887554b93b">line</a>)-1] = <span class="charliteral">&#39;\0&#39;</span>;</div><div class="line"><a name="l04949"></a><span class="lineno"> 4949</span>&#160;         sline = <a class="code" href="entrylistblock__figure1_8C.html#a4fa05b1f00fcde100685cc887554b93b">line</a>;</div><div class="line"><a name="l04950"></a><span class="lineno"> 4950</span>&#160;         from = 0;</div><div class="line"><a name="l04951"></a><span class="lineno"> 4951</span>&#160;         <span class="keywordflow">if</span> ((from = sline.tokenize(t, from, <span class="charliteral">&#39; &#39;</span>)) == -1)</div><div class="line"><a name="l04952"></a><span class="lineno"> 4952</span>&#160;            <a class="code" href="TGHtml_8h.html#ad5bb4a3d12fd54f29da2b924b29e652b">TRACE</a>(XERR,<span class="stringliteral">&quot;warning: fSrvProtVers: corrupted line? &quot;</span>&lt;&lt;<a class="code" href="entrylistblock__figure1_8C.html#a4fa05b1f00fcde100685cc887554b93b">line</a>&lt;&lt;<span class="stringliteral">&quot; (file: &quot;</span>&lt;&lt;<a class="code" href="namespacefile.html">file</a>&lt;&lt;<span class="stringliteral">&quot;)&quot;</span>);</div><div class="line"><a name="l04953"></a><span class="lineno"> 4953</span>&#160;         <a class="code" href="classXrdProofSessionInfo.html#aff265c0a3cfd2f5c5fdf081a7bc3f067">fSrvProtVers</a> = t.atoi();</div><div class="line"><a name="l04954"></a><span class="lineno"> 4954</span>&#160;         <span class="keywordflow">if</span> ((from = sline.tokenize(<a class="code" href="classXrdProofSessionInfo.html#a4b9aa50df5859d41d334e30d2a4f832e">fROOTTag</a>, from, <span class="charliteral">&#39; &#39;</span>)) == -1)</div><div class="line"><a name="l04955"></a><span class="lineno"> 4955</span>&#160;            <a class="code" href="TGHtml_8h.html#ad5bb4a3d12fd54f29da2b924b29e652b">TRACE</a>(XERR,<span class="stringliteral">&quot;warning: fROOTTag: corrupted line? &quot;</span>&lt;&lt;<a class="code" href="entrylistblock__figure1_8C.html#a4fa05b1f00fcde100685cc887554b93b">line</a>&lt;&lt;<span class="stringliteral">&quot; (file: &quot;</span>&lt;&lt;<a class="code" href="namespacefile.html">file</a>&lt;&lt;<span class="stringliteral">&quot;)&quot;</span>);</div><div class="line"><a name="l04956"></a><span class="lineno"> 4956</span>&#160;      }</div><div class="line"><a name="l04957"></a><span class="lineno"> 4957</span>&#160;      <span class="comment">// All the remaining into fUserEnvs</span></div><div class="line"><a name="l04958"></a><span class="lineno"> 4958</span>&#160;      <a class="code" href="classXrdProofSessionInfo.html#aa7c5425c9469c9ced6f83eedb0bb6a31">fUserEnvs</a> = <span class="stringliteral">&quot;&quot;</span>;</div><div class="line"><a name="l04959"></a><span class="lineno"> 4959</span>&#160;      off_t lnow = lseek(fileno(fpid), (off_t) 0, SEEK_CUR);</div><div class="line"><a name="l04960"></a><span class="lineno"> 4960</span>&#160;      off_t ltot = lseek(fileno(fpid), (off_t) 0, SEEK_END);</div><div class="line"><a name="l04961"></a><span class="lineno"> 4961</span>&#160;      <span class="keywordtype">int</span> left = (int)(ltot - lnow);</div><div class="line"><a name="l04962"></a><span class="lineno"> 4962</span>&#160;      <span class="keywordtype">int</span> len = -1;</div><div class="line"><a name="l04963"></a><span class="lineno"> 4963</span>&#160;      <span class="keywordflow">do</span> {</div><div class="line"><a name="l04964"></a><span class="lineno"> 4964</span>&#160;         <span class="keywordtype">int</span> wanted = (left &gt; 4095) ? 4095 : left;</div><div class="line"><a name="l04965"></a><span class="lineno"> 4965</span>&#160;         <span class="keywordflow">while</span> ((len = read(fileno(fpid), <a class="code" href="entrylistblock__figure1_8C.html#a4fa05b1f00fcde100685cc887554b93b">line</a>, wanted)) &lt; 0 &amp;&amp;</div><div class="line"><a name="l04966"></a><span class="lineno"> 4966</span>&#160;                errno == EINTR)</div><div class="line"><a name="l04967"></a><span class="lineno"> 4967</span>&#160;            errno = 0;</div><div class="line"><a name="l04968"></a><span class="lineno"> 4968</span>&#160;         <span class="keywordflow">if</span> (len &lt; 0 || len &lt; wanted) {</div><div class="line"><a name="l04969"></a><span class="lineno"> 4969</span>&#160;            <span class="keywordflow">break</span>;</div><div class="line"><a name="l04970"></a><span class="lineno"> 4970</span>&#160;         } <span class="keywordflow">else</span> {</div><div class="line"><a name="l04971"></a><span class="lineno"> 4971</span>&#160;            <a class="code" href="entrylistblock__figure1_8C.html#a4fa05b1f00fcde100685cc887554b93b">line</a>[len] = <span class="charliteral">&#39;\0&#39;</span>;</div><div class="line"><a name="l04972"></a><span class="lineno"> 4972</span>&#160;            <a class="code" href="classXrdProofSessionInfo.html#aa7c5425c9469c9ced6f83eedb0bb6a31">fUserEnvs</a> += <a class="code" href="entrylistblock__figure1_8C.html#a4fa05b1f00fcde100685cc887554b93b">line</a>;</div><div class="line"><a name="l04973"></a><span class="lineno"> 4973</span>&#160;         }</div><div class="line"><a name="l04974"></a><span class="lineno"> 4974</span>&#160;         <span class="comment">// Update counters</span></div><div class="line"><a name="l04975"></a><span class="lineno"> 4975</span>&#160;         left -= len;</div><div class="line"><a name="l04976"></a><span class="lineno"> 4976</span>&#160;      } <span class="keywordflow">while</span> (len &gt; 0 &amp;&amp; left &gt; 0);</div><div class="line"><a name="l04977"></a><span class="lineno"> 4977</span>&#160;      <span class="comment">// Done</span></div><div class="line"><a name="l04978"></a><span class="lineno"> 4978</span>&#160;      fclose(fpid);</div><div class="line"><a name="l04979"></a><span class="lineno"> 4979</span>&#160;      <span class="comment">// The file name is the admin path</span></div><div class="line"><a name="l04980"></a><span class="lineno"> 4980</span>&#160;      <a class="code" href="classXrdProofSessionInfo.html#a7bdc7f6cb43cec3b52c7abab064e0432">fAdminPath</a> = <a class="code" href="namespacefile.html">file</a>;</div><div class="line"><a name="l04981"></a><span class="lineno"> 4981</span>&#160;      <span class="comment">// Fill access time</span></div><div class="line"><a name="l04982"></a><span class="lineno"> 4982</span>&#160;      <span class="keyword">struct </span>stat st;</div><div class="line"><a name="l04983"></a><span class="lineno"> 4983</span>&#160;      <span class="keywordflow">if</span> (!stat(<a class="code" href="namespacefile.html">file</a>, &amp;st))</div><div class="line"><a name="l04984"></a><span class="lineno"> 4984</span>&#160;         <a class="code" href="classXrdProofSessionInfo.html#ad3e62b6ba7bfe0bdba1bfe9aa5baa2ab">fLastAccess</a> = st.st_atime;</div><div class="line"><a name="l04985"></a><span class="lineno"> 4985</span>&#160;   } <span class="keywordflow">else</span> {</div><div class="line"><a name="l04986"></a><span class="lineno"> 4986</span>&#160;      <a class="code" href="TGHtml_8h.html#ad5bb4a3d12fd54f29da2b924b29e652b">TRACE</a>(XERR,<span class="stringliteral">&quot;session file cannot be open: &quot;</span>&lt;&lt; <a class="code" href="namespacefile.html">file</a>&lt;&lt;<span class="stringliteral">&quot;; error: &quot;</span>&lt;&lt;errno);</div><div class="line"><a name="l04987"></a><span class="lineno"> 4987</span>&#160;      <span class="keywordflow">return</span> -1;</div><div class="line"><a name="l04988"></a><span class="lineno"> 4988</span>&#160;   }</div><div class="line"><a name="l04989"></a><span class="lineno"> 4989</span>&#160;</div><div class="line"><a name="l04990"></a><span class="lineno"> 4990</span>&#160;   <span class="comment">// Read the last status now if the session is active</span></div><div class="line"><a name="l04991"></a><span class="lineno"> 4991</span>&#160;   XrdOucString fs(<a class="code" href="namespacefile.html">file</a>);</div><div class="line"><a name="l04992"></a><span class="lineno"> 4992</span>&#160;   fs += <span class="stringliteral">&quot;.status&quot;</span>;</div><div class="line"><a name="l04993"></a><span class="lineno"> 4993</span>&#160;   fpid = fopen(fs.c_str(),<span class="stringliteral">&quot;r&quot;</span>);</div><div class="line"><a name="l04994"></a><span class="lineno"> 4994</span>&#160;   <span class="keywordflow">if</span> (fpid) {</div><div class="line"><a name="l04995"></a><span class="lineno"> 4995</span>&#160;      <span class="keywordtype">char</span> <a class="code" href="entrylistblock__figure1_8C.html#a4fa05b1f00fcde100685cc887554b93b">line</a>[64];</div><div class="line"><a name="l04996"></a><span class="lineno"> 4996</span>&#160;      <span class="keywordflow">if</span> (fgets(<a class="code" href="entrylistblock__figure1_8C.html#a4fa05b1f00fcde100685cc887554b93b">line</a>, <span class="keyword">sizeof</span>(<a class="code" href="entrylistblock__figure1_8C.html#a4fa05b1f00fcde100685cc887554b93b">line</a>), fpid)) {</div><div class="line"><a name="l04997"></a><span class="lineno"> 4997</span>&#160;         <span class="keywordflow">if</span> (<a class="code" href="entrylistblock__figure1_8C.html#a4fa05b1f00fcde100685cc887554b93b">line</a>[strlen(<a class="code" href="entrylistblock__figure1_8C.html#a4fa05b1f00fcde100685cc887554b93b">line</a>)-1] == <span class="charliteral">&#39;\n&#39;</span>) <a class="code" href="entrylistblock__figure1_8C.html#a4fa05b1f00fcde100685cc887554b93b">line</a>[strlen(<a class="code" href="entrylistblock__figure1_8C.html#a4fa05b1f00fcde100685cc887554b93b">line</a>)-1] = 0;</div><div class="line"><a name="l04998"></a><span class="lineno"> 4998</span>&#160;         <a class="code" href="classXrdProofSessionInfo.html#a8e4f80e00d76ce9d2aab4063dd6d85dc">fStatus</a> = atoi(<a class="code" href="entrylistblock__figure1_8C.html#a4fa05b1f00fcde100685cc887554b93b">line</a>);</div><div class="line"><a name="l04999"></a><span class="lineno"> 4999</span>&#160;      }</div><div class="line"><a name="l05000"></a><span class="lineno"> 5000</span>&#160;      <span class="comment">// Done</span></div><div class="line"><a name="l05001"></a><span class="lineno"> 5001</span>&#160;      fclose(fpid);</div><div class="line"><a name="l05002"></a><span class="lineno"> 5002</span>&#160;   } <span class="keywordflow">else</span> {</div><div class="line"><a name="l05003"></a><span class="lineno"> 5003</span>&#160;      <a class="code" href="TGHtml_8h.html#ad5bb4a3d12fd54f29da2b924b29e652b">TRACE</a>(DBG,<span class="stringliteral">&quot;no session status file for: &quot;</span>&lt;&lt; fs&lt;&lt;<span class="stringliteral">&quot;; session was probably terminated&quot;</span>);</div><div class="line"><a name="l05004"></a><span class="lineno"> 5004</span>&#160;   }</div><div class="line"><a name="l05005"></a><span class="lineno"> 5005</span>&#160;</div><div class="line"><a name="l05006"></a><span class="lineno"> 5006</span>&#160;   <span class="comment">// Done</span></div><div class="line"><a name="l05007"></a><span class="lineno"> 5007</span>&#160;   <span class="keywordflow">return</span> 0;</div><div class="line"><a name="l05008"></a><span class="lineno"> 5008</span>&#160;}</div><div class="line"><a name="l05009"></a><span class="lineno"> 5009</span>&#160;<span class="comment"></span></div><div class="line"><a name="l05010"></a><span class="lineno"> 5010</span>&#160;<span class="comment">////////////////////////////////////////////////////////////////////////////////</span></div><div class="line"><a name="l05011"></a><span class="lineno"> 5011</span>&#160;<span class="comment">/// Check if this env applies to &#39;usr&#39;, &#39;grp, &#39;ver&#39;.</span></div><div class="line"><a name="l05012"></a><span class="lineno"> 5012</span>&#160;<span class="comment">/// Returns -1 if it does not match, &gt;=0 if it matches. The value is a linear</span></div><div class="line"><a name="l05013"></a><span class="lineno"> 5013</span>&#160;<span class="comment">/// combination of matching lengths for user and group, with a weight of 1000 for</span></div><div class="line"><a name="l05014"></a><span class="lineno"> 5014</span>&#160;<span class="comment">/// the users one, so that an exact user match will always win.</span></div><div class="line"><a name="l05015"></a><span class="lineno"> 5015</span>&#160;<span class="comment"></span></div><div class="line"><a name="l05016"></a><span class="lineno"><a class="line" href="classXpdEnv.html#a6bc4c90b8cc7074d6a8ee356c5de481d"> 5016</a></span>&#160;<span class="keywordtype">int</span> <a class="code" href="classXpdEnv.html#a6bc4c90b8cc7074d6a8ee356c5de481d">XpdEnv::Matches</a>(<span class="keyword">const</span> <span class="keywordtype">char</span> *usr, <span class="keyword">const</span> <span class="keywordtype">char</span> *grp, <span class="keywordtype">int</span> ver)</div><div class="line"><a name="l05017"></a><span class="lineno"> 5017</span>&#160;{</div><div class="line"><a name="l05018"></a><span class="lineno"> 5018</span>&#160;   <a class="code" href="XrdProofdTrace_8h.html#a7c31822912a8d0dc9bfd544097b29e12">XPDLOC</a>(SMGR, <span class="stringliteral">&quot;XpdEnv::Matches&quot;</span>)</div><div class="line"><a name="l05019"></a><span class="lineno"> 5019</span>&#160;</div><div class="line"><a name="l05020"></a><span class="lineno"> 5020</span>&#160;   <span class="keywordtype">int</span> nmtc = -1;</div><div class="line"><a name="l05021"></a><span class="lineno"> 5021</span>&#160;   <span class="comment">// Check the user</span></div><div class="line"><a name="l05022"></a><span class="lineno"> 5022</span>&#160;   <span class="keywordflow">if</span> (<a class="code" href="classXpdEnv.html#ac35273193628e86f4f3a33060637cfee">fUsers</a>.length() &gt; 0) {</div><div class="line"><a name="l05023"></a><span class="lineno"> 5023</span>&#160;      XrdOucString u(usr);</div><div class="line"><a name="l05024"></a><span class="lineno"> 5024</span>&#160;      <span class="keywordflow">if</span> ((nmtc = u.matches(<a class="code" href="classXpdEnv.html#ac35273193628e86f4f3a33060637cfee">fUsers</a>.c_str())) == 0) <span class="keywordflow">return</span> -1;</div><div class="line"><a name="l05025"></a><span class="lineno"> 5025</span>&#160;   } <span class="keywordflow">else</span> {</div><div class="line"><a name="l05026"></a><span class="lineno"> 5026</span>&#160;      nmtc = strlen(usr);</div><div class="line"><a name="l05027"></a><span class="lineno"> 5027</span>&#160;   }</div><div class="line"><a name="l05028"></a><span class="lineno"> 5028</span>&#160;   nmtc += 1000;   <span class="comment">// Weigth of user name match</span></div><div class="line"><a name="l05029"></a><span class="lineno"> 5029</span>&#160;   <span class="comment">// Check the group</span></div><div class="line"><a name="l05030"></a><span class="lineno"> 5030</span>&#160;   <span class="keywordtype">int</span> nmtcg = -1;</div><div class="line"><a name="l05031"></a><span class="lineno"> 5031</span>&#160;   <span class="keywordflow">if</span> (<a class="code" href="classXpdEnv.html#a0416e242e3af7cd77afe1f8a02a802e7">fGroups</a>.length() &gt; 0) {</div><div class="line"><a name="l05032"></a><span class="lineno"> 5032</span>&#160;      XrdOucString <a class="code" href="RSha256_8hxx.html#a9608045402267746965fa49d90bbada4">g</a>(grp);</div><div class="line"><a name="l05033"></a><span class="lineno"> 5033</span>&#160;      <span class="keywordflow">if</span> ((nmtcg = <a class="code" href="RSha256_8hxx.html#a9608045402267746965fa49d90bbada4">g</a>.matches(<a class="code" href="classXpdEnv.html#a0416e242e3af7cd77afe1f8a02a802e7">fGroups</a>.c_str())) == 0) <span class="keywordflow">return</span> -1;</div><div class="line"><a name="l05034"></a><span class="lineno"> 5034</span>&#160;   } <span class="keywordflow">else</span> {</div><div class="line"><a name="l05035"></a><span class="lineno"> 5035</span>&#160;      nmtcg = strlen(grp);</div><div class="line"><a name="l05036"></a><span class="lineno"> 5036</span>&#160;   }</div><div class="line"><a name="l05037"></a><span class="lineno"> 5037</span>&#160;   nmtc += nmtcg;</div><div class="line"><a name="l05038"></a><span class="lineno"> 5038</span>&#160;</div><div class="line"><a name="l05039"></a><span class="lineno"> 5039</span>&#160;   <a class="code" href="TGHtml_8h.html#ad5bb4a3d12fd54f29da2b924b29e652b">TRACE</a>(HDBG, <a class="code" href="classXpdEnv.html#aff870adeeda5a3260f3b714db0467090">fEnv</a> &lt;&lt;<span class="stringliteral">&quot;, u:&quot;</span>&lt;&lt;usr&lt;&lt;<span class="stringliteral">&quot;, g:&quot;</span>&lt;&lt;grp&lt;&lt;<span class="stringliteral">&quot; --&gt; nmtc: &quot;</span>&lt;&lt;nmtc);</div><div class="line"><a name="l05040"></a><span class="lineno"> 5040</span>&#160;</div><div class="line"><a name="l05041"></a><span class="lineno"> 5041</span>&#160;   <span class="comment">// Check the version code</span></div><div class="line"><a name="l05042"></a><span class="lineno"> 5042</span>&#160;   <a class="code" href="TGHtml_8h.html#ad5bb4a3d12fd54f29da2b924b29e652b">TRACE</a>(HDBG, <a class="code" href="classXpdEnv.html#aff870adeeda5a3260f3b714db0467090">fEnv</a> &lt;&lt;<span class="stringliteral">&quot;, ver:&quot;</span>&lt;&lt;ver);</div><div class="line"><a name="l05043"></a><span class="lineno"> 5043</span>&#160;   <span class="keywordflow">if</span> (<a class="code" href="classXpdEnv.html#a88f25193c975a48136d4ac1ce7251c58">fVerMin</a> &gt; 0 &amp;&amp; ver &lt; <a class="code" href="classXpdEnv.html#a88f25193c975a48136d4ac1ce7251c58">fVerMin</a>) <span class="keywordflow">return</span> -1;</div><div class="line"><a name="l05044"></a><span class="lineno"> 5044</span>&#160;   <span class="keywordflow">if</span> (<a class="code" href="classXpdEnv.html#a29872c9ff063d0322fd6284479a06370">fVerMax</a> &gt; 0 &amp;&amp; ver &gt; <a class="code" href="classXpdEnv.html#a29872c9ff063d0322fd6284479a06370">fVerMax</a>) <span class="keywordflow">return</span> -1;</div><div class="line"><a name="l05045"></a><span class="lineno"> 5045</span>&#160;</div><div class="line"><a name="l05046"></a><span class="lineno"> 5046</span>&#160;   <span class="comment">// If we are here then it matches</span></div><div class="line"><a name="l05047"></a><span class="lineno"> 5047</span>&#160;   <span class="keywordflow">return</span> nmtc;</div><div class="line"><a name="l05048"></a><span class="lineno"> 5048</span>&#160;}</div><div class="line"><a name="l05049"></a><span class="lineno"> 5049</span>&#160;<span class="comment"></span></div><div class="line"><a name="l05050"></a><span class="lineno"> 5050</span>&#160;<span class="comment">////////////////////////////////////////////////////////////////////////////////</span></div><div class="line"><a name="l05051"></a><span class="lineno"> 5051</span>&#160;<span class="comment">/// Transform version number ver (format patch + 100*minor + 10000*maj, e.g. 52706)</span></div><div class="line"><a name="l05052"></a><span class="lineno"> 5052</span>&#160;<span class="comment">/// If &#39;hex&#39; is true, the components are decoded as hex numbers</span></div><div class="line"><a name="l05053"></a><span class="lineno"> 5053</span>&#160;<span class="comment"></span></div><div class="line"><a name="l05054"></a><span class="lineno"><a class="line" href="classXpdEnv.html#ae9c162b3ad476c505b38f4b5e022c953"> 5054</a></span>&#160;<span class="keywordtype">int</span> <a class="code" href="classXpdEnv.html#ae9c162b3ad476c505b38f4b5e022c953">XpdEnv::ToVersCode</a>(<span class="keywordtype">int</span> ver, <span class="keywordtype">bool</span> hex)</div><div class="line"><a name="l05055"></a><span class="lineno"> 5055</span>&#160;{</div><div class="line"><a name="l05056"></a><span class="lineno"> 5056</span>&#160;   <span class="keywordtype">int</span> maj = -1, min = -1, ptc = -1, xv = ver;</div><div class="line"><a name="l05057"></a><span class="lineno"> 5057</span>&#160;   <span class="keywordflow">if</span> (hex) {</div><div class="line"><a name="l05058"></a><span class="lineno"> 5058</span>&#160;      maj = xv / 65536;</div><div class="line"><a name="l05059"></a><span class="lineno"> 5059</span>&#160;      xv -= maj * 65536;</div><div class="line"><a name="l05060"></a><span class="lineno"> 5060</span>&#160;      min = xv / 256;</div><div class="line"><a name="l05061"></a><span class="lineno"> 5061</span>&#160;      ptc = xv - min * 256;</div><div class="line"><a name="l05062"></a><span class="lineno"> 5062</span>&#160;   } <span class="keywordflow">else</span> {</div><div class="line"><a name="l05063"></a><span class="lineno"> 5063</span>&#160;      maj = xv / 10000;</div><div class="line"><a name="l05064"></a><span class="lineno"> 5064</span>&#160;      xv -= maj * 10000;</div><div class="line"><a name="l05065"></a><span class="lineno"> 5065</span>&#160;      min = xv / 100;</div><div class="line"><a name="l05066"></a><span class="lineno"> 5066</span>&#160;      ptc = xv - min * 100;</div><div class="line"><a name="l05067"></a><span class="lineno"> 5067</span>&#160;   }</div><div class="line"><a name="l05068"></a><span class="lineno"> 5068</span>&#160;   <span class="comment">// Get the version code now</span></div><div class="line"><a name="l05069"></a><span class="lineno"> 5069</span>&#160;   <span class="keywordtype">int</span> vc = (maj &lt;&lt; 16) + (min &lt;&lt; 8) + ptc;</div><div class="line"><a name="l05070"></a><span class="lineno"> 5070</span>&#160;   <span class="keywordflow">return</span> vc;</div><div class="line"><a name="l05071"></a><span class="lineno"> 5071</span>&#160;}</div><div class="line"><a name="l05072"></a><span class="lineno"> 5072</span>&#160;<span class="comment"></span></div><div class="line"><a name="l05073"></a><span class="lineno"> 5073</span>&#160;<span class="comment">////////////////////////////////////////////////////////////////////////////////</span></div><div class="line"><a name="l05074"></a><span class="lineno"> 5074</span>&#160;<span class="comment">/// Print the content of this env</span></div><div class="line"><a name="l05075"></a><span class="lineno"> 5075</span>&#160;<span class="comment"></span></div><div class="line"><a name="l05076"></a><span class="lineno"><a class="line" href="classXpdEnv.html#a77a8165dad6c0025fc19f919137b7b2e"> 5076</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="classXpdEnv.html#a77a8165dad6c0025fc19f919137b7b2e">XpdEnv::Print</a>(<span class="keyword">const</span> <span class="keywordtype">char</span> *what)</div><div class="line"><a name="l05077"></a><span class="lineno"> 5077</span>&#160;{</div><div class="line"><a name="l05078"></a><span class="lineno"> 5078</span>&#160;   <a class="code" href="XrdProofdTrace_8h.html#a7c31822912a8d0dc9bfd544097b29e12">XPDLOC</a>(SMGR, what)</div><div class="line"><a name="l05079"></a><span class="lineno"> 5079</span>&#160;</div><div class="line"><a name="l05080"></a><span class="lineno"> 5080</span>&#160;   XrdOucString vmi(<span class="stringliteral">&quot;-1&quot;</span>), vmx(<span class="stringliteral">&quot;-1&quot;</span>);</div><div class="line"><a name="l05081"></a><span class="lineno"> 5081</span>&#160;   <span class="keywordflow">if</span> (<a class="code" href="classXpdEnv.html#a88f25193c975a48136d4ac1ce7251c58">fVerMin</a> &gt; 0) {</div><div class="line"><a name="l05082"></a><span class="lineno"> 5082</span>&#160;      <span class="keywordtype">int</span> maj = (<a class="code" href="classXpdEnv.html#a88f25193c975a48136d4ac1ce7251c58">fVerMin</a> &gt;&gt; 16);</div><div class="line"><a name="l05083"></a><span class="lineno"> 5083</span>&#160;      <span class="keywordtype">int</span> min = ((<a class="code" href="classXpdEnv.html#a88f25193c975a48136d4ac1ce7251c58">fVerMin</a> - maj * 65536) &gt;&gt; 8);</div><div class="line"><a name="l05084"></a><span class="lineno"> 5084</span>&#160;      <span class="keywordtype">int</span> ptc = <a class="code" href="classXpdEnv.html#a88f25193c975a48136d4ac1ce7251c58">fVerMin</a> - maj * 65536 - min * 256;</div><div class="line"><a name="l05085"></a><span class="lineno"> 5085</span>&#160;      <a class="code" href="XrdProofdAux_8h.html#a631cc8787af1a02d9e51c86117ae042e">XPDFORM</a>(vmi, <span class="stringliteral">&quot;%d%d%d&quot;</span>, maj, min, ptc);</div><div class="line"><a name="l05086"></a><span class="lineno"> 5086</span>&#160;   }</div><div class="line"><a name="l05087"></a><span class="lineno"> 5087</span>&#160;   <span class="keywordflow">if</span> (<a class="code" href="classXpdEnv.html#a29872c9ff063d0322fd6284479a06370">fVerMax</a> &gt; 0) {</div><div class="line"><a name="l05088"></a><span class="lineno"> 5088</span>&#160;      <span class="keywordtype">int</span> maj = (<a class="code" href="classXpdEnv.html#a29872c9ff063d0322fd6284479a06370">fVerMax</a> &gt;&gt; 16);</div><div class="line"><a name="l05089"></a><span class="lineno"> 5089</span>&#160;      <span class="keywordtype">int</span> min = ((<a class="code" href="classXpdEnv.html#a29872c9ff063d0322fd6284479a06370">fVerMax</a> - maj * 65536) &gt;&gt; 8);</div><div class="line"><a name="l05090"></a><span class="lineno"> 5090</span>&#160;      <span class="keywordtype">int</span> ptc = <a class="code" href="classXpdEnv.html#a29872c9ff063d0322fd6284479a06370">fVerMax</a> - maj * 65536 - min * 256;</div><div class="line"><a name="l05091"></a><span class="lineno"> 5091</span>&#160;      <a class="code" href="XrdProofdAux_8h.html#a631cc8787af1a02d9e51c86117ae042e">XPDFORM</a>(vmx, <span class="stringliteral">&quot;%d%d%d&quot;</span>, maj, min, ptc);</div><div class="line"><a name="l05092"></a><span class="lineno"> 5092</span>&#160;   }</div><div class="line"><a name="l05093"></a><span class="lineno"> 5093</span>&#160;   XrdOucString u(<span class="stringliteral">&quot;allusers&quot;</span>), <a class="code" href="RSha256_8hxx.html#a9608045402267746965fa49d90bbada4">g</a>(<span class="stringliteral">&quot;allgroups&quot;</span>);</div><div class="line"><a name="l05094"></a><span class="lineno"> 5094</span>&#160;   <span class="keywordflow">if</span> (<a class="code" href="classXpdEnv.html#ac35273193628e86f4f3a33060637cfee">fUsers</a>.length() &gt; 0) u = <a class="code" href="classXpdEnv.html#ac35273193628e86f4f3a33060637cfee">fUsers</a>;</div><div class="line"><a name="l05095"></a><span class="lineno"> 5095</span>&#160;   <span class="keywordflow">if</span> (<a class="code" href="classXpdEnv.html#a0416e242e3af7cd77afe1f8a02a802e7">fGroups</a>.length() &gt; 0) u = <a class="code" href="classXpdEnv.html#a0416e242e3af7cd77afe1f8a02a802e7">fGroups</a>;</div><div class="line"><a name="l05096"></a><span class="lineno"> 5096</span>&#160;</div><div class="line"><a name="l05097"></a><span class="lineno"> 5097</span>&#160;   <a class="code" href="TGHtml_8h.html#ad5bb4a3d12fd54f29da2b924b29e652b">TRACE</a>(ALL, <span class="stringliteral">&quot;&#39;&quot;</span>&lt;&lt;<a class="code" href="classXpdEnv.html#aff870adeeda5a3260f3b714db0467090">fEnv</a>&lt;&lt;<span class="stringliteral">&quot;&#39; {&quot;</span>&lt;&lt;u&lt;&lt;<span class="stringliteral">&quot;|&quot;</span>&lt;&lt;<a class="code" href="RSha256_8hxx.html#a9608045402267746965fa49d90bbada4">g</a>&lt;&lt;</div><div class="line"><a name="l05098"></a><span class="lineno"> 5098</span>&#160;         <span class="stringliteral">&quot;} svn:[&quot;</span>&lt;&lt;<a class="code" href="classXpdEnv.html#a1cf41d0705fab5db572acf6057897002">fSvnMin</a>&lt;&lt;<span class="stringliteral">&quot;,&quot;</span>&lt;&lt;<a class="code" href="classXpdEnv.html#a62c4da6c5964c74a8a5830e21b3dfc1a">fSvnMax</a>&lt;&lt;<span class="stringliteral">&quot;] vers:[&quot;</span>&lt;&lt;vmi&lt;&lt;<span class="stringliteral">&quot;,&quot;</span>&lt;&lt;vmx&lt;&lt;<span class="stringliteral">&quot;]&quot;</span>);</div><div class="line"><a name="l05099"></a><span class="lineno"> 5099</span>&#160;}</div><div class="ttc" id="XrdProofdTrace_8h_html"><div class="ttname"><a href="XrdProofdTrace_8h.html">XrdProofdTrace.h</a></div></div>
<div class="ttc" id="classXrdROOT_html"><div class="ttname"><a href="classXrdROOT.html">XrdROOT</a></div><div class="ttdef"><b>Definition:</b> <a href="XrdROOT_8h_source.html#l00035">XrdROOT.h:35</a></div></div>
<div class="ttc" id="classXrdProofdProofServMgr_html_a534ed8fb5f4032780795115c371945c8"><div class="ttname"><a href="classXrdProofdProofServMgr.html#a534ed8fb5f4032780795115c371945c8">XrdProofdProofServMgr::CreateSockPath</a></div><div class="ttdeci">int CreateSockPath(XrdProofdProofServ *xps, XrdProofdProtocol *p, unsigned int seq, XrdOucString &amp;emsg)</div><div class="ttdoc">Create the socket path for the starting session Return 0 on success, -1 on error (error message in &amp;#39;e...</div><div class="ttdef"><b>Definition:</b> <a href="XrdProofdProofServMgr_8cxx_source.html#l02325">XrdProofdProofServMgr.cxx:2325</a></div></div>
<div class="ttc" id="classXrdProofGroupMgr_html"><div class="ttname"><a href="classXrdProofGroupMgr.html">XrdProofGroupMgr</a></div><div class="ttdef"><b>Definition:</b> <a href="XrdProofGroup_8h_source.html#l00093">XrdProofGroup.h:93</a></div></div>
<div class="ttc" id="classXrdProofdProofServ_html_a99d955e6c5f17b28834e881be71b1f79"><div class="ttname"><a href="classXrdProofdProofServ.html#a99d955e6c5f17b28834e881be71b1f79">XrdProofdProofServ::FreeClientID</a></div><div class="ttdeci">int FreeClientID(int pid)</div><div class="ttdoc">Free instance corresponding to protocol connecting process &amp;#39;pid&amp;#39;. </div><div class="ttdef"><b>Definition:</b> <a href="XrdProofdProofServ_8cxx_source.html#l00331">XrdProofdProofServ.cxx:331</a></div></div>
<div class="ttc" id="classXrdProofdProofServ_html_af3d27e79060c14989be2ee8728ea95cb"><div class="ttname"><a href="classXrdProofdProofServ.html#af3d27e79060c14989be2ee8728ea95cb">XrdProofdProofServ::SetParent</a></div><div class="ttdeci">void SetParent(XrdClientID *cid)</div><div class="ttdef"><b>Definition:</b> <a href="XrdProofdProofServ_8h_source.html#l00174">XrdProofdProofServ.h:174</a></div></div>
<div class="ttc" id="classXrdProofdClient_html_a4f2f5c7fba0cb2b985b58a73d8fd17d1"><div class="ttname"><a href="classXrdProofdClient.html#a4f2f5c7fba0cb2b985b58a73d8fd17d1">XrdProofdClient::Mutex</a></div><div class="ttdeci">XrdSysRecMutex * Mutex() const</div><div class="ttdef"><b>Definition:</b> <a href="XrdProofdClient_8h_source.html#l00055">XrdProofdClient.h:55</a></div></div>
<div class="ttc" id="XProofProtocol_8h_html_af90b47a2dd37c58ac6f67e16c279e27baeac09efa4ebf488eb470242130c87f9f"><div class="ttname"><a href="XProofProtocol_8h.html#af90b47a2dd37c58ac6f67e16c279e27baeac09efa4ebf488eb470242130c87f9f">kXPD_errmsg</a></div><div class="ttdef"><b>Definition:</b> <a href="XProofProtocol_8h_source.html#l00178">XProofProtocol.h:178</a></div></div>
<div class="ttc" id="classXrdProofdSandbox_html_ad067010c4a92eee6dac2aa0dbc679bf4"><div class="ttname"><a href="classXrdProofdSandbox.html#ad067010c4a92eee6dac2aa0dbc679bf4">XrdProofdSandbox::Dir</a></div><div class="ttdeci">const char * Dir() const</div><div class="ttdef"><b>Definition:</b> <a href="XrdProofdSandbox_8h_source.html#l00048">XrdProofdSandbox.h:48</a></div></div>
<div class="ttc" id="classXrdProofdProofServMgr_html_aa5a2736acc4831626327d1c5e37ebf29"><div class="ttname"><a href="classXrdProofdProofServMgr.html#aa5a2736acc4831626327d1c5e37ebf29">XrdProofdProofServMgr::SetupProtocol</a></div><div class="ttdeci">int SetupProtocol(XrdNetPeer &amp;peerpsrv, XrdProofdProofServ *xps, XrdOucString &amp;e)</div><div class="ttdoc">Setup the protocol object serving the peer described by &amp;#39;peerpsrv&amp;#39;. </div><div class="ttdef"><b>Definition:</b> <a href="XrdProofdProofServMgr_8cxx_source.html#l02581">XrdProofdProofServMgr.cxx:2581</a></div></div>
<div class="ttc" id="XrdSysPriv_8hh_html"><div class="ttname"><a href="XrdSysPriv_8hh.html">XrdSysPriv.hh</a></div></div>
<div class="ttc" id="XrdProofdProofServMgr_8cxx_html_ac25e7156ff6e5bbf5ee3ed7faffde40d"><div class="ttname"><a href="XrdProofdProofServMgr_8cxx.html#ac25e7156ff6e5bbf5ee3ed7faffde40d">BroadcastPriority</a></div><div class="ttdeci">static int BroadcastPriority(const char *, XrdProofdProofServ *ps, void *s)</div><div class="ttdoc">Run thorugh entries to broadcast the relevant priority. </div><div class="ttdef"><b>Definition:</b> <a href="XrdProofdProofServMgr_8cxx_source.html#l04507">XrdProofdProofServMgr.cxx:4507</a></div></div>
<div class="ttc" id="classXpdEnv_html_ae457913000a09b79692db8ca7ed2eaf5"><div class="ttname"><a href="classXpdEnv.html#ae457913000a09b79692db8ca7ed2eaf5">XpdEnv::Reset</a></div><div class="ttdeci">void Reset(const char *n, const char *env, const char *usr=0, const char *grp=0, int smi=-1, int smx=-1, int vmi=-1, int vmx=-1)</div><div class="ttdef"><b>Definition:</b> <a href="XrdProofdProofServMgr_8h_source.html#l00121">XrdProofdProofServMgr.h:121</a></div></div>
<div class="ttc" id="classXrdProofdProofServMgr_html_a252fbbc0e7d412c6488c2b0eab66c1b0"><div class="ttname"><a href="classXrdProofdProofServMgr.html#a252fbbc0e7d412c6488c2b0eab66c1b0">XrdProofdProofServMgr::BroadcastPriorities</a></div><div class="ttdeci">int BroadcastPriorities()</div><div class="ttdoc">Broadcast priorities to the active sessions. </div><div class="ttdef"><b>Definition:</b> <a href="XrdProofdProofServMgr_8cxx_source.html#l04576">XrdProofdProofServMgr.cxx:4576</a></div></div>
<div class="ttc" id="classXrdProofdDirective_html"><div class="ttname"><a href="classXrdProofdDirective.html">XrdProofdDirective</a></div><div class="ttdef"><b>Definition:</b> <a href="XrdProofdAux_8h_source.html#l00105">XrdProofdAux.h:105</a></div></div>
<div class="ttc" id="classXrdProofdProofServMgr_html_a4a8be4f347170c279824168597e16caa"><div class="ttname"><a href="classXrdProofdProofServMgr.html#a4a8be4f347170c279824168597e16caa">XrdProofdProofServMgr::fSessions</a></div><div class="ttdeci">XrdOucHash&lt; XrdProofdProofServ &gt; fSessions</div><div class="ttdef"><b>Definition:</b> <a href="XrdProofdProofServMgr_8h_source.html#l00170">XrdProofdProofServMgr.h:170</a></div></div>
<div class="ttc" id="classXrdProofdProofServMgr_html_ae4a26a2ec9dc1e8b510ba16d5bbd809b"><div class="ttname"><a href="classXrdProofdProofServMgr.html#ae4a26a2ec9dc1e8b510ba16d5bbd809b">XrdProofdProofServMgr::SetReconnectTime</a></div><div class="ttdeci">void SetReconnectTime(bool on=1)</div><div class="ttdoc">Change reconnecting status. </div><div class="ttdef"><b>Definition:</b> <a href="XrdProofdProofServMgr_8cxx_source.html#l04610">XrdProofdProofServMgr.cxx:4610</a></div></div>
<div class="ttc" id="classXrdProofdPipe_html_a51532896ac35adec6efe6840dcac0354"><div class="ttname"><a href="classXrdProofdPipe.html#a51532896ac35adec6efe6840dcac0354">XrdProofdPipe::Poll</a></div><div class="ttdeci">int Poll(int to=-1)</div><div class="ttdoc">Poll over the read pipe for to secs; return whatever poll returns. </div><div class="ttdef"><b>Definition:</b> <a href="XrdProofdAux_8cxx_source.html#l01814">XrdProofdAux.cxx:1814</a></div></div>
<div class="ttc" id="classXrdProofdProofServMgr_html_a112317944ba9a3b64b9f784a9ef8d6b8"><div class="ttname"><a href="classXrdProofdProofServMgr.html#a112317944ba9a3b64b9f784a9ef8d6b8">XrdProofdProofServMgr::CurrentSessions</a></div><div class="ttdeci">int CurrentSessions(bool recalculate=0)</div><div class="ttdoc">Return the number of current sessions (top masters) </div><div class="ttdef"><b>Definition:</b> <a href="XrdProofdProofServMgr_8cxx_source.html#l04702">XrdProofdProofServMgr.cxx:4702</a></div></div>
<div class="ttc" id="XrdProofdPlatform_8h_html_aa5bbba6e125e30ab938354892fa73c30"><div class="ttname"><a href="XrdProofdPlatform_8h.html#aa5bbba6e125e30ab938354892fa73c30">XPD_LIBPATH</a></div><div class="ttdeci">#define XPD_LIBPATH</div><div class="ttdef"><b>Definition:</b> <a href="XrdProofdPlatform_8h_source.html#l00118">XrdProofdPlatform.h:118</a></div></div>
<div class="ttc" id="classXrdProofdProofServMgr_html_a1a5fce183660e6508e874505445d88dd"><div class="ttname"><a href="classXrdProofdProofServMgr.html#a1a5fce183660e6508e874505445d88dd">XrdProofdProofServMgr::fVerifyTimeOut</a></div><div class="ttdeci">int fVerifyTimeOut</div><div class="ttdef"><b>Definition:</b> <a href="XrdProofdProofServMgr_8h_source.html#l00151">XrdProofdProofServMgr.h:151</a></div></div>
<div class="ttc" id="classXpdEnv_html_ae9c162b3ad476c505b38f4b5e022c953"><div class="ttname"><a href="classXpdEnv.html#ae9c162b3ad476c505b38f4b5e022c953">XpdEnv::ToVersCode</a></div><div class="ttdeci">static int ToVersCode(int ver, bool hex=0)</div><div class="ttdoc">Transform version number ver (format patch + 100*minor + 10000*maj, e.g. </div><div class="ttdef"><b>Definition:</b> <a href="XrdProofdProofServMgr_8cxx_source.html#l05054">XrdProofdProofServMgr.cxx:5054</a></div></div>
<div class="ttc" id="classXpdEnv_html_a0416e242e3af7cd77afe1f8a02a802e7"><div class="ttname"><a href="classXpdEnv.html#a0416e242e3af7cd77afe1f8a02a802e7">XpdEnv::fGroups</a></div><div class="ttdeci">XrdOucString fGroups</div><div class="ttdef"><b>Definition:</b> <a href="XrdProofdProofServMgr_8h_source.html#l00112">XrdProofdProofServMgr.h:112</a></div></div>
<div class="ttc" id="classXrdProofdPipe_html_a28d8bcdda93fc3c8beb4eb4ee22f5aa0"><div class="ttname"><a href="classXrdProofdPipe.html#a28d8bcdda93fc3c8beb4eb4ee22f5aa0">XrdProofdPipe::IsValid</a></div><div class="ttdeci">bool IsValid() const</div><div class="ttdef"><b>Definition:</b> <a href="XrdProofdAux_8h_source.html#l00206">XrdProofdAux.h:206</a></div></div>
<div class="ttc" id="XProofProtocol_8h_html_a4914ebd84de85ce2387929f1808f673a"><div class="ttname"><a href="XProofProtocol_8h.html#a4914ebd84de85ce2387929f1808f673a">kXPD_TopMaster</a></div><div class="ttdeci">#define kXPD_TopMaster</div><div class="ttdef"><b>Definition:</b> <a href="XProofProtocol_8h_source.html#l00064">XProofProtocol.h:64</a></div></div>
<div class="ttc" id="XProofProtocol_8h_html_a106fb425aa6ca0edb82300aeed56691ca62ea20a1f97e416e18f07fad9f8339f8"><div class="ttname"><a href="XProofProtocol_8h.html#a106fb425aa6ca0edb82300aeed56691ca62ea20a1f97e416e18f07fad9f8339f8">kXP_detach</a></div><div class="ttdef"><b>Definition:</b> <a href="XProofProtocol_8h_source.html#l00037">XProofProtocol.h:37</a></div></div>
<div class="ttc" id="XProofProtocol_8h_html_a3a4503f87fa152df23df4d274f07b932a7bf0d5731cd0e6bf8fd0e26861b8c2af"><div class="ttname"><a href="XProofProtocol_8h.html#a3a4503f87fa152df23df4d274f07b932a7bf0d5731cd0e6bf8fd0e26861b8c2af">kXPD_running</a></div><div class="ttdef"><b>Definition:</b> <a href="XProofProtocol_8h_source.html#l00134">XProofProtocol.h:134</a></div></div>
<div class="ttc" id="classXrdProofdProofServ_html_a52a25c22819b28395cc597a96676312c"><div class="ttname"><a href="classXrdProofdProofServ.html#a52a25c22819b28395cc597a96676312c">XrdProofdProofServ::SrvType</a></div><div class="ttdeci">int SrvType() const</div><div class="ttdef"><b>Definition:</b> <a href="XrdProofdProofServ_8h_source.html#l00192">XrdProofdProofServ.h:192</a></div></div>
<div class="ttc" id="XrdProofdTrace_8h_html_ae90cd8dc8bb9c2e23852350504b02e49"><div class="ttname"><a href="XrdProofdTrace_8h.html#ae90cd8dc8bb9c2e23852350504b02e49">TRACING</a></div><div class="ttdeci">#define TRACING(x)</div><div class="ttdef"><b>Definition:</b> <a href="XrdProofdTrace_8h_source.html#l00078">XrdProofdTrace.h:78</a></div></div>
<div class="ttc" id="classXrdProofdProofServMgr_html_adca5540d7e00aac5e5e5e1438e3b02fc"><div class="ttname"><a href="classXrdProofdProofServMgr.html#adca5540d7e00aac5e5e5e1438e3b02fc">XrdProofdProofServMgr::Process</a></div><div class="ttdeci">int Process(XrdProofdProtocol *p)</div><div class="ttdoc">Process manager request. </div><div class="ttdef"><b>Definition:</b> <a href="XrdProofdProofServMgr_8cxx_source.html#l01504">XrdProofdProofServMgr.cxx:1504</a></div></div>
<div class="ttc" id="XrdProofdProtocol_8h_html_a0e4fcddb4216e202dd3e6517d1683c9b"><div class="ttname"><a href="XrdProofdProtocol_8h.html#a0e4fcddb4216e202dd3e6517d1683c9b">XPROOFD_VERSBIN</a></div><div class="ttdeci">#define XPROOFD_VERSBIN</div><div class="ttdef"><b>Definition:</b> <a href="XrdProofdProtocol_8h_source.html#l00035">XrdProofdProtocol.h:35</a></div></div>
<div class="ttc" id="classXrdProofdManager_html_a50da74836ad3c1b1e98e42209206f037"><div class="ttname"><a href="classXrdProofdManager.html#a50da74836ad3c1b1e98e42209206f037">XrdProofdManager::BareLibPath</a></div><div class="ttdeci">const char * BareLibPath() const</div><div class="ttdef"><b>Definition:</b> <a href="XrdProofdManager_8h_source.html#l00075">XrdProofdManager.h:75</a></div></div>
<div class="ttc" id="classXrdProofdProofServMgr_html_a17dc7a6fb286b3bdaf1c7739ea68f7c1"><div class="ttname"><a href="classXrdProofdProofServMgr.html#a17dc7a6fb286b3bdaf1c7739ea68f7c1">XrdProofdProofServMgr::fCheckFrequency</a></div><div class="ttdeci">int fCheckFrequency</div><div class="ttdef"><b>Definition:</b> <a href="XrdProofdProofServMgr_8h_source.html#l00149">XrdProofdProofServMgr.h:149</a></div></div>
<div class="ttc" id="classXpdEnv_html_a77a8165dad6c0025fc19f919137b7b2e"><div class="ttname"><a href="classXpdEnv.html#a77a8165dad6c0025fc19f919137b7b2e">XpdEnv::Print</a></div><div class="ttdeci">void Print(const char *what)</div><div class="ttdoc">Print the content of this env. </div><div class="ttdef"><b>Definition:</b> <a href="XrdProofdProofServMgr_8cxx_source.html#l05076">XrdProofdProofServMgr.cxx:5076</a></div></div>
<div class="ttc" id="entrylistblock__figure1_8C_html_a4fa05b1f00fcde100685cc887554b93b"><div class="ttname"><a href="entrylistblock__figure1_8C.html#a4fa05b1f00fcde100685cc887554b93b">line</a></div><div class="ttdeci">TLine * line</div><div class="ttdef"><b>Definition:</b> <a href="entrylistblock__figure1_8C_source.html#l00235">entrylistblock_figure1.C:235</a></div></div>
<div class="ttc" id="classXrdProofdAux_html_a0230423581c62e4fabf4fda6538fd4a7"><div class="ttname"><a href="classXrdProofdAux.html#a0230423581c62e4fabf4fda6538fd4a7">XrdProofdAux::GetUserInfo</a></div><div class="ttdeci">static int GetUserInfo(const char *usr, XrdProofUI &amp;ui)</div><div class="ttdoc">Get information about user &amp;#39;usr&amp;#39; in a thread safe way. </div><div class="ttdef"><b>Definition:</b> <a href="XrdProofdAux_8cxx_source.html#l00293">XrdProofdAux.cxx:293</a></div></div>
<div class="ttc" id="classXrdProofdProtocol_html_a5f4f44ef5012ad3a1b11c46e68fb060c"><div class="ttname"><a href="classXrdProofdProtocol.html#a5f4f44ef5012ad3a1b11c46e68fb060c">XrdProofdProtocol::Match</a></div><div class="ttdeci">XrdProtocol * Match(XrdLink *lp)</div><div class="ttdoc">Check whether the request matches this protocol. </div><div class="ttdef"><b>Definition:</b> <a href="XrdProofdProtocol_8cxx_source.html#l00291">XrdProofdProtocol.cxx:291</a></div></div>
<div class="ttc" id="XProofProtocol_8h_html_a106fb425aa6ca0edb82300aeed56691ca76c907aca98007ff7c6563fddde22105"><div class="ttname"><a href="XProofProtocol_8h.html#a106fb425aa6ca0edb82300aeed56691ca76c907aca98007ff7c6563fddde22105">kXP_attach</a></div><div class="ttdef"><b>Definition:</b> <a href="XProofProtocol_8h_source.html#l00036">XProofProtocol.h:36</a></div></div>
<div class="ttc" id="classXrdProofSessionInfo_html_a535c612dd0e50fd92671e630e59e64df"><div class="ttname"><a href="classXrdProofSessionInfo.html#a535c612dd0e50fd92671e630e59e64df">XrdProofSessionInfo::fGroup</a></div><div class="ttdeci">XrdOucString fGroup</div><div class="ttdef"><b>Definition:</b> <a href="XrdProofdProofServMgr_8h_source.html#l00087">XrdProofdProofServMgr.h:87</a></div></div>
<div class="ttc" id="classXrdProofdProtocol_html_aff71b1d49b22d2453ed2a7302599de14"><div class="ttname"><a href="classXrdProofdProtocol.html#aff71b1d49b22d2453ed2a7302599de14">XrdProofdProtocol::Link</a></div><div class="ttdeci">XrdLink * Link() const</div><div class="ttdef"><b>Definition:</b> <a href="XrdProofdProtocol_8h_source.html#l00093">XrdProofdProtocol.h:93</a></div></div>
<div class="ttc" id="classXrdProofdProofServMgr_html_a2d3abc89a2ad6def35f0b9bc927377b8"><div class="ttname"><a href="classXrdProofdProofServMgr.html#a2d3abc89a2ad6def35f0b9bc927377b8">XrdProofdProofServMgr::CleanupProofServ</a></div><div class="ttdeci">int CleanupProofServ(bool all=0, const char *usr=0)</div><div class="ttdoc">Cleanup (kill) all &amp;#39;proofserv&amp;#39; processes from the process table. </div><div class="ttdef"><b>Definition:</b> <a href="XrdProofdProofServMgr_8cxx_source.html#l04019">XrdProofdProofServMgr.cxx:4019</a></div></div>
<div class="ttc" id="XProofProtocol_8h_html_a106fb425aa6ca0edb82300aeed56691ca0dcc7175d63b5e2a9dc9ff81333fc7ac"><div class="ttname"><a href="XProofProtocol_8h.html#a106fb425aa6ca0edb82300aeed56691ca0dcc7175d63b5e2a9dc9ff81333fc7ac">kXP_create</a></div><div class="ttdef"><b>Definition:</b> <a href="XProofProtocol_8h_source.html#l00034">XProofProtocol.h:34</a></div></div>
<div class="ttc" id="classXrdProofdClient_html_af82bc301c99dc688038ba2c771b5c49e"><div class="ttname"><a href="classXrdProofdClient.html#af82bc301c99dc688038ba2c771b5c49e">XrdProofdClient::Group</a></div><div class="ttdeci">const char * Group() const</div><div class="ttdef"><b>Definition:</b> <a href="XrdProofdClient_8h_source.html#l00051">XrdProofdClient.h:51</a></div></div>
<div class="ttc" id="classXrdProofSessionInfo_html_a78d843cbc3b32c1e19250359ef46b35f"><div class="ttname"><a href="classXrdProofSessionInfo.html#a78d843cbc3b32c1e19250359ef46b35f">XrdProofSessionInfo::fID</a></div><div class="ttdeci">int fID</div><div class="ttdef"><b>Definition:</b> <a href="XrdProofdProofServMgr_8h_source.html#l00082">XrdProofdProofServMgr.h:82</a></div></div>
<div class="ttc" id="XProofProtocol_8h_html_a81dc1edcb19adb12975b44e65a3c88f4a03ca20da4aca31fccadabaa00c653a92"><div class="ttname"><a href="XProofProtocol_8h.html#a81dc1edcb19adb12975b44e65a3c88f4a03ca20da4aca31fccadabaa00c653a92">kXP_TooManySess</a></div><div class="ttdef"><b>Definition:</b> <a href="XProofProtocol_8h_source.html#l00221">XProofProtocol.h:221</a></div></div>
<div class="ttc" id="XrdROOT_8h_html"><div class="ttname"><a href="XrdROOT_8h.html">XrdROOT.h</a></div></div>
<div class="ttc" id="classXrdProofdProofServMgr_html_a4989c26817d0896a76f54fa9916229a3"><div class="ttname"><a href="classXrdProofdProofServMgr.html#a4989c26817d0896a76f54fa9916229a3">XrdProofdProofServMgr::fForkSem</a></div><div class="ttdeci">XrdSysSemWait fForkSem</div><div class="ttdef"><b>Definition:</b> <a href="XrdProofdProofServMgr_8h_source.html#l00136">XrdProofdProofServMgr.h:136</a></div></div>
<div class="ttc" id="classXrdROOTMgr_html_a80d29c16a1fc5046abdea1ac9bc72dc7"><div class="ttname"><a href="classXrdROOTMgr.html#a80d29c16a1fc5046abdea1ac9bc72dc7">XrdROOTMgr::DefaultVersion</a></div><div class="ttdeci">XrdROOT * DefaultVersion() const</div><div class="ttdef"><b>Definition:</b> <a href="XrdROOT_8h_source.html#l00118">XrdROOT.h:118</a></div></div>
<div class="ttc" id="classXrdProofSessionInfo_html"><div class="ttname"><a href="classXrdProofSessionInfo.html">XrdProofSessionInfo</a></div><div class="ttdef"><b>Definition:</b> <a href="XrdProofdProofServMgr_8h_source.html#l00078">XrdProofdProofServMgr.h:78</a></div></div>
<div class="ttc" id="classXrdProofdProofServMgr_html_aaebdf9da139d40cf89c6c98f38941c97a75fd20e4a8f0ea218112713cd86648f1"><div class="ttname"><a href="classXrdProofdProofServMgr.html#aaebdf9da139d40cf89c6c98f38941c97a75fd20e4a8f0ea218112713cd86648f1">XrdProofdProofServMgr::kProcessReq</a></div><div class="ttdef"><b>Definition:</b> <a href="XrdProofdProofServMgr_8h_source.html#l00231">XrdProofdProofServMgr.h:231</a></div></div>
<div class="ttc" id="RSha256_8hxx_html_a9608045402267746965fa49d90bbada4"><div class="ttname"><a href="RSha256_8hxx.html#a9608045402267746965fa49d90bbada4">g</a></div><div class="ttdeci">#define g(i)</div><div class="ttdef"><b>Definition:</b> <a href="RSha256_8hxx_source.html#l00105">RSha256.hxx:105</a></div></div>
<div class="ttc" id="classXrdProofdProofServMgr_html_a3aef7efdf20b92f8db384ff26aa5f7fc"><div class="ttname"><a href="classXrdProofdProofServMgr.html#a3aef7efdf20b92f8db384ff26aa5f7fc">XrdProofdProofServMgr::IsClientRecovering</a></div><div class="ttdeci">bool IsClientRecovering(const char *usr, const char *grp, int &amp;deadline)</div><div class="ttdoc">Returns true (an the recovering deadline) if the client has sessions in recovering state; returns fal...</div><div class="ttdef"><b>Definition:</b> <a href="XrdProofdProofServMgr_8cxx_source.html#l00860">XrdProofdProofServMgr.cxx:860</a></div></div>
<div class="ttc" id="classXrdProofdProofServMgr_html_a319d93533e5c4eb94170e7837ee27ab9"><div class="ttname"><a href="classXrdProofdProofServMgr.html#a319d93533e5c4eb94170e7837ee27ab9">XrdProofdProofServMgr::ParseCreateBuffer</a></div><div class="ttdeci">void ParseCreateBuffer(XrdProofdProtocol *p, XrdProofdProofServ *xps, XrdOucString &amp;tag, XrdOucString &amp;ord, XrdOucString &amp;cffile, XrdOucString &amp;uenvs, int &amp;intwait)</div><div class="ttdoc">Extract relevant quantities from the buffer received during a create request. </div><div class="ttdef"><b>Definition:</b> <a href="XrdProofdProofServMgr_8cxx_source.html#l01691">XrdProofdProofServMgr.cxx:1691</a></div></div>
<div class="ttc" id="classXrdProofdProofServ_html_af67067c8b8f82303367b9307350c6e59"><div class="ttname"><a href="classXrdProofdProofServ.html#af67067c8b8f82303367b9307350c6e59">XrdProofdProofServ::IsValid</a></div><div class="ttdeci">bool IsValid() const</div><div class="ttdef"><b>Definition:</b> <a href="XrdProofdProofServ_8h_source.html#l00144">XrdProofdProofServ.h:144</a></div></div>
<div class="ttc" id="classXrdProofdManager_html_a597b5254d01ca1a0ad35e6e3b968426d"><div class="ttname"><a href="classXrdProofdManager.html#a597b5254d01ca1a0ad35e6e3b968426d">XrdProofdManager::NetMgr</a></div><div class="ttdeci">XrdProofdNetMgr * NetMgr() const</div><div class="ttdef"><b>Definition:</b> <a href="XrdProofdManager_8h_source.html#l00109">XrdProofdManager.h:109</a></div></div>
<div class="ttc" id="classXrdProofdProtocol_html"><div class="ttname"><a href="classXrdProofdProtocol.html">XrdProofdProtocol</a></div><div class="ttdef"><b>Definition:</b> <a href="XrdProofdProtocol_8h_source.html#l00054">XrdProofdProtocol.h:54</a></div></div>
<div class="ttc" id="classXrdProofdProofServ_html_af69a1e44057cb2b6b32fba74244c6ba1"><div class="ttname"><a href="classXrdProofdProofServ.html#af69a1e44057cb2b6b32fba74244c6ba1">XrdProofdProofServ::Tag</a></div><div class="ttdeci">const char * Tag() const</div><div class="ttdef"><b>Definition:</b> <a href="XrdProofdProofServ_8h_source.html#l00195">XrdProofdProofServ.h:195</a></div></div>
<div class="ttc" id="classXpdEnv_html_a1cf41d0705fab5db572acf6057897002"><div class="ttname"><a href="classXpdEnv.html#a1cf41d0705fab5db572acf6057897002">XpdEnv::fSvnMin</a></div><div class="ttdeci">int fSvnMin</div><div class="ttdef"><b>Definition:</b> <a href="XrdProofdProofServMgr_8h_source.html#l00113">XrdProofdProofServMgr.h:113</a></div></div>
<div class="ttc" id="classXrdSysPrivGuard_html"><div class="ttname"><a href="classXrdSysPrivGuard.html">XrdSysPrivGuard</a></div><div class="ttdef"><b>Definition:</b> <a href="XrdSysPriv_8hh_source.html#l00086">XrdSysPriv.hh:86</a></div></div>
<div class="ttc" id="classXrdProofdProofServMgr_html_aab3b1838487f683e509be19e243ef02a"><div class="ttname"><a href="classXrdProofdProofServMgr.html#aab3b1838487f683e509be19e243ef02a">XrdProofdProofServMgr::SetUserOwnerships</a></div><div class="ttdeci">int SetUserOwnerships(XrdProofdProtocol *p, const char *ord, const char *stag)</div><div class="ttdoc">Set user ownerships on some critical files or directories. </div><div class="ttdef"><b>Definition:</b> <a href="XrdProofdProofServMgr_8cxx_source.html#l04341">XrdProofdProofServMgr.cxx:4341</a></div></div>
<div class="ttc" id="classXrdProofdProofServMgr_html_a4bb35d380da506fb49659f342b94ff55"><div class="ttname"><a href="classXrdProofdProofServMgr.html#a4bb35d380da506fb49659f342b94ff55">XrdProofdProofServMgr::SetProofServEnv</a></div><div class="ttdeci">int SetProofServEnv(XrdProofdProtocol *p, void *in)</div><div class="ttdoc">Set environment for proofserv. </div><div class="ttdef"><b>Definition:</b> <a href="XrdProofdProofServMgr_8cxx_source.html#l03332">XrdProofdProofServMgr.cxx:3332</a></div></div>
<div class="ttc" id="XrdProofdProofServMgr_8cxx_html_a7cfa47f520ffb28d614134a05dc8cb14"><div class="ttname"><a href="XrdProofdProofServMgr_8cxx.html#a7cfa47f520ffb28d614134a05dc8cb14">PutEnv</a></div><div class="ttdeci">#define PutEnv(x, e)</div><div class="ttdef"><b>Definition:</b> <a href="XrdProofdProofServMgr_8cxx_source.html#l00063">XrdProofdProofServMgr.cxx:63</a></div></div>
<div class="ttc" id="classXrdProofdProofServ_html_a62e28c60bd4b82ddb9204185c3a41fc2"><div class="ttname"><a href="classXrdProofdProofServ.html#a62e28c60bd4b82ddb9204185c3a41fc2">XrdProofdProofServ::Client</a></div><div class="ttdeci">const char * Client() const</div><div class="ttdef"><b>Definition:</b> <a href="XrdProofdProofServ_8h_source.html#l00122">XrdProofdProofServ.h:122</a></div></div>
<div class="ttc" id="classXrdProofdProofServMgr_html_aa105a86a4bc5264a668e0362164a3052"><div class="ttname"><a href="classXrdProofdProofServMgr.html#aa105a86a4bc5264a668e0362164a3052">XrdProofdProofServMgr::fDestroyTimes</a></div><div class="ttdeci">std::map&lt; XrdProofdProtocol *, int &gt; fDestroyTimes</div><div class="ttdef"><b>Definition:</b> <a href="XrdProofdProofServMgr_8h_source.html#l00176">XrdProofdProofServMgr.h:176</a></div></div>
<div class="ttc" id="XrdProofdAux_8h_html_aad0932bed13278acd82d9a710a3b5393"><div class="ttname"><a href="XrdProofdAux_8h.html#aad0932bed13278acd82d9a710a3b5393">DoDirectiveClass</a></div><div class="ttdeci">int DoDirectiveClass(XrdProofdDirective *, char *val, XrdOucStream *cfg, bool rcf)</div><div class="ttdoc">Generic class directive processor. </div><div class="ttdef"><b>Definition:</b> <a href="XrdProofdAux_8cxx_source.html#l01641">XrdProofdAux.cxx:1641</a></div></div>
<div class="ttc" id="classXrdProofSessionInfo_html_a923614a4a79e6a824ea27b3a1cdaad59"><div class="ttname"><a href="classXrdProofSessionInfo.html#a923614a4a79e6a824ea27b3a1cdaad59">XrdProofSessionInfo::fOrdinal</a></div><div class="ttdeci">XrdOucString fOrdinal</div><div class="ttdef"><b>Definition:</b> <a href="XrdProofdProofServMgr_8h_source.html#l00092">XrdProofdProofServMgr.h:92</a></div></div>
<div class="ttc" id="classXpdEnv_html_a29872c9ff063d0322fd6284479a06370"><div class="ttname"><a href="classXpdEnv.html#a29872c9ff063d0322fd6284479a06370">XpdEnv::fVerMax</a></div><div class="ttdeci">int fVerMax</div><div class="ttdef"><b>Definition:</b> <a href="XrdProofdProofServMgr_8h_source.html#l00116">XrdProofdProofServMgr.h:116</a></div></div>
<div class="ttc" id="classXpdMsg_html_a76f23fb246000fb53707c441192776a7"><div class="ttname"><a href="classXpdMsg.html#a76f23fb246000fb53707c441192776a7">XpdMsg::Buf</a></div><div class="ttdeci">const char * Buf() const</div><div class="ttdef"><b>Definition:</b> <a href="XrdProofdAux_8h_source.html#l00182">XrdProofdAux.h:182</a></div></div>
<div class="ttc" id="structProofServEnv__t_html"><div class="ttname"><a href="structProofServEnv__t.html">ProofServEnv_t</a></div><div class="ttdef"><b>Definition:</b> <a href="XrdProofdProofServMgr_8h_source.html#l00057">XrdProofdProofServMgr.h:57</a></div></div>
<div class="ttc" id="classXrdClientID_html"><div class="ttname"><a href="classXrdClientID.html">XrdClientID</a></div><div class="ttdef"><b>Definition:</b> <a href="XrdProofdClient_8h_source.html#l00127">XrdProofdClient.h:127</a></div></div>
<div class="ttc" id="XrdSysToOuc_8h_html_aef8b02ba04526e432427472092286bc5"><div class="ttname"><a href="XrdSysToOuc_8h.html#aef8b02ba04526e432427472092286bc5">XrdSysRecMutex</a></div><div class="ttdeci">#define XrdSysRecMutex</div><div class="ttdef"><b>Definition:</b> <a href="XrdSysToOuc_8h_source.html#l00018">XrdSysToOuc.h:18</a></div></div>
<div class="ttc" id="classXrdProofdProofServMgr_html_aa2c82434b2d6b59188b6afc2fd6478ef"><div class="ttname"><a href="classXrdProofdProofServMgr.html#aa2c82434b2d6b59188b6afc2fd6478ef">XrdProofdProofServMgr::IsSessionSocket</a></div><div class="ttdeci">bool IsSessionSocket(const char *fpid)</div><div class="ttdoc">Checks is fpid is the path of a session UNIX socket Returns TRUE is yes; cleans the socket if the ses...</div><div class="ttdef"><b>Definition:</b> <a href="XrdProofdProofServMgr_8cxx_source.html#l00459">XrdProofdProofServMgr.cxx:459</a></div></div>
<div class="ttc" id="classXrdProofdProofServ_html_afca1f3fc31dfb797c36d9b1d3593f1c4"><div class="ttname"><a href="classXrdProofdProofServ.html#afca1f3fc31dfb797c36d9b1d3593f1c4">XrdProofdProofServ::CheckSession</a></div><div class="ttdeci">int CheckSession(bool oldvers, bool isrec, int shutopt, int shutdel, bool changeown, int &amp;nc)</div><div class="ttdoc">Calculate the effective number of users on this session nodes and communicate it to the master togeth...</div><div class="ttdef"><b>Definition:</b> <a href="XrdProofdProofServ_8cxx_source.html#l01016">XrdProofdProofServ.cxx:1016</a></div></div>
<div class="ttc" id="classXrdProofdProofServMgr_html_ae701527462f37bde60cef71f5570375f"><div class="ttname"><a href="classXrdProofdProofServMgr.html#ae701527462f37bde60cef71f5570375f">XrdProofdProofServMgr::CreateProofServRootRc</a></div><div class="ttdeci">int CreateProofServRootRc(XrdProofdProtocol *p, void *input, const char *rcfn)</div><div class="ttdoc">Create in &amp;#39;rcfn&amp;#39; the rootrc file for the proofserv being created return 0 on success, -1 on error. </div><div class="ttdef"><b>Definition:</b> <a href="XrdProofdProofServMgr_8cxx_source.html#l03639">XrdProofdProofServMgr.cxx:3639</a></div></div>
<div class="ttc" id="classXrdProofdManager_html_a128a9af44f04fdbf956b893c7a16d45b"><div class="ttname"><a href="classXrdProofdManager.html#a128a9af44f04fdbf956b893c7a16d45b">XrdProofdManager::Port</a></div><div class="ttdeci">int Port() const</div><div class="ttdef"><b>Definition:</b> <a href="XrdProofdManager_8h_source.html#l00088">XrdProofdManager.h:88</a></div></div>
<div class="ttc" id="TGHtml_8h_html_ad5bb4a3d12fd54f29da2b924b29e652b"><div class="ttname"><a href="TGHtml_8h.html#ad5bb4a3d12fd54f29da2b924b29e652b">TRACE</a></div><div class="ttdeci">#define TRACE(Flag, Args)</div><div class="ttdef"><b>Definition:</b> <a href="TGHtml_8h_source.html#l00120">TGHtml.h:120</a></div></div>
<div class="ttc" id="classXrdProofdProofServMgr_html_a06afec54e6f910193389cde6661e6deb"><div class="ttname"><a href="classXrdProofdProofServMgr.html#a06afec54e6f910193389cde6661e6deb">XrdProofdProofServMgr::UpdateCounter</a></div><div class="ttdeci">void UpdateCounter(int t, int n)</div><div class="ttdef"><b>Definition:</b> <a href="XrdProofdProofServMgr_8h_source.html#l00266">XrdProofdProofServMgr.h:266</a></div></div>
<div class="ttc" id="classXrdClientID_html_a55e95e912daffe7f70328f52ae6354a5"><div class="ttname"><a href="classXrdClientID.html#a55e95e912daffe7f70328f52ae6354a5">XrdClientID::SetSid</a></div><div class="ttdeci">void SetSid(unsigned short sid)</div><div class="ttdef"><b>Definition:</b> <a href="XrdProofdClient_8h_source.html#l00147">XrdProofdClient.h:147</a></div></div>
<div class="ttc" id="classXrdProofdProofServMgr_html_a7efc0cc555297fe131bb6813d51ac957"><div class="ttname"><a href="classXrdProofdProofServMgr.html#a7efc0cc555297fe131bb6813d51ac957">XrdProofdProofServMgr::RmSession</a></div><div class="ttdeci">int RmSession(const char *fpid)</div><div class="ttdoc">Remove session file from the terminated sessions area. </div><div class="ttdef"><b>Definition:</b> <a href="XrdProofdProofServMgr_8cxx_source.html#l00551">XrdProofdProofServMgr.cxx:551</a></div></div>
<div class="ttc" id="classXrdProofSched_html_a164c4ca7a73bb3f8ebd06dce9ce11b1d"><div class="ttname"><a href="classXrdProofSched.html#a164c4ca7a73bb3f8ebd06dce9ce11b1d">XrdProofSched::MaxSessions</a></div><div class="ttdeci">virtual int MaxSessions() const</div><div class="ttdef"><b>Definition:</b> <a href="XrdProofSched_8h_source.html#l00089">XrdProofSched.h:89</a></div></div>
<div class="ttc" id="namespaceTGeant4Unit_html_acf9c078cf6febce70e282acd7f5dff9b"><div class="ttname"><a href="namespaceTGeant4Unit.html#acf9c078cf6febce70e282acd7f5dff9b">TGeant4Unit::ps</a></div><div class="ttdeci">static constexpr double ps</div><div class="ttdef"><b>Definition:</b> <a href="TGeant4SystemOfUnits_8h_source.html#l00165">TGeant4SystemOfUnits.h:165</a></div></div>
<div class="ttc" id="classXrdProofdProtocol_html_a934bd88037498a09c684297fca7b664f"><div class="ttname"><a href="classXrdProofdProtocol.html#a934bd88037498a09c684297fca7b664f">XrdProofdProtocol::CID</a></div><div class="ttdeci">kXR_int32 CID() const</div><div class="ttdef"><b>Definition:</b> <a href="XrdProofdProtocol_8h_source.html#l00075">XrdProofdProtocol.h:75</a></div></div>
<div class="ttc" id="classXrdProofdProofServ_html_a1be69abff69e78a8d01f1d0313f50c09"><div class="ttname"><a href="classXrdProofdProofServ.html#a1be69abff69e78a8d01f1d0313f50c09">XrdProofdProofServ::SetPLiteNWrks</a></div><div class="ttdeci">void SetPLiteNWrks(int n)</div><div class="ttdef"><b>Definition:</b> <a href="XrdProofdProofServ_8h_source.html#l00175">XrdProofdProofServ.h:175</a></div></div>
<div class="ttc" id="classXrdProofdProtocol_html_a71898b7c3788b133364db067d1f47c24"><div class="ttname"><a href="classXrdProofdProtocol.html#a71898b7c3788b133364db067d1f47c24">XrdProofdProtocol::ConnType</a></div><div class="ttdeci">int ConnType() const</div><div class="ttdef"><b>Definition:</b> <a href="XrdProofdProtocol_8h_source.html#l00079">XrdProofdProtocol.h:79</a></div></div>
<div class="ttc" id="classXrdProofdProofServMgr_html_aa150146266359bec018e9b443e49818d"><div class="ttname"><a href="classXrdProofdProofServMgr.html#aa150146266359bec018e9b443e49818d">XrdProofdProofServMgr::fRecoverTimeOut</a></div><div class="ttdeci">int fRecoverTimeOut</div><div class="ttdef"><b>Definition:</b> <a href="XrdProofdProofServMgr_8h_source.html#l00154">XrdProofdProofServMgr.h:154</a></div></div>
<div class="ttc" id="classXrdProofdProofServMgr_html_ab78ba4f2c0b8916e62977e50b6677c02"><div class="ttname"><a href="classXrdProofdProofServMgr.html#ab78ba4f2c0b8916e62977e50b6677c02">XrdProofdProofServMgr::DeleteFromSessions</a></div><div class="ttdeci">int DeleteFromSessions(const char *pid)</div><div class="ttdoc">Delete from the hash list the session with ID pid. </div><div class="ttdef"><b>Definition:</b> <a href="XrdProofdProofServMgr_8cxx_source.html#l00669">XrdProofdProofServMgr.cxx:669</a></div></div>
<div class="ttc" id="classXrdProofdProofServ_html_ac4953244f65634a9ee47299d408591d8"><div class="ttname"><a href="classXrdProofdProofServ.html#ac4953244f65634a9ee47299d408591d8">XrdProofdProofServ::Reset</a></div><div class="ttdeci">void Reset()</div><div class="ttdoc">Reset this instance. </div><div class="ttdef"><b>Definition:</b> <a href="XrdProofdProofServ_8cxx_source.html#l00212">XrdProofdProofServ.cxx:212</a></div></div>
<div class="ttc" id="XrdProofdProofServMgr_8cxx_html_a1aa25ceda2f238b99cc43d7b0229a6b3"><div class="ttname"><a href="XrdProofdProofServMgr_8cxx.html#a1aa25ceda2f238b99cc43d7b0229a6b3">FreeClientID</a></div><div class="ttdeci">static int FreeClientID(const char *, XrdProofdProofServ *ps, void *s)</div><div class="ttdoc">Run through entries to reset the disconnecting client slots. </div><div class="ttdef"><b>Definition:</b> <a href="XrdProofdProofServMgr_8cxx_source.html#l04648">XrdProofdProofServMgr.cxx:4648</a></div></div>
<div class="ttc" id="classXpdEnv_html"><div class="ttname"><a href="classXpdEnv.html">XpdEnv</a></div><div class="ttdef"><b>Definition:</b> <a href="XrdProofdProofServMgr_8h_source.html#l00107">XrdProofdProofServMgr.h:107</a></div></div>
<div class="ttc" id="classXpdMsg_html_a29c82456ff1bc75ba72be288f96c7693"><div class="ttname"><a href="classXpdMsg.html#a29c82456ff1bc75ba72be288f96c7693">XpdMsg::Type</a></div><div class="ttdeci">int Type() const</div><div class="ttdef"><b>Definition:</b> <a href="XrdProofdAux_8h_source.html#l00191">XrdProofdAux.h:191</a></div></div>
<div class="ttc" id="classXrdProofdProofServ_html_a6d021563fa5819a9d41720df41c54e7c"><div class="ttname"><a href="classXrdProofdProofServ.html#a6d021563fa5819a9d41720df41c54e7c">XrdProofdProofServ::UNIXSock</a></div><div class="ttdeci">XrdNet * UNIXSock() const</div><div class="ttdef"><b>Definition:</b> <a href="XrdProofdProofServ_8h_source.html#l00205">XrdProofdProofServ.h:205</a></div></div>
<div class="ttc" id="RSha256_8hxx_html_a357394e0f6f88c8a57bd893ab28dc8f8"><div class="ttname"><a href="RSha256_8hxx.html#a357394e0f6f88c8a57bd893ab28dc8f8">f</a></div><div class="ttdeci">#define f(i)</div><div class="ttdef"><b>Definition:</b> <a href="RSha256_8hxx_source.html#l00104">RSha256.hxx:104</a></div></div>
<div class="ttc" id="XrdProofdManager_8h_html"><div class="ttname"><a href="XrdProofdManager_8h.html">XrdProofdManager.h</a></div></div>
<div class="ttc" id="classXrdProofdManager_html_abd140a5d84efcad2bceb7fef7356d16e"><div class="ttname"><a href="classXrdProofdManager.html#abd140a5d84efcad2bceb7fef7356d16e">XrdProofdManager::Sched</a></div><div class="ttdeci">XrdScheduler * Sched() const</div><div class="ttdef"><b>Definition:</b> <a href="XrdProofdManager_8h_source.html#l00113">XrdProofdManager.h:113</a></div></div>
<div class="ttc" id="XrdProofdAux_8h_html_abfb9e40e3aca19fd83a379e1e1af81bd"><div class="ttname"><a href="XrdProofdAux_8h.html#abfb9e40e3aca19fd83a379e1e1af81bd">DoDirectiveInt</a></div><div class="ttdeci">int DoDirectiveInt(XrdProofdDirective *, char *val, XrdOucStream *cfg, bool rcf)</div><div class="ttdoc">Process directive for an integer. </div><div class="ttdef"><b>Definition:</b> <a href="XrdProofdAux_8cxx_source.html#l01653">XrdProofdAux.cxx:1653</a></div></div>
<div class="ttc" id="XpdSysError_8h_html"><div class="ttname"><a href="XpdSysError_8h.html">XpdSysError.h</a></div></div>
<div class="ttc" id="classXrdProofdProofServMgr_html_a609c36fd5158c76f721bb519e4b088a2"><div class="ttname"><a href="classXrdProofdProofServMgr.html#a609c36fd5158c76f721bb519e4b088a2">XrdProofdProofServMgr::fProcessSem</a></div><div class="ttdeci">XrdSysSemWait fProcessSem</div><div class="ttdef"><b>Definition:</b> <a href="XrdProofdProofServMgr_8h_source.html#l00137">XrdProofdProofServMgr.h:137</a></div></div>
<div class="ttc" id="classXrdProofSessionInfo_html_aa7c5425c9469c9ced6f83eedb0bb6a31"><div class="ttname"><a href="classXrdProofSessionInfo.html#aa7c5425c9469c9ced6f83eedb0bb6a31">XrdProofSessionInfo::fUserEnvs</a></div><div class="ttdeci">XrdOucString fUserEnvs</div><div class="ttdef"><b>Definition:</b> <a href="XrdProofdProofServMgr_8h_source.html#l00093">XrdProofdProofServMgr.h:93</a></div></div>
<div class="ttc" id="classXrdProofdProofServ_html_aed92a8d3a8b058f1dcf56862365f1939"><div class="ttname"><a href="classXrdProofdProofServ.html#aed92a8d3a8b058f1dcf56862365f1939">XrdProofdProofServ::ID</a></div><div class="ttdeci">short int ID() const</div><div class="ttdef"><b>Definition:</b> <a href="XrdProofdProofServ_8h_source.html#l00141">XrdProofdProofServ.h:141</a></div></div>
<div class="ttc" id="XProofProtocol_8h_html_af90b47a2dd37c58ac6f67e16c279e27ba3e99445973002fe938a8ac2da4ab5b4a"><div class="ttname"><a href="XProofProtocol_8h.html#af90b47a2dd37c58ac6f67e16c279e27ba3e99445973002fe938a8ac2da4ab5b4a">kXPD_wrkmortem</a></div><div class="ttdef"><b>Definition:</b> <a href="XProofProtocol_8h_source.html#l00184">XProofProtocol.h:184</a></div></div>
<div class="ttc" id="structProofServEnv__t_html_ac49c6760896eeec21cf83929ab709b92"><div class="ttname"><a href="structProofServEnv__t.html#ac49c6760896eeec21cf83929ab709b92">ProofServEnv_t::fOld</a></div><div class="ttdeci">bool fOld</div><div class="ttdef"><b>Definition:</b> <a href="XrdProofdProofServMgr_8h_source.html#l00066">XrdProofdProofServMgr.h:66</a></div></div>
<div class="ttc" id="classXrdProofdProofServMgr_html"><div class="ttname"><a href="classXrdProofdProofServMgr.html">XrdProofdProofServMgr</a></div><div class="ttdef"><b>Definition:</b> <a href="XrdProofdProofServMgr_8h_source.html#l00130">XrdProofdProofServMgr.h:130</a></div></div>
<div class="ttc" id="classXpdEnv_html_a62c4da6c5964c74a8a5830e21b3dfc1a"><div class="ttname"><a href="classXpdEnv.html#a62c4da6c5964c74a8a5830e21b3dfc1a">XpdEnv::fSvnMax</a></div><div class="ttdeci">int fSvnMax</div><div class="ttdef"><b>Definition:</b> <a href="XrdProofdProofServMgr_8h_source.html#l00114">XrdProofdProofServMgr.h:114</a></div></div>
<div class="ttc" id="classXpdClientSessions_html_a45dc70ffd3df9c03fda9f63db865ee0d"><div class="ttname"><a href="classXpdClientSessions.html#a45dc70ffd3df9c03fda9f63db865ee0d">XpdClientSessions::fMutex</a></div><div class="ttdeci">XrdSysRecMutex fMutex</div><div class="ttdef"><b>Definition:</b> <a href="XrdProofdProofServMgr_8h_source.html#l00071">XrdProofdProofServMgr.h:71</a></div></div>
<div class="ttc" id="XProofProtocol_8h_html_aa5c5130daa268ee7fcf81faff68e7220"><div class="ttname"><a href="XProofProtocol_8h.html#aa5c5130daa268ee7fcf81faff68e7220">kXPD_MasterMaster</a></div><div class="ttdeci">#define kXPD_MasterMaster</div><div class="ttdef"><b>Definition:</b> <a href="XProofProtocol_8h_source.html#l00059">XProofProtocol.h:59</a></div></div>
<div class="ttc" id="XrdProofdPlatform_8h_html_a8862563dbade574514445160166dcd2d"><div class="ttname"><a href="XrdProofdPlatform_8h.html#a8862563dbade574514445160166dcd2d">XPD_LONGOK</a></div><div class="ttdeci">#define XPD_LONGOK(x)</div><div class="ttdef"><b>Definition:</b> <a href="XrdProofdPlatform_8h_source.html#l00129">XrdProofdPlatform.h:129</a></div></div>
<div class="ttc" id="classXrdProofdProofServ_html_abaa4ec219ac74d9b596cd2a95de1b3a0"><div class="ttname"><a href="classXrdProofdProofServ.html#abaa4ec219ac74d9b596cd2a95de1b3a0">XrdProofdProofServ::StartMsg</a></div><div class="ttdeci">XrdSrvBuffer * StartMsg() const</div><div class="ttdef"><b>Definition:</b> <a href="XrdProofdProofServ_8h_source.html#l00193">XrdProofdProofServ.h:193</a></div></div>
<div class="ttc" id="classXrdProofGroup_html"><div class="ttname"><a href="classXrdProofGroup.html">XrdProofGroup</a></div><div class="ttdef"><b>Definition:</b> <a href="XrdProofGroup_8h_source.html#l00048">XrdProofGroup.h:48</a></div></div>
<div class="ttc" id="classXrdProofdProofServMgr_html_a2312694173da8ebbefabb702a4dd089b"><div class="ttname"><a href="classXrdProofdProofServMgr.html#a2312694173da8ebbefabb702a4dd089b">XrdProofdProofServMgr::fRecoverDeadline</a></div><div class="ttdeci">int fRecoverDeadline</div><div class="ttdef"><b>Definition:</b> <a href="XrdProofdProofServMgr_8h_source.html#l00155">XrdProofdProofServMgr.h:155</a></div></div>
<div class="ttc" id="classXrdProofdProofServMgr_html_aefd6e4127ea5c75d9007762cb375adea"><div class="ttname"><a href="classXrdProofdProofServMgr.html#aefd6e4127ea5c75d9007762cb375adea">XrdProofdProofServMgr::ResolveKeywords</a></div><div class="ttdeci">void ResolveKeywords(XrdOucString &amp;s, ProofServEnv_t *in)</div><div class="ttdoc">Resolve some keywords in &amp;#39;s&amp;#39; &lt;logfileroot&gt;, &lt;user&gt;, &lt;rootsys&gt; </div><div class="ttdef"><b>Definition:</b> <a href="XrdProofdProofServMgr_8cxx_source.html#l04722">XrdProofdProofServMgr.cxx:4722</a></div></div>
<div class="ttc" id="classXrdProofdProofServ_html_a1f9861959dae472d6a6d30416b38d0d9"><div class="ttname"><a href="classXrdProofdProofServ.html#a1f9861959dae472d6a6d30416b38d0d9">XrdProofdProofServ::SetOrdinal</a></div><div class="ttdeci">void SetOrdinal(const char *o)</div><div class="ttdef"><b>Definition:</b> <a href="XrdProofdProofServ_8h_source.html#l00173">XrdProofdProofServ.h:173</a></div></div>
<div class="ttc" id="namespaceROOT_1_1Math_1_1detail_html_af7bd9296f106e2e1402e539ca33bdf94ab53b0352d838d5792986f47b2c72b787"><div class="ttname"><a href="namespaceROOT_1_1Math_1_1detail.html#af7bd9296f106e2e1402e539ca33bdf94ab53b0352d838d5792986f47b2c72b787">ROOT::Math::detail::close</a></div><div class="ttdef"><b>Definition:</b> <a href="GenVectorIO_8h_source.html#l00035">GenVectorIO.h:35</a></div></div>
<div class="ttc" id="classXrdProofdPipe_html"><div class="ttname"><a href="classXrdProofdPipe.html">XrdProofdPipe</a></div><div class="ttdef"><b>Definition:</b> <a href="XrdProofdAux_8h_source.html#l00197">XrdProofdAux.h:197</a></div></div>
<div class="ttc" id="classXrdProofdProtocol_html_adccd3922e9251ceea953ce15a7ddf09a"><div class="ttname"><a href="classXrdProofdProtocol.html#adccd3922e9251ceea953ce15a7ddf09a">XrdProofdProtocol::SetAdminPath</a></div><div class="ttdeci">void SetAdminPath(const char *p)</div><div class="ttdef"><b>Definition:</b> <a href="XrdProofdProtocol_8h_source.html#l00097">XrdProofdProtocol.h:97</a></div></div>
<div class="ttc" id="classXrdProofSessionInfo_html_ae6ed70e85425161698b98ea8b38ce41f"><div class="ttname"><a href="classXrdProofSessionInfo.html#ae6ed70e85425161698b98ea8b38ce41f">XrdProofSessionInfo::fPid</a></div><div class="ttdeci">int fPid</div><div class="ttdef"><b>Definition:</b> <a href="XrdProofdProofServMgr_8h_source.html#l00081">XrdProofdProofServMgr.h:81</a></div></div>
<div class="ttc" id="classXrdProofGroupMgr_html_af8c3bc68c9a7100f752c9c4e536c2f03"><div class="ttname"><a href="classXrdProofGroupMgr.html#af8c3bc68c9a7100f752c9c4e536c2f03">XrdProofGroupMgr::GetCfgFile</a></div><div class="ttdeci">const char * GetCfgFile() const</div><div class="ttdef"><b>Definition:</b> <a href="XrdProofGroup_8h_source.html#l00122">XrdProofGroup.h:122</a></div></div>
<div class="ttc" id="classXrdProofdProofServMgr_html_ab587d74e7ada5a2ffcaca340799d9cb8"><div class="ttname"><a href="classXrdProofdProofServMgr.html#ab587d74e7ada5a2ffcaca340799d9cb8">XrdProofdProofServMgr::Alive</a></div><div class="ttdeci">bool Alive(XrdProofdProtocol *p)</div><div class="ttdoc">Check destroyed status. </div><div class="ttdef"><b>Definition:</b> <a href="XrdProofdProofServMgr_8cxx_source.html#l04625">XrdProofdProofServMgr.cxx:4625</a></div></div>
<div class="ttc" id="XrdProofdNetMgr_8h_html"><div class="ttname"><a href="XrdProofdNetMgr_8h.html">XrdProofdNetMgr.h</a></div></div>
<div class="ttc" id="structProofServEnv__t_html_ae56c69243c25974348f800a355305960"><div class="ttname"><a href="structProofServEnv__t.html#ae56c69243c25974348f800a355305960">ProofServEnv_t::fLogLevel</a></div><div class="ttdeci">int fLogLevel</div><div class="ttdef"><b>Definition:</b> <a href="XrdProofdProofServMgr_8h_source.html#l00059">XrdProofdProofServMgr.h:59</a></div></div>
<div class="ttc" id="XpdSysLogger_8h_html"><div class="ttname"><a href="XpdSysLogger_8h.html">XpdSysLogger.h</a></div></div>
<div class="ttc" id="classXpdEnv_html_a88f25193c975a48136d4ac1ce7251c58"><div class="ttname"><a href="classXpdEnv.html#a88f25193c975a48136d4ac1ce7251c58">XpdEnv::fVerMin</a></div><div class="ttdeci">int fVerMin</div><div class="ttdef"><b>Definition:</b> <a href="XrdProofdProofServMgr_8h_source.html#l00115">XrdProofdProofServMgr.h:115</a></div></div>
<div class="ttc" id="classXrdProofdManager_html_a15d2e414e67bfc0cc4304605a6b509ff"><div class="ttname"><a href="classXrdProofdManager.html#a15d2e414e67bfc0cc4304605a6b509ff">XrdProofdManager::ChangeOwn</a></div><div class="ttdeci">bool ChangeOwn() const</div><div class="ttdef"><b>Definition:</b> <a href="XrdProofdManager_8h_source.html#l00076">XrdProofdManager.h:76</a></div></div>
<div class="ttc" id="classXrdProofdProofServMgr_html_a91f8131e123b4e864bdf0c9f069f0ebd"><div class="ttname"><a href="classXrdProofdProofServMgr.html#a91f8131e123b4e864bdf0c9f069f0ebd">XrdProofdProofServMgr::fRecoverMutex</a></div><div class="ttdeci">XrdSysRecMutex fRecoverMutex</div><div class="ttdef"><b>Definition:</b> <a href="XrdProofdProofServMgr_8h_source.html#l00134">XrdProofdProofServMgr.h:134</a></div></div>
<div class="ttc" id="classXrdProofdProofServMgr_html_a9eb9a2df9609e14f677437aa115718a3"><div class="ttname"><a href="classXrdProofdProofServMgr.html#a9eb9a2df9609e14f677437aa115718a3">XrdProofdProofServMgr::AddSession</a></div><div class="ttdeci">int AddSession(XrdProofdProtocol *p, XrdProofdProofServ *s)</div><div class="ttdoc">Add new active session. </div><div class="ttdef"><b>Definition:</b> <a href="XrdProofdProofServMgr_8cxx_source.html#l00431">XrdProofdProofServMgr.cxx:431</a></div></div>
<div class="ttc" id="XProofProtocol_8h_html_a288e0bf1dc365d01a746a4917afec0a1"><div class="ttname"><a href="XProofProtocol_8h.html#a288e0bf1dc365d01a746a4917afec0a1">kXPD_ClientMaster</a></div><div class="ttdeci">#define kXPD_ClientMaster</div><div class="ttdef"><b>Definition:</b> <a href="XProofProtocol_8h_source.html#l00058">XProofProtocol.h:58</a></div></div>
<div class="ttc" id="classXrdProofdProtocol_html_a40b8bfa9e731284a08eee0d419b6ffd5"><div class="ttname"><a href="classXrdProofdProtocol.html#a40b8bfa9e731284a08eee0d419b6ffd5">XrdProofdProtocol::ProofProtocol</a></div><div class="ttdeci">short int ProofProtocol() const</div><div class="ttdef"><b>Definition:</b> <a href="XrdProofdProtocol_8h_source.html#l00087">XrdProofdProtocol.h:87</a></div></div>
<div class="ttc" id="classXrdProofdManager_html_a77fa4018184954055ab7e17027b4834c"><div class="ttname"><a href="classXrdProofdManager.html#a77fa4018184954055ab7e17027b4834c">XrdProofdManager::DataDir</a></div><div class="ttdeci">const char * DataDir() const</div><div class="ttdef"><b>Definition:</b> <a href="XrdProofdManager_8h_source.html#l00093">XrdProofdManager.h:93</a></div></div>
<div class="ttc" id="classXrdSysPriv_html_aeed545d16718c243d97145085beb8e48"><div class="ttname"><a href="classXrdSysPriv.html#aeed545d16718c243d97145085beb8e48">XrdSysPriv::ChangePerm</a></div><div class="ttdeci">static int ChangePerm(uid_t uid, gid_t gid)</div></div>
<div class="ttc" id="classXrdProofSessionInfo_html_a8e4f80e00d76ce9d2aab4063dd6d85dc"><div class="ttname"><a href="classXrdProofSessionInfo.html#a8e4f80e00d76ce9d2aab4063dd6d85dc">XrdProofSessionInfo::fStatus</a></div><div class="ttdeci">int fStatus</div><div class="ttdef"><b>Definition:</b> <a href="XrdProofdProofServMgr_8h_source.html#l00085">XrdProofdProofServMgr.h:85</a></div></div>
<div class="ttc" id="classXrdProofdProofServMgr_html_a9e0751cbf6fbab427038ebfe478f5afe"><div class="ttname"><a href="classXrdProofdProofServMgr.html#a9e0751cbf6fbab427038ebfe478f5afe">XrdProofdProofServMgr::fNextSessionsCheck</a></div><div class="ttdeci">int fNextSessionsCheck</div><div class="ttdef"><b>Definition:</b> <a href="XrdProofdProofServMgr_8h_source.html#l00165">XrdProofdProofServMgr.h:165</a></div></div>
<div class="ttc" id="classXrdROOT_html_a9c3ee0a503928edaab2675dd4d6638b0"><div class="ttname"><a href="classXrdROOT.html#a9c3ee0a503928edaab2675dd4d6638b0">XrdROOT::SrvProtVers</a></div><div class="ttdeci">kXR_int16 SrvProtVers() const</div><div class="ttdef"><b>Definition:</b> <a href="XrdROOT_8h_source.html#l00082">XrdROOT.h:82</a></div></div>
<div class="ttc" id="classXrdProofdProofServ_html_a711a1ea4a1ce75e2b9b23674ad39b5cf"><div class="ttname"><a href="classXrdProofdProofServ.html#a711a1ea4a1ce75e2b9b23674ad39b5cf">XrdProofdProofServ::GetClientID</a></div><div class="ttdeci">XrdClientID * GetClientID(int cid)</div><div class="ttdoc">Get instance corresponding to cid. </div><div class="ttdef"><b>Definition:</b> <a href="XrdProofdProofServ_8cxx_source.html#l00277">XrdProofdProofServ.cxx:277</a></div></div>
<div class="ttc" id="classXrdProofdProtocol_html_a7aba904b9dbafda64fc01f1280eee7db"><div class="ttname"><a href="classXrdProofdProtocol.html#a7aba904b9dbafda64fc01f1280eee7db">XrdProofdProtocol::AuthProt</a></div><div class="ttdeci">XrdSecProtocol * AuthProt() const</div><div class="ttdef"><b>Definition:</b> <a href="XrdProofdProtocol_8h_source.html#l00094">XrdProofdProtocol.h:94</a></div></div>
<div class="ttc" id="classXrdProofdProofServMgr_html_a0dab770ad59dea7bbfceb63d345af63b"><div class="ttname"><a href="classXrdProofdProofServMgr.html#a0dab770ad59dea7bbfceb63d345af63b">XrdProofdProofServMgr::fParentExecs</a></div><div class="ttdeci">XrdOucString fParentExecs</div><div class="ttdef"><b>Definition:</b> <a href="XrdProofdProofServMgr_8h_source.html#l00158">XrdProofdProofServMgr.h:158</a></div></div>
<div class="ttc" id="classXrdProofdManager_html_a630444a90ac06ef93449f6db64a5b6de"><div class="ttname"><a href="classXrdProofdManager.html#a630444a90ac06ef93449f6db64a5b6de">XrdProofdManager::StageReqRepo</a></div><div class="ttdeci">const char * StageReqRepo() const</div><div class="ttdef"><b>Definition:</b> <a href="XrdProofdManager_8h_source.html#l00097">XrdProofdManager.h:97</a></div></div>
<div class="ttc" id="XrdProofdTrace_8h_html_a16e6f602476f24a2b61f420a39b38527"><div class="ttname"><a href="XrdProofdTrace_8h.html#a16e6f602476f24a2b61f420a39b38527">XPDPRT</a></div><div class="ttdeci">#define XPDPRT(x)</div><div class="ttdef"><b>Definition:</b> <a href="XrdProofdTrace_8h_source.html#l00087">XrdProofdTrace.h:87</a></div></div>
<div class="ttc" id="unionXPClientRequest_html_a7875e257cdd4c874291d5a79d0370670"><div class="ttname"><a href="unionXPClientRequest.html#a7875e257cdd4c874291d5a79d0370670">XPClientRequest::header</a></div><div class="ttdeci">struct ClientRequestHdr header</div><div class="ttdef"><b>Definition:</b> <a href="XProofProtocol_8h_source.html#l00304">XProofProtocol.h:304</a></div></div>
<div class="ttc" id="classXrdProofdProofServMgr_html_a21046ad1c642166890076df140f367a4"><div class="ttname"><a href="classXrdProofdProofServMgr.html#a21046ad1c642166890076df140f367a4">XrdProofdProofServMgr::ProcessSem</a></div><div class="ttdeci">XrdSysSemWait * ProcessSem()</div><div class="ttdef"><b>Definition:</b> <a href="XrdProofdProofServMgr_8h_source.html#l00257">XrdProofdProofServMgr.h:257</a></div></div>
<div class="ttc" id="classXrdProofdClientMgr_html_ac04782f2f8795debb4257c67dd499e3c"><div class="ttname"><a href="classXrdProofdClientMgr.html#ac04782f2f8795debb4257c67dd499e3c">XrdProofdClientMgr::GetNClients</a></div><div class="ttdeci">int GetNClients() const</div><div class="ttdef"><b>Definition:</b> <a href="XrdProofdClientMgr_8h_source.html#l00095">XrdProofdClientMgr.h:95</a></div></div>
<div class="ttc" id="classXrdProofdManager_html_ae3b470855b0b39e2adaa8ae303e5b402"><div class="ttname"><a href="classXrdProofdManager.html#ae3b470855b0b39e2adaa8ae303e5b402">XrdProofdManager::SockPathDir</a></div><div class="ttdeci">const char * SockPathDir() const</div><div class="ttdef"><b>Definition:</b> <a href="XrdProofdManager_8h_source.html#l00090">XrdProofdManager.h:90</a></div></div>
<div class="ttc" id="classXrdProofdProofServ_html_a7ef7d888b3308f42fd4a90558851e55d"><div class="ttname"><a href="classXrdProofdProofServ.html#a7ef7d888b3308f42fd4a90558851e55d">XrdProofdProofServ::CreateUNIXSock</a></div><div class="ttdeci">int CreateUNIXSock(XrdSysError *edest)</div><div class="ttdoc">Create UNIX socket for internal connections. </div><div class="ttdef"><b>Definition:</b> <a href="XrdProofdProofServ_8cxx_source.html#l00691">XrdProofdProofServ.cxx:691</a></div></div>
<div class="ttc" id="classXrdProofdPipe_html_a4d40ad82fde9e49c25085779ad82c27c"><div class="ttname"><a href="classXrdProofdPipe.html#a4d40ad82fde9e49c25085779ad82c27c">XrdProofdPipe::Recv</a></div><div class="ttdeci">int Recv(XpdMsg &amp;msg)</div><div class="ttdoc">Recv message from the pipe. </div><div class="ttdef"><b>Definition:</b> <a href="XrdProofdAux_8cxx_source.html#l01791">XrdProofdAux.cxx:1791</a></div></div>
<div class="ttc" id="classXpdSrvMgrCreateCnt_html"><div class="ttname"><a href="classXpdSrvMgrCreateCnt.html">XpdSrvMgrCreateCnt</a></div><div class="ttdef"><b>Definition:</b> <a href="XrdProofdProofServMgr_8h_source.html#l00311">XrdProofdProofServMgr.h:311</a></div></div>
<div class="ttc" id="XrdProofdProofServMgr_8cxx_html_ab8209323c5ebddb0edaa25f4f6531505"><div class="ttname"><a href="XrdProofdProofServMgr_8cxx.html#ab8209323c5ebddb0edaa25f4f6531505">CountTopMasters</a></div><div class="ttdeci">static int CountTopMasters(const char *, XrdProofdProofServ *ps, void *s)</div><div class="ttdoc">Run thorugh entries to count top-masters. </div><div class="ttdef"><b>Definition:</b> <a href="XrdProofdProofServMgr_8cxx_source.html#l04679">XrdProofdProofServMgr.cxx:4679</a></div></div>
<div class="ttc" id="XrdProofdProofServMgr_8cxx_html_aeb83da043d20a94faa3416a061e885b7"><div class="ttname"><a href="XrdProofdProofServMgr_8cxx.html#aeb83da043d20a94faa3416a061e885b7">XrdProofdProofServRecover</a></div><div class="ttdeci">void * XrdProofdProofServRecover(void *p)</div><div class="ttdoc">Waiting for session to recover after an abrupt shutdown. </div><div class="ttdef"><b>Definition:</b> <a href="XrdProofdProofServMgr_8cxx_source.html#l00240">XrdProofdProofServMgr.cxx:240</a></div></div>
<div class="ttc" id="classXrdProofdProofServMgr_html_a7cb3d5c0d8bcb814202a15e354a5d92b"><div class="ttname"><a href="classXrdProofdProofServMgr.html#a7cb3d5c0d8bcb814202a15e354a5d92b">XrdProofdProofServMgr::fCredsSaver</a></div><div class="ttdeci">XrdSecCredsSaver_t fCredsSaver</div><div class="ttdef"><b>Definition:</b> <a href="XrdProofdProofServMgr_8h_source.html#l00174">XrdProofdProofServMgr.h:174</a></div></div>
<div class="ttc" id="XrdProofSched_8h_html"><div class="ttname"><a href="XrdProofSched_8h.html">XrdProofSched.h</a></div></div>
<div class="ttc" id="classXrdProofdProofServMgr_html_a908238ada084a7362b6083e42c5b62f7"><div class="ttname"><a href="classXrdProofdProofServMgr.html#a908238ada084a7362b6083e42c5b62f7">XrdProofdProofServMgr::CreateProofServEnvFile</a></div><div class="ttdeci">int CreateProofServEnvFile(XrdProofdProtocol *p, void *input, const char *envfn, const char *rcfn)</div><div class="ttdoc">Create in &amp;#39;rcfn&amp;#39; the rootrc file for the proofserv being created return 0 on success, -1 on error. </div><div class="ttdef"><b>Definition:</b> <a href="XrdProofdProofServMgr_8cxx_source.html#l03417">XrdProofdProofServMgr.cxx:3417</a></div></div>
<div class="ttc" id="classXrdROOT_html_a49b703e609515a9b0fdbf90066edac8d"><div class="ttname"><a href="classXrdROOT.html#a49b703e609515a9b0fdbf90066edac8d">XrdROOT::GetVersionCode</a></div><div class="ttdeci">static int GetVersionCode(const char *release)</div><div class="ttdoc">Translate &amp;#39;release&amp;#39; into a version code integer following the rules in $ROOTSYS/include/RVersion.h. </div><div class="ttdef"><b>Definition:</b> <a href="XrdROOT_8cxx_source.html#l00275">XrdROOT.cxx:275</a></div></div>
<div class="ttc" id="classXrdProofdProofServMgr_html_a34c425cdb5ec334f7c3b7acc2fa335e5a0892adb84f4f6028803f0f2404b61eaf"><div class="ttname"><a href="classXrdProofdProofServMgr.html#a34c425cdb5ec334f7c3b7acc2fa335e5a0892adb84f4f6028803f0f2404b61eaf">XrdProofdProofServMgr::kProcessCnt</a></div><div class="ttdef"><b>Definition:</b> <a href="XrdProofdProofServMgr_8h_source.html#l00232">XrdProofdProofServMgr.h:232</a></div></div>
<div class="ttc" id="classXrdProofdProofServMgr_html_a12349f4130cb34fa51fa75d4c4dcb5c2"><div class="ttname"><a href="classXrdProofdProofServMgr.html#a12349f4130cb34fa51fa75d4c4dcb5c2">XrdProofdProofServMgr::ExtractEnv</a></div><div class="ttdeci">void ExtractEnv(char *, XrdOucStream *, XrdOucString &amp;users, XrdOucString &amp;groups, XrdOucString &amp;rcval, XrdOucString &amp;rcnam, int &amp;smi, int &amp;smx, int &amp;vmi, int &amp;vmx, bool &amp;hex)</div><div class="ttdoc">Extract env information from the stream &amp;#39;cfg&amp;#39;. </div><div class="ttdef"><b>Definition:</b> <a href="XrdProofdProofServMgr_8cxx_source.html#l01338">XrdProofdProofServMgr.cxx:1338</a></div></div>
<div class="ttc" id="classXrdProofdAux_html_ae5801323b51316b641483f41dde67aa5"><div class="ttname"><a href="classXrdProofdAux.html#ae5801323b51316b641483f41dde67aa5">XrdProofdAux::ParsePidPath</a></div><div class="ttdeci">static int ParsePidPath(const char *path, XrdOucString &amp;before, XrdOucString &amp;after)</div><div class="ttdoc">Parse a path in the form of &quot;&lt;before&gt;[.&lt;pid&gt;][.&lt;after&gt;]&quot;, filling &amp;#39;rest&amp;#39; and returning &amp;#39;pid&amp;#39;...</div><div class="ttdef"><b>Definition:</b> <a href="XrdProofdAux_8cxx_source.html#l01563">XrdProofdAux.cxx:1563</a></div></div>
<div class="ttc" id="classXrdProofdManager_html_aa1be6f6b31c8a496b4b301d9143f0de8"><div class="ttname"><a href="classXrdProofdManager.html#aa1be6f6b31c8a496b4b301d9143f0de8">XrdProofdManager::ProofSched</a></div><div class="ttdeci">XrdProofSched * ProofSched() const</div><div class="ttdef"><b>Definition:</b> <a href="XrdProofdManager_8h_source.html#l00107">XrdProofdManager.h:107</a></div></div>
<div class="ttc" id="classXrdProofdProofServMgr_html_a0e92367d300d1b4fb4ef15f06a565161"><div class="ttname"><a href="classXrdProofdProofServMgr.html#a0e92367d300d1b4fb4ef15f06a565161">XrdProofdProofServMgr::Destroy</a></div><div class="ttdeci">int Destroy(XrdProofdProtocol *p)</div><div class="ttdoc">Handle a request to shutdown an existing session. </div><div class="ttdef"><b>Definition:</b> <a href="XrdProofdProofServMgr_8cxx_source.html#l02798">XrdProofdProofServMgr.cxx:2798</a></div></div>
<div class="ttc" id="classXrdProofdProofServMgr_html_aaebdf9da139d40cf89c6c98f38941c97ae9a4ce032524114f728898ec5ca413ac"><div class="ttname"><a href="classXrdProofdProofServMgr.html#aaebdf9da139d40cf89c6c98f38941c97ae9a4ce032524114f728898ec5ca413ac">XrdProofdProofServMgr::kClientDisconnect</a></div><div class="ttdef"><b>Definition:</b> <a href="XrdProofdProofServMgr_8h_source.html#l00231">XrdProofdProofServMgr.h:231</a></div></div>
<div class="ttc" id="classXrdProofdProofServ_html_adbac6b3286754cb303806f8d70e58765"><div class="ttname"><a href="classXrdProofdProofServ.html#adbac6b3286754cb303806f8d70e58765">XrdProofdProofServ::UNIXSockPath</a></div><div class="ttdeci">const char * UNIXSockPath() const</div><div class="ttdef"><b>Definition:</b> <a href="XrdProofdProofServ_8h_source.html#l00206">XrdProofdProofServ.h:206</a></div></div>
<div class="ttc" id="classXrdProofdAux_html_ad76b79992c4bb4774856074413f591c5"><div class="ttname"><a href="classXrdProofdAux.html#ad76b79992c4bb4774856074413f591c5">XrdProofdAux::SymLink</a></div><div class="ttdeci">static int SymLink(const char *path, const char *link)</div><div class="ttdoc">Create a symlink &amp;#39;link&amp;#39; to &amp;#39;path&amp;#39; Return 0 in case of success, -1 in case of error. </div><div class="ttdef"><b>Definition:</b> <a href="XrdProofdAux_8cxx_source.html#l00695">XrdProofdAux.cxx:695</a></div></div>
<div class="ttc" id="classXrdProofdProofServ_html_a70449875c8de76c6ac32f14020c0f94b"><div class="ttname"><a href="classXrdProofdProofServ.html#a70449875c8de76c6ac32f14020c0f94b">XrdProofdProofServ::SetProtocol</a></div><div class="ttdeci">void SetProtocol(XrdProofdProtocol *p)</div><div class="ttdef"><b>Definition:</b> <a href="XrdProofdProofServ_8h_source.html#l00176">XrdProofdProofServ.h:176</a></div></div>
<div class="ttc" id="classXrdProofdManager_html_adef641b27f2dc86766634d156cb82476"><div class="ttname"><a href="classXrdProofdManager.html#adef641b27f2dc86766634d156cb82476">XrdProofdManager::GroupsMgr</a></div><div class="ttdeci">XrdProofGroupMgr * GroupsMgr() const</div><div class="ttdef"><b>Definition:</b> <a href="XrdProofdManager_8h_source.html#l00106">XrdProofdManager.h:106</a></div></div>
<div class="ttc" id="classXrdProofdClient_html_a3cbe604999cdb44ae9d0ec833ffa5900"><div class="ttname"><a href="classXrdProofdClient.html#a3cbe604999cdb44ae9d0ec833ffa5900">XrdProofdClient::User</a></div><div class="ttdeci">const char * User() const</div><div class="ttdef"><b>Definition:</b> <a href="XrdProofdClient_8h_source.html#l00052">XrdProofdClient.h:52</a></div></div>
<div class="ttc" id="classXrdProofdProofServMgr_html_a43977fa295e3c2755edcb43dd95de1de"><div class="ttname"><a href="classXrdProofdProofServMgr.html#a43977fa295e3c2755edcb43dd95de1de">XrdProofdProofServMgr::FormFileNameInSessionDir</a></div><div class="ttdeci">void FormFileNameInSessionDir(XrdProofdProtocol *p, XrdProofdProofServ *xps, const char *sessiondir, const char *extension, XrdOucString &amp;outfn)</div><div class="ttdef"><b>Definition:</b> <a href="XrdProofdProofServMgr_8cxx_source.html#l03196">XrdProofdProofServMgr.cxx:3196</a></div></div>
<div class="ttc" id="classXrdProofdProofServMgr_html_a816c7b460a1e393d9f5156af09169940"><div class="ttname"><a href="classXrdProofdProofServMgr.html#a816c7b460a1e393d9f5156af09169940">XrdProofdProofServMgr::CreateAdminPath</a></div><div class="ttdeci">int CreateAdminPath(XrdProofdProofServ *xps, XrdProofdProtocol *p, int pid, XrdOucString &amp;emsg)</div><div class="ttdoc">Create the admin path for the starting session Return 0 on success, -1 on error (error message in &amp;#39;em...</div><div class="ttdef"><b>Definition:</b> <a href="XrdProofdProofServMgr_8cxx_source.html#l02304">XrdProofdProofServMgr.cxx:2304</a></div></div>
<div class="ttc" id="classXrdProofdProtocol_html_a239a481ea6f6e555d46e19a2e8675ec4"><div class="ttname"><a href="classXrdProofdProtocol.html#a239a481ea6f6e555d46e19a2e8675ec4">XrdProofdProtocol::Argp</a></div><div class="ttdeci">XrdBuffer * Argp() const</div><div class="ttdef"><b>Definition:</b> <a href="XrdProofdProtocol_8h_source.html#l00092">XrdProofdProtocol.h:92</a></div></div>
<div class="ttc" id="classXrdProofSessionInfo_html_ad7e7a2c24051c1bb8d19291035232782"><div class="ttname"><a href="classXrdProofSessionInfo.html#ad7e7a2c24051c1bb8d19291035232782">XrdProofSessionInfo::XrdProofSessionInfo</a></div><div class="ttdeci">XrdProofSessionInfo(XrdProofdClient *c, XrdProofdProofServ *s)</div><div class="ttdoc">Construct from &amp;#39;c&amp;#39; and &amp;#39;s&amp;#39;. </div><div class="ttdef"><b>Definition:</b> <a href="XrdProofdProofServMgr_8cxx_source.html#l04760">XrdProofdProofServMgr.cxx:4760</a></div></div>
<div class="ttc" id="classXrdProofdPriorityMgr_html_a338dd700d8b1ce5d1cceb56e5b81ea43"><div class="ttname"><a href="classXrdProofdPriorityMgr.html#a338dd700d8b1ce5d1cceb56e5b81ea43">XrdProofdPriorityMgr::SetProcessPriority</a></div><div class="ttdeci">int SetProcessPriority(int pid, const char *usr, int &amp;dp)</div><div class="ttdoc">Change priority of process pid belonging to user, if needed. </div><div class="ttdef"><b>Definition:</b> <a href="XrdProofdPriorityMgr_8cxx_source.html#l00534">XrdProofdPriorityMgr.cxx:534</a></div></div>
<div class="ttc" id="classXpdEnv_html_abe05770535de8187358d757e532da911"><div class="ttname"><a href="classXpdEnv.html#abe05770535de8187358d757e532da911">XpdEnv::fName</a></div><div class="ttdeci">XrdOucString fName</div><div class="ttdef"><b>Definition:</b> <a href="XrdProofdProofServMgr_8h_source.html#l00109">XrdProofdProofServMgr.h:109</a></div></div>
<div class="ttc" id="classXrdProofSessionInfo_html_a5cafed559ea3c880d42d364a8d8e5d95"><div class="ttname"><a href="classXrdProofSessionInfo.html#a5cafed559ea3c880d42d364a8d8e5d95">XrdProofSessionInfo::fSrvType</a></div><div class="ttdeci">int fSrvType</div><div class="ttdef"><b>Definition:</b> <a href="XrdProofdProofServMgr_8h_source.html#l00083">XrdProofdProofServMgr.h:83</a></div></div>
<div class="ttc" id="classXrdProofdProtocol_html_afa853dd9e1f2cfca4d3e7650cbd42a98"><div class="ttname"><a href="classXrdProofdProtocol.html#afa853dd9e1f2cfca4d3e7650cbd42a98">XrdProofdProtocol::Pid</a></div><div class="ttdeci">int Pid() const</div><div class="ttdef"><b>Definition:</b> <a href="XrdProofdProtocol_8h_source.html#l00084">XrdProofdProtocol.h:84</a></div></div>
<div class="ttc" id="classXrdProofdProofServMgr_html_af99918358c943b44bb636cf70b97671e"><div class="ttname"><a href="classXrdProofdProofServMgr.html#af99918358c943b44bb636cf70b97671e">XrdProofdProofServMgr::fProofServEnvs</a></div><div class="ttdeci">std::list&lt; XpdEnv &gt; fProofServEnvs</div><div class="ttdef"><b>Definition:</b> <a href="XrdProofdProofServMgr_8h_source.html#l00141">XrdProofdProofServMgr.h:141</a></div></div>
<div class="ttc" id="classXrdProofdProofServMgr_html_a5543f787eb99df299babf19e0194835d"><div class="ttname"><a href="classXrdProofdProofServMgr.html#a5543f787eb99df299babf19e0194835d">XrdProofdProofServMgr::IsReconnecting</a></div><div class="ttdeci">bool IsReconnecting()</div><div class="ttdoc">Return true if in reconnection state, i.e. </div><div class="ttdef"><b>Definition:</b> <a href="XrdProofdProofServMgr_8cxx_source.html#l04594">XrdProofdProofServMgr.cxx:4594</a></div></div>
<div class="ttc" id="classXrdProofSessionInfo_html_aff265c0a3cfd2f5c5fdf081a7bc3f067"><div class="ttname"><a href="classXrdProofSessionInfo.html#aff265c0a3cfd2f5c5fdf081a7bc3f067">XrdProofSessionInfo::fSrvProtVers</a></div><div class="ttdeci">int fSrvProtVers</div><div class="ttdef"><b>Definition:</b> <a href="XrdProofdProofServMgr_8h_source.html#l00096">XrdProofdProofServMgr.h:96</a></div></div>
<div class="ttc" id="classXrdProofdProofServMgr_html_a6d168474303d8b503001502f4f5ad306"><div class="ttname"><a href="classXrdProofdProofServMgr.html#a6d168474303d8b503001502f4f5ad306">XrdProofdProofServMgr::fTermAdminPath</a></div><div class="ttdeci">XrdOucString fTermAdminPath</div><div class="ttdef"><b>Definition:</b> <a href="XrdProofdProofServMgr_8h_source.html#l00168">XrdProofdProofServMgr.h:168</a></div></div>
<div class="ttc" id="classXrdProofdProofServMgr_html_af244f1c4fd9592313e3cfc4bdeb64aaf"><div class="ttname"><a href="classXrdProofdProofServMgr.html#af244f1c4fd9592313e3cfc4bdeb64aaf">XrdProofdProofServMgr::fEnvsMutex</a></div><div class="ttdeci">XrdSysRecMutex fEnvsMutex</div><div class="ttdef"><b>Definition:</b> <a href="XrdProofdProofServMgr_8h_source.html#l00135">XrdProofdProofServMgr.h:135</a></div></div>
<div class="ttc" id="classXrdProofdPipe_html_a5aa4739df39754c05bee043d99d74b00"><div class="ttname"><a href="classXrdProofdPipe.html#a5aa4739df39754c05bee043d99d74b00">XrdProofdPipe::Close</a></div><div class="ttdeci">void Close()</div><div class="ttdoc">If open, close and invalidated the pipe descriptors. </div><div class="ttdef"><b>Definition:</b> <a href="XrdProofdAux_8cxx_source.html#l01748">XrdProofdAux.cxx:1748</a></div></div>
<div class="ttc" id="classXrdProofdProofServ_html_a26e445b7ebf718988608f149309c6fa4"><div class="ttname"><a href="classXrdProofdProofServ.html#a26e445b7ebf718988608f149309c6fa4">XrdProofdProofServ::DeleteUNIXSock</a></div><div class="ttdeci">void DeleteUNIXSock()</div><div class="ttdoc">Delete the current UNIX socket. </div><div class="ttdef"><b>Definition:</b> <a href="XrdProofdProofServ_8cxx_source.html#l00255">XrdProofdProofServ.cxx:255</a></div></div>
<div class="ttc" id="classXrdProofdNetMgr_html_a1bf0698adc9754833d617a1b2d7361ca"><div class="ttname"><a href="classXrdProofdNetMgr.html#a1bf0698adc9754833d617a1b2d7361ca">XrdProofdNetMgr::WorkerUsrCfg</a></div><div class="ttdeci">bool WorkerUsrCfg() const</div><div class="ttdef"><b>Definition:</b> <a href="XrdProofdNetMgr_8h_source.html#l00081">XrdProofdNetMgr.h:81</a></div></div>
<div class="ttc" id="namespaceTGeant4Unit_html_a5d450e80998065902b102dca2a69066a"><div class="ttname"><a href="namespaceTGeant4Unit.html#a5d450e80998065902b102dca2a69066a">TGeant4Unit::s</a></div><div class="ttdeci">static constexpr double s</div><div class="ttdef"><b>Definition:</b> <a href="TGeant4SystemOfUnits_8h_source.html#l00162">TGeant4SystemOfUnits.h:162</a></div></div>
<div class="ttc" id="classXrdProofdProofServ_html_a70b3e722619f6b005fff6ed9937da178"><div class="ttname"><a href="classXrdProofdProofServ.html#a70b3e722619f6b005fff6ed9937da178">XrdProofdProofServ::SetSrvType</a></div><div class="ttdeci">void SetSrvType(int id)</div><div class="ttdef"><b>Definition:</b> <a href="XrdProofdProofServ_8h_source.html#l00183">XrdProofdProofServ.h:183</a></div></div>
<div class="ttc" id="structXpdManagerCron__t_html_ab30050b19479fd7e6e6cbeffc5030a6c"><div class="ttname"><a href="structXpdManagerCron__t.html#ab30050b19479fd7e6e6cbeffc5030a6c">XpdManagerCron_t::fClientMgr</a></div><div class="ttdeci">XrdProofdClientMgr * fClientMgr</div><div class="ttdef"><b>Definition:</b> <a href="XrdProofdManager_8h_source.html#l00213">XrdProofdManager.h:213</a></div></div>
<div class="ttc" id="structProofServEnv__t_html_a88002c75764b173de52afd5f9b3c6c74"><div class="ttname"><a href="structProofServEnv__t.html#a88002c75764b173de52afd5f9b3c6c74">ProofServEnv_t::fLogFile</a></div><div class="ttdeci">XrdOucString fLogFile</div><div class="ttdef"><b>Definition:</b> <a href="XrdProofdProofServMgr_8h_source.html#l00061">XrdProofdProofServMgr.h:61</a></div></div>
<div class="ttc" id="classXrdProofdProofServMgr_html_aa240763e1eeb263e403b7c5cd8aca2ae"><div class="ttname"><a href="classXrdProofdProofServMgr.html#aa240763e1eeb263e403b7c5cd8aca2ae">XrdProofdProofServMgr::CheckActiveSessions</a></div><div class="ttdeci">int CheckActiveSessions(bool verify=1)</div><div class="ttdoc">Go through the active sessions admin path and make sure sessions are alive. </div><div class="ttdef"><b>Definition:</b> <a href="XrdProofdProofServMgr_8cxx_source.html#l00897">XrdProofdProofServMgr.cxx:897</a></div></div>
<div class="ttc" id="classXrdProofdProofServ_html_a85958cf8241aee02a376befe6ab98e98"><div class="ttname"><a href="classXrdProofdProofServ.html#a85958cf8241aee02a376befe6ab98e98">XrdProofdProofServ::Ordinal</a></div><div class="ttdeci">const char * Ordinal() const</div><div class="ttdef"><b>Definition:</b> <a href="XrdProofdProofServ_8h_source.html#l00146">XrdProofdProofServ.h:146</a></div></div>
<div class="ttc" id="classXrdPoll_html_aadc5e217147581760a9c4e74cedea8cf"><div class="ttname"><a href="classXrdPoll.html#aadc5e217147581760a9c4e74cedea8cf">XrdPoll::Attach</a></div><div class="ttdeci">static int Attach(XrdLink *lp)</div></div>
<div class="ttc" id="classXrdProofdProofServ_html_ac4a8e8c6ff235136af0486340aced428"><div class="ttname"><a href="classXrdProofdProofServ.html#ac4a8e8c6ff235136af0486340aced428">XrdProofdProofServ::SetUNIXSockPath</a></div><div class="ttdeci">void SetUNIXSockPath(const char *s)</div><div class="ttdef"><b>Definition:</b> <a href="XrdProofdProofServ_8h_source.html#l00187">XrdProofdProofServ.h:187</a></div></div>
<div class="ttc" id="classXrdProofdProofServMgr_html_ace73dbf67431d3004992eaddb709d498"><div class="ttname"><a href="classXrdProofdProofServMgr.html#ace73dbf67431d3004992eaddb709d498">XrdProofdProofServMgr::TouchSession</a></div><div class="ttdeci">int TouchSession(const char *fpid, const char *path=0)</div><div class="ttdoc">Update the access time for the session pid file to the current time. </div><div class="ttdef"><b>Definition:</b> <a href="XrdProofdProofServMgr_8cxx_source.html#l00579">XrdProofdProofServMgr.cxx:579</a></div></div>
<div class="ttc" id="classXrdProofdProofServMgr_html_a909fb1d3452ad38d9cc83782f777d07c"><div class="ttname"><a href="classXrdProofdProofServMgr.html#a909fb1d3452ad38d9cc83782f777d07c">XrdProofdProofServMgr::fActiveSessions</a></div><div class="ttdeci">std::list&lt; XrdProofdProofServ * &gt; fActiveSessions</div><div class="ttdef"><b>Definition:</b> <a href="XrdProofdProofServMgr_8h_source.html#l00171">XrdProofdProofServMgr.h:171</a></div></div>
<div class="ttc" id="XrdProofGroup_8h_html"><div class="ttname"><a href="XrdProofGroup_8h.html">XrdProofGroup.h</a></div></div>
<div class="ttc" id="classXrdProofdProtocol_html_a5b43be3ebd590059db344b327508fe77"><div class="ttname"><a href="classXrdProofdProtocol.html#a5b43be3ebd590059db344b327508fe77">XrdProofdProtocol::EUidAtStartup</a></div><div class="ttdeci">static int EUidAtStartup()</div><div class="ttdef"><b>Definition:</b> <a href="XrdProofdProtocol_8h_source.html#l00114">XrdProofdProtocol.h:114</a></div></div>
<div class="ttc" id="classXpdMsg_html"><div class="ttname"><a href="classXpdMsg.html">XpdMsg</a></div><div class="ttdef"><b>Definition:</b> <a href="XrdProofdAux_8h_source.html#l00174">XrdProofdAux.h:174</a></div></div>
<div class="ttc" id="classXrdProofUI_html_a37a60d9bb41f26a8a79bb1eab51c78f0"><div class="ttname"><a href="classXrdProofUI.html#a37a60d9bb41f26a8a79bb1eab51c78f0">XrdProofUI::fUser</a></div><div class="ttdeci">XrdOucString fUser</div><div class="ttdef"><b>Definition:</b> <a href="XrdProofdAux_8h_source.html#l00040">XrdProofdAux.h:40</a></div></div>
<div class="ttc" id="classXrdProofdConfig_html_a604213f0bcb2d2a3494610fedda8e975"><div class="ttname"><a href="classXrdProofdConfig.html#a604213f0bcb2d2a3494610fedda8e975">XrdProofdConfig::fEDest</a></div><div class="ttdeci">XrdSysError * fEDest</div><div class="ttdef"><b>Definition:</b> <a href="XrdProofdConfig_8h_source.html#l00040">XrdProofdConfig.h:40</a></div></div>
<div class="ttc" id="classXrdProofdProofServMgr_html_a44783c0d21e69a49e703e689238714e7"><div class="ttname"><a href="classXrdProofdProofServMgr.html#a44783c0d21e69a49e703e689238714e7">XrdProofdProofServMgr::DisconnectFromProofServ</a></div><div class="ttdeci">void DisconnectFromProofServ(int pid)</div><div class="ttdoc">Change reconnecting status. </div><div class="ttdef"><b>Definition:</b> <a href="XrdProofdProofServMgr_8cxx_source.html#l04669">XrdProofdProofServMgr.cxx:4669</a></div></div>
<div class="ttc" id="classXrdProofdProofServ_html_a26dbf31e4a3ab5dc7751b6773c45a5d7"><div class="ttname"><a href="classXrdProofdProofServ.html#a26dbf31e4a3ab5dc7751b6773c45a5d7">XrdProofdProofServ::SetGroup</a></div><div class="ttdeci">void SetGroup(const char *g)</div><div class="ttdef"><b>Definition:</b> <a href="XrdProofdProofServ_8h_source.html#l00170">XrdProofdProofServ.h:170</a></div></div>
<div class="ttc" id="classXpdEnv_html_a6bc4c90b8cc7074d6a8ee356c5de481d"><div class="ttname"><a href="classXpdEnv.html#a6bc4c90b8cc7074d6a8ee356c5de481d">XpdEnv::Matches</a></div><div class="ttdeci">int Matches(const char *usr, const char *grp, int ver=-1)</div><div class="ttdoc">Check if this env applies to &amp;#39;usr&amp;#39;, &amp;#39;grp, &amp;#39;ver&amp;#39;. </div><div class="ttdef"><b>Definition:</b> <a href="XrdProofdProofServMgr_8cxx_source.html#l05016">XrdProofdProofServMgr.cxx:5016</a></div></div>
<div class="ttc" id="classXrdProofdProofServMgr_html_a34c425cdb5ec334f7c3b7acc2fa335e5a9f76e372c8b07c5c30efe4616afb6724"><div class="ttname"><a href="classXrdProofdProofServMgr.html#a34c425cdb5ec334f7c3b7acc2fa335e5a9f76e372c8b07c5c30efe4616afb6724">XrdProofdProofServMgr::kCreateCnt</a></div><div class="ttdef"><b>Definition:</b> <a href="XrdProofdProofServMgr_8h_source.html#l00232">XrdProofdProofServMgr.h:232</a></div></div>
<div class="ttc" id="XrdProofdTrace_8h_html_a7c31822912a8d0dc9bfd544097b29e12"><div class="ttname"><a href="XrdProofdTrace_8h.html#a7c31822912a8d0dc9bfd544097b29e12">XPDLOC</a></div><div class="ttdeci">#define XPDLOC(d, x)</div><div class="ttdef"><b>Definition:</b> <a href="XrdProofdTrace_8h_source.html#l00071">XrdProofdTrace.h:71</a></div></div>
<div class="ttc" id="classXrdProofSched_html_a90df9f0af902f68f8cf248f52e68c2f4"><div class="ttname"><a href="classXrdProofSched.html#a90df9f0af902f68f8cf248f52e68c2f4">XrdProofSched::Pipe</a></div><div class="ttdeci">XrdProofdPipe * Pipe()</div><div class="ttdef"><b>Definition:</b> <a href="XrdProofSched_8h_source.html#l00108">XrdProofSched.h:108</a></div></div>
<div class="ttc" id="classXrdProofdProofServMgr_html_ab1e3069da69611967716f0cecd93dedc"><div class="ttname"><a href="classXrdProofdProofServMgr.html#ab1e3069da69611967716f0cecd93dedc">XrdProofdProofServMgr::fRecoverClients</a></div><div class="ttdeci">std::list&lt; XpdClientSessions * &gt; * fRecoverClients</div><div class="ttdef"><b>Definition:</b> <a href="XrdProofdProofServMgr_8h_source.html#l00172">XrdProofdProofServMgr.h:172</a></div></div>
<div class="ttc" id="classXrdProofdProofServMgr_html_a501f91690e366de7dd5c8a859a92242a"><div class="ttname"><a href="classXrdProofdProofServMgr.html#a501f91690e366de7dd5c8a859a92242a">XrdProofdProofServMgr::fPipe</a></div><div class="ttdeci">XrdProofdPipe fPipe</div><div class="ttdef"><b>Definition:</b> <a href="XrdProofdProofServMgr_8h_source.html#l00147">XrdProofdProofServMgr.h:147</a></div></div>
<div class="ttc" id="classXrdProofdManager_html_ae598fde488562ef54ee12a3a3135848c"><div class="ttname"><a href="classXrdProofdManager.html#ae598fde488562ef54ee12a3a3135848c">XrdProofdManager::NameSpace</a></div><div class="ttdeci">const char * NameSpace() const</div><div class="ttdef"><b>Definition:</b> <a href="XrdProofdManager_8h_source.html#l00086">XrdProofdManager.h:86</a></div></div>
<div class="ttc" id="classXrdProofdProofServ_html_a3dbee8f1d9ea9677ef49ad0a01fa72db"><div class="ttname"><a href="classXrdProofdProofServ.html#a3dbee8f1d9ea9677ef49ad0a01fa72db">XrdProofdProofServ::SetROOT</a></div><div class="ttdeci">void SetROOT(XrdROOT *r)</div><div class="ttdef"><b>Definition:</b> <a href="XrdProofdProofServ_8h_source.html#l00178">XrdProofdProofServ.h:178</a></div></div>
<div class="ttc" id="XProofProtocol_8h_html_af90b47a2dd37c58ac6f67e16c279e27ba23e2cb17a38a083e0d2fc2744f167d79"><div class="ttname"><a href="XProofProtocol_8h.html#af90b47a2dd37c58ac6f67e16c279e27ba23e2cb17a38a083e0d2fc2744f167d79">kXPD_msg</a></div><div class="ttdef"><b>Definition:</b> <a href="XProofProtocol_8h_source.html#l00172">XProofProtocol.h:172</a></div></div>
<div class="ttc" id="classXrdProofdProofServMgr_html_afddc4c3251e7293b77ca5f8b4dbe0595"><div class="ttname"><a href="classXrdProofdProofServMgr.html#afddc4c3251e7293b77ca5f8b4dbe0595">XrdProofdProofServMgr::fCurrentSessions</a></div><div class="ttdeci">int fCurrentSessions</div><div class="ttdef"><b>Definition:</b> <a href="XrdProofdProofServMgr_8h_source.html#l00161">XrdProofdProofServMgr.h:161</a></div></div>
<div class="ttc" id="classXrdProofSessionInfo_html_a00cec64eca20031f79114f737918563f"><div class="ttname"><a href="classXrdProofSessionInfo.html#a00cec64eca20031f79114f737918563f">XrdProofSessionInfo::FillProofServ</a></div><div class="ttdeci">void FillProofServ(XrdProofdProofServ &amp;s, XrdROOTMgr *rmgr)</div><div class="ttdoc">Fill &amp;#39;s&amp;#39; fields using the stored info. </div><div class="ttdef"><b>Definition:</b> <a href="XrdProofdProofServMgr_8cxx_source.html#l04788">XrdProofdProofServMgr.cxx:4788</a></div></div>
<div class="ttc" id="classXrdROOTMgr_html"><div class="ttname"><a href="classXrdROOTMgr.html">XrdROOTMgr</a></div><div class="ttdef"><b>Definition:</b> <a href="XrdROOT_8h_source.html#l00097">XrdROOT.h:97</a></div></div>
<div class="ttc" id="classXrdProofdProofServMgr_html_a103000bfb9aff60cb72df61a1f81227e"><div class="ttname"><a href="classXrdProofdProofServMgr.html#a103000bfb9aff60cb72df61a1f81227e">XrdProofdProofServMgr::NextSessionsCheck</a></div><div class="ttdeci">int NextSessionsCheck()</div><div class="ttdef"><b>Definition:</b> <a href="XrdProofdProofServMgr_8h_source.html#l00245">XrdProofdProofServMgr.h:245</a></div></div>
<div class="ttc" id="classXrdProofdProofServMgr_html_ab518387c7aac71be2a03214b83f10e71"><div class="ttname"><a href="classXrdProofdProofServMgr.html#ab518387c7aac71be2a03214b83f10e71">XrdProofdProofServMgr::RegisterDirectives</a></div><div class="ttdeci">void RegisterDirectives()</div><div class="ttdoc">Register directives for configuration. </div><div class="ttdef"><b>Definition:</b> <a href="XrdProofdProofServMgr_8cxx_source.html#l01168">XrdProofdProofServMgr.cxx:1168</a></div></div>
<div class="ttc" id="classXrdProofdConfig_html"><div class="ttname"><a href="classXrdProofdConfig.html">XrdProofdConfig</a></div><div class="ttdef"><b>Definition:</b> <a href="XrdProofdConfig_8h_source.html#l00031">XrdProofdConfig.h:31</a></div></div>
<div class="ttc" id="structXpdManagerCron__t_html_ad59ee4aee440c474f8ad13d5f6b4db2d"><div class="ttname"><a href="structXpdManagerCron__t.html#ad59ee4aee440c474f8ad13d5f6b4db2d">XpdManagerCron_t::fProofSched</a></div><div class="ttdeci">XrdProofSched * fProofSched</div><div class="ttdef"><b>Definition:</b> <a href="XrdProofdManager_8h_source.html#l00215">XrdProofdManager.h:215</a></div></div>
<div class="ttc" id="classXpdClientSessions_html_ad416d664f0ee7bfcece4e30e0f796346"><div class="ttname"><a href="classXpdClientSessions.html#ad416d664f0ee7bfcece4e30e0f796346">XpdClientSessions::fProofServs</a></div><div class="ttdeci">std::list&lt; XrdProofdProofServ * &gt; fProofServs</div><div class="ttdef"><b>Definition:</b> <a href="XrdProofdProofServMgr_8h_source.html#l00073">XrdProofdProofServMgr.h:73</a></div></div>
<div class="ttc" id="classXrdProofdProofServMgr_html_addb2f49af9028ad498e4f0711eb47b33"><div class="ttname"><a href="classXrdProofdProofServMgr.html#addb2f49af9028ad498e4f0711eb47b33">XrdProofdProofServMgr::Config</a></div><div class="ttdeci">int Config(bool rcf=0)</div><div class="ttdoc">Run configuration and parse the entered config directives. </div><div class="ttdef"><b>Definition:</b> <a href="XrdProofdProofServMgr_8cxx_source.html#l00322">XrdProofdProofServMgr.cxx:322</a></div></div>
<div class="ttc" id="classXrdProofdProofServMgr_html_aaebdf9da139d40cf89c6c98f38941c97af81d5f6e2cc719e8e1f0fbe92ee14f93"><div class="ttname"><a href="classXrdProofdProofServMgr.html#aaebdf9da139d40cf89c6c98f38941c97af81d5f6e2cc719e8e1f0fbe92ee14f93">XrdProofdProofServMgr::kCleanSessions</a></div><div class="ttdef"><b>Definition:</b> <a href="XrdProofdProofServMgr_8h_source.html#l00231">XrdProofdProofServMgr.h:231</a></div></div>
<div class="ttc" id="classXrdProofdProofServ_html_aa48a1e58fb1d7a0c0cefdb9ded292d07"><div class="ttname"><a href="classXrdProofdProofServ.html#aa48a1e58fb1d7a0c0cefdb9ded292d07">XrdProofdProofServ::SetFileout</a></div><div class="ttdeci">void SetFileout(const char *f)</div><div class="ttdef"><b>Definition:</b> <a href="XrdProofdProofServ_8h_source.html#l00169">XrdProofdProofServ.h:169</a></div></div>
<div class="ttc" id="XrdPoll_8hh_html"><div class="ttname"><a href="XrdPoll_8hh.html">XrdPoll.hh</a></div></div>
<div class="ttc" id="classXrdSrvBuffer_html_a35e9e522481d1e4104463e7a7b9798d6"><div class="ttname"><a href="classXrdSrvBuffer.html#a35e9e522481d1e4104463e7a7b9798d6">XrdSrvBuffer::fBuff</a></div><div class="ttdeci">char * fBuff</div><div class="ttdef"><b>Definition:</b> <a href="XrdProofdProofServ_8h_source.html#l00049">XrdProofdProofServ.h:49</a></div></div>
<div class="ttc" id="classXrdProofdProofServMgr_html_a0624277b0d6c9aeecdbc3095b1471435"><div class="ttname"><a href="classXrdProofdProofServMgr.html#a0624277b0d6c9aeecdbc3095b1471435">XrdProofdProofServMgr::Attach</a></div><div class="ttdeci">int Attach(XrdProofdProtocol *p)</div><div class="ttdoc">Handle a request to attach to an existing session. </div><div class="ttdef"><b>Definition:</b> <a href="XrdProofdProofServMgr_8cxx_source.html#l01557">XrdProofdProofServMgr.cxx:1557</a></div></div>
<div class="ttc" id="classXrdProofdProofServ_html_a4531e00216dd973a625c6d6b27c5f0a9"><div class="ttname"><a href="classXrdProofdProofServ.html#a4531e00216dd973a625c6d6b27c5f0a9">XrdProofdProofServ::IsPLite</a></div><div class="ttdeci">bool IsPLite() const</div><div class="ttdef"><b>Definition:</b> <a href="XrdProofdProofServ_8h_source.html#l00142">XrdProofdProofServ.h:142</a></div></div>
<div class="ttc" id="classXrdProofdProofServ_html_ac2996eb131d395518b59196e073fb83c"><div class="ttname"><a href="classXrdProofdProofServ.html#ac2996eb131d395518b59196e073fb83c">XrdProofdProofServ::GetNClients</a></div><div class="ttdeci">int GetNClients(bool check)</div><div class="ttdoc">Get the number of connected clients. </div><div class="ttdef"><b>Definition:</b> <a href="XrdProofdProofServ_8cxx_source.html#l00380">XrdProofdProofServ.cxx:380</a></div></div>
<div class="ttc" id="classXrdProofdProofServMgr_html_acaa26797a7f4b194dd8f3f5d39be11af"><div class="ttname"><a href="classXrdProofdProofServMgr.html#acaa26797a7f4b194dd8f3f5d39be11af">XrdProofdProofServMgr::fProofServRCs</a></div><div class="ttdeci">std::list&lt; XpdEnv &gt; fProofServRCs</div><div class="ttdef"><b>Definition:</b> <a href="XrdProofdProofServMgr_8h_source.html#l00142">XrdProofdProofServMgr.h:142</a></div></div>
<div class="ttc" id="classXrdProofdProofServMgr_html_aeb9a5a16403495ef007aa9717ebaf482"><div class="ttname"><a href="classXrdProofdProofServMgr.html#aeb9a5a16403495ef007aa9717ebaf482">XrdProofdProofServMgr::CheckFrequency</a></div><div class="ttdeci">int CheckFrequency() const</div><div class="ttdef"><b>Definition:</b> <a href="XrdProofdProofServMgr_8h_source.html#l00241">XrdProofdProofServMgr.h:241</a></div></div>
<div class="ttc" id="XProofProtocol_8h_html_ad7a933edf8c125412fd985f6f2bc771e"><div class="ttname"><a href="XProofProtocol_8h.html#ad7a933edf8c125412fd985f6f2bc771e">kXPD_MasterWorker</a></div><div class="ttdeci">#define kXPD_MasterWorker</div><div class="ttdef"><b>Definition:</b> <a href="XProofProtocol_8h_source.html#l00060">XProofProtocol.h:60</a></div></div>
<div class="ttc" id="XProofProtocol_8h_html_a106fb425aa6ca0edb82300aeed56691ca143f9d85b3baf54ea98a183034caa868"><div class="ttname"><a href="XProofProtocol_8h.html#a106fb425aa6ca0edb82300aeed56691ca143f9d85b3baf54ea98a183034caa868">kXP_destroy</a></div><div class="ttdef"><b>Definition:</b> <a href="XProofProtocol_8h_source.html#l00035">XProofProtocol.h:35</a></div></div>
<div class="ttc" id="XrdProofdProofServMgr_8cxx_html_ae6f1dbe8fdbfff0847439c11076a4ac2"><div class="ttname"><a href="XrdProofdProofServMgr_8cxx.html#ae6f1dbe8fdbfff0847439c11076a4ac2">fManagerCron</a></div><div class="ttdeci">static XpdManagerCron_t fManagerCron</div><div class="ttdef"><b>Definition:</b> <a href="XrdProofdProofServMgr_8cxx_source.html#l00069">XrdProofdProofServMgr.cxx:69</a></div></div>
<div class="ttc" id="Object_8C_html_ac15f01b9c6407e1312dfc196ad4e0870"><div class="ttname"><a href="Object_8C.html#ac15f01b9c6407e1312dfc196ad4e0870">r</a></div><div class="ttdeci">ROOT::R::TRInterface &amp; r</div><div class="ttdef"><b>Definition:</b> <a href="Object_8C_source.html#l00004">Object.C:4</a></div></div>
<div class="ttc" id="classXrdProofdAux_html_a6903e0e276399459b0a8d11b737ea0df"><div class="ttname"><a href="classXrdProofdAux.html#a6903e0e276399459b0a8d11b737ea0df">XrdProofdAux::ProofRequestTypes</a></div><div class="ttdeci">static const char * ProofRequestTypes(int type)</div><div class="ttdoc">Translates the proof request type in a human readable string. </div><div class="ttdef"><b>Definition:</b> <a href="XrdProofdAux_8cxx_source.html#l00070">XrdProofdAux.cxx:70</a></div></div>
<div class="ttc" id="structXPClientProofRequest_html_a52ac878680aee8ecde1c97feb1ccfd87"><div class="ttname"><a href="structXPClientProofRequest.html#a52ac878680aee8ecde1c97feb1ccfd87">XPClientProofRequest::int1</a></div><div class="ttdeci">kXR_int32 int1</div><div class="ttdef"><b>Definition:</b> <a href="XProofProtocol_8h_source.html#l00242">XProofProtocol.h:242</a></div></div>
<div class="ttc" id="classXrdProofdAux_html_ab89f8e6e7860469ea0c610cd11f38114"><div class="ttname"><a href="classXrdProofdAux.html#ab89f8e6e7860469ea0c610cd11f38114">XrdProofdAux::GetIDFromPath</a></div><div class="ttdeci">static int GetIDFromPath(const char *path, XrdOucString &amp;emsg)</div><div class="ttdoc">Extract an integer from a file. </div><div class="ttdef"><b>Definition:</b> <a href="XrdProofdAux_8cxx_source.html#l01110">XrdProofdAux.cxx:1110</a></div></div>
<div class="ttc" id="classXrdProofdManager_html_a49e1d44d005669a286deca814586dcea"><div class="ttname"><a href="classXrdProofdManager.html#a49e1d44d005669a286deca814586dcea">XrdProofdManager::DataDirUrlOpts</a></div><div class="ttdeci">const char * DataDirUrlOpts() const</div><div class="ttdef"><b>Definition:</b> <a href="XrdProofdManager_8h_source.html#l00095">XrdProofdManager.h:95</a></div></div>
<div class="ttc" id="textangle_8C_html_a655a1c2a1ec25e8fcfb713772281e8f5"><div class="ttname"><a href="textangle_8C.html#a655a1c2a1ec25e8fcfb713772281e8f5">a</a></div><div class="ttdeci">auto * a</div><div class="ttdef"><b>Definition:</b> <a href="textangle_8C_source.html#l00012">textangle.C:12</a></div></div>
<div class="ttc" id="classXrdProofdProofServMgr_html_af983b32d34ecd820a44c78cf1fa57a8a"><div class="ttname"><a href="classXrdProofdProofServMgr.html#af983b32d34ecd820a44c78cf1fa57a8a">XrdProofdProofServMgr::ResolveSession</a></div><div class="ttdeci">int ResolveSession(const char *fpid)</div><div class="ttdoc">Handle a request to recover a session after stop&amp;restart. </div><div class="ttdef"><b>Definition:</b> <a href="XrdProofdProofServMgr_8cxx_source.html#l02410">XrdProofdProofServMgr.cxx:2410</a></div></div>
<div class="ttc" id="classXrdProofdManager_html_a53f135f499c3ce6f653c118a400df741"><div class="ttname"><a href="classXrdProofdManager.html#a53f135f499c3ce6f653c118a400df741">XrdProofdManager::MultiUser</a></div><div class="ttdeci">bool MultiUser() const</div><div class="ttdef"><b>Definition:</b> <a href="XrdProofdManager_8h_source.html#l00085">XrdProofdManager.h:85</a></div></div>
<div class="ttc" id="classXrdProofUI_html_a8ddfeaa660ae3a4798b11e9222c7a742"><div class="ttname"><a href="classXrdProofUI.html#a8ddfeaa660ae3a4798b11e9222c7a742">XrdProofUI::fGroup</a></div><div class="ttdeci">XrdOucString fGroup</div><div class="ttdef"><b>Definition:</b> <a href="XrdProofdAux_8h_source.html#l00041">XrdProofdAux.h:41</a></div></div>
<div class="ttc" id="XrdProofdClientMgr_8h_html"><div class="ttname"><a href="XrdProofdClientMgr_8h.html">XrdProofdClientMgr.h</a></div></div>
<div class="ttc" id="classXrdClientID_html_a32d793141b4ff7145f4428e699c41c50"><div class="ttname"><a href="classXrdClientID.html#a32d793141b4ff7145f4428e699c41c50">XrdClientID::SetP</a></div><div class="ttdeci">void SetP(XrdProofdProtocol *p)</div><div class="ttdef"><b>Definition:</b> <a href="XrdProofdClient_8h_source.html#l00146">XrdProofdClient.h:146</a></div></div>
<div class="ttc" id="classXrdROOTMgr_html_a16cd051cf991939382d44a9f8623a61f"><div class="ttname"><a href="classXrdROOTMgr.html#a16cd051cf991939382d44a9f8623a61f">XrdROOTMgr::GetVersion</a></div><div class="ttdeci">XrdROOT * GetVersion(const char *tag)</div><div class="ttdoc">Return pointer to the ROOT version corresponding to &amp;#39;tag&amp;#39; or 0 if not found. </div><div class="ttdef"><b>Definition:</b> <a href="XrdROOT_8cxx_source.html#l00738">XrdROOT.cxx:738</a></div></div>
<div class="ttc" id="XrdSysToOuc_8h_html_a4ba18bedbb8a1a4367d57f49a4d773ce"><div class="ttname"><a href="XrdSysToOuc_8h.html#a4ba18bedbb8a1a4367d57f49a4d773ce">XrdSysMutexHelper</a></div><div class="ttdeci">#define XrdSysMutexHelper</div><div class="ttdef"><b>Definition:</b> <a href="XrdSysToOuc_8h_source.html#l00017">XrdSysToOuc.h:17</a></div></div>
<div class="ttc" id="classXrdProofSessionInfo_html_a518ae82246ac2f8d3db9159f72056411"><div class="ttname"><a href="classXrdProofSessionInfo.html#a518ae82246ac2f8d3db9159f72056411">XrdProofSessionInfo::fTag</a></div><div class="ttdeci">XrdOucString fTag</div><div class="ttdef"><b>Definition:</b> <a href="XrdProofdProofServMgr_8h_source.html#l00089">XrdProofdProofServMgr.h:89</a></div></div>
<div class="ttc" id="classXrdProofdClient_html_a8ea0bbb76949d36f85b223cab59db0d7"><div class="ttname"><a href="classXrdProofdClient.html#a8ea0bbb76949d36f85b223cab59db0d7">XrdProofdClient::Sandbox</a></div><div class="ttdeci">XrdProofdSandbox * Sandbox() const</div><div class="ttdef"><b>Definition:</b> <a href="XrdProofdClient_8h_source.html#l00057">XrdProofdClient.h:57</a></div></div>
<div class="ttc" id="classXrdProofUI_html"><div class="ttname"><a href="classXrdProofUI.html">XrdProofUI</a></div><div class="ttdef"><b>Definition:</b> <a href="XrdProofdAux_8h_source.html#l00038">XrdProofdAux.h:38</a></div></div>
<div class="ttc" id="XrdProofdProofServMgr_8cxx_html_a7f323ce62c469b18c22fc22f735b1bcb"><div class="ttname"><a href="XrdProofdProofServMgr_8cxx.html#a7f323ce62c469b18c22fc22f735b1bcb">WriteSessEnvs</a></div><div class="ttdeci">static int WriteSessEnvs(const char *, XpdEnv *env, void *s)</div><div class="ttdoc">Run thorugh entries to broadcast the relevant priority. </div><div class="ttdef"><b>Definition:</b> <a href="XrdProofdProofServMgr_8cxx_source.html#l02842">XrdProofdProofServMgr.cxx:2842</a></div></div>
<div class="ttc" id="unionXPClientRequest_html_a86d728b0d38bc6ff0b92a9fb0b69bd0c"><div class="ttname"><a href="unionXPClientRequest.html#a86d728b0d38bc6ff0b92a9fb0b69bd0c">XPClientRequest::proof</a></div><div class="ttdeci">struct XPClientProofRequest proof</div><div class="ttdef"><b>Definition:</b> <a href="XProofProtocol_8h_source.html#l00299">XProofProtocol.h:299</a></div></div>
<div class="ttc" id="classXrdSrvBuffer_html_a910c9b58a1a348e8de8d8c6e017618e5"><div class="ttname"><a href="classXrdSrvBuffer.html#a910c9b58a1a348e8de8d8c6e017618e5">XrdSrvBuffer::fSize</a></div><div class="ttdeci">int fSize</div><div class="ttdef"><b>Definition:</b> <a href="XrdProofdProofServ_8h_source.html#l00048">XrdProofdProofServ.h:48</a></div></div>
<div class="ttc" id="classXpdSrvMgrCreateGuard_html"><div class="ttname"><a href="classXpdSrvMgrCreateGuard.html">XpdSrvMgrCreateGuard</a></div><div class="ttdef"><b>Definition:</b> <a href="XrdProofdProofServMgr_8h_source.html#l00320">XrdProofdProofServMgr.h:320</a></div></div>
<div class="ttc" id="classXrdProofdManager_html_a3f8780d0a9d3fabe02aa01fe8ebbf5b5"><div class="ttname"><a href="classXrdProofdManager.html#a3f8780d0a9d3fabe02aa01fe8ebbf5b5">XrdProofdManager::Host</a></div><div class="ttdeci">const char * Host() const</div><div class="ttdef"><b>Definition:</b> <a href="XrdProofdManager_8h_source.html#l00081">XrdProofdManager.h:81</a></div></div>
<div class="ttc" id="XpdSysError_8h_html_a3a6303e847f63204af8dd2b8953d89a1"><div class="ttname"><a href="XpdSysError_8h.html#a3a6303e847f63204af8dd2b8953d89a1">XrdSysError</a></div><div class="ttdeci">#define XrdSysError</div><div class="ttdef"><b>Definition:</b> <a href="XpdSysError_8h_source.html#l00008">XpdSysError.h:8</a></div></div>
<div class="ttc" id="XrdProofdClient_8h_html"><div class="ttname"><a href="XrdProofdClient_8h.html">XrdProofdClient.h</a></div></div>
<div class="ttc" id="classXrdProofSessionInfo_html_abd08a281fd0a0761e31111b77b6fb6e2"><div class="ttname"><a href="classXrdProofSessionInfo.html#abd08a281fd0a0761e31111b77b6fb6e2">XrdProofSessionInfo::Reset</a></div><div class="ttdeci">void Reset()</div><div class="ttdoc">Reset the content. </div><div class="ttdef"><b>Definition:</b> <a href="XrdProofdProofServMgr_8cxx_source.html#l04864">XrdProofdProofServMgr.cxx:4864</a></div></div>
<div class="ttc" id="classXrdProofdProofServMgr_html_ac8b90ca558edf52af7b174c02aca89ac"><div class="ttname"><a href="classXrdProofdProofServMgr.html#ac8b90ca558edf52af7b174c02aca89ac">XrdProofdProofServMgr::Recover</a></div><div class="ttdeci">int Recover(XpdClientSessions *cl)</div><div class="ttdoc">Handle a request to recover a session after stop&amp;restart for a specific client. </div><div class="ttdef"><b>Definition:</b> <a href="XrdProofdProofServMgr_8cxx_source.html#l02488">XrdProofdProofServMgr.cxx:2488</a></div></div>
<div class="ttc" id="XrdProofdTrace_8h_html_a83f50a6ac1ca86524725ed11340e3b26"><div class="ttname"><a href="XrdProofdTrace_8h.html#a83f50a6ac1ca86524725ed11340e3b26">TRACEP</a></div><div class="ttdeci">#define TRACEP(p, act, x)</div><div class="ttdef"><b>Definition:</b> <a href="XrdProofdTrace_8h_source.html#l00108">XrdProofdTrace.h:108</a></div></div>
<div class="ttc" id="classXrdProofdProofServMgr_html_a001151ea555c7e0d21298d831452665f"><div class="ttname"><a href="classXrdProofdProofServMgr.html#a001151ea555c7e0d21298d831452665f">XrdProofdProofServMgr::fCheckLost</a></div><div class="ttdeci">bool fCheckLost</div><div class="ttdef"><b>Definition:</b> <a href="XrdProofdProofServMgr_8h_source.html#l00156">XrdProofdProofServMgr.h:156</a></div></div>
<div class="ttc" id="classXrdProofdProofServMgr_html_afeb94f243e78b1fadae77fbaa52bcd39"><div class="ttname"><a href="classXrdProofdProofServMgr.html#afeb94f243e78b1fadae77fbaa52bcd39">XrdProofdProofServMgr::CleanClientSessions</a></div><div class="ttdeci">int CleanClientSessions(const char *usr, int srvtype)</div><div class="ttdoc">Go through the sessions admin path and clean all sessions belonging to &amp;#39;usr&amp;#39;. </div><div class="ttdef"><b>Definition:</b> <a href="XrdProofdProofServMgr_8cxx_source.html#l01038">XrdProofdProofServMgr.cxx:1038</a></div></div>
<div class="ttc" id="XProofProtocol_8h_html_af90b47a2dd37c58ac6f67e16c279e27bafd3f389e5b30b994109c42a3c43d3c0c"><div class="ttname"><a href="XProofProtocol_8h.html#af90b47a2dd37c58ac6f67e16c279e27bafd3f389e5b30b994109c42a3c43d3c0c">kXPD_srvmsg</a></div><div class="ttdef"><b>Definition:</b> <a href="XProofProtocol_8h_source.html#l00176">XProofProtocol.h:176</a></div></div>
<div class="ttc" id="classXrdProofdProofServMgr_html_a3afafd9e885f8c755801496783ae333e"><div class="ttname"><a href="classXrdProofdProofServMgr.html#a3afafd9e885f8c755801496783ae333e">XrdProofdProofServMgr::MvSession</a></div><div class="ttdeci">int MvSession(const char *fpid)</div><div class="ttdoc">Move session file from the active to the terminated areas. </div><div class="ttdef"><b>Definition:</b> <a href="XrdProofdProofServMgr_8cxx_source.html#l00498">XrdProofdProofServMgr.cxx:498</a></div></div>
<div class="ttc" id="XrdProofdAux_8h_html_ad77bf9042235eb97fbdca181c591ef79"><div class="ttname"><a href="XrdProofdAux_8h.html#ad77bf9042235eb97fbdca181c591ef79">XpdBadPGuard</a></div><div class="ttdeci">#define XpdBadPGuard(g, u)</div><div class="ttdef"><b>Definition:</b> <a href="XrdProofdAux_8h_source.html#l00365">XrdProofdAux.h:365</a></div></div>
<div class="ttc" id="classXrdProofdManager_html_ac1aeacfd6edb71f9bc4ebe8e472d006b"><div class="ttname"><a href="classXrdProofdManager.html#ac1aeacfd6edb71f9bc4ebe8e472d006b">XrdProofdManager::ClientMgr</a></div><div class="ttdeci">XrdProofdClientMgr * ClientMgr() const</div><div class="ttdef"><b>Definition:</b> <a href="XrdProofdManager_8h_source.html#l00104">XrdProofdManager.h:104</a></div></div>
<div class="ttc" id="classXrdROOT_html_a3b1e4b60cbd1b7fcd87a583a9e664b24"><div class="ttname"><a href="classXrdROOT.html#a3b1e4b60cbd1b7fcd87a583a9e664b24">XrdROOT::Tag</a></div><div class="ttdeci">const char * Tag() const</div><div class="ttdef"><b>Definition:</b> <a href="XrdROOT_8h_source.html#l00083">XrdROOT.h:83</a></div></div>
<div class="ttc" id="classXrdProofdProofServMgr_html_a226eefc373fb6d7d68f65649032f1009"><div class="ttname"><a href="classXrdProofdProofServMgr.html#a226eefc373fb6d7d68f65649032f1009">XrdProofdProofServMgr::PrepareSessionRecovering</a></div><div class="ttdeci">int PrepareSessionRecovering()</div><div class="ttdoc">Go through the active sessions admin path and prepare reconnection of those still alive...</div><div class="ttdef"><b>Definition:</b> <a href="XrdProofdProofServMgr_8cxx_source.html#l00709">XrdProofdProofServMgr.cxx:709</a></div></div>
<div class="ttc" id="classXrdProofdProofServMgr_html_af287fe3c85318d8fff5cfccac3dbb422"><div class="ttname"><a href="classXrdProofdProofServMgr.html#af287fe3c85318d8fff5cfccac3dbb422">XrdProofdProofServMgr::VerifySession</a></div><div class="ttdeci">int VerifySession(const char *fpid, int to=-1, const char *path=0)</div><div class="ttdoc">Check if the session is alive, i.e. </div><div class="ttdef"><b>Definition:</b> <a href="XrdProofdProofServMgr_8cxx_source.html#l00611">XrdProofdProofServMgr.cxx:611</a></div></div>
<div class="ttc" id="classXrdProofdProofServMgr_html_a2ad6176eb419d7edd51704580d006993"><div class="ttname"><a href="classXrdProofdProofServMgr.html#a2ad6176eb419d7edd51704580d006993">XrdProofdProofServMgr::Pipe</a></div><div class="ttdeci">XrdProofdPipe * Pipe()</div><div class="ttdef"><b>Definition:</b> <a href="XrdProofdProofServMgr_8h_source.html#l00299">XrdProofdProofServMgr.h:299</a></div></div>
<div class="ttc" id="classXrdProofdManager_html_a4a2a77a074ead8e9c504a7fa758d2e9d"><div class="ttname"><a href="classXrdProofdManager.html#a4a2a77a074ead8e9c504a7fa758d2e9d">XrdProofdManager::DataSetSrcs</a></div><div class="ttdeci">std::list&lt; XrdProofdDSInfo * &gt; * DataSetSrcs()</div><div class="ttdef"><b>Definition:</b> <a href="XrdProofdManager_8h_source.html#l00101">XrdProofdManager.h:101</a></div></div>
<div class="ttc" id="classXrdProofdProofServMgr_html_a21d2bc568b3bc3611b359d56e6f24da2"><div class="ttname"><a href="classXrdProofdProofServMgr.html#a21d2bc568b3bc3611b359d56e6f24da2">XrdProofdProofServMgr::Detach</a></div><div class="ttdeci">int Detach(XrdProofdProtocol *p)</div><div class="ttdoc">Handle a request to detach from an existing session. </div><div class="ttdef"><b>Definition:</b> <a href="XrdProofdProofServMgr_8cxx_source.html#l02769">XrdProofdProofServMgr.cxx:2769</a></div></div>
<div class="ttc" id="classXpdEnv_html_ac35273193628e86f4f3a33060637cfee"><div class="ttname"><a href="classXpdEnv.html#ac35273193628e86f4f3a33060637cfee">XpdEnv::fUsers</a></div><div class="ttdeci">XrdOucString fUsers</div><div class="ttdef"><b>Definition:</b> <a href="XrdProofdProofServMgr_8h_source.html#l00111">XrdProofdProofServMgr.h:111</a></div></div>
<div class="ttc" id="classXrdProofdProofServMgr_html_a6dea65be9cfafa463f8d8200e3d02ecc"><div class="ttname"><a href="classXrdProofdProofServMgr.html#a6dea65be9cfafa463f8d8200e3d02ecc">XrdProofdProofServMgr::fReconnectTimeOut</a></div><div class="ttdeci">int fReconnectTimeOut</div><div class="ttdef"><b>Definition:</b> <a href="XrdProofdProofServMgr_8h_source.html#l00153">XrdProofdProofServMgr.h:153</a></div></div>
<div class="ttc" id="classXrdProofdProofServMgr_html_a34c425cdb5ec334f7c3b7acc2fa335e5af201ff79b593ebb09185a708eeefc602"><div class="ttname"><a href="classXrdProofdProofServMgr.html#a34c425cdb5ec334f7c3b7acc2fa335e5af201ff79b593ebb09185a708eeefc602">XrdProofdProofServMgr::kCleanSessionsCnt</a></div><div class="ttdef"><b>Definition:</b> <a href="XrdProofdProofServMgr_8h_source.html#l00232">XrdProofdProofServMgr.h:232</a></div></div>
<div class="ttc" id="classXrdProofdAux_html_a5776beb694ac4e6b2279707629d58fca"><div class="ttname"><a href="classXrdProofdAux.html#a5776beb694ac4e6b2279707629d58fca">XrdProofdAux::GetLong</a></div><div class="ttdeci">static long int GetLong(char *str)</div><div class="ttdoc">Extract first integer from string at &amp;#39;str&amp;#39;, if any. </div><div class="ttdef"><b>Definition:</b> <a href="XrdProofdAux_8cxx_source.html#l00202">XrdProofdAux.cxx:202</a></div></div>
<div class="ttc" id="classXrdProofdProofServMgr_html_aabf69cec905249efe3d8375a2ef382dc"><div class="ttname"><a href="classXrdProofdProofServMgr.html#aabf69cec905249efe3d8375a2ef382dc">XrdProofdProofServMgr::GetTagDirs</a></div><div class="ttdeci">void GetTagDirs(int opt, XrdProofdProtocol *p, XrdProofdProofServ *xps, XrdOucString &amp;sesstag, XrdOucString &amp;topsesstag, XrdOucString &amp;sessiondir, XrdOucString &amp;sesswrkdir)</div><div class="ttdoc">Determine the unique tag and relevant dirs for this session. </div><div class="ttdef"><b>Definition:</b> <a href="XrdProofdProofServMgr_8cxx_source.html#l03228">XrdProofdProofServMgr.cxx:3228</a></div></div>
<div class="ttc" id="XProofProtocol_8h_html_a727fb77180370df43315288005e23b99"><div class="ttname"><a href="XProofProtocol_8h.html#a727fb77180370df43315288005e23b99">kXPD_AnyServer</a></div><div class="ttdeci">#define kXPD_AnyServer</div><div class="ttdef"><b>Definition:</b> <a href="XProofProtocol_8h_source.html#l00067">XProofProtocol.h:67</a></div></div>
<div class="ttc" id="classXrdProofdProofServMgr_html_a4d0997e0348d21914091e8bd3d844751"><div class="ttname"><a href="classXrdProofdProofServMgr.html#a4d0997e0348d21914091e8bd3d844751">XrdProofdProofServMgr::fUseFork</a></div><div class="ttdeci">bool fUseFork</div><div class="ttdef"><b>Definition:</b> <a href="XrdProofdProofServMgr_8h_source.html#l00157">XrdProofdProofServMgr.h:157</a></div></div>
<div class="ttc" id="RSha256_8hxx_html_acf9942d15f0dd0ac4fc5ca66096a3f6d"><div class="ttname"><a href="RSha256_8hxx.html#acf9942d15f0dd0ac4fc5ca66096a3f6d">h</a></div><div class="ttdeci">#define h(i)</div><div class="ttdef"><b>Definition:</b> <a href="RSha256_8hxx_source.html#l00106">RSha256.hxx:106</a></div></div>
<div class="ttc" id="classXrdProofdProofServ_html_a4b99be0402107389bc029cc36aba8e07"><div class="ttname"><a href="classXrdProofdProofServ.html#a4b99be0402107389bc029cc36aba8e07">XrdProofdProofServ::SetTag</a></div><div class="ttdeci">void SetTag(const char *t)</div><div class="ttdef"><b>Definition:</b> <a href="XrdProofdProofServ_8h_source.html#l00186">XrdProofdProofServ.h:186</a></div></div>
<div class="ttc" id="classXrdProofdSandbox_html_a98c8db62cad2ca475c2379777cf3a9c7"><div class="ttname"><a href="classXrdProofdSandbox.html#a98c8db62cad2ca475c2379777cf3a9c7">XrdProofdSandbox::AddSession</a></div><div class="ttdeci">int AddSession(const char *tag)</div><div class="ttdoc">Record entry for new proofserv session tagged &amp;#39;tag&amp;#39; in the active sessions file (&lt;SandBox&gt;/.sessions). </div><div class="ttdef"><b>Definition:</b> <a href="XrdProofdSandbox_8cxx_source.html#l00324">XrdProofdSandbox.cxx:324</a></div></div>
<div class="ttc" id="structProofServEnv__t_html_aefb8c17473f66fe63376b1956ba7ebfa"><div class="ttname"><a href="structProofServEnv__t.html#aefb8c17473f66fe63376b1956ba7ebfa">ProofServEnv_t::fPS</a></div><div class="ttdeci">XrdProofdProofServ * fPS</div><div class="ttdef"><b>Definition:</b> <a href="XrdProofdProofServMgr_8h_source.html#l00058">XrdProofdProofServMgr.h:58</a></div></div>
<div class="ttc" id="classXrdProofdProofServMgr_html_ad8126ec253b738adc2ae64a95354edec"><div class="ttname"><a href="classXrdProofdProofServMgr.html#ad8126ec253b738adc2ae64a95354edec">XrdProofdProofServMgr::fProofPlugin</a></div><div class="ttdeci">XrdOucString fProofPlugin</div><div class="ttdef"><b>Definition:</b> <a href="XrdProofdProofServMgr_8h_source.html#l00140">XrdProofdProofServMgr.h:140</a></div></div>
<div class="ttc" id="classXrdProofdProofServMgr_html_a4d745a9880deae66b89a3536e3d21cf0"><div class="ttname"><a href="classXrdProofdProofServMgr.html#a4d745a9880deae66b89a3536e3d21cf0">XrdProofdProofServMgr::fShutdownDelay</a></div><div class="ttdeci">int fShutdownDelay</div><div class="ttdef"><b>Definition:</b> <a href="XrdProofdProofServMgr_8h_source.html#l00145">XrdProofdProofServMgr.h:145</a></div></div>
<div class="ttc" id="classXrdProofdManager_html_a90aa36d30901b6766ef4a88be6610b6d"><div class="ttname"><a href="classXrdProofdManager.html#a90aa36d30901b6766ef4a88be6610b6d">XrdProofdManager::TMPdir</a></div><div class="ttdeci">const char * TMPdir() const</div><div class="ttdef"><b>Definition:</b> <a href="XrdProofdManager_8h_source.html#l00091">XrdProofdManager.h:91</a></div></div>
<div class="ttc" id="civetweb_8c_html_a3a21b674a056eab8a11436300ae02d00"><div class="ttname"><a href="civetweb_8c.html#a3a21b674a056eab8a11436300ae02d00">extension</a></div><div class="ttdeci">const char * extension</div><div class="ttdef"><b>Definition:</b> <a href="civetweb_8c_source.html#l07793">civetweb.c:7793</a></div></div>
<div class="ttc" id="classXrdProofdProofServ_html_a25ba137320d90e008bd46533da88263c"><div class="ttname"><a href="classXrdProofdProofServ.html#a25ba137320d90e008bd46533da88263c">XrdProofdProofServ::AdminPath</a></div><div class="ttdeci">const char * AdminPath() const</div><div class="ttdef"><b>Definition:</b> <a href="XrdProofdProofServ_8h_source.html#l00118">XrdProofdProofServ.h:118</a></div></div>
<div class="ttc" id="classXrdProofdProofServMgr_html_a86cac591a5646811e38ff6a2477f4da7"><div class="ttname"><a href="classXrdProofdProofServMgr.html#a86cac591a5646811e38ff6a2477f4da7">XrdProofdProofServMgr::fMgr</a></div><div class="ttdeci">XrdProofdManager * fMgr</div><div class="ttdef"><b>Definition:</b> <a href="XrdProofdProofServMgr_8h_source.html#l00132">XrdProofdProofServMgr.h:132</a></div></div>
<div class="ttc" id="classXrdProofdProofServ_html_a3ffaac9d5a4472092b2a06ac05cebf13"><div class="ttname"><a href="classXrdProofdProofServ.html#a3ffaac9d5a4472092b2a06ac05cebf13">XrdProofdProofServ::Fileout</a></div><div class="ttdeci">const char * Fileout() const</div><div class="ttdef"><b>Definition:</b> <a href="XrdProofdProofServ_8h_source.html#l00134">XrdProofdProofServ.h:134</a></div></div>
<div class="ttc" id="classXpdClientSessions_html"><div class="ttname"><a href="classXpdClientSessions.html">XpdClientSessions</a></div><div class="ttdef"><b>Definition:</b> <a href="XrdProofdProofServMgr_8h_source.html#l00069">XrdProofdProofServMgr.h:69</a></div></div>
<div class="ttc" id="classXrdProofdProofServ_html_aa4580fce80e7fb2795eaa29a262cb309"><div class="ttname"><a href="classXrdProofdProofServ.html#aa4580fce80e7fb2795eaa29a262cb309">XrdProofdProofServ::SetAdminPath</a></div><div class="ttdeci">int SetAdminPath(const char *a, bool assert, bool setown)</div><div class="ttdoc">Set the admin path and make sure the file exists. </div><div class="ttdef"><b>Definition:</b> <a href="XrdProofdProofServ_8cxx_source.html#l00763">XrdProofdProofServ.cxx:763</a></div></div>
<div class="ttc" id="classXrdProofdAux_html_a3918ddc5c3912b017a3f7695ba5f3a40"><div class="ttname"><a href="classXrdProofdAux.html#a3918ddc5c3912b017a3f7695ba5f3a40">XrdProofdAux::AssertDir</a></div><div class="ttdeci">static int AssertDir(const char *path, XrdProofUI ui, bool changeown)</div><div class="ttdoc">Make sure that &amp;#39;path&amp;#39; exists and is owned by the entity described by &amp;#39;ui&amp;#39;. </div><div class="ttdef"><b>Definition:</b> <a href="XrdProofdAux_8cxx_source.html#l00430">XrdProofdAux.cxx:430</a></div></div>
<div class="ttc" id="classXrdProofdProofServ_html_abe2e0f70032b4113cf16bd9554335bb7"><div class="ttname"><a href="classXrdProofdProofServ.html#abe2e0f70032b4113cf16bd9554335bb7">XrdProofdProofServ::PLiteNWrks</a></div><div class="ttdeci">int PLiteNWrks() const</div><div class="ttdef"><b>Definition:</b> <a href="XrdProofdProofServ_8h_source.html#l00149">XrdProofdProofServ.h:149</a></div></div>
<div class="ttc" id="structXPClientProofRequest_html_ae99987529a8600f113df406f0ee08bc5"><div class="ttname"><a href="structXPClientProofRequest.html#ae99987529a8600f113df406f0ee08bc5">XPClientProofRequest::dlen</a></div><div class="ttdeci">kXR_int32 dlen</div><div class="ttdef"><b>Definition:</b> <a href="XProofProtocol_8h_source.html#l00245">XProofProtocol.h:245</a></div></div>
<div class="ttc" id="RSha256_8hxx_html_a23b5b0a85bf5762c93a855f40c0343ce"><div class="ttname"><a href="RSha256_8hxx.html#a23b5b0a85bf5762c93a855f40c0343ce">d</a></div><div class="ttdeci">#define d(i)</div><div class="ttdef"><b>Definition:</b> <a href="RSha256_8hxx_source.html#l00102">RSha256.hxx:102</a></div></div>
<div class="ttc" id="classXrdProofdManager_html_a2f5b5d64f2d6f4f3b0f6f003f6183468"><div class="ttname"><a href="classXrdProofdManager.html#a2f5b5d64f2d6f4f3b0f6f003f6183468">XrdProofdManager::ROOTMgr</a></div><div class="ttdeci">XrdROOTMgr * ROOTMgr() const</div><div class="ttdef"><b>Definition:</b> <a href="XrdProofdManager_8h_source.html#l00111">XrdProofdManager.h:111</a></div></div>
<div class="ttc" id="classXrdProofdClient_html_a1ee033555eb136fd4b65d218bca1ad22"><div class="ttname"><a href="classXrdProofdClient.html#a1ee033555eb136fd4b65d218bca1ad22">XrdProofdClient::TerminateSessions</a></div><div class="ttdeci">void TerminateSessions(int srvtype, XrdProofdProofServ *ref, const char *msg, XrdProofdPipe *pipe, bool changeown)</div><div class="ttdoc">Terminate client sessions; IDs of signalled processes are added to sigpid. </div><div class="ttdef"><b>Definition:</b> <a href="XrdProofdClient_8cxx_source.html#l00646">XrdProofdClient.cxx:646</a></div></div>
<div class="ttc" id="classXrdProofUI_html_aa16ddd6d492cb4e498d5a94df6b037a9"><div class="ttname"><a href="classXrdProofUI.html#aa16ddd6d492cb4e498d5a94df6b037a9">XrdProofUI::fUid</a></div><div class="ttdeci">int fUid</div><div class="ttdef"><b>Definition:</b> <a href="XrdProofdAux_8h_source.html#l00043">XrdProofdAux.h:43</a></div></div>
<div class="ttc" id="XrdProofdAux_8h_html_a631cc8787af1a02d9e51c86117ae042e"><div class="ttname"><a href="XrdProofdAux_8h.html#a631cc8787af1a02d9e51c86117ae042e">XPDFORM</a></div><div class="ttdeci">#define XPDFORM</div><div class="ttdef"><b>Definition:</b> <a href="XrdProofdAux_8h_source.html#l00378">XrdProofdAux.h:378</a></div></div>
<div class="ttc" id="XpdSysDNS_8h_html"><div class="ttname"><a href="XpdSysDNS_8h.html">XpdSysDNS.h</a></div></div>
<div class="ttc" id="classXrdProofSessionInfo_html_a54094db8d9c75cbd7822532d026ebc61"><div class="ttname"><a href="classXrdProofSessionInfo.html#a54094db8d9c75cbd7822532d026ebc61">XrdProofSessionInfo::fUser</a></div><div class="ttdeci">XrdOucString fUser</div><div class="ttdef"><b>Definition:</b> <a href="XrdProofdProofServMgr_8h_source.html#l00086">XrdProofdProofServMgr.h:86</a></div></div>
<div class="ttc" id="XProofProtocol_8h_html_ac8a8ea0eedefcf3ab8199ea996b3922c"><div class="ttname"><a href="XProofProtocol_8h.html#ac8a8ea0eedefcf3ab8199ea996b3922c">kXPD_Worker</a></div><div class="ttdeci">#define kXPD_Worker</div><div class="ttdef"><b>Definition:</b> <a href="XProofProtocol_8h_source.html#l00066">XProofProtocol.h:66</a></div></div>
<div class="ttc" id="classXrdProofdProofServ_html_a6ba086750a26352c640fb915d10b4b22"><div class="ttname"><a href="classXrdProofdProofServ.html#a6ba086750a26352c640fb915d10b4b22">XrdProofdProofServ::Protocol</a></div><div class="ttdeci">XrdProofdProtocol * Protocol() const</div><div class="ttdef"><b>Definition:</b> <a href="XrdProofdProofServ_8h_source.html#l00150">XrdProofdProofServ.h:150</a></div></div>
<div class="ttc" id="structXpdManagerCron__t_html_a847ebc78e5dabbd2910df2994ad60c68"><div class="ttname"><a href="structXpdManagerCron__t.html#a847ebc78e5dabbd2910df2994ad60c68">XpdManagerCron_t::fSessionMgr</a></div><div class="ttdeci">XrdProofdProofServMgr * fSessionMgr</div><div class="ttdef"><b>Definition:</b> <a href="XrdProofdManager_8h_source.html#l00214">XrdProofdManager.h:214</a></div></div>
<div class="ttc" id="classXrdProofdAux_html_ae175d666f49fefdfb6e4e3fde1151ee4"><div class="ttname"><a href="classXrdProofdAux.html#ae175d666f49fefdfb6e4e3fde1151ee4">XrdProofdAux::CheckIf</a></div><div class="ttdeci">static int CheckIf(XrdOucStream *s, const char *h)</div><div class="ttdoc">Check existence and match condition of an &amp;#39;if&amp;#39; directive If none (valid) is found, return -1. </div><div class="ttdef"><b>Definition:</b> <a href="XrdProofdAux_8cxx_source.html#l00725">XrdProofdAux.cxx:725</a></div></div>
<div class="ttc" id="classXrdProofdProofServMgr_html_a1a7f51b1a820604451001cd020f12130"><div class="ttname"><a href="classXrdProofdProofServMgr.html#a1a7f51b1a820604451001cd020f12130">XrdProofdProofServMgr::CheckTerminatedSessions</a></div><div class="ttdeci">int CheckTerminatedSessions()</div><div class="ttdoc">Go through the terminated sessions admin path and make sure sessions they are gone. </div><div class="ttdef"><b>Definition:</b> <a href="XrdProofdProofServMgr_8cxx_source.html#l00979">XrdProofdProofServMgr.cxx:979</a></div></div>
<div class="ttc" id="classXrdProofdManager_html_afff1cbbe9ce1f522c001f196271d71b7"><div class="ttname"><a href="classXrdProofdManager.html#afff1cbbe9ce1f522c001f196271d71b7">XrdProofdManager::ResolveKeywords</a></div><div class="ttdeci">int ResolveKeywords(XrdOucString &amp;s, XrdProofdClient *pcl)</div><div class="ttdoc">Resolve special keywords in &amp;#39;s&amp;#39; for client &amp;#39;pcl&amp;#39;. </div><div class="ttdef"><b>Definition:</b> <a href="XrdProofdManager_8cxx_source.html#l01380">XrdProofdManager.cxx:1380</a></div></div>
<div class="ttc" id="classXrdProofSched_html"><div class="ttname"><a href="classXrdProofSched.html">XrdProofSched</a></div><div class="ttdef"><b>Definition:</b> <a href="XrdProofSched_8h_source.html#l00062">XrdProofSched.h:62</a></div></div>
<div class="ttc" id="classXrdProofdManager_html_a032b537f0bbb2fed392e7dd10e8b68e1"><div class="ttname"><a href="classXrdProofdManager.html#a032b537f0bbb2fed392e7dd10e8b68e1">XrdProofdManager::LocalROOT</a></div><div class="ttdeci">const char * LocalROOT() const</div><div class="ttdef"><b>Definition:</b> <a href="XrdProofdManager_8h_source.html#l00084">XrdProofdManager.h:84</a></div></div>
<div class="ttc" id="structXPClientProofRequest_html_a8aa8a8c9f18a796682b3ef3f787493fa"><div class="ttname"><a href="structXPClientProofRequest.html#a8aa8a8c9f18a796682b3ef3f787493fa">XPClientProofRequest::sid</a></div><div class="ttdeci">kXR_int32 sid</div><div class="ttdef"><b>Definition:</b> <a href="XProofProtocol_8h_source.html#l00241">XProofProtocol.h:241</a></div></div>
<div class="ttc" id="XrdProofdAux_8h_html_a0ef73da06cb8a7145a87bdef7d1a9dc3"><div class="ttname"><a href="XrdProofdAux_8h.html#a0ef73da06cb8a7145a87bdef7d1a9dc3">DIGIT</a></div><div class="ttdeci">#define DIGIT(x)</div><div class="ttdef"><b>Definition:</b> <a href="XrdProofdAux_8h_source.html#l00346">XrdProofdAux.h:346</a></div></div>
<div class="ttc" id="XrdProofdAux_8h_html_a106fc173319cff3b69ea8182cd223a3c"><div class="ttname"><a href="XrdProofdAux_8h.html#a106fc173319cff3b69ea8182cd223a3c">DoDirectiveString</a></div><div class="ttdeci">int DoDirectiveString(XrdProofdDirective *, char *val, XrdOucStream *cfg, bool rcf)</div><div class="ttdoc">Process directive for a string. </div><div class="ttdef"><b>Definition:</b> <a href="XrdProofdAux_8cxx_source.html#l01681">XrdProofdAux.cxx:1681</a></div></div>
<div class="ttc" id="classXrdProofdProofServMgr_html_ad4f70c3d45559272f158ab861a1db498"><div class="ttname"><a href="classXrdProofdProofServMgr.html#ad4f70c3d45559272f158ab861a1db498">XrdProofdProofServMgr::SendErrLog</a></div><div class="ttdeci">void SendErrLog(const char *errlog, XrdProofdResponse *r)</div><div class="ttdoc">Send content of errlog upstream asynchronously. </div><div class="ttdef"><b>Definition:</b> <a href="XrdProofdProofServMgr_8cxx_source.html#l02360">XrdProofdProofServMgr.cxx:2360</a></div></div>
<div class="ttc" id="classXrdProofdProofServMgr_html_a235180ac7d5ec759ee1f6c924b9b85dc"><div class="ttname"><a href="classXrdProofdProofServMgr.html#a235180ac7d5ec759ee1f6c924b9b85dc">XrdProofdProofServMgr::CleanupLostProofServ</a></div><div class="ttdeci">int CleanupLostProofServ()</div><div class="ttdoc">Cleanup (kill) all &amp;#39;proofserv&amp;#39; processes which lost control from their creator or controller daemon...</div><div class="ttdef"><b>Definition:</b> <a href="XrdProofdProofServMgr_8cxx_source.html#l03909">XrdProofdProofServMgr.cxx:3909</a></div></div>
<div class="ttc" id="classXpdSrvMgrCreateGuard_html_a2f078a3888963c8a20d1529b437d07e9"><div class="ttname"><a href="classXpdSrvMgrCreateGuard.html#a2f078a3888963c8a20d1529b437d07e9">XpdSrvMgrCreateGuard::Set</a></div><div class="ttdeci">void Set(int *c)</div><div class="ttdef"><b>Definition:</b> <a href="XrdProofdProofServMgr_8h_source.html#l00325">XrdProofdProofServMgr.h:325</a></div></div>
<div class="ttc" id="XrdProofdProtocol_8h_html"><div class="ttname"><a href="XrdProofdProtocol_8h.html">XrdProofdProtocol.h</a></div></div>
<div class="ttc" id="classXrdProofSessionInfo_html_acc3e0d8bd1c848656ca48e29822f7974"><div class="ttname"><a href="classXrdProofSessionInfo.html#acc3e0d8bd1c848656ca48e29822f7974">XrdProofSessionInfo::fPLiteNWrks</a></div><div class="ttdeci">int fPLiteNWrks</div><div class="ttdef"><b>Definition:</b> <a href="XrdProofdProofServMgr_8h_source.html#l00084">XrdProofdProofServMgr.h:84</a></div></div>
<div class="ttc" id="structProofServEnv__t_html_a3a5c4ac123b8f92ad80003958476afbb"><div class="ttname"><a href="structProofServEnv__t.html#a3a5c4ac123b8f92ad80003958476afbb">ProofServEnv_t::fSessionDir</a></div><div class="ttdeci">XrdOucString fSessionDir</div><div class="ttdef"><b>Definition:</b> <a href="XrdProofdProofServMgr_8h_source.html#l00064">XrdProofdProofServMgr.h:64</a></div></div>
<div class="ttc" id="classXrdProofSessionInfo_html_a7bdc7f6cb43cec3b52c7abab064e0432"><div class="ttname"><a href="classXrdProofSessionInfo.html#a7bdc7f6cb43cec3b52c7abab064e0432">XrdProofSessionInfo::fAdminPath</a></div><div class="ttdeci">XrdOucString fAdminPath</div><div class="ttdef"><b>Definition:</b> <a href="XrdProofdProofServMgr_8h_source.html#l00095">XrdProofdProofServMgr.h:95</a></div></div>
<div class="ttc" id="structProofServEnv__t_html_af4140705c69b78b2c0fd55131a0844dd"><div class="ttname"><a href="structProofServEnv__t.html#af4140705c69b78b2c0fd55131a0844dd">ProofServEnv_t::fSessionTag</a></div><div class="ttdeci">XrdOucString fSessionTag</div><div class="ttdef"><b>Definition:</b> <a href="XrdProofdProofServMgr_8h_source.html#l00062">XrdProofdProofServMgr.h:62</a></div></div>
<div class="ttc" id="classXrdProofSessionInfo_html_a4b9aa50df5859d41d334e30d2a4f832e"><div class="ttname"><a href="classXrdProofSessionInfo.html#a4b9aa50df5859d41d334e30d2a4f832e">XrdProofSessionInfo::fROOTTag</a></div><div class="ttdeci">XrdOucString fROOTTag</div><div class="ttdef"><b>Definition:</b> <a href="XrdProofdProofServMgr_8h_source.html#l00094">XrdProofdProofServMgr.h:94</a></div></div>
<div class="ttc" id="classXrdProofdProofServMgr_html_a80371def99b5d2ca3f1bdf811aa6b2d8"><div class="ttname"><a href="classXrdProofdProofServMgr.html#a80371def99b5d2ca3f1bdf811aa6b2d8">XrdProofdProofServMgr::SetProofServEnvOld</a></div><div class="ttdeci">int SetProofServEnvOld(XrdProofdProtocol *p, void *in)</div><div class="ttdoc">Set environment for proofserv; old version preparing the environment for proofserv protocol version &lt;...</div><div class="ttdef"><b>Definition:</b> <a href="XrdProofdProofServMgr_8cxx_source.html#l02877">XrdProofdProofServMgr.cxx:2877</a></div></div>
<div class="ttc" id="classXrdProofSessionInfo_html_ac78bc3dfceb59dba00cc3ceed97ce1ed"><div class="ttname"><a href="classXrdProofSessionInfo.html#ac78bc3dfceb59dba00cc3ceed97ce1ed">XrdProofSessionInfo::fUnixPath</a></div><div class="ttdeci">XrdOucString fUnixPath</div><div class="ttdef"><b>Definition:</b> <a href="XrdProofdProofServMgr_8h_source.html#l00088">XrdProofdProofServMgr.h:88</a></div></div>
<div class="ttc" id="civetweb_8c_html_a2c6efa7679f8cd9f61af96e105017560"><div class="ttname"><a href="civetweb_8c.html#a2c6efa7679f8cd9f61af96e105017560">free</a></div><div class="ttdeci">#define free</div><div class="ttdef"><b>Definition:</b> <a href="civetweb_8c_source.html#l01539">civetweb.c:1539</a></div></div>
<div class="ttc" id="classXrdProofdProofServ_html_a18e4a17f4e9ef07f923b654e2d000148"><div class="ttname"><a href="classXrdProofdProofServ.html#a18e4a17f4e9ef07f923b654e2d000148">XrdProofdProofServ::ROOT</a></div><div class="ttdeci">XrdROOT * ROOT() const</div><div class="ttdef"><b>Definition:</b> <a href="XrdProofdProofServ_8h_source.html#l00159">XrdProofdProofServ.h:159</a></div></div>
<div class="ttc" id="classXrdProofdProofServ_html_a82ce7d276f54e6b4bb25430b738f7767"><div class="ttname"><a href="classXrdProofdProofServ.html#a82ce7d276f54e6b4bb25430b738f7767">XrdProofdProofServ::SrvPID</a></div><div class="ttdeci">int SrvPID() const</div><div class="ttdef"><b>Definition:</b> <a href="XrdProofdProofServ_8h_source.html#l00191">XrdProofdProofServ.h:191</a></div></div>
<div class="ttc" id="classXrdProofdProofServMgr_html_a1c418ea2fa6ac9a8e6990506de51a5d6"><div class="ttname"><a href="classXrdProofdProofServMgr.html#a1c418ea2fa6ac9a8e6990506de51a5d6">XrdProofdProofServMgr::fTerminationTimeOut</a></div><div class="ttdeci">int fTerminationTimeOut</div><div class="ttdef"><b>Definition:</b> <a href="XrdProofdProofServMgr_8h_source.html#l00150">XrdProofdProofServMgr.h:150</a></div></div>
<div class="ttc" id="classXrdProofdResponse_html"><div class="ttname"><a href="classXrdProofdResponse.html">XrdProofdResponse</a></div><div class="ttdef"><b>Definition:</b> <a href="XrdProofdResponse_8h_source.html#l00036">XrdProofdResponse.h:36</a></div></div>
<div class="ttc" id="classXrdProofdProofServ_html_a40e6ddd8c50a760e4a40e7a8d4fe149a"><div class="ttname"><a href="classXrdProofdProofServ.html#a40e6ddd8c50a760e4a40e7a8d4fe149a">XrdProofdProofServ::SetValid</a></div><div class="ttdeci">void SetValid(bool valid=1)</div><div class="ttdef"><b>Definition:</b> <a href="XrdProofdProofServ_8h_source.html#l00189">XrdProofdProofServ.h:189</a></div></div>
<div class="ttc" id="TRolke_8cxx_html_a680432d265de4ea2534f8ec32f1aa417"><div class="ttname"><a href="TRolke_8cxx.html#a680432d265de4ea2534f8ec32f1aa417">e</a></div><div class="ttdeci">you should not use this method at all Int_t Int_t Double_t Double_t Double_t e</div><div class="ttdef"><b>Definition:</b> <a href="TRolke_8cxx_source.html#l00630">TRolke.cxx:630</a></div></div>
<div class="ttc" id="classXrdProofdProofServ_html_aaad4182d28bb3706fc53955cde5add30"><div class="ttname"><a href="classXrdProofdProofServ.html#aaad4182d28bb3706fc53955cde5add30">XrdProofdProofServ::SetUserEnvs</a></div><div class="ttdeci">void SetUserEnvs(const char *t)</div><div class="ttdef"><b>Definition:</b> <a href="XrdProofdProofServ_8h_source.html#l00188">XrdProofdProofServ.h:188</a></div></div>
<div class="ttc" id="classXrdProofdManager_html_a69bde6786ea2b81c63d7777a47f7ba5d"><div class="ttname"><a href="classXrdProofdManager.html#a69bde6786ea2b81c63d7777a47f7ba5d">XrdProofdManager::AdminPath</a></div><div class="ttdeci">const char * AdminPath() const</div><div class="ttdef"><b>Definition:</b> <a href="XrdProofdManager_8h_source.html#l00074">XrdProofdManager.h:74</a></div></div>
<div class="ttc" id="classXrdProofdProofServ_html"><div class="ttname"><a href="classXrdProofdProofServ.html">XrdProofdProofServ</a></div><div class="ttdef"><b>Definition:</b> <a href="XrdProofdProofServ_8h_source.html#l00110">XrdProofdProofServ.h:110</a></div></div>
<div class="ttc" id="classXrdProofdManager_html_a0f1457620cc4e2de56258bf553843634"><div class="ttname"><a href="classXrdProofdManager.html#a0f1457620cc4e2de56258bf553843634">XrdProofdManager::EffectiveUser</a></div><div class="ttdeci">const char * EffectiveUser() const</div><div class="ttdef"><b>Definition:</b> <a href="XrdProofdManager_8h_source.html#l00105">XrdProofdManager.h:105</a></div></div>
<div class="ttc" id="classXrdProofdProofServMgr_html_a0964e25c122bd4285174d91425e62cd3"><div class="ttname"><a href="classXrdProofdProofServMgr.html#a0964e25c122bd4285174d91425e62cd3">XrdProofdProofServMgr::PrepareProofServ</a></div><div class="ttdeci">XrdProofdProofServ * PrepareProofServ(XrdProofdProtocol *p, XrdProofdResponse *r, unsigned short &amp;sid)</div><div class="ttdoc">Allocate and prepare the XrdProofdProofServ object describing this session. </div><div class="ttdef"><b>Definition:</b> <a href="XrdProofdProofServMgr_8cxx_source.html#l01650">XrdProofdProofServMgr.cxx:1650</a></div></div>
<div class="ttc" id="classXrdProofdAux_html_a7b07291c516f749a8cb7f8adef43a207"><div class="ttname"><a href="classXrdProofdAux.html#a7b07291c516f749a8cb7f8adef43a207">XrdProofdAux::ChangeMod</a></div><div class="ttdeci">static int ChangeMod(const char *path, unsigned int mode)</div><div class="ttdoc">Change the permission mode of &amp;#39;path&amp;#39; to &amp;#39;mode&amp;#39;. </div><div class="ttdef"><b>Definition:</b> <a href="XrdProofdAux_8cxx_source.html#l00568">XrdProofdAux.cxx:568</a></div></div>
<div class="ttc" id="classXrdProofdManager_html_a42d408e2536d05e8713e2adf87689977"><div class="ttname"><a href="classXrdProofdManager.html#a42d408e2536d05e8713e2adf87689977">XrdProofdManager::PoolURL</a></div><div class="ttdeci">const char * PoolURL() const</div><div class="ttdef"><b>Definition:</b> <a href="XrdProofdManager_8h_source.html#l00087">XrdProofdManager.h:87</a></div></div>
<div class="ttc" id="classXrdProofdProofServMgr_html_a7c23aca8c6f65bbd37ef356a3cdf7bef"><div class="ttname"><a href="classXrdProofdProofServMgr.html#a7c23aca8c6f65bbd37ef356a3cdf7bef">XrdProofdProofServMgr::DoDirectiveShutdown</a></div><div class="ttdeci">int DoDirectiveShutdown(char *, XrdOucStream *, bool)</div><div class="ttdoc">Process &amp;#39;shutdown&amp;#39; directive. </div><div class="ttdef"><b>Definition:</b> <a href="XrdProofdProofServMgr_8cxx_source.html#l01452">XrdProofdProofServMgr.cxx:1452</a></div></div>
<div class="ttc" id="classXrdROOT_html_a81156bb540f240c237296609f3db8a91"><div class="ttname"><a href="classXrdROOT.html#a81156bb540f240c237296609f3db8a91">XrdROOT::Export</a></div><div class="ttdeci">const char * Export() const</div><div class="ttdef"><b>Definition:</b> <a href="XrdROOT_8h_source.html#l00070">XrdROOT.h:70</a></div></div>
<div class="ttc" id="XrdProofdProtocol_8h_html_a877c158bc5a36171e7e5a4be25f6b4cb"><div class="ttname"><a href="XrdProofdProtocol_8h.html#a877c158bc5a36171e7e5a4be25f6b4cb">XPD_SETRESP</a></div><div class="ttdeci">#define XPD_SETRESP(p, x)</div><div class="ttdef"><b>Definition:</b> <a href="XrdProofdProtocol_8h_source.html#l00197">XrdProofdProtocol.h:197</a></div></div>
<div class="ttc" id="classXrdProofSessionInfo_html_ad3e62b6ba7bfe0bdba1bfe9aa5baa2ab"><div class="ttname"><a href="classXrdProofSessionInfo.html#ad3e62b6ba7bfe0bdba1bfe9aa5baa2ab">XrdProofSessionInfo::fLastAccess</a></div><div class="ttdeci">time_t fLastAccess</div><div class="ttdef"><b>Definition:</b> <a href="XrdProofdProofServMgr_8h_source.html#l00080">XrdProofdProofServMgr.h:80</a></div></div>
<div class="ttc" id="TPosixThread_8h_html_ab708b36917a193216583824c37326042"><div class="ttname"><a href="TPosixThread_8h.html#ab708b36917a193216583824c37326042">sleep</a></div><div class="ttdeci">R__EXTERN C unsigned int sleep(unsigned int seconds)</div></div>
<div class="ttc" id="XrdProofdProofServMgr_8cxx_html_a161fcc2ffe02d9e7e5fe72497b75f9a2"><div class="ttname"><a href="XrdProofdProofServMgr_8cxx.html#a161fcc2ffe02d9e7e5fe72497b75f9a2">WriteSessRCs</a></div><div class="ttdeci">static int WriteSessRCs(const char *, XpdEnv *erc, void *f)</div><div class="ttdoc">Run thorugh entries to broadcast the relevant priority. </div><div class="ttdef"><b>Definition:</b> <a href="XrdProofdProofServMgr_8cxx_source.html#l03303">XrdProofdProofServMgr.cxx:3303</a></div></div>
<div class="ttc" id="classXrdProofdProofServMgr_html_ab5ef76ea6d32a74b258884914c8fa0a5"><div class="ttname"><a href="classXrdProofdProofServMgr.html#ab5ef76ea6d32a74b258884914c8fa0a5">XrdProofdProofServMgr::fSeqSessionN</a></div><div class="ttdeci">unsigned int fSeqSessionN</div><div class="ttdef"><b>Definition:</b> <a href="XrdProofdProofServMgr_8h_source.html#l00163">XrdProofdProofServMgr.h:163</a></div></div>
<div class="ttc" id="classXrdProofdProofServMgr_html_a2d9c4bfb86ff4297ee34f14153d98616"><div class="ttname"><a href="classXrdProofdProofServMgr.html#a2d9c4bfb86ff4297ee34f14153d98616">XrdProofdProofServMgr::FillEnvList</a></div><div class="ttdeci">void FillEnvList(std::list&lt; XpdEnv &gt; *el, const char *nam, const char *val, const char *usrs=0, const char *grps=0, int smi=-1, int smx=-1, int vmi=-1, int vmx=-1, bool hex=0)</div><div class="ttdoc">Fill env entry(ies) in the relevant list. </div><div class="ttdef"><b>Definition:</b> <a href="XrdProofdProofServMgr_8cxx_source.html#l01394">XrdProofdProofServMgr.cxx:1394</a></div></div>
<div class="ttc" id="classXrdProofdProofServMgr_html_aa6d48bec6ed96ba43ce7702d3451997a"><div class="ttname"><a href="classXrdProofdProofServMgr.html#aa6d48bec6ed96ba43ce7702d3451997a">XrdProofdProofServMgr::SetNextSessionsCheck</a></div><div class="ttdeci">void SetNextSessionsCheck(int t)</div><div class="ttdef"><b>Definition:</b> <a href="XrdProofdProofServMgr_8h_source.html#l00247">XrdProofdProofServMgr.h:247</a></div></div>
<div class="ttc" id="classXrdProofdClient_html"><div class="ttname"><a href="classXrdProofdClient.html">XrdProofdClient</a></div><div class="ttdef"><b>Definition:</b> <a href="XrdProofdClient_8h_source.html#l00043">XrdProofdClient.h:43</a></div></div>
<div class="ttc" id="classXrdProofdProofServ_html_afa65a2a39d7a18b03045d4c8ce664f21"><div class="ttname"><a href="classXrdProofdProofServ.html#afa65a2a39d7a18b03045d4c8ce664f21">XrdProofdProofServ::Parent</a></div><div class="ttdeci">XrdClientID * Parent() const</div><div class="ttdef"><b>Definition:</b> <a href="XrdProofdProofServ_8h_source.html#l00147">XrdProofdProofServ.h:147</a></div></div>
<div class="ttc" id="classXrdProofSched_html_a99837614e43c388e939032a008323e4ea1e3d8e3c5bcd49ce0e5451c81cf96a77"><div class="ttname"><a href="classXrdProofSched.html#a99837614e43c388e939032a008323e4ea1e3d8e3c5bcd49ce0e5451c81cf96a77">XrdProofSched::kReschedule</a></div><div class="ttdef"><b>Definition:</b> <a href="XrdProofSched_8h_source.html#l00114">XrdProofSched.h:114</a></div></div>
<div class="ttc" id="classXrdProofdManager_html_a0b386ac846971e48a857fb3c8332fd0d"><div class="ttname"><a href="classXrdProofdManager.html#a0b386ac846971e48a857fb3c8332fd0d">XrdProofdManager::PriorityMgr</a></div><div class="ttdeci">XrdProofdPriorityMgr * PriorityMgr() const</div><div class="ttdef"><b>Definition:</b> <a href="XrdProofdManager_8h_source.html#l00112">XrdProofdManager.h:112</a></div></div>
<div class="ttc" id="classXrdProofdProofServMgr_html_ab90491b1fb65834e75bd46f6e09db87f"><div class="ttname"><a href="classXrdProofdProofServMgr.html#ab90491b1fb65834e75bd46f6e09db87f">XrdProofdProofServMgr::fMutex</a></div><div class="ttdeci">XrdSysRecMutex fMutex</div><div class="ttdef"><b>Definition:</b> <a href="XrdProofdProofServMgr_8h_source.html#l00133">XrdProofdProofServMgr.h:133</a></div></div>
<div class="ttc" id="classXrdProofdClient_html_a55c0e73c9bca2a64fd6417d750db02e2"><div class="ttname"><a href="classXrdProofdClient.html#a55c0e73c9bca2a64fd6417d750db02e2">XrdProofdClient::ROOT</a></div><div class="ttdeci">XrdROOT * ROOT() const</div><div class="ttdef"><b>Definition:</b> <a href="XrdProofdClient_8h_source.html#l00056">XrdProofdClient.h:56</a></div></div>
<div class="ttc" id="classXrdProofdProofServMgr_html_aa10fdb50ded6eb18fbe118b0f8407027"><div class="ttname"><a href="classXrdProofdProofServMgr.html#aa10fdb50ded6eb18fbe118b0f8407027">XrdProofdProofServMgr::fShutdownOpt</a></div><div class="ttdeci">int fShutdownOpt</div><div class="ttdef"><b>Definition:</b> <a href="XrdProofdProofServMgr_8h_source.html#l00144">XrdProofdProofServMgr.h:144</a></div></div>
<div class="ttc" id="textangle_8C_html_a3359d7f1aa9fe2f8bc884b02020e8d20"><div class="ttname"><a href="textangle_8C.html#a3359d7f1aa9fe2f8bc884b02020e8d20">l</a></div><div class="ttdeci">auto * l</div><div class="ttdef"><b>Definition:</b> <a href="textangle_8C_source.html#l00004">textangle.C:4</a></div></div>
<div class="ttc" id="classXpdMsg_html_aa9622613afd3280395e27cc6e2e2b440"><div class="ttname"><a href="classXpdMsg.html#aa9622613afd3280395e27cc6e2e2b440">XpdMsg::Get</a></div><div class="ttdeci">int Get(int &amp;i)</div><div class="ttdoc">Get next token and interpret it as an int. </div><div class="ttdef"><b>Definition:</b> <a href="XrdProofdAux_8cxx_source.html#l01886">XrdProofdAux.cxx:1886</a></div></div>
<div class="ttc" id="classXrdProofdManager_html_a261fd4aaad8c8d64cc3ec18b8fdba69a"><div class="ttname"><a href="classXrdProofdManager.html#a261fd4aaad8c8d64cc3ec18b8fdba69a">XrdProofdManager::DataDirOpts</a></div><div class="ttdeci">const char * DataDirOpts() const</div><div class="ttdef"><b>Definition:</b> <a href="XrdProofdManager_8h_source.html#l00094">XrdProofdManager.h:94</a></div></div>
<div class="ttc" id="classXrdProofdManager_html_a4f68981d1bc8bd7a567a2404c47fa7c4"><div class="ttname"><a href="classXrdProofdManager.html#a4f68981d1bc8bd7a567a2404c47fa7c4">XrdProofdManager::IsSuperMst</a></div><div class="ttdeci">bool IsSuperMst() const</div><div class="ttdef"><b>Definition:</b> <a href="XrdProofdManager_8h_source.html#l00083">XrdProofdManager.h:83</a></div></div>
<div class="ttc" id="namespacefile_html"><div class="ttname"><a href="namespacefile.html">file</a></div><div class="ttdef"><b>Definition:</b> <a href="file_8py_source.html#l00001">file.py:1</a></div></div>
<div class="ttc" id="classXrdProofdProofServMgr_html_a2981c286cc9af1b538b5ba3cd57574c8"><div class="ttname"><a href="classXrdProofdProofServMgr.html#a2981c286cc9af1b538b5ba3cd57574c8">XrdProofdProofServMgr::XrdProofdProofServMgr</a></div><div class="ttdeci">XrdProofdProofServMgr(XrdProofdManager *mgr, XrdProtocol_Config *pi, XrdSysError *e)</div><div class="ttdoc">Constructor. </div><div class="ttdef"><b>Definition:</b> <a href="XrdProofdProofServMgr_8cxx_source.html#l00270">XrdProofdProofServMgr.cxx:270</a></div></div>
<div class="ttc" id="XrdProofdPriorityMgr_8h_html"><div class="ttname"><a href="XrdProofdPriorityMgr_8h.html">XrdProofdPriorityMgr.h</a></div></div>
<div class="ttc" id="namespaceTGeant4Unit_html_a61aca601fa057e4f7601210bcc81d478"><div class="ttname"><a href="namespaceTGeant4Unit.html#a61aca601fa057e4f7601210bcc81d478">TGeant4Unit::pi</a></div><div class="ttdeci">static constexpr double pi</div><div class="ttdef"><b>Definition:</b> <a href="TGeant4SystemOfUnits_8h_source.html#l00067">TGeant4SystemOfUnits.h:67</a></div></div>
<div class="ttc" id="classXrdProofdProofServ_html_a324107a325d536f3b3ff90057dbea63f"><div class="ttname"><a href="classXrdProofdProofServ.html#a324107a325d536f3b3ff90057dbea63f">XrdProofdProofServ::Status</a></div><div class="ttdeci">int Status() const</div><div class="ttdef"><b>Definition:</b> <a href="XrdProofdProofServ_8h_source.html#l00194">XrdProofdProofServ.h:194</a></div></div>
<div class="ttc" id="classXrdProofdProofServMgr_html_a06f01db3e2c065960fa5f7f6cd99e496"><div class="ttname"><a href="classXrdProofdProofServMgr.html#a06f01db3e2c065960fa5f7f6cd99e496">XrdProofdProofServMgr::Create</a></div><div class="ttdeci">int Create(XrdProofdProtocol *p)</div><div class="ttdoc">Handle a request to create a new session. </div><div class="ttdef"><b>Definition:</b> <a href="XrdProofdProofServMgr_8cxx_source.html#l01777">XrdProofdProofServMgr.cxx:1777</a></div></div>
<div class="ttc" id="classXrdProofdAux_html_a7a63defb9a91e1c09541856982af6d59"><div class="ttname"><a href="classXrdProofdAux.html#a7a63defb9a91e1c09541856982af6d59">XrdProofdAux::ChangeToDir</a></div><div class="ttdeci">static int ChangeToDir(const char *dir, XrdProofUI ui, bool changeown)</div><div class="ttdoc">Change current directory to &amp;#39;dir&amp;#39;. </div><div class="ttdef"><b>Definition:</b> <a href="XrdProofdAux_8cxx_source.html#l00657">XrdProofdAux.cxx:657</a></div></div>
<div class="ttc" id="classXrdProofdClient_html_a062a4396b4b8f0667f3a97a64c7f1c3d"><div class="ttname"><a href="classXrdProofdClient.html#a062a4396b4b8f0667f3a97a64c7f1c3d">XrdProofdClient::UI</a></div><div class="ttdeci">XrdProofUI UI() const</div><div class="ttdef"><b>Definition:</b> <a href="XrdProofdClient_8h_source.html#l00058">XrdProofdClient.h:58</a></div></div>
<div class="ttc" id="classXrdProofdProofServMgr_html_a3d7506e0fff1042ca99d77c2ad432f19"><div class="ttname"><a href="classXrdProofdProofServMgr.html#a3d7506e0fff1042ca99d77c2ad432f19">XrdProofdProofServMgr::fInternalWait</a></div><div class="ttdeci">int fInternalWait</div><div class="ttdef"><b>Definition:</b> <a href="XrdProofdProofServMgr_8h_source.html#l00139">XrdProofdProofServMgr.h:139</a></div></div>
<div class="ttc" id="XrdProofdProofServMgr_8cxx_html_acb7a7a3f2f44854897676341935e1161"><div class="ttname"><a href="XrdProofdProofServMgr_8cxx.html#acb7a7a3f2f44854897676341935e1161">XrdProofdProofServCron</a></div><div class="ttdeci">void * XrdProofdProofServCron(void *p)</div><div class="ttdoc">This is an endless loop to check the system periodically or when triggered via a message in a dedicat...</div><div class="ttdef"><b>Definition:</b> <a href="XrdProofdProofServMgr_8cxx_source.html#l00082">XrdProofdProofServMgr.cxx:82</a></div></div>
<div class="ttc" id="classXrdProofdConfig_html_ab2163674ebfd3801ee81e6ee720151bf"><div class="ttname"><a href="classXrdProofdConfig.html#ab2163674ebfd3801ee81e6ee720151bf">XrdProofdConfig::CfgFile</a></div><div class="ttdeci">const char * CfgFile() const</div><div class="ttdef"><b>Definition:</b> <a href="XrdProofdConfig_8h_source.html#l00051">XrdProofdConfig.h:51</a></div></div>
<div class="ttc" id="civetweb_8c_html_aa367b75c5aed883fef5befbdf04835a4"><div class="ttname"><a href="civetweb_8c.html#aa367b75c5aed883fef5befbdf04835a4">snprintf</a></div><div class="ttdeci">#define snprintf</div><div class="ttdef"><b>Definition:</b> <a href="civetweb_8c_source.html#l01540">civetweb.c:1540</a></div></div>
<div class="ttc" id="structProofServEnv__t_html_a063361fdad238f075537682178fdd1b3"><div class="ttname"><a href="structProofServEnv__t.html#a063361fdad238f075537682178fdd1b3">ProofServEnv_t::fTopSessionTag</a></div><div class="ttdeci">XrdOucString fTopSessionTag</div><div class="ttdef"><b>Definition:</b> <a href="XrdProofdProofServMgr_8h_source.html#l00063">XrdProofdProofServMgr.h:63</a></div></div>
<div class="ttc" id="classXrdProofdProofServMgr_html_a8952ab10fb646580a5defde06754a38a"><div class="ttname"><a href="classXrdProofdProofServMgr.html#a8952ab10fb646580a5defde06754a38a">XrdProofdProofServMgr::DoDirective</a></div><div class="ttdeci">int DoDirective(XrdProofdDirective *d, char *val, XrdOucStream *cfg, bool rcf)</div><div class="ttdoc">Update the priorities of the active sessions. </div><div class="ttdef"><b>Definition:</b> <a href="XrdProofdProofServMgr_8cxx_source.html#l01190">XrdProofdProofServMgr.cxx:1190</a></div></div>
<div class="ttc" id="classXrdProofdProofServMgr_html_a2a5e88f26472a0d1fde187373a1d7831"><div class="ttname"><a href="classXrdProofdProofServMgr.html#a2a5e88f26472a0d1fde187373a1d7831">XrdProofdProofServMgr::DoDirectivePutRc</a></div><div class="ttdeci">int DoDirectivePutRc(char *, XrdOucStream *, bool)</div><div class="ttdoc">Process &amp;#39;putrc&amp;#39; directives. </div><div class="ttdef"><b>Definition:</b> <a href="XrdProofdProofServMgr_8cxx_source.html#l01316">XrdProofdProofServMgr.cxx:1316</a></div></div>
<div class="ttc" id="classXrdProofdManager_html_ad0515f5873ad4e10c35f7b7dc1ec885f"><div class="ttname"><a href="classXrdProofdManager.html#ad0515f5873ad4e10c35f7b7dc1ec885f">XrdProofdManager::Image</a></div><div class="ttdeci">const char * Image() const</div><div class="ttdef"><b>Definition:</b> <a href="XrdProofdManager_8h_source.html#l00082">XrdProofdManager.h:82</a></div></div>
<div class="ttc" id="RSha256_8hxx_html_a63f410abde93141c9013b7d3f3971738"><div class="ttname"><a href="RSha256_8hxx.html#a63f410abde93141c9013b7d3f3971738">c</a></div><div class="ttdeci">#define c(i)</div><div class="ttdef"><b>Definition:</b> <a href="RSha256_8hxx_source.html#l00101">RSha256.hxx:101</a></div></div>
<div class="ttc" id="classXrdProofdProofServMgr_html_a01b123203cef2462de822fabff1f2e11"><div class="ttname"><a href="classXrdProofdProofServMgr.html#a01b123203cef2462de822fabff1f2e11">XrdProofdProofServMgr::GetActiveSession</a></div><div class="ttdeci">XrdProofdProofServ * GetActiveSession(int pid)</div><div class="ttdoc">Return active session with process ID pid, if any. </div><div class="ttdef"><b>Definition:</b> <a href="XrdProofdProofServMgr_8cxx_source.html#l04498">XrdProofdProofServMgr.cxx:4498</a></div></div>
<div class="ttc" id="XProofProtocol_8h_html_a239aaf631ff9e4c6ebece4a2362d3f75"><div class="ttname"><a href="XProofProtocol_8h.html#a239aaf631ff9e4c6ebece4a2362d3f75">kXPD_Master</a></div><div class="ttdeci">#define kXPD_Master</div><div class="ttdef"><b>Definition:</b> <a href="XProofProtocol_8h_source.html#l00065">XProofProtocol.h:65</a></div></div>
<div class="ttc" id="classXrdProofSessionInfo_html_aeae35e545621570f63e10ea17fedbcb9"><div class="ttname"><a href="classXrdProofSessionInfo.html#aeae35e545621570f63e10ea17fedbcb9">XrdProofSessionInfo::ReadFromFile</a></div><div class="ttdeci">int ReadFromFile(const char *file)</div><div class="ttdoc">Read content from &amp;#39;file&amp;#39;. </div><div class="ttdef"><b>Definition:</b> <a href="XrdProofdProofServMgr_8cxx_source.html#l04888">XrdProofdProofServMgr.cxx:4888</a></div></div>
<div class="ttc" id="classXrdProofdClientMgr_html_a412036bb15d081a0b77deb6ff778d197"><div class="ttname"><a href="classXrdProofdClientMgr.html#a412036bb15d081a0b77deb6ff778d197">XrdProofdClientMgr::GetClient</a></div><div class="ttdeci">XrdProofdClient * GetClient(const char *usr, const char *grp=0, bool create=1)</div><div class="ttdoc">Handle request for localizing a client instance for {usr, grp} from the list. </div><div class="ttdef"><b>Definition:</b> <a href="XrdProofdClientMgr_8cxx_source.html#l01353">XrdProofdClientMgr.cxx:1353</a></div></div>
<div class="ttc" id="classXrdProofdProtocol_html_a80024c8f848d0eabe9f13d09f06c8d9d"><div class="ttname"><a href="classXrdProofdProtocol.html#a80024c8f848d0eabe9f13d09f06c8d9d">XrdProofdProtocol::Client</a></div><div class="ttdeci">XrdProofdClient * Client() const</div><div class="ttdef"><b>Definition:</b> <a href="XrdProofdProtocol_8h_source.html#l00076">XrdProofdProtocol.h:76</a></div></div>
<div class="ttc" id="classXrdProofdAux_html_a01fd3ef6927e3bab19848e23bc61c904"><div class="ttname"><a href="classXrdProofdAux.html#a01fd3ef6927e3bab19848e23bc61c904">XrdProofdAux::ChangeOwn</a></div><div class="ttdeci">static int ChangeOwn(const char *path, XrdProofUI ui)</div><div class="ttdoc">Change the ownership of &amp;#39;path&amp;#39; to the entity described by &amp;#39;ui&amp;#39;. </div><div class="ttdef"><b>Definition:</b> <a href="XrdProofdAux_8cxx_source.html#l00511">XrdProofdAux.cxx:511</a></div></div>
<div class="ttc" id="classXrdProofdPipe_html_af3d2dbc5b021d794acc09bdc0aa3fa5e"><div class="ttname"><a href="classXrdProofdPipe.html#af3d2dbc5b021d794acc09bdc0aa3fa5e">XrdProofdPipe::Post</a></div><div class="ttdeci">int Post(int type, const char *msg)</div><div class="ttdoc">Post message on the pipe. </div><div class="ttdef"><b>Definition:</b> <a href="XrdProofdAux_8cxx_source.html#l01761">XrdProofdAux.cxx:1761</a></div></div>
<div class="ttc" id="classXrdProofdManager_html"><div class="ttname"><a href="classXrdProofdManager.html">XrdProofdManager</a></div><div class="ttdef"><b>Definition:</b> <a href="XrdProofdManager_8h_source.html#l00056">XrdProofdManager.h:56</a></div></div>
<div class="ttc" id="classXrdProofdAux_html_a44927170bd725bb1476300e603bb9332"><div class="ttname"><a href="classXrdProofdAux.html#a44927170bd725bb1476300e603bb9332">XrdProofdAux::VerifyProcessByID</a></div><div class="ttdeci">static int VerifyProcessByID(int pid, const char *pname=&quot;proofserv&quot;)</div><div class="ttdoc">Check if a process named &amp;#39;pname&amp;#39; and process &amp;#39;pid&amp;#39; is still in the process table. ...</div><div class="ttdef"><b>Definition:</b> <a href="XrdProofdAux_8cxx_source.html#l01153">XrdProofdAux.cxx:1153</a></div></div>
<div class="ttc" id="classXrdProofdProofServMgr_html_a2f69ab8ab20f64f0ce7521dcf6be2952"><div class="ttname"><a href="classXrdProofdProofServMgr.html#a2f69ab8ab20f64f0ce7521dcf6be2952">XrdProofdProofServMgr::AcceptPeer</a></div><div class="ttdeci">int AcceptPeer(XrdProofdProofServ *xps, int to, XrdOucString &amp;e)</div><div class="ttdoc">Accept a callback from a starting-up server and setup the related protocol object. </div><div class="ttdef"><b>Definition:</b> <a href="XrdProofdProofServMgr_8cxx_source.html#l02547">XrdProofdProofServMgr.cxx:2547</a></div></div>
<div class="ttc" id="classXrdProofdProofServMgr_html_a9ab19d67f4db0bd30bc8ac858f790951"><div class="ttname"><a href="classXrdProofdProofServMgr.html#a9ab19d67f4db0bd30bc8ac858f790951">XrdProofdProofServMgr::RecoverActiveSessions</a></div><div class="ttdeci">int RecoverActiveSessions()</div><div class="ttdoc">Accept connections from sessions still alive. </div><div class="ttdef"><b>Definition:</b> <a href="XrdProofdProofServMgr_8cxx_source.html#l00780">XrdProofdProofServMgr.cxx:780</a></div></div>
<div class="ttc" id="classXrdProofdProofServMgr_html_a94600aafa5d2398a65a971f1189e9423"><div class="ttname"><a href="classXrdProofdProofServMgr.html#a94600aafa5d2398a65a971f1189e9423">XrdProofdProofServMgr::DoDirectivePutEnv</a></div><div class="ttdeci">int DoDirectivePutEnv(char *, XrdOucStream *, bool)</div><div class="ttdoc">Process &amp;#39;putenv&amp;#39; directives. </div><div class="ttdef"><b>Definition:</b> <a href="XrdProofdProofServMgr_8cxx_source.html#l01285">XrdProofdProofServMgr.cxx:1285</a></div></div>
<div class="ttc" id="classXpdEnv_html_aff870adeeda5a3260f3b714db0467090"><div class="ttname"><a href="classXpdEnv.html#aff870adeeda5a3260f3b714db0467090">XpdEnv::fEnv</a></div><div class="ttdeci">XrdOucString fEnv</div><div class="ttdef"><b>Definition:</b> <a href="XrdProofdProofServMgr_8h_source.html#l00110">XrdProofdProofServMgr.h:110</a></div></div>
<div class="ttc" id="classXrdProofdProofServMgr_html_aaebdf9da139d40cf89c6c98f38941c97acd0b6b8d06824cfff38e240575b61036"><div class="ttname"><a href="classXrdProofdProofServMgr.html#aaebdf9da139d40cf89c6c98f38941c97acd0b6b8d06824cfff38e240575b61036">XrdProofdProofServMgr::kSessionRemoval</a></div><div class="ttdef"><b>Definition:</b> <a href="XrdProofdProofServMgr_8h_source.html#l00231">XrdProofdProofServMgr.h:231</a></div></div>
<div class="ttc" id="XrdProofdProofServMgr_8h_html_a4640192217d85ff3c4111f2498dd6329"><div class="ttname"><a href="XrdProofdProofServMgr_8h.html#a4640192217d85ff3c4111f2498dd6329">PSMMAXCNTS</a></div><div class="ttdeci">#define PSMMAXCNTS</div><div class="ttdef"><b>Definition:</b> <a href="XrdProofdProofServMgr_8h_source.html#l00050">XrdProofdProofServMgr.h:50</a></div></div>
<div class="ttc" id="XrdProofdPlatform_8h_html"><div class="ttname"><a href="XrdProofdPlatform_8h.html">XrdProofdPlatform.h</a></div></div>
<div class="ttc" id="classXrdProofdClient_html_aa9d71c8c1536b1998a8d28e9cfb3b363"><div class="ttname"><a href="classXrdProofdClient.html#aa9d71c8c1536b1998a8d28e9cfb3b363">XrdProofdClient::GetServer</a></div><div class="ttdeci">XrdProofdProofServ * GetServer(int psid)</div><div class="ttdoc">Get from the vector server instance with ID psid. </div><div class="ttdef"><b>Definition:</b> <a href="XrdProofdClient_8cxx_source.html#l00320">XrdProofdClient.cxx:320</a></div></div>
<div class="ttc" id="classXrdProofdProofServMgr_html_aaebdf9da139d40cf89c6c98f38941c97a3209788aac4b903246a5ae5ec3f7e7ff"><div class="ttname"><a href="classXrdProofdProofServMgr.html#aaebdf9da139d40cf89c6c98f38941c97a3209788aac4b903246a5ae5ec3f7e7ff">XrdProofdProofServMgr::kChgSessionSt</a></div><div class="ttdef"><b>Definition:</b> <a href="XrdProofdProofServMgr_8h_source.html#l00231">XrdProofdProofServMgr.h:231</a></div></div>
<div class="ttc" id="structXpdManagerCron__t_html"><div class="ttname"><a href="structXpdManagerCron__t.html">XpdManagerCron_t</a></div><div class="ttdef"><b>Definition:</b> <a href="XrdProofdManager_8h_source.html#l00212">XrdProofdManager.h:212</a></div></div>
<div class="ttc" id="classXrdProofdProofServMgr_html_a27dec7acd4252ca1e14bf50c654e66c2"><div class="ttname"><a href="classXrdProofdProofServMgr.html#a27dec7acd4252ca1e14bf50c654e66c2">XrdProofdProofServMgr::CheckCounter</a></div><div class="ttdeci">int CheckCounter(int t)</div><div class="ttdef"><b>Definition:</b> <a href="XrdProofdProofServMgr_8h_source.html#l00269">XrdProofdProofServMgr.h:269</a></div></div>
<div class="ttc" id="XrdProofdProofServMgr_8h_html"><div class="ttname"><a href="XrdProofdProofServMgr_8h.html">XrdProofdProofServMgr.h</a></div></div>
<div class="ttc" id="classXrdProofSessionInfo_html_ad1081533106098435cdc37c6ab670ae3"><div class="ttname"><a href="classXrdProofSessionInfo.html#ad1081533106098435cdc37c6ab670ae3">XrdProofSessionInfo::fLogFile</a></div><div class="ttdeci">XrdOucString fLogFile</div><div class="ttdef"><b>Definition:</b> <a href="XrdProofdProofServMgr_8h_source.html#l00091">XrdProofdProofServMgr.h:91</a></div></div>
<div class="ttc" id="classXrdProofdAux_html_a8d7c2c117a8f570eff5ffd8e98a12033"><div class="ttname"><a href="classXrdProofdAux.html#a8d7c2c117a8f570eff5ffd8e98a12033">XrdProofdAux::GetProcesses</a></div><div class="ttdeci">static int GetProcesses(const char *pn, std::map&lt; int, XrdOucString &gt; *plist)</div><div class="ttdoc">Get from the process table list of PIDs for processes named &quot;proofserv&amp;#39; For {linux, sun, macosx} it uses the system info; for other systems it invokes the command shell &amp;#39;ps ax&amp;#39; via popen. </div><div class="ttdef"><b>Definition:</b> <a href="XrdProofdAux_8cxx_source.html#l00921">XrdProofdAux.cxx:921</a></div></div>
<div class="ttc" id="classXrdProofdAux_html_acfae2dfa1609be5e19ff91b5d0ee5699"><div class="ttname"><a href="classXrdProofdAux.html#acfae2dfa1609be5e19ff91b5d0ee5699">XrdProofdAux::LogEmsgToFile</a></div><div class="ttdeci">static void LogEmsgToFile(const char *flog, const char *emsg, const char *pfx=0)</div><div class="ttdoc">Logs error message &amp;#39;emsg&amp;#39; to file &amp;#39;flog&amp;#39; using standard technology. </div><div class="ttdef"><b>Definition:</b> <a href="XrdProofdAux_8cxx_source.html#l00394">XrdProofdAux.cxx:394</a></div></div>
<div class="ttc" id="classXrdProofSessionInfo_html_a07eaeda3939341c7c9c34ffbda48b3cd"><div class="ttname"><a href="classXrdProofSessionInfo.html#a07eaeda3939341c7c9c34ffbda48b3cd">XrdProofSessionInfo::fAlias</a></div><div class="ttdeci">XrdOucString fAlias</div><div class="ttdef"><b>Definition:</b> <a href="XrdProofdProofServMgr_8h_source.html#l00090">XrdProofdProofServMgr.h:90</a></div></div>
<div class="ttc" id="structProofServEnv__t_html_a24e0948cb1405b0d8c8360500ef20707"><div class="ttname"><a href="structProofServEnv__t.html#a24e0948cb1405b0d8c8360500ef20707">ProofServEnv_t::fWrkDir</a></div><div class="ttdeci">XrdOucString fWrkDir</div><div class="ttdef"><b>Definition:</b> <a href="XrdProofdProofServMgr_8h_source.html#l00065">XrdProofdProofServMgr.h:65</a></div></div>
<div class="ttc" id="namespaceROOT_1_1Math_1_1detail_html_af7bd9296f106e2e1402e539ca33bdf94a37cfce0c407fb91bb0b1d71b586841a3"><div class="ttname"><a href="namespaceROOT_1_1Math_1_1detail.html#af7bd9296f106e2e1402e539ca33bdf94a37cfce0c407fb91bb0b1d71b586841a3">ROOT::Math::detail::open</a></div><div class="ttdef"><b>Definition:</b> <a href="GenVectorIO_8h_source.html#l00035">GenVectorIO.h:35</a></div></div>
<div class="ttc" id="classXrdProofdProofServMgr_html_aa7d4e4ec33be14cd70bbc3595332736e"><div class="ttname"><a href="classXrdProofdProofServMgr.html#aa7d4e4ec33be14cd70bbc3595332736e">XrdProofdProofServMgr::fActiAdminPath</a></div><div class="ttdeci">XrdOucString fActiAdminPath</div><div class="ttdef"><b>Definition:</b> <a href="XrdProofdProofServMgr_8h_source.html#l00167">XrdProofdProofServMgr.h:167</a></div></div>
<div class="ttc" id="classXrdProofdProofServMgr_html_a166d3cc8d5d88c9bf2ac9a8a9d1f8d5e"><div class="ttname"><a href="classXrdProofdProofServMgr.html#a166d3cc8d5d88c9bf2ac9a8a9d1f8d5e">XrdProofdProofServMgr::fCounters</a></div><div class="ttdeci">int fCounters[PSMMAXCNTS]</div><div class="ttdef"><b>Definition:</b> <a href="XrdProofdProofServMgr_8h_source.html#l00160">XrdProofdProofServMgr.h:160</a></div></div>
<div class="ttc" id="classXrdProofdProofServ_html_a85bb976f3658a3544bdff4fa0d4cd1bf"><div class="ttname"><a href="classXrdProofdProofServ.html#a85bb976f3658a3544bdff4fa0d4cd1bf">XrdProofdProofServ::VerifyProofServ</a></div><div class="ttdeci">int VerifyProofServ(bool fw)</div><div class="ttdoc">Check if the associated proofserv process is alive. </div><div class="ttdef"><b>Definition:</b> <a href="XrdProofdProofServ_8cxx_source.html#l00529">XrdProofdProofServ.cxx:529</a></div></div>
<div class="ttc" id="classXrdProofdProofServ_html_a62c5781d3826ef714ed130ebc0992bb5"><div class="ttname"><a href="classXrdProofdProofServ.html#a62c5781d3826ef714ed130ebc0992bb5">XrdProofdProofServ::SetSrvPID</a></div><div class="ttdeci">void SetSrvPID(int pid)</div><div class="ttdef"><b>Definition:</b> <a href="XrdProofdProofServ_8h_source.html#l00182">XrdProofdProofServ.h:182</a></div></div>
<div class="ttc" id="classXrdProofdClient_html_a3ec412bd59e2569ddd1e76962174ffc6"><div class="ttname"><a href="classXrdProofdClient.html#a3ec412bd59e2569ddd1e76962174ffc6">XrdProofdClient::GetFreeServObj</a></div><div class="ttdeci">XrdProofdProofServ * GetFreeServObj()</div><div class="ttdoc">Get next free server ID. </div><div class="ttdef"><b>Definition:</b> <a href="XrdProofdClient_8cxx_source.html#l00182">XrdProofdClient.cxx:182</a></div></div>
<div class="ttc" id="XProofProtocol_8h_html_a81dc1edcb19adb12975b44e65a3c88f4afccd8aacc7086f7ef815d546a9336fe9"><div class="ttname"><a href="XProofProtocol_8h.html#a81dc1edcb19adb12975b44e65a3c88f4afccd8aacc7086f7ef815d546a9336fe9">kXP_ServerError</a></div><div class="ttdef"><b>Definition:</b> <a href="XProofProtocol_8h_source.html#l00215">XProofProtocol.h:215</a></div></div>
<div class="ttc" id="classXrdProofdProofServMgr_html_ad740c44abd44e15d5c58ba014b310307"><div class="ttname"><a href="classXrdProofdProofServMgr.html#ad740c44abd44e15d5c58ba014b310307">XrdProofdProofServMgr::Mutex</a></div><div class="ttdeci">XrdSysRecMutex * Mutex()</div><div class="ttdef"><b>Definition:</b> <a href="XrdProofdProofServMgr_8h_source.html#l00234">XrdProofdProofServMgr.h:234</a></div></div>
<div class="ttc" id="classXrdProofdConfig_html_a3c6ee459c7e1ee7042f72139ce32a3dc"><div class="ttname"><a href="classXrdProofdConfig.html#a3c6ee459c7e1ee7042f72139ce32a3dc">XrdProofdConfig::Config</a></div><div class="ttdeci">virtual int Config(bool rcf=0)</div><div class="ttdef"><b>Definition:</b> <a href="XrdProofdConfig_8h_source.html#l00053">XrdProofdConfig.h:53</a></div></div>
<div class="ttc" id="classXrdProofdProofServ_html_a065f2c13e9cec3b03b332003573f00b0"><div class="ttname"><a href="classXrdProofdProofServ.html#a065f2c13e9cec3b03b332003573f00b0">XrdProofdProofServ::UserEnvs</a></div><div class="ttdeci">const char * UserEnvs() const</div><div class="ttdef"><b>Definition:</b> <a href="XrdProofdProofServ_8h_source.html#l00197">XrdProofdProofServ.h:197</a></div></div>
<div class="ttc" id="classXrdProofdConfig_html_a2096e21b5241fa5b04e82d3cbbec60e9"><div class="ttname"><a href="classXrdProofdConfig.html#a2096e21b5241fa5b04e82d3cbbec60e9">XrdProofdConfig::ReadFile</a></div><div class="ttdeci">bool ReadFile(bool update=true)</div><div class="ttdoc">Return true if the file has never been read or did change since last reading, false otherwise...</div><div class="ttdef"><b>Definition:</b> <a href="XrdProofdConfig_8cxx_source.html#l00067">XrdProofdConfig.cxx:67</a></div></div>
<div class="ttc" id="classXrdROOT_html_a51a773d135799c7a2604d8789f37f562"><div class="ttname"><a href="classXrdROOT.html#a51a773d135799c7a2604d8789f37f562">XrdROOT::Dir</a></div><div class="ttdeci">const char * Dir() const</div><div class="ttdef"><b>Definition:</b> <a href="XrdROOT_8h_source.html#l00065">XrdROOT.h:65</a></div></div>
<div class="ttc" id="classXpdClientSessions_html_a1a8e490b7f7a55c7961dcc0089d215a0"><div class="ttname"><a href="classXpdClientSessions.html#a1a8e490b7f7a55c7961dcc0089d215a0">XpdClientSessions::fClient</a></div><div class="ttdeci">XrdProofdClient * fClient</div><div class="ttdef"><b>Definition:</b> <a href="XrdProofdProofServMgr_8h_source.html#l00072">XrdProofdProofServMgr.h:72</a></div></div>
<div class="ttc" id="classXrdProofdProofServ_html_a27032cb1504f86124bb5c97a96826c86"><div class="ttname"><a href="classXrdProofdProofServ.html#a27032cb1504f86124bb5c97a96826c86">XrdProofdProofServ::SetClient</a></div><div class="ttdeci">void SetClient(const char *c)</div><div class="ttdef"><b>Definition:</b> <a href="XrdProofdProofServ_8h_source.html#l00166">XrdProofdProofServ.h:166</a></div></div>
<div class="ttc" id="classXrdProofdAux_html_a6b1d64972dcdae69de7af68d43fdd5be"><div class="ttname"><a href="classXrdProofdAux.html#a6b1d64972dcdae69de7af68d43fdd5be">XrdProofdAux::KillProcess</a></div><div class="ttdeci">static int KillProcess(int pid, bool forcekill, XrdProofUI ui, bool changeown)</div><div class="ttdoc">Kill the process &amp;#39;pid&amp;#39;. </div><div class="ttdef"><b>Definition:</b> <a href="XrdProofdAux_8cxx_source.html#l01293">XrdProofdAux.cxx:1293</a></div></div>
<div class="ttc" id="XProofProtocol_8h_html_a3a4503f87fa152df23df4d274f07b932a83fc8da1cd00c3b598709425884d37fb"><div class="ttname"><a href="XProofProtocol_8h.html#a3a4503f87fa152df23df4d274f07b932a83fc8da1cd00c3b598709425884d37fb">kXPD_unknown</a></div><div class="ttdef"><b>Definition:</b> <a href="XProofProtocol_8h_source.html#l00137">XProofProtocol.h:137</a></div></div>
<div class="ttc" id="namespacexmlio_html_a7da9572bcb8815ae48bc1845efd235b5"><div class="ttname"><a href="namespacexmlio.html#a7da9572bcb8815ae48bc1845efd235b5">xmlio::cnt</a></div><div class="ttdeci">const char * cnt</div><div class="ttdef"><b>Definition:</b> <a href="TXMLSetup_8cxx_source.html#l00074">TXMLSetup.cxx:74</a></div></div>
<div class="ttc" id="classXrdProofdConfig_html_a475cd09abba63646d77f00767c34552a"><div class="ttname"><a href="classXrdProofdConfig.html#a475cd09abba63646d77f00767c34552a">XrdProofdConfig::Register</a></div><div class="ttdeci">void Register(const char *dname, XrdProofdDirective *d)</div><div class="ttdef"><b>Definition:</b> <a href="XrdProofdConfig_8h_source.html#l00044">XrdProofdConfig.h:44</a></div></div>
<div class="ttc" id="structProofServEnv__t_html_a68a3d979f6cccf40aaf61893f48461c1"><div class="ttname"><a href="structProofServEnv__t.html#a68a3d979f6cccf40aaf61893f48461c1">ProofServEnv_t::fCfg</a></div><div class="ttdeci">XrdOucString fCfg</div><div class="ttdef"><b>Definition:</b> <a href="XrdProofdProofServMgr_8h_source.html#l00060">XrdProofdProofServMgr.h:60</a></div></div>
<div class="ttc" id="classXrdProofdProtocol_html_a279527394516a18ef610489a4ab1ddfd"><div class="ttname"><a href="classXrdProofdProtocol.html#a279527394516a18ef610489a4ab1ddfd">XrdProofdProtocol::Request</a></div><div class="ttdeci">XPClientRequest * Request() const</div><div class="ttdef"><b>Definition:</b> <a href="XrdProofdProtocol_8h_source.html#l00091">XrdProofdProtocol.h:91</a></div></div>
<div class="ttc" id="classXrdProofUI_html_a02d91475e698860e6cf2eb5a8e9c29ec"><div class="ttname"><a href="classXrdProofUI.html#a02d91475e698860e6cf2eb5a8e9c29ec">XrdProofUI::fGid</a></div><div class="ttdeci">int fGid</div><div class="ttdef"><b>Definition:</b> <a href="XrdProofdAux_8h_source.html#l00044">XrdProofdAux.h:44</a></div></div>
<div class="ttc" id="classXrdProofSessionInfo_html_a8f6f72c571943c1d973141cfaa9817ed"><div class="ttname"><a href="classXrdProofSessionInfo.html#a8f6f72c571943c1d973141cfaa9817ed">XrdProofSessionInfo::SaveToFile</a></div><div class="ttdeci">int SaveToFile(const char *file)</div><div class="ttdoc">Save content to &amp;#39;file&amp;#39;. </div><div class="ttdef"><b>Definition:</b> <a href="XrdProofdProofServMgr_8cxx_source.html#l04822">XrdProofdProofServMgr.cxx:4822</a></div></div>
<div class="ttc" id="classXrdProofdProofServMgr_html_ad9f61f67fd36511fe72bea2334260176"><div class="ttname"><a href="classXrdProofdProofServMgr.html#ad9f61f67fd36511fe72bea2334260176">XrdProofdProofServMgr::fReconnectTime</a></div><div class="ttdeci">int fReconnectTime</div><div class="ttdef"><b>Definition:</b> <a href="XrdProofdProofServMgr_8h_source.html#l00152">XrdProofdProofServMgr.h:152</a></div></div>
<div class="ttc" id="classXrdProofdProofServMgr_html_a11b1baa66c0e286dd1839917ab500656"><div class="ttname"><a href="classXrdProofdProofServMgr.html#a11b1baa66c0e286dd1839917ab500656">XrdProofdProofServMgr::DoDirectiveProofServMgr</a></div><div class="ttdeci">int DoDirectiveProofServMgr(char *, XrdOucStream *, bool)</div><div class="ttdoc">Process &amp;#39;proofswrvmgr&amp;#39; directive eg: xpd.proofswrvmgr checkfq:120 termto:100 verifyto:5 recoverto:20...</div><div class="ttdef"><b>Definition:</b> <a href="XrdProofdProofServMgr_8cxx_source.html#l01216">XrdProofdProofServMgr.cxx:1216</a></div></div>
<div class="ttc" id="classXrdProofdProofServMgr_html_a08f16bc02f1e60847b83eddb9c012bc0"><div class="ttname"><a href="classXrdProofdProofServMgr.html#a08f16bc02f1e60847b83eddb9c012bc0">XrdProofdProofServMgr::BroadcastClusterInfo</a></div><div class="ttdeci">void BroadcastClusterInfo()</div><div class="ttdoc">Broadcast cluster info to the active sessions. </div><div class="ttdef"><b>Definition:</b> <a href="XrdProofdProofServMgr_8cxx_source.html#l04543">XrdProofdProofServMgr.cxx:4543</a></div></div>
<div class="ttc" id="classXrdProofdProofServMgr_html_a0cfe9bb436cf9dbcffd21d1821bc3d3f"><div class="ttname"><a href="classXrdProofdProofServMgr.html#a0cfe9bb436cf9dbcffd21d1821bc3d3f">XrdProofdProofServMgr::SetUserEnvironment</a></div><div class="ttdeci">int SetUserEnvironment(XrdProofdProtocol *p)</div><div class="ttdoc">Set user environment: set effective user and group ID of the process to the ones of the owner of this...</div><div class="ttdef"><b>Definition:</b> <a href="XrdProofdProofServMgr_8cxx_source.html#l04438">XrdProofdProofServMgr.cxx:4438</a></div></div>
<div class="ttc" id="classXrdROOT_html_a373e055dfbb0663d07da4ba0c423d0f4"><div class="ttname"><a href="classXrdROOT.html#a373e055dfbb0663d07da4ba0c423d0f4">XrdROOT::PrgmSrv</a></div><div class="ttdeci">const char * PrgmSrv() const</div><div class="ttdef"><b>Definition:</b> <a href="XrdROOT_8h_source.html#l00079">XrdROOT.h:79</a></div></div>
<div class="ttc" id="classXrdProofdProofServMgr_html_a286409daa6699f599723fc5046c71c76"><div class="ttname"><a href="classXrdProofdProofServMgr.html#a286409daa6699f599723fc5046c71c76">XrdProofdProofServMgr::fLogger</a></div><div class="ttdeci">XrdSysLogger * fLogger</div><div class="ttdef"><b>Definition:</b> <a href="XrdProofdProofServMgr_8h_source.html#l00138">XrdProofdProofServMgr.h:138</a></div></div>
<div class="ttc" id="classXrdROOT_html_a8d85b526df3fbd35ee5d4daee3d6ab0b"><div class="ttname"><a href="classXrdROOT.html#a8d85b526df3fbd35ee5d4daee3d6ab0b">XrdROOT::VersionCode</a></div><div class="ttdeci">int VersionCode() const</div><div class="ttdef"><b>Definition:</b> <a href="XrdROOT_8h_source.html#l00084">XrdROOT.h:84</a></div></div>
</div><!-- fragment --></div><!-- contents -->
<html>
<body>
<div id="footer" style="background-color:#E5EBF3;">
<small>
<img class="footer" src="rootlogo_s.gif" alt="root"/></a>
ROOT 6.18/03 - Reference Guide Generated on Thu Aug 29 2019 04:09:36 (GVA Time) using Doxygen 1.8.14.
</small>
</div>
</body>
</html>
